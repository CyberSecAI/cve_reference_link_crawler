<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-references/ic-interface-spec" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">The Internet Computer Interface Specification | Internet Computer</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://internetcomputer.org/img/share.webp"><meta data-rh="true" name="twitter:image" content="https://internetcomputer.org/img/share.webp"><meta data-rh="true" property="og:url" content="https://internetcomputer.org/docs/current/references/ic-interface-spec"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="The Internet Computer Interface Specification | Internet Computer"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/img/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://internetcomputer.org/docs/current/references/ic-interface-spec"><link data-rh="true" rel="alternate" href="https://internetcomputer.org/docs/current/references/ic-interface-spec" hreflang="en"><link data-rh="true" rel="alternate" href="https://internetcomputer.org/docs/current/references/ic-interface-spec" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Internet Computer RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Internet Computer Atom Feed">















<script>var _paq=window._paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["enableLinkTracking"]),function(){_paq.push(["setTrackerUrl","https://internetcomputer.matomo.cloud/matomo.php"]),_paq.push(["setSiteId","1"]);var e=document,t=e.createElement("script"),a=e.getElementsByTagName("script")[0];t.async=!0,t.src="//cdn.matomo.cloud/internetcomputer.matomo.cloud/matomo.js",a.parentNode.insertBefore(t,a)}()</script>










<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="08910249-851f-465b-b60f-238d84e1afc1" data-project-name="Internet Computer" data-project-color="#172234" data-project-logo="https://s3.coinmarketcap.com/static-gravity/image/2fb1bc84c1494178beef0822179d137d.png" data-modal-override-open-class="ask-ai-widget-trigger" data-modal-ask-ai-input-placeholder="Ask me a question about the Internet Computer Protocol" data-modal-example-questions="What is the ICP token?, How is the Internet Computer governed?, How do I start building fully onchain Web3?" data-modal-disclaimer=" This LLM provides responses are generated automatically and may be inaccurate or outdated. Please take care to verify or validate any responses before making any critical decisions." data-user-analytics-fingerprint-enabled="true" async></script><link rel="stylesheet" href="/assets/css/styles.4e436715.css">
<link rel="preload" href="/assets/js/runtime~main.f7a52105.js" as="script">
<link rel="preload" href="/assets/js/main.bcdc8cdd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><svg viewBox="0 0 219 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="!h-[32px] md:!h-[40px]"><title>DFINITY Logo</title><style>
              .logofill path {
                fill: #181818;
              }
              html.docs-wrapper[data-theme=&#x27;dark&#x27;] .logofill path {
                fill: #fff;
              }
            </style><path d="M69.5606 33.234C63.7777 33.234 57.6722 29.4534 54.6754 26.711C51.3977 23.7104 42.3941 13.9438 42.3543 13.9002C36.4499 7.31258 28.511 0 20.5911 0C11.0523 0 2.73196 6.60657 0.568359 15.3578C0.733476 14.7808 3.76631 6.76409 15.1499 6.76409C20.9328 6.76409 27.0383 10.5447 30.035 13.2872C33.3127 16.2877 42.3163 26.0543 42.3562 26.0979C48.2605 32.6855 56.1994 39.9981 64.1212 39.9981C73.66 39.9981 81.9785 33.3915 84.144 24.6404C83.9789 25.2173 80.946 33.234 69.5625 33.234H69.5606Z" fill="#29AAE1"></path><path d="M42.3534 26.0998C42.3326 26.0752 39.74 23.2644 36.8325 20.1974C35.261 22.063 32.9968 24.6043 30.3948 26.8837C25.5438 31.1349 22.3914 32.027 20.5884 32.027C13.7864 32.027 8.23691 26.6312 8.23691 20C8.23691 13.3688 13.7788 8.01481 20.5884 7.97306C20.8351 7.97306 21.135 7.99773 21.4956 8.06226C19.4497 7.27653 17.2766 6.7641 15.1471 6.7641C3.76737 6.7641 0.73454 14.777 0.567525 15.3578C0.199334 16.8495 0.00195312 18.402 0.00195312 20C0.00195312 31.0287 9.09855 40 20.4423 40C25.1718 40 30.4688 37.5764 35.9234 32.7937C38.5026 30.5333 40.7383 28.1154 42.418 26.172C42.3971 26.1473 42.3743 26.1245 42.3534 26.0998Z" fill="url(#paint0_linear_9598_62140)"></path><path d="M42.3536 13.9002C42.3745 13.9248 44.967 16.7356 47.8746 19.8026C49.446 17.937 51.7102 15.3957 54.3122 13.1163C59.1632 8.86506 62.3156 7.97305 64.1186 7.97305C70.9207 7.97305 76.4701 13.3688 76.4701 20C76.4701 26.5933 70.9283 31.9852 64.1186 32.027C63.8719 32.027 63.572 32.0023 63.2114 31.9377C65.2574 32.7235 67.4305 33.2359 69.5599 33.2359C80.9416 33.2359 83.9744 25.223 84.1414 24.6422C84.5096 23.1505 84.707 21.598 84.707 20C84.707 8.97134 75.4623 0 64.1186 0C59.3891 0 54.2401 2.42361 48.7837 7.2063C46.2044 9.46669 43.9687 11.8846 42.2891 13.8281C42.3099 13.8527 42.3327 13.8755 42.3536 13.9002Z" fill="url(#paint1_linear_9598_62140)"></path><g class="logofill"><path d="M93.9102 17.5973V0.516235H98.5125V17.5973H93.9102Z"></path><path d="M111.256 17.5973L105.329 7.45493V17.5973H100.873V0.516235H106.077L111.401 9.79124V0.516235H115.882V17.5973H111.256Z"></path><path d="M126.29 4.7808V17.5973H121.761V4.7808H116.846V0.516235H131.228V4.7808H126.29Z"></path><path d="M132.193 17.5973V0.516235H143.131V4.4183H136.674V7.11711H142.552V10.8749H136.674V13.6212H143.178V17.5954H132.193V17.5973Z"></path><path d="M144.937 17.5973V0.516235H152.14C155.609 0.516235 157.873 2.82977 157.873 6.00874C157.873 8.32227 156.596 10.0323 154.717 10.7781L157.946 17.5954H153.055L150.356 11.4045H149.416V17.5954H144.936L144.937 17.5973ZM151.297 7.937C152.647 7.937 153.345 7.16645 153.345 6.08276C153.345 4.99906 152.647 4.25129 151.297 4.25129H149.418V7.937H151.297Z"></path><path d="M169.559 17.5973L163.632 7.45493V17.5973H159.176V0.516235H164.38L169.703 9.79124V0.516235H174.184V17.5973H169.559Z"></path><path d="M176.156 17.5973V0.516235H187.094V4.4183H180.637V7.11711H186.515V10.8749H180.637V13.6212H187.141V17.5954H176.156V17.5973Z"></path><path d="M197.336 4.7808V17.5973H192.808V4.7808H187.893V0.516235H202.275V4.7808H197.336Z"></path><path d="M96.8855 30.6985C96.8855 33.5415 98.9087 35.1794 100.981 35.1794C103.342 35.1794 104.354 33.7104 104.716 32.5053L108.956 33.7332C108.282 36.2631 106.016 39.5882 100.958 39.5882C96.2118 39.5882 92.2129 36.1435 92.2129 30.7231C92.2129 25.3027 96.2839 21.7859 100.911 21.7859C105.826 21.7859 108.066 24.7732 108.764 27.3278L104.597 28.7493C104.283 27.6163 103.369 26.1226 100.958 26.1226C99.0301 26.1226 96.8874 27.5916 96.8874 30.7004L96.8855 30.6985Z"></path><path d="M117.725 21.7859C122.423 21.7859 126.495 25.1585 126.495 30.7004C126.495 36.2422 122.424 39.6148 117.725 39.6148C113.026 39.6148 108.955 36.2422 108.955 30.7004C108.955 25.1585 113.026 21.7859 117.725 21.7859ZM117.725 35.2534C119.726 35.2534 121.846 33.8319 121.846 30.6757C121.846 27.5195 119.726 26.1473 117.725 26.1473C115.725 26.1473 113.605 27.5688 113.605 30.6757C113.605 33.7825 115.725 35.2534 117.725 35.2534Z"></path><path d="M143.02 39.2276V28.6506L139.285 39.2276H135.718L132.008 28.7721V39.2276H127.719V22.1465H133.718L137.548 32.5546L141.209 22.1465H147.377V39.2276H143.016H143.02Z"></path><path d="M153.834 33.3973V39.2276H149.354V22.1465H156.171C159.737 22.1465 162.17 24.4829 162.17 27.7833C162.17 31.0837 159.737 33.3973 156.171 33.3973H153.834ZM155.594 29.6622C156.774 29.6622 157.642 28.9638 157.642 27.808C157.642 26.6521 156.774 25.929 155.594 25.929H153.859V29.6641H155.594V29.6622Z"></path><path d="M163.062 32.9645V22.1465H167.568V32.8184C167.568 34.5056 168.435 35.3957 169.929 35.3957C171.423 35.3957 172.265 34.5037 172.265 32.8184V22.1465H176.771V32.9645C176.771 37.2519 173.903 39.6148 169.929 39.6148C165.955 39.6148 163.062 37.2538 163.062 32.9645Z"></path><path d="M187.01 26.4111V39.2276H182.482V26.4111H177.566V22.1465H191.949V26.4111H187.01Z"></path><path d="M192.912 39.2276V22.1465H203.85V26.0486H197.393V28.7474H203.271V32.5052H197.393V35.2515H203.897V39.2257H192.912V39.2276Z"></path><path d="M205.658 39.2276V22.1465H212.861C216.33 22.1465 218.594 24.4601 218.594 27.6391C218.594 29.9526 217.317 31.6626 215.438 32.4085L218.666 39.2257H213.775L211.077 33.0348H210.137V39.2257H205.656L205.658 39.2276ZM212.018 29.5673C213.367 29.5673 214.066 28.7968 214.066 27.7131C214.066 26.6294 213.367 25.8816 212.018 25.8816H210.139V29.5673H212.018Z"></path></g><defs><linearGradient id="paint0_linear_9598_62140" x1="31.2622" y1="37.3828" x2="3.40487" y2="8.53484" gradientUnits="userSpaceOnUse"><stop offset="0.22" stop-color="#EC1E79"></stop><stop offset="0.89" stop-color="#522784"></stop></linearGradient><linearGradient id="paint1_linear_9598_62140" x1="53.4278" y1="2.63428" x2="81.2851" y2="31.4823" gradientUnits="userSpaceOnUse"><stop offset="0.21" stop-color="#F05A24"></stop><stop offset="0.68" stop-color="#FAAF3B"></stop></linearGradient></defs></svg></div></a><a class="navbar__item navbar__link" href="/docs/current/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/current/developer-docs/getting-started/quickstart/first-smart-contract">Build</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Languages</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/current/developer-docs/backend/rust/">Rust</a></li><li><a class="dropdown__link" href="/docs/current/motoko/main/getting-started/motoko-introduction">Motoko</a></li><li><a class="dropdown__link" href="/docs/current/developer-docs/backend/typescript/">TypeScript</a></li><li><a class="dropdown__link" href="/docs/current/developer-docs/backend/python/">Python</a></li><li><a class="dropdown__link" href="/docs/current/developer-docs/backend/solidity/">Solidity</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Additional Resources</a><ul class="dropdown__menu"><li><a href="https://github.com/dfinity/awesome-internet-computer#readme" target="_blank" rel="noopener noreferrer" class="dropdown__link">Awesome Internet Computer<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="iconExternalLink_2l9O"><path d="M11.2429 8.34285L3.65709 8.34285L3.65709 6.34315H14.6568V17.3429L12.6571 17.3429L12.6571 9.75706L4.05024 18.364L2.63603 16.9498L11.2429 8.34285Z" fill="currentColor"></path></svg></a></li><li><a class="dropdown__link" href="/docs/current/other/updates/release-notes/">SDK Release Notes</a></li><li><a href="https://dfinity.org/grants" target="_blank" rel="noopener noreferrer" class="dropdown__link">Developer Grants<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="iconExternalLink_2l9O"><path d="M11.2429 8.34285L3.65709 8.34285L3.65709 6.34315H14.6568V17.3429L12.6571 17.3429L12.6571 9.75706L4.05024 18.364L2.63603 16.9498L11.2429 8.34285Z" fill="currentColor"></path></svg></a></li><li><a href="https://m7sm4-2iaaa-aaaab-qabra-cai.raw.ic0.app/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Playground<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="iconExternalLink_2l9O"><path d="M11.2429 8.34285L3.65709 8.34285L3.65709 6.34315H14.6568V17.3429L12.6571 17.3429L12.6571 9.75706L4.05024 18.364L2.63603 16.9498L11.2429 8.34285Z" fill="currentColor"></path></svg></a></li><li><a href="https://forum.dfinity.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Dev Forum<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="iconExternalLink_2l9O"><path d="M11.2429 8.34285L3.65709 8.34285L3.65709 6.34315H14.6568V17.3429L12.6571 17.3429L12.6571 9.75706L4.05024 18.364L2.63603 16.9498L11.2429 8.34285Z" fill="currentColor"></path></svg></a></li><li><a href="https://discord.internetcomputer.org" target="_blank" rel="noopener noreferrer" class="dropdown__link">Dev Discord<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="iconExternalLink_2l9O"><path d="M11.2429 8.34285L3.65709 8.34285L3.65709 6.34315H14.6568V17.3429L12.6571 17.3429L12.6571 9.75706L4.05024 18.364L2.63603 16.9498L11.2429 8.34285Z" fill="currentColor"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"> <style>
.ai-spark {
  position: absolute;
  background: white;
  width: 10%;
  aspect-ratio: 1;
  top: 50%;
  left: 50%;
  border-radius: 50%;
  animation: sprkle calc(var(--rnd) * 3s) infinite linear;
  animation-delay: calc(var(--i) * -3s);
  transition: background .3s;
}

.button-fancy-ai:hover .ai-spark {
  background: pink;
}

@keyframes sprkle {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) rotate(calc(var(--a) * 360deg)) translateY(calc(var(--r) * 0rem)) scale(calc(var(--rnd) * 0));
  }
  30% {
    opacity: 1;
    transform: translate(-50%, -50%) rotate(calc(var(--a) * 360deg)) translateY(calc(var(--r) * 1rem)) scale(calc(var(--rnd) * .3));
  }
  70% {
    opacity: 1;
    transform: translate(-50%, -50%) rotate(calc(var(--a) * 360deg)) translateY(calc(var(--r) * 2rem)) scale(calc(var(--rnd) * .7));
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) rotate(calc(var(--a) * 360deg)) translateY(calc(var(--r) * 3rem)) scale(calc(var(--rnd) * 1));
  }
}
</style><button class="relative ask-ai-widget-trigger button-white button-fancy-ai border-none transition-all bg-[radial-gradient(67.52%_167.71%_at_50.38%_-41.67%,#EA2B7B_0%,#3B00B9_100%)] hover:text-white/80 stat-fade-in button-small md:button-small font-bold mr-0 md:mr-0 w-10 md:w-12 h-8 md:h-10" style="display:flex;align-items:center;justify-content:center"><span class="flex-1 flex flex-col items-center"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="md:text-white scale-75 md:scale-100"><path d="M12 10.096v6.32a4.337 4.337 0 1 1-8.658-.365c-.903-.967-1.473-2.865-1.473-4.447 0-2.156 1.059-4.252 2.574-5.077a3.789 3.789 0 0 1 6.212-3.304" stroke="currentColor" stroke-width="1.714" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6.445 9.102c-.557-.127-1.816-.955-2.006-2.566M4.502 13.778c-.567.448-1.02 1.46-1.164 2.272M12 16.416a4.337 4.337 0 1 0 8.658-.365c.903-.97 1.47-2.865 1.47-4.447 0-.691-.107-1.376-.305-2.014" stroke="currentColor" stroke-width="1.714" stroke-linecap="round" stroke-linejoin="round"></path><path d="M19.498 13.778c.567.448 1.019 1.46 1.164 2.272M12.119 6.713c-.557-.099-.557-.9 0-.997a5.056 5.056 0 0 0 4.073-3.9l.032-.154c.123-.553.908-.557 1.035-.005l.04.18a5.082 5.082 0 0 0 4.085 3.876c.56.097.56.904 0 1.003a5.082 5.082 0 0 0-4.085 3.876l-.041.178c-.126.551-.911.548-1.032-.005l-.034-.152a5.055 5.055 0 0 0-4.073-3.9Z" stroke="currentColor" stroke-width="1.714" stroke-linecap="round" stroke-linejoin="round"></path></svg> </span><span class="hidden md:block font-bold"></span><i class="ai-spark" style="--i:0;--rnd:0.5163231924565554;--r:0.7109821067798022;--a:0.9653424169096303"></i><i class="ai-spark" style="--i:0.03333333333333333;--rnd:0.544924266936643;--r:0.7046086239595803;--a:0.5926943370013713"></i><i class="ai-spark" style="--i:0.06666666666666667;--rnd:0.7668173588881271;--r:0.54692884067829;--a:0.2790944107036917"></i><i class="ai-spark" style="--i:0.1;--rnd:0.6337912069679557;--r:0.6748483024342598;--a:0.7486290058074017"></i><i class="ai-spark" style="--i:0.13333333333333333;--rnd:0.38547176334695443;--r:0.7847150146973458;--a:0.39156825436979514"></i><i class="ai-spark" style="--i:0.16666666666666666;--rnd:0.3933610400578007;--r:0.623364701786351;--a:0.3279399910992036"></i><i class="ai-spark" style="--i:0.2;--rnd:0.9857689815128565;--r:0.9893474181038273;--a:0.5772410133340027"></i><i class="ai-spark" style="--i:0.23333333333333334;--rnd:0.4513318663373922;--r:0.7349112983887027;--a:0.8953317324490451"></i><i class="ai-spark" style="--i:0.26666666666666666;--rnd:0.8704865293880524;--r:0.8688716607147298;--a:0.9566556917922748"></i><i class="ai-spark" style="--i:0.3;--rnd:0.09865466574153903;--r:0.729099726518102;--a:0.17710533801267325"></i><i class="ai-spark" style="--i:0.3333333333333333;--rnd:0.9803040786342829;--r:0.7064511026405189;--a:0.7982012476138836"></i><i class="ai-spark" style="--i:0.36666666666666664;--rnd:0.8002604736113015;--r:0.892299460320194;--a:0.4985662082411686"></i><i class="ai-spark" style="--i:0.4;--rnd:0.8108517494598586;--r:0.696339716369982;--a:0.3096229901248009"></i><i class="ai-spark" style="--i:0.43333333333333335;--rnd:0.5100360705191402;--r:0.9672797999645584;--a:0.27157260857901844"></i><i class="ai-spark" style="--i:0.4666666666666667;--rnd:0.4265111422082897;--r:0.5629260560070346;--a:0.6695253730252433"></i><i class="ai-spark" style="--i:0.5;--rnd:0.7857046436737309;--r:0.669133556276784;--a:0.0651902626475207"></i><i class="ai-spark" style="--i:0.5333333333333333;--rnd:0.48839393033928546;--r:0.5493346128982681;--a:0.8223235266177213"></i><i class="ai-spark" style="--i:0.5666666666666667;--rnd:0.09762392343723958;--r:0.6965206672612846;--a:0.7162449331629752"></i><i class="ai-spark" style="--i:0.6;--rnd:0.9952637416476691;--r:0.9730968316251374;--a:0.045372012736407674"></i><i class="ai-spark" style="--i:0.6333333333333333;--rnd:0.6373315279132263;--r:0.5232087158001361;--a:0.5666741402163913"></i><i class="ai-spark" style="--i:0.6666666666666666;--rnd:0.41528546094904706;--r:0.796711350947003;--a:0.48622185074031243"></i><i class="ai-spark" style="--i:0.7;--rnd:0.8836454197979016;--r:0.6944006080226826;--a:0.5705816837417717"></i><i class="ai-spark" style="--i:0.7333333333333333;--rnd:0.7787741677677456;--r:0.6692876824825505;--a:0.9958477537710901"></i><i class="ai-spark" style="--i:0.7666666666666667;--rnd:0.47721860670147986;--r:0.862370445696582;--a:0.1189873059483062"></i><i class="ai-spark" style="--i:0.8;--rnd:0.9608000898947509;--r:0.804883388710394;--a:0.8125096233266611"></i><i class="ai-spark" style="--i:0.8333333333333334;--rnd:0.956585254978441;--r:0.5301519733788002;--a:0.14701233719862694"></i><i class="ai-spark" style="--i:0.8666666666666667;--rnd:0.23520268075781292;--r:0.6022408711253356;--a:0.8548999813873046"></i><i class="ai-spark" style="--i:0.9;--rnd:0.4140468274651816;--r:0.9863851839067042;--a:0.8080623588264713"></i><i class="ai-spark" style="--i:0.9333333333333333;--rnd:0.7401972462682584;--r:0.6433036464728592;--a:0.8182072813305805"></i><i class="ai-spark" style="--i:0.9666666666666667;--rnd:0.3850210880516578;--r:0.8247314741946371;--a:0.28194159874459856"></i></button><button class="navbar__search-button group border-none md:border-2 md:border-solid md:border-infinite/50 md:rounded-xl md:docs:border-black bg-transparent px-2 md:px-5 py-1 md:py-2 font-circular md:text-infinite md:docs:text-black flex gap-2 items-center md:order-last outline-offset-2 absolute right-[64px] md:static text-black dark-hero:text-white dark-hero:border-white/50 md:hover:bg-infinite md:hover:text-white md:docs:hover:bg-black md:docs:hover:text-white md:hover:dark-hero:text-infinite md:hover:dark-hero:bg-white md:hover:dark-hero:border-white" aria-label="Search"><svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 md:w-4 md:h-4"><path d="M11.7668 11.024L14.6221 13.8786L13.6788 14.822L10.8241 11.9666C9.76193 12.8181 8.44077 13.2812 7.07944 13.2793C3.76744 13.2793 1.07944 10.5913 1.07944 7.2793C1.07944 3.9673 3.76744 1.2793 7.07944 1.2793C10.3914 1.2793 13.0794 3.9673 13.0794 7.2793C13.0814 8.64063 12.6183 9.96179 11.7668 11.024ZM10.4294 10.5293C11.2755 9.65922 11.748 8.49292 11.7461 7.2793C11.7461 4.70063 9.65744 2.61263 7.07944 2.61263C4.50077 2.61263 2.41277 4.70063 2.41277 7.2793C2.41277 9.8573 4.50077 11.946 7.07944 11.946C8.29306 11.9479 9.45936 11.4754 10.3294 10.6293L10.4294 10.5293V10.5293Z" fill="currentColor" stroke="currentColor" stroke-width="0.5"></path></svg><span class="tw-title-navigation text-infinite dark-hero:text-white md:group-hover:text-white md:dark-hero:group-hover:text-infinite hidden md:block docs:text-black">Search</span><span class="hidden md:block min-w-[53px] text-right text-infinite/70 dark-hero:text-white/70 md:dark-hero:group-hover:text-infinite docs:text-black/50 md:group-hover:text-white"></span></button><input style="display:none;position:fixed;top:0;left:0;right:0;opacity:0;height:100px;font-size:30px" id="ios-tmp-input"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><nav class="subnav"><ul class="theme-doc-sidebar-menu menu__list"><a class="navbar__item navbar__link" type="doc" href="/docs/current/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" type="docSidebar" href="/docs/current/developer-docs/getting-started/quickstart/first-smart-contract">Build</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" type="dropdown">Languages</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/current/developer-docs/backend/rust/">Rust</a></li><li><a class="dropdown__link" href="/docs/current/motoko/main/getting-started/motoko-introduction">Motoko</a></li><li><a class="dropdown__link" href="/docs/current/developer-docs/backend/typescript/">TypeScript</a></li><li><a class="dropdown__link" href="/docs/current/developer-docs/backend/python/">Python</a></li><li><a class="dropdown__link" href="/docs/current/developer-docs/backend/solidity/">Solidity</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" type="dropdown">Additional Resources</a><ul class="dropdown__menu"><li><a href="https://github.com/dfinity/awesome-internet-computer#readme" target="_blank" rel="noopener noreferrer" class="dropdown__link">Awesome Internet Computer<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="iconExternalLink_2l9O"><path d="M11.2429 8.34285L3.65709 8.34285L3.65709 6.34315H14.6568V17.3429L12.6571 17.3429L12.6571 9.75706L4.05024 18.364L2.63603 16.9498L11.2429 8.34285Z" fill="currentColor"></path></svg></a></li><li><a class="dropdown__link" href="/docs/current/other/updates/release-notes/">SDK Release Notes</a></li><li><a href="https://dfinity.org/grants" target="_blank" rel="noopener noreferrer" class="dropdown__link">Developer Grants<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="iconExternalLink_2l9O"><path d="M11.2429 8.34285L3.65709 8.34285L3.65709 6.34315H14.6568V17.3429L12.6571 17.3429L12.6571 9.75706L4.05024 18.364L2.63603 16.9498L11.2429 8.34285Z" fill="currentColor"></path></svg></a></li><li><a href="https://m7sm4-2iaaa-aaaab-qabra-cai.raw.ic0.app/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Playground<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="iconExternalLink_2l9O"><path d="M11.2429 8.34285L3.65709 8.34285L3.65709 6.34315H14.6568V17.3429L12.6571 17.3429L12.6571 9.75706L4.05024 18.364L2.63603 16.9498L11.2429 8.34285Z" fill="currentColor"></path></svg></a></li><li><a href="https://forum.dfinity.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Dev Forum<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="iconExternalLink_2l9O"><path d="M11.2429 8.34285L3.65709 8.34285L3.65709 6.34315H14.6568V17.3429L12.6571 17.3429L12.6571 9.75706L4.05024 18.364L2.63603 16.9498L11.2429 8.34285Z" fill="currentColor"></path></svg></a></li><li><a href="https://discord.internetcomputer.org" target="_blank" rel="noopener noreferrer" class="dropdown__link">Dev Discord<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="iconExternalLink_2l9O"><path d="M11.2429 8.34285L3.65709 8.34285L3.65709 6.34315H14.6568V17.3429L12.6571 17.3429L12.6571 9.75706L4.05024 18.364L2.63603 16.9498L11.2429 8.34285Z" fill="currentColor"></path></svg></a></li></ul></div></ul><ul class="theme-doc-sidebar-menu breadcrumbs"><div class="flex flex-row gap-2 items-center tw-title-navigation-on-page whitespace-nowrap max-w-full"><a class="text-black">references</a><span>/</span><a>ic interface spec</a><svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 text-black opacity-50 mt-0.5"><path d="m13.5 12-7-7 2-2 9 9-9 9-2-2 7-7Z"></path></svg></div></ul></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><div><svg viewBox="0 0 219 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="!h-[32px] md:!h-[40px]"><title>DFINITY Logo</title><style>
              .logofill path {
                fill: #181818;
              }
              html.docs-wrapper[data-theme=&#x27;dark&#x27;] .logofill path {
                fill: #fff;
              }
            </style><path d="M69.5606 33.234C63.7777 33.234 57.6722 29.4534 54.6754 26.711C51.3977 23.7104 42.3941 13.9438 42.3543 13.9002C36.4499 7.31258 28.511 0 20.5911 0C11.0523 0 2.73196 6.60657 0.568359 15.3578C0.733476 14.7808 3.76631 6.76409 15.1499 6.76409C20.9328 6.76409 27.0383 10.5447 30.035 13.2872C33.3127 16.2877 42.3163 26.0543 42.3562 26.0979C48.2605 32.6855 56.1994 39.9981 64.1212 39.9981C73.66 39.9981 81.9785 33.3915 84.144 24.6404C83.9789 25.2173 80.946 33.234 69.5625 33.234H69.5606Z" fill="#29AAE1"></path><path d="M42.3534 26.0998C42.3326 26.0752 39.74 23.2644 36.8325 20.1974C35.261 22.063 32.9968 24.6043 30.3948 26.8837C25.5438 31.1349 22.3914 32.027 20.5884 32.027C13.7864 32.027 8.23691 26.6312 8.23691 20C8.23691 13.3688 13.7788 8.01481 20.5884 7.97306C20.8351 7.97306 21.135 7.99773 21.4956 8.06226C19.4497 7.27653 17.2766 6.7641 15.1471 6.7641C3.76737 6.7641 0.73454 14.777 0.567525 15.3578C0.199334 16.8495 0.00195312 18.402 0.00195312 20C0.00195312 31.0287 9.09855 40 20.4423 40C25.1718 40 30.4688 37.5764 35.9234 32.7937C38.5026 30.5333 40.7383 28.1154 42.418 26.172C42.3971 26.1473 42.3743 26.1245 42.3534 26.0998Z" fill="url(#paint0_linear_9598_62140)"></path><path d="M42.3536 13.9002C42.3745 13.9248 44.967 16.7356 47.8746 19.8026C49.446 17.937 51.7102 15.3957 54.3122 13.1163C59.1632 8.86506 62.3156 7.97305 64.1186 7.97305C70.9207 7.97305 76.4701 13.3688 76.4701 20C76.4701 26.5933 70.9283 31.9852 64.1186 32.027C63.8719 32.027 63.572 32.0023 63.2114 31.9377C65.2574 32.7235 67.4305 33.2359 69.5599 33.2359C80.9416 33.2359 83.9744 25.223 84.1414 24.6422C84.5096 23.1505 84.707 21.598 84.707 20C84.707 8.97134 75.4623 0 64.1186 0C59.3891 0 54.2401 2.42361 48.7837 7.2063C46.2044 9.46669 43.9687 11.8846 42.2891 13.8281C42.3099 13.8527 42.3327 13.8755 42.3536 13.9002Z" fill="url(#paint1_linear_9598_62140)"></path><g class="logofill"><path d="M93.9102 17.5973V0.516235H98.5125V17.5973H93.9102Z"></path><path d="M111.256 17.5973L105.329 7.45493V17.5973H100.873V0.516235H106.077L111.401 9.79124V0.516235H115.882V17.5973H111.256Z"></path><path d="M126.29 4.7808V17.5973H121.761V4.7808H116.846V0.516235H131.228V4.7808H126.29Z"></path><path d="M132.193 17.5973V0.516235H143.131V4.4183H136.674V7.11711H142.552V10.8749H136.674V13.6212H143.178V17.5954H132.193V17.5973Z"></path><path d="M144.937 17.5973V0.516235H152.14C155.609 0.516235 157.873 2.82977 157.873 6.00874C157.873 8.32227 156.596 10.0323 154.717 10.7781L157.946 17.5954H153.055L150.356 11.4045H149.416V17.5954H144.936L144.937 17.5973ZM151.297 7.937C152.647 7.937 153.345 7.16645 153.345 6.08276C153.345 4.99906 152.647 4.25129 151.297 4.25129H149.418V7.937H151.297Z"></path><path d="M169.559 17.5973L163.632 7.45493V17.5973H159.176V0.516235H164.38L169.703 9.79124V0.516235H174.184V17.5973H169.559Z"></path><path d="M176.156 17.5973V0.516235H187.094V4.4183H180.637V7.11711H186.515V10.8749H180.637V13.6212H187.141V17.5954H176.156V17.5973Z"></path><path d="M197.336 4.7808V17.5973H192.808V4.7808H187.893V0.516235H202.275V4.7808H197.336Z"></path><path d="M96.8855 30.6985C96.8855 33.5415 98.9087 35.1794 100.981 35.1794C103.342 35.1794 104.354 33.7104 104.716 32.5053L108.956 33.7332C108.282 36.2631 106.016 39.5882 100.958 39.5882C96.2118 39.5882 92.2129 36.1435 92.2129 30.7231C92.2129 25.3027 96.2839 21.7859 100.911 21.7859C105.826 21.7859 108.066 24.7732 108.764 27.3278L104.597 28.7493C104.283 27.6163 103.369 26.1226 100.958 26.1226C99.0301 26.1226 96.8874 27.5916 96.8874 30.7004L96.8855 30.6985Z"></path><path d="M117.725 21.7859C122.423 21.7859 126.495 25.1585 126.495 30.7004C126.495 36.2422 122.424 39.6148 117.725 39.6148C113.026 39.6148 108.955 36.2422 108.955 30.7004C108.955 25.1585 113.026 21.7859 117.725 21.7859ZM117.725 35.2534C119.726 35.2534 121.846 33.8319 121.846 30.6757C121.846 27.5195 119.726 26.1473 117.725 26.1473C115.725 26.1473 113.605 27.5688 113.605 30.6757C113.605 33.7825 115.725 35.2534 117.725 35.2534Z"></path><path d="M143.02 39.2276V28.6506L139.285 39.2276H135.718L132.008 28.7721V39.2276H127.719V22.1465H133.718L137.548 32.5546L141.209 22.1465H147.377V39.2276H143.016H143.02Z"></path><path d="M153.834 33.3973V39.2276H149.354V22.1465H156.171C159.737 22.1465 162.17 24.4829 162.17 27.7833C162.17 31.0837 159.737 33.3973 156.171 33.3973H153.834ZM155.594 29.6622C156.774 29.6622 157.642 28.9638 157.642 27.808C157.642 26.6521 156.774 25.929 155.594 25.929H153.859V29.6641H155.594V29.6622Z"></path><path d="M163.062 32.9645V22.1465H167.568V32.8184C167.568 34.5056 168.435 35.3957 169.929 35.3957C171.423 35.3957 172.265 34.5037 172.265 32.8184V22.1465H176.771V32.9645C176.771 37.2519 173.903 39.6148 169.929 39.6148C165.955 39.6148 163.062 37.2538 163.062 32.9645Z"></path><path d="M187.01 26.4111V39.2276H182.482V26.4111H177.566V22.1465H191.949V26.4111H187.01Z"></path><path d="M192.912 39.2276V22.1465H203.85V26.0486H197.393V28.7474H203.271V32.5052H197.393V35.2515H203.897V39.2257H192.912V39.2276Z"></path><path d="M205.658 39.2276V22.1465H212.861C216.33 22.1465 218.594 24.4601 218.594 27.6391C218.594 29.9526 217.317 31.6626 215.438 32.4085L218.666 39.2257H213.775L211.077 33.0348H210.137V39.2257H205.656L205.658 39.2276ZM212.018 29.5673C213.367 29.5673 214.066 28.7968 214.066 27.7131C214.066 26.6294 213.367 25.8816 212.018 25.8816H210.139V29.5673H212.018Z"></path></g><defs><linearGradient id="paint0_linear_9598_62140" x1="31.2622" y1="37.3828" x2="3.40487" y2="8.53484" gradientUnits="userSpaceOnUse"><stop offset="0.22" stop-color="#EC1E79"></stop><stop offset="0.89" stop-color="#522784"></stop></linearGradient><linearGradient id="paint1_linear_9598_62140" x1="53.4278" y1="2.63428" x2="81.2851" y2="31.4823" gradientUnits="userSpaceOnUse"><stop offset="0.21" stop-color="#F05A24"></stop><stop offset="0.68" stop-color="#FAAF3B"></stop></linearGradient></defs></svg></div></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/current/developer-docs/getting-started/quickstart/first-smart-contract">Quick starts</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/current/developer-docs/getting-started/network-overview">Network overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/current/developer-docs/getting-started/explore-examples">Essentials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/current/developer-docs/smart-contracts/overview/introduction">Smart contracts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/current/developer-docs/smart-contracts/advanced-features/handling-get-post-requests">Advanced features</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/current/developer-docs/smart-contracts/best-practices/general">Best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/current/developer-docs/developer-tools/dev-tools-overview">Developer tools</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer tools&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/current/developer-docs/web-apps/application-frontends/overview">Web apps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/current/developer-docs/security/security-best-practices/overview">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/current/developer-docs/multi-chain/overview">Chain Fusion</a><button aria-label="Toggle the collapsible sidebar category &#x27;Chain Fusion&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/current/developer-docs/identity/authentication/overview">Authentication</a><button aria-label="Toggle the collapsible sidebar category &#x27;Authentication&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/current/developer-docs/defi/overview">Digital assets</a><button aria-label="Toggle the collapsible sidebar category &#x27;Digital assets&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/current/developer-docs/ai/overview">Decentralized AI</a><button aria-label="Toggle the collapsible sidebar category &#x27;Decentralized AI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/current/developer-docs/daos/nns/overview">Governance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/current/references/http-gateway-protocol-spec">References</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/current/references/http-gateway-protocol-spec">Internet Computer specification</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/current/references/http-gateway-protocol-spec">The HTTP Gateway Protocol Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/current/references/ic-interface-spec">The Internet Computer Interface Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/current/references/id-encoding-spec">ID encoding specification</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/current/references/candid-ref">Languages</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/current/references/asset-canister">Core services</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/current/references/execution-errors">Execution errors</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/current/references/bitcoin-how-it-works">Feature references</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/current/references/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/current/references/dashboard/overview">ICP dashboard</a><button aria-label="Toggle the collapsible sidebar category &#x27;ICP dashboard&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/current/references/message-execution-properties">Message execution properties</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/current/references/ingress-messages">Ingress messages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/current/developer-docs/smart-contracts/advanced-features/system-canisters">System canisters</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/current/references/node-providers/overview">Node providers</a><button aria-label="Toggle the collapsible sidebar category &#x27;Node providers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/current/references/subnets/overview">Subnets</a><button aria-label="Toggle the collapsible sidebar category &#x27;Subnets&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>The Internet Computer Interface Specification</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">â</a></h2><p>Welcome to <em>the Internet Computer</em>! We speak of &quot;the&quot; Internet Computer, because although under the hood a large number of physical computers are working together in a blockchain protocol, in the end we have the appearance of a single, shared, secure and world-wide accessible computer. Developers who want to build decentralized applications (or <em>dapps</em> for short) that run on the Internet Computer blockchain and end-users who want to use those dapps need to know very little, if anything, about the underlying protocol. However, knowing some details about the interfaces that the Internet Computer exposes can allow interested developers and architects to take fuller advantages of the unique features that the Internet Computer provides.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="target-audience">Target audience<a href="#target-audience" class="hash-link" aria-label="Direct link to Target audience" title="Direct link to Target audience">â</a></h3><p>This document describes this <em>external</em> view of the Internet Computer, i.e. the low-level interfaces it provides to dapp developers and users, and what will happen when they use these interfaces.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>While this document describes the external interface and behavior of the Internet Computer, it is not intended as end-user or end-developer documentation. Most developers will interact with the Internet Computer through additional tooling like the SDK, Canister Development Kits and Motoko. Please see the <a href="https://internetcomputer.org/docs/current/home" target="_blank" rel="noopener noreferrer">developer docs</a> for suitable documentation.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>The target audience of this document are</p><ul><li><p>those who use these low-level interfaces (e.g. implement agents, canister developments kits, emulators, other tooling).</p></li><li><p>those who implement these low-level interfaces (e.g. developers of the Internet Computer implementation)</p></li><li><p>those who want to understand the intricacies of the Internet Computer&#x27;s behavior in great detail (e.g. to do a security analysis)</p></li></ul><div class="admonition_WoCw admonitionNote_L5_h"><p>This document is a rigorous, technically dense reference. It is not an introduction to the Internet Computer, and as such most useful to those who understand the high-level concepts. Please see more high-level documentation first.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="scope-of-this-document">Scope of this document<a href="#scope-of-this-document" class="hash-link" aria-label="Direct link to Scope of this document" title="Direct link to Scope of this document">â</a></h3><p>If you think of the Internet Computer as a distributed engine that executes WebAssembly-based dapps, then this document describes exclusively the aspect of executing those dapps. To the extent possible, this document will <em>not</em> talk about consensus protocols, nodes, subnets, orthogonal persistence or governance.</p><p>This document tries to be implementation agnostic: It would apply just as well to a (hypothetical) compatible reimplementation of the Internet Computer. This implies that this document does not cover interfaces towards those running the Internet Computer (e.g. data center operators, protocol developers, governance users), as topics like node update, monitoring, logging are inherently tied to the actual <em>implementation</em> and its architecture.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="overview-of-the-internet-computer">Overview of the Internet Computer<a href="#overview-of-the-internet-computer" class="hash-link" aria-label="Direct link to Overview of the Internet Computer" title="Direct link to Overview of the Internet Computer">â</a></h3><p>Dapps on the Internet Computer, or <em>IC</em> for short, are implemented as <em>canister smart contracts</em>, or <em>canisters</em> for short. If you want to build on the Internet Computer as a dapp developer, you first create a <em>canister module</em> that contains the WebAssembly code and configuration for your dapp, and deploy it using the <a href="#http-interface">HTTPS interface</a>. You can create canister modules using the Motoko language and the SDK, which is more convenient. If you want to use your own tooling, however, then this document describes <a href="#canister-module-format">what a canister module looks like</a> and how the <a href="#system-api">WebAssembly code can interact with the IC</a>.</p><p>Once your dapp is running on the Internet Computer, it is a canister smart contract, and users can interact with it. They can use the <a href="#http-interface">HTTPS interface</a> to interact with the canister according to the <a href="#system-api">System API</a>.</p><p>The user can also use the HTTPS interface to issue read-only queries, which are faster, but cannot change the state of a canister.</p><img loading="lazy" src="https://www.plantuml.com/plantuml/png/XP2nQiGm44JxVCL4lGdN7haqIX5_GBXwOozaGPRCQfs3u8yFadKEn4KgiRCpRrW100sM5A_ynI7Dh0_OjVVSnfdKP92Pei7rqLWZ6toQviLO7IYZzqUdfoZPM76g5a_nL4rx5xeNz1vdFENbOnB3e4p665gmkfksftjVOcN4kIt_K9-xRiFUEPsCb_-g9MQZ432bSGbyR98e9XJaUzkjwrhVyaV7Cmh8VN88oHr9LQ-oiYqQuTwAWblIC3wwN-n-HpDSDyCF" class="img_ev3q"><p><strong>A typical use of the Internet Computer. (This is a simplified view; some of the arrows represent multiple interaction steps or polling.)</strong></p><p>Sections &quot;<a href="#http-interface">HTTPS Interface</a>&quot; and &quot;<a href="#system-api">Canister interface (System API)</a>&quot; describe these interfaces, together with a brief description of what they do. Afterwards, you will find a <a href="#abstract-behavior">more formal description</a> of the Internet Computer that describes its abstract behavior with more rigor.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nomenclature">Nomenclature<a href="#nomenclature" class="hash-link" aria-label="Direct link to Nomenclature" title="Direct link to Nomenclature">â</a></h3><p>To get some consistency in this document, we try to use the following terms with precision:</p><p>We avoid the term &quot;client&quot;, as it could be the client of the Internet Computer or the client inside the distributed network that makes up the Internet Computer. Instead, we use the term <em>user</em> to denote the external entity interacting with the Internet Computer, even if in most cases it will be some code (sometimes called &quot;agent&quot;) acting on behalf of a (human) user.</p><p>The public entry points of canisters are called <em>methods</em>. Methods can be declared to be either <em>update methods</em> (state mutation is preserved, can call update and query methods of arbitrary canisters), <em>query methods</em> (state mutation is discarded, no further calls can be made), or <em>composite query</em> methods (state mutation is discarded, can call query and composite query methods of canisters on the same subnet).</p><p>Methods can be <em>called</em>, from <em>caller</em> to <em>callee</em>, and will eventually incur a <em>response</em> which is either a <em>reply</em> or a <em>reject</em>. A method may have <em>parameters</em>, which are provided with concrete <em>arguments</em> in a method call.</p><p>External calls can be update calls, which can <em>only</em> call update and query methods, and query calls, which can <em>only</em> call query and composite query methods. Inter-canister calls issued while evaluating an update call can call update and query methods (just like update calls). Inter-canister calls issued while evaluating a query call (to a composite query method) can call query and composite query methods (just like query calls). Note that calls from a canister to itself also count as &quot;inter-canister&quot;. Update and query call offer a security/efficiency trade-off.
Update calls are executed in <em>replicated</em> mode, i.e. execution takes place in parallel on multiple replicas who need to arrive at a consensus on what the result of the call is. Query calls are fast but offer less guarantees since they are executed in <em>non-replicated</em> mode, by a single replica.</p><p>Internally, a call or a response is transmitted as a <em>message</em> from a <em>sender</em> to a <em>receiver</em>. Messages do not have a response.</p><p>WebAssembly <em>functions</em> are exported by the WebAssembly module or provided by the System API. These are <em>invoked</em> and can either <em>trap</em> or <em>return</em>, possibly with a return value. Functions, too, have parameters and take arguments.</p><p>External <em>users</em> interact with the Internet Computer by issuing <em>requests</em> on the HTTPS interface. Requests have responses which can either be replies or rejects. Some requests cause internal messages to be created.</p><p>Canisters and users are identified by a <em>principal</em>, sometimes also called an <em>id</em>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pervasive-concepts">Pervasive concepts<a href="#pervasive-concepts" class="hash-link" aria-label="Direct link to Pervasive concepts" title="Direct link to Pervasive concepts">â</a></h2><p>Before going into the details of the four public interfaces described in this document (namely the agent-facing <a href="#http-interface">HTTPS interface</a>, the canister-facing <a href="#system-api">System API</a>, the <a href="#ic-management-canister">virtual Management canister</a> and the <a href="#state-tree">System State Tree</a>), this section introduces some concepts that transcend multiple interfaces.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="unspecified-constants-and-limits">Unspecified constants and limits<a href="#unspecified-constants-and-limits" class="hash-link" aria-label="Direct link to Unspecified constants and limits" title="Direct link to Unspecified constants and limits">â</a></h3><p>This specification may refer to certain constants and limits without specifying their concrete value (yet), i.e. they are implementation defined. Many are resource limits which are relevant only to specify the error-handling behavior of the IC (which, as mentioned above, is also not yet precisely described in this document). This list is not complete.</p><ul><li><p><code>MAX_CYCLES_PER_MESSAGE</code></p><p>Amount of cycles that a canister has to have before a message is attempted to be executed, which is deducted from the canister balance before message execution. See <a href="#rule-message-execution">Message execution</a>.</p></li><li><p><code>MAX_CYCLES_PER_RESPONSE</code></p><p>Amount of cycles that the IC sets aside when a canister performs a call. This is used to pay for processing the response message, and unused cycles after the execution of the response are refunded. See <a href="#rule-message-execution">Message execution</a>.</p></li><li><p><code>MAX_CYCLES_PER_QUERY</code></p><p>Maximum amount of cycles that can be used in total (across all calls to query and composite query methods and their callbacks) during evaluation of a query call.</p></li><li><p><code>CHUNK_STORE_SIZE</code></p><p>Maximum number of chunks that can be stored within the chunk store of a canister.</p></li><li><p><code>MAX_CHUNKS_IN_LARGE_WASM</code></p><p>Maximum number of chunks that can comprise a large Wasm module.</p></li><li><p><code>DEFAULT_PROVISIONAL_CYCLES_BALANCE</code></p><p>Amount of cycles allocated to a new canister by default, if not explicitly specified. See <a href="#ic-provisional_create_canister_with_cycles">IC method</a>.</p></li><li><p><code>MAX_CALL_DEPTH_COMPOSITE_QUERY</code></p><p>Maximum nesting level of calls during evaluation of a query call to a composite query method.</p></li><li><p><code>MAX_WALL_CLOCK_TIME_COMPOSITE_QUERY</code></p><p>Maximum wall clock time spent on evaluation of a query call.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="principal">Principals<a href="#principal" class="hash-link" aria-label="Direct link to Principals" title="Direct link to Principals">â</a></h3><p>Principals are generic identifiers for canisters, users and possibly other concepts in the future. As far as most uses of the IC are concerned they are <em>opaque</em> binary blobs with a length between 0 and 29 bytes, and there is intentionally no mechanism to tell canister ids and user ids apart.</p><p>There is, however, some structure to them to encode specific authentication and authorization behavior.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="id-classes">Special forms of Principals<a href="#id-classes" class="hash-link" aria-label="Direct link to Special forms of Principals" title="Direct link to Special forms of Principals">â</a></h4><p>In this section, <code>H</code> denotes SHA-224, <code>Â·</code> denotes blob concatenation and <code>|p|</code> denotes the length of <code>p</code> in bytes, encoded as a single byte.</p><p>There are several classes of ids:</p><ol><li><p><em>Opaque ids</em>.</p><p>These are always generated by the IC and have no structure of interest outside of it.</p></li></ol><div class="admonition_WoCw admonitionNote_L5_h"><p>Typically, these end with the byte <code>0x01</code>, but users of the IC should not need to care about that.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><ol start="2"><li><p><em>Self-authenticating ids</em>.</p><p>These have the form <code>H(public_key) Â· 0x02</code> (29 bytes).</p><p>An external user can use these ids as the <code>sender</code> of a request if they own the corresponding private key. The public key uses one of the encodings described in <a href="#signatures">Signatures</a>.</p></li><li><p><em>Derived ids</em></p><p>These have the form <code>H(|registering_principal| Â· registering_principal Â· derivation_nonce) Â· 0x03</code> (29 bytes).</p><p>These ids are treated specially when an id needs to be registered. In such a request, whoever requests an id can provide a <code>derivation_nonce</code>. By hashing that together with the principal of the caller, every principal has a space of ids that only they can register ids from.</p></li></ol><div class="admonition_WoCw admonitionNote_L5_h"><p>Derived IDs are currently not explicitly used in this document, but they may be used internally or in the future.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><ol start="4"><li><p><em>Anonymous id</em></p><p>This has the form <code>0x04</code>, and is used for the anonymous caller. It can be used in call and query requests without a signature.</p></li><li><p><em>Reserved ids</em></p><p>These have the form of <code>blob Â· 0x7f</code>, <code>0 â¤ |blob| &lt; 29</code>.</p><p>These ids can be useful for applications that want to re-use the <a href="#textual-ids">Textual representation of principals</a> but want to indicate explicitly that the blob does not address any canisters or a user.</p></li></ol><p>When the IC creates a <em>fresh</em> id, it never creates a self-authenticating id, reserved id, an anonymous id or an id derived from what could be a canister or user.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="textual-ids">Textual representation of principals<a href="#textual-ids" class="hash-link" aria-label="Direct link to Textual representation of principals" title="Direct link to Textual representation of principals">â</a></h4><p>We specify a <em>canonical textual format</em> that is recommended whenever principals need to be printed or read in textual format, e.g. in log messages, transactions browser, command line tools, source code.</p><p>The textual representation of a blob <code>b</code> is <code>Grouped(Base32(CRC32(b) Â· b))</code> where</p><ul><li><p><code>CRC32</code> is a four byte check sequence, calculated as defined by ISO 3309, ITU-T V.42, and <a href="https://www.w3.org/TR/2003/REC-PNG-20031110/#5CRC-algorithm" target="_blank" rel="noopener noreferrer">elsewhere</a>, and stored as big-endian, i.e., the most significant byte comes first and then the less significant bytes come in descending order of significance (MSB B2 B1 LSB).</p></li><li><p><code>Base32</code> is the Base32 encoding as defined in <a href="https://datatracker.ietf.org/doc/html/rfc4648#section-6" target="_blank" rel="noopener noreferrer">RFC 4648</a>, with no padding character added.</p></li><li><p>The middle dot denotes concatenation.</p></li><li><p><code>Grouped</code> takes an ASCII string and inserts the separator <code>-</code> (dash) every 5 characters. The last group may contain less than 5 characters. A separator never appears at the beginning or end.</p></li></ul><p>The textual representation is conventionally printed with <em>lower case letters</em>, but parsed case-insensitively.</p><p>Because the maximum size of a principal is 29 bytes, the textual representation will be no longer than 63 characters (10 times 5 plus 3 characters with 10 separators in between them).</p><div class="admonition_WoCw admonitionTip_gXdO"><p>The canister with id <code>0xABCD01</code> has check sequence <code>0x233FF206</code> (<a href="https://crccalc.com/?crc=ABCD01&amp;method=crc32&amp;datatype=hex&amp;outtype=hex" target="_blank" rel="noopener noreferrer">online calculator</a>); the final id is thus <code>em77e-bvlzu-aq</code>.</p><p>Example encoding from hex, and decoding to hex, in bash (the following can be pasted into a terminal as is):</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">function textual_encode() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ( echo &quot;$1&quot; | xxd -r -p | /usr/bin/crc32 /dev/stdin; echo -n &quot;$1&quot; ) |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  xxd -r -p | base32 | tr A-Z a-z |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  tr -d = | fold -w5 | paste -sd&#x27;-&#x27; -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">function textual_decode() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  echo -n &quot;$1&quot; | tr -d - | tr a-z A-Z |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  fold -w 8 | xargs -n1 printf &#x27;%-8s&#x27; | tr &#x27; &#x27; = |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  base32 -d | xxd -p | tr -d &#x27;\n&#x27; | cut -b9- | tr a-z A-Z</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#26D76D"></rect><path d="M16.666 8.49c0 2.775-2.5 4.653-2.5 6.843h-1.328c.001-1.386.664-2.55 1.312-3.675.609-1.057 1.183-2.055 1.183-3.169 0-2.072-1.679-3.156-3.336-3.156-1.655 0-3.33 1.084-3.33 3.156 0 1.114.573 2.112 1.182 3.169.648 1.125 1.31 2.29 1.311 3.675H9.833c0-2.19-2.5-4.068-2.5-6.844C7.333 5.594 9.665 4 11.997 4c2.335 0 4.67 1.596 4.67 4.49ZM14 16.332c0 .184-.15.334-.334.334h-3.333a.334.334 0 0 1 0-.667h3.333c.184 0 .334.15.334.333Zm0 1.334c0 .184-.15.333-.334.333h-3.333a.333.333 0 0 1 0-.667h3.333c.184 0 .334.15.334.334Zm-1.134 2.106a.67.67 0 0 1-.502.227h-.729a.67.67 0 0 1-.501-.227l-.968-1.106h3.667l-.967 1.106Zm-2.42-10.898-.792-.102c.173-1.33 1-2.316 2.346-2.565l.146.785c-1.298.24-1.622 1.282-1.7 1.882Z" fill="#fff"></path></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="canister-lifecycle">Canister lifecycle<a href="#canister-lifecycle" class="hash-link" aria-label="Direct link to Canister lifecycle" title="Direct link to Canister lifecycle">â</a></h3><p>Dapps on the Internet Computer are called <em>canisters</em>. Conceptually, they consist of the following pieces of state:</p><ul><li><p>A canister id (a <a href="#principal">principal</a>)</p></li><li><p>Their <em>controllers</em> (a possibly empty list of <a href="#principal">principal</a>)</p></li><li><p>A cycle balance</p></li><li><p>A reserved cycles balance, which are cycles set aside from the main cycle balance for resource payments.</p></li><li><p>The <em>canister status</em>, which is one of <code>running</code>, <code>stopping</code> or <code>stopped</code>.</p></li><li><p>Resource reservations</p></li></ul><p>A canister can be <em>empty</em> (e.g. directly after creation) or <em>non-empty</em>. A non-empty canister also has</p><ul><li><p>code, in the form of a canister module</p></li><li><p>state (memories, globals etc.)</p></li><li><p>possibly further data that is specific to the implementation of the IC (e.g. queues)</p></li></ul><p>Canisters are empty after creation and uninstallation, and become non-empty through <a href="#ic-install_code">code installation</a>.</p><p>If an empty canister receives a response, that response is dropped, as if the canister trapped when processing the response. The cycles set aside for its processing and the cycles carried on the responses are added to the canister&#x27;s <em>cycles</em> balance.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="canister-cycles">Canister cycles<a href="#canister-cycles" class="hash-link" aria-label="Direct link to Canister cycles" title="Direct link to Canister cycles">â</a></h4><p>The IC relies on <em>cycles</em>, a utility token, to manage its resources. A canister pays for the resources it uses from its <em>cycle balances</em>. A <em>cycle<!-- -->_<!-- -->balance</em> is stored as 128-bit unsigned integers and operations on them are saturating. In particular, if <em>cycles</em> are added to a canister that would bring its main cycle balance beyond 2<sup>128</sup>-1, then the balance will be capped at 2<sup>128</sup>-1 and any additional cycles will be lost.</p><p>When both the main and the reserved cycles balances of a canister fall to zero, the canister is <em>deallocated</em>. This has the same effect as</p><ul><li><p>uninstalling the canister (as described in <a href="#ic-uninstall_code">IC method</a>)</p></li><li><p>setting all resource reservations to zero</p></li></ul><p>Afterwards the canister is empty. It can be reinstalled after topping up its main balance.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>Once the IC frees the resources of a canister, its id, <em>cycle</em> balances, <em>controllers</em>, canister <em>version</em>, and the total number of canister changes are preserved on the IC for a minimum of 10 years. What happens to the canister after this period is currently unspecified.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="canister-status">Canister status<a href="#canister-status" class="hash-link" aria-label="Direct link to Canister status" title="Direct link to Canister status">â</a></h4><p>The canister status can be used to control whether the canister is processing calls:</p><ul><li><p>In status <code>running</code>, calls to the canister are processed as normal.</p></li><li><p>In status <code>stopping</code>, calls to the canister are rejected by the IC with reject code <code>CANISTER_ERROR</code> (5), but responses to the canister are processed as normal.</p></li><li><p>In status <code>stopped</code>, calls to the canister are rejected by the IC with reject code <code>CANISTER_ERROR</code> (5), and there are no outstanding responses.</p></li></ul><p>In all cases, calls to the <a href="#ic-management-canister">management canister</a> are processed, regardless of the state of the managed canister.</p><p>The controllers of the canister can initiate transitions between these states using <a href="#ic-stop_canister"><code>stop_canister</code></a> and <a href="#ic-start_canister"><code>start_canister</code></a>, and query the state using <a href="#ic-canister_status"><code>canister_status</code></a> (NB: this call returns additional information, such as the cycle balance of the canister). The canister itself can also query its state using <a href="#system-api-canister-status"><code>ic0.canister_status</code></a>.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>This status is orthogonal to whether a canister is empty or not: an empty canister can be in status <code>running</code>. Calls to such a canister are still rejected by the IC, but because the canister is empty.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><div class="admonition_WoCw admonitionNote_L5_h"><p>This status is orthogonal to whether a canister is frozen or not: a frozen canister can be in status <code>running</code>. Calls to such a canister are still rejected by the IC, but because the canister is frozen, the returned reject code is <code>SYS_TRANSIENT</code>.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="signatures">Signatures<a href="#signatures" class="hash-link" aria-label="Direct link to Signatures" title="Direct link to Signatures">â</a></h3><p>Digital signature schemes are used for authenticating messages in various parts of the IC infrastructure. Signatures are domain separated, which means that every message is prefixed with a byte string that is unique to the purpose of the signature.</p><p>The IC supports multiple signature schemes, with details given in the following subsections. For each scheme, we specify the data encoded in the public key (which is always DER-encoded, and indicates the scheme to use) as well as the form of the signatures (which are opaque blobs for the purposes of the rest of this specification).</p><p>In all cases, the signed <em>payload</em> is the concatenation of the domain separator and the message. All uses of signatures in this specification indicate a domain separator, to uniquely identify the purpose of the signature. The domain separators are prefix-free by construction, as their first byte indicates their length.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ecdsa">Ed25519 and ECDSA signatures<a href="#ecdsa" class="hash-link" aria-label="Direct link to Ed25519 and ECDSA signatures" title="Direct link to Ed25519 and ECDSA signatures">â</a></h4><p>Plain signatures are supported for the schemes</p><ul><li><p><a href="https://ed25519.cr.yp.to/index.html" target="_blank" rel="noopener noreferrer"><strong>Ed25519</strong></a> or</p></li><li><p><a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-4.pdf" target="_blank" rel="noopener noreferrer"><strong>ECDSA</strong></a> on curve P-256 (also known as <code>secp256r1</code>), using SHA-256 as hash function, as well as on the Koblitz curve <code>secp256k1</code>.</p></li><li><p>Public keys must be valid for signature schemes Ed25519 or ECDSA and are encoded as DER.</p><ul><li><p>See <a href="https://datatracker.ietf.org/doc/html/rfc8410" target="_blank" rel="noopener noreferrer">RFC 8410</a> for DER encoding of Ed25519 public keys.</p></li><li><p>See <a href="https://datatracker.ietf.org/doc/html/rfc5480" target="_blank" rel="noopener noreferrer">RFC 5480</a> for DER encoding of ECDSA public keys; the DER encoding must not specify a hash function. For curve <code>secp256k1</code>, the OID 1.3.132.0.10 is used. The points must be specified in uncompressed form (i.e. <code>0x04</code> followed by the big-endian 32-byte encodings of <code>x</code> and <code>y</code>).</p></li></ul></li><li><p>The signatures are encoded as the concatenation of the 32-byte big endian encodings of the two values <em>r</em> and <em>s</em>.</p></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="webauthn">Web Authentication<a href="#webauthn" class="hash-link" aria-label="Direct link to Web Authentication" title="Direct link to Web Authentication">â</a></h4><p>The allowed signature schemes for web authentication are</p><ul><li><p><a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-4.pdf" target="_blank" rel="noopener noreferrer"><strong>ECDSA</strong></a> on curve P-256 (also known as <code>secp256r1</code>), using SHA-256 as hash function.</p></li><li><p><a href="https://datatracker.ietf.org/doc/html/rfc8017#section-8.2" target="_blank" rel="noopener noreferrer"><strong>RSA PKCS<!-- -->#<!-- -->1v1.5 (RSASSA-PKCS1-v1<!-- -->_<!-- -->5)</strong></a>, using SHA-256 as hash function.</p></li></ul><p>The signature is calculated by using the payload as the challenge in the web authentication assertion.</p><p>The signature is checked by verifying that the <code>challenge</code> field contains the <a href="https://datatracker.ietf.org/doc/html/rfc4648#section-5" target="_blank" rel="noopener noreferrer">base64url encoding</a> of the payload, and that <code>signature</code> verifies on <code>authenticatorData Â· SHA-256(utf8(clientDataJSON))</code>, as specified in the <a href="https://www.w3.org/TR/webauthn/#op-get-assertion" target="_blank" rel="noopener noreferrer">WebAuthn w3c recommendation</a>.</p><ul><li><p>The public key is encoded as a DER-wrapped COSE key.</p><p>It uses the <code>SubjectPublicKeyInfo</code> type used for other types of public keys (see, e.g., <a href="https://datatracker.ietf.org/doc/html/rfc8410#section-4" target="_blank" rel="noopener noreferrer">RFC 8410, Section 4</a>), with OID 1.3.6.1.4.1.56387.1.1 (iso.org.dod.internet.private.enterprise.dfinity.mechanisms.der-wrapped-cose). The <code>BIT STRING</code> field <code>subjectPublicKey</code> contains the COSE encoding. See <a href="https://www.w3.org/TR/webauthn/#sctn-encoded-credPubKey-examples" target="_blank" rel="noopener noreferrer">WebAuthn w3c recommendation</a> or <a href="https://datatracker.ietf.org/doc/html/rfc8152#section-13.1" target="_blank" rel="noopener noreferrer">RFC 8152</a> for details on the COSE encoding.</p></li></ul><div class="admonition_WoCw admonitionTip_gXdO"><p>A DER wrapping of a COSE key is shown below. It can be parsed via the command <code>sed &quot;s/#.*//&quot; | xxd -r -p | openssl asn1parse -inform der</code>.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">30 5E                                       # SEQUENCE of length 94 bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  30 0C                                     # SEQUENCE of length 12 bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    06 0A 2B 06 01 04 01 83 B8 43 01 01     # OID 1.3.6.1.4.1.56387.1.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  03 4E 00                                  # BIT STRING encoding of length 78,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    A501 0203 2620 0121 5820 7FFD 8363 2072 #    length is at byte boundary</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    FD1B FEAF 3FBA A431 46E0 EF95 C3F5 5E39 #    contents is a valid COSE key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    94A4 1BBF 2B51 74D7 71DA 2258 2032 497E #    with ECDSA on curve P-256</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ED0A 7F6F 0009 2876 5B83 1816 2CFD 80A9</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    4E52 5A6A 368C 2363 063D 04E6 ED</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>You can also view the wrapping in <a href="https://lapo.it/asn1js/#MF4wDAYKKwYBBAGDuEMBAQNOAKUBAgMmIAEhWCB__YNjIHL9G_6vP7qkMUbg75XD9V45lKQbvytRdNdx2iJYIDJJfu0Kf28ACSh2W4MYFiz9gKlOUlpqNowjYwY9BObt" target="_blank" rel="noopener noreferrer">an online ASN.1 JavaScript decoder</a>.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#26D76D"></rect><path d="M16.666 8.49c0 2.775-2.5 4.653-2.5 6.843h-1.328c.001-1.386.664-2.55 1.312-3.675.609-1.057 1.183-2.055 1.183-3.169 0-2.072-1.679-3.156-3.336-3.156-1.655 0-3.33 1.084-3.33 3.156 0 1.114.573 2.112 1.182 3.169.648 1.125 1.31 2.29 1.311 3.675H9.833c0-2.19-2.5-4.068-2.5-6.844C7.333 5.594 9.665 4 11.997 4c2.335 0 4.67 1.596 4.67 4.49ZM14 16.332c0 .184-.15.334-.334.334h-3.333a.334.334 0 0 1 0-.667h3.333c.184 0 .334.15.334.333Zm0 1.334c0 .184-.15.333-.334.333h-3.333a.333.333 0 0 1 0-.667h3.333c.184 0 .334.15.334.334Zm-1.134 2.106a.67.67 0 0 1-.502.227h-.729a.67.67 0 0 1-.501-.227l-.968-1.106h3.667l-.967 1.106Zm-2.42-10.898-.792-.102c.173-1.33 1-2.316 2.346-2.565l.146.785c-1.298.24-1.622 1.282-1.7 1.882Z" fill="#fff"></path></svg></div><ul><li><p>The signature is a CBOR (see <a href="#cbor">CBOR</a>) value consisting of a data item with major type 6 (&quot;Semantic tag&quot;) and tag value <code>55799</code>, followed by a map with three mandatory fields:</p><ul><li><p><code>authenticator_data</code> (<code>blob</code>): WebAuthn authenticator data.</p></li><li><p><code>client_data_json</code> (<code>text</code>): WebAuthn client data in JSON representation.</p></li><li><p><code>signature</code> (<code>blob</code>): Signature as specified in the <a href="https://www.w3.org/TR/webauthn/#signature-attestation-types" target="_blank" rel="noopener noreferrer">WebAuthn w3c recommendation</a>, which means DER encoding in the case of an ECDSA signature.</p></li></ul></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="canister-signatures">Canister signatures<a href="#canister-signatures" class="hash-link" aria-label="Direct link to Canister signatures" title="Direct link to Canister signatures">â</a></h4><p>The IC also supports a scheme where a canister can sign a payload by declaring a special &quot;certified variable&quot;.</p><p>This section makes forward references to other concepts in this document, in particular the section <a href="#certification">Certification</a>.</p><ul><li><p>The public key is a DER-wrapped structure that indicates the <em>signing canister</em>, and includes a freely choosable seed. Each choice of seed yields a distinct public key for the canister, and the canister can choose to encode information, such as a user id, in the seed.</p><p>More concretely, it uses the <code>SubjectPublicKeyInfo</code> type used for other types of public keys (see, e.g., <a href="https://datatracker.ietf.org/doc/html/rfc8410#section-4" target="_blank" rel="noopener noreferrer">RFC 8410, Section 4</a>), with OID 1.3.6.1.4.1.56387.1.2 (iso.org.dod.internet.private.enterprise.dfinity.mechanisms.canister-signature).</p><p>The <code>BIT STRING</code> field <code>subjectPublicKey</code> is the blob <code>|signing_canister_id| Â· signing_canister_id Â· seed</code>, where <code>|signing_canister_id|</code> is the one-byte encoding of the the length of the <code>signing_canister_id</code> and <code>Â·</code> denotes blob concatenation.</p></li><li><p>The signature is a CBOR (see <a href="#cbor">CBOR</a>) value consisting of a data item with major type 6 (&quot;Semantic tag&quot;) and tag value <code>55799</code>, followed by a map with two mandatory fields:</p><ul><li><p><code>certificate</code> (<code>blob</code>): A CBOR-encoded certificate as per <a href="#certification-encoding">Encoding of certificates</a>.</p></li><li><p><code>tree</code> (<code>hash-tree</code>): A hash tree as per <a href="#certification-encoding">Encoding of certificates</a>.</p></li></ul></li><li><p>Given a payload together with public key and signature in the format described above the signature can be verified by checking the following two conditions:</p><ul><li>The <code>certificate</code> must be a valid certificate as described in <a href="#certification">Certification</a>, with<div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([&quot;canister&quot;, &lt;signing_canister_id&gt;, &quot;certified_data&quot;], certificate.tree) = Found (reconstruct(tree))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li></ul><p>where <code>signing_canister_id</code> is the id of the signing canister and <code>reconstruct</code> is a function that computes a root-hash for the tree.</p><ul><li><p>If the <code>certificate</code> includes a subnet delegation, then the <code>signing_canister_id</code> must be included in the delegation&#x27;s canister id range (see <a href="#certification-delegation">Delegation</a>).</p></li><li><p>The <code>tree</code> must be a <code>well_formed</code> tree with</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([&quot;sig&quot;, &lt;s&gt;, &lt;m&gt;], tree) = Found &quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li></ul><p>where <code>s</code> is the SHA-256 hash of the <code>seed</code> used in the public key and <code>m</code> is the SHA-256 hash of the payload.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="supplementary-technologies">Supplementary Technologies<a href="#supplementary-technologies" class="hash-link" aria-label="Direct link to Supplementary Technologies" title="Direct link to Supplementary Technologies">â</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cbor">CBOR<a href="#cbor" class="hash-link" aria-label="Direct link to CBOR" title="Direct link to CBOR">â</a></h4><p><a href="https://www.rfc-editor.org/rfc/rfc8949" target="_blank" rel="noopener noreferrer">Concise Binary Object Representation (CBOR)</a> is a data format with a small code footprint, small message size and an extensible interface. CBOR is used extensively throughout the Internet Computer as the primary format for data exchange between components within the system.</p><p><a href="https://cbor.io" target="_blank" rel="noopener noreferrer">cbor.io</a> and <a href="https://en.wikipedia.org/wiki/CBOR" target="_blank" rel="noopener noreferrer">wikipedia.org</a> contain a lot of helpful background information and relevant tools. <a href="https://cbor.me" target="_blank" rel="noopener noreferrer">cbor.me</a> in particular, is very helpful for converting between CBOR hex and diagnostic information.</p><p>For example, the following CBOR hex:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">82 61 61 a1 61 62 61 63</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Can be converted into the following CBOR diagnostic format:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[&quot;a&quot;, {&quot;b&quot;: &quot;c&quot;}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Particular concepts to note from the spec are:</p><ul><li><p><a href="https://www.rfc-editor.org/rfc/rfc8949#name-specification-of-the-cbor-e" target="_blank" rel="noopener noreferrer">Specification of the CBOR Encoding</a></p></li><li><p><a href="https://www.rfc-editor.org/rfc/rfc8949#name-major-types" target="_blank" rel="noopener noreferrer">CBOR Major Types</a></p></li><li><p><a href="https://www.rfc-editor.org/rfc/rfc8949#self-describe" target="_blank" rel="noopener noreferrer">CBOR Self-Describe</a></p></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cddl">CDDL<a href="#cddl" class="hash-link" aria-label="Direct link to CDDL" title="Direct link to CDDL">â</a></h4><p>The <a href="https://datatracker.ietf.org/doc/html/rfc8610" target="_blank" rel="noopener noreferrer">Concise Data Definition Language (CDDL)</a> is a data description language for CBOR. It is used at various points throughout this document to describe how certain data structures are encoded with CBOR.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="state-tree">The system state tree<a href="#state-tree" class="hash-link" aria-label="Direct link to The system state tree" title="Direct link to The system state tree">â</a></h2><p>Parts of the IC state are publicly exposed (e.g. via <a href="#http-read-state">Request: Read state</a> or <a href="#system-api-certified-data">Certified data</a>) in a verified way (see <a href="#certification">Certification</a> for the machinery for certifying). This section describes the content of this system state abstractly.</p><p>Conceptually, the system state is a tree with labeled children, and values in the leaves. Equivalently, the system state is a mapping from paths (sequences of labels) to values, where the domain is prefix-free.</p><p>Labels are always blobs (but often with a human readable representation). In this document, paths are written suggestively with slashes as separators; the actual encoding is not actually using slashes as delimiters, and labels may contain the 0x2F byte (ASCII <code>/</code>) just fine. Values are either natural numbers, text values or blob values.</p><p>This section specifies the publicly relevant paths in the tree.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="state-tree-time">Time<a href="#state-tree-time" class="hash-link" aria-label="Direct link to Time" title="Direct link to Time">â</a></h3><ul><li><p><code>/time</code> (natural):</p><p>All partial state trees include a timestamp, expressed in nanoseconds since 1970-01-01, indicating the time at which the state is current.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="state-tree-api-bn">Api boundary nodes information<a href="#state-tree-api-bn" class="hash-link" aria-label="Direct link to Api boundary nodes information" title="Direct link to Api boundary nodes information">â</a></h3><p>The state tree contains information about all API boundary nodes (the source of truth for these API boundary node records is stored in the NNS registry canister).</p><ul><li><p><code>/api_boundary_nodes/&lt;node_id&gt;/domain</code> (text)</p><p>  Domain name associated with a node. All domains are unique across nodes.
Example: <code>api-bn1.example.com</code>.</p></li><li><p><code>/api_boundary_nodes/&lt;node_id&gt;/ipv4_address</code> (text)</p><p>  Public IPv4 address of a node in the dotted-decimal notation.
If no <code>ipv4_address</code> is available for the corresponding node, then this path does not exist.<br>
<!-- -->Example: <code>192.168.10.150</code>.</p></li><li><p><code>/api_boundary_nodes/&lt;node_id&gt;/ipv6_address</code> (text)</p><p>  Public IPv6 address of a node in the hexadecimal notation with colons.
Example: <code>3002:0bd6:0000:0000:0000:ee00:0033:6778</code>.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="state-tree-subnet">Subnet information<a href="#state-tree-subnet" class="hash-link" aria-label="Direct link to Subnet information" title="Direct link to Subnet information">â</a></h3><p>The state tree contains information about the topology of the Internet Computer.</p><ul><li><p><code>/subnet/&lt;subnet_id&gt;/public_key</code> (blob)</p><p>The public key of the subnet (a DER-encoded BLS key, see <a href="#certification">Certification</a>)</p></li><li><p><code>/subnet/&lt;subnet_id&gt;/canister_ranges</code> (blob)</p><p>The set of canister ids assigned to this subnet, represented as a list of closed intervals of canister ids, ordered lexicographically, and encoded as CBOR (see <a href="#cbor">CBOR</a>) according to this CDDL (see <a href="#cddl">CDDL</a>):</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">canister_ranges = tagged&lt;[*canister_range]&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">canister_range = [principal principal]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">principal = bytes .size (0..29)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tagged&lt;t&gt; = #6.55799(t) ; the CBOR tag</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li><li><p><code>/subnet/&lt;subnet_id&gt;/metrics</code> (blob)</p><p> A collection of subnet-wide metrics related to this subnet&#x27;s current resource usage and/or performance. The metrics are a CBOR map with the following fields:</p><ul><li><code>num_canisters</code> (<code>nat</code>): The number of canisters on this subnet.</li><li><code>canister_state_bytes</code> (<code>nat</code>): The total size of the state in bytes taken by canisters on this subnet since this subnet was created.</li><li><code>consumed_cycles_total</code> (<code>map</code>): The total number of cycles consumed by all current and deleted canisters on this subnet. It&#x27;s a map of two values, a low part of type <code>nat</code> and a high part of type <code>opt nat</code>.</li><li><code>update_transactions_total</code> (<code>nat</code>): The total number of transactions processed on this subnet since this subnet was created.</li></ul></li></ul><div class="admonition_WoCw admonitionNote_L5_h"><p>Because this uses the lexicographic ordering of princpials, and the byte distinguishing the various classes of ids is at the <em>end</em>, this range by construction conceptually includes principals of various classes. This specification needs to take care that the fact that principals that are not canisters may appear in these ranges does not cause confusion.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><ul><li><p><code>/subnet/&lt;subnet_id&gt;/node/&lt;node_id&gt;/public_key</code> (blob)</p><p>The public key of a node (a DER-encoded Ed25519 signing key, see <a href="https://tools.ietf.org/html/rfc8410" target="_blank" rel="noopener noreferrer">RFC 8410</a> for reference) with principal <code>&lt;node_id&gt;</code> belonging to the subnet with principal <code>&lt;subnet_id&gt;</code>.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="state-tree-request-status">Request status<a href="#state-tree-request-status" class="hash-link" aria-label="Direct link to Request status" title="Direct link to Request status">â</a></h3><p>For each update call request known to the Internet Computer, its status is in a subtree at <code>/request_status/&lt;request_id&gt;</code>. Please see <a href="#http-call-overview">Overview of canister calling</a> for more details on how update call requests work.</p><ul><li><p><code>/request_status/&lt;request_id&gt;/status</code> (text)</p><p>One of <code>received</code>, <code>processing</code>, <code>replied</code>, <code>rejected</code> or <code>done</code>, see <a href="#http-call-overview">Overview of canister calling</a> for more details on what each status means.</p></li><li><p><code>/request_status/&lt;request_id&gt;/reply</code> (blob)</p><p>If the status is <code>replied</code>, then this path contains the reply blob, else it is not present.</p></li><li><p><code>/request_status/&lt;request_id&gt;/reject_code</code> (natural)</p><p>If the status is <code>rejected</code>, then this path contains the reject code (see <a href="#reject-codes">Reject codes</a>), else it is not present.</p></li><li><p><code>/request_status/&lt;request_id&gt;/reject_message</code> (text)</p><p>If the status is <code>rejected</code>, then this path contains a textual diagnostic message, else it is not present.</p></li><li><p><code>/request_status/&lt;request_id&gt;/error_code</code> (text)</p><p>If the status is <code>rejected</code>, then this path might be present and contain an implementation-specific error code (see <a href="#error-codes">Error codes</a>), else it is not present.</p></li></ul><div class="admonition_WoCw admonitionNote_L5_h"><p>Immediately after submitting a request, the request may not show up yet as the Internet Computer is still working on accepting the request as pending.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><div class="admonition_WoCw admonitionNote_L5_h"><p>Request statuses will not actually be kept around indefinitely, and eventually the Internet Computer forgets about the request. This will happen no sooner than the request&#x27;s expiry time, so that replay attacks are prevented.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="state-tree-certified-data">Certified data<a href="#state-tree-certified-data" class="hash-link" aria-label="Direct link to Certified data" title="Direct link to Certified data">â</a></h3><ul><li><p><code>/canister/&lt;canister_id&gt;/certified_data</code> (blob):</p><p>The certified data of the canister with the given id, see <a href="#system-api-certified-data">Certified data</a>.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="state-tree-canister-information">Canister information<a href="#state-tree-canister-information" class="hash-link" aria-label="Direct link to Canister information" title="Direct link to Canister information">â</a></h3><p>Users have the ability to learn about the hash of the canister&#x27;s module, its current controllers, and metadata in a certified way.</p><ul><li><p><code>/canister/&lt;canister_id&gt;/module_hash</code> (blob):</p><p>If the canister is empty, this path does not exist. If the canister is not empty, it exists and contains the SHA256 hash of the currently installed canister module. Cf. <a href="#ic-canister_status">IC method</a>.</p></li><li><p><code>/canister/&lt;canister_id&gt;/controllers</code> (blob):</p><p>The current controllers of the canister. The value consists of a CBOR (see <a href="#cbor">CBOR</a>) data item with major type 6 (&quot;Semantic tag&quot;) and tag value <code>55799</code>, followed by an array of principals in their binary form (CDDL <code>#6.55799([* bytes .size (0..29)])</code>, see <a href="#cddl">CDDL</a>).</p></li><li><p><code>/canister/&lt;canister_id&gt;/metadata/&lt;name&gt;</code> (blob):</p><p>If the canister has a <a href="https://webassembly.github.io/spec/core/binary/modules.html#custom-section" target="_blank" rel="noopener noreferrer">custom section</a> called <code>icp:public &lt;name&gt;</code> or <code>icp:private &lt;name&gt;</code>, this path contains the content of the custom section. Otherwise, this path does not exist.</p><p>It is recommended for the canister to have a custom section called &quot;icp:public candid:service&quot;, which contains the UTF-8 encoding of <a href="https://github.com/dfinity/candid/blob/master/spec/Candid.md#core-grammar" target="_blank" rel="noopener noreferrer">the Candid interface</a> for the canister.</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-interface">HTTPS Interface<a href="#http-interface" class="hash-link" aria-label="Direct link to HTTPS Interface" title="Direct link to HTTPS Interface">â</a></h2><p>The concrete mechanism that users use to send requests to the Internet Computer is via an HTTPS API, which exposes four endpoints to handle interactions, plus one for diagnostics:</p><ul><li><p>At <code>/api/v2/canister/&lt;effective_canister_id&gt;/call</code> the user can submit update calls that are asynchronous and might change the IC state.</p></li><li><p>At <code>/api/v3/canister/&lt;effective_canister_id&gt;/call</code> the user can submit update calls and get a synchronous HTTPS response with a certificate for the call status.</p></li><li><p>At <code>/api/v2/canister/&lt;effective_canister_id&gt;/read_state</code> or <code>/api/v2/subnet/&lt;subnet_id&gt;/read_state</code> the user can read various information about the state of the Internet Computer. In particular, they can poll for the status of a call here.</p></li><li><p>At <code>/api/v2/canister/&lt;effective_canister_id&gt;/query</code> the user can perform (synchronous, non-state-changing) query calls.</p></li><li><p>At <code>/api/v2/status</code> the user can retrieve status information about the Internet Computer.</p></li></ul><p>In these paths, the <code>&lt;effective_canister_id&gt;</code> is the <a href="#textual-ids">textual representation</a> of the <a href="#http-effective-canister-id"><em>effective</em> canister id</a>.</p><p>Requests to <code>/api/v2/canister/&lt;effective_canister_id&gt;/call</code>, <code>/api/v3/canister/&lt;effective_canister_id&gt;/call</code>, <code>/api/v2/canister/&lt;effective_canister_id&gt;/read_state</code>, <code>/api/v2/subnet/&lt;subnet_id&gt;/read_state</code>, and <code>/api/v2/canister/&lt;effective_canister_id&gt;/query</code> are POST requests with a CBOR-encoded request body, which consists of a authentication envelope (as per <a href="#authentication">Authentication</a>) and request-specific content as described below.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>This document does not yet explain how to find the location and port of the Internet Computer.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-call-overview">Overview of canister calling<a href="#http-call-overview" class="hash-link" aria-label="Direct link to Overview of canister calling" title="Direct link to Overview of canister calling">â</a></h3><p>Users interact with the Internet Computer by calling canisters. By the very nature of a blockchain protocol, they cannot be acted upon immediately, but only with a delay. Moreover, the actual node that the user talks to may not be honest or, for other reasons, may fail to get the request on the way.</p><p>The Internet Computer has two HTTPS APIs for canister calling:</p><ul><li><a href="#http-async-call-overview"><em>Asynchronous</em></a> canister calling, where the user must poll the Internet Computer for the status of the canister call by <em>separate</em> HTTPS requests.</li><li><a href="#http-sync-call-overview"><em>Synchronous</em></a> canister calling, where the status of the canister call is in the response of the original HTTPS request.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-async-call-overview">Asynchronous canister calling<a href="#http-async-call-overview" class="hash-link" aria-label="Direct link to Asynchronous canister calling" title="Direct link to Asynchronous canister calling">â</a></h4><ol><li><p>A user submits a call via the <a href="#http-interface">HTTPS Interface</a>. No useful information is returned in the immediate response (as such information cannot be trustworthy anyways).</p></li><li><p>For a certain amount of time, the IC behaves as if it does not know about the call.</p></li><li><p>The IC asks the targeted canister if it is willing to accept this message and be charged for the expense of processing it. This uses the <a href="#system-api-inspect-message">Ingress message inspection</a> API for normal calls. For calls to the management canister, the rules in <a href="#ic-management-canister">The IC management canister</a> apply.</p></li><li><p>At some point, the IC may accept the call for processing and set its status to <code>received</code>. This indicates that the IC as a whole has received the call and plans on processing it (although it may still not get processed if the IC is under high load). Furthermore, the user should also be able to ask any endpoint about the status of the pending call.</p></li><li><p>Once it is clear that the call will be acted upon (sufficient resources, call not yet expired), the status changes to <code>processing</code>. Now the user has the guarantee that the request will have an effect, e.g. it will reach the target canister.</p></li><li><p>The IC is processing the call. For some calls this may be atomic, for others this involves multiple internal steps.</p></li><li><p>Eventually, a response will be produced, and can be retrieved for a certain amount of time. The response is either a <code>reply</code>, indicating success, or a <code>reject</code>, indicating some form of error.</p></li><li><p>In the case that the call has been retained for long enough, but the request has not expired yet, the IC can forget the response data and only remember the call as <code>done</code>, to prevent a replay attack.</p></li><li><p>Once the expiry time is past, the IC can prune the call and its response, and completely forget about it.</p></li></ol><p>This yields the following interaction diagram:</p><img loading="lazy" src="https://www.plantuml.com/plantuml/png/XP11YW8n44Ntdk8JDzq33U81PkKDXW4NRjhagndQIaX5nTkBQMUqXu2ro-VzbwG0eFbeqNMVCD_A19lOPofiFmm6yrMP6SOfsDTfU_Gvqo47I73SI7Fn-O3bOeb4ZK6KhK6lq89MBOcM_and9cbCmLBLotxC_GwccDR81yfi8eY3V_PBveBmD-2WdF8_jFTNDxONhvcfhNGVYLaRe5hMgsOU_whFVxm1NwPotJzBJ2Uv7wQBC-Cw7unB8SOALCHrJK4epkzk" class="img_ev3q"><p>State transitions may be instantaneous and not always externally visible. For example, the state of a request may move from <code>received</code> via <code>processing</code> to <code>replied</code> in one go. Similarly, the IC may not implement the <code>done</code> state at all, and keep calls in state <code>replied</code>/<code>rejected</code> until they are pruned.</p><p>All gray states are <em>not</em> explicitly represented in the state of the IC, and are indistinguishable from &quot;call does not exist&quot;.</p><p>The characteristic property of the <code>received</code> state is that the call has made it past the (potentially malicious) endpoint <em>into the state of the IC</em>. It is now pointless (but harmless) to submit the (identical) call again. Before reaching that state, submitting the identical call to further nodes might be a useful safeguard against a malicious or misbehaving node.</p><p>The characteristic property of the <code>processing</code> state is that <em>the initial effect of the call has happened or will happen</em>. This is best explained by an example: Consider a counter canister. It exports a method <code>inc</code> that increases the counter. Assume that the canister is bug free, and is not going to be forcibly removed. A user submits a call to call <code>inc</code>. If the user sees request status <code>processing</code>, the state change is guaranteed to happen. The user can stop monitoring the status and does not have to retry submitting.</p><p>A call may be rejected by the IC or the canister. In either case, there is no guarantee about how much processing of the call has happened.</p><p>To avoid replay attacks, the transition from <code>done</code> or <code>received</code> to <code>pruned</code> must happen no earlier than the call&#x27;s <code>ingress_expiry</code> field.</p><p>Calls must stay in <code>replied</code> or <code>rejected</code> long enough for polling users to catch the response.</p><p>When asking the IC about the state or call of a request, the user uses the request id (see <a href="#request-id">Request ids</a>) to read the request status (see <a href="#state-tree-request-status">Request status</a>) from the state tree (see <a href="#http-read-state">Request: Read state</a>).</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-sync-call-overview">Synchronous canister calling<a href="#http-sync-call-overview" class="hash-link" aria-label="Direct link to Synchronous canister calling" title="Direct link to Synchronous canister calling">â</a></h4><p>A synchronous update call, also known as a &quot;call and await&quot;, is a type of update call where the replica will attempt to respond to the HTTPS request with a certificate of the call status. If the returned certificate indicates that the update call is in a terminal state (<code>replied</code>, <code>rejected</code>, or <code>done</code>), then the user <strong>does not need to poll</strong> (using <a href="#http-read-state"><code>read_state</code></a> requests) to determine the result of the call. A terminal state means the call has completed its execution.</p><p>The synchronous call endpoint is useful for users as it removes the networking overhead of polling the IC to determine the status of their call.</p><p>The replica will maintain the HTTPS connection for the request and will respond once the call status transitions to a terminal state. </p><p>If an implementation specific timeout for the request is reached while the replica waits for the terminal state, then the replica will reply with an empty body and a 202 HTTP status code. In such cases, the user should use <a href="#http-read-state"><code>read_state</code></a> to determine the status of the call.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-call">Request: Call<a href="#http-call" class="hash-link" aria-label="Direct link to Request: Call" title="Direct link to Request: Call">â</a></h3><p>In order to call a canister, the user makes a POST request to <code>/api/v3/canister/&lt;effective_canister_id&gt;/call</code>. The request body consists of an authentication envelope with a <code>content</code> map with the following fields:</p><ul><li><p><code>request_type</code> (<code>text</code>): Always <code>call</code></p></li><li><p><code>sender</code>, <code>nonce</code>, <code>ingress_expiry</code>: See <a href="#authentication">Authentication</a></p></li><li><p><code>canister_id</code> (<code>blob</code>): The principal of the canister to call.</p></li><li><p><code>method_name</code> (<code>text</code>): Name of the canister method to call.</p></li><li><p><code>arg</code> (<code>blob</code>): Argument to pass to the canister method.</p></li></ul><p>The HTTP response to this request can have the following forms:</p><ul><li><p>200 HTTP status with a non-empty body. This status is returned if the canister call completed within an implementation-specific timeout or was rejected within an implementation-specific timeout.</p><ul><li><p>If the update call completed, a certificate for the state of the update call is produced, and returned in a CBOR (see <a href="#cbor">CBOR</a>) map with the fields specified below:</p><ul><li><p><code>status</code> (<code>text</code>): <code>&quot;replied&quot;</code></p></li><li><p><code>certificate</code> (<code>blob</code>):  A certificate (see <a href="#certification">Certification</a>) with subtrees at <code>/request_status/&lt;request_id&gt;</code> and <code>/time</code>, where <code>&lt;request_id&gt;</code> is the <a href="#request-id">request ID</a> of the update call. See <a href="#state-tree-request-status">Request status</a> for more details on the request status.</p></li></ul></li><li><p>If a non-replicated pre-processing error occurred (e.g., due to the <a href="#system-api-inspect-message">canister inspect message</a>), then a body with information about the IC specific error encountered is returned. The body is a CBOR map with the following fields:</p><ul><li><p><code>status</code> (<code>text</code>): <code>&quot;non_replicated_rejection&quot;</code></p></li><li><p><code>reject_code</code> (<code>nat</code>): The reject code (see <a href="#reject-codes">Reject codes</a>).</p></li><li><p><code>reject_message</code> (<code>text</code>): a textual diagnostic message.</p></li><li><p><code>error_code</code> (<code>text</code>): an optional implementation-specific textual error code (see <a href="#error-codes">Error codes</a>).</p></li></ul></li></ul></li><li><p>202 HTTP status with an empty body. This status is returned if an implementation-specific timeout is reached before the canister call completes. Users should use <a href="#http-read-state"><code>read_state</code></a> to determine the status of the call.</p></li><li><p>4xx HTTP status for client errors (e.g. malformed request). Except for 429 HTTP status, retrying the request will likely have the same outcome.</p></li><li><p>5xx HTTP status when the server has encountered an error or is otherwise incapable of performing the request. The request might succeed if retried at a later time.</p></li></ul><p>This request type can <em>also</em> be used to call a query method (but not a composite query method). A user may choose to go this way, instead of via the faster and cheaper <a href="#http-query">Request: Query call</a> below, if they want to get a <em>certified</em> response. Note that the canister state will not be changed by sending a call request type for a query method (except for cycle balance change due to message execution).</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-async-call">Request: Asynchronous Call<a href="#http-async-call" class="hash-link" aria-label="Direct link to Request: Asynchronous Call" title="Direct link to Request: Asynchronous Call">â</a></h3><p>In order to call a canister, the user makes a POST request to <code>/api/v2/canister/&lt;effective_canister_id&gt;/call</code>. The request body consists of an authentication envelope with a <code>content</code> map with the following fields:</p><ul><li><p><code>request_type</code> (<code>text</code>): Always <code>call</code></p></li><li><p><code>sender</code>, <code>nonce</code>, <code>ingress_expiry</code>: See <a href="#authentication">Authentication</a></p></li><li><p><code>canister_id</code> (<code>blob</code>): The principal of the canister to call.</p></li><li><p><code>method_name</code> (<code>text</code>): Name of the canister method to call</p></li><li><p><code>arg</code> (<code>blob</code>): Argument to pass to the canister method</p></li></ul><p>The HTTP response to this request can have the following responses:</p><ul><li><p>202 HTTP status with empty body. Implying the request was accepted by the IC for further processing. Users should use <a href="#http-read-state"><code>read_state</code></a> to determine the status of the call.</p></li><li><p>200 HTTP status with non-empty body. Implying an execution pre-processing error occurred. The body of the response contains more information about the IC specific error encountered. The body is a CBOR map with the following fields:</p><ul><li><p><code>reject_code</code> (<code>nat</code>): The reject code (see <a href="#reject-codes">Reject codes</a>).</p></li><li><p><code>reject_message</code> (<code>text</code>): a textual diagnostic message.</p></li><li><p><code>error_code</code> (<code>text</code>): an optional implementation-specific textual error code (see <a href="#error-codes">Error codes</a>).</p></li></ul></li><li><p>4xx HTTP status for client errors (e.g. malformed request). Except for 429 HTTP status, retrying the request will likely have the same outcome.</p></li><li><p>5xx HTTP status when the server has encountered an error or is otherwise incapable of performing the request. The request might succeed if retried at a later time.</p></li></ul><p>This request type can <em>also</em> be used to call a query method (but not a composite query method). A user may choose to go this way, instead of via the faster and cheaper <a href="#http-query">Request: Query call</a> below, if they want to get a <em>certified</em> response. Note that the canister state will not be changed by sending a call request type for a query method (except for cycle balance change due to message execution).</p><div class="admonition_WoCw admonitionNote_L5_h"><p>The functionality exposed via the <a href="#ic-management-canister">The IC management canister</a> can be used this way.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-read-state">Request: Read state<a href="#http-read-state" class="hash-link" aria-label="Direct link to Request: Read state" title="Direct link to Request: Read state">â</a></h3><div class="admonition_WoCw admonitionNote_L5_h"><p>Requesting paths with the prefix <code>/subnet</code> at <code>/api/v2/canister/&lt;effective_canister_id&gt;/read_state</code> might be deprecated in the future. Hence, users might want to point their requests for paths with the prefix <code>/subnet</code> to <code>/api/v2/subnet/&lt;subnet_id&gt;/read_state</code>.</p><p>On the IC mainnet, the root subnet ID <code>tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe</code> can be used to retrieve the list of all IC mainnet&#x27;s subnets by requesting the prefix <code>/subnet</code> at <code>/api/v2/subnet/tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe/read_state</code>.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>In order to read parts of the <a href="#state-tree">The system state tree</a>, the user makes a POST request to <code>/api/v2/canister/&lt;effective_canister_id&gt;/read_state</code> or <code>/api/v2/subnet/&lt;subnet_id&gt;/read_state</code>. The subnet form should be used when the information to be retrieved is subnet specific, i.e., when requesting paths with the prefix <code>/time</code> or <code>/subnet</code>, and the subnet form must be used when requesting paths of the form <code>/subnet/&lt;subnet_id&gt;/metrics</code>. The request body consists of an authentication envelope with a <code>content</code> map with the following fields:</p><ul><li><p><code>request_type</code> (<code>text</code>): Always <code>read_state</code></p></li><li><p><code>sender</code>, <code>nonce</code>, <code>ingress_expiry</code>: See <a href="#authentication">Authentication</a></p></li><li><p><code>paths</code> (sequence of paths): A list of at most 1000 paths, where a path is itself a sequence of at most 127 blobs.</p></li></ul><p>The HTTP response to this request can have the following forms:</p><ul><li><p>200 HTTP status with a non-empty body consisting of a CBOR (see <a href="#cbor">CBOR</a>) map with the following fields:</p><ul><li><code>certificate</code> (<code>blob</code>): A certificate (see <a href="#certification">Certification</a>).</li></ul></li><li><p>4xx HTTP status for client errors (e.g. malformed request). Except for 429 HTTP status, retrying the request will likely have the same outcome.</p></li><li><p>5xx HTTP status when the server has encountered an error or is otherwise incapable of performing the request. The request might succeed if retried at a later time.</p></li></ul><p>In the following, we list properties of the returned certificate and specify conditions on the requested paths.</p><p>If the <code>certificate</code> includes a subnet delegation (see <a href="#certification-delegation">Delegation</a>), then</p><ul><li><p>for requests to <code>/api/v2/canister/&lt;effective_canister_id&gt;/read_state</code>, the <code>&lt;effective_canister_id&gt;</code> must be included in the delegation&#x27;s canister id range,</p></li><li><p>for requests to <code>/api/v2/subnet/&lt;subnet_id&gt;/read_state</code>, the <code>&lt;subnet_id&gt;</code> must match the delegation&#x27;s subnet id.</p></li></ul><p>The returned certificate reveals all values whose path has a requested path as a prefix except for</p><ul><li>paths with prefix <code>/subnet/&lt;subnet_id&gt;/node</code> which are only contained in the returned certificate if <code>&lt;effective_canister_id&gt;</code> belongs to the canister ranges of the subnet <code>&lt;subnet_id&gt;</code>, i.e., if <code>&lt;effective_canister_id&gt;</code> belongs to the value at the path <code>/subnet/&lt;subnet_id&gt;/canister_ranges</code> in the state tree.</li></ul><p>The returned certificate also always reveals <code>/time</code>, even if not explicitly requested.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>The returned certificate might also reveal the SHA-256 hashes of values whose paths have not been requested
and whose paths might not even be allowed to be requested by the sender of the HTTP request.
This means that unauthorized users might obtain the SHA-256 hashes of ingress message responses
and private custom sections of the canister&#x27;s module.
Hence, users are advised to use cryptographically strong nonces in their HTTP requests and
canister developers that aim at keeping data confidential are advised to add a secret cryptographic salt to their canister&#x27;s responses and private custom sections.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>All requested paths must have the following form:</p><ul><li><p><code>/time</code>. Can always be requested.</p></li><li><p><code>/api_boundary_nodes</code>, <code>/api_boundary_nodes/&lt;node_id&gt;</code>, <code>/api_boundary_nodes/&lt;node_id&gt;/domain</code>,  <code>/api_boundary_nodes/&lt;node_id&gt;/ipv4_address</code>, <code>/api_boundary_nodes/&lt;node_id&gt;/ipv6_address</code>. Can always be requested.</p></li><li><p><code>/subnet</code>, <code>/subnet/&lt;subnet_id&gt;</code>, <code>/subnet/&lt;subnet_id&gt;/public_key</code>, <code>/subnet/&lt;subnet_id&gt;/canister_ranges</code>, <code>/subnet/&lt;subnet_id&gt;/node</code>, <code>/subnet/&lt;subnet_id&gt;/node/&lt;node_id&gt;</code>, <code>/subnet/&lt;subnet_id&gt;/node/&lt;node_id&gt;/public_key</code>. Can always be requested.</p></li><li><p><code>/subnet/&lt;subnet_id&gt;/metrics</code>. Can be requested at <code>/api/v2/subnet/&lt;subnet_id&gt;/read_state</code> (i.e., if the <code>&lt;subnet_id&gt;</code> in the URL matches the <code>&lt;subnet_id&gt;</code> in the paths). Cannot be requested at <code>/api/v2/canister/&lt;effective_canister_id&gt;/read_state</code>.</p></li><li><p><code>/request_status/&lt;request_id&gt;</code>, <code>/request_status/&lt;request_id&gt;/status</code>, <code>/request_status/&lt;request_id&gt;/reply</code>, <code>/request_status/&lt;request_id&gt;/reject_code</code>, <code>/request_status/&lt;request_id&gt;/reject_message</code>, <code>/request_status/&lt;request_id&gt;/error_code</code>. Can be requested if no path with such a prefix exists in the state tree or</p><ul><li><p>the sender of the original request referenced by <code>&lt;request_id&gt;</code> is the same as the sender of the read state request and</p></li><li><p>the effective canister id of the original request referenced by <code>&lt;request_id&gt;</code> matches <code>&lt;effective_canister_id&gt;</code>.</p></li></ul></li><li><p><code>/canisters/&lt;canister_id&gt;/module_hash</code>. Can be requested if <code>&lt;canister_id&gt;</code> matches <code>&lt;effective_canister_id&gt;</code>.</p></li><li><p><code>/canisters/&lt;canister_id&gt;/controllers</code>. Can be requested if <code>&lt;canister_id&gt;</code> matches <code>&lt;effective_canister_id&gt;</code>. The order of controllers in the value at this path may vary depending on the implementation.</p></li><li><p><code>/canisters/&lt;canister_id&gt;/metadata/&lt;name&gt;</code>. Can be requested if <code>&lt;canister_id&gt;</code> matches <code>&lt;effective_canister_id&gt;</code>, <code>&lt;name&gt;</code> is encoded in UTF-8, and</p><ul><li><p>canister with canister id <code>&lt;canister_id&gt;</code> does not exist or</p></li><li><p>canister with canister id <code>&lt;canister_id&gt;</code> is empty or</p></li><li><p>canister with canister id <code>&lt;canister_id&gt;</code> does not have <code>&lt;name&gt;</code> as its custom section or</p></li><li><p><code>&lt;name&gt;</code> is a public custom section or</p></li><li><p><code>&lt;name&gt;</code> is a private custom section and the sender of the read state request is a controller of the canister.</p></li></ul></li></ul><p>Moreover, all paths with prefix <code>/request_status/&lt;request_id&gt;</code> must refer to the same request ID <code>&lt;request_id&gt;</code>.</p><p>If a path cannot be requested, then the HTTP response to the read state request is undefined.</p><p>Note that the paths <code>/canisters/&lt;canister_id&gt;/certified_data</code> are not accessible with this method; these paths are only exposed to the canisters themselves via the System API (see <a href="#system-api-certified-data">Certified data</a>).</p><p>See <a href="#state-tree">The system state tree</a> for details on the state tree.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-query">Request: Query call<a href="#http-query" class="hash-link" aria-label="Direct link to Request: Query call" title="Direct link to Request: Query call">â</a></h3><p>A query call is a fast, but less secure way to call canister methods that do not change the canister state.
Only methods that are explicitly marked as &quot;query methods&quot; and &quot;composite query methods&quot; by the canister can be called this way.
In contrast to a query method, a composite query method can make further calls to query and composite query methods of canisters on the same subnet.</p><p>The following limits apply to the evaluation of a query call:</p><ul><li><p>The amount of cycles that are used in total (across all calls to query and composite query methods and their callbacks) during evaluation of a query call is at most <code>MAX_CYCLES_PER_QUERY</code>.</p></li><li><p>The maximum nesting level of calls during evaluation of a query call is at most <code>MAX_CALL_DEPTH_COMPOSITE_QUERY</code>.</p></li><li><p>The wall clock time spent on evaluation of a query call is at most <code>MAX_WALL_CLOCK_TIME_COMPOSITE_QUERY</code>.</p></li></ul><div class="admonition_WoCw admonitionNote_L5_h"><p>Composite query methods are EXPERIMENTAL and there might be breaking changes of their behavior in the future. Use at your own risk!</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>In order to make a query call to a canister, the user makes a POST request to <code>/api/v2/canister/&lt;effective_canister_id&gt;/query</code>. The request body consists of an authentication envelope with a <code>content</code> map with the following fields:</p><ul><li><p><code>request_type</code> (<code>text</code>): Always <code>&quot;query&quot;</code>.</p></li><li><p><code>sender</code>, <code>nonce</code>, <code>ingress_expiry</code>: See <a href="#authentication">Authentication</a>.</p></li><li><p><code>canister_id</code> (<code>blob</code>): The principal of the canister to call.</p></li><li><p><code>method_name</code> (<code>text</code>): Name of the canister method to call.</p></li><li><p><code>arg</code> (<code>blob</code>): Argument to pass to the canister method.</p></li></ul><p>The HTTP response to this request can have the following forms:</p><ul><li><p>200 HTTP status with a non-empty body consisting of a CBOR (see <a href="#cbor">CBOR</a>) map with the following fields:</p><ul><li><p><code>status</code> (<code>text</code>): <code>&quot;replied&quot;</code></p></li><li><p><code>reply</code>: a CBOR map with the field <code>arg</code> (<code>blob</code>) which contains the reply data.</p></li><li><p><code>signatures</code> (<code>[+ node-signature]</code>): a list containing one node signature for the returned query response.</p></li></ul></li><li><p>200 HTTP status with a non-empty body consisting of a CBOR (see <a href="#cbor">CBOR</a>) map with the following fields:</p><ul><li><p><code>status</code> (<code>text</code>): <code>&quot;rejected&quot;</code></p></li><li><p><code>reject_code</code> (<code>nat</code>): The reject code (see <a href="#reject-codes">Reject codes</a>).</p></li><li><p><code>reject_message</code> (<code>text</code>): a textual diagnostic message.</p></li><li><p><code>error_code</code> (<code>text</code>): an optional implementation-specific textual error code (see <a href="#error-codes">Error codes</a>).</p></li><li><p><code>signatures</code> (<code>[+ node-signature]</code>): a list containing one node signature for the returned query response.</p></li></ul></li><li><p>4xx HTTP status for client errors (e.g. malformed request). Except for 429 HTTP status, retrying the request will likely have the same outcome.</p></li><li><p>5xx HTTP status when the server has encountered an error or is otherwise incapable of performing the request. The request might succeed if retried at a later time.</p></li></ul><div class="admonition_WoCw admonitionNote_L5_h"><p>Although <code>signatures</code> only contains one node signature, we still declare its type to be a list to prevent future breaking changes
if we include more signatures in a future version of the protocol specification.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>A successful response to a query call (200 HTTP status) contains a list with one signature for the returned response produced by the IC node that evaluated the query call. The signature (whose type is denoted as <code>node-signature</code>) is a CBOR (see <a href="#cbor">CBOR</a>) map with the following fields:</p><ul><li><p><code>timestamp</code> (<code>nat</code>): the timestamp of the signature.</p></li><li><p><code>signature</code> (<code>blob</code>): the actual signature.</p></li><li><p><code>identity</code> (<code>principal</code>): the principal of the node producing the signature.</p></li></ul><p>Given a query (the <code>content</code> map from the request body) <code>Q</code>, a response <code>R</code>, and a certificate <code>Cert</code> that is obtained by requesting the path <code>/subnet</code> in a <strong>separate</strong> read state request to <code>/api/v2/canister/&lt;effective_canister_id&gt;/read_state</code>, the following predicate describes when the returned response <code>R</code> is correctly signed:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">verify_response(Q, R, Cert)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = verify_cert(Cert) â§</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ((Cert.delegation = NoDelegation â§ SubnetId = RootSubnetId â§ lookup([&quot;subnet&quot;,SubnetId,&quot;canister_ranges&quot;], Cert) = Found Ranges) â¨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     (SubnetId = Cert.delegation.subnet_id â§ lookup([&quot;subnet&quot;,SubnetId,&quot;canister_ranges&quot;], Cert.delegation.certificate) = Found Ranges)) â§</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    effective_canister_id â Ranges â§</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    â {timestamp: T, signature: Sig, identity: NodeId} â R.signatures.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      lookup([&quot;subnet&quot;,SubnetId,&quot;node&quot;,NodeId,&quot;public_key&quot;], Cert) = Found PK â§</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      if R.status = &quot;replied&quot; then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        verify_signature PK Sig (&quot;\x0Bic-response&quot; Â· hash_of_map({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          status: &quot;replied&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          reply: R.reply,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          timestamp: T,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          request_id: hash_of_map(Q)}))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        verify_signature PK Sig (&quot;\x0Bic-response&quot; Â· hash_of_map({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          status: &quot;rejected&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          reject_code: R.reject_code,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          reject_message: R.reject_message,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          error_code: R.error_code,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          timestamp: T,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          request_id: hash_of_map(Q)}))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>where <code>RootSubnetId</code> is the a priori known principal of the root subnet. Moreover, all timestamps in <code>R.signatures</code>, the certificate <code>Cert</code>, and its optional delegation must be &quot;recent enough&quot;.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>This specification leaves it up to the client to define expiry times for the timestamps in <code>R.signatures</code>, the certificate <code>Cert</code>, and its optional delegation. A reasonable expiry time for timestamps in <code>R.signatures</code> and the certificate <code>Cert</code> is 5 minutes (analogously to the maximum allowed ingress expiry enforced by the IC mainnet). Delegations require expiry times of at least a week since the IC mainnet refreshes the delegations only after replica upgrades which typically happen once a week.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-effective-canister-id">Effective canister id<a href="#http-effective-canister-id" class="hash-link" aria-label="Direct link to Effective canister id" title="Direct link to Effective canister id">â</a></h3><p>The <code>&lt;effective_canister_id&gt;</code> in the URL paths of requests is the <em>effective</em> destination of the request.
It must be contained in the canister ranges of a subnet, otherwise the corresponding HTTP request is rejected.</p><ul><li><p>If the request is an update call to the Management Canister (<code>aaaaa-aa</code>), then:</p><ul><li><p>If the call is to the <code>provisional_create_canister_with_cycles</code> method, then any principal can be used as the effective canister id for this call.</p></li><li><p>If the call is to the <code>install_chunked_code</code> method and the <code>arg</code> is a Candid-encoded record with a <code>target_canister</code> field of type <code>principal</code>, then the effective canister id must be that principal.</p></li><li><p>Otherwise, if the <code>arg</code> is a Candid-encoded record with a <code>canister_id</code> field of type <code>principal</code>, then the effective canister id must be that principal.</p></li><li><p>Otherwise, the call is rejected by the system independently of the effective canister id.</p></li></ul></li><li><p>If the request is a query call to the Management Canister (<code>aaaaa-aa</code>), then:</p><ul><li><p>If the <code>arg</code> is a Candid-encoded record with a <code>canister_id</code> field of type <code>principal</code>, then the effective canister id must be that principal.</p></li><li><p>Otherwise, the call is rejected by the system independently of the effective canister id.</p></li></ul></li><li><p>If the request is an update or query call to a canister that is not the Management Canister (<code>aaaaa-aa</code>), then the effective canister id must be the <code>canister_id</code> in the request.</p></li></ul><div class="admonition_WoCw admonitionNote_L5_h"><p>The expectation is that user-side agent code shields users and developers from the notion of effective canister id, in analogy to how the System API interface shields canister developers from worrying about routing.</p><p>The Internet Computer blockchain mainnet does not support <code>provisional_create_canister_with_cycles</code> and thus all calls to this method are rejected independently of the effective canister id.</p><p>In development instances of the Internet Computer Protocol (e.g. testnets), the effective canister id of a request submitted to a node must be a canister id from the canister ranges of the subnet to which the node belongs.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="authentication">Authentication<a href="#authentication" class="hash-link" aria-label="Direct link to Authentication" title="Direct link to Authentication">â</a></h3><p>All requests coming in via the HTTPS interface need to be either <em>anonymous</em> or <em>authenticated</em> using a cryptographic signature. To that end, the following fields are present in the <code>content</code> map in all cases:</p><ul><li><p><code>nonce</code> (<code>blob</code>, optional): Arbitrary user-provided data of length at most 32 bytes, typically randomly generated. This can be used to create distinct requests with otherwise identical fields.</p></li><li><p><code>ingress_expiry</code> (<code>nat</code>, required): An upper limit on the validity of the request, expressed in nanoseconds since 1970-01-01 (like <a href="#system-api-time">ic0.time()</a>). This avoids replay attacks: The IC will not accept requests, or transition requests from status <code>received</code> to status <code>processing</code>, if their expiry date is in the past. The IC may refuse to accept requests with an ingress expiry date too far in the future. These rules for ingress expiry apply not only to update calls but all requests alike (and could have been called <code>request_expiry</code>), except for anonymous <code>query</code> and anonymous <code>read_state</code> requests for which the IC may accept any provided expiry timestamp.</p></li><li><p><code>sender</code> (<code>Principal</code>, required): The user who issued the request.</p></li></ul><p>The envelope, i.e. the overall request, has the following keys:</p><ul><li><p><code>content</code> (<code>record</code>): the actual request content</p></li><li><p><code>sender_pubkey</code> (<code>blob</code>, optional): Public key used to authenticate this request. Since a user may in the future have more than one key, this field tells the IC which key is used.</p></li><li><p><code>sender_delegation</code> (<code>array</code> of maps, optional): a chain of delegations, starting with the one signed by <code>sender_pubkey</code> and ending with the one delegating to the key relating to <code>sender_sig</code>. Every public key in the chain of delegations should appear exactly once: cycles (a public key delegates to another public key that already previously appeared in the chain) or self-signed delegations (a public key delegates to itself) are not allowed and such requests will be refused by the IC.</p></li><li><p><code>sender_sig</code> (<code>blob</code>, optional): Signature to authenticate this request.</p></li></ul><p>The public key must authenticate the <code>sender</code> principal:</p><ul><li><p>A public key can authenticate a principal if the latter is a self-authenticating id derived from that public key (see <a href="#id-classes">Special forms of Principals</a>).</p></li><li><p>The fields <code>sender_pubkey</code>, <code>sender_sig</code>, and <code>sender_delegation</code> must be omitted if the <code>sender</code> field is the anonymous principal. The fields <code>sender_pubkey</code> and <code>sender_sig</code> must be set if the <code>sender</code> field is not the anonymous principal.</p></li></ul><p>The request id (see <a href="#request-id">Request ids</a>) is calculated from the content record. This allows the signature to be based on the request id, and implies that signature and public key are not semantically relevant.</p><p>The field <code>sender_pubkey</code> contains a public key supported by one of the schemes described in <a href="#signatures">Signatures</a>.</p><p>Signing transactions can be delegated from one key to another one. If delegation is used, then the <code>sender_delegation</code> field contains an array of delegations, each of which is a map with the following fields:</p><ul><li><p><code>delegation</code> (<code>map</code>): Map with fields:</p><ul><li><p><code>pubkey</code> (<code>blob</code>): Public key as described in <a href="#signatures">Signatures</a>.</p></li><li><p><code>expiration</code> (<code>nat</code>): Expiration of the delegation, in nanoseconds since 1970-01-01, analogously to the <code>ingress_expiry</code> field above.</p></li><li><p><code>targets</code> (<code>array</code> of <code>CanisterId</code>, optional): If this field is set, the delegation only applies for requests sent to the canisters in the list. The list must contain no more than 1000 elements; otherwise, the request will not be accepted by the IC.</p></li></ul></li><li><p><code>signature</code> (<code>blob</code>): Signature on the 32-byte <a href="#hash-of-map">representation-independent hash</a> of the map contained in the <code>delegation</code> field as described in <a href="#signatures">Signatures</a>, using the 27 bytes <code>\x1Aic-request-auth-delegation</code> as the domain separator.</p><p>For the first delegation in the array, this signature is created with the key corresponding to the public key from the <code>sender_pubkey</code> field, all subsequent delegations are signed with the key corresponding to the public key contained in the preceding delegation.</p></li></ul><p>The <code>sender_sig</code> field is calculated by signing the concatenation of the 11 bytes <code>\x0Aic-request</code> (the domain separator) and the 32 byte <a href="#request-id">request id</a> with the secret key that belongs to the key specified in the last delegation or, if no delegations are present, the public key specified in <code>sender_pubkey</code>.</p><p>The delegation field, if present, must not contain more than 20 delegations.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="hash-of-map">Representation-independent hashing of structured data<a href="#hash-of-map" class="hash-link" aria-label="Direct link to Representation-independent hashing of structured data" title="Direct link to Representation-independent hashing of structured data">â</a></h3><p>Structured data, such as (recursive) maps, are authenticated by signing a representation-independent hash of the data. This hash is computed as follows (using SHA256 in the steps below):</p><ol><li><p>For each field that is present in the map (i.e. omitted optional fields are indeed omitted):</p><ul><li>concatenate the hash of the field&#x27;s name (in ascii-encoding, without terminal <code>\x00</code>) and the hash of the value (as specified below).</li></ul></li><li><p>Sort these concatenations from low to high.</p></li><li><p>Concatenate the sorted elements, and hash the result.</p></li></ol><p>The resulting hash of length 256 bits (32 bytes) is the representation-independent hash.</p><p>Field values are hashed as follows:</p><ul><li><p>Binary blobs (<code>canister_id</code>, <code>arg</code>, <code>nonce</code>, <code>module</code>) are hashed as-is.</p></li><li><p>Strings (<code>request_type</code>, <code>method_name</code>) are hashed by hashing their binary encoding in UTF-8, without a terminal <code>\x00</code>.</p></li><li><p>Natural numbers (<code>compute_allocation</code>, <code>memory_allocation</code>, <code>ingress_expiry</code>) are hashed by hashing their binary encoding using the shortest form <a href="https://en.wikipedia.org/wiki/LEB128#Unsigned_LEB128" target="_blank" rel="noopener noreferrer">Unsigned LEB128</a> encoding. For example, <code>0</code> should be encoded as a single zero byte <code>[0x00]</code> and <code>624485</code> should be encoded as byte sequence <code>[0xE5, 0x8E, 0x26]</code>.</p></li><li><p>Integers are hashed by hashing their encoding using the shortest form <a href="https://en.wikipedia.org/wiki/LEB128#Signed_LEB128" target="_blank" rel="noopener noreferrer">Signed LEB128</a> encoding. For example, <code>0</code> should be encoded as a single zero byte <code>[0x00]</code> and <code>-123456</code> should be encoded as byte sequence <code>[0xC0, 0xBB, 0x78]</code>.</p></li><li><p>Arrays (<code>paths</code>) are hashed by hashing the concatenation of the hashes of the array elements.</p></li><li><p>Maps (<code>sender_delegation</code>) are hashed by recursively computing their representation-independent hash.</p></li></ul><div class="admonition_WoCw admonitionTip_gXdO"><p>Example calculation (where <code>H</code> denotes SHA-256 and <code>Â·</code> denotes blob concatenation) of a representation independent hash
for a map with a nested map in a field value:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">hash_of_map({ &quot;reply&quot;: { &quot;arg&quot;: &quot;DIDL\x00\x00&quot; } })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = H(concat (sort [ H(&quot;reply&quot;) Â· hash_of_map({ &quot;arg&quot;: &quot;DIDL\x00\x00&quot; }) ]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = H(concat (sort [ H(&quot;reply&quot;) Â· H(concat (sort [ H(&quot;arg&quot;) Â· H(&quot;DIDL\x00\x00&quot;) ])) ]))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#26D76D"></rect><path d="M16.666 8.49c0 2.775-2.5 4.653-2.5 6.843h-1.328c.001-1.386.664-2.55 1.312-3.675.609-1.057 1.183-2.055 1.183-3.169 0-2.072-1.679-3.156-3.336-3.156-1.655 0-3.33 1.084-3.33 3.156 0 1.114.573 2.112 1.182 3.169.648 1.125 1.31 2.29 1.311 3.675H9.833c0-2.19-2.5-4.068-2.5-6.844C7.333 5.594 9.665 4 11.997 4c2.335 0 4.67 1.596 4.67 4.49ZM14 16.332c0 .184-.15.334-.334.334h-3.333a.334.334 0 0 1 0-.667h3.333c.184 0 .334.15.334.333Zm0 1.334c0 .184-.15.333-.334.333h-3.333a.333.333 0 0 1 0-.667h3.333c.184 0 .334.15.334.334Zm-1.134 2.106a.67.67 0 0 1-.502.227h-.729a.67.67 0 0 1-.501-.227l-.968-1.106h3.667l-.967 1.106Zm-2.42-10.898-.792-.102c.173-1.33 1-2.316 2.346-2.565l.146.785c-1.298.24-1.622 1.282-1.7 1.882Z" fill="#fff"></path></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="request-id">Request ids<a href="#request-id" class="hash-link" aria-label="Direct link to Request ids" title="Direct link to Request ids">â</a></h3><p>When signing requests or querying the status of a request (see <a href="#state-tree-request-status">Request status</a>) in the state tree, the user identifies the request using a <em>request id</em>, which is the <a href="#hash-of-map">representation-independent hash</a> of the <code>content</code> map of the original request. A request id must have length of 32 bytes.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>The request id is independent of the representation of the request (currently only CBOR, see <a href="#cbor">CBOR</a>), and does not change if the specification adds further optional fields to a request type.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><div class="admonition_WoCw admonitionNote_L5_h"><p>The recommended textual representation of a request id is a hexadecimal string with lower-case letters prefixed with &#x27;0x&#x27;. E.g., request id consisting of bytes <code>[00, 01, 02, 03, 04, 05, 06, 07, 08, 09, 0A, 0B, 0C, 0D, 0E, 0F, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 1A, 1B, 1C, 1D, 1E, 1F]</code> should be displayed as <code>0x000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f</code>.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><div class="admonition_WoCw admonitionTip_gXdO"><p>Example calculation (where <code>H</code> denotes SHA-256 and <code>Â·</code> denotes blob concatenation) in which we assume that the optional nonce is not provided and thus omitted:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">hash_of_map({ request_type: &quot;call&quot;, sender: 0x04, ingress_expiry: 1685570400000000000, canister_id: 0x00000000000004D2, method_name: &quot;hello&quot;, arg: &quot;DIDL\x00\xFD*&quot;})</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> = H(concat (sort</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   [ H(&quot;request_type&quot;) Â· H(&quot;call&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , H(&quot;sender&quot;) Â· H(&quot;0x04&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , H(&quot;ingress_expiry&quot;) Â· H(1685570400000000000)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , H(&quot;canister_id&quot;) Â· H(&quot;\x00\x00\x00\x00\x00\x00\x04\xD2&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , H(&quot;method_name&quot;) Â· H(&quot;hello&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , H(&quot;arg&quot;) Â· H(&quot;DIDL\x00\xFD*&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> = H(concat (sort</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   [ 769e6f87bdda39c859642b74ce9763cdd37cb1cd672733e8c54efaa33ab78af9 Â· 7edb360f06acaef2cc80dba16cf563f199d347db4443da04da0c8173e3f9e4ed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , 0a367b92cf0b037dfd89960ee832d56f7fc151681bb41e53690e776f5786998a Â· e52d9c508c502347344d8c07ad91cbd6068afc75ff6292f062a09ca381c89e71</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , 26cec6b6a9248a96ab24305b61b9d27e203af14a580a5b1ff2f67575cab4a868 Â· db8e57abc8cda1525d45fdd2637af091bc1f28b35819a40df71517d1501f2c76</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , 0a3eb2ba16702a387e6321066dd952db7a31f9b5cc92981e0a92dd56802d3df9 Â· 4d8c47c3c1c837964011441882d745f7e92d10a40cef0520447c63029eafe396</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , 293536232cf9231c86002f4ee293176a0179c002daa9fc24be9bb51acdd642b6 Â· 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , b25f03dedd69be07f356a06fe35c1b0ddc0de77dcd9066c4be0c6bbde14b23ff Â· 6c0b2ae49718f6995c02ac5700c9c789d7b7862a0d53e6d40a73f1fcd2f70189</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ]))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> = H(concat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   [ 0a367b92cf0b037dfd89960ee832d56f7fc151681bb41e53690e776f5786998a Â· e52d9c508c502347344d8c07ad91cbd6068afc75ff6292f062a09ca381c89e71</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , 0a3eb2ba16702a387e6321066dd952db7a31f9b5cc92981e0a92dd56802d3df9 Â· 4d8c47c3c1c837964011441882d745f7e92d10a40cef0520447c63029eafe396</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , 26cec6b6a9248a96ab24305b61b9d27e203af14a580a5b1ff2f67575cab4a868 Â· db8e57abc8cda1525d45fdd2637af091bc1f28b35819a40df71517d1501f2c76</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , 293536232cf9231c86002f4ee293176a0179c002daa9fc24be9bb51acdd642b6 Â· 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , 769e6f87bdda39c859642b74ce9763cdd37cb1cd672733e8c54efaa33ab78af9 Â· 7edb360f06acaef2cc80dba16cf563f199d347db4443da04da0c8173e3f9e4ed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   , b25f03dedd69be07f356a06fe35c1b0ddc0de77dcd9066c4be0c6bbde14b23ff Â· 6c0b2ae49718f6995c02ac5700c9c789d7b7862a0d53e6d40a73f1fcd2f70189</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> = 1d1091364d6bb8a6c16b203ee75467d59ead468f523eb058880ae8ec80e2b101</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#26D76D"></rect><path d="M16.666 8.49c0 2.775-2.5 4.653-2.5 6.843h-1.328c.001-1.386.664-2.55 1.312-3.675.609-1.057 1.183-2.055 1.183-3.169 0-2.072-1.679-3.156-3.336-3.156-1.655 0-3.33 1.084-3.33 3.156 0 1.114.573 2.112 1.182 3.169.648 1.125 1.31 2.29 1.311 3.675H9.833c0-2.19-2.5-4.068-2.5-6.844C7.333 5.594 9.665 4 11.997 4c2.335 0 4.67 1.596 4.67 4.49ZM14 16.332c0 .184-.15.334-.334.334h-3.333a.334.334 0 0 1 0-.667h3.333c.184 0 .334.15.334.333Zm0 1.334c0 .184-.15.333-.334.333h-3.333a.333.333 0 0 1 0-.667h3.333c.184 0 .334.15.334.334Zm-1.134 2.106a.67.67 0 0 1-.502.227h-.729a.67.67 0 0 1-.501-.227l-.968-1.106h3.667l-.967 1.106Zm-2.42-10.898-.792-.102c.173-1.33 1-2.316 2.346-2.565l.146.785c-1.298.24-1.622 1.282-1.7 1.882Z" fill="#fff"></path></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="reject-codes">Reject codes<a href="#reject-codes" class="hash-link" aria-label="Direct link to Reject codes" title="Direct link to Reject codes">â</a></h3><p>An API request or inter-canister call that is pending in the IC will eventually result in either a <em>reply</em> (indicating success, and carrying data) or a <em>reject</em> (indicating an error of some sorts). A reject contains a <em>rejection code</em> that classifies the error and a hopefully helpful <em>reject message</em> string.</p><p>Rejection codes are member of the following enumeration:</p><ul><li><p><code>SYS_FATAL</code> (1): Fatal system error, retry unlikely to be useful.</p></li><li><p><code>SYS_TRANSIENT</code> (2): Transient system error, retry might be possible.</p></li><li><p><code>DESTINATION_INVALID</code> (3): Invalid destination (e.g. canister/account does not exist)</p></li><li><p><code>CANISTER_REJECT</code> (4): Explicit reject by the canister.</p></li><li><p><code>CANISTER_ERROR</code> (5): Canister error (e.g., trap, no response)</p></li></ul><p>The symbolic names of this enumeration are used throughout this specification, but on all interfaces (HTTPS API, System API), they are represented as positive numbers as given in the list above.</p><p>The error message is guaranteed to be a string, i.e. not arbitrary binary data.</p><p>When canisters explicitly reject a message (see <a href="#system-api-requests">Public methods</a>), they can specify the reject message, but <em>not</em> the reject code; it is always <code>CANISTER_REJECT</code>. In this sense, the reject code is trustworthy: If the IC responds with a <code>SYS_FATAL</code> reject, then it really was the IC issuing this reject.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="error-codes">Error codes<a href="#error-codes" class="hash-link" aria-label="Direct link to Error codes" title="Direct link to Error codes">â</a></h3><p>Implementations of the API can provide additional details for rejected messages in the form of a textual label identifying the error condition. API clients can use these labels to handle errors programmatically or suggest recovery paths to the user. The specification reserves error codes matching the regular expression <code>IC[0-9]+</code> (e.g., <code>IC502</code>) for the DFINITY implementation of the API.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="api-status">Status endpoint<a href="#api-status" class="hash-link" aria-label="Direct link to Status endpoint" title="Direct link to Status endpoint">â</a></h3><p>Additionally, the Internet Computer provides an API endpoint to obtain various status fields at</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/api/v2/status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>For this endpoint, the user performs a GET request, and receives a CBOR (see <a href="#cbor">CBOR</a>) value with the following fields. The IC may include additional implementation-specific fields.</p><ul><li><code>root_key</code> (blob, optional): The public key (a DER-encoded BLS key) of the root key of this instance of the Internet Computer Protocol. This <em>must</em> be present in short-lived development instances, to allow the agent to fetch the public key. For the Internet Computer, agents must have an independent trustworthy source for this data, and must not be tempted to fetch it from this insecure location.</li></ul><p>See <a href="#api-cbor">CBOR encoding of requests and responses</a> for details on the precise CBOR encoding of this object.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>Future additions may include local time, geographic location, and other useful implementation-specific information such as blockheight. This data may possibly be signed by the node.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="api-cbor">CBOR encoding of requests and responses<a href="#api-cbor" class="hash-link" aria-label="Direct link to CBOR encoding of requests and responses" title="Direct link to CBOR encoding of requests and responses">â</a></h3><p>Requests and responses are specified here as records with named fields and using suggestive human readable syntax. The actual format in the body of the HTTP request or response, however, is CBOR (see <a href="#cbor">CBOR</a>).</p><p>Concretely, it consists of a data item with major type 6 (&quot;Semantic tag&quot;) and tag value <code>55799</code>, followed by a record.</p><p>Requests consist of an envelope record with keys <code>sender_sig</code> (a blob), <code>sender_pubkey</code> (a blob) and <code>content</code> (a record). The first two are metadata that are used for request authentication, while the last one is the actual content of the request.</p><p>The following encodings are used:</p><ul><li><p>Strings: Major type 3 (&quot;Text string&quot;).</p></li><li><p>Blobs: Major type 2 (&quot;Byte string&quot;).</p></li><li><p>Nats: Major type 0 (&quot;Unsigned integer&quot;) if small enough to fit that type, else the <a href="https://www.rfc-editor.org/rfc/rfc8949#name-bignums" target="_blank" rel="noopener noreferrer">Bignum</a> format is used.</p></li><li><p>Records: Major type 5 (&quot;Map of pairs of data items&quot;), followed by the fields, where keys are encoded with major type 3 (&quot;Text string&quot;).</p></li><li><p>Arrays: Major type 4 (&quot;Array of data items&quot;).</p></li></ul><p>As advised by <a href="https://www.rfc-editor.org/rfc/rfc8949#name-creating-cbor-based-protoco" target="_blank" rel="noopener noreferrer">section &quot;Creating CBOR-Based Protocols&quot;</a> of the CBOR spec, we clarify that:</p><ul><li><p>Floating-point numbers may not be used to encode integers.</p></li><li><p>Duplicate keys are prohibited in CBOR maps.</p></li></ul><div class="admonition_WoCw admonitionTip_gXdO"><p>A typical request would be (written in <a href="https://www.rfc-editor.org/rfc/rfc8949#name-diagnostic-notation" target="_blank" rel="noopener noreferrer">CBOR diagnostic notation</a>, which can be checked and converted on <a href="https://cbor.me/" target="_blank" rel="noopener noreferrer">cbor.me</a>):</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">55799({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;content&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;request_type&quot;: &quot;call&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;canister_id&quot;: h&#x27;ABCD01&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;method_name&quot;: &quot;say_hello&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;arg&quot;: h&#x27;0061736d01000000&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;sender_sig&quot;: h&#x27;DEADBEEF&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;sender_pubkey&quot;: h&#x27;b7a3c12dc0c8c748ab07525b701122b88bd78f600c76342d27f25e5f92444cde&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#26D76D"></rect><path d="M16.666 8.49c0 2.775-2.5 4.653-2.5 6.843h-1.328c.001-1.386.664-2.55 1.312-3.675.609-1.057 1.183-2.055 1.183-3.169 0-2.072-1.679-3.156-3.336-3.156-1.655 0-3.33 1.084-3.33 3.156 0 1.114.573 2.112 1.182 3.169.648 1.125 1.31 2.29 1.311 3.675H9.833c0-2.19-2.5-4.068-2.5-6.844C7.333 5.594 9.665 4 11.997 4c2.335 0 4.67 1.596 4.67 4.49ZM14 16.332c0 .184-.15.334-.334.334h-3.333a.334.334 0 0 1 0-.667h3.333c.184 0 .334.15.334.333Zm0 1.334c0 .184-.15.333-.334.333h-3.333a.333.333 0 0 1 0-.667h3.333c.184 0 .334.15.334.334Zm-1.134 2.106a.67.67 0 0 1-.502.227h-.729a.67.67 0 0 1-.501-.227l-.968-1.106h3.667l-.967 1.106Zm-2.42-10.898-.792-.102c.173-1.33 1-2.316 2.346-2.565l.146.785c-1.298.24-1.622 1.282-1.7 1.882Z" fill="#fff"></path></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="api-cddl">CDDL description of requests and responses<a href="#api-cddl" class="hash-link" aria-label="Direct link to CDDL description of requests and responses" title="Direct link to CDDL description of requests and responses">â</a></h3><p>This section summarizes the format of the CBOR data passed to and from the entry points described above. You can also <a target="_blank" href="/assets/files/requests-f392be708620e2e1fd90a57bbf18aa77.cddl">download the file</a> and see <a href="#cddl">CDDL</a> for more information.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ordering-guarantees">Ordering guarantees<a href="#ordering-guarantees" class="hash-link" aria-label="Direct link to Ordering guarantees" title="Direct link to Ordering guarantees">â</a></h3><p>The order in which the various messages between canisters are delivered and executed is not fully specified. The guarantee provided by the IC is that if a canister sends two messages to a canister and they both start being executed by the receiving canister, then they do so in the order in which the messages were sent.</p><p>More precisely:</p><ul><li><p>Messages between any <em>two</em> canisters, if delivered to the canister, start executing in order. Note that message delivery can fail for arbitrary reasons (e.g., high system load).</p></li><li><p>If a WebAssembly function, within a single invocation, makes multiple calls to the same canister, they are queued in the order of invocations to <code>ic0.call_perform</code>.</p></li><li><p>Responses (including replies with <code>ic0.msg_reply</code>, explicit rejects with <code>ic0.msg_reject</code> and system-generated error responses) do <em>not</em> have any ordering guarantee relative to each other or to method calls.</p></li><li><p>There is no particular order guarantee for ingress messages submitted via the HTTPS interface.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="synchronicity-across-nodes">Synchronicity across nodes<a href="#synchronicity-across-nodes" class="hash-link" aria-label="Direct link to Synchronicity across nodes" title="Direct link to Synchronicity across nodes">â</a></h3><p>This document describes the Internet Computer as having a single global state that can be modified and queried. In reality, it consists of many nodes, which may not be perfectly in sync.</p><p>As long as you talk to one (honest) node only, the observed behavior is nicely sequential. If you issue an update (i.e. state-mutating) call to a canister (e.g. bump a counter), and node A indicates that the call has been executed, and you then issue a query call to node A, then A&#x27;s response is guaranteed to include the effect of the update call (and you will receive the updated counter value).</p><p>If you then (quickly) issue a read request to node B, it may be that B responds to your read query based on the old state of the canister (and you might receive the old counter value).</p><p>A related problem is that query calls are not certified, and nodes may be dishonest in their response. In that case, the user might want to get more assurance by querying multiple nodes and comparing the result. However, it is (currently) not possible to query a <em>specific</em> state.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>Applications can work around these problems. For the first problem, the query result could be such that the user can tell if the update has been received or not. For the second problem, even if using <a href="#system-api-certified-data">certified data</a> is not possible, if replies are monotonic in some sense the user can get assurance in their intersection (e.g. if the query returns a list of events that grows over time, then even if different nodes return different lists, the user can get assurance in those events that are reported by many nodes).</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="canister-module-format">Canister module format<a href="#canister-module-format" class="hash-link" aria-label="Direct link to Canister module format" title="Direct link to Canister module format">â</a></h2><p>A canister module is a <a href="https://webassembly.github.io/spec/core/index.html" target="_blank" rel="noopener noreferrer">WebAssembly module</a> that is either in binary format (typically <code>.wasm</code>) or gzip-compressed (typically <code>.wasm.gz</code>). If the module starts with byte sequence <code>[0x1f, 0x8b, 0x08]</code>, then the system decompresses the contents as a gzip stream according to <a href="https://datatracker.ietf.org/doc/html/rfc1952.html" target="_blank" rel="noopener noreferrer">RFC-1952</a> and then parses the output as a WebAssembly binary.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api">Canister interface (System API)<a href="#system-api" class="hash-link" aria-label="Direct link to Canister interface (System API)" title="Direct link to Canister interface (System API)">â</a></h2><p>The System API is the interface between the running canister and the Internet Computer. It allows the WebAssembly module of a canister to expose functionality to the users (method entry points) and the IC (e.g. initialization), and exposes functionality of the IC to the canister (e.g. calling other canisters). Because WebAssembly is rather low-level, it also explains how to express higher level concepts (e.g. binary blobs).</p><p>We want to leverage advanced WebAssembly features, such as WebAssembly host references. But as they are not yet supported by all tools involved, this section describes an initial System API that does not rely on host references. In section <a href="#host-references">Outlook: Using Host References</a>, we outline some of the proposed uses of WebAssembly host references.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-module">WebAssembly module requirements<a href="#system-api-module" class="hash-link" aria-label="Direct link to WebAssembly module requirements" title="Direct link to WebAssembly module requirements">â</a></h3><p>In order for a WebAssembly module to be usable as the code for the canister, it needs to conform to the following requirements:</p><ul><li><p>It may declare (import or export) at most one memory.</p></li><li><p>It may only import a function if it is listed in <a href="#system-api-imports">Overview of imports</a>.
The value of <code>I â {i32, i64}</code> specifying whether the imported functions have 32-bit or 64-bit pointers
is derived from the bit-width of the declared memory defaulting to <code>I = i32</code> if the canister declares no memory.</p></li><li><p>It may have a <code>(start)</code> function.</p></li><li><p>If it exports a function called <code>canister_init</code>, the function must have type <code>() -&gt; ()</code>.</p></li><li><p>If it exports a function called <code>canister_inspect_message</code>, the function must have type <code>() -&gt; ()</code>.</p></li><li><p>If it exports a function called <code>canister_pre_upgrade</code>, the function must have type <code>() -&gt; ()</code>.</p></li><li><p>If it exports a function called <code>canister_post_upgrade</code>, the function must have type <code>() -&gt; ()</code>.</p></li><li><p>If it exports a function called <code>canister_heartbeat</code>, the function must have type <code>() -&gt; ()</code>.</p></li><li><p>If it exports a function called <code>canister_global_timer</code>, the function must have type <code>() -&gt; ()</code>.</p></li><li><p>If it exports any functions called <code>canister_update &lt;name&gt;</code>, <code>canister_query &lt;name&gt;</code>, or <code>canister_composite_query &lt;name&gt;</code> for some <code>name</code>, the functions must have type <code>() -&gt; ()</code>.</p></li><li><p>It may not export more than one function called <code>canister_update &lt;name&gt;</code>, <code>canister_query &lt;name&gt;</code>, or <code>canister_composite_query &lt;name&gt;</code> with the same <code>name</code>.</p></li><li><p>It may not export other methods the names of which start with the prefix <code>canister_</code> besides the methods allowed above.</p></li><li><p>It may not have both <code>icp:public &lt;name&gt;</code> and <code>icp:private &lt;name&gt;</code> with the same <code>name</code> as the custom section name.</p></li><li><p>It may not have other custom sections the names of which start with the prefix <code>icp:</code> besides the <!-- -->`<!-- -->icp:public <!-- -->`<!-- --> and <!-- -->`<!-- -->icp:private <!-- -->`<!-- -->.</p></li><li><p>The IC may reject WebAssembly modules that</p><ul><li><p>declare more than 50,000 functions, or</p></li><li><p>declare more than 1,000 globals, or</p></li><li><p>declare more than 16 exported custom sections (the custom section names with prefix <code>icp:</code>), or</p></li><li><p>the number of all exported functions called <code>canister_update &lt;name&gt;</code>, <code>canister_query &lt;name&gt;</code>, or <code>canister_composite_query &lt;name&gt;</code> exceeds 1,000, or</p></li><li><p>the sum of <code>&lt;name&gt;</code> lengths in all exported functions called <code>canister_update &lt;name&gt;</code>, <code>canister_query &lt;name&gt;</code>, or <code>canister_composite_query &lt;name&gt;</code> exceeds 20,000, or</p></li><li><p>the total size of the custom sections (the sum of <code>&lt;name&gt;</code> lengths in their names <code>icp:public &lt;name&gt;</code> and <code>icp:private &lt;name&gt;</code> plus the sum of their content lengths) exceeds 1MiB.</p></li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="interpretation-of-numbers">Interpretation of numbers<a href="#interpretation-of-numbers" class="hash-link" aria-label="Direct link to Interpretation of numbers" title="Direct link to Interpretation of numbers">â</a></h3><p>WebAssembly number types (<code>i32</code>, <code>i64</code>) do not indicate if the numbers are to be interpreted as signed or unsigned. Unless noted otherwise, whenever the System API interprets them as numbers (e.g. memory pointers, buffer offsets, array sizes), they are to be interpreted as unsigned.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="entry-points">Entry points<a href="#entry-points" class="hash-link" aria-label="Direct link to Entry points" title="Direct link to Entry points">â</a></h3><p>The canister provides entry points which are invoked by the IC under various circumstances:</p><ul><li><p>The canister may export a function with name <code>canister_init</code> and type <code>() -&gt; ()</code>.</p></li><li><p>The canister may export a function with name <code>canister_pre_upgrade</code> and type <code>() -&gt; ()</code>.</p></li><li><p>The canister may export a function with name <code>canister_post_upgrade</code> and type <code>() -&gt; ()</code>.</p></li><li><p>The canister may export functions with name <code>canister_inspect_message</code> with type <code>() -&gt; ()</code>.</p></li><li><p>The canister may export a function with name <code>canister_heartbeat</code> with type <code>() -&gt; ()</code>.</p></li><li><p>The canister may export a function with name <code>canister_global_timer</code> with type <code>() -&gt; ()</code>.</p></li><li><p>The canister may export functions with name <code>canister_update &lt;name&gt;</code> and type <code>() -&gt; ()</code>.</p></li><li><p>The canister may export functions with name <code>canister_query &lt;name&gt;</code> and type <code>() -&gt; ()</code>.</p></li><li><p>The canister may export functions with name <code>canister_composite_query &lt;name&gt;</code> and type <code>() -&gt; ()</code>.</p></li><li><p>The canister table may contain functions of type <code>(env : I) -&gt; ()</code> which may be used as callbacks for inter-canister calls and composite query methods.
The value of <code>I â {i32, i64}</code> specifying whether the imported functions have 32-bit or 64-bit pointers
is derived from the bit-width of the declared memory defaulting to <code>I = i32</code> if the canister declares no memory.</p></li></ul><p>If the execution of any of these entry points traps for any reason, then all changes to the WebAssembly state, as well as the effect of any externally visible system call (like <code>ic0.msg_reply</code>, <code>ic0.msg_reject</code>, <code>ic0.call_perform</code>), are discarded. For upgrades, this transactional behavior applies to the <code>canister_pre_upgrade</code>/<code>canister_post_upgrade</code> sequence as a whole.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-init">Canister initialization<a href="#system-api-init" class="hash-link" aria-label="Direct link to Canister initialization" title="Direct link to Canister initialization">â</a></h4><p>If <code>canister_init</code> is present, then this is the first exported WebAssembly function invoked by the IC. The argument that was passed along with the canister initialization call (see <a href="#ic-install_code">IC method</a>) is available to the canister via <code>ic0.msg_arg_data_size/copy</code>.</p><p>The IC assumes the canister to be fully instantiated if the <code>canister_init</code> method entry point returns. If the <code>canister_init</code> method entry point traps, then canister installation has failed, and the canister is reverted to its previous state (i.e. empty with <code>install</code>, or whatever it was for a <code>reinstall</code>).</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-upgrades">Canister upgrades<a href="#system-api-upgrades" class="hash-link" aria-label="Direct link to Canister upgrades" title="Direct link to Canister upgrades">â</a></h4><p>When a canister is upgraded to a new WebAssembly module, the IC:</p><ol><li><p>Invokes <code>canister_pre_upgrade</code> (if exported by the current canister code and <code>skip_pre_upgrade</code> is not <code>opt true</code>) on the old instance, to give the canister a chance to clean up (e.g. move data to <a href="#system-api-stable-memory">stable memory</a>).</p></li><li><p>Instantiates the new module, including the execution of <code>(start)</code>, with a fresh WebAssembly state.</p></li><li><p>Invokes <code>canister_post_upgrade</code> (if present) on the new instance, passing the <code>arg</code> provided in the <code>install_code</code> call (<a href="#ic-install_code">IC method</a>).</p></li></ol><p>The stable memory is preserved throughout the process; the WebAssembly memory is discarded unless <code>wasm_memory_persistence</code> is <code>opt keep</code>; any other WebAssembly state is discarded.</p><p>During these steps, no other entry point of the old or new canister is invoked. The <code>canister_init</code> function of the new canister is <em>not</em> invoked.</p><p>These steps are atomic: If <code>canister_pre_upgrade</code> or <code>canister_post_upgrade</code> trap, the upgrade has failed, and the canister is reverted to the previous state. Otherwise, the upgrade has succeeded, and the old instance is discarded.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>The <code>skip_pre_upgrade</code> flag can be enabled to skip the execution of the <code>canister_pre_upgrade</code> method on the old canister instance.
The main purpose of this mode is recovery from cases when the <code>canister_pre_upgrade</code> hook traps unconditionally preventing the normal upgrade path.</p><p>Skipping the pre-upgrade can lead to data loss.
Use it only as the last resort and only if the stable memory already contains the entire canister state.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-requests">Public methods<a href="#system-api-requests" class="hash-link" aria-label="Direct link to Public methods" title="Direct link to Public methods">â</a></h4><p>To define a public method of name <code>name</code>, a WebAssembly module exports a function with name <code>canister_update &lt;name&gt;</code>, <code>canister_query &lt;name&gt;</code>, or <code>canister_composite_query &lt;name&gt;</code> and type <code>() -&gt; ()</code>. We call this the <em>method entry point</em>. The name of the exported function distinguishes update, query, and composite query methods.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>The space in <code>canister_update &lt;name&gt;</code>, <code>canister_query &lt;name&gt;</code>, and <code>canister_composite_query &lt;name&gt;</code>, resp., is intentional. There is exactly one space between <code>canister_update/canister_query/canister_composite_query</code> and the <code>&lt;name&gt;</code>.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>The argument of the call (e.g. the content of the <code>arg</code> field in the <a href="#http-call">API request to call a canister method</a>) is copied into the canister on demand using the System API functions shown below.</p><p>Eventually, a method will want to send a response, using <code>ic0.reply</code> or <code>ic0.reject</code></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="heartbeat">Heartbeat<a href="#heartbeat" class="hash-link" aria-label="Direct link to Heartbeat" title="Direct link to Heartbeat">â</a></h4><p>For periodic or time-based execution, the WebAssembly module can export a function with name <code>canister_heartbeat</code>. The heartbeats scheduling algorithm is implementation-defined.</p><p><code>canister_heartbeat</code> is triggered by the IC, and therefore has no arguments and cannot reply or reject. Still, the function <code>canister_heartbeat</code> can initiate new calls.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>While an implementation will likely try to keep the interval between <code>canister_heartbeat</code> invocations to within a few seconds, this is not formally part of this specification.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="global-timer">Global timer<a href="#global-timer" class="hash-link" aria-label="Direct link to Global timer" title="Direct link to Global timer">â</a></h4><p>For time-based execution, the WebAssembly module can export a function with name <code>canister_global_timer</code>. This function is called if the canister has set its global timer (using the System API function <code>ic0.global_timer_set</code>) and the current time (as returned by the System API function <code>ic0.time</code>) has passed the value of the global timer.</p><p>Once the function <code>canister_global_timer</code> is scheduled, the canister&#x27;s global timer is deactivated. The global timer is also deactivated upon changes to the canister&#x27;s Wasm module (calling <code>install_code</code>, <code>install_chunked_code</code>, <code>uninstall_code</code> methods of the management canister or if the canister runs out of cycles). In particular, the function <code>canister_global_timer</code> won&#x27;t be scheduled again unless the canister sets the global timer again (using the System API function <code>ic0.global_timer_set</code>). The global timer scheduling algorithm is implementation-defined.</p><p><code>canister_global_timer</code> is triggered by the IC, and therefore has no arguments and cannot reply or reject. Still, the function <code>canister_global_timer</code> can initiate new calls.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>While an implementation will likely try to keep the interval between the value of the global timer and the time-stamp of the <code>canister_global_timer</code> invocation within a few seconds, this is not formally part of this specification.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="callbacks">Callbacks<a href="#callbacks" class="hash-link" aria-label="Direct link to Callbacks" title="Direct link to Callbacks">â</a></h4><p>Callbacks are addressed by their table index (as a proxy for a Wasm <code>funcref</code>).</p><p>In the reply callback of a <a href="#system-api-call">inter-canister method call</a>, the argument refers to the response to that call. In reject callbacks, no argument is available.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="replicated-and-non-replicated-execution-mode">Replicated and Non-Replicated execution mode<a href="#replicated-and-non-replicated-execution-mode" class="hash-link" aria-label="Direct link to Replicated and Non-Replicated execution mode" title="Direct link to Replicated and Non-Replicated execution mode">â</a></h3><p>Canister methods can be executed either in <em>replicated</em> mode where the method runs on all subnet nodes and the results go through consensus or in <em>non-replicated</em> mode where the method runs on a single node and the result does not go through consensus. The trade-off between replicated and non-replicated mode is therefore one between the result&#x27;s latency and trustworthiness.</p><p>The following table captures the modes that different canister methods can be executed in.</p><table><thead><tr><th>Canister method</th><th>Replicated Mode</th><th>Non-Replicated Mode</th></tr></thead><tbody><tr><td>canister_update</td><td>Yes</td><td>No</td></tr><tr><td>canister_query</td><td>Yes</td><td>Yes</td></tr><tr><td>canister_composite_query</td><td>No</td><td>Yes</td></tr><tr><td>canister_inspect_message</td><td>No</td><td>Yes</td></tr><tr><td>canister_init</td><td>Yes</td><td>No</td></tr><tr><td>canister_pre_upgrade</td><td>Yes</td><td>No</td></tr><tr><td>canister_post_upgrade</td><td>Yes</td><td>No</td></tr><tr><td>canister_heartbeat</td><td>Yes</td><td>No</td></tr><tr><td>canister_global_timer</td><td>Yes</td><td>No</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-imports">Overview of imports<a href="#system-api-imports" class="hash-link" aria-label="Direct link to Overview of imports" title="Direct link to Overview of imports">â</a></h3><div class="admonition_WoCw admonitionNote_L5_h"><p>The 32-bit stable memory System API (<code>ic0.stable_size</code>, <code>ic0.stable_grow</code>, <code>ic0.stable_write</code>, and <code>ic0.stable_read</code>) is DEPRECATED. Canister developers are advised to use the 64-bit stable memory System API instead.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>The following sections describe various System API functions, also referred to as system calls, which we summarize here.</p><p>In the following, the value of <code>I â {i32, i64}</code> specifies whether the imported functions have 32-bit or 64-bit pointers.
Given a canister module, the value of <code>I â {i32, i64}</code> is derived from the bit-width of the declared memory
defaulting to <code>I = i32</code> if the canister declares no memory.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_arg_data_size : () -&gt; I;                                                      // I U RQ NRQ CQ Ry CRy F</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_arg_data_copy : (dst : I, offset : I, size : I) -&gt; ();                        // I U RQ NRQ CQ Ry CRy F</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_caller_size : () -&gt; I;                                                        // *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_caller_copy : (dst : I, offset : I, size : I) -&gt; ();                          // *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_reject_code : () -&gt; i32;                                                      // Ry Rt CRy CRt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_reject_msg_size : () -&gt; I  ;                                                  // Rt CRt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_reject_msg_copy : (dst : I, offset : I, size : I) -&gt; ();                      // Rt CRt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_reply_data_append : (src : I, size : I) -&gt; ();                                // U RQ NRQ CQ Ry Rt CRy CRt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_reply : () -&gt; ();                                                             // U RQ NRQ CQ Ry Rt CRy CRt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_reject : (src : I, size : I) -&gt; ();                                           // U RQ NRQ CQ Ry Rt CRy CRt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_cycles_available128 : (dst : I) -&gt; ();                                        // U Rt Ry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_cycles_refunded128 : (dst : I) -&gt; ();                                         // Rt Ry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_cycles_accept128 : (max_amount_high : i64, max_amount_low: i64, dst : I)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                           -&gt; ();                                                         // U Rt Ry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.cycles_burn128 : (amount_high : i64, amount_low : i64, dst : I)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                           -&gt; ();                                                         // I G U Ry Rt C T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.canister_self_size : () -&gt; I;                                                     // *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.canister_self_copy : (dst : I, offset : I, size : I) -&gt; ();                       // *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.canister_cycle_balance128 : (dst : I) -&gt; ();                                      // *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.canister_status : () -&gt; i32;                                                      // *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.canister_version : () -&gt; i64;                                                     // *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_method_name_size : () -&gt; I;                                                   // F</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_method_name_copy : (dst : I, offset : I, size : I) -&gt; ();                     // F</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.accept_message : () -&gt; ();                                                        // F</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.call_new :</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ( callee_src  : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        callee_size : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        name_src    : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        name_size   : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        reply_fun   : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        reply_env   : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        reject_fun  : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        reject_env  : I</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ) -&gt; ();                                                                            // U CQ Ry Rt CRy CRt T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.call_on_cleanup : (fun : I, env : I) -&gt; ();                                       // U CQ Ry Rt CRy CRt T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.call_data_append : (src : I, size : I) -&gt; ();                                     // U CQ Ry Rt CRy CRt T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.call_cycles_add128 : (amount_high : i64, amount_low: i64) -&gt; ();                  // U Ry Rt T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.call_perform : () -&gt; ( err_code : i32 );                                          // U CQ Ry Rt CRy CRt T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.stable64_size : () -&gt; (page_count : i64);                                         // * s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.stable64_grow : (new_pages : i64) -&gt; (old_page_count : i64);                      // * s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.stable64_write : (offset : i64, src : i64, size : i64) -&gt; ();                     // * s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.stable64_read : (dst : i64, offset : i64, size : i64) -&gt; ();                      // * s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.certified_data_set : (src : I, size : I) -&gt; ();                                   // I G U Ry Rt T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.data_certificate_present : () -&gt; i32;                                             // *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.data_certificate_size : () -&gt; I;                                                  // NRQ CQ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.data_certificate_copy : (dst : I, offset : I, size : I) -&gt; ();                    // NRQ CQ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.time : () -&gt; (timestamp : i64);                                                   // *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.global_timer_set : (timestamp : i64) -&gt; i64;                                      // I G U Ry Rt C T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.performance_counter : (counter_type : i32) -&gt; (counter : i64);                    // * s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.is_controller: (src : I, size : I) -&gt; ( result: i32);                             // * s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.in_replicated_execution: () -&gt; (result: i32);                                     // * s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.debug_print : (src : I, size : I) -&gt; ();                                          // * s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.trap : (src : I, size : I) -&gt; ();                                                 // * s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The following System API functions are only available if <code>I = i32</code>, i.e., if the bit-width of the declared memory is 32
or if the canister declares no memory.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_cycles_available : () -&gt; i64;                                                 // U Rt Ry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_cycles_refunded : () -&gt; i64;                                                  // Rt Ry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.msg_cycles_accept : (max_amount : i64) -&gt; (amount : i64);                         // U Rt Ry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.canister_cycle_balance : () -&gt; i64;                                               // *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.call_cycles_add : (amount : i64) -&gt; ();                                           // U Ry Rt T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.stable_size : () -&gt; (page_count : i32);                                           // * s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.stable_grow : (new_pages : i32) -&gt; (old_page_count : i32);                        // * s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.stable_write : (offset : i32, src : i32, size : i32) -&gt; ();                       // * s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ic0.stable_read : (dst : i32, offset : i32, size : i32) -&gt; ();                        // * s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The comment after each function lists from where these functions may be invoked:</p><ul><li><p><code>I</code>: from <code>canister_init</code> or <code>canister_post_upgrade</code></p></li><li><p><code>G</code>: from <code>canister_pre_upgrade</code></p></li><li><p><code>U</code>: from <code>canister_update â¦</code></p></li><li><p><code>RQ</code>: from <code>canister_query â¦</code> in replicated mode</p></li><li><p><code>NRQ</code>: from <code>canister_query â¦</code> in non-replicated mode</p></li><li><p><code>CQ</code>: from <code>canister_composite_query â¦</code></p></li><li><p><code>Ry</code>: from a reply callback</p></li><li><p><code>Rt</code>: from a reject callback</p></li><li><p><code>CRy</code>: from a reply callback in composite query</p></li><li><p><code>CRt</code>: from a reject callback in composite query</p></li><li><p><code>C</code>: from a cleanup callback</p></li><li><p><code>CC</code>: from a cleanup callback in composite query</p></li><li><p><code>s</code>: the <code>(start)</code> module initialization function</p></li><li><p><code>F</code>: from <code>canister_inspect_message</code></p></li><li><p><code>T</code>: from <em>system task</em> (<code>canister_heartbeat</code> or <code>canister_global_timer</code>)</p></li><li><p><code>*</code> = <code>I G U RQ NRQ CQ Ry Rt CRy CRt C CC F T</code> (NB: Not <code>(start)</code>)</p></li></ul><p>If the canister invokes a system call from somewhere else, it will trap.</p><p>Since Wasm doesn&#x27;t have a 128-bit number type, calls requiring 128-bit arguments (e.g., the 128-bit versions of cycle operations) encode such arguments as a pair of 64-bit numbers containing the high and low bits.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="blob-typed-arguments-and-results">Blob-typed arguments and results<a href="#blob-typed-arguments-and-results" class="hash-link" aria-label="Direct link to Blob-typed arguments and results" title="Direct link to Blob-typed arguments and results">â</a></h3><p>WebAssembly functions parameter and result types can only be primitive number types. To model functions that accept or return blobs or text values, the following idiom is used:</p><p>To provide access to a string or blob <code>foo</code>, the System API provides two functions:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.foo_size : () -&gt; I; I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.foo_copy : (dst : I, offset : I, size : I) -&gt; (); I â {i32, i64}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The <code>*_size</code> function indicates the size, in bytes, of <code>foo</code>. The <code>*_copy</code> function copies <code>size</code> bytes from <code>foo[offset..offset+size]</code> to <code>memory[dst..dst+size]</code>. This traps if <code>offset+size</code> is greater than the size of <code>foo</code>, or if <code>dst+size</code> exceeds the size of the Wasm memory.</p><p>Dually, a System API function that conceptually takes a blob or string as a parameter <code>foo</code> has two parameters:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.set_foo : (src : I, size : I) -&gt; â¦; I â {i32, i64}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>which copies, at the time of function invocation, the data referred to by <code>src</code>/<code>size</code> out of the canister. Unless otherwise noted, this traps if <code>src+size</code> exceeds the size of the WebAssembly memory.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="method-arguments">Method arguments<a href="#method-arguments" class="hash-link" aria-label="Direct link to Method arguments" title="Direct link to Method arguments">â</a></h3><p>The canister can access an argument. For <code>canister_init</code>, <code>canister_post_upgrade</code> and method entry points, the argument is the argument of the call; in a reply callback, it refers to the received reply. So the lifetime of the argument data is a single WebAssembly function execution, not the whole method call tree.</p><ul><li><p><code>ic0.msg_arg_data_size : () â I</code> and <code>ic0.msg_arg_data_copy : (dst : I, offset : I, size : I) â ()</code>; <code>I â {i32, i64}</code></p><p>The message argument data.</p></li><li><p><code>ic0.msg_caller_size : () â I</code> and <code>ic0.msg_caller_copy : (dst : I, offset : I, size : I) â ()</code>; <code>I â {i32, i64}</code></p><p>The identity of the caller, which may be a canister id or a user id. During canister installation or upgrade, this is the id of the user or canister requesting the installation or upgrade. During a system task (heartbeat or global timer), this is the id of the management canister.</p></li><li><p><code>ic0.msg_reject_code : () â i32</code></p><p>Returns the reject code, if the current function is invoked as a reject callback.</p><p>It returns the special &quot;no error&quot; code <code>0</code> if the callback is <em>not</em> invoked as a reject callback; this allows canisters to use a single entry point for both the reply and reject callback, if they choose to do so.</p></li><li><p><code>ic0.msg_reject_msg_size : () â I</code> and <code>ic0.msg_reject_msg_copy : (dst : I, offset : I, size : I) â ()</code>; <code>I â {i32, i64}</code></p><p>The reject message. Traps if there is no reject message (i.e. if <code>reject_code</code> is <code>0</code>).</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="responding">Responding<a href="#responding" class="hash-link" aria-label="Direct link to Responding" title="Direct link to Responding">â</a></h3><p>Eventually, the canister will want to respond to the original call, either by replying (indicating success) or rejecting (signalling an error):</p><ul><li><p><code>ic0.msg_reply_data_append : (src : I, size : I) â ()</code>; <code>I â {i32, i64}</code></p><p>Appends data it to the (initially empty) data reply. Traps if the total appended data exceeds the <a href="https://internetcomputer.org/docs/current/developer-docs/backend/resource-limits#resource-constraints-and-limits" target="_blank" rel="noopener noreferrer">maximum response size</a>.</p><p>This traps if the current call already has been or does not need to be responded to.</p><p>Any data assembled, but not replied using <code>ic0.msg_reply</code>, gets discarded at the end of the current message execution. In particular, the reply buffer gets reset when the canister yields control without calling <code>ic0.msg_reply</code>.</p></li></ul><div class="admonition_WoCw admonitionNote_L5_h"><p>This can be invoked multiple times within the same message execution to build up the argument with data from various places on the Wasm heap. This way, the canister does not have to first copy all the pieces from various places into one location.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><ul><li><p><code>ic0.msg_reply : () â ()</code></p><p>Replies to the sender with the data assembled using <code>ic0.msg_reply_data_append</code>.</p><p>This function can be called at most once (a second call will trap), and must be called exactly once to indicate success.</p><p>See <a href="#system-api-cycles">Cycles</a> for how this interacts with cycles available on this call.</p></li><li><p><code>ic0.msg_reject : (src : I, size : I) â ()</code>; <code>I â {i32, i64}</code></p><p>Rejects the call. The data referred to by <code>src</code>/<code>size</code> is used for the diagnostic message.</p><p>This system call traps if <code>src+size</code> exceeds the size of the WebAssembly memory, or if the current call already has been or does not need to be responded to, or if the data referred to by <code>src</code>/<code>size</code> is not valid UTF8.</p><p>The other end will receive this reject with reject code <code>CANISTER_REJECT</code>, see <a href="#reject-codes">Reject codes</a>.</p><p>Possible reply data assembled using <code>ic0.msg_reply_data_append</code> is discarded.</p><p>See <a href="#system-api-cycles">Cycles</a> for how this interacts with cycles available on this call.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-inspect-message">Ingress message inspection<a href="#system-api-inspect-message" class="hash-link" aria-label="Direct link to Ingress message inspection" title="Direct link to Ingress message inspection">â</a></h3><p>A canister can inspect ingress messages before executing them. When the IC receives an update call from a user, the IC will use the canister method <code>canister_inspect_message</code> to determine whether the message shall be accepted. If the canister is empty (i.e. does not have a Wasm module), then the ingress message will be rejected. If the canister is not empty and does not implement <code>canister_inspect_message</code>, then the ingress message will be accepted.</p><p>In <code>canister_inspect_message</code>, the canister can determine the name of the method called by the message using <code>ic0.msg_method_name_size : () â I</code> and <code>ic0.msg_method_name_copy : (dst : I, offset : I, size : I) â ()</code>; <code>I â {i32, i64}</code>.</p><p>In <code>canister_inspect_message</code>, the canister can accept the message by invoking <code>ic0.accept_message : () â ()</code>. This function traps if invoked twice. If the canister traps in <code>canister_inspect_message</code> or does not call <code>ic0.accept_message</code>, then the access is denied.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>The <code>canister_inspect_message</code> is executed by a single node and thus its outcome depends on the state of this node.
In particular, the <code>canister_inspect_message</code> might be executed on a state that does not reflect the changes
made by a previously successfully completed update call if the <code>canister_inspect_message</code> is executed by a node
that is not up-to-date in terms of its state.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><div class="admonition_WoCw admonitionNote_L5_h"><p>The <code>canister_inspect_message</code> is <em>not</em> invoked for query calls, inter-canister calls or calls to the management canister.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-canister-self">Self-identification<a href="#system-api-canister-self" class="hash-link" aria-label="Direct link to Self-identification" title="Direct link to Self-identification">â</a></h3><p>A canister can learn about its own identity:</p><ul><li><p><code>ic0.canister_self_size : () â I</code> and <code>ic0.canister_self_copy: (dst : I, offset : I, size : I) â ()</code>; <code>I â {i32, i64}</code></p><p>These functions allow the canister to query its own canister id (as a blob).</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-canister-status">Canister status<a href="#system-api-canister-status" class="hash-link" aria-label="Direct link to Canister status" title="Direct link to Canister status">â</a></h3><p>This function allows a canister to find out if it is running, stopping or stopped (see <a href="#ic-canister_status">IC method</a> and <a href="#ic-stop_canister">IC method</a> for context).</p><ul><li><p><code>ic0.canister_status : () â i32</code></p><p>returns the current status of the canister:</p><p>Status <code>1</code> indicates running, <code>2</code> indicates stopping, and <code>3</code> indicates stopped.</p><p>Observing the canister status is particularly useful during <code>canister_post_upgrade</code>. Confirming that the status is 3 (stopped) helps prevent accidentally upgrading a canister that has not fully stopped.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-canister-version">Canister version<a href="#system-api-canister-version" class="hash-link" aria-label="Direct link to Canister version" title="Direct link to Canister version">â</a></h3><p>For each canister, the system maintains a <em>canister version</em>. Upon canister creation, it is set to 0, and it is <strong>guaranteed</strong> to be incremented upon every change of the canister&#x27;s code, settings, running status (Running, Stopping, Stopped), and memory (WASM and stable memory), i.e., upon every successful management canister call of methods <code>update_settings</code>, <code>load_canister_snapshot</code>, <code>install_code</code>, <code>install_chunked_code</code>, <code>uninstall_code</code>, <code>start_canister</code>, and <code>stop_canister</code> on that canister, code uninstallation due to that canister running out of cycles, canister&#x27;s running status transitioning from Stopping to Stopped, and successful execution of update methods, response callbacks, heartbeats, and global timers. The system can arbitrarily increment the canister version also if the canister&#x27;s code, settings, running status, and memory do not change.</p><ul><li><p><code>ic0.canister_version : () â i64</code></p><p>returns the current canister version.</p></li></ul><p>During the canister upgrade process, <code>canister_pre_upgrade</code> sees the old counter value, and <code>canister_post_upgrade</code> sees the new counter value.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-call">Inter-canister method calls<a href="#system-api-call" class="hash-link" aria-label="Direct link to Inter-canister method calls" title="Direct link to Inter-canister method calls">â</a></h3><p>When handling an update call (or a callback), a canister can do further calls to another canister. Calls are assembled in a builder-like fashion, starting with <code>ic0.call_new</code>, adding more attributes using the <code>ic0.call_*</code> functions, and eventually performing the call with <code>ic0.call_perform</code>.</p><ul><li><code>ic0.call_new :
( callee_src  : I,
  callee_size : I,
  name_src    : I,
  name_size   : I,
  reply_fun   : I,
  reply_env   : I,
  reject_fun  : I,
  reject_env  : I,
) â ()</code>; <code>I â {i32, i64}</code></li></ul><p>Begins assembling a call to the canister specified by <code>callee_src/_size</code> at method <code>name_src/_size</code>.</p><p>The IC records two mandatory callback functions, represented by a table entry index <code>*_fun</code> and some additional value <code>*_env</code>. When the response comes back, the table is read at the corresponding index, expected to be a function of type <code>(env : I) -&gt; ()</code>, and passed the corresponding <code>*_env</code> value.</p><p>The reply callback is executed upon successful completion of the method call, which can query the reply using <code>ic0.msg_arg_data_*</code>.</p><p>The reject callback is executed if the method call fails asynchronously or the other canister explicitly rejects the call. The reject code and message can be queried using <code>ic0.msg_reject_code</code> and <code>ic0.msg_reject_msg_*</code>.</p><p>Subsequent calls to the following functions set further attributes of that call, until the call is concluded (with <code>ic0.call_perform</code>) or discarded (by returning without calling <code>ic0.call_perform</code> or by starting a new call with <code>ic0.call_new</code>.)</p><ul><li><code>ic0.call_on_cleanup : (fun : I, env : I) â ()</code>; <code>I â {i32, i64}</code></li></ul><p>If a cleanup callback (of type <code>(env : I) -&gt; ()</code>) is specified for this call, it is executed if and only if the <code>reply</code> or the <code>reject</code> callback was executed and trapped (for any reason).</p><p>During the execution of the <code>cleanup</code> function, only a subset of the System API is available (namely <code>ic0.debug_print</code>, <code>ic0.trap</code> and the <code>ic0.stable_*</code> functions). The cleanup function is expected to run swiftly (within a fixed, yet to be specified cycle limit) and serves to free resources associated with the callback.</p><p>If this traps (e.g. runs out of cycles), the state changes from the <code>cleanup</code> function are discarded, as usual, and no further actions are taken related to that call. Canisters likely want to avoid this from happening.</p><p>There must be at most one call to <code>ic0.call_on_cleanup</code> between <code>ic0.call_new</code> and <code>ic0.call_perform</code>.</p><ul><li><p><code>ic0.call_data_append : (src : I, size : I) -&gt; ()</code>; <code>I â {i32, i64}</code></p><p>Appends the specified bytes to the argument of the call. Initially, the argument is empty. Traps if the total appended data exceeds the <a href="https://internetcomputer.org/docs/current/developer-docs/backend/resource-limits#resource-constraints-and-limits" target="_blank" rel="noopener noreferrer">maximum inter-canister call payload</a>.</p><p>This may be called multiple times between <code>ic0.call_new</code> and <code>ic0.call_perform</code>.</p></li><li><p><code>ic0.call_cycles_add : (amount : i64) -&gt; ()</code></p><p>This system call moves cycles from the canister balance onto the call under construction, to be transferred with that call.</p><p>The cycles are deducted from the balance as shown by <code>ic0.canister_cycle_balance128</code> immediately, and moved back if the call cannot be performed (e.g. if <code>ic0.call_perform</code> signals an error, if the canister invokes <code>ic0.call_new</code>, or returns without calling <code>ic0.call_perform</code>).</p><p>This system call may be called multiple times between <code>ic0.call_new</code> and <code>ic0.call_perform</code>.</p><p>This system call traps if there is no call under construction, i.e., if not called between <code>ic0.call_new</code> and <code>ic0.call_perform</code>.</p><p>This system call traps if trying to transfer more cycles than are in the current balance of the canister.</p><p>This system call traps if the cycle balance of the canister after transferring cycles decreases below the canister&#x27;s freezing limit.</p></li><li><p><code>ic0.call_cycles_add128 : (amount_high : i64, amount_low : i64) -&gt; ()</code></p><p>This system call moves cycles from the canister balance onto the call under construction, to be transferred with that call.</p><p>The amount of cycles it moves is represented by a 128-bit value which can be obtained by combining the <code>amount_high</code> and <code>amount_low</code> parameters.</p><p>The cycles are deducted from the balance as shown by <code>ic0.canister_cycles_balance128</code> immediately, and moved back if the call cannot be performed (e.g. if <code>ic0.call_perform</code> signals an error, if the canister invokes <code>ic0.call_new</code>, or returns without calling <code>ic0.call_perform</code>).</p><p>This system call may be called multiple times between <code>ic0.call_new</code> and <code>ic0.call_perform</code>.</p><p>This system call traps if there is no call under construction, i.e., if not called between <code>ic0.call_new</code> and <code>ic0.call_perform</code>.</p><p>This system call traps if trying to transfer more cycles than are in the current balance of the canister.</p><p>This system call traps if the cycle balance of the canister after transferring cycles decreases below the canister&#x27;s freezing limit.</p></li><li><p><code>ic0.call_perform  : () -&gt; ( err_code : i32 )</code></p><p>This concludes assembling the call. It queues the call message to the given destination, but does not actually act on it until the current WebAssembly function returns without trapping.</p><p>This deducts <code>MAX_CYCLES_PER_RESPONSE</code> cycles from the canister balance and sets them aside for response processing.</p><p>If the function returns <code>0</code> as the <code>err_code</code>, the IC was able to enqueue the call. In this case, the call will either be delivered, returned because the destination canister does not exist, returned due to a lack of resources within the IC, or returned because of an out of cycles condition. This also means that exactly one of the reply or reject callbacks will be executed.</p><p>If the function returns a non-zero value, the call cannot (and will not be) performed. This can happen due to a lack of resources within the IC, but also if it would reduce the current cycle balance to a level below where the canister would be frozen.</p><p>After <code>ic0.call_perform</code> and before the next call to <code>ic0.call_new</code>, all other <code>ic0.call_*</code> function calls trap.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-cycles">Cycles<a href="#system-api-cycles" class="hash-link" aria-label="Direct link to Cycles" title="Direct link to Cycles">â</a></h3><p>Each canister maintains a balance of <em>cycles</em>, which are used to pay for platform usage. Cycles are represented by 128-bit values.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>This specification currently does not go into details about which actions cost how many cycles and/or when. In general, you must assume that the canister&#x27;s cycle balance can change arbitrarily between method executions, and during each System API function call, unless explicitly mentioned otherwise.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><ul><li><p><code>ic0.canister_cycle_balance : () â i64</code></p><p>Indicates the current cycle balance of the canister. It is the canister balance before the execution of the current message, minus a reserve to pay for the execution of the current message, minus any cycles queued up to be sent via <code>ic0.call_cycles_add</code> and <code>ic0.call_cycles_add128</code>. After execution of the message, the IC may add unused cycles from the reserve back to the balance.</p></li></ul><div class="admonition_WoCw admonitionNote_L5_h"><p>This call traps if the current balance does not fit into a 64-bit value. Canisters that need to deal with larger cycles balances should use <code>ic0.canister_cycles_balance128</code> instead.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><ul><li><p><code>ic0.canister_cycle_balance128 : (dst : I) â ()</code>; <code>I â {i32, i64}</code></p><p>Indicates the current cycle balance of the canister by copying the value at the location <code>dst</code> in the canister memory. It is the canister balance before the execution of the current message, minus a reserve to pay for the execution of the current message, minus any cycles queued up to be sent via <code>ic0.call_cycles_add</code> and <code>ic0.call_cycles_add128</code>. After execution of the message, the IC may add unused cycles from the reserve back to the balance.</p></li><li><p><code>ic0.msg_cycles_available : () â i64</code></p><p>Returns the amount of cycles that were transferred by the caller of the current call, and is still available in this message.</p><p>Initially, in the update method entry point, this is the amount that the caller passed to the canister. When cycles are accepted (<code>ic0.msg_cycles_accept</code>), this reports fewer cycles accordingly. When the call is responded to (reply or reject), all available cycles are refunded to the caller, and this will return 0.</p></li></ul><div class="admonition_WoCw admonitionNote_L5_h"><p>This call traps if the amount of cycles available does not fit into a 64-bit value. Please use <code>ic0.msg_cycles_available128</code> instead.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><ul><li><p><code>ic0.msg_cycles_available128 : (dst : I) â ()</code>; <code>I â {i32, i64}</code></p><p>Indicates the number of cycles transferred by the caller of the current call, still available in this message. The amount of cycles is represented by a 128-bit value. This call copies this value starting at the location <code>dst</code> in the canister memory.</p><p>Initially, in the update method entry point, this is the amount that the caller passed to the canister. When cycles are accepted (<code>ic0.msg_cycles_accept128</code>), this reports fewer cycles accordingly. When the call is responded to (reply or reject), all available cycles are refunded to the caller, and this will report 0 cycles.</p></li><li><p><code>ic0.msg_cycles_accept : (max_amount : i64) â (amount : i64)</code></p><p>This moves cycles from the call to the canister balance. It moves as many cycles as possible, up to these constraints:</p><p>It moves no more cycles than <code>max_amount</code>.</p><p>It moves no more cycles than available according to <code>ic0.msg_cycles_available</code>, and</p><p>It can be called multiple times, each time possibly adding more cycles to the balance.</p><p>The return value indicates how many cycles were actually moved.</p><p>This system call does not trap.</p></li></ul><div class="admonition_WoCw admonitionTip_gXdO"><p>Example: To accept all cycles provided in a call, invoke <code>ic0.msg_cycles_accept(ic0.msg_cycles_available())</code> in the method handler or a callback handler, <em>before</em> calling reply or reject.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#26D76D"></rect><path d="M16.666 8.49c0 2.775-2.5 4.653-2.5 6.843h-1.328c.001-1.386.664-2.55 1.312-3.675.609-1.057 1.183-2.055 1.183-3.169 0-2.072-1.679-3.156-3.336-3.156-1.655 0-3.33 1.084-3.33 3.156 0 1.114.573 2.112 1.182 3.169.648 1.125 1.31 2.29 1.311 3.675H9.833c0-2.19-2.5-4.068-2.5-6.844C7.333 5.594 9.665 4 11.997 4c2.335 0 4.67 1.596 4.67 4.49ZM14 16.332c0 .184-.15.334-.334.334h-3.333a.334.334 0 0 1 0-.667h3.333c.184 0 .334.15.334.333Zm0 1.334c0 .184-.15.333-.334.333h-3.333a.333.333 0 0 1 0-.667h3.333c.184 0 .334.15.334.334Zm-1.134 2.106a.67.67 0 0 1-.502.227h-.729a.67.67 0 0 1-.501-.227l-.968-1.106h3.667l-.967 1.106Zm-2.42-10.898-.792-.102c.173-1.33 1-2.316 2.346-2.565l.146.785c-1.298.24-1.622 1.282-1.7 1.882Z" fill="#fff"></path></svg></div><ul><li><p><code>ic0.msg_cycles_accept128 : (max_amount_high : i64, max_amount_low : i64, dst : I) â ()</code>; <code>I â {i32, i64}</code></p><p>This moves cycles from the call to the canister balance. It moves as many cycles as possible, up to these constraints:</p><p>It moves no more cycles than the amount obtained by combining <code>max_amount_high</code> and <code>max_amount_low</code>. Cycles are represented by 128-bit values.</p><p>It moves no more cycles than available according to <code>ic0.msg_cycles_available128</code>, and</p><p>It can be called multiple times, each time possibly adding more cycles to the balance.</p><p>This call also copies the amount of cycles that were actually moved starting at the location <code>dst</code> in the canister memory.</p><p>This does not trap.</p></li><li><p><code>ic0.cycles_burn128 : (amount_high : i64, amount_low : i64, dst : I) -&gt; ()</code>; <code>I â {i32, i64}</code></p><p>This burns cycles from the canister. It burns as many cycles as possible, up to these constraints:</p><p>It burns no more cycles than the amount obtained by combining <code>amount_high</code> and <code>amount_low</code>. Cycles are represented by 128-bit values.</p><p>It burns no more cycles than the amount of cycles available for spending <code>liquid_balance(balance, reserved_balance, freezing_limit)</code>, where <code>reserved_balance</code> are cycles reserved for resource payments and <code>freezing_limit</code> is the amount of idle cycles burned by the canister during its <code>freezing_threshold</code>.</p><p>It can be called multiple times, each time possibly burning more cycles from the balance.</p><p>This call also copies the amount of cycles that were actually burned starting at the location <code>dst</code> in the canister memory.</p><p>This system call does not trap.</p></li><li><p><code>ic0.msg_cycles_refunded : () â i64</code></p><p>This function can only be used in a callback handler (reply or reject), and indicates the amount of cycles that came back with the response as a refund. The refund has already been added to the canister balance automatically.</p></li></ul><div class="admonition_WoCw admonitionNote_L5_h"><p>This call traps if the amount of cycles refunded does not fit into a 64-bit value. In general, it is recommended to use <code>ic0.msg_cycles_refunded128</code> instead.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><ul><li><p><code>ic0.msg_cycles_refunded128 : (dst : I) â ()</code>; <code>I â {i32, i64}</code></p><p>This function can only be used in a callback handler (reply or reject), and indicates the amount of cycles that came back with the response as a refund. The refund has already been added to the canister balance automatically.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-stable-memory">Stable memory<a href="#system-api-stable-memory" class="hash-link" aria-label="Direct link to Stable memory" title="Direct link to Stable memory">â</a></h3><div class="admonition_WoCw admonitionNote_L5_h"><p>The 32-bit stable memory System API (<code>ic0.stable_size</code>, <code>ic0.stable_grow</code>, <code>ic0.stable_write</code>, and <code>ic0.stable_read</code>) is DEPRECATED. Canister developers are advised to use the 64-bit stable memory System API instead.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>Canisters have the ability to store and retrieve data from a secondary memory. The purpose of this <em>stable memory</em> is to provide space to store data beyond upgrades. The interface mirrors roughly the memory-related instructions of WebAssembly, and tries to be forward compatible with exposing this feature as an additional memory.</p><p>The stable memory is initially empty and can be grown up to the <a href="https://internetcomputer.org/docs/current/developer-docs/backend/resource-limits#resource-constraints-and-limits" target="_blank" rel="noopener noreferrer">Wasm stable memory limit</a> (provided the subnet has capacity).</p><ul><li><p><code>ic0.stable_size : () â (page_count : i32)</code></p><p>returns the current size of the stable memory in WebAssembly pages. (One WebAssembly page is 64KiB)</p><p>This system call traps if the size of the stable memory exceeds 2<sup>32</sup> bytes.</p></li><li><p><code>ic0.stable_grow : (new_pages : i32) â (old_page_count : i32)</code></p><p>tries to grow the memory by <code>new_pages</code> many pages containing zeroes.</p><p>This system call traps if the <em>previous</em> size of the memory exceeds 2<sup>32</sup> bytes.</p><p>If the <em>new</em> size of the memory exceeds 2<sup>32</sup> bytes or growing is unsuccessful, then it returns <code>-1</code>.</p><p>Otherwise, it grows the memory and returns the <em>previous</em> size of the memory in pages.</p></li><li><p><code>ic0.stable_write : (offset : i32, src : i32, size : i32) â ()</code></p><p>copies the data referred to by <code>src</code>/<code>size</code> out of the canister and replaces the corresponding segment starting at <code>offset</code> in the stable memory.</p><p>This system call traps if the size of the stable memory exceeds 2<sup>32</sup> bytes.</p><p>It also traps if <code>src+size</code> exceeds the size of the WebAssembly memory or <code>offset+size</code> exceeds the size of the stable memory.</p></li><li><p><code>ic0.stable_read : (dst : i32, offset : i32, size : i32) â ()</code></p><p>copies the data referred to by <code>offset</code>/<code>size</code> out of the stable memory and replaces the corresponding bytes starting at <code>dest</code> in the canister memory.</p><p>This system call traps if the size of the stable memory exceeds 2<sup>32</sup> bytes.</p><p>It also traps if <code>dst+size</code> exceeds the size of the WebAssembly memory or <code>offset+size</code> exceeds the size of the stable memory</p></li><li><p><code>ic0.stable64_size : () â (page_count : i64)</code></p><p>returns the current size of the stable memory in WebAssembly pages. (One WebAssembly page is 64KiB)</p></li><li><p><code>ic0.stable64_grow : (new_pages : i64) â (old_page_count : i64)</code></p><p>tries to grow the memory by <code>new_pages</code> many pages containing zeroes.</p><p>If successful, returns the <em>previous</em> size of the memory (in pages). Otherwise, returns <code>-1</code>.</p></li><li><p><code>ic0.stable64_write : (offset : i64, src : i64, size : i64) â ()</code></p><p>Copies the data from location <!-- -->[<!-- -->src, src+size) of the canister memory to location <!-- -->[<!-- -->offset, offset+size) in the stable memory.</p><p>This system call traps if <code>src+size</code> exceeds the size of the WebAssembly memory or <code>offset+size</code> exceeds the size of the stable memory.</p></li><li><p><code>ic0.stable64_read : (dst : i64, offset : i64, size : i64) â ()</code></p><p>Copies the data from location <!-- -->[<!-- -->offset, offset+size) of the stable memory to the location <!-- -->[<!-- -->dst, dst+size) in the canister memory.</p><p>This system call traps if <code>dst+size</code> exceeds the size of the WebAssembly memory or <code>offset+size</code> exceeds the size of the stable memory.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-time">System time<a href="#system-api-time" class="hash-link" aria-label="Direct link to System time" title="Direct link to System time">â</a></h3><p>The canister can query the IC for the current time.</p><p><code>ic0.time : () -&gt; i64</code></p><p>The time is given as nanoseconds since 1970-01-01. The IC guarantees that</p><ul><li><p>the time, as observed by the canister, is monotonically increasing, even across canister upgrades.</p></li><li><p>within an invocation of one entry point, the time is constant.</p></li></ul><p>The times observed by different canisters are unrelated, and calls from one canister to another may appear to travel &quot;backwards in time&quot;.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>While an implementation will likely try to keep the time returned by <code>ic0.time</code> close to the real time, this is not formally part of this specification.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="global-timer-1">Global timer<a href="#global-timer-1" class="hash-link" aria-label="Direct link to Global timer" title="Direct link to Global timer">â</a></h3><p>The canister can set a global timer to make the system schedule a call to the exported <code>canister_global_timer</code> Wasm method after the specified time. The time must be provided as nanoseconds since 1970-01-01.</p><p><code>ic0.global_timer_set : (timestamp : i64) -&gt; i64</code></p><p>The function returns the previous value of the timer. If no timer is set before invoking the function, then the function returns zero.</p><p>Passing zero as an argument to the function deactivates the timer and thus prevents the system from scheduling calls to the canister&#x27;s <code>canister_global_timer</code> Wasm method.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-performance-counter">Performance counter<a href="#system-api-performance-counter" class="hash-link" aria-label="Direct link to Performance counter" title="Direct link to Performance counter">â</a></h3><p>The canister can query one of the &quot;performance counters&quot;, which is a deterministic monotonically increasing integer approximating the amount of work the canister has done. Developers might use this data to profile and optimize the canister performance.</p><p><code>ic0.performance_counter : (counter_type : i32) -&gt; i64</code></p><p>The argument <code>type</code> decides which performance counter to return:</p><ul><li><p>0 : current execution instruction counter. The number of WebAssembly instructions the canister has executed since the beginning of the current <a href="#rule-message-execution">Message execution</a>.</p></li><li><p>1 : call context instruction counter.</p><ul><li><p>For replicated message execution, it is the number of WebAssembly instructions the canister has executed within the call context of the current <a href="#rule-message-execution">Message execution</a> since <a href="#call-context-creation">Call context creation</a>. The counter monotonically increases across all <a href="#rule-message-execution">message executions</a> in the call context until the corresponding <a href="#call-context-removal">call context is removed</a>.</p></li><li><p>For non-replicated message execution, it is the number of WebAssembly instructions the canister has executed within the corresponding <code>composite_query_helper</code> in <a href="#query-call">Query call</a>. The counter monotonically increases across the executions of the composite query method and the composite query callbacks until the corresponding <code>composite_query_helper</code> returns (ignoring WebAssembly instructions executed within any further downstream calls of <code>composite_query_helper</code>).</p></li></ul></li></ul><p>In the future, the IC might expose more performance counters.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-replicated-execution-check">Replicated execution check<a href="#system-api-replicated-execution-check" class="hash-link" aria-label="Direct link to Replicated execution check" title="Direct link to Replicated execution check">â</a></h3><p>The canister can check whether it is currently running in replicated or non replicated execution.</p><p><code>ic0.in_replicated_execution : () -&gt; (result: i32)</code></p><p>Returns 1 if the canister is being run in replicated mode and 0 otherwise.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-controller-check">Controller check<a href="#system-api-controller-check" class="hash-link" aria-label="Direct link to Controller check" title="Direct link to Controller check">â</a></h3><p>The canister can check whether a given principal is one of its controllers.</p><p><code>ic0.is_controller : (src : I, size : I) -&gt; (result: i32)</code>; <code>I â {i32, i64}</code></p><p>Checks whether the principal identified by <code>src</code>/<code>size</code> is one of the controllers of the canister. If yes, then a value of 1 is returned, otherwise a 0 is returned. It can be called multiple times.</p><p>This system call traps if <code>src+size</code> exceeds the size of the WebAssembly memory or the principal identified by <code>src</code>/<code>size</code> is not a valid binary encoding of a principal.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-api-certified-data">Certified data<a href="#system-api-certified-data" class="hash-link" aria-label="Direct link to Certified data" title="Direct link to Certified data">â</a></h3><p>For each canister, the IC keeps track of &quot;certified data&quot;, a canister-defined blob. For fresh canisters (upon install or reinstall), this blob is the empty blob (<code>&quot;&quot;</code>).</p><ul><li><p><code>ic0.certified_data_set : (src : I, size : I) -&gt; ()</code>; <code>I â {i32, i64}</code></p><p>The canister can update the certified data with this call. The passed data must be no larger than 32 bytes. This can be used any number of times.</p></li></ul><p>When executing a query or composite query method via a query call (i.e. in non-replicated mode), the canister can fetch a certificate that authenticates to third parties the value last set via <code>ic0.certified_data_set</code>. The certificate is not available in composite query method callbacks and in query and composite query methods evaluated on canisters other than the target canister of the query call.</p><ul><li><p><code>ic0.data_certificate_present : () -&gt; i32</code></p><p>returns <code>1</code> if a certificate is present, and <code>0</code> otherwise.</p><p>This will return <code>1</code> when called from a query or composite query method on the target canister of a query call.</p><p>This will return <code>0</code> for update methods, if a query or composite query method is executed in replicated mode (e.g. when invoked via an update call or inter-canister call), and in composite query method callbacks and in query and composite query methods evaluated on canisters other than the target canister of a query call.</p></li><li><p><code>ic0.data_certificate_size : () â I</code> and <code>ic0.data_certificate_copy : (dst : I, offset : I, size : I) â ()</code>; <code>I â {i32, i64}</code></p><p>Copies the certificate for the current value of the certified data to the canister.</p><p>The certificate is a blob as described in <a href="#certification">Certification</a> that contains the values at path <code>/canister/&lt;canister_id&gt;/certified_data</code> and at path <code>/time</code> of <a href="#state-tree">The system state tree</a>.</p><p>If this <code>certificate</code> includes a subnet delegation, then the id of the current canister will be included in the delegation&#x27;s canister id range.</p><p>This traps if <code>ic0.data_certificate_present()</code> returns <code>0</code>.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debugging-aids">Debugging aids<a href="#debugging-aids" class="hash-link" aria-label="Direct link to Debugging aids" title="Direct link to Debugging aids">â</a></h3><p>In a local canister execution environment, the canister needs a way to emit textual trace messages. On the &quot;real&quot; network, these do not do anything.</p><ul><li><p><code>ic0.debug_print : (src : I, size : I) -&gt; ()</code>; <code>I â {i32, i64}</code></p><p>When executing in an environment that supports debugging, this copies out the data specified by <code>src</code> and <code>size</code>, and logs, prints or stores it in an environment-appropriate way. The copied data may likely be a valid string in UTF8-encoding, but the environment should be prepared to handle binary data (e.g. by printing it in escaped form). The data does typically not include a terminating <code>\0</code> or <code>\n</code>.</p><p>Semantically, this function is always a no-op, and never traps, even if the <code>src+size</code> exceeds the size of the memory, or if this function is executed from <code>(start)</code>. If the environment cannot perform the print, it just skips it.</p></li></ul><p>Similarly, the System API allows the canister to effectively trap, but give some indication about why it trapped:</p><ul><li><p><code>ic0.trap : (src : I, size : I) -&gt; ()</code>; <code>I â {i32, i64}</code></p><p>This function always traps.</p><p>The environment may copy out the data specified by <code>src</code> and <code>size</code>, and log, print or store it in an environment-appropriate way, or include it in system-generated reject messages where appropriate. The copied data may likely be a valid string in UTF8-encoding, but the environment should be prepared to handle binary data (e.g. by printing it in escaped form or substituting invalid characters).</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="host-references">Outlook: Using Host References<a href="#host-references" class="hash-link" aria-label="Direct link to Outlook: Using Host References" title="Direct link to Outlook: Using Host References">â</a></h3><p>The Internet Computer aims to make the most of the WebAssembly platform, and embraces WebAssembly features. With WebAssembly host references, we can make the platform more secure, the interfaces more abstract and more compositional. The above <code>ic0</code> System API does not yet use WebAssembly host references. Once they become available on our platform, a new version of the System API using host references will be available via the <code>ic</code> module. The changes will be, at least</p><ol><li><p>The introduction of a <code>api_nonce</code> reference, which models the capability to use the System API. It is passed as an argument to <code>canister_init</code>, <code>canister_update &lt;name&gt;</code> etc., and expected as an argument by almost all System API function calls. (The debugging aids remain unconstrained.)</p></li><li><p>The use of references, instead of binary blobs, to address principals (user ids, canister ids), e.g. in <code>ic0.msg_caller</code> or in <code>ic0.call_new</code>. Additional functions will be provided to convert between the transparent binary representation of principals and references.</p></li><li><p>Making the builder interface to create calls build calls identified by a reference, rather than having an implicit partial call in the background.</p></li></ol><p>A canister may only use the old <em>or</em> the new interface; the IC detects which interface the canister intends to use based on the names and types of its function imports and exports.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister">The IC management canister<a href="#ic-management-canister" class="hash-link" aria-label="Direct link to The IC management canister" title="Direct link to The IC management canister">â</a></h2><p>The interfaces above provide the fundamental ability for external users and canisters to contact other canisters. But the Internet Computer provides additional functionality, such as canister and user management. This functionality is exposed to external users and canisters via the <em>IC management canister</em>.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>The <em>IC management canister</em> is just a facade; it does not actually exist as a canister (with isolated state, Wasm code, etc.).</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>The IC management canister address is <code>aaaaa-aa</code> (i.e. the empty blob).</p><p>It is possible to use the management canister via external requests (a.k.a. ingress messages). The cost of processing that request is charged to the canister that is being managed. Most methods only permit the controllers to call them. Calls to <code>raw_rand</code> and <code>deposit_cycles</code> are never accepted as ingress messages.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-candid">Interface overview<a href="#ic-candid" class="hash-link" aria-label="Direct link to Interface overview" title="Direct link to Interface overview">â</a></h3><p>The <a target="_blank" href="/assets/files/ic-7522cb51751c612afac45b1fcc449450.did">interface description</a> below, in <a href="https://github.com/dfinity/candid/blob/master/spec/Candid.md" target="_blank" rel="noopener noreferrer">Candid syntax</a>, describes the available functionality.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-candid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-candid codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> canister_id </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> wasm_module </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> snapshot_id </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> log_visibility </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    controllers</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    allowed_viewers </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> canister_settings </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    controllers </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    compute_allocation </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_allocation </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    freezing_threshold </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_cycles_limit </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log_visibility </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> log_visibility</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_memory_limit </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> definite_canister_settings </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    controllers </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    compute_allocation </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_allocation </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    freezing_threshold </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_cycles_limit </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    log_visibility </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> log_visibility</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_memory_limit </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> change_origin </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    from_user </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        user_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    from_canister </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        canister_version </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> change_details </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    creation </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        controllers </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    code_uninstall</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    code_deployment </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        mode </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"> install</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"> reinstall</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"> upgrade </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        module_hash </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    load_snapshot </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      canister_version </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      snapshot_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> snapshot_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      taken_at_timestamp </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    controllers_change </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        controllers </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> change </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    timestamp_nanos </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    origin </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> change_origin</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    details </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> change_details</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> chunk_hash </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  hash </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> http_header </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">text</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    value </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">text</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> http_request_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    status </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    headers </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> http_header</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    body </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> ecdsa_curve </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    secp256k1</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> schnorr_algorithm </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bip340secp256k1</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ed25519</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> satoshi </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_network </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mainnet</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    testnet</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_address </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">text</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_block_hash </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_block_header </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> millisatoshi_per_byte </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_block_height </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat32</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> outpoint </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    txid </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vout </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat32</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> utxo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    outpoint </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> outpoint</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    value </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> satoshi</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    height </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat32</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_get_utxos_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    address </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> bitcoin_address</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    network </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> bitcoin_network</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    filter </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        min_confirmations </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat32</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        page </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_get_utxos_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    utxos </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> utxo</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    tip_block_hash </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> bitcoin_block_hash</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    tip_height </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> bitcoin_block_height</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    next_page </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_get_balance_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    address </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> bitcoin_address</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    network </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> bitcoin_network</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    min_confirmations </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat32</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_get_balance_result </span><span class="token operator">=</span><span class="token plain"> satoshi</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_get_current_fee_percentiles_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    network </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> bitcoin_network</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_get_current_fee_percentiles_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> millisatoshi_per_byte</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_send_transaction_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    transaction </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    network </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> bitcoin_network</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_get_block_headers_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    start_height </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> bitcoin_block_height</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end_height </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> bitcoin_block_height</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    network</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> bitcoin_network</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> bitcoin_get_block_headers_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    tip_height </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> bitcoin_block_height</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    block_headers </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> bitcoin_block_header</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> node_metrics </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    node_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    num_blocks_proposed_total </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    num_block_failures_total </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> create_canister_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    settings </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> canister_settings</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sender_canister_version </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> create_canister_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> update_settings_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    settings </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_settings</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sender_canister_version </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> upload_chunk_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chunk </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> clear_chunk_store_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> stored_chunks_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> canister_install_mode </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    install</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reinstall</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    upgrade </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        skip_pre_upgrade </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">bool</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        wasm_memory_persistence </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            keep</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            replace</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> install_code_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mode </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_install_mode</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_module </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> wasm_module</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    arg </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sender_canister_version </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> install_chunked_code_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mode </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_install_mode</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    target_canister </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    store_canister </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chunk_hashes_list </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> chunk_hash</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_module_hash </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    arg </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sender_canister_version </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> uninstall_code_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sender_canister_version </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> start_canister_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> stop_canister_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> canister_status_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> canister_status_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    status </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"> running</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"> stopping</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"> stopped </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    settings </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> definite_canister_settings</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    module_hash </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_size </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_cycles </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    idle_cycles_burned_per_day </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    query_stats</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        num_calls_total</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        num_instructions_total</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        request_payload_bytes_total</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response_payload_bytes_total</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> canister_info_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    num_requested_changes </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> canister_info_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    total_num_changes </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    recent_changes </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> change</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    module_hash </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    controllers </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> delete_canister_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> deposit_cycles_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> http_request_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    url </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">text</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    max_response_bytes </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    method </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"> get</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"> head</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"> post </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    headers </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> http_header</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    body </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    transform </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        function </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">func</span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"> response </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> http_request_result</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"> context </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">http_request_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">query</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        context </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> ecdsa_public_key_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    derivation_path </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    key_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"> curve </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> ecdsa_curve</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"> name </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">text</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> ecdsa_public_key_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public_key </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chain_code </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> sign_with_ecdsa_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    message_hash </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    derivation_path </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    key_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"> curve </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> ecdsa_curve</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"> name </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">text</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> sign_with_ecdsa_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    signature </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> schnorr_public_key_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    derivation_path </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    key_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"> algorithm </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> schnorr_algorithm</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"> name </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">text</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> schnorr_public_key_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public_key </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chain_code </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> schnorr_aux </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">variant</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bip341</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      merkle_root_hash</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> sign_with_schnorr_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    message </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    derivation_path </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    key_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"> algorithm </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> schnorr_algorithm</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"> name </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">text</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aux</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> schnorr_aux</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> sign_with_schnorr_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    signature </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> node_metrics_history_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    subnet_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    start_at_timestamp_nanos </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> node_metrics_history_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    timestamp_nanos </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    node_metrics </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> node_metrics</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> subnet_info_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    subnet_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">principal</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> subnet_info_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    replica_version </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">text</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> provisional_create_canister_with_cycles_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    amount </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    settings </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> canister_settings</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    specified_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sender_canister_version </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> provisional_create_canister_with_cycles_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> provisional_top_up_canister_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    amount </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> raw_rand_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> stored_chunks_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> chunk_hash</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> upload_chunk_result </span><span class="token operator">=</span><span class="token plain"> chunk_hash</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> snapshot </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> snapshot_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  taken_at_timestamp </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_size </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> take_canister_snapshot_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  replace_snapshot </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> snapshot_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> take_canister_snapshot_result </span><span class="token operator">=</span><span class="token plain"> snapshot</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> load_canister_snapshot_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  snapshot_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> snapshot_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sender_canister_version </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">opt</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> list_canister_snapshots_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> list_canister_snapshots_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> snapshot</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> delete_canister_snapshot_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  snapshot_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> snapshot_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> fetch_canister_logs_args </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> canister_id</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> canister_log_record </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    idx</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    timestamp_nanos</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">nat64</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    content</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">blob</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">type</span><span class="token plain"> fetch_canister_logs_result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">record</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_log_records</span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">vec</span><span class="token plain"> canister_log_record</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin" style="color:#29ABE2">service</span><span class="token plain"> ic </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    create_canister </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">create_canister_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">create_canister_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    update_settings </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">update_settings_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    upload_chunk </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">upload_chunk_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">upload_chunk_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    clear_chunk_store </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">clear_chunk_store_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    stored_chunks </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">stored_chunks_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">stored_chunks_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    install_code </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">install_code_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    install_chunked_code </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">install_chunked_code_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    uninstall_code </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">uninstall_code_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    start_canister </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">start_canister_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    stop_canister </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">stop_canister_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_status </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">canister_status_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">canister_status_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_info </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">canister_info_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">canister_info_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    delete_canister </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">delete_canister_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    deposit_cycles </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">deposit_cycles_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    raw_rand </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">raw_rand_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    http_request </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">http_request_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">http_request_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:#707070">// Threshold ECDSA signature</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ecdsa_public_key </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">ecdsa_public_key_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">ecdsa_public_key_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sign_with_ecdsa </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">sign_with_ecdsa_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">sign_with_ecdsa_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:#707070">// Threshold Schnorr signature</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    schnorr_public_key </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">schnorr_public_key_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">schnorr_public_key_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sign_with_schnorr </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">sign_with_schnorr_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">sign_with_schnorr_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:#707070">// bitcoin interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bitcoin_get_balance </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">bitcoin_get_balance_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">bitcoin_get_balance_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bitcoin_get_utxos </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">bitcoin_get_utxos_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">bitcoin_get_utxos_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bitcoin_send_transaction </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">bitcoin_send_transaction_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bitcoin_get_current_fee_percentiles </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">bitcoin_get_current_fee_percentiles_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">bitcoin_get_current_fee_percentiles_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bitcoin_get_block_headers </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">bitcoin_get_block_headers_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">bitcoin_get_block_headers_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:#707070">// metrics interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    node_metrics_history </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">node_metrics_history_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">node_metrics_history_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:#707070">// subnet info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    subnet_info </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">subnet_info_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">subnet_info_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:#707070">// provisional interfaces for the pre-ledger world</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    provisional_create_canister_with_cycles </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">provisional_create_canister_with_cycles_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">provisional_create_canister_with_cycles_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    provisional_top_up_canister </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">provisional_top_up_canister_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:#707070">// Canister snapshots</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    take_canister_snapshot </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">take_canister_snapshot_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">take_canister_snapshot_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    load_canister_snapshot </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">load_canister_snapshot_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    list_canister_snapshots </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">list_canister_snapshots_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">list_canister_snapshots_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    delete_canister_snapshot </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">delete_canister_snapshot_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:#707070">// canister logging</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fetch_canister_logs </span><span class="token punctuation" style="color:#F1EEF5">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">fetch_canister_logs_args</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F1EEF5">(</span><span class="token plain">fetch_canister_logs_result</span><span class="token punctuation" style="color:#F1EEF5">)</span><span class="token plain"> </span><span class="token keyword" style="color:#EB318A">query</span><span class="token punctuation" style="color:#F1EEF5">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:#F1EEF5">}</span><span class="token punctuation" style="color:#F1EEF5">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The binary encoding of arguments and results are as per Candid specification.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-create_canister">IC method <code>create_canister</code><a href="#ic-create_canister" class="hash-link" aria-label="Direct link to ic-create_canister" title="Direct link to ic-create_canister">â</a></h3><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>Before deploying a canister, the administrator of the canister first has to register it with the IC, to get a canister id (with an empty canister behind it), and then separately install the code.</p><p>The optional <code>settings</code> parameter can be used to set the following settings:</p><ul><li><p><code>controllers</code> (<code>vec principal</code>)</p><p>A list of at most 10 principals. The principals in this list become the <em>controllers</em> of the canister.
Note that the caller of the <code>create_canister</code> call is not a controller of the canister
unless it is a member of the <code>controllers</code> list.</p><p>Default value: A list containing only the caller of the <code>create_canister</code> call.</p></li><li><p><code>compute_allocation</code> (<code>nat</code>)</p><p>Must be a number between 0 and 100, inclusively. It indicates how much compute power should be guaranteed to this canister, expressed as a percentage of the maximum compute power that a single canister can allocate. If the IC cannot provide the requested allocation, for example because it is oversubscribed, the call will be rejected.</p><p>Default value: 0</p></li><li><p><code>memory_allocation</code> (<code>nat</code>)</p><p>Must be a number between 0 and 2<sup>48</sup> (i.e 256TB), inclusively.
It indicates the maximum amount of memory that the canister is allowed to use in total (i.e., any attempt to grow memory usage beyond the memory allocation will fail) and also guarantees availability of this amount of memory.
If the IC cannot guarantee the requested memory allocation, for example because it is oversubscribed, then the call will be rejected.
If set to 0, then memory growth of the canister will have no explicit limit but will only be best-effort and subject to the available memory on the IC.</p><p>Default value: 0</p></li><li><p><code>freezing_threshold</code> (<code>nat</code>)</p><p>Must be a number between 0 and 2<sup>64</sup>-1, inclusively, and indicates a length of time in seconds.</p><p>A canister is considered frozen whenever the IC estimates that the canister would be depleted of cycles before <code>freezing_threshold</code> seconds pass, given the canister&#x27;s current size and the IC&#x27;s current cost for storage.</p><p>Calls to a frozen canister will be rejected with <code>SYS_TRANSIENT</code> reject code. Additionally, a canister cannot perform calls if that would, due the cost of the call and transferred cycles, would push the balance into frozen territory; these calls fail with <code>ic0.call_perform</code> returning a non-zero error code.</p><p>Default value: 2592000 (approximately 30 days).</p></li><li><p><code>reserved_cycles_limit</code> (<code>nat</code>)</p><p>Must be a number between 0 and 2<sup>128</sup>-1, inclusively, and indicates the upper limit on <code>reserved_cycles</code> of the canister.</p><p>An operation that allocates resources such as compute and memory will fail if the new value of <code>reserved_cycles</code> exceeds this limit.</p><p>Default value: 5_000_000_000_000 (5 trillion cycles).</p></li><li><p><code>wasm_memory_limit</code> (<code>nat</code>)</p><p>Must be a number between 0 and 2<sup>48</sup>-1 (i.e., 256TB), inclusively, and indicates the upper limit on the WASM heap memory consumption of the canister.</p><p>An operation (update method, canister init, canister post_upgrade) that causes the WASM heap memory consumption to exceed this limit will trap.
The WASM heap memory limit is ignored for query methods, response callback handlers, global timers, heartbeats, and canister pre_upgrade.</p><p>If set to 0, then there&#x27;s no upper limit on the WASM heap memory consumption of the canister subject to the available memory on the IC.</p><p>Default value: 0 (i.e., no explicit limit).</p><p>Note: in a future release of this specification, the default value and whether the limit is enforced for global timers and heartbeats might change.</p></li></ul><p>The optional <code>sender_canister_version</code> parameter can contain the caller&#x27;s canister version. If provided, its value must be equal to <code>ic0.canister_version</code>.</p><p>Until code is installed, the canister is <code>Empty</code> and behaves like a canister that has no public methods.</p><p>Cycles to pay for the call must be explicitly transferred with the call, i.e., they are not automatically deducted from the caller&#x27;s balance implicitly (e.g., as for inter-canister calls).</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-update_settings">IC method <code>update_settings</code><a href="#ic-update_settings" class="hash-link" aria-label="Direct link to ic-update_settings" title="Direct link to ic-update_settings">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>Only <em>controllers</em> of the canister can update settings. See <a href="#ic-create_canister">IC method</a> for a description of settings.</p><p>Not including a setting in the <code>settings</code> record means not changing that field. The defaults described above are only relevant during canister creation.</p><p>The optional <code>sender_canister_version</code> parameter can contain the caller&#x27;s canister version. If provided, its value must be equal to <code>ic0.canister_version</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-upload_chunk">IC method <code>upload_chunk</code><a href="#ic-upload_chunk" class="hash-link" aria-label="Direct link to ic-upload_chunk" title="Direct link to ic-upload_chunk">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>Canisters have associated some storage space (hence forth chunk storage) where they can hold chunks of Wasm modules that are too lage to fit in a single message. This method allows the controllers of a canister (and the canister itself) to upload such chunks. The method returns the hash of the chunk that was stored. The size of each chunk must be at most 1MiB. The maximum number of chunks in the chunk store is <code>CHUNK_STORE_SIZE</code> chunks. The storage cost of each chunk is fixed and corresponds to storing 1MiB of data.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-clear_chunk_store">IC method <code>clear_chunk_store</code><a href="#ic-clear_chunk_store" class="hash-link" aria-label="Direct link to ic-clear_chunk_store" title="Direct link to ic-clear_chunk_store">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>Canister controllers (and the canister itself) can clear the entire chunk storage of a canister.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-stored_chunks">IC method <code>stored_chunks</code><a href="#ic-stored_chunks" class="hash-link" aria-label="Direct link to ic-stored_chunks" title="Direct link to ic-stored_chunks">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>Canister controllers (and the canister itself) can list the hashes of chunks in the chunk storage of a canister.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-install_code">IC method <code>install_code</code><a href="#ic-install_code" class="hash-link" aria-label="Direct link to ic-install_code" title="Direct link to ic-install_code">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>This method installs code into a canister.</p><p>Only controllers of the canister can install code.</p><ul><li><p>If <code>mode = variant { install }</code>, the canister must be empty before. This will instantiate the canister module and invoke its <code>canister_init</code> method (if present), as explained in Section &quot;<a href="#system-api-init">Canister initialization</a>&quot;, passing the <code>arg</code> to the canister.</p></li><li><p>If <code>mode = variant { reinstall }</code>, if the canister was not empty, its existing code and state (including stable memory) is removed before proceeding as for <code>mode = install</code>.</p><p>Note that this is different from <code>uninstall_code</code> followed by <code>install_code</code>, as <code>uninstall_code</code> generates a synthetic reject response to all callers of the uninstalled canister that the uninstalled canister did not yet reply to and ensures that callbacks to outstanding calls made by the uninstalled canister won&#x27;t be executed (i.e., upon receiving a response from a downstream call made by the uninstalled canister, the cycles attached to the response are refunded, but no callbacks are executed).</p></li><li><p>If <code>mode = variant { upgrade }</code> or <code>mode = variant { upgrade = opt record { skip_pre_upgrade = .., wasm_memory_persistence = .. } }</code>, this will perform an upgrade of a non-empty canister as described in <a href="#system-api-upgrades">Canister upgrades</a>, passing <code>arg</code> to the <code>canister_post_upgrade</code> method of the new instance. If <code>skip_pre_upgrade = opt true</code>, then the <code>canister_pre_upgrade</code> method on the old instance is not executed. If <code>wasm_memory_persistence = opt keep</code>, then the WebAssembly memory is preserved.</p></li></ul><p>This is atomic: If the response to this request is a <code>reject</code>, then this call had no effect.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>Some canisters may not be able to make sense of callbacks after upgrades; these should be stopped first, to wait for all outstanding callbacks, or be uninstalled first, to prevent outstanding callbacks from being invoked (by marking the corresponding call contexts as deleted). It is expected that the canister admin (or their tooling) does that separately.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>The <code>wasm_module</code> field specifies the canister module to be installed. The system supports multiple encodings of the <code>wasm_module</code> field, as described in <a href="#canister-module-format">Canister module format</a>:</p><ul><li><p>If the <code>wasm_module</code> starts with byte sequence <code>[0x00, &#x27;a&#x27;, &#x27;s&#x27;, &#x27;m&#x27;]</code>, the system parses <code>wasm_module</code> as a raw WebAssembly binary.</p></li><li><p>If the <code>wasm_module</code> starts with byte sequence <code>[0x1f, 0x8b, 0x08]</code>, the system parses <code>wasm_module</code> as a gzip-compressed WebAssembly binary.</p></li></ul><p>The optional <code>sender_canister_version</code> parameter can contain the caller&#x27;s canister version. If provided, its value must be equal to <code>ic0.canister_version</code>.</p><p>This method traps if the canister&#x27;s cycle balance decreases below the canister&#x27;s freezing limit after executing the method.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-install_chunked_code">IC method <code>install_chunked_code</code><a href="#ic-install_chunked_code" class="hash-link" aria-label="Direct link to ic-install_chunked_code" title="Direct link to ic-install_chunked_code">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>This method installs code that had previously been uploaded in chunks.</p><p>Only controllers of the target canister can call this method.</p><p>The <code>mode</code>, <code>arg</code>, and <code>sender_canister_version</code> parameters are as for <code>install_code</code>.
The <code>target_canister</code> specifies the canister where the code should be installed.
The optional <code>store_canister</code> specifies the canister in whose chunk storage the chunks are stored (this parameter defaults to <code>target_canister</code> if not specified).
For the call to succeed, the caller must be a controller of the <code>store_canister</code> or the caller must be the <code>store_canister</code>. The <code>store_canister</code> must be on the same subnet as the target canister.</p><p>The <code>chunk_hashes_list</code> specifies a list of hash values <code>[h1,...,hk]</code> with <code>k &lt;= MAX_CHUNKS_IN_LARGE_WASM</code>. The system looks up in the chunk store of <code>store_canister</code> (or that of the target canister if <code>store_canister</code> is not specified) blobs corresponding to <code>h1,...,hk</code> and concatenates them to obtain a blob of bytes referred to as <code>wasm_module</code> in <code>install_code</code>. It then checks that the SHA-256 hash of <code>wasm_module</code> is equal to the <code>wasm_module_hash</code> parameter and calls <code>install_code</code> with parameters <code>(record {mode; target_canister; wasm_module; arg; sender_canister_version})</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-uninstall_code">IC method <code>uninstall_code</code><a href="#ic-uninstall_code" class="hash-link" aria-label="Direct link to ic-uninstall_code" title="Direct link to ic-uninstall_code">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>This method removes a canister&#x27;s code and state, making the canister <em>empty</em> again.</p><p>Only controllers of the canister can uninstall code.</p><p>Uninstalling a canister&#x27;s code will reject all calls that the canister has not yet responded to, and drop the canister&#x27;s code and state. Outstanding responses to the canister will not be processed, even if they arrive after code has been installed again. Cycles attached to such responses will still be refunded though.</p><p>The canister is now <a href="#canister-lifecycle">empty</a>. In particular, any incoming or queued calls will be rejected.</p><p>A canister after <em>uninstalling</em> retains its <em>cycle</em> balances, <em>controllers</em>, history, status, and allocations.</p><p>The optional <code>sender_canister_version</code> parameter can contain the caller&#x27;s canister version. If provided, its value must be equal to <code>ic0.canister_version</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-canister_status">IC method <code>canister_status</code><a href="#ic-canister_status" class="hash-link" aria-label="Direct link to ic-canister_status" title="Direct link to ic-canister_status">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>Indicates various information about the canister. It contains:</p><ul><li><p>The status of the canister. It could be one of <code>running</code>, <code>stopping</code> or <code>stopped</code>.</p></li><li><p>The &quot;settings&quot; of the canister containing:</p><ul><li><p>The controllers of the canister. The order of returned controllers may vary depending on the implementation.</p></li><li><p>The compute and memory allocation of the canister.</p></li><li><p>The freezing threshold of the canister in seconds.</p></li><li><p>The reserved cycles limit of the canister, i.e., the maximum number of cycles that can be in the canister&#x27;s reserved balance after increasing the canister&#x27;s memory allocation and/or actual memory usage.</p></li><li><p>The canister log visibility of the canister.</p></li><li><p>The WASM heap memory limit of the canister in bytes (the value of <code>0</code> means that there is no explicit limit).</p></li></ul></li><li><p>A SHA256 hash of the module installed on the canister. This is <code>null</code> if the canister is empty.</p></li><li><p>The actual memory usage of the canister.</p></li><li><p>The cycle balance of the canister.</p></li><li><p>The reserved cycles balance of the canister, i.e., the number of cycles reserved when increasing the canister&#x27;s memory allocation and/or actual memory usage.</p></li><li><p>The idle cycle consumption of the canister, i.e., the number of cycles burned by the canister per day due to its compute and memory allocation and actual memory usage.</p></li><li><p>Statistics regarding the query call execution of the canister, i.e., a record containing the following fields:</p><ul><li><p><code>num_calls_total</code>: the total number of query and composite query methods evaluated on the canister,</p></li><li><p><code>num_instructions_total</code>: the total number of WebAssembly instructions executed during the evaluation of query and composite query methods,</p></li><li><p><code>request_payload_bytes_total</code>: the total number of query and composite query method payload bytes, and</p></li><li><p><code>response_payload_bytes_total</code>: the total number of query and composite query response payload (reply data or reject message) bytes.</p></li></ul></li></ul><p>Only the controllers of the canister or the canister itself can request its status.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-canister_info">IC method <code>canister_info</code><a href="#ic-canister_info" class="hash-link" aria-label="Direct link to ic-canister_info" title="Direct link to ic-canister_info">â</a></h3><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>Provides the history of the canister, its current module SHA-256 hash, and its current controllers. Every canister can call this method on every other canister (including itself). Users cannot call this method.</p><p>The canister history consists of a list of canister changes (canister creation, code uninstallation, code deployment, snapshot restoration, or controllers change). Every canister change consists of the system timestamp at which the change was performed, the canister version after performing the change, the change&#x27;s origin (a user or a canister), and its details. The change origin includes the principal (called <em>originator</em> in the following) that initiated the change and, if the originator is a canister, the originator&#x27;s canister version when the originator initiated the change (if available). Code deployments are described by their mode (code install, code reinstall, code upgrade) and the SHA-256 hash of the newly deployed canister module. Loading a snapshot is described by the canister version, snapshot ID and timestamp at which the snapshot was taken. Canister creations and controllers changes are described by the full new set of the canister controllers after the change. The order of controllers stored in the canister history may vary depending on the implementation.</p><p>The system can drop the oldest canister changes from the list to keep its length bounded (at least <code>20</code> changes are guaranteed to remain in the list). The system also drops all canister changes if the canister runs out of cycles.</p><p>The following parameters should be supplied for the call:</p><ul><li><p><code>canister_id</code>: the canister ID of the canister to retrieve information about.</p></li><li><p><code>num_requested_changes</code>: optional, specifies the number of requested canister changes. If not provided, the default value of <code>0</code> will be used.</p></li></ul><p>The returned response contains the following fields:</p><ul><li><p><code>total_num_changes</code>: the total number of canister changes that have been ever recorded in the history. This value does not change if the system drops the oldest canister changes from the list of changes.</p></li><li><p><code>recent_changes</code>: the list containing the most recent canister changes. If <code>num_requested_changes</code> is provided, then this list contains that number of changes or, if more changes are requested than available in the history, then this list contains all changes available in the history. If <code>num_requested_changes</code> is not specified, then this list is empty.</p></li><li><p><code>module_hash</code>: the SHA-256 hash of the currently installed canister module (or <code>null</code> if the canister is empty).</p></li><li><p><code>controllers</code>: the current set of canister controllers. The order of returned controllers may vary depending on the implementation.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-stop_canister">IC method <code>stop_canister</code><a href="#ic-stop_canister" class="hash-link" aria-label="Direct link to ic-stop_canister" title="Direct link to ic-stop_canister">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>The controllers of a canister may stop a canister (e.g., to prepare for a canister upgrade).</p><p>Stopping a canister is not an atomic action. The immediate effect is that the status of the canister is changed to <code>stopping</code> (unless the canister is already stopped). The IC will reject all calls to a stopping canister, indicating that the canister is stopping. Responses to a stopping canister are processed as usual. When all outstanding responses have been processed (so there are no open call contexts), the canister status is changed to <code>stopped</code> and the management canister responds to the caller of the <code>stop_canister</code> request.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-start_canister">IC method <code>start_canister</code><a href="#ic-start_canister" class="hash-link" aria-label="Direct link to ic-start_canister" title="Direct link to ic-start_canister">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>A canister may be started by its controllers.</p><p>If the canister status was <code>stopped</code> or <code>stopping</code> then the canister status is simply set to <code>running</code>. In the latter case all <code>stop_canister</code> calls which are processing fail (and are rejected).</p><p>If the canister was already <code>running</code> then the status stays unchanged.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-delete_canister">IC method <code>delete_canister</code><a href="#ic-delete_canister" class="hash-link" aria-label="Direct link to ic-delete_canister" title="Direct link to ic-delete_canister">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>This method deletes a canister from the IC.</p><p>Only controllers of the canister can delete it and the canister must already be stopped. Deleting a canister cannot be undone, any state stored on the canister is permanently deleted and its cycles are discarded. Once a canister is deleted, its ID cannot be reused.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-deposit_cycles">IC method <code>deposit_cycles</code><a href="#ic-deposit_cycles" class="hash-link" aria-label="Direct link to ic-deposit_cycles" title="Direct link to ic-deposit_cycles">â</a></h3><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>This method deposits the cycles included in this call into the specified canister.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-raw_rand">IC method <code>raw_rand</code><a href="#ic-raw_rand" class="hash-link" aria-label="Direct link to ic-raw_rand" title="Direct link to ic-raw_rand">â</a></h3><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>This method takes no input and returns 32 pseudo-random bytes to the caller. The return value is unknown to any part of the IC at time of the submission of this call. A new return value is generated for each call to this method.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-ecdsa_public_key">IC method <code>ecdsa_public_key</code><a href="#ic-ecdsa_public_key" class="hash-link" aria-label="Direct link to ic-ecdsa_public_key" title="Direct link to ic-ecdsa_public_key">â</a></h3><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>This method returns a <a href="https://www.secg.org/sec1-v2.pdf" target="_blank" rel="noopener noreferrer">SEC1</a> encoded ECDSA public key for the given canister using the given derivation path. If the <code>canister_id</code> is unspecified, it will default to the canister id of the caller. The <code>derivation_path</code> is a vector of variable length byte strings. Each byte string may be of arbitrary length, including empty. The total number of byte strings in the <code>derivation_path</code> must be at most 255. The <code>key_id</code> is a struct specifying both a curve and a name. The availability of a particular <code>key_id</code> depends on the implementation.</p><p>For curve <code>secp256k1</code>, the public key is derived using a generalization of BIP32 (see <a href="https://ia.cr/2021/1330" target="_blank" rel="noopener noreferrer">ia.cr/2021/1330, Appendix D</a>). To derive (non-hardened) <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" rel="noopener noreferrer">BIP32</a>-compatible public keys, each byte string (<code>blob</code>) in the <code>derivation_path</code> must be a 4-byte big-endian encoding of an unsigned integer less than 2<sup>31</sup>. If the <code>derivation_path</code> contains a byte string that is not a 4-byte big-endian encoding of an unsigned integer less than 2<sup>31</sup>, then a derived public key will be returned, but that key derivation process will not be compatible with the <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" rel="noopener noreferrer">BIP32</a> standard.</p><p>The return value is an extended public key consisting of an ECDSA <code>public_key</code>, encoded in <a href="https://www.secg.org/sec1-v2.pdf" target="_blank" rel="noopener noreferrer">SEC1</a> compressed form, and a <code>chain_code</code>, which can be used to deterministically derive child keys of the <code>public_key</code>.</p><p>This call requires that an ECDSA key with ID <code>key_id</code> was generated by the IC. Otherwise, the call is rejected.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-sign_with_ecdsa">IC method <code>sign_with_ecdsa</code><a href="#ic-sign_with_ecdsa" class="hash-link" aria-label="Direct link to ic-sign_with_ecdsa" title="Direct link to ic-sign_with_ecdsa">â</a></h3><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>This method returns a new <a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-4.pdf" target="_blank" rel="noopener noreferrer">ECDSA</a> signature of the given <code>message_hash</code> that can be separately verified against a derived ECDSA public key. This public key can be obtained by calling <code>ecdsa_public_key</code> with the caller&#x27;s <code>canister_id</code>, and the same <code>derivation_path</code> and <code>key_id</code> used here.</p><p>The signatures are encoded as the concatenation of the <a href="https://www.secg.org/sec1-v2.pdf" target="_blank" rel="noopener noreferrer">SEC1</a> encodings of the two values r and s. For curve <code>secp256k1</code>, this corresponds to 32-byte big-endian encoding.</p><p>This call requires that an ECDSA key with ID <code>key_id</code> was generated by the IC, the signing functionality for that key was enabled, and <code>message_hash</code> is 32 bytes long. Otherwise, the call is is rejected.</p><p>Cycles to pay for the call must be explicitly transferred with the call, i.e., they are not automatically deducted from the caller&#x27;s balance implicitly (e.g., as for inter-canister calls).</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-schnorr_public_key">IC method <code>schnorr_public_key</code><a href="#ic-schnorr_public_key" class="hash-link" aria-label="Direct link to ic-schnorr_public_key" title="Direct link to ic-schnorr_public_key">â</a></h3><div class="admonition_WoCw admonitionNote_L5_h"><p>Threshold Schnorr API is EXPERIMENTAL and there might be breaking changes of the behavior in the future. Use at your own risk!</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>This method returns a (derived) Schnorr public key for the given canister using the given derivation path. If the <code>canister_id</code> is unspecified, it will default to the canister id of the caller. The <code>derivation_path</code> is a vector of variable length byte strings. Each byte string may be of arbitrary length, including empty. The total number of byte strings in the <code>derivation_path</code> must be at most 255. The <code>key_id</code> is a struct specifying both an algorithm and a name. The availability of a particular <code>key_id</code> depends on the implementation.</p><p>The return value is an extended Schnorr public key consisting of a Schnorr <code>public_key</code> and a <code>chain_code</code>. The chain code can be used to deterministically derive child keys of the <code>public_key</code>. Both the derivation and the encoding of the public key depends on the key ID&#x27;s <code>algorithm</code>:</p><ul><li><p>For algorithm <code>bip340secp256k1</code>, the public key is derived using the generalization of BIP32 defined in <a href="https://ia.cr/2021/1330" target="_blank" rel="noopener noreferrer">ia.cr/2021/1330, Appendix D</a>. To derive (non-hardened) <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" rel="noopener noreferrer">BIP32</a>-compatible public keys, each byte string (<code>blob</code>) in the <code>derivation_path</code> must be a 4-byte big-endian encoding of an unsigned integer less than 2<sup>31</sup>. If the <code>derivation_path</code> contains a byte string that is not a 4-byte big-endian encoding of an unsigned integer less than 2<sup>31</sup>, then a derived public key will be returned, but that key derivation process will not be compatible with the <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" rel="noopener noreferrer">BIP32</a> standard.</p><p>The public key is encoded in <a href="https://www.secg.org/sec1-v2.pdf" target="_blank" rel="noopener noreferrer">SEC1</a> compressed form. To use BIP32 public keys to verify BIP340 Schnorr signatures, the first byte of the (33-byte) SEC1-encoded public key must be removed (see <a href="https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki#public-key-conversion" target="_blank" rel="noopener noreferrer">BIP-340, Public Key Conversion</a>).</p></li><li><p>For algorithm <code>ed25519</code>, the public key is derived using the scheme specified in <a href="#ed25519-key-derivation">Ed25519 hierarchical key derivation</a>.</p><p>The public key is encoded in standard 32-byte compressed form (see <a href="https://datatracker.ietf.org/doc/html/rfc8032#section-5.1.2" target="_blank" rel="noopener noreferrer">RFC8032, 5.1.2 Encoding</a>).</p></li></ul><p>This call requires that a Schnorr key with ID <code>key_id</code> was generated by the IC. Otherwise, the call is rejected.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ed25519-key-derivation">Ed25519 hierarchical key derivation<a href="#ed25519-key-derivation" class="hash-link" aria-label="Direct link to Ed25519 hierarchical key derivation" title="Direct link to Ed25519 hierarchical key derivation">â</a></h4><p>This section describes a child key derivation (CKD) function for computing child public keys from Ed25519 parent public keys.
The section is inspired by <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" rel="noopener noreferrer">BIP32</a> and uses similar wording and structure.</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation">â</a></h5><p>To support the Ed25519 variant of threshold Schnorr signatures on the Internet Computer, a key derivation scheme compatible with Ed25519 signatures is required.
For a respective signing service on the Internet Computer to be efficient, the signing subnet maintains only a single master key pair and <em>derives</em> signing child keys for each canister.
Although there exist various hierarchical key derivation schemes (e.g., <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" rel="noopener noreferrer">BIP32</a>, <a href="https://github.com/satoshilabs/slips/blob/master/slip-0010.md" target="_blank" rel="noopener noreferrer">SLIP10</a>, <a href="https://input-output-hk.github.io/adrestia/static/Ed25519_BIP.pdf" target="_blank" rel="noopener noreferrer">BIP32-Ed25519</a>, <a href="https://github.com/w3f/schnorrkel" target="_blank" rel="noopener noreferrer">Schnorrkel</a>), all of the analyzed schemes are either incompatible in a threshold setting (e.g., use hardened key derivation only), comply with clamping which adds unnecessary complexity, or otherwise rely on non-standard primitives.
For these reasons, a new derivation scheme is specified here.
This scheme does not make use of <em>clamping</em> (see <a href="https://datatracker.ietf.org/doc/html/rfc8032#section-5.1.5" target="_blank" rel="noopener noreferrer">RFC8032, Section 5.1.5, Item 2</a>), because it is unnecessary in the given setting, and satisfies the following requirements:</p><ul><li>Off-chain availability: New public keys can be computed off-chain from a master public key without requiring interaction with the IC.</li><li>Hierarchical derivation: Derived keys are organized in a tree such that from any public key it is possible to derive new child keys. The first level is used to derive unique canister-specific keys from the master key.</li><li>Simplicity: The scheme is simple to implement using existing libraries.</li></ul><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="conventions">Conventions<a href="#conventions" class="hash-link" aria-label="Direct link to Conventions" title="Direct link to Conventions">â</a></h5><p>We will assume the elliptic curve (EC) operations using the field and curve parameters as defined by Ed25519 (see <a href="https://datatracker.ietf.org/doc/html/rfc8032#section-5.1" target="_blank" rel="noopener noreferrer">RFC8032, Section 5.1</a>). Variables below are either:</p><ul><li>Integers modulo the order of the curve&#x27;s prime order subgroup (referred to as L).</li><li>Points on the curve.</li><li>Byte sequences.</li></ul><p>Addition (+) of two points is defined as application of the EC group operation.
Concatenation (||) is the operation of appending one byte sequence onto another.</p><p>We assume the following functions:</p><ul><li>point(p): returns the point resulting from EC point multiplication (repeated application of the EC group operation) of the Ed25519 base point with the integer p.</li><li>ser<sub>P</sub>(P): serializes the point to a byte sequence using standard 32-byte compressed form (see <a href="https://datatracker.ietf.org/doc/html/rfc8032#section-5.1.2" target="_blank" rel="noopener noreferrer">RFC8032, 5.1.2 Encoding</a>).</li><li>utf8(s): returns the UTF-8 encoding of string s.</li><li>parse<sub>512</sub>(p): interprets a 64-byte sequence as a 512-bit number, most significant byte first.</li><li>HKDF(salt,IKM,info,N) -&gt; OKM: HMAC-based key derivation function (see <a href="https://datatracker.ietf.org/doc/html/rfc5869" target="_blank" rel="noopener noreferrer">RFC5869</a>) using HMAC-SHA512 (see <a href="https://datatracker.ietf.org/doc/html/rfc4231" target="_blank" rel="noopener noreferrer">RFC4231</a>) calculating N-bytes long output key material (OKM) from (byte sequences) salt, input key material (IKM), and application specific information <em>info</em>.</li></ul><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="extended-keys">Extended keys<a href="#extended-keys" class="hash-link" aria-label="Direct link to Extended keys" title="Direct link to Extended keys">â</a></h5><p>Public keys are extended with an extra 32 bytes of entropy, which extension is called chain code.
An extended public key is represented as (K, c), with K = point(k) and c being the chain code, for some private key k.
Each extended key can have an arbitrary number of child keys.
The scheme does not support hardened derivation of child keys.</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="child-key-derivation-ckd-function">Child key derivation (CKD) function<a href="#child-key-derivation-ckd-function" class="hash-link" aria-label="Direct link to Child key derivation (CKD) function" title="Direct link to Child key derivation (CKD) function">â</a></h5><p>Given a parent extended public key and an index i, it is possible to compute the corresponding child extended public key.
The function CKDpub computes a child extended public key from a parent extended public key and an index i, where i is a byte sequence of arbitrary length (including empty).</p><p>CKDpub((K<sub>par</sub>, c<sub>par</sub>), i) â (K<sub>i</sub>, c<sub>i</sub>):</p><ul><li>let IKM = ser<sub>P</sub>(K<sub>par</sub>) || i.</li><li>let OKM = HKDF(c<sub>par</sub>, IKM, utf8(&quot;Ed25519&quot;), 96).</li><li>Split OKM into a 64-byte and a 32-byte sequence, tweak and c<sub>i</sub>.</li><li>let K<sub>i</sub> = K<sub>par</sub> + point(parse<sub>512</sub>(tweak) mod L).</li><li>return (K<sub>i</sub>, c<sub>i</sub>).</li></ul><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="key-tree">Key tree<a href="#key-tree" class="hash-link" aria-label="Direct link to Key tree" title="Direct link to Key tree">â</a></h5><p>A key tree can be built by repeatedly applying CKDpub, starting with one root, called the master extended public key M.
Computing CKDpub(M, i) for different values of i results in a number of level-0 derived keys.
As each of these is again an extended key, CKDpub can be applied to those as well.
The sequence of indices used when repeatedly applying CKDpub is called the <em>derivation path</em>.</p><p>The function KTpub computes a child extended public key from a parent extended public key and a derivation path d.</p><p>KTpub((K<sub>par</sub>, c<sub>par</sub>), d) â (K<sub>d</sub>, c<sub>d</sub>):</p><ul><li>let (K<sub>d</sub>, c<sub>d</sub>) = (K<sub>par</sub>, c<sub>par</sub>)</li><li>for all indices i in d:
(K<sub>d</sub>, c<sub>d</sub>) = CKDpub((K<sub>d</sub>, c<sub>d</sub>), i)</li><li>return (K<sub>d</sub>, c<sub>d</sub>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-sign_with_schnorr">IC method <code>sign_with_schnorr</code><a href="#ic-sign_with_schnorr" class="hash-link" aria-label="Direct link to ic-sign_with_schnorr" title="Direct link to ic-sign_with_schnorr">â</a></h3><div class="admonition_WoCw admonitionNote_L5_h"><p>Threshold Schnorr API is EXPERIMENTAL and there might be breaking changes of the behavior in the future. Use at your own risk!</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>This method returns a Schnorr signature of the given <code>message</code> that can be verified against a (derived) public key obtained by calling <code>schnorr_public_key</code> using the caller&#x27;s <code>canister_id</code> and the given <code>derivation_path</code> and <code>key_id</code>.</p><p>The encoding of the signature depends on the key ID&#x27;s <code>algorithm</code>:</p><ul><li><p>For algorithm <code>bip340secp256k1</code>, the signature is encoded in 64 bytes according to <a href="https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki" target="_blank" rel="noopener noreferrer">BIP340</a>.</p></li><li><p>For algorithm <code>ed25519</code>, the signature is encoded in 64 bytes according to <a href="https://datatracker.ietf.org/doc/html/rfc8032#section-5.1.6" target="_blank" rel="noopener noreferrer">RFC8032, 5.1.6 Sign</a>.</p></li></ul><p>This call requires that a Schnorr key with ID <code>key_id</code> was generated by the IC and the signing functionality for that key was enabled. Otherwise, the call is rejected.</p><p>This call accepts an optional auxiliary parameter <code>aux</code>. The auxiliary parameter type <code>schnorr_aux</code> is an enumeration. The only currently supported variant is <code>bip341</code> which allows passing a Merkle tree root hash, which is required to implement Taproot signatures as defined in <a href="https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki" target="_blank" rel="noopener noreferrer">BIP341</a>. The <code>bip341</code> variant is only allowed for <code>bip340secp256k1</code> signatures, and if provided the <code>merkle_root_hash</code> must be generated in accordance with BIP341&#x27;s specification for <code>taproot_output_script</code>. Specifically it should be either an empty bytestring (for the <code>script == None</code> case) or else 32 bytes generated using the procedure documented as <code>taproot_tree_helper</code>. If no auxiliary parameter is provided, then <code>bip340secp256k1</code> signatures are generated in accordance with BIP340.</p><p>On the Internet Computer, the tuple of the requested master key, the calling canister, and derivation path determines which private key is used to generate the signature, and which public key is returned by <code>schnorr_public_key</code>.</p><p>When using BIP341 signatures, the actual signature that is created will be relative to the Schnorr signature derived as described in BIP341&#x27;s <code>taproot_sign_script</code>. The key returned by <code>schnorr_public_key</code> is the value identified in BIP341 as <code>internal_pubkey</code>.</p><p>Cycles to pay for the call must be explicitly transferred with the call, i.e., they are not automatically deducted from the caller&#x27;s balance implicitly (e.g., as for inter-canister calls).</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-http_request">IC method <code>http_request</code><a href="#ic-http_request" class="hash-link" aria-label="Direct link to ic-http_request" title="Direct link to ic-http_request">â</a></h3><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>This method makes an HTTP request to a given URL and returns the HTTP response, possibly after a transformation.</p><p>The canister should aim to issue <em>idempotent</em> requests, meaning that it must not change the state at the remote server, or the remote server has the means to identify duplicated requests. Otherwise, the risk of failure increases.</p><p>The responses for all identical requests must match too. However, a web service could return slightly different responses for identical idempotent requests. For example, it may include some unique identification or a timestamp that would vary across responses.</p><p>For this reason, the calling canister can supply a transformation function, which the IC uses to let the canister sanitize the responses from such unique values. The transformation function is executed separately on the corresponding response received for a request. The final response will only be available to the calling canister.</p><p>Currently, the <code>GET</code>, <code>HEAD</code>, and <code>POST</code> methods are supported for HTTP requests.</p><p>It is important to note the following for the usage of the <code>POST</code> method:</p><ul><li><p>The calling canister must make sure that the remote server is able to handle idempotent requests sent from multiple sources. This may require, for example, to set a certain request header to uniquely identify the request.</p></li><li><p>There are no confidentiality guarantees on the request content. There is no guarantee that all sent requests are as specified by the canister. If the canister receives a response, then at least one request that was sent matched the canister&#x27;s request, and the response was to that request.</p></li></ul><p>For security reasons, only HTTPS connections are allowed (URLs must start with <code>https://</code>). The IC uses industry-standard root CA lists to validate certificates of remote web servers.</p><p>The <strong>size</strong> of an HTTP request from the canister or an HTTP response from the remote HTTP server is the total number of bytes representing the names and values of HTTP headers and the HTTP body. The maximal size for the request from the canister is <code>2MB</code> (<code>2,000,000B</code>). Each request can specify a maximal size for the response from the remote HTTP server. The upper limit on the maximal size for the response is <code>2MB</code> (<code>2,000,000B</code>) and this value also applies if no maximal size value is specified. An error will be returned when the request or response is larger than the maximal size.</p><p>The following parameters should be supplied for the call:</p><ul><li><p><code>url</code> - the requested URL. The URL must be valid according to <a href="https://www.ietf.org/rfc/rfc3986.txt" target="_blank" rel="noopener noreferrer">RFC-3986</a> and its length must not exceed <code>8192</code>. The URL may specify a custom port number.</p></li><li><p><code>max_response_bytes</code> - optional, specifies the maximal size of the response in bytes. If provided, the value must not exceed <code>2MB</code> (<code>2,000,000B</code>). The call will be charged based on this parameter. If not provided, the maximum of <code>2MB</code> will be used.</p></li><li><p><code>method</code> - currently, only GET, HEAD, and POST are supported</p></li><li><p><code>headers</code> - list of HTTP request headers and their corresponding values</p></li><li><p><code>body</code> - optional, the content of the request&#x27;s body</p></li><li><p><code>transform</code> - an optional record that includes a function that transforms raw responses to sanitized responses, and a byte-encoded context that is provided to the function upon invocation, along with the response to be sanitized. If provided, the calling canister itself must export this function.</p></li></ul><p>Cycles to pay for the call must be explicitly transferred with the call, i.e., they are not automatically deducted from the caller&#x27;s balance implicitly (e.g., as for inter-canister calls).</p><p>The returned response (and the response provided to the <code>transform</code> function, if specified) contains the following fields:</p><ul><li><p><code>status</code> - the response status (e.g., 200, 404)</p></li><li><p><code>headers</code> - list of HTTP response headers and their corresponding values</p></li><li><p><code>body</code> - the response&#x27;s body</p></li></ul><p>The <code>transform</code> function may, for example, transform the body in any way, add or remove headers, modify headers, etc. The maximal number of bytes representing the response produced by the <code>transform</code> function is <code>2MB</code> (<code>2,000,000B</code>). Note that the number of bytes representing the response produced by the <code>transform</code> function includes the serialization overhead of the encoding produced by the canister.</p><p>When the transform function is invoked by the system due to a canister HTTP request, the caller&#x27;s identity is the principal of the management canister. This information can be used by developers to implement access control mechanism for this function.</p><p>The following additional limits apply to HTTP requests and HTTP responses from the remote sever:</p><ul><li><p>the number of headers must not exceed <code>64</code>,</p></li><li><p>the number of bytes representing a header name or value must not exceed <code>8KiB</code>, and</p></li><li><p>the total number of bytes representing the header names and values must not exceed <code>48KiB</code>.</p></li></ul><p>If the request headers provided by the canister do not contain a <code>user-agent</code> header (case-insensitive),
then the IC sends a <code>user-agent</code> header (case-insensitive) with the value <code>ic/1.0</code>
in addition to the headers provided by the canister. Such an additional header does not contribute
to the above limits on HTTP request headers.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>Currently, the Internet Computer mainnet only supports URLs that resolve to IPv6 destinations (i.e., the domain has a <code>AAAA</code> DNS record) in HTTP requests.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><div class="admonition_WoCw admonitionWarning_tRva"><p>If you do not specify the <code>max_response_bytes</code> parameter, the maximum of a <code>2MB</code> response will be charged for, which is expensive in terms of cycles. Always set the parameter to a reasonable upper bound of the expected network response size to not incur unnecessary cycles costs for your request.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#F68E5F"></rect><path d="m5.396 17.258 6.166-11a.502.502 0 0 1 .875 0l6.165 11a.5.5 0 0 1-.437.744H5.835a.5.5 0 0 1-.439-.744Zm6.605-4.588a.5.5 0 0 0-.5.5v2.334a.5.5 0 0 0 1 0V13.17a.5.5 0 0 0-.5-.5Zm-.001-2a.667.667 0 1 0 0 1.334.667.667 0 0 0 0-1.334Z" fill="#fff"></path></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-node-metrics-history">IC method <code>node_metrics_history</code><a href="#ic-node-metrics-history" class="hash-link" aria-label="Direct link to ic-node-metrics-history" title="Direct link to ic-node-metrics-history">â</a></h3><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>The node metrics management canister API is considered EXPERIMENTAL. Canister developers must be aware that the API may evolve in a non-backward-compatible way.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>Given a subnet ID as input, this method returns a time series of node metrics (field <code>node_metrics</code>). The timestamps are represented as nanoseconds since 1970-01-01 (field <code>timestamp_nanos</code>) at which the metrics were sampled. The returned timestamps are all timestamps after (and including) the provided timestamp (field <code>start_at_timestamp_nanos</code>) for which node metrics are available. The maximum number of returned timestamps is 60 and no two returned timestamps belong to the same UTC day.</p><p>Note that a sample will only include metrics for nodes whose metrics changed compared to the previous sample. This means that if a node disappears in one sample and later reappears its metrics will restart from 0 and consumers of this API need to adjust for these resets when aggregating over multiple samples.</p><p>A single metric entry is a record with the following fields:</p><ul><li><p><code>node_id</code> (<code>principal</code>): the principal characterizing a node;</p></li><li><p><code>num_blocks_proposed_total</code> (<code>nat64</code>): the number of blocks proposed by this node;</p></li><li><p><code>num_block_failures_total</code> (<code>nat64</code>): the number of failed block proposals by this node.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-subnet-info">IC method <code>subnet_info</code><a href="#ic-subnet-info" class="hash-link" aria-label="Direct link to ic-subnet-info" title="Direct link to ic-subnet-info">â</a></h3><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>Given a subnet ID as input, this method returns a record <code>subnet_info</code> containing metadata about that subnet.</p><p>Currently, the only field returned is the <code>replica_version</code> (<code>text</code>) of the targeted subnet.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-take_canister_snapshot">IC method <code>take_canister_snapshot</code><a href="#ic-take_canister_snapshot" class="hash-link" aria-label="Direct link to ic-take_canister_snapshot" title="Direct link to ic-take_canister_snapshot">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>This method takes a snapshot of the specified canister. A snapshot consists of the wasm memory, stable memory, certified variables, wasm chunk store and wasm binary.</p><p>Subsequent <code>take_canister_snapshot</code> calls will create a new snapshot. However, a <code>take_canister_snapshot</code> call might fail if the maximum number of snapshots per canister is reached. This error can be avoided by providing a snapshot ID via the optional <code>replace_snapshot</code> parameter. The snapshot identified by the specified ID will be deleted once a new snapshot has been successfully created. Currently, only one snapshot per canister is allowed.</p><p>It&#x27;s important to note that a snapshot will increase the memory footprint of the canister. Thus, the canister&#x27;s balance must have a sufficient amount of cycles to not become frozen.</p><p>Only controllers can take a snapshot of a canister and load it back to the canister.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>It&#x27;s important to stop a canister before taking a snapshot to ensure that all outstanding callbacks are completed. Failing to do so may cause the canister to not make sense of the callbacks if its state is restored using the snapshot.
It is expected that the canister controllers (or their tooling) do this separately.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-load_canister_snapshot">IC method <code>load_canister_snapshot</code><a href="#ic-load_canister_snapshot" class="hash-link" aria-label="Direct link to ic-load_canister_snapshot" title="Direct link to ic-load_canister_snapshot">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>This method loads a snapshot identified by <code>snapshot_id</code> onto the canister. It fails if no snapshot with the specified <code>snapshot_id</code> can be found.</p><p>Only controllers can take a snapshot of a canister and load it back to the canister.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>It&#x27;s important to stop a canister before loading a snapshot to ensure that all outstanding callbacks are completed. Failing to do so may cause the canister to not make sense of the callbacks if its state is restored.
It is expected that the canister controllers (or their tooling) do this separately.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>The optional <code>sender_canister_version</code> parameter can contain the caller&#x27;s canister version. If provided, its value must be equal to <code>ic0.canister_version</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-list_canister_snapshots">IC method <code>list_canister_snapshots</code><a href="#ic-list_canister_snapshots" class="hash-link" aria-label="Direct link to ic-list_canister_snapshots" title="Direct link to ic-list_canister_snapshots">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>This method lists the snapshots of the canister identified by <code>canister_id</code>. Only controllers of the canister can list its snapshots. Currently, at most one snapshot per canister will be stored.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-delete_canister_snapshot">IC method <code>delete_canister_snapshot</code><a href="#ic-delete_canister_snapshot" class="hash-link" aria-label="Direct link to ic-delete_canister_snapshot" title="Direct link to ic-delete_canister_snapshot">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>This method deletes a specified snapshot that belongs to an existing canister. An error will be returned if the snapshot is not found. </p><p>A snapshot cannot be found if it was never created, it was previously deleted, replaced by a new snapshot through a <code>take_canister_snapshot</code> request, or if the canister itself has been deleted or run out of cycles.</p><p>A snapshot may be deleted only by the controllers of the canister for which the snapshot was taken.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-fetch_canister_logs">IC method <code>fetch_canister_logs</code><a href="#ic-fetch_canister_logs" class="hash-link" aria-label="Direct link to ic-fetch_canister_logs" title="Direct link to ic-fetch_canister_logs">â</a></h3><p>This method can only be called by external users via non-replicated calls, i.e., it cannot be called by canisters, cannot be called via replicated calls, and cannot be called from composite query calls.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>The canister logs management canister API is considered EXPERIMENTAL. Canister developers must be aware that the API may evolve in a non-backward-compatible way.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>Given a canister ID as input, this method returns a vector of logs of that canister including its trap messages.
The canister logs are <em>not</em> collected in canister methods running in non-replicated mode (NRQ, CQ, CRy, CRt, CC, and F modes, as defined in <a href="#system-api-imports">Overview of imports</a>) and the canister logs are <em>purged</em> when the canister is reinstalled or uninstalled.
The total size of all returned logs does not exceed 4KiB.
If new logs are added resulting in exceeding the maximum total log size of 4KiB, the oldest logs will be removed.
Logs persist across canister upgrades and they are deleted if the canister is reinstalled or uninstalled.</p><p>The log visibility is defined in the <code>log_visibility</code> field of <code>canister_settings</code> and can be one of the following variants:</p><ul><li><code>controllers</code>: only the canister&#x27;s controllers can fetch logs (default);</li><li><code>public</code>: everyone can fetch logs;</li><li><code>allowed_viewers</code> (<code>vec principal</code>): only principals in the provided list and the canister&#x27;s controllers can fetch logs, the maximum length of the list is 10.</li></ul><p>A single log is a record with the following fields:</p><ul><li><code>idx</code> (<code>nat64</code>): the unique sequence number of the log for this particular canister;</li><li><code>timestamp_nanos</code> (<code>nat64</code>): the timestamp as nanoseconds since 1970-01-01 at which the log was recorded;</li><li><code>content</code> (<code>blob</code>): the actual content of the log;</li></ul><div class="admonition_WoCw admonitionWarning_tRva"><p>The response of a query comes from a single replica, and is therefore not appropriate for security-sensitive applications.
Replica-signed queries may improve security because the recipient can verify the response comes from the correct subnet.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#F68E5F"></rect><path d="m5.396 17.258 6.166-11a.502.502 0 0 1 .875 0l6.165 11a.5.5 0 0 1-.437.744H5.835a.5.5 0 0 1-.439-.744Zm6.605-4.588a.5.5 0 0 0-.5.5v2.334a.5.5 0 0 0 1 0V13.17a.5.5 0 0 0-.5-.5Zm-.001-2a.667.667 0 1 0 0 1.334.667.667 0 0 0 0-1.334Z" fill="#fff"></path></svg></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-bitcoin-api">The IC Bitcoin API<a href="#ic-bitcoin-api" class="hash-link" aria-label="Direct link to The IC Bitcoin API" title="Direct link to The IC Bitcoin API">â</a></h2><p>The Bitcoin API exposed by the management canister is DEPRECATED.
Developers should interact with the Bitcoin canisters (<code>ghsi2-tqaaa-aaaan-aaaca-cai</code> for Bitcoin mainnet and <code>g4xu7-jiaaa-aaaan-aaaaq-cai</code> for Bitcoin testnet) directly.
Information about Bitcoin and the IC Bitcoin integration can be found in the <a href="https://developer.bitcoin.org/devguide/" target="_blank" rel="noopener noreferrer">Bitcoin developer guides</a> and  the <a href="https://internetcomputer.org/docs/current/developer-docs/integrations/bitcoin/bitcoin-how-it-works" target="_blank" rel="noopener noreferrer">Bitcoin integration documentation</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-bitcoin_get_utxos">IC method <code>bitcoin_get_utxos</code><a href="#ic-bitcoin_get_utxos" class="hash-link" aria-label="Direct link to ic-bitcoin_get_utxos" title="Direct link to ic-bitcoin_get_utxos">â</a></h3><div class="admonition_WoCw admonitionNote_L5_h"><p>This method is DEPRECATED. Canister developers are advised to call the method of the same name on the Bitcoin (mainnet or testnet) canister.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>Given a <code>get_utxos_request</code>, which must specify a Bitcoin address and a Bitcoin network (<code>mainnet</code> or <code>testnet</code>), the function returns all unspent transaction outputs (UTXOs) associated with the provided address in the specified Bitcoin network based on the current view of the Bitcoin blockchain available to the Bitcoin component. The UTXOs are returned sorted by block height in descending order.</p><p>The following address formats are supported:</p><ul><li><p>Pay to public key hash (P2PKH)</p></li><li><p>Pay to script hash (P2SH)</p></li><li><p>Pay to witness public key hash (P2WPKH)</p></li><li><p>Pay to witness script hash (P2WSH)</p></li><li><p>Pay to taproot (P2TR)</p></li></ul><p>If the address is malformed, the call is rejected.</p><p>The optional <code>filter</code> parameter can be used to restrict the set of returned UTXOs, either providing a minimum number of confirmations or a page reference when pagination is used for addresses with many UTXOs. In the first case, only UTXOs with at least the provided number of confirmations are returned, i.e., transactions with fewer than this number of confirmations are not considered. In other words, if the number of confirmations is <code>c</code>, an output is returned if it occurred in a transaction with at least <code>c</code> confirmations and there is no transaction that spends the same output with at least <code>c</code> confirmations.</p><p>There is an upper bound of 144 on the minimum number of confirmations. If a larger minimum number of confirmations is specified, the call is rejected. Note that this is not a severe restriction as the minimum number of confirmations is typically set to a value around 6 in practice.</p><p>It is important to note that the validity of transactions is not verified in the Bitcoin component. The Bitcoin component relies on the proof of work that goes into the blocks and the verification of the blocks in the Bitcoin network. For a newly discovered block, a regular Bitcoin (full) node therefore provides a higher level of security than the Bitcoin component, which implies that it is advisable to set the number of confirmations to a reasonably large value, such as 6, to gain confidence in the correctness of the returned UTXOs.</p><p>There is an upper bound of 10,000 UTXOs that can be returned in a single request. For addresses that contain sufficiently many UTXOs, a partial set of the address&#x27;s UTXOs are returned along with a page reference.</p><p>In the second case, a page reference (a series of bytes) must be provided, which instructs the Bitcoin component to collect UTXOs starting from the corresponding &quot;page&quot;.</p><p>A <code>get_utxos_request</code> without the optional <code>filter</code> results in a request that considers the full blockchain, which is equivalent to setting <code>min_confirmations</code> to 0.</p><p>The recommended workflow is to issue a request with the desired number of confirmations. If the <code>next_page</code> field in the response is not empty, there are more UTXOs than in the returned vector. In that case, the <code>page</code> field should be set to the <code>next_page</code> bytes in the subsequent request to obtain the next batch of UTXOs.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-bitcoin_get_balance">IC method <code>bitcoin_get_balance</code><a href="#ic-bitcoin_get_balance" class="hash-link" aria-label="Direct link to ic-bitcoin_get_balance" title="Direct link to ic-bitcoin_get_balance">â</a></h3><div class="admonition_WoCw admonitionNote_L5_h"><p>This method is DEPRECATED. Canister developers are advised to call the method of the same name on the Bitcoin (mainnet or testnet) canister.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>Given a <code>get_balance_request</code>, which must specify a Bitcoin address and a Bitcoin network (<code>mainnet</code> or <code>testnet</code>), the function returns the current balance of this address in <code>Satoshi</code> (10^8 Satoshi = 1 Bitcoin) in the specified Bitcoin network. The same address formats as for <a href="#ic-bitcoin_get_utxos"><code>bitcoin_get_utxos</code></a> are supported.</p><p>If the address is malformed, the call is rejected.</p><p>The optional <code>min_confirmations</code> parameter can be used to limit the set of considered UTXOs for the calculation of the balance to those with at least the provided number of confirmations in the same manner as for the <a href="#ic-bitcoin_get_utxos"><code>bitcoin_get_utxos</code></a> call.</p><p>Given an address and the optional <code>min_confirmations</code> parameter, <code>bitcoin_get_balance</code> iterates over all UTXOs, i.e., the same balance is returned as when calling <a href="#ic-bitcoin_get_utxos"><code>bitcoin_get_utxos</code></a> for the same address and the same number of confirmations and, if necessary, using pagination to get all UTXOs for the same tip hash.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-bitcoin_send_transaction">IC method <code>bitcoin_send_transaction</code><a href="#ic-bitcoin_send_transaction" class="hash-link" aria-label="Direct link to ic-bitcoin_send_transaction" title="Direct link to ic-bitcoin_send_transaction">â</a></h3><div class="admonition_WoCw admonitionNote_L5_h"><p>This method is DEPRECATED. Canister developers are advised to call the method of the same name on the Bitcoin (mainnet or testnet) canister.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>Given a <code>send_transaction_request</code>, which must specify a <code>blob</code> of a Bitcoin transaction and a Bitcoin network (<code>mainnet</code> or <code>testnet</code>), several checks are performed:</p><ul><li><p>The transaction is well formed.</p></li><li><p>The transaction only consumes unspent outputs with respect to the current (longest) blockchain, i.e., there is no block on the (longest) chain that consumes any of these outputs.</p></li><li><p>There is a positive transaction fee.</p></li></ul><p>If at least one of these checks fails, the call is rejected.</p><p>If the transaction passes these tests, the transaction is forwarded to the specified Bitcoin network. Note that the function does not provide any guarantees that the transaction will make it into the mempool or that the transaction will ever appear in a block.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-bitcoin_get_current_fee_percentiles">IC method <code>bitcoin_get_current_fee_percentiles</code><a href="#ic-bitcoin_get_current_fee_percentiles" class="hash-link" aria-label="Direct link to ic-bitcoin_get_current_fee_percentiles" title="Direct link to ic-bitcoin_get_current_fee_percentiles">â</a></h3><div class="admonition_WoCw admonitionNote_L5_h"><p>This method is DEPRECATED. Canister developers are advised to call the method of the same name on the Bitcoin (mainnet or testnet) canister.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>The transaction fees in the Bitcoin network change dynamically based on the number of pending transactions. It must be possible for a canister to determine an adequate fee when creating a Bitcoin transaction.</p><p>This function returns fee percentiles, measured in millisatoshi/vbyte (1000 millisatoshi = 1 satoshi), over the last 10,000 transactions in the specified network, i.e., over the transactions in the last approximately 4-10 blocks.</p><p>The <a href="https://en.wikipedia.org/wiki/Percentile#The_nearest-rank_method" target="_blank" rel="noopener noreferrer">standard nearest-rank estimation method</a>, inclusive, with the addition of a 0th percentile is used. Concretely, for any i from 1 to 100, the ith percentile is the fee with rank <code>âi * 100â</code>. The 0th percentile is defined as the smallest fee (excluding coinbase transactions).</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-bitcoin_get_block_headers">IC method <code>bitcoin_get_block_headers</code><a href="#ic-bitcoin_get_block_headers" class="hash-link" aria-label="Direct link to ic-bitcoin_get_block_headers" title="Direct link to ic-bitcoin_get_block_headers">â</a></h3><div class="admonition_WoCw admonitionNote_L5_h"><p>This method is DEPRECATED. Canister developers are advised to call the method of the same name on the Bitcoin (mainnet or testnet) canister.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>This method can only be called by canisters, i.e., it cannot be called by external users via ingress messages.</p><p>Given a start height, an optional end height, and a Bitcoin network (<code>mainnet</code> or <code>testnet</code>), the function returns the block headers in the provided range. The range is inclusive, i.e., the block headers at the start and end heights are returned as well.
An error is returned when an end height is specified that is greater than the tip height.</p><p>If no end height is specified, all blocks until the tip height, i.e., the largest available height, are returned. However, if the range from the start height to the end height or the tip height is large, only a prefix of the requested block headers may be returned in order to bound the size of the response.</p><p>The response is guaranteed to contain the block headers in order: if it contains any block headers, the first block header occurs at the start height, the second block header occurs at the start height plus one and so forth.</p><p>The response is a record consisting of the tip height and the vector of block headers.
The block headers are 80-byte blobs in the <a href="https://developer.bitcoin.org/reference/block_chain.html#block-headers" target="_blank" rel="noopener noreferrer">standard Bitcoin format</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-provisional-api">The IC Provisional API<a href="#ic-provisional-api" class="hash-link" aria-label="Direct link to The IC Provisional API" title="Direct link to The IC Provisional API">â</a></h2><p>The IC Provisional API for creating canisters and topping up canisters out of thin air is only available in local development instances.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-provisional_create_canister_with_cycles">IC method <code>provisional_create_canister_with_cycles</code><a href="#ic-provisional_create_canister_with_cycles" class="hash-link" aria-label="Direct link to ic-provisional_create_canister_with_cycles" title="Direct link to ic-provisional_create_canister_with_cycles">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>As a provisional method on development instances, the <code>provisional_create_canister_with_cycles</code> method is provided. It behaves as <code>create_canister</code>, but initializes the canister&#x27;s balance with <code>amount</code> fresh cycles (using <code>DEFAULT_PROVISIONAL_CYCLES_BALANCE</code> if <code>amount = null</code>). If <code>specified_id</code> is provided, the canister is created under this id. Note that canister creation using <code>create_canister</code> or <code>provisional_create_canister_with_cycles</code> with <code>specified_id = null</code> can fail after calling <code>provisional_create_canister_with_cycles</code> with provided <code>specified_id</code>. In that case, canister creation should be retried.</p><p>The optional <code>sender_canister_version</code> parameter can contain the caller&#x27;s canister version. If provided, its value must be equal to <code>ic0.canister_version</code>.</p><p>Cycles added to this call via <code>ic0.call_cycles_add</code> and <code>ic0.call_cycles_add128</code> are returned to the caller.</p><p>This method is only available in local development instances.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-provisional_top_up_canister">IC method <code>provisional_top_up_canister</code><a href="#ic-provisional_top_up_canister" class="hash-link" aria-label="Direct link to ic-provisional_top_up_canister" title="Direct link to ic-provisional_top_up_canister">â</a></h3><p>This method can be called by canisters as well as by external users via ingress messages.</p><p>As a provisional method on development instances, the <code>provisional_top_up_canister</code> method is provided. It adds <code>amount</code> cycles to the balance of canister identified by <code>amount</code>.</p><p>Cycles added to this call via <code>ic0.call_cycles_add</code> and <code>ic0.call_cycles_add128</code> are returned to the caller.</p><p>Any user can top-up any canister this way.</p><p>This method is only available in local development instances.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="certification">Certification<a href="#certification" class="hash-link" aria-label="Direct link to Certification" title="Direct link to Certification">â</a></h2><p>Some parts of the IC state are exposed to users in a tamperproof way via certification: the IC can reveal a <em>partial state tree</em> which includes just the data of interest, together with a signature on the root hash of the state tree. This means that a user can be sure that the response is correct, even if the user happens to be communicating with a malicious node, or has received the certificate via some other untrusted way.</p><p>To validate a value using a certificate, the user conceptually</p><ol><li><p>checks the validity of the partial tree using <code>verify_cert</code>,</p></li><li><p>looks up the value in the certificate using <code>lookup</code> at a given path, which uses the subroutine <code>lookup_path</code> on the certificate&#x27;s tree.</p></li></ol><p>This mechanism is used in the <code>read_state</code> request type, and eventually also for other purposes.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="root-of-trust">Root of trust<a href="#root-of-trust" class="hash-link" aria-label="Direct link to Root of trust" title="Direct link to Root of trust">â</a></h3><p>The root of trust is the <em>root public key</em>, which must be known to the user a priori. In a local canister execution environment, the key can be fetched via the <a href="#api-status"><code>/api/v2/status</code></a> endpoint.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="certificate">Certificate<a href="#certificate" class="hash-link" aria-label="Direct link to Certificate" title="Direct link to Certificate">â</a></h3><p>A certificate consists of</p><ul><li><p>a tree</p></li><li><p>a signature on the tree root hash valid under some <em>public key</em></p></li><li><p>an optional <em>delegation</em> that links that public key to <em>root public key</em>.</p></li></ul><p>The IC will certify states by issuing certificates where the tree is a partial state tree. The state tree can be pruned by replacing subtrees with their root hashes (yielding a new and potentially smaller but still valid certificate) to only include paths pertaining to relevant data but still preserving enough information to recover the <em>tree root hash</em>.</p><p>More formally, a certificate is described by the following data structure:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Certificate = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  tree : HashTree</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  signature : Signature</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  delegation : NoDelegation | Delegation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HashTree</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = Empty</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Fork HashTree HashTree</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Labeled Label HashTree</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Leaf blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Pruned Hash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Label = Blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Hash = Blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Signature = Blob</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>A certificate is validated with regard to the root of trust by the following algorithm (which uses <code>check_delegation</code> defined in <a href="#certification-delegation">Delegation</a>):</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">verify_cert(cert) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let root_hash = reconstruct(cert.tree)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  // see section Delegations below</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if check_delegation(cert.delegation) = false then return false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let bls_key = delegation_key(cert.delegation)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  verify_bls_signature(bls_key, cert.signature, domain_sep(&quot;ic-state-root&quot;) Â· root_hash)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">reconstruct(Empty)       = H(domain_sep(&quot;ic-hashtree-empty&quot;))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">reconstruct(Fork t1 t2)  = H(domain_sep(&quot;ic-hashtree-fork&quot;) Â· reconstruct(t1) Â· reconstruct(t2))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">reconstruct(Labeled l t) = H(domain_sep(&quot;ic-hashtree-labeled&quot;) Â· l Â· reconstruct(t))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">reconstruct(Leaf v)      = H(domain_sep(&quot;ic-hashtree-leaf&quot;) Â· v)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">reconstruct(Pruned h)    = h</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">domain_sep(s) = byte(|s|) Â· s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>where <code>H</code> is the SHA-256 hash function,</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">verify_bls_signature : PublicKey -&gt; Signature -&gt; Blob -&gt; Bool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>is the <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-bls-signature-04#section-4" target="_blank" rel="noopener noreferrer">BLS signature verification function</a>, ciphersuite BLS<!-- -->_<!-- -->SIG<!-- -->_<!-- -->BLS12381G1<!-- -->_<!-- -->XMD:SHA-256<!-- -->_<!-- -->SSWU<!-- -->_<!-- -->RO<!-- -->_<!-- -->NUL<!-- -->_<!-- -->. See that document also for details on the encoding of BLS public keys and signatures.</p><p>All state trees include the time at path <code>/time</code> (see <a href="#state-tree-time">Time</a>). Users that get a certificate with a state tree can look up the timestamp to guard against working on obsolete data.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="lookup">Lookup<a href="#lookup" class="hash-link" aria-label="Direct link to Lookup" title="Direct link to Lookup">â</a></h3><p>Given a (verified) tree, the user can fetch the value at a given path, which is a sequence of labels (blobs). In this document, we write paths suggestively with slashes as separators; the actual encoding is not actually using slashes as delimiters.</p><p>The following algorithm looks up a <code>path</code> in a certificate, and returns either</p><ul><li><p><code>Found v</code>: the requested <code>path</code> has an associated value <code>v</code> in the tree,</p></li><li><p><code>Absent</code>: the requested path is not in the tree,</p></li><li><p><code>Unknown</code>: it cannot be syntactically determined if the requested <code>path</code> was pruned or not; i.e., there exist at least two trees (one containing the requested path and one <em>not</em> containing the requested path) from which the given tree can be obtained by pruning some subtrees,</p></li><li><p><code>Error</code>: the requested path does not have an associated value in the tree, but the requested path is in the tree:</p></li></ul><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup(path, cert) = lookup_path(path, cert.tree)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([], Empty) = Absent</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([], Leaf v) = Found v</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([], Pruned _) = Unknown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([], Labeled _ _) = Error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([], Fork _ _) = Error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path(l::ls, tree) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  match find_label(l, flatten_forks(tree)) with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Absent -&gt; Absent</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Unknown -&gt; Unknown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Error -&gt; Error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Found subtree -&gt; lookup_path ls subtree</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flatten_forks(Empty) = []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flatten_forks(Fork t1 t2) = flatten_forks(t1) Â· flatten_forks(t2)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flatten_forks(t) = [t]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">find_label(l, _ Â· Labeled l1 t Â· _)                | l == l1     = Found t</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">find_label(l, _ Â· Labeled l1 _ Â· Labeled l2 _ Â· _) | l1 &lt; l &lt; l2 = Absent</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">find_label(l,                    Labeled l2 _ Â· _) |      l &lt; l2 = Absent</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">find_label(l, _ Â· Labeled l1 _ )                   | l1 &lt; l      = Absent</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">find_label(l, [Leaf _])                                          = Absent</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">find_label(l, [])                                                = Absent</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">find_label(l, _)                                                 = Unknown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The IC will only produce well-formed state trees, and the above algorithm assumes well-formed trees. These have the property that labeled subtrees appear in strictly increasing order of labels, and are not mixed with leaves. More formally:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">well_formed(tree) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (tree = Leaf _) â¨ (well_formed_forest(flatten_forks(tree)))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">well_formed_forest(trees) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  strictly_increasing([l | Label l _ â trees]) â§</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  â Label _ t â trees. well_formed(t) â§</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  â t â trees. t â  Leaf _</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="certification-delegation">Delegation<a href="#certification-delegation" class="hash-link" aria-label="Direct link to Delegation" title="Direct link to Delegation">â</a></h3><p>The root key can delegate certification authority to other keys.</p><p>A certificate by the root subnet does not have a delegation field. A certificate by other subnets include a delegation, which is itself a certificate that proves that the subnet is listed in the root subnet&#x27;s state tree (see <a href="#state-tree-subnet">Subnet information</a>), and reveals its public key.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>The certificate included in the delegation (if present) must not itself again contain a delegation.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Delegation = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   subnet_id : Principal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   certificate : Certificate;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>A delegation is verified using the following algorithm:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">check_delegation(NoDelegation) = true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">check_delegation(Delegation d) = verify_cert(d.certificate) and lookup([&quot;subnet&quot;,d.subnet_id,&quot;public_key&quot;],d.certificate) = Found _ and d.certificate.delegation = NoDelegation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The delegation key (a BLS key) is computed by the following algorithm:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">delegation_key(NoDelegation) : public_bls_key = root_public_key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delegation_key(Delegation d) : public_bls_key =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  match lookup([&quot;subnet&quot;,d.subnet_id,&quot;public_key&quot;],d.certificate) with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Found der_key -&gt; extract_der(der_key)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>where <code>root_public_key</code> is the a priori known root key and</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">extract_der : Blob -&gt; Blob</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>implements DER decoding of the public key, following <a href="https://datatracker.ietf.org/doc/html/rfc5480" target="_blank" rel="noopener noreferrer">RFC5480</a> using OID 1.3.6.1.4.1.44668.5.3.1.2.1 for the algorithm and 1.3.6.1.4.1.44668.5.3.2.1 for the curve.</p><p>Delegations are <em>scoped</em>, i.e., they indicate which set of canister principals the delegatee subnet may certify for. This set can be obtained from a delegation <code>d</code> using <code>lookup([&quot;subnet&quot;,d.subnet_id,&quot;canister_ranges&quot;],d.certificate)</code>, which must be present, and is encoded as described in <a href="#state-tree-subnet">Subnet information</a>. The various applications of certificates describe if and how the subnet scope comes into play.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="certification-encoding">Encoding of certificates<a href="#certification-encoding" class="hash-link" aria-label="Direct link to Encoding of certificates" title="Direct link to Encoding of certificates">â</a></h3><p>The binary encoding of a certificate is a CBOR (see <a href="#cbor">CBOR</a>) value according to the following CDDL (see <a href="#cddl">CDDL</a>). You can also <a target="_blank" href="/assets/files/certificates-d29162838334ee47a5b61c824b68de0e.cddl">download the file</a>.</p><p>The values in the <a href="#state-tree">The system state tree</a> are encoded to blobs as follows:</p><ul><li><p>natural numbers are leb128-encoded.</p></li><li><p>text values are UTF-8-encoded</p></li><li><p>blob values are encoded as is</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">â</a></h3><p>Consider the following tree-shaped data (all single character strings denote labels, all other denote values)</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ââ¬â´ &quot;a&quot; ââ¬â &quot;x&quot; ââ´&quot;hello&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> â       ââ´ &quot;y&quot; ââ´&quot;world&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ââ´ &quot;b&quot; âââ´ &quot;good&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ââ´ &quot;c&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ââ´ &quot;d&quot; âââ´ &quot;morning&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>A possible hash tree for this labeled tree might be, where <code>â¬</code> denotes a fork. This is not a typical encoding (a fork with <code>Empty</code> on one side can be avoided), but it is valid.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ââ¬ââ¬â´&quot;a&quot; ââ¬ââ¬â´&quot;x&quot; ââ´&quot;hello&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> â â      â ââ´Empty</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> â â      ââ´  &quot;y&quot; ââ´&quot;world&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> â ââ´&quot;b&quot; âââ´&quot;good&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> âââ¬â´&quot;c&quot; âââ´Empty</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ââ´&quot;d&quot; âââ´&quot;morning&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>This tree has the following CBOR (see <a href="#cbor">CBOR</a>) encoding</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">8301830183024161830183018302417882034568656c6c6f810083024179820345776f726c6483024162820344676f6f648301830241638100830241648203476d6f726e696e67</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>and the following root hash</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">eb5c5b2195e62d996b84c9bcc8259d19a83786a2f59e0878cec84c811f669aa0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Pruning this tree with the following paths</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /a/y</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /ax</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>would lead to this tree (with pruned subtree represented by their hash):</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ââ¬ââ¬â´&quot;a&quot; ââ¬â 1B4FEFF9BEF8131788B0C9DC6DBAD6E81E524249C879E9F10F71CE3749F5A638</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> â â      ââ´ &quot;y&quot; ââ´&quot;world&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> â ââ´&quot;b&quot; âââ´7B32AC0C6BA8CE35AC82C255FC7906F7FC130DAB2A090F80FE12F9C2CAE83BA6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> âââ¬â´EC8324B8A1F1AC16BD2E806EDBA78006479C9877FED4EB464A25485465AF601D</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ââ´&quot;d&quot; âââ´&quot;morning&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Note that the <code>&quot;b&quot;</code> label is included (without content) to prove the absence of the <code>/ax</code> path.</p><p>This tree encodes to CBOR as</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">83018301830241618301820458201b4feff9bef8131788b0c9dc6dbad6e81e524249c879e9f10f71ce3749f5a63883024179820345776f726c6483024162820458207b32ac0c6ba8ce35ac82c255fc7906f7fc130dab2a090f80fe12f9c2cae83ba6830182045820ec8324b8a1f1ac16bd2e806edba78006479c9877fed4eb464a25485465af601d830241648203476d6f726e696e67</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>and (obviously) the same root hash.</p><p>In the pruned tree, the <code>lookup_path</code> function behaves as follows:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([&quot;a&quot;, &quot;a&quot;], pruned_tree) = Unknown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([&quot;a&quot;, &quot;y&quot;], pruned_tree) = Found &quot;world&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([&quot;aa&quot;],     pruned_tree) = Absent</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([&quot;ax&quot;],     pruned_tree) = Absent</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([&quot;b&quot;],      pruned_tree) = Unknown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([&quot;bb&quot;],     pruned_tree) = Unknown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([&quot;d&quot;],      pruned_tree) = Found &quot;morning&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_path([&quot;e&quot;],      pruned_tree) = Absent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http-gateway">The HTTP Gateway protocol<a href="#http-gateway" class="hash-link" aria-label="Direct link to The HTTP Gateway protocol" title="Direct link to The HTTP Gateway protocol">â</a></h2><p>The HTTP Gateway Protocol has been moved into its own <a href="/docs/current/references/http-gateway-protocol-spec">specification</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="abstract-behavior">Abstract behavior<a href="#abstract-behavior" class="hash-link" aria-label="Direct link to Abstract behavior" title="Direct link to Abstract behavior">â</a></h2><p>The previous sections describe the interfaces, i.e. outer edges of the Internet Computer, but give only intuitive and vague information in prose about what these interfaces actually do.</p><p>The present section aims to address that question with great precision, by describing the <em>abstract state</em> of the whole Internet Computer, and how this state can change in response to API function calls, or spontaneously (modeling asynchronous, distributed or non-deterministic execution).</p><p>The design of this abstract specification (e.g. how and where pending messages are stored) are <em>not</em> to be understood to in any way prescribe a concrete implementation or software architecture. The goals here are formal precision and clarity, but not implementability, so this can lead to different ways of phrasing.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="notation">Notation<a href="#notation" class="hash-link" aria-label="Direct link to Notation" title="Direct link to Notation">â</a></h3><p>We specify the behavior of the Internet Computer using ad-hoc pseudocode.</p><p>The manipulated values are primitive values (numbers, text, binary blobs), aggregate values (lists, unordered lists a.k.a. bags, partial maps, records with fixed fields, named constructors) and functions.</p><p>We use a concatenation operator <code>Â·</code> with various types: to extend sets and maps, or to concatenate lists with lists or lists with elements.</p><p>The shape of values is described using a hand-wavy type system. We use <code>Foo = Nat</code> to define type aliases; now <code>Foo</code> can be used instead of <code>Nat</code>. Often, the right-hand side is a more complex type here, e.g. a record, or multiple possible types separated by a vertical bar (<code>|</code>). Partial maps are written as <code>Key â¦ Value</code> and the function type as <code>Argument â Result</code>.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>All values are immutable! State change is specified by describing the new state, not by changing the existing state.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>Record fields are accessed using dot-notation (e.g. <code>S.request_id &gt; 0</code>). To create a new record from an existing record <code>R</code> with some fields changed, the syntax <code>R where field = new_value</code> is used. This syntax can also be used to create new records with some deeply nested field changed: <code>R where some_map[key].field = new_value</code>.</p><p>In the state transitions, upper-case variables (<code>S</code>, <code>C</code>, <code>Req_id</code>) are free variables: The state transition may be taken for any possible value of these variables. <code>S</code> always refers to the previous state. A state transition often comes with a list of <em>conditions</em>, which may restrict the values of these free variables. The <em>state after</em> is usually described using the record update syntax by starting with <code>S where</code>.</p><p>For example, the condition <code>S.messages = Older_messages Â· M Â· Younger_messages</code> says that <code>M</code> is some message in field <code>messages</code> of the record <code>S</code>, and that <code>Younger_messages</code> and <code>Older_messages</code> are the other messages in the state. If the &quot;state after&quot; specifies <code>S with messages = Older_messages Â· Younger_messages</code>, then the message <code>M</code> is removed from the state.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="abstract-state">Abstract state<a href="#abstract-state" class="hash-link" aria-label="Direct link to Abstract state" title="Direct link to Abstract state">â</a></h3><p>In this specification, we describe the Internet Computer as a state machine. In particular, there is a single piece of data that describes the complete state of the IC, called <code>S</code>.</p><p>Of course, this is a huge simplification: The real Internet Computer is distributed and has a multi-component architecture, and the state is spread over many different components, some physically separated. But this simplification allows us to have a concise description of the behavior, and to easily make global decisions (such as, &quot;is there any pending message&quot;), without having to specify the bookkeeping that allows such global decisions.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="identifiers">Identifiers<a href="#identifiers" class="hash-link" aria-label="Direct link to Identifiers" title="Direct link to Identifiers">â</a></h4><p>Principals (canister ids and user ids) are blobs, but some of them have special form, as explained in <a href="#id-classes">Special forms of Principals</a>.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">type Principal = Blob</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The function</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mk_self_authenticating_id : PublicKey -&gt; Principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mk_self_authenticating_id pk = H(pk) Â· 0x02</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>calculates self-authenticating ids.</p><p>The function</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mk_derived_id : Principal -&gt; Blob -&gt; Principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mk_derived_id p nonce = H(|p| Â· p Â· nonce) Â· 0x03</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>calculates derived ids. With <code>|p|</code> we denote the length of the principal, in bytes, encoded as a single byte.</p><p>The principal of the anonymous user is fixed:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">anonymous_id : Principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">anonymous_id = 0x04</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The principal of the management canister is the empty blob (i.e. <code>aaaaa-aa</code>):</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic_principal : Principal = &quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>These function domains and fixed values are mutually disjoint.</p><p>Method names can be arbitrary pieces of text:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">MethodName = Text</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="abstract-canisters">Abstract canisters<a href="#abstract-canisters" class="hash-link" aria-label="Direct link to Abstract canisters" title="Direct link to Abstract canisters">â</a></h4><p>The <a href="#system-api">WebAssembly System API</a> is relatively low-level, and some of its details (e.g. that the argument data is queried using separate calls, and that closures are represented by a function pointer and a number, that method names need to be mangled) would clutter this section. Therefore, we abstract over the WebAssembly details as follows:</p><ul><li><p>The state of a WebAssembly module (memory, tables, globals) is hidden behind an abstract <code>WasmState</code>. The <code>WasmState</code> contains the <code>StableMemory</code>, which can be extracted using <code>pre_upgrade</code> and passed to <code>post_upgrade</code>.</p></li><li><p>A canister module <code>CanisterModule</code> consists of an initial state, and a (pure) function that models function invocation. It either indicates that the canister function traps, or returns a new state together with a description of the invoked asynchronous System API calls.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">WasmState = (abstract)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">StableMemory = (abstract)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Callback = (abstract)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ChunkStore = Hash -&gt; Blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Arg = Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CallerId = Principal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Timestamp = Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CanisterVersion = Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Env = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  time : Timestamp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  controllers : List Principal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  global_timer : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  balance : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balance : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balance_limit : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  compute_allocation : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_allocation : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_raw_module : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_canister_history : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_chunk_store : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_snapshot : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  freezing_threshold : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  subnet_size : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  certificate : NoCertificate | Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  status : Running | Stopping | Stopped;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_version : CanisterVersion;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RejectCode = Nat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Response = Reply Blob | Reject (RejectCode, Text)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MethodCall = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  callee : CanisterId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  method_name: MethodName;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  arg: Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  transferred_cycles: Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  callback: Callback;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UpdateFunc = WasmState -&gt; Trap { cycles_used : Nat; } | Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_state : WasmState;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_calls : List MethodCall;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_certified_data : NoCertifiedData | Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_global_timer : NoGlobalTimer | Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response : NoResponse | Response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_accepted : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_used : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">QueryFunc = WasmState -&gt; Trap { cycles_used : Nat; } | Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response : Response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_used : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CompositeQueryFunc = WasmState -&gt; Trap { cycles_used : Nat; } | Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_state : WasmState;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_calls : List MethodCall;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response : NoResponse | Response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_used : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SystemTaskFunc = WasmState -&gt; Trap { cycles_used : Nat; } | Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_state : WasmState;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_calls : List MethodCall;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_certified_data : NoCertifiedData | Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_global_timer : NoGlobalTimer | Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_used : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AvailableCycles = Nat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RefundedCycles = Nat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    CanisterModule = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      init : (CanisterId, Arg, CallerId, Env) -&gt; Trap { cycles_used : Nat; } | Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_state : WasmState;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_certified_data : NoCertifiedData | Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_global_timer : NoGlobalTimer | Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        cycles_used : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      pre_upgrade : (WasmState, Principal, Env) -&gt; Trap { cycles_used : Nat; } | Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_state : WasmState;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_certified_data : NoCertifiedData | Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        cycles_used : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      post_upgrade : (WasmState, Arg, CallerId, Env) -&gt; Trap { cycles_used : Nat; } | Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_state : WasmState;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_certified_data : NoCertifiedData | Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_global_timer : NoGlobalTimer | Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        cycles_used : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      update_methods : MethodName â¦ ((Arg, CallerId, Env, AvailableCycles) -&gt; UpdateFunc)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      query_methods : MethodName â¦ ((Arg, CallerId, Env) -&gt; QueryFunc)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      composite_query_methods : MethodName â¦ ((Arg, CallerId, Env) -&gt; CompositeQueryFunc)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      heartbeat : (Env) -&gt; SystemTaskFunc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      global_timer : (Env) -&gt; SystemTaskFunc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      callbacks : (Callback, Response, RefundedCycles, Env, AvailableCycles) -&gt; UpdateFunc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      composite_callbacks : (Callback, Response, Env) -&gt; UpdateFunc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      inspect_message : (MethodName, WasmState, Arg, CallerId, Env) -&gt; Trap | Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        status : Accept | Reject;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li></ul><p>This high-level interface presents a pure, mathematical model of a canister, and hides the bookkeeping required to provide the System API as seen in Section <a href="#system-api">Canister interface (System API)</a>.</p><p>The <code>CanisterId</code> parameter of <code>init</code> is merely passed through to the canister, via the <code>canister.self</code> system call.</p><p>The <code>Env</code> parameter provides synchronous read-only access to portions of the system state and canister metadata that are always available.</p><p>The parsing of a blob to a canister module and its public and private custom sections is modelled via the (possibly implicitly failing) functions</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">parse_wasm_mod : Blob -&gt; CanisterModule</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">parse_public_custom_sections : Blob -&gt; Text â¦ Blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">parse_private_custom_sections : Blob -&gt; Text â¦ Blob</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The concrete mapping of this abstract <code>CanisterModule</code> to actual WebAssembly concepts and the System API is described separately in section <a href="#concrete-canisters">Abstract Canisters to System API</a>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="call-contexts">Call contexts<a href="#call-contexts" class="hash-link" aria-label="Direct link to Call contexts" title="Direct link to Call contexts">â</a></h4><p>The Internet Computer provides certain messaging guarantees: If a user or a canister calls another canister, it will eventually get a single response (a reply or a rejection), even if some canister code along the way fails.</p><p>To ensure that only one response is generated, and also to detect when no response can be generated any more, the IC maintains a <em>call context</em>. The <code>needs_to_respond</code> field is set to <code>false</code> once the call has received a response. Further attempts to respond will now fail.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Request = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    nonce : Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ingress_expiry : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sender : UserId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id : CanisterId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    method_name : Text;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    arg : Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CallId = (abstract)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CallOrigin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = FromUser {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      request : Request;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | FromCanister {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      calling_context : CallId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      callback: Callback;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | FromSystemTask</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CallCtxt = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister : CanisterId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  origin : CallOrigin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  needs_to_respond : bool;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  deleted : bool;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  available_cycles : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="calls-and-messages">Calls and Messages<a href="#calls-and-messages" class="hash-link" aria-label="Direct link to Calls and Messages" title="Direct link to Calls and Messages">â</a></h4><p>Calls into and within the IC are implemented as messages passed between canisters. During their lifetime, messages change shape: they begin as a call to a public method, which is resolved to a WebAssembly function that is then executed, potentially generating a response which is then delivered.</p><p>Therefore, a message can have different shapes:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Queue = Unordered | Queue { from : System | CanisterId; to : CanisterId }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EntryPoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = PublicMethod MethodName Principal Blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Callback Callback Response RefundedCycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Heartbeat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | GlobalTimer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Message</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = CallMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      origin : CallOrigin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      caller : Principal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      callee : CanisterId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      method_name : Text;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      arg : Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      transferred_cycles : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      queue : Queue;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | FuncMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      call_context : CallId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      receiver : CanisterId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      entry_point : EntryPoint;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      queue : Queue;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      origin : CallOrigin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      response : Response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      refunded_cycles : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The <code>queue</code> field is used to describe the message ordering behavior. Its concrete value is only used to determine when the relative order of two messages must be preserved, and is otherwise not interpreted. Response messages are not ordered so they have no <code>queue</code> field.</p><p>A reference implementation would likely maintain a separate list of <code>messages</code> for each such queue to efficiently find eligible messages; this document uses a single global list for a simpler and more concise system state.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="api-requests">API requests<a href="#api-requests" class="hash-link" aria-label="Direct link to API requests" title="Direct link to API requests">â</a></h4><p>We distinguish between API requests (type <code>Request</code>) passed to <code>/api/v2/â¦/call</code> and <code>/api/v3/â¦/call</code>, which may be present in the IC state, and the <em>read-only</em> API requests passed to <code>/api/v2/â¦/read_state</code> and <code>/api/v2/â¦/query</code>, which are only ephemeral.</p><p>These are the read-only messages:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Path = List(Blob)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">APIReadRequest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = StateRead = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    nonce : Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ingress_expiry : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sender : UserId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    paths : List(Path);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | CanisterQuery = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    nonce : Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ingress_expiry : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sender : UserId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id : CanisterId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    method_name : Text;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    arg : Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Signed delegations contain the (unsigned) delegation data in a nested record, next to the signature of that data.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">PublicKey = Blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Signature = Blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SignedDelegation = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  delegation : {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pubkey : PublicKey;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    targets : [CanisterId] | Unrestricted;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    expiration : Timestamp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  signature : Signature</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>For the signatures in a <code>Request</code>, we assume that the following function implements signature verification as described in <a href="#authentication">Authentication</a>. This function picks the corresponding signature scheme according to the DER-encoded metadata in the public key.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">verify_signature : PublicKey -&gt; Signature -&gt; Blob -&gt; Bool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Envelope = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  content : Request | APIReadRequest;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sender_pubkey : PublicKey | NoPublicKey;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sender_sig : Signature | NoSignature;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sender_delegation: [SignedDelegation]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The evolution of a <code>Request</code> goes through these states, as explained in <a href="#http-call-overview">Overview of canister calling</a>:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">RequestStatus</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = Received</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Processing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Rejected (RejectCode, Text)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Replied Blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>A <code>Path</code> may refer to a request by way of a <em>request id</em>, as specified in <a href="#request-id">Request ids</a>:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">RequestId = { b â Blob | |b| = 32 }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">hash_of_map: Request -&gt; RequestId</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="the-system-state">The system state<a href="#the-system-state" class="hash-link" aria-label="Direct link to The system state" title="Direct link to The system state">â</a></h4><p>Finally, we can describe the state of the IC as a record having the following fields:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CanState</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> = EmptyCanister | {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  wasm_state : WasmState;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  module : CanisterModule;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  raw_module : Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public_custom_sections: Text â¦ Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private_custom_sections: Text â¦ Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CanStatus</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = Running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Stopping (List (CallOrigin, Nat))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Stopped</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ChangeOrigin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = FromUser {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      user_id : PrincipalId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | FromCanister {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      canister_id : PrincipalId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      canister_version : CanisterVersion | NoCanisterVersion;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CodeDeploymentMode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = Install</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Reinstall</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Upgrade</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SnapshotId = (abstract)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ChangeDetails</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = Creation {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      controllers : [PrincipalId];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | CodeUninstall</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | CodeDeployment {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      mode : CodeDeploymentMode;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      module_hash : Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | LoadSnapshot {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      canister_version : CanisterVersion;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      snapshot_id : SnapshotId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      taken_at_timestamp : Timestamp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | ControllersChange {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      controllers : [PrincipalId];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Change = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  timestamp_nanos : Timestamp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_version : CanisterVersion;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  origin : ChangeOrigin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  details : ChangeDetails;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CanisterHistory = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes : [Change];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CanisterLogVisibility</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = Controllers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | Public</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  | AllowedViewers [Principal]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CanisterLog = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  idx : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  timestamp_nanos : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  content : Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">QueryStats = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  timestamp : Timestamp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  num_instructions : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  request_payload_bytes : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response_payload_bytes : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Subnet = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  subnet_id : Principal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  subnet_size : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Snapshot = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  snapshot_id : SnapshotId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  wasm_state : WasmState;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  raw_module : Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  chunk_store : ChunkStore;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  certified_data : Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_version : CanisterVersion;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  taken_at_timestamp : Timestamp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  requests : Request â¦ (RequestStatus, Principal);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canisters : CanisterId â¦ CanState;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  snapshots: CanisterId â¦ Snapshot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  controllers : CanisterId â¦ Set Principal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  compute_allocation : CanisterId â¦ Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_allocation : CanisterId â¦ Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  freezing_threshold : CanisterId â¦ Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_status: CanisterId â¦ CanStatus;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_version: CanisterId â¦ CanisterVersion;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_subnet : CanisterId â¦ Subnet;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  time : CanisterId â¦ Timestamp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  global_timer : CanisterId â¦ Timestamp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  balances: CanisterId â¦ Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balances: CanisterId â¦ Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balance_limits: CanisterId â¦ Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  wasm_memory_limit: CanisterId â¦ Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  certified_data: CanisterId â¦ Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_history: CanisterId â¦ CanisterHistory;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_log_visibility: CanisterId â¦ CanisterLogVisibility;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_logs: CanisterId â¦ [CanisterLog];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  query_stats: CanisterId â¦ [QueryStats];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  system_time : Timestamp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  call_contexts : CallId â¦ CallCtxt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  messages : List Message; // ordered!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  root_key : PublicKey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>To convert <code>CanStatus</code> into <code>status : Running | Stopping | Stopped</code> from <code>Env</code>, we define the following conversion function:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">simple_status(Running) = Running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">simple_status(Stopping _) = Stopping</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">simple_status(Stopped) = Stopped</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>To convert <code>CallOrigin</code> into <code>ChangeOrigin</code>, we define the following conversion function:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">change_origin(principal, _, FromUser { â¦ }) = FromUser {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    user_id = principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">change_origin(principal, sender_canister_version, FromCanister { â¦ }) = FromCanister {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id = principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version = sender_canister_version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">change_origin(principal, sender_canister_version, FromSystemTask) = FromCanister {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_id = principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version = sender_canister_version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cycle-bookkeeping-and-resource-consumption">Cycle bookkeeping and resource consumption<a href="#cycle-bookkeeping-and-resource-consumption" class="hash-link" aria-label="Direct link to Cycle bookkeeping and resource consumption" title="Direct link to Cycle bookkeeping and resource consumption">â</a></h4><p>The main cycle balance of canister <code>A</code> in state <code>S</code> can be obtained with <code>S.balances(A)</code>.
In addition to the main balance, each canister has a reserved balance <code>S.reserved_balances(A)</code>.
The reserved balance contains cycles that were set aside from the main balance for future payments for the consumption of resources such as compute and memory.
The reserved cycles can only be used for resource payments and cannot be transferred back to the main balance.</p><p>The (unspecified) function <code>idle_cycles_burned_rate(compute_allocation, memory_allocation, memory_usage, subnet_size)</code> determines the idle resource consumption rate in cycles per day of a canister given its current compute and memory allocation, memory usage, and subnet size. The function <code>freezing_limit(compute_allocation, memory_allocation, freezing_threshold, memory_usage, subnet_size)</code> determines the freezing limit in cycles of a canister given its current compute and memory allocation, freezing threshold in seconds, memory usage, and subnet size. The value <code>freezing_limit(compute_allocation, memory_allocation, freezing_threshold, memory_usage, subnet_size)</code> is derived from <code>idle_cycles_burned_rate(compute_allocation, memory_allocation, memory_usage, subnet_size)</code> and <code>freezing_threshold</code> as follows:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">freezing_limit(compute_allocation, memory_allocation, freezing_threshold, memory_usage, subnet_size) = idle_cycles_burned_rate(compute_allocation, memory_allocation, memory_usage, subnet_size) * freezing_threshold / (24 * 60 * 60)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The (unspecified) functions <code>memory_usage_wasm_state(wasm_state)</code>, <code>memory_usage_raw_module(raw_module)</code>, <code>memory_usage_canister_history(canister_history)</code>, <code>memory_usage_chunk_store(chunk_store)</code>, and <code>memory_usage_snapshot(snapshot)</code> determine the canister&#x27;s memory usage in bytes consumed by its Wasm state, raw Wasm binary, canister history, chunk store, and snapshot, respectively.</p><p>The freezing limit of canister <code>A</code> in state <code>S</code> can be obtained as follows:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">freezing_limit(S, A) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  freezing_limit(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    S.compute_allocation[A],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    S.memory_allocation[A],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    S.freezing_threshold[A],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_wasm_state(S.canisters[A].wasm_state) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      memory_usage_raw_module(S.canisters[A].raw_module) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      memory_usage_canister_history(S.canister_history[A]) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      memory_usage_chunk_store(S.chunk_store[A]) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      memory_usage_snapshot(S.snapshots[A]),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    S.canister_subnet[A].subnet_size,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The amount of cycles that is available for spending in calls and execution is computed by the function <code>liquid_balance(balance, reserved_balance, freezing_limit)</code>:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(balance, reserved_balance, freezing_limit) = balance - max(freezing_limit - reserved_balance, 0)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The &quot;liquid&quot; balance of canister <code>A</code> in state <code>S</code> can be obtained as follows:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(S, A) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  liquid_balance(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    S.balances[A],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    S.reserved_balances[A],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    freezing_limit(S, A),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The reasoning behind this is that resource payments first drain the reserved balance and only when the reserved balance gets to zero, they start draining the main balance.</p><p>The amount of cycles that need to be reserved after operations that allocate resources is modeled with an unspecified function <code>cycles_to_reserve(S, CanisterId, compute_allocation, memory_allocation, snapshots, CanState)</code> that depends on the old IC state, the id of the canister, the new allocations of the canister, the snapshots of the canister, and the new state of the canister.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="initial-state">Initial state<a href="#initial-state" class="hash-link" aria-label="Direct link to Initial state" title="Direct link to Initial state">â</a></h4><p>The initial state of the IC is</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  requests = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canisters = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  snapshots = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  controllers = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  compute_allocation = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_allocation = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  freezing_threshold = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_status = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_version = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_subnet = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  time = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  global_timer = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  balances = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balances = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balance_limits = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  wasm_memory_limit = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  certified_data = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_history = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_log_visibility = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_logs = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  query_stats = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  system_time = T;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  call_contexts = ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  messages = [];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  root_key = PublicKey;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>for some time stamp <code>T</code>, some DER-encoded BLS public key <code>PublicKey</code>, and using <code>()</code> to denote the empty map or bag.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="invariants">Invariants<a href="#invariants" class="hash-link" aria-label="Direct link to Invariants" title="Direct link to Invariants">â</a></h3><p>The following is an incomplete list of invariants that should hold for the abstract state <code>S</code>, and are not already covered by the type annotations in this section.</p><ul><li><p>No pair of update, query, and composite query methods in a CanisterModule can have the same name:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">â (_ â¦ CanState) â S.canisters:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dom(CanState.module.update_methods) â© dom(CanState.module.query_methods) = â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dom(CanState.module.update_methods) â© dom(CanState.module.composite_query_methods) = â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dom(CanState.module.query_methods) â© dom(CanState.module.composite_query_methods) = â</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li><li><p>Deleted call contexts were not awaiting a response:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">â (_ â¦ Ctxt) â S.call_contexts:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if Ctxt.deleted then Ctxt.needs_to_respond = false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li><li><p>Responded call contexts have no available<!-- -->_<!-- -->cycles left:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">â (_ â¦ Ctxt) â S.call_contexts:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if Ctxt.needs_to_respond = false then Ctxt.available_cycles = 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li><li><p>A stopped canister does not have any call contexts (in particular, a stopped canister does not have any call contexts marked as deleted):</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">â (_ â¦ Ctxt) â S.call_contexts:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  S.canister_status[Ctxt.canister] â  Stopped</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li><li><p>Referenced call contexts exist:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">â CallMessage {origin = FromCanister O, â¦} â S.messages. O.calling_context â dom(S.call_contexts)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â ResponseMessage {origin = FromCanister O, â¦} â S.messages. O.calling_context â dom(S.call_contexts)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â (_ â¦ {needs_to_respond = true, origin = FromCanister O, â¦}) â S.call_contexts: O.calling_context â dom(S.call_contexts)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â (_ â¦ Stopping Origins) â S.canister_status: â(FromCanister O, _) â Origins. O.calling_context â dom(S.call_contexts)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="state-transitions">State transitions<a href="#state-transitions" class="hash-link" aria-label="Direct link to State transitions" title="Direct link to State transitions">â</a></h3><p>Based on this abstract notion of the state, we can describe the behavior of the IC. There are three classes of behaviors:</p><ul><li><p>Potentially state changing API requests that are submitted via <code>/api/v2/â¦/call</code> and <code>/api/v3/â¦/call</code>. These transitions describe checks that the request must pass to be considered received.</p></li><li><p>Spontaneous transitions that model the internal behavior of the IC, by describing conditions on the state that allow the transition to happen, and the state after.</p></li><li><p>Responses to reads (i.e. <code>/api/v2/â¦/read_state</code> and <code>/api/v2/â¦/query</code>). By definition, these do <em>not</em> change the state of the IC, and merely describe the response based on the read request (or query, respectively) and the current state.</p></li></ul><p>The state transitions are not complete with regard to error handling. For example, the behavior of sending a request to a non-existent canister is not specified here. For now, we trust implementors to make sensible decisions there.</p><p>We model the <a href="#ic-management-canister">The IC management canister</a> with one state transition per method. There, we assume a function</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">candid : Value -&gt; Blob</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>that represents Candid encoding; this is implicitly taking the method types, as declared in <a href="#ic-candid">Interface overview</a>, into account. We model the parsing of Candid values in the &quot;Conditions&quot; section using <code>candid</code> as well, by treating it as a non-deterministic function.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="envelope-authentication">Envelope Authentication<a href="#envelope-authentication" class="hash-link" aria-label="Direct link to Envelope Authentication" title="Direct link to Envelope Authentication">â</a></h4><p>The following predicate describes when an envelope <code>E</code> correctly signs the enclosed request with a key belonging to a user <code>U</code>, at time <code>T</code>: It returns which canister ids this envelope may be used at (as a set of principals).</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">verify_envelope({ content = C }, U, T)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = { p : p is CanisterID } if U = anonymous_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">verify_envelope({ content = C, sender_pubkey = PK, sender_sig = Sig, sender_delegation = DS}, U, T)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = TS if U = mk_self_authenticating_id E.sender_pubkey</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  â§ (PK&#x27;, TS) = verify_delegations(DS, PK, T, { p : p is CanisterId })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  â§ verify_signature PK&#x27; Sig (&quot;\x0Aic-request&quot; Â· hash_of_map(C))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">verify_delegations([], PK, T, TS) = (PK, TS)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">verify_delegations([D] Â· DS, PK, T, TS)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = verify_delegations(DS, D.pubkey, T, TS â© delegation_targets(D))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if verify_signature PK D.signature (&quot;\x1Aic-request-auth-delegation&quot; Â· hash_of_map(D.delegation))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   â§ D.delegation.expiration â¥ T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delegation_targets(D)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = if D.targets = Unrestricted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    then { p : p is CanisterId }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    else D.targets</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="effective-canister-ids">Effective canister ids<a href="#effective-canister-ids" class="hash-link" aria-label="Direct link to Effective canister ids" title="Direct link to Effective canister ids">â</a></h4><p>A <code>Request</code> has an effective canister id according to the rules in <a href="#http-effective-canister-id">Effective canister id</a>:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">is_effective_canister_id(Request {canister_id = ic_principal, method = provisional_create_canister_with_cycles, â¦}, p)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">is_effective_canister_id(Request {canister_id = ic_principal, method = install_chunked_code, arg = candid({target_canister = p, â¦}), â¦}, p)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">is_effective_canister_id(Request {canister_id = ic_principal, arg = candid({canister_id = p, â¦}), â¦}, p)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">is_effective_canister_id(Request {canister_id = p, â¦}, p), if p â  ic_principal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="api-request-submission">API Request submission<a href="#api-request-submission" class="hash-link" aria-label="Direct link to API Request submission" title="Direct link to API Request submission">â</a></h4><p>After a node accepts a request via <code>/api/v2/canister/&lt;ECID&gt;/call</code> or <code>/api/v3/canister/&lt;ECID&gt;/call</code>, the request gets added to the IC state as <code>Received</code>.</p><p>This may only happen if the signature is valid and is created with a correct key. Due to this check, the envelope is discarded after this point.</p><p>Requests that have expired are dropped here.</p><p>Ingress message inspection is applied, and messages that are not accepted by the canister are dropped.</p><p>Submitted request
<code>E : Envelope</code></p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">E.content.canister_id â verify_envelope(E, E.content.sender, S.system_time)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|E.content.nonce| &lt;= 32</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">E.content â dom(S.requests)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.system_time &lt;= E.content.ingress_expiry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">is_effective_canister_id(E.content, ECID)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">( E.content.canister_id = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  E.content.arg = candid({canister_id = CanisterId, â¦})</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  E.content.sender â S.controllers[CanisterId]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  E.content.method_name â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    { &quot;install_code&quot;, &quot;install_chunked_code&quot;, &quot;uninstall_code&quot;, &quot;update_settings&quot;, &quot;start_canister&quot;, &quot;stop_canister&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;canister_status&quot;, &quot;delete_canister&quot;, &quot;upload_chunk&quot;, &quot;clear_chunk_store&quot;, &quot;stored_chunks&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;provisional_top_up_canister&quot; }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) â¨ (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  E.content.canister_id = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  E.content.method_name â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    { &quot;provisional_create_canister_with_cycles&quot; }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">) â¨ (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  E.content.canister_id â  ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  S.canisters[E.content.canister_id] â  EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  S.canister_status[E.content.canister_id] = Running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Env = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    time = S.time[E.content.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    controllers = S.controllers[E.content.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    global_timer = S.global_timer[E.content.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balance = S.balances[E.content.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balance = S.reserved_balances[E.content.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balance_limit = S.reserved_balance_limits[E.content.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    compute_allocation = S.compute_allocation[E.content.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_allocation = S.memory_allocation[E.content.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_raw_module = memory_usage_raw_module(S.canisters[E.content.canister_id].raw_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_canister_history = memory_usage_canister_history(S.canister_history[E.content.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_chunk_store = memory_usage_chunk_store(S.chunk_store[E.content.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_snapshot = memory_usage_snapshot(S.snapshots[E.content.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    freezing_threshold = S.freezing_threshold[E.content.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    subnet_size = S.canister_subnet[E.content.canister_id].subnet_size;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    certificate = NoCertificate;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    status = simple_status(S.canister_status[E.content.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version = S.canister_version[E.content.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  liquid_balance(S, E.content.canister_id) â¥ 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  S.canisters[E.content.canister_id].module.inspect_message</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (E.content.method_name, S.canisters[E.content.canister_id].wasm_state, E.content.arg, E.content.sender, Env) = Return {status = Accept;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    requests[E.content] = (Received, ECID)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><div class="admonition_WoCw admonitionNote_L5_h"><p>This is not instantaneous (the IC takes some time to agree it accepts the request) nor guaranteed (a node could just drop the request, or maybe it did not pass validation). But once the request has entered the IC state like this, it will be acted upon.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="request-rejection">Request rejection<a href="#request-rejection" class="hash-link" aria-label="Direct link to Request rejection" title="Direct link to Request rejection">â</a></h4><p>The IC may reject a received message for internal reasons (high load, low resources) or expiry. The precise conditions are not specified here, but the reject code must indicate this to be a system error.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.requests[R] = (Received, ECID)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Code = SYS_FATAL or Code = SYS_TRANSIENT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    requests[R] = (Rejected (Code, Msg), ECID)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="initiating-canister-calls">Initiating canister calls<a href="#initiating-canister-calls" class="hash-link" aria-label="Direct link to Initiating canister calls" title="Direct link to Initiating canister calls">â</a></h4><p>A first step in processing a canister update call is to create a <code>CallMessage</code> in the message queue.</p><p>The <code>request</code> field of the <code>FromUser</code> origin establishes the connection to the API message. One could use the corresponding <code>hash_of_map</code> for this purpose, but this formulation is more abstract.</p><p>The IC does not make any guarantees about the order of incoming messages.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.requests[R] = (Received, ECID)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.system_time &lt;= R.ingress_expiry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C = S.canisters[R.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    requests[R] = (Processing, ECID)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      CallMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = FromUser { request = R };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        caller = R.sender;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        callee = R.canister_id;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        method_name = R.method_name;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        arg = R.arg;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        transferred_cycles = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        queue = Unordered;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      } Â· S.messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="calls-to-stoppedstopping-canisters-are-rejected">Calls to stopped/stopping canisters are rejected<a href="#calls-to-stoppedstopping-canisters-are-rejected" class="hash-link" aria-label="Direct link to Calls to stopped/stopping canisters are rejected" title="Direct link to Calls to stopped/stopping canisters are rejected">â</a></h4><p>A call to a canister which is stopping, or stopped is automatically rejected.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage CM Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(CM.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  CM.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canisters[CM.callee] â  EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[CM.callee] = Stopped or S.canister_status[CM.callee] = Stopping</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">messages = Older_messages Â· Younger_messages  Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      origin = CM.origin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      response = Reject (CANISTER_ERROR, </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">implementation-specific</span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      refunded_cycles = CM.transferred_cycles;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="calls-to-frozen-canisters-are-rejected">Calls to frozen canisters are rejected<a href="#calls-to-frozen-canisters-are-rejected" class="hash-link" aria-label="Direct link to Calls to frozen canisters are rejected" title="Direct link to Calls to frozen canisters are rejected">â</a></h4><p>A call to a canister which is frozen is automatically rejected.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage CM Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(CM.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  CM.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canisters[CM.callee] â  EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(S, CM.callee) &lt; 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">messages = Older_messages Â· Younger_messages  Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      origin = CM.origin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      response = Reject (SYS_TRANSIENT, </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">implementation-specific</span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      refunded_cycles = CM.transferred_cycles;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="call-context-creation">Call context creation<a href="#call-context-creation" class="hash-link" aria-label="Direct link to Call context creation" title="Direct link to Call context creation">â</a></h4><p>Before invoking a heartbeat, a global timer, or a message to a public entry point, a call context is created for bookkeeping purposes. For these invocations the canister must be running (so not stopped or stopping). Additionally, these invocations only happen for &quot;real&quot; canisters, not the IC management canister.</p><p>This &quot;bookkeeping transition&quot; must be immediately followed by the corresponding <a href="#rule-message-execution">&quot;Message execution&quot; transition</a>.</p><p><em>Call context creation: Public entry points</em></p><p>For a message to a public entry point, the method is looked up in the list of exports. This happens for both ingress and inter-canister messages.</p><p>The position of the message in the queue is unchanged.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage CM Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(CM.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  CM.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canisters[CM.callee] â  EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[CM.callee] = Running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(S, CM.callee) â¥ MAX_CYCLES_PER_MESSAGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Ctxt_id â dom(S.call_contexts)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Older_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      FuncMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        call_context = Ctxt_id;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        receiver = CM.callee;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        entry_point = PublicMethod CM.method_name CM.caller CM.arg;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        queue = CM.queue;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      } Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    call_contexts[Ctxt_id] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      canister = CM.callee;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      origin = CM.origin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      needs_to_respond = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      deleted = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      available_cycles = CM.transferred_cycles;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[CM.callee] = S.balances[CM.callee] - MAX_CYCLES_PER_MESSAGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p><em>Call context creation: Heartbeat</em></p><p>If canister <code>C</code> exports a method with name <code>canister_heartbeat</code>, the IC will create the corresponding call context.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canisters[C] â  EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[C] = Running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(S, C) â¥ MAX_CYCLES_PER_MESSAGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Ctxt_id â dom(S.call_contexts)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      FuncMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        call_context = Ctxt_id;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        receiver = C;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        entry_point = Heartbeat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        queue = Queue { from = System; to = C };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Â· S.messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    call_contexts[Ctxt_id] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      canister = C;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      origin = FromSystemTask;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      needs_to_respond = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      deleted = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      available_cycles = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[C] = S.balances[C] - MAX_CYCLES_PER_MESSAGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p><em>Call context creation: Global timer</em></p><p>If canister <code>C</code> exports a method with name <code>canister_global_timer</code>, the global timer of canister <code>C</code> is set, and the current time for canister <code>C</code> has passed the value of the global timer, the IC will create the corresponding call context and deactivate the global timer.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canisters[C] â  EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[C] = Running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.global_timer[C] â  0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.time[C] â¥ S.global_timer[C]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(S, C) â¥ MAX_CYCLES_PER_MESSAGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Ctxt_id â dom(S.call_contexts)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      FuncMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        call_context = Ctxt_id;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        receiver = C;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        entry_point = GlobalTimer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        queue = Queue { from = System; to = C };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Â· S.messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    call_contexts[Ctxt_id] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      canister = C;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      origin = FromSystemTask;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      needs_to_respond = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      deleted = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      available_cycles = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    global_timer[C] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[C] = S.balances[C] - MAX_CYCLES_PER_MESSAGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The IC can execute any message that is at the head of its queue, i.e. there is no older message with the same abstract <code>queue</code> field. The actual message execution, if successful, may enqueue further messages andâ---âif the function returns a responseâ---ârecord this response. The new call and response messages are enqueued at the end.</p><p>Note that new messages are executed only if the canister is Running and is not frozen.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rule-message-execution">Message execution<a href="#rule-message-execution" class="hash-link" aria-label="Direct link to Message execution" title="Direct link to Message execution">â</a></h4><p>The transition models the actual execution of a message, whether it is an initial call to a public method or a response. In either case, a call context already exists (see transition &quot;Call context creation&quot;).</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· FuncMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canisters[M.receiver] â  EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Mod = S.canisters[M.receiver].module</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Is_response = M.entry_point == Callback _ _ _</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Env = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  time = S.time[M.receiver];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  controllers = S.controllers[M.receiver];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  global_timer = S.global_timer[M.receiver];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  balance = S.balances[M.receiver]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balance = S.reserved_balances[M.receiver];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balance_limit = S.reserved_balance_limits[M.receiver];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  compute_allocation = S.compute_allocation[M.receiver];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_allocation = S.memory_allocation[M.receiver];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_raw_module = memory_usage_raw_module(S.canisters[M.receiver].raw_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_canister_history = memory_usage_canister_history(S.canister_history[M.receiver]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_chunk_store = memory_usage_chunk_store(S.chunk_store[M.receiver]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_snapshot = memory_usage_snapshot(S.snapshots[M.receiver]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  freezing_threshold = S.freezing_threshold[M.receiver];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  subnet_size = S.canister_subnet[M.receiver].subnet_size;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  certificate = NoCertificate;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  status = simple_status(S.canister_status[M.receiver]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_version = S.canister_version[M.receiver];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Available = S.call_contexts[M.call_contexts].available_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">( M.entry_point = PublicMethod Name Caller Arg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  F = Mod.update_methods[Name](Arg, Caller, Env, Available)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_canister_version = S.canister_version[M.receiver] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Wasm_memory_limit = S.wasm_memory_limit[M.receiver]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">( M.entry_point = PublicMethod Name Caller Arg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  F = query_as_update(Mod.query_methods[Name], Arg, Caller, Env)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_canister_version = S.canister_version[M.receiver]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Wasm_memory_limit = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">( M.entry_point = Callback Callback Response RefundedCycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  F = Mod.callbacks(Callback, Response, RefundedCycles, Env, Available)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_canister_version = S.canister_version[M.receiver] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Wasm_memory_limit = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">( M.entry_point = Heartbeat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  F = system_task_as_update(Mod.heartbeat, Env)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_canister_version = S.canister_version[M.receiver] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Wasm_memory_limit = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">( M.entry_point = GlobalTimer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  F = system_task_as_update(Mod.global_timer, Env)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_canister_version = S.canister_version[M.receiver] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Wasm_memory_limit = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">R = F(S.canisters[M.receiver].wasm_state)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  R = Return res</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  validate_sender_canister_version(res.new_calls, S.canister_version[M.receiver])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  res.cycles_used â¤ (if Is_response then MAX_CYCLES_PER_RESPONSE else MAX_CYCLES_PER_MESSAGE)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  res.cycles_accepted â¤ Available</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (res.cycles_used + â [ MAX_CYCLES_PER_RESPONSE + call.transferred_cycles | call â res.new_calls ]) â¤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (S.balances[M.receiver] + res.cycles_accepted + (if Is_response then MAX_CYCLES_PER_RESPONSE else MAX_CYCLES_PER_MESSAGE))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Cycles_reserved = cycles_to_reserve(S, A.canister_id, S.compute_allocation[A.canister_id], S.memory_allocation[A.canister_id], S.snapshots[A.canister_id], New_state)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_balance =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      (S.balances[M.receiver] + res.cycles_accepted + (if Is_response then MAX_CYCLES_PER_RESPONSE else MAX_CYCLES_PER_MESSAGE))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - (res.cycles_used + â [ MAX_CYCLES_PER_RESPONSE + call.transferred_cycles | call â res.new_calls ])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_reserved_balance = S.reserved_balances[M.receiver] + Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Min_balance = if Is_response then 0 else freezing_limit(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    S.compute_allocation[M.receiver],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    S.memory_allocation[M.receiver],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    S.freezing_threshold[M.receiver],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_wasm_state(res.new_state) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      memory_usage_raw_module(S.canisters[M.receiver].raw_module) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      memory_usage_canister_history(S.canister_history[M.receiver]) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      memory_usage_chunk_store(S.chunk_store[M.receiver]) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      memory_usage_snapshot(S.snapshots[M.receiver]),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    S.canister_subnet[M.receiver].subnet_size,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_reserved_balance â¤ S.reserved_balance_limits[M.receiver]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  liquid_balance(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New_balance,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New_reserved_balance,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Min_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ) â¥ 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (S.memory_allocation[M.receiver] = 0) or (memory_usage_wasm_state(res.new_state) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_raw_module(S.canisters[M.receiver].raw_module) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_canister_history(S.canister_history[M.receiver]) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_chunk_store(S.chunk_store[M.receiver]) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_snapshot(S.snapshots[M.receiver]) â¤ S.memory_allocation[M.receiver])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (Wasm_memory_limit = 0) or |res.new_state.store.mem| &lt;= Wasm_memory_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (res.response = NoResponse) or S.call_contexts[M.call_context].needs_to_respond</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canisters[M.receiver].wasm_state = res.new_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[M.receiver] = New_canister_version;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Older_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      [ CallMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          origin = FromCanister {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            call_context = M.call_context;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            callback = call.callback;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          caller = M.receiver;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          callee = call.callee;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          method_name = call.method_name;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          arg = call.arg;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          transferred_cycles = call.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          queue = Queue { from = M.receiver; to = call.callee };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      | call â res.new_calls ] Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      [ ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          origin = S.call_contexts[M.call_context].origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          response = res.response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          refunded_cycles = Available - res.cycles_accepted;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      | res.response â  NoResponse ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if res.response = NoResponse:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       call_contexts[M.call_context].available_cycles = Available - res.cycles_accepted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       call_contexts[M.call_context].needs_to_respond = false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       call_contexts[M.call_context].available_cycles = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if res.new_certified_data â  NoCertifiedData:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      certified_data[M.receiver] = res.new_certified_data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if res.new_global_timer â  NoGlobalTimer:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      global_timer[M.receiver] = res.new_global_timer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[M.receiver] = New_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balances[M.receiver] = New_reserved_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_logs[M.receiver] = S.canister_logs[M.receiver] Â· canister_logs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[M.receiver] =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      (S.balances[M.receiver] + (if Is_response then MAX_CYCLES_PER_RESPONSE else MAX_CYCLES_PER_MESSAGE))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - min (R.cycles_used, (if Is_response then MAX_CYCLES_PER_RESPONSE else MAX_CYCLES_PER_MESSAGE))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Depending on whether this is a call message and a response messages, we have either set aside <code>MAX_CYCLES_PER_MESSAGE</code> or <code>MAX_CYCLES_PER_RESPONSE</code>, either in the call context creation rule or the Callback invocation rule.</p><p>The cycle consumption of executing this message is modeled via the unspecified <code>cycles_used</code> variable; the variable takes some value between 0 and <code>MAX_CYCLES_PER_MESSAGE</code>/<code>MAX_CYCLES_PER_RESPONSE</code> (for call execution and response execution, respectively).</p><p>The logs produced by the canister during message execution are modeled via the unspecified <code>canister_logs</code> variable; the variable stores a list of logs (each of type <code>CanisterLog</code>) with consecutive sequence numbers, timestamps equal to <code>S.time[M.receiver]</code>, and contents produced by the canister calling <code>ic0.debug_print</code>, <code>ic0.trap</code>, or produced by the WebAssembly runtime when the canister WebAssembly module traps.</p><p>This transition detects certain behavior that will appear as a trap (and which an implementation may implement by trapping directly in a system call):</p><ul><li><p>Responding if the present call context does not need to be responded to</p></li><li><p>Accepting more cycles than are available on the call context</p></li><li><p>Sending out more cycles than available to the canister</p></li><li><p>Consuming more cycles than allowed (and reserved)</p></li></ul><p>If message execution <a href="#system-api-module"><em>traps</em> (in the sense of a Wasm function)</a>, the message gets dropped. No response is generated (as some other message may still fulfill this calling context). Any state mutation is discarded. If the message was a call, the associated cycles are held by its associated call context and will be refunded to the caller, see <a href="#rule-starvation">Call context starvation</a>.</p><p>If message execution <a href="#system-api-module"><em>returns</em> (in the sense of a Wasm function)</a>, the state is updated and possible outbound calls and responses are enqueued.</p><p>Note that returning does <em>not</em> imply that the call associated with this message now <em>succeeds</em> in the sense defined in <a href="#responding">section responding</a>; that would require a (unique) call to <code>ic0.reply</code>. Note also that the state changes are persisted even when the IC is set to synthesize a <a href="#reject-codes">CANISTER<!-- -->_<!-- -->ERROR</a> reject immediately afterward (which happens when this returns without calling <code>ic0.reply</code> or <code>ic0.reject</code>, the corresponding call has not been responded to and there are no outstanding callbacks, see <a href="#rule-starvation">Call context starvation</a>).</p><p>The function <code>validate_sender_canister_version</code> checks that <code>sender_canister_version</code> matches the actual canister version of the sender in all calls to the methods of the management canister that take <code>sender_canister_version</code>:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">validate_sender_canister_version(new_calls, canister_version_from_system) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  â call â new_calls. (call.callee = ic_principal and (call.method = &#x27;create_canister&#x27; or call.method = &#x27;update_settings&#x27; or call.method = &#x27;install_code&#x27; or call.method = `install_chunked_code` or call.method = &#x27;uninstall_code&#x27; or call.method = &#x27;provisional_create_canister_with_cycles&#x27;) and call.arg = candid(A) and A.sender_canister_version = n) =&gt; n = canister_version_from_system</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The functions <code>query_as_update</code> and <code>system_task_as_update</code> turns a query function (note that composite query methods cannot be called when executing a message during this transition) resp the heartbeat or global timer into an update function; this is merely a notational trick to simplify the rule:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">query_as_update(f, arg, env) = Î» wasm_state â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  match f(arg, env)(wasm_state) with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Trap trap â Trap trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Return res â Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_calls = [];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_certified_data = NoCertifiedData;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_global_timer = NoGlobalTimer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      response = res.response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      cycles_accepted = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      cycles_used = res.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">system_task_as_update(f, env) = Î» wasm_state â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  match f(env)(wasm_state) with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Trap trap â Trap trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Return res â Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_state = res.new_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_calls = res.new_calls;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_certified_data = res.new_certified_data;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_global_timer = res.new_global_timer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      response = NoResponse;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      cycles_accepted = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      cycles_used = res.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Note that by construction, a query function will either trap or return with a response; it will never send calls, and it will never change the state of the canister.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="request-rejection">Spontaneous request rejection<a href="#request-rejection" class="hash-link" aria-label="Direct link to Spontaneous request rejection" title="Direct link to Spontaneous request rejection">â</a></h4><p>The system can reject a request at any point in time, e.g., because it is overloaded.</p><p>Condition:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage CM Â· Younger_messages</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after, with <code>reject_code</code> being an arbitrary reject code:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Older_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Â· ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = CM.origin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reject (reject_code, </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">implementation-specific</span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = CM.transferred_cycles;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rule-starvation">Call context starvation<a href="#rule-starvation" class="hash-link" aria-label="Direct link to Call context starvation" title="Direct link to Call context starvation">â</a></h4><p>If the call context needs to respond (in particular, if the call context is not for a system task) and there is no call, downstream call context, or response that references a call context, then a reject is synthesized. The error message below is <em>not</em> indicative. In particular, if the IC has an idea about <em>why</em> this starved, it can put that in there (e.g. the initial message handler trapped with an out-of-memory access).</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.call_contexts[Ctxt_id].needs_to_respond = true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â CallMessage {origin = FromCanister O, â¦} â S.messages. O.calling_context â  Ctxt_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â ResponseMessage {origin = FromCanister O, â¦} â S.messages. O.calling_context â  Ctxt_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â (_ â¦ {needs_to_respond = true, origin = FromCanister O, â¦}) â S.call_contexts: O.calling_context â  Ctxt_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â (_ â¦ Stopping Origins) â S.canister_status: â(FromCanister O, _) â Origins. O.calling_context â  Ctxt_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    call_contexts[Ctxt_id].needs_to_respond = false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    call_contexts[Ctxt_id].available_cycles = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      S.messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = S.call_contexts[Ctxt_id].origin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reject (CANISTER_ERROR, </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">implementation-specific</span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain">);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = S.call_contexts[Ctxt_id].available_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="call-context-removal">Call context removal<a href="#call-context-removal" class="hash-link" aria-label="Direct link to Call context removal" title="Direct link to Call context removal">â</a></h4><p>If there is no call, downstream call context, or response that references a call context, and the call context does not need to respond (because it has already responded or its origin is a system task that does not await a response), then the call context can be removed.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.call_contexts[Ctxt_id].needs_to_respond = false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â CallMessage {origin = FromCanister O, â¦} â S.messages. O.calling_context â  Ctxt_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â ResponseMessage {origin = FromCanister O, â¦} â S.messages. O.calling_context â  Ctxt_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â (_ â¦ {needs_to_respond = true, origin = FromCanister O, â¦}) â S.call_contexts: O.calling_context â  Ctxt_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â (_ â¦ Stopping Origins) â S.canister_status: â(FromCanister O, _) â Origins. O.calling_context â  Ctxt_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    call_contexts[Ctxt_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-canister-creation">IC Management Canister: Canister creation<a href="#ic-management-canister-canister-creation" class="hash-link" aria-label="Direct link to IC Management Canister: Canister creation" title="Direct link to IC Management Canister: Canister creation">â</a></h4><p>The IC chooses an appropriate canister id (referred to as <code>CanisterId</code>) and subnet id (referred to as <code>SubnetId</code>, <code>SubnetId â Subnets</code>, where <code>Subnets</code> is the under-specified set of subnet ids on the IC) and instantiates a new (empty) canister identified by <code>CanisterId</code> on the subnet identified by <code>SubnetId</code> with subnet size denoted by <code>SubnetSize</code>. The <em>controllers</em> are set such that the sender of this request is the only controller, unless the <code>settings</code> say otherwise. All cycles on this call are now the canister&#x27;s initial cycles.</p><p>This is also when the System Time of the new canister starts ticking.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;create_canister&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">is_system_assigned Canister_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Canister_id â dom(S.canisters)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SubnetId â Subnets</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.controllers is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_controllers = A.settings.controllers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_controllers = [M.caller]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if New_memory_allocation &gt; 0:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_canister_history(New_canister_history) â¤ New_memory_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.compute_allocation is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_compute_allocation = A.settings.compute_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_compute_allocation = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.memory_allocation is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_memory_allocation = A.settings.memory_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_memory_allocation = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.freezing_threshold is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_freezing_threshold = A.settings.freezing_threshold</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_freezing_threshold = 2592000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.reserved_cycles_limit is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_reserved_balance_limit = A.settings.reserved_cycles_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_reserved_balance_limit = 5_000_000_000_000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.wasm_memory_limit is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_wasm_memory_limit = A.settings.wasm_memory_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_wasm_memory_limit = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cycles_reserved = cycles_to_reserve(S, Canister_id, New_compute_allocation, New_memory_allocation, null, EmptyCanister.wasm_state)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_balance = M.transferred_cycles - Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance = Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance &lt;= New_reserved_balance_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if New_compute_allocation &gt; 0 or New_memory_allocation &gt; 0 or Cycles_reserved &gt; 0:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  liquid_balance(S&#x27;, Canister_id) â¥ 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_canister_history = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes = 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    timestamp_nanos = CurrentTime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    origin = change_origin(M.caller, A.sender_canister_version, M.origin)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    details = Creation {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      controllers = New_controllers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.log_visibility is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_canister_log_visibility = A.settings.log_visibility</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_canister_log_visibility = Controllers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S&#x27; = S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canisters[Canister_id] = EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    snapshots[A.canister_id] = null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    time[Canister_id] = CurrentTime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    global_timer[Canister_id] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    controllers[Canister_id] = New_controllers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chunk_store[Canister_id] = ()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    compute_allocation[Canister_id] = New_compute_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_allocation[Canister_id] = New_memory_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    freezing_threshold[Canister_id] = New_freezing_threshold</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[Canister_id] = New_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balances[Canister_id] = New_reserved_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balance_limits[Canister_id] = New_reserved_balance_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_memory_limit[Canister_id] = New_wasm_memory_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    certified_data[Canister_id] = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    query_stats[Canister_id] = []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_history[Canister_id] = New_canister_history</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_log_visibility[Canister_id] = New_canister_log_visibility</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_logs[Canister_id] = []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid({canister_id = Canister_id}))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_status[Canister_id] = Running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[Canister_id] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_subnet[Canister_id] = Subnet {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      subnet_id : SubnetId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      subnet_size : SubnetSize</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>This uses the predicate</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">is_system_assigned : Principal -&gt; Bool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>which characterizes all system-assigned ids.</p><p>To avoid clashes with potential user ids or is derived from users or canisters, we require (somewhat handwavy) that</p><ul><li><p><code>is_system_assigned (mk_self_authenticating_id pk) = false</code> for possible public keys <code>pk</code> and</p></li><li><p><code>is_system_assigned (mk_derived_id p dn) = false</code> for any <code>p</code> that could be a user id or canister id.</p></li><li><p><code>is_system_assigned p = false</code> for <code>|p| &gt; 29</code>.</p></li><li><p><code>is_system_assigned ic_principal = false</code>.</p></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-changing-settings">IC Management Canister: Changing settings<a href="#ic-management-canister-changing-settings" class="hash-link" aria-label="Direct link to IC Management Canister: Changing settings" title="Direct link to IC Management Canister: Changing settings">â</a></h4><p>Only the controllers of the given canister can update the canister settings.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;update_settings&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if New_memory_allocation &gt; 0:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_wasm_state(S.canisters[A.canister_id].wasm_state) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_raw_module(S.canisters[A.canister_id].raw_module) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_canister_history(New_canister_history) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_snapshot(S.snapshots[A.canister_id]) â¤ New_memory_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.compute_allocation is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_compute_allocation = A.settings.compute_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_compute_allocation = S.compute_allocation[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.memory_allocation is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_memory_allocation = A.settings.memory_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_memory_allocation = S.memory_allocation[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.freezing_threshold is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_freezing_threshold = A.settings.freezing_threshold</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_freezing_threshold = S.freezing_threshold[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.reserved_cycles_limit is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_reserved_balance_limit = A.settings.reserved_cycles_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_reserved_balance_limit = S.reserved_balance_limits[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.wasm_memory_limit is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_wasm_memory_limit = A.settings.wasm_memory_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_wasm_memory_limit = S.wasm_memory_limit[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cycles_reserved = cycles_to_reserve(S, A.canister_id, New_compute_allocation, New_memory_allocation, S.snapshots[A.canister_id], S.canisters[A.canister_id].wasm_state)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_balance = S.balances[A.canister_id] - Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance = S.reserved_balances[A.canister_id] + Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance â¤ New_reserved_balance_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if New_compute_allocation &gt; S.compute_allocation[A.canister_id] or New_memory_allocation &gt; S.memory_allocation[A.canister_id] or Cycles_reserved &gt; 0:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  liquid_balance(S&#x27;, A.canister_id) â¥ 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_history[A.canister_id] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes = N;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes = H;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.controllers is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_canister_history = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    total_num_changes = N + 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    recent_changes = H Â· {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        timestamp_nanos = S.time[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        canister_version = S.canister_version[A.canister_id] + 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = change_origin(M.caller, A.sender_canister_version, M.origin);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        details = ControllersChange {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          controllers = A.settings.controllers;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_canister_history = S.canister_history[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S&#x27; = S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if A.settings.controllers is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      controllers[A.canister_id] = A.settings.controllers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      canister_history[A.canister_id] = New_canister_history</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    compute_allocation[A.canister_id] = New_compute_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_allocation[A.canister_id] = New_memory_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    freezing_threshold[A.canister_id] = New_freezing_threshold</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[A.canister_id] = New_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balances[A.canister_id] = New_reserved_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balance_limits[A.canister_id] = New_reserved_balance_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_memory_limit[A.canister_id] = New_wasm_memory_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if A.settings.log_visibility is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      canister_log_visibility[A.canister_id] = A.settings.log_visibility</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-canister-status">IC Management Canister: Canister status<a href="#ic-management-canister-canister-status" class="hash-link" aria-label="Direct link to IC Management Canister: Canister status" title="Direct link to IC Management Canister: Canister status">â</a></h4><p>The controllers of a canister can obtain detailed information about the canister.</p><p>The <code>Memory_usage</code> is the (in this specification underspecified) total size of storage in bytes.</p><p>The <code>idle_cycles_burned_per_day</code> is the idle consumption of resources in cycles per day.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;canister_status&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id] âª {A.canister_id}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = candid({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          status = simple_status(S.canister_status[A.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          settings = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            controllers = S.controllers[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            compute_allocation = S.compute_allocation[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            memory_allocation = S.memory_allocation[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            freezing_threshold = S.freezing_threshold[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            reserved_cycles_limit = S.reserved_balance_limit[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            wasm_memory_limit = S.wasm_memory_limit[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          module_hash =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if S.canisters[A.canister_id] = EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            then null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            else opt (SHA-256(S.canisters[A.canister_id].raw_module));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          memory_size = Memory_usage;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          cycles = S.balances[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          reserved_cycles = S.reserved_balances[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          idle_cycles_burned_per_day = idle_cycles_burned_rate(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            S.compute_allocation[A.canister_id],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            S.memory_allocation[A.canister_id],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            memory_usage_wasm_state(S.canisters[A.canister_id].wasm_state) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              memory_usage_raw_module(S.canisters[A.canister_id].raw_module) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              memory_usage_canister_history(S.canister_history[A.canister_id]) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              memory_usage_chunk_store(S.chunk_store[A.canister_id]) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              memory_usage_snapshot(S.snapshots[A.canister_id]),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            S.freezing_threshold[A.canister_id],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            S.canister_subnet[A.canister_id].subnet_size,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          );</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          query_stats = noise(SUM {{num_calls_total: 1,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                    num_instructions_total: single_query_stats.num_instructions,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                    request_payload_bytes_total: single_query_stats.request_payload_bytes,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                    response_payload_bytes_total: single_query_stats.response_payload_bytes} |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                   single_query_stats &lt;- S.query_stats[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                   single_query_stats.timestamp &lt;= S.time[A.canister_id] - T})</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>where <code>T</code> is an unspecified time delay of query statistics and <code>noise</code> is an unspecified probabilistic function
modelling information loss due to aggregating query statistics in a distributed system.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-canister-information">IC Management Canister: Canister information<a href="#ic-management-canister-canister-information" class="hash-link" aria-label="Direct link to IC Management Canister: Canister information" title="Direct link to IC Management Canister: Canister information">â</a></h4><p>Every canister can retrieve the canister history, current module hash, and current controllers of every other canister (including itself).</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;canister_info&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.num_requested_changes = null then From = |S.canister_history[A.canister_id].recent_changes|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else From = max(0, |S.canister_history[A.canister_id].recent_changes| - A.num_requested_changes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">End = |S.canister_history[A.canister_id].recent_changes| - 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = candid({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          total_num_changes = S.canister_history[A.canister_id].total_num_changes;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          recent_changes = S.canister_history[A.canister_id].recent_changes[From..End];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          module_hash =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if S.canisters[A.canister_id] = EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            then null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            else opt (SHA-256(S.canisters[A.canister_id].raw_module));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          controllers = S.controllers[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-upload-chunk">IC Management Canister: Upload Chunk<a href="#ic-management-canister-upload-chunk" class="hash-link" aria-label="Direct link to IC Management Canister: Upload Chunk" title="Direct link to IC Management Canister: Upload Chunk">â</a></h4><p>A controller of a canister, or the canister itself can upload chunks to the chunk store of that canister.</p><p>Conditions</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;upload_chunk&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|dom(S.chunk_store[A.canister_id]) âª {SHA-256(A.chunk)}| &lt;= CHUNK_STORE_SIZE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id] âª {A.canister_id}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chunk_store[A.canister_id](SHA-256(A.chunk)) = A.chunk</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = candid({hash: hash})</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-clear-chunk-store">IC Management Canister: Clear chunk store<a href="#ic-management-canister-clear-chunk-store" class="hash-link" aria-label="Direct link to IC Management Canister: Clear chunk store" title="Direct link to IC Management Canister: Clear chunk store">â</a></h4><p>The controller of a canister, or the canister itself can clear the chunk store of that canister.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;clear_chunk_store&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id] âª {A.canister_id}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chunk_store[A.canister_id] = ()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = candid()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-list-stored-chunks">IC Management Canister: List stored chunks<a href="#ic-management-canister-list-stored-chunks" class="hash-link" aria-label="Direct link to IC Management Canister: List stored chunks" title="Direct link to IC Management Canister: List stored chunks">â</a></h4><p>The controller of a canister, or the canister itself can list the hashes of the chunks stored in the chunk store.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;stored_chunks&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id] âª {A.canister_id}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = candid([{hash: hash} | hash &lt;- dom(S.chunk_store[A.canister_id])])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-code-installation">IC Management Canister: Code installation<a href="#ic-management-canister-code-installation" class="hash-link" aria-label="Direct link to IC Management Canister: Code installation" title="Direct link to IC Management Canister: Code installation">â</a></h4><p>Only the controllers of the given canister can install code. This transition installs new code over a canister. This involves invoking the <code>canister_init</code> method (see <a href="#system-api-init">Canister initialization</a>), which must succeed.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;install_code&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Mod = parse_wasm_mod(A.wasm_module)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Public_custom_sections = parse_public_custom_sections(A.wasm_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Private_custom_sections = parse_private_custom_sections(A.wasm_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(A.mode = install and S.canisters[A.canister_id] = EmptyCanister) or A.mode = reinstall</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dom(Mod.update_methods) â© dom(Mod.query_methods) = â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dom(Mod.update_methods) â© dom(Mod.composite_query_methods) = â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dom(Mod.query_methods) â© dom(Mod.composite_query_methods) = â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Env = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  time = S.time[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  controllers = S.controllers[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  global_timer = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  balance = S.balances[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balance = S.reserved_balances[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balance_limit = S.reserved_balance_limits[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  compute_allocation = S.compute_allocation[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_allocation = S.memory_allocation[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_raw_module = memory_usage_raw_module(A.wasm_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_canister_history = memory_usage_canister_history(New_canister_history);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_chunk_store = memory_usage_chunk_store(New_chunk_store);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_snapshot = memory_usage_snapshot(S.snapshots[A.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  freezing_threshold = S.freezing_threshold[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  subnet_size = S.canister_subnet[A.canister_id].subnet_size;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  certificate = NoCertificate;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  status = simple_status(S.canister_status[A.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_version = S.canister_version[A.canister_id] + 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Mod.init(A.canister_id, A.arg, M.caller, Env) = Return {new_state = New_state; new_certified_data = New_certified_data; new_global_timer = New_global_timer; cycles_used = Cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cycles_reserved = cycles_to_reserve(S, A.canister_id, S.compute_allocation[A.canister_id], S.memory_allocation[A.canister_id], S.snapshots[A.canister_id], New_state)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_balance = S.balances[A.canister_id] - Cycles_used - Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance = S.reserved_balances[A.canister_id] + Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance â¤ S.reserved_balance_limits[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(S, A.canister_id) â¥ MAX_CYCLES_PER_MESSAGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(S&#x27;, A.canister_id) â¥ 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if S.memory_allocation[A.canister_id] &gt; 0:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_wasm_state(New_state) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_raw_module(A.wasm_module) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_canister_history(New_canister_history) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_chunk_store(New_chunk_store) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_snapshot(S.snapshots[A.canister_id]) â¤ S.memory_allocation[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(S.wasm_memory_limit[A.canister_id] = 0) or |New_state.store.mem| &lt;= S.wasm_memory_limit[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_history[A.canister_id] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes = N;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes = H;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_canister_history = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes = N + 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes = H Â· {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    timestamp_nanos = S.time[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    origin = change_origin(M.caller, A.sender_canister_version, M.origin);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    details = CodeDeployment {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      mode = A.mode;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      module_hash = SHA-256(A.wasm_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S&#x27; = S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canisters[A.canister_id] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      wasm_state = New_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      module = Mod;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      raw_module = A.wasm_module;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      public_custom_sections = Public_custom_sections;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      private_custom_sections = Private_custom_sections;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    certified_data[A.canister_id] = New_certified_data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if New_global_timer â  NoGlobalTimer:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      global_timer[A.canister_id] = New_global_timer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      global_timer[A.canister_id] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[A.canister_id] = New_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balances[A.canister_id] = New_reserved_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_history[A.canister_id] = New_canister_history</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_logs[A.canister_id] = canister_logs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The logs produced by the canister during the execution of the WebAssembly <code>start</code> and <code>canister_init</code> functions are modeled via the unspecified <code>canister_logs</code> variable; the variable stores a list of logs (each of type <code>CanisterLog</code>) with consecutive sequence numbers, timestamps equal to <code>S.time[A.canister_id]</code>, and contents produced by the canister calling <code>ic0.debug_print</code>, <code>ic0.trap</code>, or produced by the WebAssembly runtime when the canister WebAssembly module traps.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-code-upgrade">IC Management Canister: Code upgrade<a href="#ic-management-canister-code-upgrade" class="hash-link" aria-label="Direct link to IC Management Canister: Code upgrade" title="Direct link to IC Management Canister: Code upgrade">â</a></h4><p>Only the controllers of the given canister can install new code. This changes the code of an <em>existing</em> canister, preserving the state in the stable memory. This involves invoking the <code>canister_pre_upgrade</code> method, if the <code>skip_pre_upgrade</code> flag is not set to <code>opt true</code>, on the old and <code>canister_post_upgrade</code> method on the new canister, which must succeed and must not invoke other methods. If the <code>wasm_memory_persistence</code> flag is set to <code>opt keep</code>, then the WebAssembly memory is preserved.</p><p>In the following, the <code>initial_wasm_store</code> is the store of the WebAssembly module after instantiation (as per WebAssembly spec) of the WebAssembly module contained in <code>A.wasm_module</code>, before executing a potential <code>(start)</code> function. The store <code>initialize_store(State, A.wasm_module)</code> is the store of the WebAssembly module after instantiation (as per WebAssembly spec) of the WebAssembly module contained in <code>A.wasm_module</code> while reusing the WebAssembly memory of <code>State</code>.</p><p>If the old canister module exports a private custom section with the name &quot;enhanced-orthogonal-persistence&quot;, then the <code>wasm_memory_persistence</code> option must be set to <code>opt keep</code> or <code>opt replace</code>, i.e., the option must not be <code>null</code>.</p><p>If the <code>wasm_memory_persistence</code> option is set to <code>opt keep</code>, then the new canister module must export a private custom section with the name &quot;enhanced-orthogonal-persistence&quot;.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;install_code&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Mod = parse_wasm_mod(A.wasm_module)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Public_custom_sections = parse_public_custom_sections(A.wasm_module)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Private_custom_sections = parse_private_custom_sections(A.wasm_module)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canisters[A.canister_id] = { wasm_state = Old_state; module = Old_module, â¦}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dom(Mod.update_methods) â© dom(Mod.query_methods) = â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dom(Mod.update_methods) â© dom(Mod.composite_query_methods) = â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dom(Mod.query_methods) â© dom(Mod.composite_query_methods) = â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Env = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  time = S.time[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  controllers = S.controllers[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  global_timer = S.global_timer[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  balance = S.balances[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balance = S.reserved_balances[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reserved_balance_limit = S.reserved_balance_limits[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  compute_allocation = S.compute_allocation[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_allocation = S.memory_allocation[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_raw_module = memory_usage_raw_module(S.canisters[A.canister_id].raw_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_canister_history = memory_usage_canister_history(S.canister_history[A.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_chunk_store = memory_usage_chunk_store(S.chunk_store[A.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_snapshot = memory_usage_snapshot(S.snapshots[A.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  freezing_threshold = S.freezing_threshold[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  subnet_size = S.canister_subnet[A.canister_id].subnet_size;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  certificate = NoCertificate;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  status = simple_status(S.canister_status[A.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_version = S.canister_version[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (A.mode = upgrade U and U.skip_pre_upgrade â  true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Env1 = Env with {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    global_timer = S.global_timer[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version = S.canister_version[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Old_module.pre_upgrade(Old_State, M.caller, Env1) = Return {new_state = Intermediate_state; new_certified_data = New_certified_data; cycles_used = Cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (A.mode = upgrade U and U.skip_pre_upgrade = true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Intermediate_state = Old_state</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_certified_data = NoCertifiedData</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Cycles_used = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (A.mode = upgrade U and U.wasm_memory_persistence â  keep)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Persisted_state = {store = initial_wasm_store; self_id = A.canister_id; stable_mem = Intermediate_state.stable_memory}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (A.mode = upgrade U and U.wasm_memory_persistence = keep)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Persisted_state = initialize_store(Intermediate_state, A.wasm_module)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(A.mode = upgrade U and U.wasm_memory_persistence = keep)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(A.mode = upgrade U and U.wasm_memory_persistence = replace)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(S.canisters[A.canister_id].private_custom_sections[&quot;enhanced-orthogonal-persistence&quot;] = null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">not (A.mode = upgrade U and U.wasm_memory_persistence = keep and Private_custom_sections[&quot;enhanced-orthogonal-persistence&quot;] = null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Env2 = Env with {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_raw_module = memory_usage_raw_module(A.wasm_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_canister_history = memory_usage_canister_history(New_canister_history);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  global_timer = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_version = S.canister_version[A.canister_id] + 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Mod.post_upgrade(Persisted_state, A.arg, M.caller, Env2) = Return {new_state = New_state; new_certified_data = New_certified_data&#x27;; new_global_timer = New_global_timer; cycles_used = Cycles_used&#x27;;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cycles_reserved = cycles_to_reserve(S, A.canister_id, S.compute_allocation[A.canister_id], S.memory_allocation[A.canister_id], S.snapshots[A.canister_id], New_state)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_balance = S.balances[A.canister_id] - Cycles_used - Cycles_used&#x27; - Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance = S.reserved_balances[A.canister_id] + Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance â¤ S.reserved_balance_limits[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(S, A.canister_id) â¥ MAX_CYCLES_PER_MESSAGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(S&#x27;, A.canister_id) â¥ 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if S.memory_allocation[A.canister_id] &gt; 0:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_wasm_state(New_state) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_raw_module(A.wasm_module) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_canister_history(New_canister_history) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_chunk_store(S[A.canister_id].chunk_store) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_snapshot(S.snapshots[A.canister_id]) â¤ S.memory_allocation[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(S.wasm_memory_limit[A.canister_id] = 0) or |New_state.store.mem| &lt;= S.wasm_memory_limit[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_history[A.canister_id] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes = N;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes = H;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_canister_history = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes = N + 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes = H Â· {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    timestamp_nanos = S.time[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    origin = change_origin(M.caller, A.sender_canister_version, M.origin);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    details = CodeDeployment {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      mode = Upgrade;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      module_hash = SHA-256(A.wasm_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S&#x27; = S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canisters[A.canister_id] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      wasm_state = New_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      module = Mod;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      raw_module = A.wasm_module;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      public_custom_sections = Public_custom_sections;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      private_custom_sections = Private_custom_sections;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if New_certified_data&#x27; â  NoCertifiedData:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      certified_data[A.canister_id] = New_certified_data&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    else if New_certified_data â  NoCertifiedData:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      certified_data[A.canister_id] = New_certified_data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if New_global_timer â  NoGlobalTimer:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      global_timer[A.canister_id] = New_global_timer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      global_timer[A.canister_id] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[A.canister_id] = New_balance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balances[A.canister_id] = New_reserved_balance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_history[A.canister_id] = New_canister_history</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_logs[A.canister_id] = S.canister_logs[A.canister_id] Â· canister_logs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The logs produced by the canister during the execution of the WebAssembly <code>canister_pre_upgrade</code>, <code>start</code>, and <code>canister_post_upgrade</code> functions are modeled via the unspecified <code>canister_logs</code> variable; the variable stores a list of logs (each of type <code>CanisterLog</code>) with consecutive sequence numbers, timestamps equal to <code>S.time[A.canister_id]</code>, and contents produced by the canister calling <code>ic0.debug_print</code>, <code>ic0.trap</code>, or produced by the WebAssembly runtime when the canister WebAssembly module traps.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-install-chunked-code">IC Management Canister: Install chunked code<a href="#ic-management-canister-install-chunked-code" class="hash-link" aria-label="Direct link to IC Management Canister: Install chunked code" title="Direct link to IC Management Canister: Install chunked code">â</a></h4><p>Conditions</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;install_chunked_code&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.store_canister = null then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  store_canister = A.target_canister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  store_canister = A.store_canister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.target_canister]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[store_canister] âª {store_canister}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_subnet[A.target_canister] = S.canister_subnet[strorage_canister]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â h â A.chunk_hashes_list. h â dom(S.chunk_store[store_canister])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A.chunk_hashes_list = [h1,h2,...,hk]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wasm_module = S.chunk_store[store_canister][h1] || ... || S.chunk_store[store_canister][hk]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A.wasm_module_hash = SHA-256(wasm_module)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M&#x27; = M with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    method_name = &#x27;install_code&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    arg = candid(record {A.mode; A.target_canister; wasm_module; A.arg; A.sender_canister_version})</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· CallMessage M&#x27; Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rule-uninstall">IC Management Canister: Code uninstallation<a href="#rule-uninstall" class="hash-link" aria-label="Direct link to IC Management Canister: Code uninstallation" title="Direct link to IC Management Canister: Code uninstallation">â</a></h4><p>Upon uninstallation, the canister is reverted to an empty canister, and all outstanding call contexts are rejected and marked as deleted.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;uninstall_code&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_history[A.canister_id] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes = N;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes = H;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canisters[A.canister_id] = EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    certified_data[A.canister_id] = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chunk_store = ()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_history[A.canister_id] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      total_num_changes = N + 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      recent_changes = H Â· {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          timestamp_nanos = S.time[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          canister_version = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          origin = change_origin(M.caller, A.sender_canister_version, M.origin);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          details = CodeUninstall;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_logs[A.canister_id] = []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    global_timer[A.canister_id] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      } Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      [ ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          origin = Ctxt.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          response = Reject (CANISTER_REJECT, </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">implementation-specific</span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          refunded_cycles = Ctxt.available_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      | Ctxt_id â¦ Ctxt â S.call_contexts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      , Ctxt.canister = A.canister_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      , Ctxt.needs_to_respond = true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      for Ctxt_id â¦ Ctxt â S.call_contexts:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if Ctxt.canister = A.canister_id:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          call_contexts[Ctxt_id].deleted := true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          call_contexts[Ctxt_id].needs_to_respond := false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          call_contexts[Ctxt_id].available_cycles := 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-stopping-a-canister">IC Management Canister: Stopping a canister<a href="#ic-management-canister-stopping-a-canister" class="hash-link" aria-label="Direct link to IC Management Canister: Stopping a canister" title="Direct link to IC Management Canister: Stopping a canister">â</a></h4><p>The controllers of a canister can stop a canister. Stopping a canister goes through two steps. First, the status of the canister is set to <code>Stopping</code>; as explained above, a stopping canister rejects all incoming requests and continues processing outstanding responses. When a stopping canister has no more open call contexts, its status is changed to <code>Stopped</code> and a response is generated. Note that when processing responses, a stopping canister can make calls to other canisters and thus create new call contexts. In addition, a canister which is stopped or stopping will accept (and respond) to further <code>stop_canister</code> requests.</p><p>We encode this behavior via three (types of) transitions:</p><ol><li><p>First, any <code>stop_canister</code> call sets the state of the canister to <code>Stopping</code>; we record in the IC state the origin (and cycles) of all <code>stop_canister</code> calls which arrive at the canister while it is stopping (or stopped). Note that every such <code>stop_canister</code> call can be rejected by the system at any time (the canister stays stopping in this case), e.g., if the <code>stop_canister</code> call could not be responded to for a long time.</p></li><li><p>Next, when the canister has no open call contexts (so, in particular, all outstanding responses to the canister have been processed), the status of the canister is set to <code>Stopped</code>.</p></li><li><p>Finally, each pending <code>stop_canister</code> call (which are encoded in the status) is responded to, to indicate that the canister is stopped.</p></li></ol><p>Conditions</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;stop_canister&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[A.canister_id] = Running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_status[A.canister_id] = Stopping [(M.origin, M.transferred_cycles)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;stop_canister&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[A.canister_id] = Stopping Origins</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_status[A.canister_id] = Stopping (Origins Â· [(M.origin, M.transferred_cycles)])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The status of a stopping canister which has no open call contexts is set to <code>Stopped</code>, and all pending <code>stop_canister</code> calls are replied to.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[CanisterId] = Stopping Origins</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â Ctxt_id. S.call_contexts[Ctxt_id].canister â  CanisterId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_status[CanisterId] = Stopped</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = S.Messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        [ ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            origin = O</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            response = Reply (candid())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            refunded_cycles = C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | (O, C) â Origins</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Sending a <code>stop_canister</code> message to an already stopped canister is acknowledged (i.e. responded with success) and the canister version is incremented, but is otherwise a no-op:</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;stop_canister&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[A.canister_id] = Stopped</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Pending <code>stop_canister</code> calls may be rejected by the system at any time (the canister stays stopping in this case):</p><p>Conditions</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[CanisterId] = Stopping (Older_origins Â· (O, C) Â· Younger_origins)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_status[CanisterId] = Stopping (Older_origins Â· Younger_origins)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = S.Messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = O</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reject (SYS_TRANSIENT, </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">implementation-specific</span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-starting-a-canister">IC Management Canister: Starting a canister<a href="#ic-management-canister-starting-a-canister" class="hash-link" aria-label="Direct link to IC Management Canister: Starting a canister" title="Direct link to IC Management Canister: Starting a canister">â</a></h4><p>The controllers of a canister can start a <code>stopped</code> canister. If the canister is already running, the command has no effect on the canister (except for incrementing its canister version).</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;start_canister&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[A.canister_id] = Running or S.canister_status[A.canister_id] = Stopped</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_status[A.canister_id] = Running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ResponseMessage{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            response = Reply (candid())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>If the status of the canister was &#x27;stopping&#x27;, then the canister status is set to <code>running</code>. The pending <code>stop_canister</code> request(s) are rejected.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;start_canister&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[A.canister_id] = Stopping Origins</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_status[A.canister_id] = Running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ResponseMessage{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            response = Reply (candid())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        [ ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            origin = O</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            response = Reject (CANISTER_ERROR, </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">implementation-specific</span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            refunded_cycles = C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        | (O, C) â Origins</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-canister-deletion">IC Management Canister: Canister deletion<a href="#ic-management-canister-canister-deletion" class="hash-link" aria-label="Direct link to IC Management Canister: Canister deletion" title="Direct link to IC Management Canister: Canister deletion">â</a></h4><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;delete_canister&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_status[A.canister_id] = Stopped</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canisters[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    snapshots[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    controllers[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    compute_allocation[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_allocation[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    freezing_threshold[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_status[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_subnet[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    time[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    global_timer[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balances[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balance_limits[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_memory_limit[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    certified_data[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_history[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_log_visibility[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_logs[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    query_stats[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chunk_store[A.canister_id] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-depositing-cycles">IC Management Canister: Depositing cycles<a href="#ic-management-canister-depositing-cycles" class="hash-link" aria-label="Direct link to IC Management Canister: Depositing cycles" title="Direct link to IC Management Canister: Depositing cycles">â</a></h4><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;deposit_cycles&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A.canister_id â dom(S.balances)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[A.canister_id] =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      S.balances[A.canister_id] + M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-random-numbers">IC Management Canister: Random numbers<a href="#ic-management-canister-random-numbers" class="hash-link" aria-label="Direct link to IC Management Canister: Random numbers" title="Direct link to IC Management Canister: Random numbers">â</a></h4><p>The management canister can produce pseudo-random bytes. It always returns a 32-byte <code>blob</code>:</p><p>The precise guarantees around the randomness, e.g. unpredictability, are not captured in this formal semantics.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;raw_rand&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|B| = 32</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid(B))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-node-metrics">IC Management Canister: Node Metrics<a href="#ic-management-canister-node-metrics" class="hash-link" aria-label="Direct link to IC Management Canister: Node Metrics" title="Direct link to IC Management Canister: Node Metrics">â</a></h4><div class="admonition_WoCw admonitionNote_L5_h"><p>The node metrics management canister API is considered EXPERIMENTAL. Canister developers must be aware that the API may evolve in a non-backward-compatible way.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>The management canister returns metrics for nodes on a given subnet. The definition of the metrics values
is not captured in this formal semantics.</p><p>Conditions</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;node_metrics_history&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">R = </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">implementation-specific</span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid(R))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-subnet-information">IC Management Canister: Subnet information<a href="#ic-management-canister-subnet-information" class="hash-link" aria-label="Direct link to IC Management Canister: Subnet information" title="Direct link to IC Management Canister: Subnet information">â</a></h4><p>The management canister returns subnet metadata given a subnet ID.</p><p>Conditions</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;subnet_info&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">R = </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">implementation-specific</span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â· </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage { </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid(R)) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-canister-creation-with-cycles">IC Management Canister: Canister creation with cycles<a href="#ic-management-canister-canister-creation-with-cycles" class="hash-link" aria-label="Direct link to IC Management Canister: Canister creation with cycles" title="Direct link to IC Management Canister: Canister creation with cycles">â</a></h4><p>This is a variant of <code>create_canister</code>, which sets the initial cycle balance based on the <code>amount</code> argument.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;provisional_create_canister_with_cycles&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">is_system_assigned Canister_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Canister_id â dom(S.canisters)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.specified_id is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Canister_id = A.specified_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.controllers is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_controllers = A.settings.controllers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_controllers = [M.caller]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if New_memory_allocation &gt; 0:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_canister_history(New_canister_history) â¤ New_memory_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.compute_allocation is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_compute_allocation = A.settings.compute_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_compute_allocation = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.memory_allocation is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_memory_allocation = A.settings.memory_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_memory_allocation = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.freezing_threshold is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_freezing_threshold = A.settings.freezing_threshold</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_freezing_threshold = 2592000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.reserved_cycles_limit is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_reserved_balance_limit = A.settings.reserved_cycles_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_reserved_balance_limit = 5_000_000_000_000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.wasm_memory_limit is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_wasm_memory_limit = A.settings.wasm_memory_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_wasm_memory_limit = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cycles_reserved = cycles_to_reserve(S, Canister_id, New_compute_allocation, New_memory_allocation,  null, EmptyCanister.wasm_state)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.amount is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_balance = A.amount - Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_balance = DEFAULT_PROVISIONAL_CYCLES_BALANCE - Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance = Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance â¤ New_reserved_balance_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if New_compute_allocation &gt; 0 or New_memory_allocation &gt; 0 or Cycles_reserved &gt; 0:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  liquid_balance(S&#x27;, Canister_id) â¥ 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_canister_history {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes = 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    timestamp_nanos = CurrentTime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    origin = change_origin(M.caller, A.sender_canister_version, M.origin)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    details = Creation {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      controllers = New_controllers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.settings.log_visibility is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_canister_log_visibility = A.settings.log_visibility</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  New_canister_log_visibility = Controllers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S&#x27; = S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canisters[Canister_id] = EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    snapshots[Canister_id] = null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    time[Canister_id] = CurrentTime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    global_timer[Canister_id] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    controllers[Canister_id] = New_controllers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    compute_allocation[Canister_id] = New_compute_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_allocation[Canister_id] = New_memory_allocation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    freezing_threshold[Canister_id] = New_freezing_threshold</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[Canister_id] = New_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balances[Canister_id] = New_reserved_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balance_limits[Canister_id] = New_reserved_balance_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_memory_limit[Canister_id] = New_wasm_memory_limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    certified_data[Canister_id] = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_history[Canister_id] = New_canister_history</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_log_visibility[Canister_id] = New_canister_log_visibility</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_logs[Canister_id] = []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    query_stats[CanisterId] = []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid({canister_id = Canister_id}))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_status[Canister_id] = Running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[Canister_id] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_subnet[Canister_id] = Subnet {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      subnet_id : SubnetId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      subnet_size : SubnetSize</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-top-up-canister">IC Management Canister: Top up canister<a href="#ic-management-canister-top-up-canister" class="hash-link" aria-label="Direct link to IC Management Canister: Top up canister" title="Direct link to IC Management Canister: Top up canister">â</a></h4><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â CallMessage M&#x27; | FuncMessage M&#x27; â Older_messages. M&#x27;.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;provisional_top_up_canister&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A.canister_id â dom(S.canisters)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[A.canister_id] = S.balances[A.canister_id] + A.amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-take-canister-snapshot">IC Management Canister: Take canister snapshot<a href="#ic-management-canister-take-canister-snapshot" class="hash-link" aria-label="Direct link to IC Management Canister: Take canister snapshot" title="Direct link to IC Management Canister: Take canister snapshot">â</a></h4><p>Only the controllers of the given canister can take a snapshot.
A snapshot will be identified internally by a system-generated opaque <code>Snapshot_id</code>.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â msg â Older_messages. msg.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;take_canister_snapshot&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if A.replace_snapshot is not null:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  S.snapshots[A.canister_id].snapshot_id = A.replace_snapshot</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  S.snapshots[A.canister_id] = null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_snapshot = Snapshot {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  snapshot_id = Snapshot_id;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  wasm_state = S.canisters[A.canister_id].wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  raw_module = S.canisters[A.canister_id].raw_module;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  chunk_store = S.chunk_store[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  certified_data = S.certified_data[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canister_version = S.canister_version[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  take_at_timestamp = S.time[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cycles_reserved = cycles_to_reserve(S, A.canister_id, S.compute_allocation[A.canister_id], S.memory_allocation[A.canister_id], New_snapshot, S.canisters[A.canister_id])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_balance = S.balances[A.canister_id] - Cycles_used - Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance = S.reserved_balances[A.canister_id] + Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance â¤ S.reserved_balance_limits[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(S, A.canister_id) â¥ 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S&#x27; = S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    snapshots[A.canister_id] = New_snapshot</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[A.canister_id] = New_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balances[A.canister_id] = New_reserved_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          id = Snapshot_id;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          taken_at_timestamp = S.time[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          total_size = memory_usage_snapshot(New_snapshot);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-load-canister-snapshot">IC Management Canister: Load canister snapshot<a href="#ic-management-canister-load-canister-snapshot" class="hash-link" aria-label="Direct link to IC Management Canister: Load canister snapshot" title="Direct link to IC Management Canister: Load canister snapshot">â</a></h4><p>Only the controllers of the given canister can load a snapshot.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â msg â Older_messages. msg.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;load_canister_snapshot&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.snapshots[A.canister_id].snapshot_id = A.snapshot_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_state = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  wasm_state = S.snapshots[A.canister_id].wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  raw_module = S.snapshots[A.canister_id].raw_module;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  module = parse_wasm_mod(S.snapshots[A.canister_id].raw_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  public_custom_sections = parse_public_custom_sections(S.snapshots[A.canister_id].raw_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private_custom_sections = parse_private_custom_sections(S.snapshots[A.canister_id].raw_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cycles_reserved = cycles_to_reserve(S, A.canister_id, S.compute_allocation[A.canister_id], S.memory_allocation[A.canister_id], S.snapshots[A.canister_id], New_state)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_balance = S.balances[A.canister_id] - Cycles_used - Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance = S.reserved_balances[A.canister_id] + Cycles_reserved</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_reserved_balance â¤ S.reserved_balance_limits[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_history[A.canister_id] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes = N;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes = H;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New_canister_history = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes = N + 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes = H Â· {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    timestamp_nanos = S.time[A.canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    origin = change_origin(M.caller, A.sender_canister_version, M.origin);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    details = LoadSnapshot {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      snapshot_id = S.snapshots[A.canister_id].snapshot_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      canister_version = S.snapshots[A.canister_id].canister_version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      taken_at_timestamp = S.snapshots[A.canister_id].take_at_timestamp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(S&#x27;, A.canister_id) â¥ 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if S.memory_allocation[A.canister_id] &gt; 0:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_usage_wasm_state(New_state.wasm_state) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_raw_module(New_state.raw_module) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_canister_history(New_canister_history) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_chunk_store(S.chunk_store[A.canister_id]) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    memory_usage_snapshot(S.snapshots[A.canister_id]) â¤ S.memory_allocation[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S&#x27; = S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canisters[A.canister_id] = New_state</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chunk_store[A.canister_id] = S.snapshots[A.canister_id].chunk_store</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    certified_data[A.canister_id] = S.snapshots[A.canister_id].certified_data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[A.canister_id] = New_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balances[A.canister_id] = New_reserved_balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_history[A.canister_id] = New_canister_history</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[A.canister_id] = S.canister_version[A.canister_id] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-list-canister-snapshots">IC Management Canister: List canister snapshots<a href="#ic-management-canister-list-canister-snapshots" class="hash-link" aria-label="Direct link to IC Management Canister: List canister snapshots" title="Direct link to IC Management Canister: List canister snapshots">â</a></h4><p>Only the controllers of the given canister can get a list of the existing snapshots.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â msg â Older_messages. msg.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;list_canister_snapshots&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Snapshots = if S.snapshots[A.canister_id] is null then [] else [{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    id = S.snapshots[A.canister_id].snapshot_id;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    taken_at_timestamp = S.snapshots[A.canister_id].taken_at_timestamp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    total_size = memory_usage_snapshot(S.snapshots[A.canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid(Snapshots))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-management-canister-delete-canister-snapshot">IC Management Canister: Delete canister snapshot<a href="#ic-management-canister-delete-canister-snapshot" class="hash-link" aria-label="Direct link to IC Management Canister: Delete canister snapshot" title="Direct link to IC Management Canister: Delete canister snapshot">â</a></h4><p>A snapshot may be deleted only by the controllers of the canister for which the snapshot was taken.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· CallMessage M Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(M.queue = Unordered) or (â msg â Older_messages. msg.queue â  M.queue)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.callee = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.method_name = &#x27;delete_canister_snapshot&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.caller â S.controllers[A.canister_id]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.snapshots[A.canister_id].snapshot_id = A.snapshot_id </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    S.snapshots[A.canister_id] = null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        origin = M.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response = Reply (candid());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        refunded_cycles = M.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="callback-invocation">Callback invocation<a href="#callback-invocation" class="hash-link" aria-label="Direct link to Callback invocation" title="Direct link to Callback invocation">â</a></h4><p>When an inter-canister call has been responded to, we can queue the call to the callback.</p><p>This &quot;bookkeeping transition&quot; must be immediately followed by the corresponding <a href="#rule-message-execution">&quot;Message execution&quot; transition</a>.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· ResponseMessage RM Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RM.origin = FromCanister {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    call_context = Ctxt_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    callback = Callback</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">not S.call_contexts[Ctxt_id].deleted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.call_contexts[Ctxt_id].canister â dom(S.balances)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[S.call_contexts[Ctxt_id].canister] =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      S.balances[S.call_contexts[Ctxt_id].canister] + RM.refunded_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Older_messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      FuncMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        call_context = Ctxt_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        receiver = S.call_contexts[Ctxt_id].canister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        entry_point = Callback Callback RM.response RM.refunded_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        queue = Unordered</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      } Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>If the responded call context does not exist anymore, because the canister has been uninstalled since, the refunded cycles are still added to the canister balance, but no function invocation is enqueued:</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· ResponseMessage RM Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RM.origin = FromCanister {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    call_context = Ctxt_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    callback = Callback</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.call_contexts[Ctxt_id].deleted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.call_contexts[Ctxt_id].canister â dom(S.balances)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[S.call_contexts[Ctxt_id].canister] =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      S.balances[S.call_contexts[Ctxt_id].canister] + RM.refunded_cycles + MAX_CYCLES_PER_RESPONSE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="respond-to-user-request">Respond to user request<a href="#respond-to-user-request" class="hash-link" aria-label="Direct link to Respond to user request" title="Direct link to Respond to user request">â</a></h4><p>When an ingress method call has been responded to, we can record the response in the list of queries.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.messages = Older_messages Â· ResponseMessage RM Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RM.origin = FromUser { request = M }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.requests[M] = (Processing, ECID)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = Older_messages Â· Younger_messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    requests[M] =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      | (Replied R, ECID)        if M.response = Reply R</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      | (Rejected (c, R), ECID)  if M.response = Reject (c, R)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>NB: The refunded cycles, <code>RM.refunded_cycles</code> are, by construction, empty.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="request-clean-up">Request clean up<a href="#request-clean-up" class="hash-link" aria-label="Direct link to Request clean up" title="Direct link to Request clean up">â</a></h4><p>The IC will keep the data for a completed or rejected request around for a certain, implementation defined amount of time, to allow users to poll for the data. After that time, the data of the request will be dropped:</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(S.requests[M] = (Replied _, ECID)) or (S.requests[M] = (Rejected _, ECID))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    requests[M] = (Done, ECID)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>At the same or some later point, the request will be removed from the state of the IC. This must happen no earlier than the ingress expiry time set in the request.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(S.requests[M] = (Replied _, _)) or (S.requests[M] = (Rejected _, _)) or (S.requests[M] = (Done, _))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">M.ingress_expiry &lt; S.system_time</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    requests[M] = (deleted)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="canister-out-of-cycles">Canister out of cycles<a href="#canister-out-of-cycles" class="hash-link" aria-label="Direct link to Canister out of cycles" title="Direct link to Canister out of cycles">â</a></h4><p>Once a canister runs out of cycles, its code is uninstalled (cf. <a href="#rule-uninstall">IC Management Canister: Code uninstallation</a>), the canister changes in the canister history are dropped (their total number is preserved), and the allocations are set to zero (NB: allocations are currently not modeled in the formal model):</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.balances[CanisterId] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.reserved_balances[CanisterId] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_history[CanisterId] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  total_num_changes = N;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  recent_changes = H;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canisters[CanisterId] = EmptyCanister</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    snapshots[CanisterId] = null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    certified_data[CanisterId] = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_history[CanisterId] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      total_num_changes = N;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      recent_changes = [];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_logs[CanisterId] = []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[CanisterId] = S.canister_version[CanisterId] + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    global_timer[CanisterId] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messages = S.messages Â·</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      [ ResponseMessage {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          origin = Ctxt.origin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          response = Reject (CANISTER_REJECT, </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">implementation-specific</span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          refunded_cycles = Ctxt.available_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      | Ctxt_id â¦ Ctxt â S.call_contexts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      , Ctxt.canister = CanisterId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      , Ctxt.needs_to_respond = true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    for Ctxt_id â¦ Ctxt â S.call_contexts:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      if Ctxt.canister = CanisterId:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        call_contexts[Ctxt_id].deleted := true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        call_contexts[Ctxt_id].needs_to_respond := false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        call_contexts[Ctxt_id].available_cycles := 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="time-progressing-cycle-consumption-and-canister-version-increments">Time progressing, cycle consumption, and canister version increments<a href="#time-progressing-cycle-consumption-and-canister-version-increments" class="hash-link" aria-label="Direct link to Time progressing, cycle consumption, and canister version increments" title="Direct link to Time progressing, cycle consumption, and canister version increments">â</a></h4><p>Time progresses. Abstractly, it does so independently for each canister, and in unspecified intervals.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">T0 = S.time[CanisterId]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">T1 &gt; T0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    time[CanisterId] = T1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The canister cycle balances similarly deplete at an unspecified rate, but stay non-negative.
If the canister has a positive reserved balance, then the reserved balance depletes before the main balance:</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">R0 = S.reserved_balances[CanisterId]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0 â¤ R1 &lt; R0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reserved_balances[CanisterId] = R1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Once the reserved balance reaches zero, then the main balance starts depleting:</p><p>Conditions</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.reserved_balances[CanisterId] = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">B0 = S.balances[CanisterId]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0 â¤ B1 &lt; B0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balances[CanisterId] = B1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Similarly, the system time, used to expire requests, progresses:</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">T0 = S.system_time</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">T1 &gt; T0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    system_time = T1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Finally, the canister version can be incremented arbitrarily:</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">N0 = S.canister_version[CanisterId]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">N1 &gt; N0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_version[CanisterId] = N1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="trimming-canister-history">Trimming canister history<a href="#trimming-canister-history" class="hash-link" aria-label="Direct link to Trimming canister history" title="Direct link to Trimming canister history">â</a></h4><p>The list of canister changes can be trimmed, but the total number of recorded canister changes cannot be altered. At least 20 changes are guaranteed to remain in the list of changes.</p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_history[CanisterId] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    total_num_changes = N;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    recent_changes = Older_changes Â· Newer_changes;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|Newer_changes| â¥ 20</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_history[CanisterId] = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      total_num_changes = N;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      recent_changes = Newer_changes;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="trimming-canister-logs">Trimming canister logs<a href="#trimming-canister-logs" class="hash-link" aria-label="Direct link to Trimming canister logs" title="Direct link to Trimming canister logs">â</a></h4><p>Canister logs can be trimmed if their total length exceeds 4KiB.</p><p>Conditions</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.canister_logs[CanisterId] = Older_logs Â· Newer_logs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SUM { |l| | l </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">-</span><span class="token tag" style="color:#F68E5F"> </span><span class="token tag attr-name" style="color:#F8F8F2">Older_logs</span><span class="token tag" style="color:#F68E5F"> </span><span class="token tag attr-name" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F68E5F"> </span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain"> 4KiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    canister_logs[CanisterId] = Newer_logs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ic-mgmt-canister-fetch-canister-logs">IC Management Canister: Canister logs (query call)<a href="#ic-mgmt-canister-fetch-canister-logs" class="hash-link" aria-label="Direct link to IC Management Canister: Canister logs (query call)" title="Direct link to IC Management Canister: Canister logs (query call)">â</a></h4><div class="admonition_WoCw admonitionNote_L5_h"><p>The canister logs management canister API is considered EXPERIMENTAL. Canister developers must be aware that the API may evolve in a non-backward-compatible way.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>This section specifies management canister query calls.
They are calls to <code>/api/v2/canister/&lt;effective_canister_id&gt;/query</code>
with CBOR body <code>Q</code> such that <code>Q.canister_id = ic_principal</code>.</p><p>The management canister offers the method <code>fetch_canister_logs</code>
that can be called as a query call and
returns logs of a requested canister.</p><p>Conditions</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Q.canister_id = ic_principal</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Q.method_name = &#x27;fetch_canister_logs&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Q.arg = candid(A)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A.canister_id = effective_canister_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(S[A.canister_id].canister_log_visibility = Public)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (S[A.canister_id].canister_log_visibility = Controllers and Q.sender in S[A.canister_id].controllers)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (S[A.canister_id].canister_log_visibility = AllowedViewers Principals and (Q.sender in S[A.canister_id].controllers or Q.sender in Principals))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Query response <code>R</code>:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{status: &quot;replied&quot;; reply: {arg: candid(S.canister_logs[A.canister_id])}, signatures: Sigs}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>where the query <code>Q</code>, the response <code>R</code>, and a certificate <code>Cert&#x27;</code> that is obtained by requesting the path <code>/subnet</code> in a <strong>separate</strong> read state request to <code>/api/v2/canister/&lt;effective_canister_id&gt;/read_state</code> satisfy the following:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">verify_response(Q, R, Cert&#x27;) â§ lookup([&quot;time&quot;], Cert&#x27;) = Found S.system_time // or &quot;recent enough&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="query-call">Query call<a href="#query-call" class="hash-link" aria-label="Direct link to Query call" title="Direct link to Query call">â</a></h4><p>This section specifies query calls <code>Q</code> whose <code>Q.canister_id</code> is a non-empty canister <code>S.canisters[Q.canister_id]</code>. Query calls to the management canister, i.e., <code>Q.canister_id = ic_principal</code>, are specified in Section <a href="#ic-mgmt-canister-fetch-canister-logs">Canister logs</a>.</p><p>Canister query calls to <code>/api/v2/canister/&lt;ECID&gt;/query</code> can be executed directly. They can only be executed against non-empty canisters which have a status of <code>Running</code> and are also not frozen.</p><p>In query and composite query methods evaluated on the target canister of the query call, a certificate is provided to the canister that is valid, contains a current state tree (or &quot;recent enough&quot;; the specification is currently vague about how old the certificate may be), and reveals the canister&#x27;s <a href="#system-api-certified-data">Certified Data</a>.</p><div class="admonition_WoCw admonitionNote_L5_h"><p>Composite query methods are EXPERIMENTAL and there might be breaking changes of their behavior in the future. Use at your own risk!</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>Composite query methods can call query methods and composite query methods up to a maximum depth <code>MAX_CALL_DEPTH_COMPOSITE_QUERY</code> of the call graph. The total amount of cycles consumed by executing a (composite) query method and all (transitive) calls it makes must be at most <code>MAX_CYCLES_PER_QUERY</code>. This limit applies in addition to the limit <code>MAX_CYCLES_PER_MESSAGE</code> for executing a single (composite) query method and <code>MAX_CYCLES_PER_RESPONSE</code> for executing a single callback of a (composite) query method.</p><p>We define an auxiliary method that handles calls from composite query methods by performing a call graph traversal. It can also be (trivially) invoked for query methods that do not make further calls.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">composite_query_helper(S, Cycles, Depth, Root_canister_id, Caller, Canister_id, Method_name, Arg) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let Mod = S.canisters[Canister_id].module</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let Cert &lt;- { Cert | verify_cert(Cert) and</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       lookup([&quot;canister&quot;, Canister_id, &quot;certified_data&quot;], Cert) = Found S.certified_data[Canister_id] and</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       lookup([&quot;time&quot;], Cert) = Found S.system_time // or &quot;recent enough&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if Canister_id â  Root_canister_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Cert := NoCertificate // no certificate available in query and composite query methods evaluated on canisters other than the target canister of the query call</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let Env = { time = S.time[Canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              controllers = S.controllers[Canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              global_timer = S.global_timer[Canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              balance = S.balances[Canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              reserved_balance = S.reserved_balances[Canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              reserved_balance_limit = S.reserved_balance_limits[Canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              compute_allocation = S.compute_allocation[Canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              memory_allocation = S.memory_allocation[Canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              memory_usage_raw_module = memory_usage_raw_module(S.canisters[Canister_id].raw_module);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              memory_usage_canister_history = memory_usage_canister_history(S.canister_history[Canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              memory_usage_chunk_store = memory_usage_chunk_store(S.chunk_store[Canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              memory_usage_snapshot = memory_usage_snapshot(S.snapshots[Canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              freezing_threshold = S.freezing_threshold[Canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              subnet_size = S.canister_subnet[Canister_id].subnet_size;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              certificate = Cert;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              status = simple_status(S.canister_status[Canister_id]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              canister_version = S.canister_version[Canister_id];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if S.canisters[Canister_id] â  EmptyCanister and</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     S.canister_status[Canister_id] = Running and</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     (Method_name â dom(Mod.query_methods) or Method_name â dom(Mod.composite_query_methods)) and</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Cycles &gt;= MAX_CYCLES_PER_MESSAGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     let W = S.canisters[Canister_id].wasm_state</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     let F = if Method_name â dom(Mod.query_methods) then Mod.query_methods[Method_name] else Mod.composite_query_methods[Method_name]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     if liquid_balance(S, Canister_id) &lt; 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       Return (Reject (SYS_TRANSIENT, &lt;implementation-specific&gt;), Cycles, S)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     let R = F(Arg, Caller, Env)(W)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     if R = Trap trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     then Return (Reject (CANISTER_ERROR, &lt;implementation-specific&gt;), Cycles - trap.cycles_used, S)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     else if R = Return {new_state = W&#x27;; new_calls = Calls; response = Response; cycles_used = Cycles_used}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        W := W&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if Cycles_used &gt; MAX_CYCLES_PER_MESSAGE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           Return (Reject (CANISTER_ERROR, &lt;implementation-specific&gt;), Cycles - MAX_CYCLES_PER_MESSAGE, S) // single message execution out of cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Cycles := Cycles - Cycles_used</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if Response = NoResponse</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           while Calls â  []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           do</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              if Depth = MAX_CALL_DEPTH_COMPOSITE_QUERY</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 Return (Reject (CANISTER_ERROR, &lt;implementation-specific&gt;), Cycles, S) // max call graph depth exceeded</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              let Calls&#x27; Â· Call Â· Calls&#x27;&#x27;  = Calls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              Calls := Calls&#x27; Â· Calls&#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              if S.canister_subnet[Canister_id].subnet_id â  S.canister_subnet[Call.callee].subnet_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 Return (Reject (CANISTER_ERROR, &lt;implementation-specific&gt;), Cycles, S) // calling to another subnet</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              let (Response&#x27;, Cycles&#x27;, S&#x27;) = composite_query_helper(S, Cycles, Depth + 1, Root_canister_id, Canister_id, Call.callee, Call.method_name, Call.arg)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              Cycles := Cycles&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              S := S&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              if Cycles &lt; MAX_CYCLES_PER_RESPONSE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 Return (Reject (CANISTER_ERROR, &lt;implementation-specific&gt;), Cycles, S) // composite query out of cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              Env.Cert = NoCertificate // no certificate available in composite query callbacks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              let F&#x27; = Mod.composite_callbacks(Call.callback, Response&#x27;, Env)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              let R&#x27;&#x27; = F&#x27;(W&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              if R&#x27;&#x27; = Trap trap&#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              then Return (Reject (CANISTER_ERROR, &lt;implementation-specific&gt;), Cycles - trap&#x27;&#x27;.cycles_used, S)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              else if R&#x27;&#x27; = Return {new_state = W&#x27;&#x27;; new_calls = Calls&#x27;&#x27;; response = Response&#x27;&#x27;; cycles_used = Cycles_used&#x27;&#x27;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 W := W&#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 if Cycles_used&#x27;&#x27; &gt; MAX_CYCLES_PER_RESPONSE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    Return (Reject (CANISTER_ERROR, &lt;implementation-specific&gt;), Cycles - MAX_CYCLES_PER_RESPONSE, S) // single message execution out of cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 Cycles := Cycles - Cycles_used&#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 if Response&#x27;&#x27; = NoResponse</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    Calls := Calls&#x27;&#x27; Â· Calls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    Return (Response&#x27;&#x27;, Cycles, S)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           Return (Reject (CANISTER_ERROR, &lt;implementation-specific&gt;), Cycles, S) // canister did not respond</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           Return (Response, Cycles, S)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Return (Reject (CANISTER_ERROR, &lt;implementation-specific&gt;), Cycles, S)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Submitted request<br>
<code>E</code></p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">E.content = CanisterQuery Q</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Q.canister_id â verify_envelope(E, Q.sender, S.system_time)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|Q.nonce| &lt;= 32</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">is_effective_canister_id(E.content, ECID)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.system_time &lt;= Q.ingress_expiry or Q.sender = anonymous_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Query response <code>R</code>:</p><ul><li><p>if <code>composite_query_helper(S, MAX_CYCLES_PER_QUERY, 0, Q.canister_id, Q.sender, Q.canister_id, Q.method_name, Q.arg) = (Reject (RejectCode, RejectMsg), _, S&#x27;)</code> then</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{status: &quot;rejected&quot;; reject_code: RejectCode; reject_message: RejectMsg; error_code: &lt;implementation-specific&gt;, signatures: Sigs}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li><li><p>Else if <code>composite_query_helper(S, MAX_CYCLES_PER_QUERY, 0, Q.canister_id, Q.sender, Q.canister_id, Q.method_name, Q.arg) = (Reply Res, _, S&#x27;)</code> then</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{status: &quot;replied&quot;; reply: {arg: Res}, signatures: Sigs}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li></ul><p>where the query <code>Q</code>, the response <code>R</code>, and a certificate <code>Cert&#x27;</code> that is obtained by requesting the path <code>/subnet</code> in a <strong>separate</strong> read state request to <code>/api/v2/canister/&lt;effective_canister_id&gt;/read_state</code> satisfy the following:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">verify_response(Q, R, Cert&#x27;) â§ lookup([&quot;time&quot;], Cert&#x27;) = Found S.system_time // or &quot;recent enough&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>State after</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S&#x27; with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    query_stats[Q.receiver] = S&#x27;.query_stats[Q.receiver] Â· {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        timestamp = S&#x27;.time[Q.receiver]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        num_instructions = </span><span class="token tag punctuation" style="color:#F1EEF5">&lt;</span><span class="token tag" style="color:#F68E5F">implementation-specific</span><span class="token tag punctuation" style="color:#F1EEF5">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        request_payload_bytes = |Q.Arg|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response_payload_bytes =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          if R.status = &quot;rejected&quot; then |R.reject_message|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          else |R.reply.arg|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="certified-state-reads">Certified state reads<a href="#certified-state-reads" class="hash-link" aria-label="Direct link to Certified state reads" title="Direct link to Certified state reads">â</a></h4><div class="admonition_WoCw admonitionNote_L5_h"><p>Requesting paths with the prefix <code>/subnet</code> at <code>/api/v2/canister/&lt;effective_canister_id&gt;/read_state</code> might be deprecated in the future. Hence, users might want to point their requests for paths with the prefix <code>/subnet</code> to <code>/api/v2/subnet/&lt;subnet_id&gt;/read_state</code>.</p><p>On the IC mainnet, the root subnet ID <code>tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe</code> can be used to retrieve the list of all IC mainnet&#x27;s subnets by requesting the prefix <code>/subnet</code> at <code>/api/v2/subnet/tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe/read_state</code>.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#FBB03B"></rect><g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#fff"><path d="M8.666 6.667a2 2 0 0 0-2 2v6.667a2 2 0 0 0 2 2h6.667a2 2 0 0 0 2-2v-4a.667.667 0 0 1 1.333 0v4a3.333 3.333 0 0 1-3.333 3.333H8.666a3.333 3.333 0 0 1-3.333-3.334V8.668a3.333 3.333 0 0 1 3.333-3.333h4a.667.667 0 1 1 0 1.333h-4Z"></path><path d="m12.879 13.17 4.669-6.669a.667.667 0 1 0-1.092-.764l-4.67 6.668-.262 1.537 1.355-.772Zm5.27-8.69a2 2 0 0 0-2.785.492l-4.67 6.669a1.333 1.333 0 0 0-.222.54l-.499 2.925a.667.667 0 0 0 .987.691l2.579-1.468c.17-.098.319-.232.432-.394l4.67-6.669a2 2 0 0 0-.492-2.785Z"></path></g><defs><clipPath id="a"><path fill="#fff" transform="translate(4 4)" d="M0 0h16v16H0z"></path></clipPath></defs></svg></div><p>The user can read elements of the <em>state tree</em>, using a <code>read_state</code> request to <code>/api/v2/canister/&lt;ECID&gt;/read_state</code> or <code>/api/v2/subnet/&lt;subnet_id&gt;/read_state</code>.</p><p>Submitted request to <code>/api/v2/canister/&lt;ECID&gt;/read_state</code>
<code>E</code></p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">E.content = ReadState RS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">TS = verify_envelope(E, RS.sender, S.system_time)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|E.content.nonce| &lt;= 32</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.system_time &lt;= RS.ingress_expiry or RS.sender = anonymous_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â path â RS.paths. may_read_path_for_canister(S, R.sender, path)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â ([&quot;request_status&quot;, Rid] Â· _) â RS.paths.  â R â dom(S.requests). hash_of_map(R) = Rid =&gt; R.canister_id â TS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Read response<br>
<!-- -->A record with</p><ul><li><code>{certificate: C}</code></li></ul><p>The predicate <code>may_read_path_for_canister</code> is defined as follows, implementing the access control outlined in <a href="#http-read-state">Request: Read state</a>:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;time&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;subnet&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;subnet&quot;, sid]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;subnet&quot;, sid, &quot;public_key&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;subnet&quot;, sid, &quot;canister_ranges&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;subnet&quot;, sid, &quot;node&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;subnet&quot;, sid, &quot;node&quot;, nid]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;subnet&quot;, sid, &quot;node&quot;, nid, &quot;public_key&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;request_status&quot;, Rid]) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;request_status&quot;, Rid, &quot;status&quot;]) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;request_status&quot;, Rid, &quot;reply&quot;]) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;request_status&quot;, Rid, &quot;reject_code&quot;]) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;request_status&quot;, Rid, &quot;reject_message&quot;]) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;request_status&quot;, Rid, &quot;error_code&quot;]) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  â (R â¦ (_, ECID&#x27;)) â dom(S.requests). hash_of_map(R) = Rid =&gt; RS.sender == R.sender â§ ECID == ECID&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;canister&quot;, cid, &quot;module_hash&quot;]) = cid == ECID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;canister&quot;, cid, &quot;controllers&quot;]) = cid == ECID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, [&quot;canister&quot;, cid, &quot;metadata&quot;, name]) = cid == ECID â§ UTF8(name) â§</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  (cid â dom(S.canisters[cid]) â¨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   S.canisters[cid] = EmptyCanister â¨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   name â (dom(S.canisters[cid].public_custom_sections) âª dom(S.canisters[cid].private_custom_sections)) â¨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   name â dom(S.canisters[cid].public_custom_sections) â¨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   (name â dom(S.canisters[cid].private_custom_sections) â§ RS.sender â S.controllers[cid])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_canister(S, _, _) = False</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>where <code>UTF8(name)</code> holds if <code>name</code> is encoded in UTF-8.</p><p>Submitted request to <code>/api/v2/subnet/&lt;subnet_id&gt;/read_state</code>
<code>E</code></p><p>Conditions  </p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">E.content = ReadState RS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">TS = verify_envelope(E, RS.sender, S.system_time)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|E.content.nonce| &lt;= 32</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">S.system_time &lt;= RS.ingress_expiry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â path â RS.paths. may_read_path_for_subnet(S, RS.sender, path)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Read response<br>
<!-- -->A record with</p><ul><li><code>{certificate: C}</code></li></ul><p>The predicate <code>may_read_path_for_subnet</code> is defined as follows, implementing the access control outlined in <a href="#http-read-state">Request: Read state</a>:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_subnet(S, _, [&quot;time&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_subnet(S, _, [&quot;subnet&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_subnet(S, _, [&quot;subnet&quot;, sid]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_subnet(S, _, [&quot;subnet&quot;, sid, &quot;public_key&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_subnet(S, _, [&quot;subnet&quot;, sid, &quot;canister_ranges&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_subnet(S, _, [&quot;subnet&quot;, sid, &quot;metrics&quot;]) = sid == subnet_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_subnet(S, _, [&quot;subnet&quot;, sid, &quot;node&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_subnet(S, _, [&quot;subnet&quot;, sid, &quot;node&quot;, nid]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_subnet(S, _, [&quot;subnet&quot;, sid, &quot;node&quot;, nid, &quot;public_key&quot;]) = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">may_read_path_for_subnet(S, _, _) = False</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>The response is a certificate <code>cert</code>, as specified in <a href="#certification">Certification</a>, which passes <code>verify_cert</code> (assuming <code>S.root_key</code> as the root of trust), and where for every <code>path</code> documented in <a href="#state-tree">The system state tree</a> that has a path in <code>RS.paths</code> or <code>[&quot;time&quot;]</code> as a prefix, we have</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">lookup_in_tree(path, cert.tree) = lookup_in_tree(path, state_tree(S))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>where <code>state_tree</code> constructs a labeled tree from the IC state <code>S</code> and the (so far underspecified) set of subnets <code>subnets</code>, as per <a href="#state-tree">The system state tree</a></p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">state_tree(S) = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;time&quot;: S.system_time;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;subnet&quot;: { subnet_id : { &quot;public_key&quot; : subnet_pk; &quot;canister_ranges&quot; : subnet_ranges; &quot;metrics&quot; : &lt;implementation-specific&gt;; &quot;node&quot;: { node_id : { &quot;public_key&quot; : node_pk } | (node_id, node_pk) â subnet_nodes } } | (subnet_id, subnet_pk, subnet_ranges, subnet_nodes) â subnets };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;request_status&quot;: { request_id(R): request_status_tree(T) | (R â¦ (T, _)) â S.requests };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;canister&quot;:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    { canister_id :</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        { &quot;module_hash&quot; : SHA256(C.raw_module) | if C â  EmptyCanister } âª</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        { &quot;controllers&quot; : CBOR(S.controllers[canister_id]) } âª</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        { &quot;metadata&quot;: { name: blob | (name, blob) â S.canisters[canister_id].public_custom_sections âª S.canisters[canister_id].private_custom_sections } }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | (canister_id, C) â S.canisters };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">request_status_tree(Received) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  { &quot;status&quot;: &quot;received&quot; }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">request_status_tree(Processing) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  { &quot;status&quot;: &quot;processing&quot; }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">request_status_tree(Rejected (code, msg)) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  { &quot;status&quot;: &quot;rejected&quot;; &quot;reject_code&quot;: code; &quot;reject_message&quot;: msg; &quot;error_code&quot;: &lt;implementation-specific&gt;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">request_status_tree(Replied arg) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  { &quot;status&quot;: &quot;replied&quot;; &quot;reply&quot;: arg }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">request_status_tree(Done) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  { &quot;status&quot;: &quot;done&quot; }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>and where <code>lookup_in_tree</code> is a function that returns <code>Found v</code> for a value <code>v</code>, <code>Absent</code>, or <code>Error</code>, appropriately. See the Section <a href="#lookup">Lookup</a> for more details.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="concrete-canisters">Abstract Canisters to System API<a href="#concrete-canisters" class="hash-link" aria-label="Direct link to Abstract Canisters to System API" title="Direct link to Abstract Canisters to System API">â</a></h3><p>In Section <a href="#abstract-canisters">Abstract canisters</a> we introduced an abstraction over the interface to a canister, to avoid cluttering the abstract specification of the Internet Computer from WebAssembly details. In this section, we will fill the gap and explain how the abstract canister interface maps to the <a href="#system-api">concrete System API</a> and the WebAssembly concepts as defined in the <a href="https://webassembly.github.io/spec/core/index.html" target="_blank" rel="noopener noreferrer">WebAssembly specification</a>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="the-concrete-wasmstate">The concrete <code>WasmState</code><a href="#the-concrete-wasmstate" class="hash-link" aria-label="Direct link to the-concrete-wasmstate" title="Direct link to the-concrete-wasmstate">â</a></h4><p>The abstract <code>WasmState</code> above models the WebAssembly <em>store</em> <code>S</code>, which encompasses the functions, tables, memories and globals of the WebAssembly program, plus additional data maintained by the IC, such as the stable memory:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">WasmState = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  store : S; // a store as per WebAssembly spec</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  self_id : CanId;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  stable_mem : Blob</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>As explained in Section &quot;<a href="#system-api-module">WebAssembly module requirements</a>&quot;, the WebAssembly module imports at most <em>one</em> memory and at most <em>one</em> table; in the following, <em>the</em> memory (resp. table) and the fields <code>mem</code> and <code>table</code> of <code>S</code> refer to that. Any system call that accesses the memory (resp. table) will trap if the module does not import the memory (resp. table).</p><p>We model <code>mem</code> as an array of bytes, and <code>table</code> as an array of execution functions.</p><p>The abstract <code>Callback</code> type above models an entry point for responses:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Closure = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fun   : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    env   : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Callback = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  on_reply : Closure;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  on_reject : Closure;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  on_cleanup : Closure | NoClosure;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="the-execution-state">The execution state<a href="#the-execution-state" class="hash-link" aria-label="Direct link to The execution state" title="Direct link to The execution state">â</a></h4><p>We can model the execution of WebAssembly functions as stateful functions that have access to the WebAssembly store. In order to also model the behavior of the system imports, which have access to additional data structures, we extend the state as follows:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Params = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  arg : NoArg | Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  caller : Principal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reject_code : 0 | SYS_FATAL | SYS_TRANSIENT | â¦;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reject_message : Text;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sysenv : Env;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_refunded : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  method_name : NoText | Text;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ExecutionState = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  wasm_state : WasmState;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  params : Params;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response : NoResponse | Response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_accepted : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_available : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_used : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  balance : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reply_params : { arg : Blob };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  pending_call : MethodCall | NoPendingCall;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  calls : List MethodCall;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_certified_data : NoCertifiedData | Blob;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_global_timer : NoGlobalTimer | Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ingress_filter : Accept | Reject;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  context : I | G | U | Q | CQ | Ry | Rt | CRy | CRt | C | CC | F | T | s;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>This allows us to model WebAssembly functions, including host-provided imports, as functions with implicit mutable access to an <code>ExecutionState</code>, dubbed <em>execution functions</em>. Syntactically, we express this using an implicit argument of type <code>ref ExecutionState</code> in angle brackets (e.g. <code>func&lt;es&gt;(x)</code> for the invocation of a WebAssembly function with type <code>(x : i32) -&gt; ()</code>). The lifetime of the <code>ExecutionState</code> data structure is that of one such function invocation.</p><div class="admonition_WoCw admonitionWarning_tRva"><p>It is nonsensical to pass to an execution function a WebAssembly store <code>S</code> that comes from a different WebAssembly module than one defining the function.</p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="12" fill="#F68E5F"></rect><path d="m5.396 17.258 6.166-11a.502.502 0 0 1 .875 0l6.165 11a.5.5 0 0 1-.437.744H5.835a.5.5 0 0 1-.439-.744Zm6.605-4.588a.5.5 0 0 0-.5.5v2.334a.5.5 0 0 0 1 0V13.17a.5.5 0 0 0-.5-.5Zm-.001-2a.667.667 0 1 0 0 1.334.667.667 0 0 0 0-1.334Z" fill="#fff"></path></svg></div><p>The &quot;liquid&quot; balance of a canister with a given <code>ExecutionState</code> can be obtained as follows:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">liquid_balance(es) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  liquid_balance(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    es.balance,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    es.params.sysenv.reserved_balance,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    freezing_limit(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      es.params.sysenv.compute_allocation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      es.params.sysenv.memory_allocation,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      es.params.sysenv.freezing_threshold,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      memory_usage_wasm_state(es.wasm_state) +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        es.params.sysenv.memory_usage_raw_module +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        es.params.sysenv.memory_usage_canister_history +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        es.params.sysenv.memory_usage_chunk_store +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        es.params.sysenv.memory_usage_snapshot,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      es.params.sysenv.subnet_size,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><ul><li>For more convenience when creating a new <code>ExecutionState</code>, we define the following partial records:<div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">empty_params = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  arg = NoArg;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  caller = ic_principal;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reject_code = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reject_message = &quot;&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sysenv = (undefined);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_refunded = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  method_name = NoText;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">empty_execution_state = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  wasm_state = (undefined);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  params = (undefined);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response = NoResponse;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_accepted = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_available = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cycles_used = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  balance = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  reply_params = { arg = &quot;&quot; };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  pending_call = NoPendingCall;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  calls = [];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_certified_data = NoCertifiedData;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new_global_timer = NoGlobalTimer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ingress_filter = Reject;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  context = (undefined);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="the-concrete-canistermodule">The concrete <code>CanisterModule</code><a href="#the-concrete-canistermodule" class="hash-link" aria-label="Direct link to the-concrete-canistermodule" title="Direct link to the-concrete-canistermodule">â</a></h4><p>Finally, we can specify the abstract <code>CanisterModule</code> that models a concrete WebAssembly module.</p><ul><li><p>The <code>initial_wasm_store</code> mentioned below is the store of the WebAssembly module after <em>instantiation</em> (as per WebAssembly spec) of the WebAssembly module contained in the <a href="#canister-module-format">canister module</a>, before executing a potential <code>(start)</code> function.</p></li><li><p>We define a helper function</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">start : (WasmState) -&gt; Trap { cycles_used : Nat; } | Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_state : WasmState;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_used : Nat;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>modelling execution of a potential <code>(start)</code> function.</p><p>If the WebAssembly module does not export a function called under the name <code>start</code>, then</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">start = Î» (wasm_state) â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_used = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Otherwise, if the WebAssembly module exports a function <code>func</code> under the name <code>start</code>, it is</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">start = Î» (wasm_state) â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context = s;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try func&lt;es&gt;() with Trap then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_state = es.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_used = es.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Note that <code>params</code> are undefined in the <code>(start)</code> function&#x27;s execution state which is fine because the System API does not have access to that part of the execution state during the execution of the <code>(start)</code> function.</p></li><li><p>The <code>init</code> field of the <code>CanisterModule</code> is defined as follows:</p><p>If the WebAssembly module does not export a function called under the name <code>canister_init</code>, then</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">init = Î» (self_id, arg, caller, sysenv) â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  match start({store = initial_wasm_store; self_id = self_id; stable_mem = &quot;&quot;}) with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Trap trap â Trap trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Return res â Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_state = res.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_certified_data = NoCertifiedData;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_global_timer = NoGlobalTimer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        cycles_used = res.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Otherwise, if the WebAssembly module exports a function <code>func</code> under the name <code>canister_init</code>, it is</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">init = Î» (self_id, arg, caller, sysenv) â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  match start({store = initial_wasm_store; self_id = self_id; stable_mem = &quot;&quot;}) with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Trap trap â Trap trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Return res â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          wasm_state = res.wasm_state</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          params = empty_params with {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              arg = arg;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              caller = caller;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              sysenv = sysenv with {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  balance = sysenv.balance - res.cycles_used</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          balance = sysenv.balance - res.cycles_used</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          context = I</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      try func&lt;es&gt;() with Trap then Trap {cycles_used = res.cycles_used + es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          new_state = es.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          new_certified_data = es.new_certified_data;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          new_global_timer = es.new_global_timer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          cycles_used = res.cycles_used + es.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li><li><p>The <code>pre_upgrade</code> field of the <code>CanisterModule</code> is defined as follows:</p><p>If the WebAssembly module does not export a function called under the name <code>canister_pre_upgrade</code>, then it simply returns the current state:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pre_upgrade = Î» (old_state, caller, sysenv) â Return {new_state = old_state; new_certified_data = NoCertifiedData; cycles_used = 0;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Otherwise, if the WebAssembly module exports a function <code>func</code> under the name <code>canister_pre_upgrade</code>, it is</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pre_upgrade = Î» (old_state, caller, sysenv) â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      wasm_state = old_state</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      params = empty_params with { caller = caller; sysenv }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      balance = sysenv.balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      context = G</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try func&lt;es&gt;() with Trap then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_state = es.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_certified_data = es.new_certified_data;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_used = es.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li><li><p>The <code>post_upgrade</code> field of the <code>CanisterModule</code> is defined as follows:</p><p>If the WebAssembly module does not export a function called under the name <code>canister_post_upgrade</code>, then</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">post_upgrade = Î» (wasm_state, arg, caller, sysenv) â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  match start(wasm_state) with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Trap trap â Trap trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Return res â Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_state = res.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_certified_data = NoCertifiedData;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new_global_timer = NoGlobalTimer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        cycles_used = res.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Otherwise, if the WebAssembly module exports a function <code>func</code> under the name <code>canister_post_upgrade</code>, it is</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">post_upgrade = Î» (wasm_state, arg, caller, sysenv) â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  match start(wasm_state) with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Trap trap â Trap trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Return res â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          wasm_state = res.wasm_state</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          params = empty_params with {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              arg = arg;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              caller = caller;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              sysenv = sysenv with {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  balance = sysenv.balance - res.cycles_used</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          balance = sysenv.balance - res.cycles_used</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          context = I</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      try func&lt;es&gt;() with Trap then Trap {cycles_used = res.cycles_used + es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          new_state = es.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          new_certified_data = es.new_certified_data;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          new_global_timer = es.new_global_timer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          cycles_used = res.cycles_used + es.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li><li><p>The partial map <code>update_methods</code> of the <code>CanisterModule</code> is defined for all method names <code>method</code> for which the WebAssembly program exports a function <code>func</code> named <code>canister_update &lt;method&gt;</code>, and has value</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">update_methods[method] = Î» (arg, caller, sysenv, available) â Î» wasm_state â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      wasm_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      params = empty_params with { arg = arg; caller = caller; sysenv }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      balance = sysenv.balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      cycles_available = available;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      context = U</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try func&lt;es&gt;() with Trap then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  discard_pending_call&lt;es&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_state = es.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_calls = es.calls;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_certified_data = es.new_certified_data;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_global_timer = es.new_global_timer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    response = es.response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_accepted = es.cycles_accepted;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_used = es.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li><li><p>The partial map <code>query_methods</code> of the <code>CanisterModule</code> is defined for all method names <code>method</code> for which the WebAssembly program exports a function <code>func</code> named <code>canister_query &lt;method&gt;</code>, and has value</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">query_methods[method] = Î» (arg, caller, sysenv) â Î» wasm_state â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      wasm_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      params = empty_params with { arg = arg; caller = caller; sysenv }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      balance = sysenv.balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      context = Q</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try func&lt;es&gt;() with Trap then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    response = es.response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_used = es.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>By construction, the (possibly modified) <code>es.wasm_state</code> is discarded.</p></li><li><p>The partial map <code>composite_query_methods</code> of the <code>CanisterModule</code> is defined for all method names <code>method</code> for which the WebAssembly program exports a function <code>func</code> named <code>canister_composite_query &lt;method&gt;</code>, and has value</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">composite_query_methods[method] = Î» (arg, caller, sysenv) â Î» wasm_state â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      wasm_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      params = empty_params with { arg = arg; caller = caller; sysenv }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      balance = sysenv.balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      context = CQ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try func&lt;es&gt;() with Trap then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  discard_pending_call&lt;es&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_state = es.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_calls = es.calls;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    response = es.response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_used = es.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li><li><p>The function <code>heartbeat</code> of the <code>CanisterModule</code> is defined if the WebAssembly program exports a function <code>func</code> named <code>canister_heartbeat</code>, and has value</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">heartbeat = Î» (sysenv) â Î» wasm_state â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    params = empty_params with { arg = NoArg; caller = ic_principal; sysenv }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balance = sysenv.balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context = T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try func&lt;es&gt;() with Trap then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  discard_pending_call&lt;es&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_state = es.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_calls = es.calls;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_certified_data = es.certified_data;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_global_timer = es.new_global_timer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_used = es.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>otherwise it is</p></li></ul><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">heartbeat = Î» (sysenv) â Î» wasm_state â Trap {cycles_used = 0;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><ul><li><p>The function <code>global_timer</code> of the <code>CanisterModule</code> is defined if the WebAssembly program exports a function <code>func</code> named <code>canister_global_timer</code>, and has value</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">global_timer = Î» (sysenv) â Î» wasm_state â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    params = empty_params with { arg = NoArg; caller = ic_principal; sysenv }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balance = sysenv.balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context = T</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try func&lt;es&gt;() with Trap then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  discard_pending_call&lt;es&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_state = es.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_calls = es.calls;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_certified_data = es.certified_data;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_global_timer = es.new_global_timer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_used = es.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>otherwise it is</p></li></ul><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">global_timer = Î» (sysenv) â Î» wasm_state â Trap {cycles_used = 0;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><ul><li><p>The function <code>callbacks</code> of the <code>CanisterModule</code> is defined as follows</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">callbacks = Î»(callbacks, response, refunded_cycles, sysenv, available) â Î» wasm_state â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let params0 = empty_params with {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sysenv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_refunded = refund_cycles;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let (fun, env, params, context) = match response with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Reply data -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      (callbacks.on_reply.fun, callbacks.on_reply.env,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        { params0 with data}, Ry)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Reject (reject_code, reject_message)-&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      (callbacks.on_reject.fun, callbacks.on_reject.env,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        { params0 with reject_code; reject_message}, Rt)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    params = params;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balance = sysenv.balance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_available = available;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context = context;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if fun &gt; |es.wasm_state.store.table| then Trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let func = es.wasm_state.store.table[fun]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if typeof(func) â  func (I) -&gt; () then Trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    func&lt;es&gt;(env)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    discard_pending_call&lt;es&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_state = es.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_calls = es.calls;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_certified_data = es.certified_data;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_global_timer = es.new_global_timer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      response = es.response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      cycles_accepted = es.cycles_accepted;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      cycles_used = es.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  with Trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if callbacks.on_cleanup = NoClosure then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if callbacks.on_cleanup.fun &gt; |es.wasm_state.store.table| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let func = es.wasm_state.store.table[callbacks.on_cleanup.fun]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if typeof(func) â  func (I) -&gt; () then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es&#x27; = ref { empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context = C;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try func&lt;es&#x27;&gt;(callbacks.on_cleanup.env) with Trap then Trap {cycles_used = es.cycles_used + es&#x27;.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_state = es&#x27;.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_calls = [];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_certified_data = NoCertifiedData;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_global_timer = es&#x27;.new_global_timer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    response = NoResponse;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_accepted = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_used = es.cycles_used + es&#x27;.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Note that if the initial callback handler traps, the cleanup callback (if present) is executed, and the canister has the chance to update its state.</p></li><li><p>The function <code>composite_callbacks</code> of the <code>CanisterModule</code> is defined as follows</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">composite_callbacks = Î»(callbacks, response, sysenv) â Î» wasm_state â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let params0 = empty_params with {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sysenv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let (fun, env, params, context) = match response with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Reply data -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      (callbacks.on_reply.fun, callbacks.on_reply.env,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        { params0 with data}, CRy)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Reject (reject_code, reject_message)-&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      (callbacks.on_reject.fun, callbacks.on_reject.env,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        { params0 with reject_code; reject_message}, CRt)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    params = params;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balance = sysenv.balance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context = context;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if fun &gt; |es.wasm_state.store.table| then Trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let func = es.wasm_state.store.table[fun]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if typeof(func) â  func (I) -&gt; () then Trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    func&lt;es&gt;(env)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    discard_pending_call&lt;es&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_state = es.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      new_calls = es.calls;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      response = es.response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      cycles_used = es.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  with Trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if callbacks.on_cleanup = NoClosure then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if callbacks.on_cleanup.fun &gt; |es.wasm_state.store.table| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let func = es.wasm_state.store.table[callbacks.on_cleanup.fun]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if typeof(func) â  func (I) -&gt; () then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es&#x27; = ref { empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wasm_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context = CC;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try func&lt;es&#x27;&gt;(callbacks.on_cleanup.env) with Trap then Trap {cycles_used = es.cycles_used + es&#x27;.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Return {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_state = es&#x27;.wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    new_calls = [];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    response = NoResponse;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cycles_used = es.cycles_used + es&#x27;.cycles_used;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Note that if the initial callback handler traps, the cleanup callback (if present) is executed.</p></li><li><p>The <code>inspect_message</code> field of the <code>CanisterModule</code> is defined as follows.</p><p>If the WebAssembly module does not export a function called under the name <code>canister_inspect_message</code>, then access is always granted:</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">inspect_message = Î» (method_name, wasm_state, arg, caller, sysenv) â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Return {status = Accept;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Otherwise, if the WebAssembly module exports a function <code>func</code> under the name <code>canister_inspect_message</code>, it is</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">inspect_message = Î» (method_name, wasm_state, arg, caller, sysenv) â</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let es = ref {empty_execution_state with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      wasm_state = wasm_state;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      params = empty_params with {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        arg = arg;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        caller = caller;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        method_name = method_name;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sysenv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      balance = sysenv.balance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      cycles_available = 0; // ingress requests have no funds</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      context = F;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   try func&lt;es&gt;() with Trap then Trap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Return {status = es.ingress_filter;};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="helper-functions">Helper functions<a href="#helper-functions" class="hash-link" aria-label="Direct link to Helper functions" title="Direct link to Helper functions">â</a></h4><p>In the following section, we use the these helper functions</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">copy_to_canister&lt;es&gt;(dst : I, offset : I, size : I, data : blob) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if offset+size &gt; |data| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if dst+size &gt; |es.wasm_state.store.mem| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.wasm_state.store.mem[dst..dst+size] := data[offset..offset+size]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">copy_from_canister&lt;es&gt;(src : I, size : I) blob =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if src+size &gt; |es.wasm_state.store.mem| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return es.wasm_state.store.mem[src..src+size]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Cycles are represented by 128-bit values so they require 16 bytes of memory.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">copy_cycles_to_canister&lt;es&gt;(dst : I, data : blob) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let size = 16;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if dst+size &gt; |es.wasm_state.store.mem| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.wasm_state.store.mem[dst..dst+size] := data[0..size]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-imports">System imports<a href="#system-imports" class="hash-link" aria-label="Direct link to System imports" title="Direct link to System imports">â</a></h4><p>Upon <em>instantiation</em> of the WebAssembly module, we can provide the following functions as imports.</p><p>The pseudo-code below does <em>not</em> explicitly enforce the restrictions of which imports are available in which contexts; for that the table in <a href="#system-api-imports">Overview of imports</a> is authoritative, and is assumed to be part of the implementation.</p><div style="position:relative"><div style="--prism-color:#F8F8F2;--prism-background-color:#181818" class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#181818"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_arg_data_size&lt;es&gt;() : I =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {I, U, RQ, NRQ, CQ, Ry, CRy, F} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return |es.params.arg|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_arg_data_copy&lt;es&gt;(dst : I, offset : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {I, U, RQ, NRQ, CQ, Ry, CRy, F} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copy_to_canister&lt;es&gt;(dst, offset, size, es.params.arg)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_caller_size() : I =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context = s then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return |es.params.caller|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_caller_copy(dst : I, offset : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context = s then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copy_to_canister&lt;es&gt;(dst, offset, size, es.params.caller)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_reject_code&lt;es&gt;() : i32 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {Ry, Rt, CRy, CRt} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.params.reject_code</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_reject_msg_size&lt;es&gt;() : I =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {Rt, CRt} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return |es.params.reject_msg|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_reject_msg_copy&lt;es&gt;(dst : I, offset : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {Rt, CRt} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copy_to_canister&lt;es&gt;(dst, offset, size, es.params.reject_msg)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_reply_data_append&lt;es&gt;(src : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, RQ, NRQ, CQ, Ry, Rt, CRy, CRt} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.response â  NoResponse then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.reply_params.arg := es.reply_params.arg Â· copy_from_canister&lt;es&gt;(src, size)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_reply&lt;es&gt;() =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, RQ, NRQ, CQ, Ry, Rt, CRy, CRt} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.response â  NoResponse then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.response := Reply (es.reply_params.arg)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.cycles_available := 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_reject&lt;es&gt;(src : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, RQ, NRQ, CQ, Ry, Rt, CRy, CRt} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.response â  NoResponse then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.response := Reject (CANISTER_REJECT, copy_from_canister&lt;es&gt;(src, size))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.cycles_available := 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_cycles_available&lt;es&gt;() : i64 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, Rt, Ry} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.cycles_available &gt;= 2^64 then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return es.cycles_available</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_cycles_available128&lt;es&gt;(dst : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, Rt, Ry} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let amount = es.cycles_available</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copy_cycles_to_canister&lt;es&gt;(dst, amount.to_little_endian_bytes())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_cycles_refunded&lt;es&gt;() : i64 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {Rt, Ry} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.params.cycles_refunded &gt;= 2^64 then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return es.params.cycles_refunded</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_cycles_refunded128&lt;es&gt;(dst : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {Rt, Ry} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let amount = es.params.cycles_refunded</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copy_cycles_to_canister&lt;es&gt;(dst, amount.to_little_endian_bytes())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_cycles_accept&lt;es&gt;(max_amount : i64) : i64 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, Rt, Ry} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let amount = min(max_amount, es.cycles_available)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.cycles_available := es.cycles_available - amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.cycles_accepted := es.cycles_accepted + amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.balance := es.balance + amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_cycles_accept128&lt;es&gt;(max_amount_high : i64, max_amount_low : i64, dst : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, Rt, Ry} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let max_amount = max_amount_high * 2^64 + max_amount_low</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let amount = min(max_amount, es.cycles_available)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.cycles_available := es.cycles_available - amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.cycles_accepted := es.cycles_accepted + amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.balance := es.balance + amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copy_cycles_to_canister&lt;es&gt;(dst, amount.to_little_endian_bytes())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.cycles_burn128&lt;es&gt;(amount_high : i64, amount_low : i64, dst : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {I, G, U, Ry, Rt, C, T} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let amount = amount_high * 2^64 + amount_low</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let burned_amount = min(amount, liquid_balance(es))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.balance := es.balance - burned_amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copy_cycles_to_canister&lt;es&gt;(dst, burned_amount.to_little_endian_bytes())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.canister_self_size&lt;es&gt;() : I =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context = s then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return |es.wasm_state.self_id|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.canister_self_copy&lt;es&gt;(dst : I, offset : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context = s then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copy_to_canister&lt;es&gt;(dst, offset, size, es.wasm_state.self_id)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.canister_cycle_balance&lt;es&gt;() : i64 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context = s then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.balance &gt;= 2^64 then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return es.balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.canister_cycles_balance128&lt;es&gt;(dst : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context = s then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let amount = es.balance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copy_cycles_to_canister&lt;es&gt;(dst, amount.to_little_endian_bytes())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.canister_status&lt;es&gt;() : i32 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context = s then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  match es.params.sysenv.canister_status with</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Running  -&gt; return 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Stopping -&gt; return 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Stopped  -&gt; return 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.canister_version&lt;es&gt;() : i64 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context = s then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return es.params.sysenv.canister_version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_method_name_size&lt;es&gt;() : I =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {F} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return |es.method_name|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.msg_method_name_copy&lt;es&gt;(dst : I, offset : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {F} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copy_to_canister&lt;es&gt;(dst, offset, size, es.params.method_name)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.accept_message&lt;es&gt;() =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {F} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.ingress_filter = Accept then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.ingress_filter = Accept</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.call_new&lt;es&gt;(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    callee_src  : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    callee_size : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name_src    : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name_size   : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reply_fun   : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reply_env   : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reject_fun  : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reject_env  : I,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, CQ, Ry, Rt, CRy, CRt, T} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  discard_pending_call&lt;es&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  callee := copy_from_canister&lt;es&gt;(callee_src, callee_size);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  method_name := copy_from_canister&lt;es&gt;(name_src, name_size);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.pending_call = MethodCall {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    callee = callee;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    method_name = callee;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    arg = &quot;&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    transferred_cycles = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    callback = Callback {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      on_reply = Closure { fun = reply_fun; env = reply_env }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      on_reject = Closure { fun = reject_fun; env = reject_env }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      on_cleanup = NoClosure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.call_on_cleanup&lt;es&gt; (fun : I, env : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, CQ, Ry, Rt, CRy, CRt, T} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.pending_call = NoPendingCall then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.pending_call.callback.on_cleanup â  NoClosure then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.pending_call.callback.on_cleanup := Closure { fun = fun; env = env}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.call_data_append&lt;es&gt; (src : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, CQ, Ry, Rt, CRy, CRt, T} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.pending_call = NoPendingCall then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.pending_call.arg := es.pending_call.arg Â· copy_from_canister&lt;es&gt;(src, size)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.call_cycles_add&lt;es&gt;(amount : i64) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, Ry, Rt, T} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.pending_call = NoPendingCall then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if liquid_balance(es) &lt; amount then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.balance := es.balance - amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.pending_call.transferred_cycles := es.pending_call.transferred_cycles + amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.call_cycles_add128&lt;es&gt;(amount_high : i64, amount_low : i64) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, Ry, Rt, T} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.pending_call = NoPendingCall then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let amount = amount_high * 2^64 + amount_low</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if liquid_balance(es) &lt; amount then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.balance := es.balance - amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.pending_call.transferred_cycles := es.pending_call.transferred_cycles + amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.call_peform&lt;es&gt;() : ( err_code : i32 ) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {U, CQ, Ry, Rt, CRy, CRt, T} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.pending_call = NoPendingCall then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  // `system_cannot_do_this_call_now` abstracts over resource issues preventing the call from being made</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if liquid_balance(es) &lt; MAX_CYCLES_PER_RESPONSE or system_cannot_do_this_call_now()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    discard_pending_call&lt;es&gt;()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return &lt;implementation-specific&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    es.balance := es.balance - MAX_CYCLES_PER_RESPONSE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    es.calls := es.calls Â· es.pending_call</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    es.pending_call := NoPendingCall</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// helper function</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">discard_pending_call&lt;es&gt;() =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.pending_call â  NoPendingCall then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    es.balance := es.balance + es.pending_call.transferred_cycles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    es.pending_call := NoPendingCall</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.stable_size&lt;es&gt;() : (page_count : i32) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if |es.wasm_state.store.mem| &gt; 2^32 then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  page_count := |es.wasm_state.stable_mem| / 64k</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return page_count</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.stable_grow&lt;es&gt;(new_pages : i32) : (old_page_count : i32) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if |es.wasm_state.store.mem| &gt; 2^32 then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if arbitrary() then return -1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    old_size := |es.wasm_state.stable_mem| / 64k</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if old_size + new_pages &gt; 2^16 then return -1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    es.wasm_state.stable_mem :=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      es.wasm_state.stable_mem Â· repeat(0x00, new_pages * 64k)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return old_size</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.stable_write&lt;es&gt;(offset : i32, src : i32, size : i32)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if |es.wasm_state.store.mem| &gt; 2^32 then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if src+size &gt; |es.wasm_state.store.mem| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if offset+size &gt; |es.wasm_state.stable_mem| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.wasm_state.stable_mem[offset..offset+size] := es.wasm_state.store.mem[src..src+size]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.stable_read&lt;es&gt;(dst : i32, offset : i32, size : i32)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if |es.wasm_state.store.mem| &gt; 2^32 then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if offset+size &gt; |es.wasm_state.stable_mem| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if dst+size &gt; |es.wasm_state.store.mem| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.wasm_state.store.mem[offset..offset+size] := es.wasm_state.stable.mem[src..src+size]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.stable64_size&lt;es&gt;() : (page_count : i64) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return |es.wasm_state.stable_mem| / 64k</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.stable64_grow&lt;es&gt;(new_pages : i64) : (old_page_count : i64) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if arbitrary()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  then return -1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    old_size := |es.wasm_state.stable_mem| / 64k</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    es.wasm_state.stable_mem :=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      es.wasm_state.stable_mem Â· repeat(0x00, new_pages * 64k)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return old_size</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.stable64_write&lt;es&gt;(offset : i64, src : i64, size : i64)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if src+size &gt; |es.wasm_state.store.mem| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if offset+size &gt; |es.wasm_state.stable_mem| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.wasm_state.stable_mem[offset..offset+size] := es.wasm_state.store.mem[src..src+size]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.stable64_read&lt;es&gt;(dst : i64, offset : i64, size : i64)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if offset+size &gt; |es.wasm_state.stable_mem| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if dst+size &gt; |es.wasm_state.store.mem| then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.wasm_state.store.mem[offset..offset+size] := es.wasm_state.stable.mem[src..src+size]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.certified_data_set&lt;es&gt;(src : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {I, G, U, Ry, Rt, T} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.new_certified_data := es.wasm_state[src..src+size]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.data_certificate_present&lt;es&gt;() : i32 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context = s then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.params.sysenv.certificate = NoCertificate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  then return 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  else return 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.data_certificate_size&lt;es&gt;() : I =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {NRQ, CQ} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.params.sysenv.certificate = NoCertificate then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return |es.params.sysenv.certificate|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.data_certificate_copy&lt;es&gt;(dst : I, offset : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {NRQ, CQ} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.params.sysenv.certificate = NoCertificate then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  copy_to_canister&lt;es&gt;(dst, offset, size, es.params.sysenv.certificate)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.time&lt;es&gt;() : i64 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context = s then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return es.params.sysenv.time</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.global_timer_set&lt;es&gt;(timestamp: i64) : i64 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.context â {I, G, U, Ry, Rt, C, T} then Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  let prev_global_timer = es.new_global_timer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  es.new_global_timer := timestamp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if prev_global_timer = NoGlobalTimer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  then return es.params.sysenv.global_timer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  else return prev_global_timer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.performance_counter&lt;es&gt;(counter_type : i32) : i64 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  arbitrary()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.is_controller&lt;es&gt;(src : I, size : I) : (result: i32) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  bytes = copy_from_canister&lt;es&gt;(src, size)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if bytes encode a principal then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if bytes â es.params.sysenv.controllers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    then return 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    else return 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Trap {cycles_used = es.cycles_used;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.in_replicated_execution&lt;es&gt;() : i32 =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if es.params.sysenv.certificate = NoCertificate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  then return 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  else return 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.debug_print&lt;es&gt;(src : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I â {i32, i64}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ic0.trap&lt;es&gt;(src : I, size : I) =</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Trap {cycles_used = es.cycles_used;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="changelog">Changelog<a href="#changelog" class="hash-link" aria-label="Direct link to Changelog" title="Direct link to Changelog">â</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_31_0">0.31.0 (2025-01-09)<a href="#0_31_0" class="hash-link" aria-label="Direct link to 0.31.0 (2025-01-09)" title="Direct link to 0.31.0 (2025-01-09)">â</a></h3><ul><li>Add support for Schnorr auxiliary inputs</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_30_0">0.30.0 (2024-11-19)<a href="#0_30_0" class="hash-link" aria-label="Direct link to 0.30.0 (2024-11-19)" title="Direct link to 0.30.0 (2024-11-19)">â</a></h3><ul><li>Add management canister endpoint <code>subnet_info</code>.</li><li>Support for wasm64: 64-bit system API.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_29_0">0.29.0 (2024-11-14)<a href="#0_29_0" class="hash-link" aria-label="Direct link to 0.29.0 (2024-11-14)" title="Direct link to 0.29.0 (2024-11-14)">â</a></h3><ul><li>Allow anonymous query and read state requests with invalid <code>ingress_expiry</code>.</li><li>Add allowed viewers variant to canister log visibility.</li><li>Deprecate the Bitcoin API of the management canister.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_28_0">0.28.0 (2024-10-11)<a href="#0_28_0" class="hash-link" aria-label="Direct link to 0.28.0 (2024-10-11)" title="Direct link to 0.28.0 (2024-10-11)">â</a></h3><ul><li>Add new management canister methods for canister snapshot support.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_27_0">0.27.0 (2024-09-20)<a href="#0_27_0" class="hash-link" aria-label="Direct link to 0.27.0 (2024-09-20)" title="Direct link to 0.27.0 (2024-09-20)">â</a></h3><ul><li>EXPERIMENTAL: Management canister API to fetch Bitcoin block headers.</li><li>Synchronous update call API at <code>/api/v3/canister/.../call</code>.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_26_0">0.26.0 (2024-07-23)<a href="#0_26_0" class="hash-link" aria-label="Direct link to 0.26.0 (2024-07-23)" title="Direct link to 0.26.0 (2024-07-23)">â</a></h3><ul><li>EXPERIMENTAL: Management canister API for threshold Schnorr signatures.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_25_0">0.25.0 (2024-06-14)<a href="#0_25_0" class="hash-link" aria-label="Direct link to 0.25.0 (2024-06-14)" title="Direct link to 0.25.0 (2024-06-14)">â</a></h3><ul><li>Query call statistics.</li><li>New <code>wasm_memory_persistence</code> option for canister upgrades.</li><li>Rename <code>num_blocks_total</code> to <code>num_blocks_proposed_total</code> in node metrics served by the management canister.</li><li>Management canister query call to fetch canister logs.</li><li>WASM heap memory limit in canisters settings.</li><li>32-bit stable memory System API is marked DEPRECATED.</li><li>Remove the management canister query calls <code>bitcoin_get_balance_query</code> and <code>bitcoin_get_utxos_query</code>.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_24_0">0.24.0 (2024-04-23)<a href="#0_24_0" class="hash-link" aria-label="Direct link to 0.24.0 (2024-04-23)" title="Direct link to 0.24.0 (2024-04-23)">â</a></h3><ul><li>Wrap chunk hash for install chunked code in a record and rename <code>storage_canister</code> to <code>store_canister</code>.</li><li>Update subnet read state request conditions on requested paths.</li><li>Fix: allow inter-canister calls (requests) to be spontaneously rejected in the abstract spec.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_23_0">0.23.0 (2024-03-06)<a href="#0_23_0" class="hash-link" aria-label="Direct link to 0.23.0 (2024-03-06)" title="Direct link to 0.23.0 (2024-03-06)">â</a></h3><ul><li>The maximum length of a nonce in an ingress message is 32 bytes.</li><li>Update specification of responses from the endpoint <code>/api/v2/status</code>.</li><li>Stop canister calls might be rejected upon timeout.</li><li>The IC sends a <code>user-agent</code> header with the value <code>ic/1.0</code> in canister HTTPS outcalls if the canister does not provide one.</li><li>Add a management canister method for retrieving node metrics.</li><li>Specify the resource reservation mechanism.</li><li>Allow <code>in_replicated_execution</code> system API method to be executed during <code>canister_start</code>.</li><li>Set the maximum depth of a delegation in a read_state response/certified variable certificate to 1.</li><li>Canister version is guaranteed to increase if the canister&#x27;s running status changes.</li><li>Calls to frozen canisters are rejected with <code>SYS_TRANSIENT</code> instead of <code>CANISTER_ERROR</code>.</li><li>Add API boundary nodes information into the certified state tree.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_22_0">0.22.0 (2023-11-15)<a href="#0_22_0" class="hash-link" aria-label="Direct link to 0.22.0 (2023-11-15)" title="Direct link to 0.22.0 (2023-11-15)">â</a></h3><ul><li>Add metrics on subnet usage into the certified state tree and a new HTTP endpoint <code>/api/v2/subnet/&lt;subnet_id&gt;/read_state</code> for retrieving them.</li><li>Add management canister methods to support installing large WebAssembly modules split into chunks.</li><li>Add a system API method to determine if the canister is running in replicated or non-replicated mode.</li><li>Add a system API method to burn cycles of the canister that calls this method.</li><li>Add a check that a canister receiving an ingress message is Running before the ingress message is marked as Received.</li><li>Increase the maximum number of globals in a canister&#x27;s WASM.</li><li>Add per-call context performance counter.</li><li>Update the computation of the representation-independent hash for the case of maps with nested maps.</li><li>Remove <code>senders</code> field from user delegations.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_21_0">0.21.0 (2023-09-18)<a href="#0_21_0" class="hash-link" aria-label="Direct link to 0.21.0 (2023-09-18)" title="Direct link to 0.21.0 (2023-09-18)">â</a></h3><ul><li>Canister cycle balance cannot decrease below the freezing limit after executing <code>install_code</code> on the management canister.</li><li>System API calls <code>ic0.msg_caller_size</code> and <code>ic0.msg_caller_copy</code> can be called in all contexts except for (start) function.</li><li>Added note on confidentiality of values in the certified state tree.</li><li>Update algorithm computing the request and response hash in the HTTP Gateway including clarification of when the HTTP Gateway can allow for arbitrary certification version in the canister&#x27;s response.</li><li>Update conditions on requested paths in HTTP read state requests.</li><li>Added new query methods in the Bitcoin API.</li><li>Added node public keys to certified state and node signatures to query call responses.</li><li>Added a new mode for canister upgrades skipping pre-upgrade method&#x27;s execution.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_20_0">0.20.0 (2023-07-11)<a href="#0_20_0" class="hash-link" aria-label="Direct link to 0.20.0 (2023-07-11)" title="Direct link to 0.20.0 (2023-07-11)">â</a></h3><ul><li>IC Bitcoin API, ECDSA API, canister HTTPS outcalls API, and 128-bit cycles System API are considered stable.</li><li>Add conditions on requested paths in read state requests.</li><li>Add composite queries.</li><li>Specify that the canister version is incremented upon every successful message execution except for successful message execution of a query method.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_19_0">0.19.0 (2023-06-08)<a href="#0_19_0" class="hash-link" aria-label="Direct link to 0.19.0 (2023-06-08)" title="Direct link to 0.19.0 (2023-06-08)">â</a></h3><ul><li>canister version can be specified in some management canister calls (canister creation, canister code changes, canister settings changes)</li><li>IC records canister history (canister creation, canister code changes, and canister controllers changes)</li><li>added a new <code>canister_info</code> management canister call returning current module hash, current controllers, and canister history</li><li>added a new system API call <code>ic0.is_controller</code> (checking if a principal is a controller of the canister)</li><li>stable memory System API calls can be invoked in the WebAssembly module <code>(start)</code> function</li><li>the system API call <code>ic0.global_timer_set</code> can be invoked in canister pre-upgrade</li><li>added modeling WASM start function in the concrete <code>CanisterModule</code> specification</li><li>WebAssembly module requirements have been revised (relaxed max number of declared functions and globals, added conditions on exported functions)</li><li>certified variables are cleared if a canister is reinstalled</li><li>a canister having an open call context marked as deleted cannot reach Stopped state</li><li>a desired canister ID of the canister created by <code>provisional_create_canister_with_cycles</code> (in testing environments) can be specified using <code>specified_id</code></li><li>conditions on envelope delegations have been revised (relaxed max number of delegations, restricted max number of targets per delegation, forbidden cycles in the delegation chain)</li><li>added a new optional field <code>senders</code> in envelope delegations (restricting users to which a delegation applies)</li><li>all <code>/request_status/&lt;request_id&gt;</code> paths must refer to the same <code>request_id</code> in a <code>read_state</code> request</li><li>IC protocol execution error conditions (such as failing <code>inspect_message</code> method of a canister) are returned as 200 HTTP responses with a cbor body describing the error (instead of 4xx or 5xx HTTP responses)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_18_9">0.18.9 (2022-12-06)<a href="#0_18_9" class="hash-link" aria-label="Direct link to 0.18.9 (2022-12-06)" title="Direct link to 0.18.9 (2022-12-06)">â</a></h3><ul><li>Global timers</li><li>Canister version</li><li>Clarifications for HTTP requests &amp; Bitcoin integration costs</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_18_8">0.18.8 (2022-11-09)<a href="#0_18_8" class="hash-link" aria-label="Direct link to 0.18.8 (2022-11-09)" title="Direct link to 0.18.8 (2022-11-09)">â</a></h3><ul><li>Updated HTTP request API</li><li>Canister status available to canister</li><li>64-bit stable memory is no longer experimental</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_18_7">0.18.7 (2022-09-27)<a href="#0_18_7" class="hash-link" aria-label="Direct link to 0.18.7 (2022-09-27)" title="Direct link to 0.18.7 (2022-09-27)">â</a></h3><ul><li>HTTP request API</li><li>Reserved principals</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_18_6">0.18.6 (2022-08-09)<a href="#0_18_6" class="hash-link" aria-label="Direct link to 0.18.6 (2022-08-09)" title="Direct link to 0.18.6 (2022-08-09)">â</a></h3><ul><li>Canister access to performance metrics</li><li>Query calls are rejected when the canister is frozen</li><li>Support for implementation-specific error codes for requests</li><li>Deleted call contexts do not prevent canister from reaching Stopped state</li><li>Update effective canister id checks in certificate delegations</li><li>Formal model in Isabelle</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_18_5">0.18.5 (2022-07-08)<a href="#0_18_5" class="hash-link" aria-label="Direct link to 0.18.5 (2022-07-08)" title="Direct link to 0.18.5 (2022-07-08)">â</a></h3><ul><li>Idle consumption of resources in cycles per day can be obtain via <code>canister_status</code> method of the management canister</li><li>Include the HTTP Gateway Protocol in this spec</li><li>Clarifications in definition of cycles consumption</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_18_4">0.18.4 (2022-06-20)<a href="#0_18_4" class="hash-link" aria-label="Direct link to 0.18.4 (2022-06-20)" title="Direct link to 0.18.4 (2022-06-20)">â</a></h3><ul><li>Canister cycle balances are represented by 128 bits, and no system-defined upper limit exists anymore</li><li>Canister modules can be gzip-encoded</li><li>Expose Wasm custom sections in the state tree</li><li>EXPERIMENTAL: Canister API for accessing Bitcoin transactions</li><li>EXPERIMENTAL: Canister API for threshold ECDSA signatures</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_18_3">0.18.3 (2022-01-10)<a href="#0_18_3" class="hash-link" aria-label="Direct link to 0.18.3 (2022-01-10)" title="Direct link to 0.18.3 (2022-01-10)">â</a></h3><ul><li>New System API which uses 128-bit values to represent the amount of cycles</li><li>Subnet delegations include a canister id scope</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_18_2">0.18.2 (2021-09-29)<a href="#0_18_2" class="hash-link" aria-label="Direct link to 0.18.2 (2021-09-29)" title="Direct link to 0.18.2 (2021-09-29)">â</a></h3><ul><li>Canister heartbeat</li><li>Terminology changes</li><li>Support for 64-bit stable memory</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_18_1">0.18.1 (2021-08-04)<a href="#0_18_1" class="hash-link" aria-label="Direct link to 0.18.1 (2021-08-04)" title="Direct link to 0.18.1 (2021-08-04)">â</a></h3><ul><li>Support RSA PKCS#1 v1.5 signatures in web authentication</li><li>Spec clarification: Fix various typos and improve textual clarity</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_18_0">0.18.0 (2021-05-18)<a href="#0_18_0" class="hash-link" aria-label="Direct link to 0.18.0 (2021-05-18)" title="Direct link to 0.18.0 (2021-05-18)">â</a></h3><ul><li>A canister has a set of controllers, instead of always one</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_17_0">0.17.0 (2021-04-22)<a href="#0_17_0" class="hash-link" aria-label="Direct link to 0.17.0 (2021-04-22)" title="Direct link to 0.17.0 (2021-04-22)">â</a></h3><ul><li>Canister Signatures are introduced</li><li>Spec clarification: the signature in the WebAuthn scheme is prefixed by the CBOR self-identifying tag</li><li>Cycle-depleted canisters are forcibly uninstalled</li><li>Canister settings in <code>create_canister</code> and <code>update_settings</code>. <code>install_code</code> no longer takes allocation settings.</li><li>A freezing threshold can be configured via the canister settings</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_16_1">0.16.1 (2021-04-14)<a href="#0_16_1" class="hash-link" aria-label="Direct link to 0.16.1 (2021-04-14)" title="Direct link to 0.16.1 (2021-04-14)">â</a></h3><ul><li>The cleanup callback is introduced</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_16_0">0.16.0 (2021-03-25)<a href="#0_16_0" class="hash-link" aria-label="Direct link to 0.16.0 (2021-03-25)" title="Direct link to 0.16.0 (2021-03-25)">â</a></h3><ul><li>New http v2 API that allows for stateless boundary nodes</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_15_6">0.15.6 (2021-03-25)<a href="#0_15_6" class="hash-link" aria-label="Direct link to 0.15.6 (2021-03-25)" title="Direct link to 0.15.6 (2021-03-25)">â</a></h3><ul><li>The system may impose limits on the number of globals and functions</li><li>No ingress messages towards empty canisters are accepted</li><li>No ingress messages towards <code>raw_rand</code> and <code>deposit_cycles</code> are accepted</li><li>A memory allocation of <code>0</code> means âbest effortâ</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_15_5">0.15.5 (2021-03-11)<a href="#0_15_5" class="hash-link" aria-label="Direct link to 0.15.5 (2021-03-11)" title="Direct link to 0.15.5 (2021-03-11)">â</a></h3><ul><li>deposit_cycles(): any caller allowed</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_15_4">0.15.4 (2021-03-04)<a href="#0_15_4" class="hash-link" aria-label="Direct link to 0.15.4 (2021-03-04)" title="Direct link to 0.15.4 (2021-03-04)">â</a></h3><ul><li>Ingress message filtering</li><li>Add ECDSA signatures on curve secp256k1</li><li>Clarify that the <code>ic0.data_certificate_present</code> system function may be
called in all contexts.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_15_3">0.15.3 (2021-02-26)<a href="#0_15_3" class="hash-link" aria-label="Direct link to 0.15.3 (2021-02-26)" title="Direct link to 0.15.3 (2021-02-26)">â</a></h3><ul><li>Expose module hash and controller via <code>read_state</code></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_15_2">0.15.2 (2021-02-09)<a href="#0_15_2" class="hash-link" aria-label="Direct link to 0.15.2 (2021-02-09)" title="Direct link to 0.15.2 (2021-02-09)">â</a></h3><ul><li>The document is renamed to âInternet Computer Interface Specâ</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_15_0">0.15.0 (2020-12-17)<a href="#0_15_0" class="hash-link" aria-label="Direct link to 0.15.0 (2020-12-17)" title="Direct link to 0.15.0 (2020-12-17)">â</a></h3><ul><li>Support for raw Ed25519 keys is removed</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_14_1">0.14.1 (2020-12-08)<a href="#0_14_1" class="hash-link" aria-label="Direct link to 0.14.1 (2020-12-08)" title="Direct link to 0.14.1 (2020-12-08)">â</a></h3><ul><li>The default <code>memory_allocation</code> becomes unspecified</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_14_0">0.14.0 (2020-11-18)<a href="#0_14_0" class="hash-link" aria-label="Direct link to 0.14.0 (2020-11-18)" title="Direct link to 0.14.0 (2020-11-18)">â</a></h3><ul><li>Support for funds is scaled back to only support cycles</li><li>The <code>ic0.msg_cycles_accept</code> system call now returns the actually accepted
cycles</li><li>The <code>provisional_</code> management calls are introduced</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_13_2">0.13.2 (2020-11-12)<a href="#0_13_2" class="hash-link" aria-label="Direct link to 0.13.2 (2020-11-12)" title="Direct link to 0.13.2 (2020-11-12)">â</a></h3><ul><li>The <code>ic0.canister_status</code> system call</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_13_1">0.13.1 (2020-11-06)<a href="#0_13_1" class="hash-link" aria-label="Direct link to 0.13.1 (2020-11-06)" title="Direct link to 0.13.1 (2020-11-06)">â</a></h3><ul><li>Delegation between user public keys</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_13_0">0.13.0 (2020-10-19)<a href="#0_13_0" class="hash-link" aria-label="Direct link to 0.13.0 (2020-10-19)" title="Direct link to 0.13.0 (2020-10-19)">â</a></h3><ul><li>Certification (also removes ârequest-statusâ request)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_12_2">0.12.2 (2020-10-23)<a href="#0_12_2" class="hash-link" aria-label="Direct link to 0.12.2 (2020-10-23)" title="Direct link to 0.12.2 (2020-10-23)">â</a></h3><ul><li>User authentication method based on WebAuthn is introduced</li><li>User authentication can use ECDSA</li><li>Public keys are DER-encoded</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_12_1">0.12.1 (2020-10-16)<a href="#0_12_1" class="hash-link" aria-label="Direct link to 0.12.1 (2020-10-16)" title="Direct link to 0.12.1 (2020-10-16)">â</a></h3><ul><li>Return more information in the <code>canister_status</code> management call</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_12_0">0.12.0 (2020-10-13)<a href="#0_12_0" class="hash-link" aria-label="Direct link to 0.12.0 (2020-10-13)" title="Direct link to 0.12.0 (2020-10-13)">â</a></h3><ul><li>Anonymous requests must have the sender field set</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_11_1">0.11.1 (2020-10-01)<a href="#0_11_1" class="hash-link" aria-label="Direct link to 0.11.1 (2020-10-01)" title="Direct link to 0.11.1 (2020-10-01)">â</a></h3><ul><li>The <code>deposit_funds</code> call</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0_11_0">0.11.0 (2020-09-23)<a href="#0_11_0" class="hash-link" aria-label="Direct link to 0.11.0 (2020-09-23)" title="Direct link to 0.11.0 (2020-09-23)">â</a></h3><ul><li>Inter-canister calls are now performed using a builder-like API</li><li>Support for funds (balances and transfers)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_10_3">0.10.3 (2020-09-21)<a href="#v0_10_3" class="hash-link" aria-label="Direct link to 0.10.3 (2020-09-21)" title="Direct link to 0.10.3 (2020-09-21)">â</a></h3><ul><li>The anonymous user is introduced</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_10_1">0.10.1 (2020-09-01)<a href="#v0_10_1" class="hash-link" aria-label="Direct link to 0.10.1 (2020-09-01)" title="Direct link to 0.10.1 (2020-09-01)">â</a></h3><ul><li>Forward-port changes from 0.9.3</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_10_0">0.10.0 (2020-08-06)<a href="#v0_10_0" class="hash-link" aria-label="Direct link to 0.10.0 (2020-08-06)" title="Direct link to 0.10.0 (2020-08-06)">â</a></h3><ul><li>Users can set/update a memory allocation when installing/upgrading a canister.</li><li>The <code>expiry</code> field is added to requests</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_9_3">0.9.3 (2020-09-01)<a href="#v0_9_3" class="hash-link" aria-label="Direct link to 0.9.3 (2020-09-01)" title="Direct link to 0.9.3 (2020-09-01)">â</a></h3><ul><li>The management canister supports the <code>raw_rand</code> method</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_9_2">0.9.2 (2020-08-05)<a href="#v0_9_2" class="hash-link" aria-label="Direct link to 0.9.2 (2020-08-05)" title="Direct link to 0.9.2 (2020-08-05)">â</a></h3><ul><li>Canister controllers can stop/start canisters and can query their status.</li><li>Canister controllers can delete canisters</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_9_1">0.9.1 (2020-07-20)<a href="#v0_9_1" class="hash-link" aria-label="Direct link to 0.9.1 (2020-07-20)" title="Direct link to 0.9.1 (2020-07-20)">â</a></h3><ul><li>Forward-port changes from 0.8.2</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_9_0">0.9.0 (2020-07-15)<a href="#v0_9_0" class="hash-link" aria-label="Direct link to 0.9.0 (2020-07-15)" title="Direct link to 0.9.0 (2020-07-15)">â</a></h3><ul><li>Introduction of a domain separator (again)</li><li>The calculation of âderived idsâ has changed</li><li>The self-authenticating and derived id forms use a truncated hash</li><li>The textual representation of principals has changed</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_8_2">0.8.2 (2020-07-17)<a href="#v0_8_2" class="hash-link" aria-label="Direct link to 0.8.2 (2020-07-17)" title="Direct link to 0.8.2 (2020-07-17)">â</a></h3><ul><li>Installing code via <code>reinstall</code> works also on the empty canister</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_8_1">0.8.1 (2020-07-10)<a href="#v0_8_1" class="hash-link" aria-label="Direct link to 0.8.1 (2020-07-10)" title="Direct link to 0.8.1 (2020-07-10)">â</a></h3><ul><li>Reflect refined process in README and intro.</li><li><code>ic0.time</code> added</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_8_0">0.8.0 (2020-06-23)<a href="#v0_8_0" class="hash-link" aria-label="Direct link to 0.8.0 (2020-06-23)" title="Direct link to 0.8.0 (2020-06-23)">â</a></h3><ul><li>Revert the introduction of a domain separator</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_6_2">0.6.2 (2020-06-23)<a href="#v0_6_2" class="hash-link" aria-label="Direct link to 0.6.2 (2020-06-23)" title="Direct link to 0.6.2 (2020-06-23)">â</a></h3><ul><li>Fix meaning-changing typos in <code>ic.did</code></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_6_0">0.6.0 (2020-06-08)<a href="#v0_6_0" class="hash-link" aria-label="Direct link to 0.6.0 (2020-06-08)" title="Direct link to 0.6.0 (2020-06-08)">â</a></h3><ul><li>Make all canister ids system-chosen</li><li>HTTP requests for management features are removed</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_4_0">0.4.0 (2020-05-25)<a href="#v0_4_0" class="hash-link" aria-label="Direct link to 0.4.0 (2020-05-25)" title="Direct link to 0.4.0 (2020-05-25)">â</a></h3><ul><li>(editorial) the term âprincipalâ is now used for the <em>id</em> of a canister or
user, not the canister or user itself</li><li>The signature of a request needs to be calculated using a domain separator</li><li>Describe the <code>controller</code> attribute, add a request to change it</li><li>The IC management canister is introduced</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_2_16">0.2.16 (2020-05-29)<a href="#v0_2_16" class="hash-link" aria-label="Direct link to 0.2.16 (2020-05-29)" title="Direct link to 0.2.16 (2020-05-29)">â</a></h3><ul><li>More tests about calls from query methods</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_2_14">0.2.14 (2020-05-14)<a href="#v0_2_14" class="hash-link" aria-label="Direct link to 0.2.14 (2020-05-14)" title="Direct link to 0.2.14 (2020-05-14)">â</a></h3><ul><li>Bugfix: Mode should be <code>reinstall</code>, not <code>replace</code></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_2_8">0.2.8 (2020-04-23)<a href="#v0_2_8" class="hash-link" aria-label="Direct link to 0.2.8 (2020-04-23)" title="Direct link to 0.2.8 (2020-04-23)">â</a></h3><ul><li>Include section with CDDL description</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_2_4">0.2.4 (2020-03-23)<a href="#v0_2_4" class="hash-link" aria-label="Direct link to 0.2.4 (2020-03-23)" title="Direct link to 0.2.4 (2020-03-23)">â</a></h3><ul><li>simplify versioning (only three components), skip 0.2.2 to avoid confusion with 0.2.0.2</li><li>Clarification: <code>reply</code> field is always present</li><li>General cleanup based on front-to-back reading</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="v0_2_0_0">0.2.0.0 (2020-03-11)<a href="#v0_2_0_0" class="hash-link" aria-label="Direct link to 0.2.0.0 (2020-03-11)" title="Direct link to 0.2.0.0 (2020-03-11)">â</a></h3><ul><li>This is the first release. Subsequent releases will include a changelog.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dfinity/portal/edit/master/docs/references/ic-interface-spec.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-01-10T07:28:07.000Z">Jan 10, 2025</time></b> by <b>mraszyk</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/current/references/http-gateway-protocol-spec"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">The HTTP Gateway Protocol Specification</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/current/references/id-encoding-spec"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ID encoding specification</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a><ul><li><a href="#target-audience" class="table-of-contents__link toc-highlight">Target audience</a></li><li><a href="#scope-of-this-document" class="table-of-contents__link toc-highlight">Scope of this document</a></li><li><a href="#overview-of-the-internet-computer" class="table-of-contents__link toc-highlight">Overview of the Internet Computer</a></li><li><a href="#nomenclature" class="table-of-contents__link toc-highlight">Nomenclature</a></li></ul></li><li><a href="#pervasive-concepts" class="table-of-contents__link toc-highlight">Pervasive concepts</a><ul><li><a href="#unspecified-constants-and-limits" class="table-of-contents__link toc-highlight">Unspecified constants and limits</a></li><li><a href="#principal" class="table-of-contents__link toc-highlight">Principals</a></li><li><a href="#canister-lifecycle" class="table-of-contents__link toc-highlight">Canister lifecycle</a></li><li><a href="#signatures" class="table-of-contents__link toc-highlight">Signatures</a></li><li><a href="#supplementary-technologies" class="table-of-contents__link toc-highlight">Supplementary Technologies</a></li></ul></li><li><a href="#state-tree" class="table-of-contents__link toc-highlight">The system state tree</a><ul><li><a href="#state-tree-time" class="table-of-contents__link toc-highlight">Time</a></li><li><a href="#state-tree-api-bn" class="table-of-contents__link toc-highlight">Api boundary nodes information</a></li><li><a href="#state-tree-subnet" class="table-of-contents__link toc-highlight">Subnet information</a></li><li><a href="#state-tree-request-status" class="table-of-contents__link toc-highlight">Request status</a></li><li><a href="#state-tree-certified-data" class="table-of-contents__link toc-highlight">Certified data</a></li><li><a href="#state-tree-canister-information" class="table-of-contents__link toc-highlight">Canister information</a></li></ul></li><li><a href="#http-interface" class="table-of-contents__link toc-highlight">HTTPS Interface</a><ul><li><a href="#http-call-overview" class="table-of-contents__link toc-highlight">Overview of canister calling</a></li><li><a href="#http-call" class="table-of-contents__link toc-highlight">Request: Call</a></li><li><a href="#http-async-call" class="table-of-contents__link toc-highlight">Request: Asynchronous Call</a></li><li><a href="#http-read-state" class="table-of-contents__link toc-highlight">Request: Read state</a></li><li><a href="#http-query" class="table-of-contents__link toc-highlight">Request: Query call</a></li><li><a href="#http-effective-canister-id" class="table-of-contents__link toc-highlight">Effective canister id</a></li><li><a href="#authentication" class="table-of-contents__link toc-highlight">Authentication</a></li><li><a href="#hash-of-map" class="table-of-contents__link toc-highlight">Representation-independent hashing of structured data</a></li><li><a href="#request-id" class="table-of-contents__link toc-highlight">Request ids</a></li><li><a href="#reject-codes" class="table-of-contents__link toc-highlight">Reject codes</a></li><li><a href="#error-codes" class="table-of-contents__link toc-highlight">Error codes</a></li><li><a href="#api-status" class="table-of-contents__link toc-highlight">Status endpoint</a></li><li><a href="#api-cbor" class="table-of-contents__link toc-highlight">CBOR encoding of requests and responses</a></li><li><a href="#api-cddl" class="table-of-contents__link toc-highlight">CDDL description of requests and responses</a></li><li><a href="#ordering-guarantees" class="table-of-contents__link toc-highlight">Ordering guarantees</a></li><li><a href="#synchronicity-across-nodes" class="table-of-contents__link toc-highlight">Synchronicity across nodes</a></li></ul></li><li><a href="#canister-module-format" class="table-of-contents__link toc-highlight">Canister module format</a></li><li><a href="#system-api" class="table-of-contents__link toc-highlight">Canister interface (System API)</a><ul><li><a href="#system-api-module" class="table-of-contents__link toc-highlight">WebAssembly module requirements</a></li><li><a href="#interpretation-of-numbers" class="table-of-contents__link toc-highlight">Interpretation of numbers</a></li><li><a href="#entry-points" class="table-of-contents__link toc-highlight">Entry points</a></li><li><a href="#replicated-and-non-replicated-execution-mode" class="table-of-contents__link toc-highlight">Replicated and Non-Replicated execution mode</a></li><li><a href="#system-api-imports" class="table-of-contents__link toc-highlight">Overview of imports</a></li><li><a href="#blob-typed-arguments-and-results" class="table-of-contents__link toc-highlight">Blob-typed arguments and results</a></li><li><a href="#method-arguments" class="table-of-contents__link toc-highlight">Method arguments</a></li><li><a href="#responding" class="table-of-contents__link toc-highlight">Responding</a></li><li><a href="#system-api-inspect-message" class="table-of-contents__link toc-highlight">Ingress message inspection</a></li><li><a href="#system-api-canister-self" class="table-of-contents__link toc-highlight">Self-identification</a></li><li><a href="#system-api-canister-status" class="table-of-contents__link toc-highlight">Canister status</a></li><li><a href="#system-api-canister-version" class="table-of-contents__link toc-highlight">Canister version</a></li><li><a href="#system-api-call" class="table-of-contents__link toc-highlight">Inter-canister method calls</a></li><li><a href="#system-api-cycles" class="table-of-contents__link toc-highlight">Cycles</a></li><li><a href="#system-api-stable-memory" class="table-of-contents__link toc-highlight">Stable memory</a></li><li><a href="#system-api-time" class="table-of-contents__link toc-highlight">System time</a></li><li><a href="#global-timer-1" class="table-of-contents__link toc-highlight">Global timer</a></li><li><a href="#system-api-performance-counter" class="table-of-contents__link toc-highlight">Performance counter</a></li><li><a href="#system-api-replicated-execution-check" class="table-of-contents__link toc-highlight">Replicated execution check</a></li><li><a href="#system-api-controller-check" class="table-of-contents__link toc-highlight">Controller check</a></li><li><a href="#system-api-certified-data" class="table-of-contents__link toc-highlight">Certified data</a></li><li><a href="#debugging-aids" class="table-of-contents__link toc-highlight">Debugging aids</a></li><li><a href="#host-references" class="table-of-contents__link toc-highlight">Outlook: Using Host References</a></li></ul></li><li><a href="#ic-management-canister" class="table-of-contents__link toc-highlight">The IC management canister</a><ul><li><a href="#ic-candid" class="table-of-contents__link toc-highlight">Interface overview</a></li><li><a href="#ic-create_canister" class="table-of-contents__link toc-highlight">IC method <code>create_canister</code></a></li><li><a href="#ic-update_settings" class="table-of-contents__link toc-highlight">IC method <code>update_settings</code></a></li><li><a href="#ic-upload_chunk" class="table-of-contents__link toc-highlight">IC method <code>upload_chunk</code></a></li><li><a href="#ic-clear_chunk_store" class="table-of-contents__link toc-highlight">IC method <code>clear_chunk_store</code></a></li><li><a href="#ic-stored_chunks" class="table-of-contents__link toc-highlight">IC method <code>stored_chunks</code></a></li><li><a href="#ic-install_code" class="table-of-contents__link toc-highlight">IC method <code>install_code</code></a></li><li><a href="#ic-install_chunked_code" class="table-of-contents__link toc-highlight">IC method <code>install_chunked_code</code></a></li><li><a href="#ic-uninstall_code" class="table-of-contents__link toc-highlight">IC method <code>uninstall_code</code></a></li><li><a href="#ic-canister_status" class="table-of-contents__link toc-highlight">IC method <code>canister_status</code></a></li><li><a href="#ic-canister_info" class="table-of-contents__link toc-highlight">IC method <code>canister_info</code></a></li><li><a href="#ic-stop_canister" class="table-of-contents__link toc-highlight">IC method <code>stop_canister</code></a></li><li><a href="#ic-start_canister" class="table-of-contents__link toc-highlight">IC method <code>start_canister</code></a></li><li><a href="#ic-delete_canister" class="table-of-contents__link toc-highlight">IC method <code>delete_canister</code></a></li><li><a href="#ic-deposit_cycles" class="table-of-contents__link toc-highlight">IC method <code>deposit_cycles</code></a></li><li><a href="#ic-raw_rand" class="table-of-contents__link toc-highlight">IC method <code>raw_rand</code></a></li><li><a href="#ic-ecdsa_public_key" class="table-of-contents__link toc-highlight">IC method <code>ecdsa_public_key</code></a></li><li><a href="#ic-sign_with_ecdsa" class="table-of-contents__link toc-highlight">IC method <code>sign_with_ecdsa</code></a></li><li><a href="#ic-schnorr_public_key" class="table-of-contents__link toc-highlight">IC method <code>schnorr_public_key</code></a></li><li><a href="#ic-sign_with_schnorr" class="table-of-contents__link toc-highlight">IC method <code>sign_with_schnorr</code></a></li><li><a href="#ic-http_request" class="table-of-contents__link toc-highlight">IC method <code>http_request</code></a></li><li><a href="#ic-node-metrics-history" class="table-of-contents__link toc-highlight">IC method <code>node_metrics_history</code></a></li><li><a href="#ic-subnet-info" class="table-of-contents__link toc-highlight">IC method <code>subnet_info</code></a></li><li><a href="#ic-take_canister_snapshot" class="table-of-contents__link toc-highlight">IC method <code>take_canister_snapshot</code></a></li><li><a href="#ic-load_canister_snapshot" class="table-of-contents__link toc-highlight">IC method <code>load_canister_snapshot</code></a></li><li><a href="#ic-list_canister_snapshots" class="table-of-contents__link toc-highlight">IC method <code>list_canister_snapshots</code></a></li><li><a href="#ic-delete_canister_snapshot" class="table-of-contents__link toc-highlight">IC method <code>delete_canister_snapshot</code></a></li><li><a href="#ic-fetch_canister_logs" class="table-of-contents__link toc-highlight">IC method <code>fetch_canister_logs</code></a></li></ul></li><li><a href="#ic-bitcoin-api" class="table-of-contents__link toc-highlight">The IC Bitcoin API</a><ul><li><a href="#ic-bitcoin_get_utxos" class="table-of-contents__link toc-highlight">IC method <code>bitcoin_get_utxos</code></a></li><li><a href="#ic-bitcoin_get_balance" class="table-of-contents__link toc-highlight">IC method <code>bitcoin_get_balance</code></a></li><li><a href="#ic-bitcoin_send_transaction" class="table-of-contents__link toc-highlight">IC method <code>bitcoin_send_transaction</code></a></li><li><a href="#ic-bitcoin_get_current_fee_percentiles" class="table-of-contents__link toc-highlight">IC method <code>bitcoin_get_current_fee_percentiles</code></a></li><li><a href="#ic-bitcoin_get_block_headers" class="table-of-contents__link toc-highlight">IC method <code>bitcoin_get_block_headers</code></a></li></ul></li><li><a href="#ic-provisional-api" class="table-of-contents__link toc-highlight">The IC Provisional API</a><ul><li><a href="#ic-provisional_create_canister_with_cycles" class="table-of-contents__link toc-highlight">IC method <code>provisional_create_canister_with_cycles</code></a></li><li><a href="#ic-provisional_top_up_canister" class="table-of-contents__link toc-highlight">IC method <code>provisional_top_up_canister</code></a></li></ul></li><li><a href="#certification" class="table-of-contents__link toc-highlight">Certification</a><ul><li><a href="#root-of-trust" class="table-of-contents__link toc-highlight">Root of trust</a></li><li><a href="#certificate" class="table-of-contents__link toc-highlight">Certificate</a></li><li><a href="#lookup" class="table-of-contents__link toc-highlight">Lookup</a></li><li><a href="#certification-delegation" class="table-of-contents__link toc-highlight">Delegation</a></li><li><a href="#certification-encoding" class="table-of-contents__link toc-highlight">Encoding of certificates</a></li><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li></ul></li><li><a href="#http-gateway" class="table-of-contents__link toc-highlight">The HTTP Gateway protocol</a></li><li><a href="#abstract-behavior" class="table-of-contents__link toc-highlight">Abstract behavior</a><ul><li><a href="#notation" class="table-of-contents__link toc-highlight">Notation</a></li><li><a href="#abstract-state" class="table-of-contents__link toc-highlight">Abstract state</a></li><li><a href="#invariants" class="table-of-contents__link toc-highlight">Invariants</a></li><li><a href="#state-transitions" class="table-of-contents__link toc-highlight">State transitions</a></li><li><a href="#concrete-canisters" class="table-of-contents__link toc-highlight">Abstract Canisters to System API</a></li></ul></li></ul></div></div></div></div></main></div></div><div class="container_pcGX"><footer class="footer"><div class="editButtonContainer_OU6K"></div><div class="footerLinksContainer_LuNH"><div class="footerLinkCol_Pfs5"><p class="footerLink_Dz86"><a href="https://lbbne-haaaa-aaaam-absda-cai.icp0.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item" style="color:white;font-weight:bold"><span class="lg:inline-flex items-center gap-1">Internet Computer Association<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_tdhU" viewBox="0 -2 12 10" xmlns="http://www.w3.org/2000/svg"><path d="M6.49513 2.56192L1.4379 2.56192L1.4379 1.22879H8.77107V8.56196L7.43794 8.56196L7.43794 3.50473L1.7 9.24266L0.757192 8.29986L6.49513 2.56192Z" fill="currentColor"></path></svg></span></a></p><p class="footerLink_Dz86"><a href="https://wiki.internetcomputer.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item" style="color:white;font-weight:bold"><span class="lg:inline-flex items-center gap-1">Wiki<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_tdhU" viewBox="0 -2 12 10" xmlns="http://www.w3.org/2000/svg"><path d="M6.49513 2.56192L1.4379 2.56192L1.4379 1.22879H8.77107V8.56196L7.43794 8.56196L7.43794 3.50473L1.7 9.24266L0.757192 8.29986L6.49513 2.56192Z" fill="currentColor"></path></svg></span></a></p><p class="footerLink_Dz86"><a target="_blank" class="footer__link-item" style="color:white;font-weight:bold" href="/node-providers">Node Providers</a></p><p class="footerLink_Dz86"><a href="https://dashboard.internetcomputer.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item" style="color:white;font-weight:bold"><span class="lg:inline-flex items-center gap-1">Dashboard<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_tdhU" viewBox="0 -2 12 10" xmlns="http://www.w3.org/2000/svg"><path d="M6.49513 2.56192L1.4379 2.56192L1.4379 1.22879H8.77107V8.56196L7.43794 8.56196L7.43794 3.50473L1.7 9.24266L0.757192 8.29986L6.49513 2.56192Z" fill="currentColor"></path></svg></span></a></p></div><div class="footerLinkCol_Pfs5"><p class="footerLink_Dz86"><a href="https://dfinity.org/grants" target="_blank" rel="noopener noreferrer" class="footer__link-item" style="color:white;font-weight:bold"><span class="lg:inline-flex items-center gap-1">Developer Grants<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_tdhU" viewBox="0 -2 12 10" xmlns="http://www.w3.org/2000/svg"><path d="M6.49513 2.56192L1.4379 2.56192L1.4379 1.22879H8.77107V8.56196L7.43794 8.56196L7.43794 3.50473L1.7 9.24266L0.757192 8.29986L6.49513 2.56192Z" fill="currentColor"></path></svg></span></a></p><p class="footerLink_Dz86"><a href="https://support.dfinity.org/hc/en-us" target="_blank" rel="noopener noreferrer" class="footer__link-item" style="color:white;font-weight:bold"><span class="lg:inline-flex items-center gap-1">Support &amp; Feedback<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_tdhU" viewBox="0 -2 12 10" xmlns="http://www.w3.org/2000/svg"><path d="M6.49513 2.56192L1.4379 2.56192L1.4379 1.22879H8.77107V8.56196L7.43794 8.56196L7.43794 3.50473L1.7 9.24266L0.757192 8.29986L6.49513 2.56192Z" fill="currentColor"></path></svg></span></a></p><p class="footerLink_Dz86"><a href="https://dfinity.frontify.com/d/pD7yZhsmpqos" target="_blank" rel="noopener noreferrer" class="footer__link-item" style="color:white;font-weight:bold"><span class="lg:inline-flex items-center gap-1">Brand Materials<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_tdhU" viewBox="0 -2 12 10" xmlns="http://www.w3.org/2000/svg"><path d="M6.49513 2.56192L1.4379 2.56192L1.4379 1.22879H8.77107V8.56196L7.43794 8.56196L7.43794 3.50473L1.7 9.24266L0.757192 8.29986L6.49513 2.56192Z" fill="currentColor"></path></svg></span></a></p><p class="footerLink_Dz86"><a href="https://dfinity.frontify.com/d/pD7yZhsmpqos/press-kit" target="_blank" rel="noopener noreferrer" class="footer__link-item" style="color:white;font-weight:bold"><span class="lg:inline-flex items-center gap-1">Press Kit<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_tdhU" viewBox="0 -2 12 10" xmlns="http://www.w3.org/2000/svg"><path d="M6.49513 2.56192L1.4379 2.56192L1.4379 1.22879H8.77107V8.56196L7.43794 8.56196L7.43794 3.50473L1.7 9.24266L0.757192 8.29986L6.49513 2.56192Z" fill="currentColor"></path></svg></span></a></p></div><div class="text-white md:max-w-[40%] md:ml-auto md:mt-0 flex flex-col items-start"><div class="mediaLinksContainer_NPBq"><div class="mediaLinks_IgUQ"><a href="https://twitter.com/dfinity" target="_blank" rel="noopener noreferrer" aria-label="Go to X"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIKICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZpZXdCb3g9IjAgMCAzMDAgMzAwLjMiIHhtbDpzcGFjZT0icHJlc2VydmUiPgogIDxwYXRoIGQ9Ik0xNzEuNCwxMzIuOUwyNTUsMzcuN2gtMTkuOGwtNzIuNyw4Mi43bC01OC04Mi43SDM3LjdsODcuNywxMjVsLTg3LjcsOTkuOGgxOS44bDc2LjctODcuM2w2MS4zLDg3LjNoNjYuOSBNNjQuNiw1Mi4zaDMwLjQKCWwxNDAuMSwxOTYuM2gtMzAuNSIgZmlsbD0id2hpdGUiIC8+Cjwvc3ZnPgo=" alt="X" loading="lazy"></a></div><div class="mediaLinks_IgUQ"><a href="https://t.me/+m8tiEFaaNR8xNjNl" target="_blank" rel="noopener noreferrer" aria-label="Go to Telegram"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzEwNzFfMTk4MTM3KSI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjQgMTJDMjQgMTguNjI3NCAxOC42Mjc0IDI0IDEyIDI0QzUuMzcyNTggMjQgMCAxOC42Mjc0IDAgMTJDMCA1LjM3MjU4IDUuMzcyNTggMCAxMiAwQzE4LjYyNzQgMCAyNCA1LjM3MjU4IDI0IDEyWk0xMi40MzAxIDguODU3NTlDMTEuMjYzIDkuMzQzMDYgOC45MzAyNiAxMC4zNDc5IDUuNDMyMDEgMTEuODcyQzQuODYzOTUgMTIuMDk3OSA0LjU2NjM4IDEyLjMxODkgNC41MzkyOSAxMi41MzVDNC40OTM1MSAxMi45MDAyIDQuOTUwODQgMTMuMDQ0IDUuNTczNiAxMy4yMzk4QzUuNjU4MzEgMTMuMjY2NCA1Ljc0NjA4IDEzLjI5NCA1LjgzNjA2IDEzLjMyMzNDNi40NDg3NiAxMy41MjI0IDcuMjcyOTUgMTMuNzU1NCA3LjcwMTQxIDEzLjc2NDdDOC4wOTAwNyAxMy43NzMxIDguNTIzODUgMTMuNjEyOSA5LjAwMjc2IDEzLjI4NEMxMi4yNzEzIDExLjA3NzcgMTMuOTU4NSA5Ljk2MjQ3IDE0LjA2NDQgOS45Mzg0M0MxNC4xMzkyIDkuOTIxNDcgMTQuMjQyNyA5LjkwMDE0IDE0LjMxMjkgOS45NjI1MUMxNC4zODMxIDEwLjAyNDkgMTQuMzc2MiAxMC4xNDMgMTQuMzY4NyAxMC4xNzQ3QzE0LjMyMzQgMTAuMzY3OCAxMi41MjgyIDEyLjAzNjggMTEuNTk5MiAxMi45MDA0QzExLjMwOTYgMTMuMTY5NyAxMS4xMDQyIDEzLjM2MDcgMTEuMDYyMiAxMy40MDQzQzEwLjk2ODEgMTMuNTAyIDEwLjg3MjIgMTMuNTk0NCAxMC43ODAxIDEzLjY4MzNDMTAuMjEwOSAxNC4yMzIgOS43ODQwMyAxNC42NDM1IDEwLjgwMzcgMTUuMzE1NUMxMS4yOTM4IDE1LjYzODQgMTEuNjg1OSAxNS45MDU0IDEyLjA3NzEgMTYuMTcxOEMxMi41MDQzIDE2LjQ2MjcgMTIuOTMwNCAxNi43NTI5IDEzLjQ4MTcgMTcuMTE0M0MxMy42MjIyIDE3LjIwNjQgMTMuNzU2MyAxNy4zMDIgMTMuODg3IDE3LjM5NTJDMTQuMzg0MiAxNy43NDk2IDE0LjgzMDkgMTguMDY4MSAxNS4zODI3IDE4LjAxNzNDMTUuNzAzNCAxNy45ODc4IDE2LjAzNDYgMTcuNjg2MyAxNi4yMDI4IDE2Ljc4N0MxNi42MDAzIDE0LjY2MTggMTcuMzgxNyAxMC4wNTcxIDE3LjU2MjMgOC4xNTk2M0MxNy41NzgyIDcuOTkzMzkgMTcuNTU4MyA3Ljc4MDYzIDE3LjU0MjMgNy42ODcyM0MxNy41MjYzIDcuNTkzODQgMTcuNDkyOSA3LjQ2MDc3IDE3LjM3MTUgNy4zNjIyNkMxNy4yMjc3IDcuMjQ1NTkgMTcuMDA1OCA3LjIyMDk5IDE2LjkwNjUgNy4yMjI3NEMxNi40NTUxIDcuMjMwNjkgMTUuNzYyNyA3LjQ3MTQ3IDEyLjQzMDEgOC44NTc1OVoiIGZpbGw9IndoaXRlIi8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTA3MV8xOTgxMzciPgo8cmVjdCB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==" alt="Telegram" loading="lazy"></a></div><div class="mediaLinks_IgUQ"><a href="https://medium.com/dfinity-network-blog" target="_blank" rel="noopener noreferrer" aria-label="Go to Medium"><img src="data:image/svg+xml,%3Csvg width=&#x27;24px&#x27; height=&#x27;24px&#x27; viewBox=&#x27;0 0 24 24&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%3E%3Cpath fill=&#x27;white&#x27; d=&#x27;m24 24h-24v-24h24zm-8.986-15.006v7.326c0 .198 0 .234-.127.362l-1.302 1.264v.27h6.32v-.27l-1.257-1.234c-.091-.07-.148-.178-.148-.3 0-.022.002-.043.005-.064v.002-9.07c-.003-.019-.005-.04-.005-.062 0-.121.058-.229.148-.298l.001-.001 1.286-1.234v-.27h-4.456l-3.176 7.924-3.609-7.924h-4.675v.271l1.502 1.813c.127.115.207.281.207.466 0 .022-.001.043-.003.064v-.003 7.126c.007.041.011.088.011.136 0 .222-.088.423-.231.571l-1.69 2.054v.27h4.8v-.27l-1.691-2.054c-.149-.154-.241-.363-.241-.595 0-.04.003-.079.008-.117v.004-6.16l4.215 9.195h.49z&#x27;/%3E%3C/svg%3E" alt="Medium" loading="lazy"></a></div><div class="mediaLinks_IgUQ"><a href="https://www.youtube.com/dfinity" target="_blank" rel="noopener noreferrer" aria-label="Go to Youtube"><img src="data:image/svg+xml,%3C%3Fxml version=&#x27;1.0&#x27; encoding=&#x27;iso-8859-1&#x27;%3F%3E%3C!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --%3E%3Csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; xmlns:xlink=&#x27;http://www.w3.org/1999/xlink&#x27; x=&#x27;0px&#x27; y=&#x27;0px&#x27; width=&#x27;24&#x27; height=&#x27;24&#x27; viewBox=&#x27;0 0 310 310&#x27; style=&#x27;enable-background:new 0 0 310 310;&#x27; xml:space=&#x27;preserve&#x27;%3E%3Cg id=&#x27;XMLID_822_&#x27;%3E%3Cpath id=&#x27;XMLID_823_&#x27; fill=&#x27;white&#x27; d=&#x27;M297.917,64.645c-11.19-13.302-31.85-18.728-71.306-18.728H83.386c-40.359,0-61.369,5.776-72.517,19.938 C0,79.663,0,100.008,0,128.166v53.669c0,54.551,12.896,82.248,83.386,82.248h143.226c34.216,0,53.176-4.788,65.442-16.527 C304.633,235.518,310,215.863,310,181.835v-53.669C310,98.471,309.159,78.006,297.917,64.645z M199.021,162.41l-65.038,33.991 c-1.454,0.76-3.044,1.137-4.632,1.137c-1.798,0-3.592-0.484-5.181-1.446c-2.992-1.813-4.819-5.056-4.819-8.554v-67.764 c0-3.492,1.822-6.732,4.808-8.546c2.987-1.814,6.702-1.938,9.801-0.328l65.038,33.772c3.309,1.718,5.387,5.134,5.392,8.861 C204.394,157.263,202.325,160.684,199.021,162.41z&#x27;/%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3Cg%3E%3C/g%3E%3C/svg%3E%0A" alt="Youtube" loading="lazy"></a></div><div class="mediaLinks_IgUQ"><a href="https://www.reddit.com/r/dfinity/" target="_blank" rel="noopener noreferrer" aria-label="Go to Reddit"><img src="data:image/svg+xml,%3Csvg width=&#x27;24px&#x27; height=&#x27;24px&#x27; viewBox=&#x27;0 0 24 24&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%3E%3Cg%3E%3Cpath fill=&#x27;none&#x27; d=&#x27;M0 0h24v24H0z&#x27;/%3E%3Cpath fill-rule=&#x27;nonzero&#x27; fill=&#x27;white&#x27; d=&#x27;M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm6.67-10a1.46 1.46 0 0 0-2.47-1 7.12 7.12 0 0 0-3.85-1.23L13 6.65l2.14.45a1 1 0 1 0 .13-.61L12.82 6a.31.31 0 0 0-.37.24l-.74 3.47a7.14 7.14 0 0 0-3.9 1.23 1.46 1.46 0 1 0-1.61 2.39 2.87 2.87 0 0 0 0 .44c0 2.24 2.61 4.06 5.83 4.06s5.83-1.82 5.83-4.06a2.87 2.87 0 0 0 0-.44 1.46 1.46 0 0 0 .81-1.33zm-10 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0zm5.81 2.75a3.84 3.84 0 0 1-2.47.77 3.84 3.84 0 0 1-2.47-.77.27.27 0 0 1 .38-.38A3.27 3.27 0 0 0 12 16a3.28 3.28 0 0 0 2.09-.61.28.28 0 1 1 .39.4v-.04zm-.18-1.71a1 1 0 1 1 1-1 1 1 0 0 1-1.01 1.04l.01-.04z&#x27;/%3E%3C/g%3E%3C/svg%3E%0A" alt="Reddit" loading="lazy"></a></div><div class="mediaLinks_IgUQ"><a href="https://coinmarketcap.com/currencies/internet-computer/" target="_blank" rel="noopener noreferrer" aria-label="Go to CoinMarketCap"><img src="data:image/svg+xml,%3Csvg width=&#x27;24&#x27; height=&#x27;24&#x27; viewBox=&#x27;0 0 24 24&#x27; fill=&#x27;none&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%3E%3Cpath d=&#x27;M20.1307 14.3432C19.9566 14.4632 19.7533 14.534 19.5423 14.5481C19.3313 14.5623 19.1204 14.5193 18.9318 14.4237C18.489 14.1735 18.2504 13.587 18.2504 12.7878V10.3382C18.2504 9.16231 17.7846 8.32567 17.0055 8.09854C15.6887 7.71328 14.7054 9.32619 14.3259 9.93283L11.9971 13.702V9.10193C11.9712 8.04104 11.6262 7.40565 10.9736 7.21589C10.5423 7.08939 9.89545 7.14114 9.26581 8.10141L4.05907 16.4592C3.36629 15.1338 3.00708 13.6594 3.01255 12.1639C3.01255 7.12676 7.03764 3.0298 11.9971 3.0298C16.9566 3.0298 20.9961 7.12676 20.9961 12.1639V12.1898C20.9961 12.1898 20.9961 12.207 20.9961 12.2156C21.045 13.1903 20.7287 13.9665 20.1336 14.3432H20.1307ZM23.0058 12.1668V12.1179C22.9655 5.97961 18.0434 1 11.9971 1C5.95086 1 1 6.00836 1 12.1639C1 18.3194 5.93361 23.3306 11.9971 23.3306C14.7781 23.3305 17.4533 22.2645 19.4723 20.3521C19.6683 20.1674 19.7836 19.913 19.7933 19.6439C19.803 19.3748 19.7062 19.1128 19.524 18.9145C19.4369 18.8181 19.3315 18.7399 19.2139 18.6843C19.0964 18.6287 18.969 18.597 18.8392 18.5908C18.7093 18.5847 18.5795 18.6043 18.4572 18.6485C18.335 18.6927 18.2227 18.7606 18.1268 18.8484C17.2575 19.673 16.2306 20.3133 15.1077 20.7311C13.9848 21.1489 12.7891 21.3355 11.5923 21.2796C10.3955 21.2238 9.22229 20.9267 8.14317 20.4061C7.06406 19.8856 6.10127 19.1523 5.3126 18.2504L9.99895 10.7177V14.1937C9.99895 15.8641 10.6458 16.4046 11.1892 16.5627C11.7326 16.7209 12.5635 16.6116 13.4347 15.1971L16.0222 11.0081C16.1027 10.873 16.1803 10.758 16.2493 10.6573V12.7878C16.2493 14.3489 16.8761 15.5967 17.9744 16.212C18.4738 16.4816 19.0365 16.6118 19.6036 16.5891C20.1707 16.5663 20.7212 16.3914 21.1973 16.0826C22.4049 15.2977 23.0633 13.8774 22.9943 12.1668H23.0058Z&#x27; fill=&#x27;white&#x27;/%3E%3C/svg%3E%0A" alt="CoinMarketCap" loading="lazy"></a></div><div class="mediaLinks_IgUQ"><a href="https://dscvr.one/p/internet-computer" target="_blank" rel="noopener noreferrer" aria-label="Go to DSCVR"><img src="data:image/svg+xml,%3Csvg width=&#x27;24&#x27; height=&#x27;24&#x27; viewBox=&#x27;0 0 24 24&#x27; fill=&#x27;none&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%3E%3Cg clip-path=&#x27;url(%23clip0_4579_44749)&#x27;%3E%3Cpath d=&#x27;M15.5569 1.39645C14.4968 1.02636 13.3839 0.817527 12.2604 0.783161C12.1388 0.780518 12.0172 0.780518 11.8983 0.780518C11.1766 0.780518 10.4576 0.859822 9.75439 1.01579C9.74144 1.02293 9.72901 1.03006 9.71606 1.0372C9.72796 1.03006 9.73959 1.02293 9.75175 1.01579C6.75138 1.69252 4.52555 3.79675 3.4285 6.9055C2.38961 10.1438 3.2276 13.694 5.6041 16.1287C8.60183 19.1978 13.6403 20.0675 16.8654 16.8398C16.8659 16.8382 16.8667 16.8366 16.8673 16.835C19.6041 14.0934 19.6025 9.65051 16.8628 6.90815C14.1558 4.2012 11.0444 4.41004 7.84314 6.06751L7.64488 6.17061L7.81142 11.2831C7.82305 11.2485 7.83548 11.2157 7.84843 11.184C7.8368 11.217 7.82517 11.2498 7.81406 11.2831L7.91452 14.3787L8.01761 14.4765C8.8556 15.288 9.75439 15.563 10.5897 15.7427L10.4681 8.04485C10.4465 8.05542 10.4253 8.06653 10.4039 8.07763C10.425 8.0652 10.4465 8.05331 10.4681 8.04221C12.2974 7.44742 14.2087 7.82808 15.4115 9.43533C15.4136 9.43691 15.4154 9.4385 15.4176 9.44009C16.4295 10.7957 16.5736 12.6144 15.7869 14.1117C14.1214 17.2997 9.34201 17.1226 7.02101 14.7488C5.8896 13.5909 5.18114 12.0815 5.0146 10.4689C4.69209 7.41305 6.34164 4.48934 9.12524 3.18874L9.53234 3.06979C10.3042 2.86095 11.0999 2.75785 11.8983 2.75785C16.9341 2.75521 21.0157 6.83413 21.021 11.8673C21.021 13.3794 20.6456 14.8677 19.9292 16.1974C19.9168 16.222 19.9041 16.246 19.8917 16.2706C19.4777 17.0243 18.9577 17.7134 18.3484 18.3228C15.4009 21.2676 10.8329 21.7699 7.18227 19.8798C2.66982 17.5456 0.938326 12.285 2.46891 7.55845C2.56672 7.25709 2.41604 6.93194 2.12261 6.81034L2.03538 6.77333L1.89263 7.07469C1.73402 7.40777 1.58863 7.74878 1.46438 8.09772C-0.621338 13.8685 2.36582 20.234 8.13657 22.3197C8.17094 22.333 8.2053 22.3435 8.24231 22.3567C8.34303 22.3758 8.44348 22.3935 8.54393 22.4107C8.44216 22.3938 8.33986 22.376 8.23702 22.3567C14.0263 24.3764 20.3548 21.3231 22.3771 15.5365C24.3967 9.74726 21.3435 3.41873 15.5569 1.39645Z&#x27; fill=&#x27;white&#x27;/%3E%3C/g%3E%3Cdefs%3E%3CclipPath id=&#x27;clip0_4579_44749&#x27;%3E%3Crect width=&#x27;22.2001&#x27; height=&#x27;22.199&#x27; fill=&#x27;white&#x27; transform=&#x27;translate(0.799805 0.780518)&#x27;/%3E%3C/clipPath%3E%3C/defs%3E%3C/svg%3E%0A" alt="DSCVR" loading="lazy"></a></div></div><form class="mt-10" method="post" action="https://dfinity.us16.list-manage.com/subscribe/post?u=33c727489e01ff5b6e1fb6cc6&amp;id=7e9469a315&amp;f_id=00bac2e1f0"><p class="tw-lead-sm mb-3 md:mb-5">Sign up for email updates to keep up to date with advancements on the Internet Computer</p><div class="flex gap-3 flex-col md:flex-row items-start"><input type="email" name="EMAIL" placeholder="Email" class="input-text input-text-white flex-1 w-full md:w-auto" required=""><button type="submit" class="button-white">Get Updates!</button></div></form></div></div><div class="footerBottom_SMHg"><div class="legalContainer_YyR4"><div class="legalLinkContainer_v7Sk"><div class="legalLink_o9EZ"><a href="https://dfinity.org/privacy-policy" target="_blank" rel="noopener noreferrer" style="color:white;font-weight:bold">Privacy Policy</a></div><div class="legalLink_o9EZ"><a href="https://dfinity.org/terms-of-use" target="_blank" rel="noopener noreferrer" style="color:white;font-weight:bold">Terms of Use</a></div></div><div class="legalCopyright__Eqq" style="color:white">Â© 2025 Internet Computer</div></div></div><div class="footerPadding_WXgF"></div></footer></div></div>
<script src="/assets/js/runtime~main.f7a52105.js"></script>
<script src="/assets/js/main.bcdc8cdd.js"></script>
</body>
</html>