<!DOCTYPE html><html lang="en"><head><link rel="stylesheet" href="/css/live-blocks.css"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="IE=edge"><meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="description" content="Policy-based control for cloud native environments"><meta property="og:title" content="Introduction"><meta property="og:type" content="documentation"><meta property="og:url" content="https://www.openpolicyagent.org/docs/latest/"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="Open Policy Agent"><meta property="og:description" content="Policy-based control for cloud native environments"><meta name="og:type" content="article"><meta name="og:image" content="https://www.openpolicyagent.org/img/logos/opa-horizontal-color.png"><meta name="og:image:alt" content="Open Policy Agent project logo"><meta name="og:image:type" content="image/png"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@OpenPolicyAgent"><meta name="twitter:creator" content="@OpenPolicyAgent"><link rel="canonical" href="https://www.openpolicyagent.org/docs/latest/"><link rel="shortcut icon" href="/favicon.png" type="image/x-icon"><meta name="docsearch:language" content="en"><meta name="docsearch:version" content="latest"><meta name="generator" content="Hugo 0.113.0"><title>Open Policy Agent | Documentation</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.7.0/tocbot.css"><link rel="stylesheet" href="/css/style.6bfc8ac65b350366ac556d88070754f8cd75095d9358a81278335facc4ec7e64.css" integrity="sha256-a/yKxls1A2asVW2IBwdU+M11CV2TWKgSeDNfrMTsfmQ="><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JNBNV64PDX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JNBNV64PDX');
</script>
</head><body><div class="dashboard-wrapper"><div class="dashboard"><div class="dashboard-panel left has-background-white-bis is-hidden-touch"><div class="dashboard-panel-header has-text-centered"><div class="dashboard-panel-header-logo"><a href="https://www.openpolicyagent.org"><img src="/img/logos/opa-horizontal-color.png"></a></div><div class="dropdown is-left"><div class="dropdown-trigger"><button class="button is-dark" aria-haspopup="true" aria-controls="dropdown-menu">
<span><strong>v1.0.0</strong></span>
<span class="tag latest-tag is-success is-small has-text-weight-bold">latest</span>
<span class="icon is-small"><i class="fas fa-angle-down" aria-hidden="true"></i></span></button></div><div class="dropdown-menu"><div class="dropdown-content has-text-left"><a href="/docs/latest" class="dropdown-item">v1.0.0
<span class="tag latest-tag is-success is-small has-text-weight-bold">latest</span></a>
<a href="/docs/v0.70.0" class="dropdown-item">v0.70.0</a>
<a href="/docs/v0.69.0" class="dropdown-item">v0.69.0</a>
<a href="/docs/v0.68.0" class="dropdown-item">v0.68.0</a>
<a href="/docs/v0.67.1" class="dropdown-item">v0.67.1</a>
<a href="/docs/v0.66.0" class="dropdown-item">v0.66.0</a>
<a href="/docs/v0.65.0" class="dropdown-item">v0.65.0</a>
<a href="/docs/v0.64.1" class="dropdown-item">v0.64.1</a>
<a href="/docs/v0.63.0" class="dropdown-item">v0.63.0</a>
<a href="/docs/v0.62.1" class="dropdown-item">v0.62.1</a>
<a href="/docs/v0.61.0" class="dropdown-item">v0.61.0</a>
<a href="/docs/v0.60.0" class="dropdown-item">v0.60.0</a>
<a href="/docs/v0.59.0" class="dropdown-item">v0.59.0</a>
<a href="/docs/v0.58.0" class="dropdown-item">v0.58.0</a>
<a href="/docs/v0.57.1" class="dropdown-item">v0.57.1</a>
<a href="/docs/v0.56.0" class="dropdown-item">v0.56.0</a>
<a href="/docs/v0.55.0" class="dropdown-item">v0.55.0</a>
<a href="/docs/v0.54.0" class="dropdown-item">v0.54.0</a>
<a href="/docs/v0.53.1" class="dropdown-item">v0.53.1</a>
<a href="/docs/v0.52.0" class="dropdown-item">v0.52.0</a>
<a href="/docs/v0.51.0" class="dropdown-item">v0.51.0</a>
<a href="/docs/v0.50.2" class="dropdown-item">v0.50.2</a>
<a href="/docs/v0.49.2" class="dropdown-item">v0.49.2</a>
<a href="/docs/v0.48.0" class="dropdown-item">v0.48.0</a>
<a href="/docs/v0.47.4" class="dropdown-item">v0.47.4</a>
<a href="/docs/v0.46.3" class="dropdown-item">v0.46.3</a>
<a href="/docs/v0.45.0" class="dropdown-item">v0.45.0</a>
<a href="/docs/v0.44.0" class="dropdown-item">v0.44.0</a>
<a href="/docs/v0.43.1" class="dropdown-item">v0.43.1</a>
<a href="/docs/v0.42.2" class="dropdown-item">v0.42.2</a>
<a href="/docs/v0.41.0" class="dropdown-item">v0.41.0</a>
<a href="/docs/v0.40.0" class="dropdown-item">v0.40.0</a>
<a href="/docs/v0.39.0" class="dropdown-item">v0.39.0</a>
<a href="/docs/v0.38.1" class="dropdown-item">v0.38.1</a>
<a href="/docs/v0.37.2" class="dropdown-item">v0.37.2</a>
<a href="/docs/v0.36.1" class="dropdown-item">v0.36.1</a>
<a href="/docs/v0.35.0" class="dropdown-item">v0.35.0</a>
<a href="/docs/v0.34.2" class="dropdown-item">v0.34.2</a>
<a href="/docs/v0.33.1" class="dropdown-item">v0.33.1</a>
<a href="/docs/v0.32.1" class="dropdown-item">v0.32.1</a>
<a href="/docs/v0.31.0" class="dropdown-item">v0.31.0</a>
<a href="/docs/v0.30.2" class="dropdown-item">v0.30.2</a>
<a href="/docs/v0.29.4" class="dropdown-item">v0.29.4</a>
<a href="/docs/v0.28.0" class="dropdown-item">v0.28.0</a>
<a href="/docs/v0.27.1" class="dropdown-item">v0.27.1</a>
<a href="/docs/v0.26.0" class="dropdown-item">v0.26.0</a>
<a href="/docs/v0.25.2" class="dropdown-item">v0.25.2</a>
<a href="/docs/v0.24.0" class="dropdown-item">v0.24.0</a>
<a href="/docs/v0.23.2" class="dropdown-item">v0.23.2</a>
<a href="/docs/v0.22.0" class="dropdown-item">v0.22.0</a>
<a href="/docs/v0.21.1" class="dropdown-item">v0.21.1</a>
<a href="/docs/v0.20.5" class="dropdown-item">v0.20.5</a>
<a href="/docs/v0.19.2" class="dropdown-item">v0.19.2</a>
<a href="/docs/v0.18.0" class="dropdown-item">v0.18.0</a>
<a href="/docs/v0.17.3" class="dropdown-item">v0.17.3</a>
<a href="/docs/v0.16.2" class="dropdown-item">v0.16.2</a>
<a href="/docs/v0.15.1" class="dropdown-item">v0.15.1</a>
<a href="/docs/v0.14.2" class="dropdown-item">v0.14.2</a>
<a href="/docs/v0.13.5" class="dropdown-item">v0.13.5</a>
<a href="/docs/v0.12.2" class="dropdown-item">v0.12.2</a>
<a href="/docs/v0.11.0" class="dropdown-item">v0.11.0</a>
<a href="/docs/edge" class="dropdown-item">edge</a></div></div></div></div><div class="dashboard-panel-content is-scrollable"><span class="docs-nav-title">Core Docs</span>
<a class="docs-nav-item is-active" href="/docs/latest">Introduction</a><div class="toc"><nav id="TableOfContents"><ul><li><a href="#overview">Overview</a></li><li><a href="#example">Example</a></li><li><a href="#rego">Rego</a><ul><li><a href="#references">References</a></li><li><a href="#expressions-logical-and">Expressions (Logical AND)</a></li><li><a href="#variables">Variables</a></li><li><a href="#iteration">Iteration</a></li><li><a href="#rules">Rules</a></li><li><a href="#putting-it-together">Putting It Together</a></li></ul></li><li><a href="#running-opa">Running OPA</a><ul><li><a href="#1-download-opa">1. Download OPA</a></li><li><a href="#2-try-opa-eval">2. Try <code>opa eval</code></a></li><li><a href="#3-try-opa-run-interactive">3. Try <code>opa run</code> (interactive)</a></li><li><a href="#4-try-opa-run-server">4. Try <code>opa run</code> (server)</a></li><li><a href="#5-try-opa-as-a-go-library">5. Try OPA as a Go library</a></li></ul></li><li><a href="#next-steps">Next Steps</a></li></ul></nav></div><a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/philosophy/">Philosophy</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/policy-language/">Policy Language</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/policy-reference/">Policy Reference</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/policy-testing/">Policy Testing</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/policy-performance/">Policy Performance</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/external-data/">External Data</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/integration/">Integrating OPA</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/extensions/">Extending OPA</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/debugging/">Debugging OPA</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/rest-api/">REST API</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/cli/">CLI</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/ir/">Intermediate Representation (IR)</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/wasm/">WebAssembly</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/v0-compatibility/">v0 Backwards Compatibility</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/v0-upgrade/">Upgrading to v1.0</a><hr class="docs-nav-hr"><span class="docs-nav-title">Kubernetes</span>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/kubernetes-introduction/">Overview &amp; Architecture</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/kubernetes-primer/">Policy Primer via Examples</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/kubernetes-tutorial/">Tutorial: Ingress Validation</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/kubernetes-debugging/">Debugging Tips</a><hr class="docs-nav-hr"><span class="docs-nav-title">Envoy</span>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/envoy-introduction/">Overview &amp; Architecture</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/envoy-primer/">Policy Primer via Examples</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/envoy-tutorial-standalone-envoy/">Tutorial: Standalone Envoy</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/envoy-tutorial-gloo-edge/">Tutorial: Gloo Edge</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/envoy-tutorial-istio/">Tutorial: Istio</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/envoy-performance/">Performance</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/envoy-debugging/">Debugging Tips</a><hr class="docs-nav-hr"><span class="docs-nav-title">Other Use Cases</span>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/aws-cloudformation-hooks/">AWS CloudFormation Hooks</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/docker-authorization/">Docker</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/graphql-api-authorization/">GraphQL APIs</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/http-api-authorization/">HTTP APIs</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/kafka-authorization/">Kafka</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/ssh-and-sudo-authorization/">SSH and sudo</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/terraform/">Terraform</a><hr class="docs-nav-hr"><span class="docs-nav-title">Operations</span>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/configuration/">Configuration</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/deployments/">Deployment</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/monitoring/">Monitoring</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/security/">Security</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/privacy/">Privacy</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/storage/">Storage</a><hr class="docs-nav-hr"><span class="docs-nav-title">Management APIs</span>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/management-introduction/">Overview &amp; Architecture</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/management-bundles/">Bundles</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/management-decision-logs/">Decision Logs</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/management-status/">Status</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/management-discovery/">Discovery</a><hr class="docs-nav-hr"><span class="docs-nav-title">Contributing</span>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/contributing/">How to contribute</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/contrib-docs/">Contributing Docs</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/contrib-code/">Contributing Code</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/contrib-development/">Development</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/contrib-adding-builtin-functions/">Adding Built-in Functions</a><hr class="docs-nav-hr"><span class="docs-nav-title">Miscellaneous</span>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/oauth-oidc/">OAuth2 and OIDC Samples</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/editor-and-ide-support/">Editor and IDE Support</a>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/comparison-to-other-systems/">Comparison to Other Systems</a><hr class="docs-nav-hr"><span class="docs-nav-title">Support</span>
<a class="docs-nav-item" href="https://www.openpolicyagent.org/docs/latest/faq/">FAQ</a>
<a class="docs-nav-item" href="/ecosystem">OPA Ecosystem</a>
<a class="docs-nav-item" href="/support">Enterprise</a></div></div><div class="dashboard-main is-scrollable"><nav class="navbar is-primary"><div class="navbar-brand is-hidden-desktop"><a class="navbar-item" href="https://www.openpolicyagent.org"><img src="/img/logos/opa-icon-white.png"></a>
<a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="mobile-menu"><span aria-hidden="true"></span>
<span aria-hidden="true"></span>
<span aria-hidden="true"></span></a></div><div class="navbar-menu is-hidden-desktop" id="mobile-menu"><div class="navbar-start"><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Core Docs</span>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/">Introduction</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/philosophy/">Philosophy</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/policy-language/">Policy Language</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/policy-reference/">Policy Reference</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/policy-testing/">Policy Testing</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/policy-performance/">Policy Performance</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/external-data/">External Data</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/integration/">Integrating OPA</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/extensions/">Extending OPA</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/debugging/">Debugging OPA</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/rest-api/">REST API</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/cli/">CLI</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/ir/">Intermediate Representation (IR)</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/wasm/">WebAssembly</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/v0-compatibility/">v0 Backwards Compatibility</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/v0-upgrade/">Upgrading to v1.0</a><br><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Kubernetes</span>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/kubernetes-introduction/">Overview &amp; Architecture</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/kubernetes-primer/">Policy Primer via Examples</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/kubernetes-tutorial/">Tutorial: Ingress Validation</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/kubernetes-debugging/">Debugging Tips</a><br><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Envoy</span>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/envoy-introduction/">Overview &amp; Architecture</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/envoy-primer/">Policy Primer via Examples</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/envoy-tutorial-standalone-envoy/">Tutorial: Standalone Envoy</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/envoy-tutorial-gloo-edge/">Tutorial: Gloo Edge</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/envoy-tutorial-istio/">Tutorial: Istio</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/envoy-performance/">Performance</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/envoy-debugging/">Debugging Tips</a><br><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Other Use Cases</span>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/aws-cloudformation-hooks/">AWS CloudFormation Hooks</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/docker-authorization/">Docker</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/graphql-api-authorization/">GraphQL APIs</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/http-api-authorization/">HTTP APIs</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/kafka-authorization/">Kafka</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/ssh-and-sudo-authorization/">SSH and sudo</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/terraform/">Terraform</a><br><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Operations</span>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/configuration/">Configuration</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/deployments/">Deployment</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/monitoring/">Monitoring</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/security/">Security</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/privacy/">Privacy</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/storage/">Storage</a><br><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Management APIs</span>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/management-introduction/">Overview &amp; Architecture</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/management-bundles/">Bundles</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/management-decision-logs/">Decision Logs</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/management-status/">Status</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/management-discovery/">Discovery</a><br><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Contributing</span>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/contributing/">How to contribute</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/contrib-docs/">Contributing Docs</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/contrib-code/">Contributing Code</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/contrib-development/">Development</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/contrib-adding-builtin-functions/">Adding Built-in Functions</a><br><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Miscellaneous</span>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/oauth-oidc/">OAuth2 and OIDC Samples</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/editor-and-ide-support/">Editor and IDE Support</a>
<a class="navbar-item" href="https://www.openpolicyagent.org/docs/latest/comparison-to-other-systems/">Comparison to Other Systems</a><br><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Support</span>
<a class="navbar-item" href="/support">Enterprise</a>
<a class="navbar-item" href="/community">Community</a>
<a class="navbar-item" href="/ecosystem">OPA Ecosystem</a></div><div class="navbar-end"><div class="navbar-item"><div class="buttons"><a class="button is-primary" href="https://github.com/open-policy-agent/opa" target="_blank"><span class="icon has-text-white-bis"><i class="fab fa-github"></i></span></a>
<a class="button is-primary" href="https://github.com/open-policy-agent/feedback/discussions" target="_blank"><span class="icon has-text-white-bis"><i class="fas fa-comments"></i></span></a>
<a class="button is-primary" href="https://twitter.com/OpenPolicyAgent" target="_blank"><span class="icon has-text-white-bis"><i class="fab fa-twitter"></i></span></a>
<a class="button is-primary" href="https://blog.openpolicyagent.org" target="_blank"><span class="icon has-text-white-bis"><i class="fab fa-medium"></i></span></a>
<a class="button is-primary" href="https://slack.openpolicyagent.org" target="_blank"><span class="icon has-text-white-bis"><i class="fab fa-slack"></i></span></a></div></div></div></div><div class="navbar-menu"><div class="navbar-end"><div class="navbar-item"><p class="control has-icons-right"></p><div id="docsearch"></div><span class="icon is-small is-right"><icon></icon></span><p></p></div><div class="navbar-item"><a class="button is-success has-text-weight-semibold" href="https://play.openpolicyagent.org/" target="_blank" title="Playground">Playground</a></div><a class="navbar-item" href="https://github.com/open-policy-agent/opa" target="_blank" title="GitHub"><span class="icon has-text-white-bis"><i class="fab fa-github"></i></span></a>
<a class="navbar-item" href="https://github.com/open-policy-agent/feedback/discussions" target="_blank" title="GitHub Discussions"><span class="icon has-text-white-bis"><i class="fas fa-comments"></i></span></a>
<a class="navbar-item" href="https://twitter.com/OpenPolicyAgent" target="_blank" title="Twitter"><span class="icon has-text-white-bis"><i class="fab fa-twitter"></i></span></a>
<a class="navbar-item" href="https://blog.openpolicyagent.org" target="_blank" title="Medium"><span class="icon has-text-white-bis"><i class="fab fa-medium"></i></span></a>
<a class="navbar-item" href="https://slack.openpolicyagent.org" target="_blank" title="Slack"><span class="icon has-text-white-bis"><i class="fab fa-slack"></i></span></a></div></div></nav><article class="article"><div class="container"><section class="hero"><div class="hero-body"><span class="title is-size-1 is-size-2-mobile">Introduction</span>
<span class="icon has-text-white-bis is-size-4 is-size-5-mobile icon-edit"><a href="https://github.com/open-policy-agent/opa/edit/main/docs/content/_index.md" target="_blank"><i class="fab fa-github"></i>
<span>Edit</span></a></span><hr></div></section><section class="section"><div class="content"><p>The Open Policy Agent (OPA, pronounced ‚Äúoh-pa‚Äù) is an open source,
general-purpose policy engine that unifies policy enforcement across the stack.
OPA provides a high-level declarative language that lets you specify policy as
code and simple APIs to offload policy decision-making from your software. You
can use OPA to enforce policies in microservices, Kubernetes, CI/CD pipelines,
API gateways, and more.</p><p>OPA was originally created by <a href="https://www.styra.com">Styra</a> and is proud to be
a graduated project in the <a href="https://www.cncf.io/">Cloud Native Computing Foundation
(CNCF)</a> landscape. For details read the CNCF
<a href="https://www.cncf.io/announcements/2021/02/04/cloud-native-computing-foundation-announces-open-policy-agent-graduation/">announcement</a>.</p><p>Read this page to learn about the core concepts in OPA‚Äôs policy language
(<a href="policy-language">Rego</a>) as well as how to download, run, and integrate OPA.</p><h2 id="overview">Overview</h2><p>OPA <a href="philosophy#policy-decoupling">decouples</a> policy decision-making from policy
enforcement. When your software needs to make policy decisions it <strong>queries</strong>
OPA and supplies structured data (e.g., JSON) as input. OPA accepts arbitrary
structured data as input.</p><figure class="figure"><img src="/docs/latest/images/opa-service.svg" width="65%"><figcaption class="has-text-weight-light">Policy Decoupling</figcaption></figure><p>OPA generates policy decisions by evaluating the query input against
policies and data. OPA and Rego are domain-agnostic so you can describe almost
any kind of invariant in your policies. For example:</p><ul><li>Which users can access which resources.</li><li>Which subnets egress traffic is allowed to.</li><li>Which clusters a workload must be deployed to.</li><li>Which registries binaries can be downloaded from.</li><li>Which OS capabilities a container can execute with.</li><li>Which times of day the system can be accessed at.</li></ul><p>Policy decisions are not limited to simple yes/no or allow/deny answers. Like
query inputs, your policies can generate arbitrary structured data as output.</p><p>Let‚Äôs look at an example.</p><h2 id="example">Example</h2><p>Imagine you work for an organization with the following system:</p><figure class="figure"><img src="/docs/latest/images/system.svg" width="65%"><figcaption class="has-text-weight-light">Example System</figcaption></figure><p>There are three kinds of components in the system:</p><ul><li>Servers expose zero or more protocols (e.g., <code>http</code>, <code>ssh</code>, etc.)</li><li>Networks connect servers and can be public or private. Public networks are connected to the Internet.</li><li>Ports attach servers to networks.</li></ul><p>All the servers, networks, and ports are provisioned by a script. The script
receives a JSON representation of the system as input:</p><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example:input" data-lang="live:example:input">{
    "servers": [
        {"id": "app", "protocols": ["https", "ssh"], "ports": ["p1", "p2", "p3"]},
        {"id": "db", "protocols": ["mysql"], "ports": ["p3"]},
        {"id": "cache", "protocols": ["memcache"], "ports": ["p3"]},
        {"id": "ci", "protocols": ["http"], "ports": ["p1", "p2"]},
        {"id": "busybox", "protocols": ["telnet"], "ports": ["p1"]}
    ],
    "networks": [
        {"id": "net1", "public": false},
        {"id": "net2", "public": false},
        {"id": "net3", "public": true},
        {"id": "net4", "public": true}
    ],
    "ports": [
        {"id": "p1", "network": "net1"},
        {"id": "p2", "network": "net3"},
        {"id": "p3", "network": "net2"}
    ]
}</code></pre></div><p>Earlier in the day your boss told you about a new security policy that has to be
implemented:</p><pre tabindex="0"><code>1. Servers reachable from the Internet must not expose the insecure 'http' protocol.
2. Servers are not allowed to expose the 'telnet' protocol.
</code></pre><p>The policy needs to be enforced when servers, networks, and ports are
provisioned and the compliance team wants to periodically audit the system to
find servers that violate the policy.</p><p>Your boss has asked you to determine if OPA would be a good fit for implementing
the policy.</p><h2 id="rego">Rego</h2><p>OPA policies are expressed in a high-level declarative language called Rego.
Rego (pronounced ‚Äúray-go‚Äù) is purpose-built for expressing policies over complex
hierarchical data structures. For detailed information on Rego see the <a href="policy-language">Policy
Language</a> documentation.</p><article class="message is-info"><div class="message-body"><p>üí° The examples below are interactive! If you edit the input data above
containing servers, networks, and ports, the output will change below.
Similarly, if you edit the queries or rules in the examples below the output
will change. As you read through this section, try changing the input, queries,
and rules and observe the difference in output.</p><p>üíª They can also be run locally on your machine using the <a href="#running-opa"><code>opa eval</code> command, here are setup instructions.</a></p><p>Note that the examples in this section try to represent the best practices.
As such, they make use of keywords that are meant to become standard keywords
at some point in time, but have been introduced gradually.
<a href="./policy-language/#future-keywords">See the docs on <em>future keywords</em></a> for more information.</p></div></article><h3 id="references">References</h3><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/refs:module:hidden" data-lang="live:example/refs:module:hidden">package example</code></pre></div><p>When OPA evaluates policies it binds data provided in the query to a global
variable called <code>input</code>. You can refer to data in the input using the <code>.</code> (dot)
operator.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/refs/1:query:merge_down" data-lang="live:example/refs/1:query:merge_down">input.servers</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/refs/1:output" data-lang="live:example/refs/1:output">[
  {
    "id": "app",
    "ports": [
      "p1",
      "p2",
      "p3"
    ],
    "protocols": [
      "https",
      "ssh"
    ]
  },
  {
    "id": "db",
    "ports": [
      "p3"
    ],
    "protocols": [
      "mysql"
    ]
  },
  {
    "id": "cache",
    "ports": [
      "p3"
    ],
    "protocols": [
      "memcache"
    ]
  },
  {
    "id": "ci",
    "ports": [
      "p1",
      "p2"
    ],
    "protocols": [
      "http"
    ]
  },
  {
    "id": "busybox",
    "ports": [
      "p1"
    ],
    "protocols": [
      "telnet"
    ]
  }
]</code></pre></div><p>To refer to array elements you can use the familiar square-bracket syntax:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/refs/array:query:merge_down" data-lang="live:example/refs/array:query:merge_down">input.servers[0].protocols[0]</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/refs/array:output" data-lang="live:example/refs/array:output">"https"</code></pre></div><blockquote><p>üí° You can use the same square bracket syntax if keys contain other than
<code>[a-zA-Z0-9_]</code>. E.g., <code>input["foo~bar"]</code>.</p></blockquote><p>If you refer to a value that does not exist, OPA returns <em>undefined</em>. Undefined
means that OPA was not able to find any results.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/refs/undefined:query:merge_down" data-lang="live:example/refs/undefined:query:merge_down">input.deadbeef</code></pre></div><div class="live--block-container live--block-container--error">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/refs/undefined:output:expect_undefined" data-lang="live:example/refs/undefined:output:expect_undefined">undefined decision</code></pre></div><h3 id="expressions-logical-and">Expressions (Logical AND)</h3><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/exprs:module:hidden" data-lang="live:example/exprs:module:hidden">package example</code></pre></div><p>To produce policy decisions in Rego you write expressions against input and
other data.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/exprs/eq:query:merge_down" data-lang="live:example/exprs/eq:query:merge_down">input.servers[0].id == "app"</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/exprs/eq:output" data-lang="live:example/exprs/eq:output">true</code></pre></div><p>OPA includes a set of built-in functions you can use to perform common
operations like string manipulation, regular expression matching, arithmetic,
aggregation, and more.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/exprs/builtins:query:merge_down" data-lang="live:example/exprs/builtins:query:merge_down">count(input.servers[0].protocols) &gt;= 1</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/exprs/builtins:output" data-lang="live:example/exprs/builtins:output">true</code></pre></div><p>For a complete list of built-in functions supported in OPA out-of-the-box see
the <a href="./policy-reference">Policy Reference</a> page.</p><p>Multiple expressions are joined together with the <code>;</code> (AND) operator. For
queries to produce results, all of the expressions in the query must be true or
defined. The order of expressions does not matter.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/exprs/multi:query:merge_down" data-lang="live:example/exprs/multi:query:merge_down">input.servers[0].id == "app"; input.servers[0].protocols[0] == "https"</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/exprs/multi:output" data-lang="live:example/exprs/multi:output">true</code></pre></div><p>You can omit the <code>;</code> (AND) operator by splitting expressions across multiple
lines. The following query has the same meaning as the previous one:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/exprs/multi_line:query:merge_down" data-lang="live:example/exprs/multi_line:query:merge_down">input.servers[0].id == "app"
input.servers[0].protocols[0] == "https"</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/exprs/multi_line:output" data-lang="live:example/exprs/multi_line:output">true</code></pre></div><p>If any of the expressions in the query are not true (or defined) the result is
undefined. In the example below, the second expression is false:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/exprs/multi_undefined:query:merge_down" data-lang="live:example/exprs/multi_undefined:query:merge_down">input.servers[0].id == "app"
input.servers[0].protocols[0] == "telnet"</code></pre></div><div class="live--block-container live--block-container--error">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/exprs/multi_undefined:output:expect_undefined" data-lang="live:example/exprs/multi_undefined:output:expect_undefined">undefined decision</code></pre></div><h3 id="variables">Variables</h3><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/vars:module:hidden" data-lang="live:example/vars:module:hidden">package example</code></pre></div><p>You can store values in intermediate variables using the <code>:=</code> (assignment)
operator. Variables can be referenced just like <code>input</code>.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/vars/1:query:merge_down" data-lang="live:example/vars/1:query:merge_down">s := input.servers[0]
s.id == "app"
p := s.protocols[0]
p == "https"</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/vars/1:output" data-lang="live:example/vars/1:output">+---------+-------------------------------------------------------------------+
|    p    |                                 s                                 |
+---------+-------------------------------------------------------------------+
| "https" | {"id":"app","ports":["p1","p2","p3"],"protocols":["https","ssh"]} |
+---------+-------------------------------------------------------------------+</code></pre></div><p>When OPA evaluates expressions, it finds values for the variables that make all
of the expressions true. If there are no variable assignments that make all of
the expressions true, the result is undefined.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/vars/undefined:query:merge_down" data-lang="live:example/vars/undefined:query:merge_down">s := input.servers[0]
s.id == "app"
s.protocols[1] == "telnet"</code></pre></div><div class="live--block-container live--block-container--error">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/vars/undefined:output:expect_undefined" data-lang="live:example/vars/undefined:output:expect_undefined">undefined decision</code></pre></div><p>Variables are immutable. OPA reports an error if you try to assign the same
variable twice.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/vars/assign_error:query:merge_down" data-lang="live:example/vars/assign_error:query:merge_down">s := input.servers[0]
s := input.servers[1]</code></pre></div><div class="live--block-container live--block-container--error">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/vars/assign_error:output:expect_assigned_above" data-lang="live:example/vars/assign_error:output:expect_assigned_above">1 error occurred: 2:1: rego_compile_error: var s assigned above</code></pre></div><p>OPA must be able to enumerate the values for all variables in all expressions.
If OPA cannot enumerate the values of a variable in any expression, OPA will
report an error.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/vars/unsafe:query:merge_down" data-lang="live:example/vars/unsafe:query:merge_down">x := 1
x != y  # y has not been assigned a value</code></pre></div><div class="live--block-container live--block-container--error">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/vars/unsafe:output:expect_unsafe_var" data-lang="live:example/vars/unsafe:output:expect_unsafe_var">2 errors occurred:
2:1: rego_unsafe_var_error: var y is unsafe
2:1: rego_unsafe_var_error: var _ is unsafe</code></pre></div><h3 id="iteration">Iteration</h3><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter:module:hidden" data-lang="live:example/iter:module:hidden">package example</code></pre></div><p>Like other declarative languages (e.g., SQL), iteration in Rego happens
implicitly when you inject variables into expressions.</p><p>There are explicit iteration constructs to express <em>FOR ALL</em> and <em>FOR SOME</em>, <a href="#for-some-and-for-all">see
below</a>.</p><p>To understand how iteration works in Rego, imagine you need to check if any
networks are public. Recall that the networks are supplied inside an array:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/recall:query:merge_down" data-lang="live:example/iter/recall:query:merge_down">input.networks</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/recall:output" data-lang="live:example/iter/recall:output">[
  {
    "id": "net1",
    "public": false
  },
  {
    "id": "net2",
    "public": false
  },
  {
    "id": "net3",
    "public": true
  },
  {
    "id": "net4",
    "public": true
  }
]</code></pre></div><p>One option would be to test each network in the input:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/check_public_0:query:merge_down" data-lang="live:example/iter/check_public_0:query:merge_down">input.networks[0].public == true</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/check_public_0:output:merge_down" data-lang="live:example/iter/check_public_0:output:merge_down">false</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/check_public_1:query:merge_down" data-lang="live:example/iter/check_public_1:query:merge_down">input.networks[1].public == true</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/check_public_1:output:merge_down" data-lang="live:example/iter/check_public_1:output:merge_down">false</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/check_public_2:query:merge_down" data-lang="live:example/iter/check_public_2:query:merge_down">input.networks[2].public == true</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/check_public_2:output" data-lang="live:example/iter/check_public_2:output">true</code></pre></div><p>This approach is problematic because there may be too many networks to list
statically, or more importantly, the number of networks may not be known in
advance.</p><p>In Rego, the solution is to substitute the array index with a variable.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/1:query:merge_down" data-lang="live:example/iter/1:query:merge_down">some i; input.networks[i].public == true</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/1:output" data-lang="live:example/iter/1:output">+---+
| i |
+---+
| 2 |
| 3 |
+---+</code></pre></div><p>Now the query asks for values of <code>i</code> that make the overall expression true. When
you substitute variables in references, OPA automatically finds variable
assignments that satisfy all of the expressions in the query. Just like
intermediate variables, OPA returns the values of the variables.</p><p>You can substitute as many variables as you want. For example, to find out if
any servers expose the insecure <code>"http"</code> protocol you could write:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/double:query:merge_down" data-lang="live:example/iter/double:query:merge_down">some i, j; input.servers[i].protocols[j] == "http"</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/double:output" data-lang="live:example/iter/double:output">+---+---+
| i | j |
+---+---+
| 3 | 0 |
+---+---+</code></pre></div><p>If variables appear multiple times the assignments satisfy all of the
expressions. For example, to find the ids of ports connected to public networks,
you could write:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/join:query:merge_down" data-lang="live:example/iter/join:query:merge_down">some i, j
id := input.ports[i].id
input.ports[i].network == input.networks[j].id
input.networks[j].public</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/join:output" data-lang="live:example/iter/join:output">+---+------+---+
| i |  id  | j |
+---+------+---+
| 1 | "p2" | 2 |
+---+------+---+</code></pre></div><p>Providing good names for variables can be hard. If you only refer to the
variable once, you can replace it with the special <code>_</code> (wildcard variable)
operator. Conceptually, each instance of <code>_</code> is a unique variable.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/wildcard:query:merge_down" data-lang="live:example/iter/wildcard:query:merge_down">input.servers[_].protocols[_] == "http"</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/wildcard:output" data-lang="live:example/iter/wildcard:output">true</code></pre></div><p>Just like references that refer to non-existent fields or expressions that fail
to match, if OPA is unable to find any variable assignments that satisfy all of
the expressions, the result is undefined.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/undefined:query:merge_down" data-lang="live:example/iter/undefined:query:merge_down">some i; input.servers[i].protocols[i] == "ssh"  # there is no assignment of i that satisfies the expression</code></pre></div><div class="live--block-container live--block-container--error">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/undefined:output:expect_undefined" data-lang="live:example/iter/undefined:output:expect_undefined">undefined decision</code></pre></div><h4 id="for-some-and-for-all">FOR SOME and FOR ALL</h4><p>While plain iteration serves as a powerful building block, Rego also features ways
to express <em>FOR SOME</em> and <em>FOR ALL</em> more explicitly.</p><h5 id="for-some-some">FOR SOME (<code>some</code>)</h5><p><code>some ... in ...</code> is used to iterate over the collection (its last argument),
and will bind its variables (key, value position) to the collection items.
It introduces new bindings to the evaluation of the rest of the rule body.</p><p>Using <code>some</code>, we can express the rules introduced above in different ways:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/some1:module:merge_down" data-lang="live:example/iter/some1:module:merge_down">public_network contains net.id if {
    some net in input.networks # some network exists and..
    net.public                 # it is public.
}

shell_accessible contains server.id if {
    some server in input.servers
    "telnet" in server.protocols
}

shell_accessible contains server.id if {
    some server in input.servers
    "ssh" in server.protocols
}</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/some1:query:merge_down" data-lang="live:example/iter/some1:query:merge_down">shell_accessible</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/some1:output" data-lang="live:example/iter/some1:output">[
  "app",
  "busybox"
]</code></pre></div><p>For details on <code>some ... in ...</code>, see <a href="policy-language/#membership-and-iteration-in">the documentation of the <code>in</code> operator</a>.</p><h5 id="for-all-every">FOR ALL (<code>every</code>)</h5><p>Expanding on the examples above, <code>every</code> allows us to succinctly express that
a condition holds for all elements of a domain.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/every2:module:merge_down" data-lang="live:example/iter/every2:module:merge_down">no_telnet_exposed if {
    every server in input.servers {
        every protocol in server.protocols {
            "telnet" != protocol
        }
    }
}

no_telnet_exposed_alt if { # alternative: every + not-in
    every server in input.servers {
        not "telnet" in server.protocols
    }
}

no_telnet_exposed_alt2 if { # alternative: not + rule + some
    not any_telnet_exposed
}

any_telnet_exposed if {
    some server in input.servers
    "telnet" in server.protocols
}</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/every2:input:merge_down" data-lang="live:example/iter/every2:input:merge_down">{
    "servers": [
        {
            "id": "busybox",
            "protocols": ["http", "ftp"]
        },
        {
            "id": "db",
            "protocols": ["mysql", "ssh"]
        },
        {
            "id": "web",
            "protocols": ["https"]
        }
    ]
}</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/every2:query:merge_down" data-lang="live:example/iter/every2:query:merge_down">no_telnet_exposed</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/iter/every2:output" data-lang="live:example/iter/every2:output">true</code></pre></div><p>For all the details, see <a href="policy-language/#every-keyword">Every Keyword</a>.</p><h3 id="rules">Rules</h3><p>Rego lets you encapsulate and re-use logic with rules. Rules are just if-then
logic statements. Rules can either be ‚Äúcomplete‚Äù or ‚Äúpartial‚Äù.</p><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete:module:hidden" data-lang="live:example/complete:module:hidden">package example.rules</code></pre></div><h4 id="complete-rules">Complete Rules</h4><p>Complete rules are if-then statements that assign a single value to a variable.
For example:</p><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete/1:module:openable" data-lang="live:example/complete/1:module:openable">any_public_networks := true if {
    some net in input.networks # some network exists and..
    net.public                 # it is public.
}</code></pre></div><p>Every rule consists of a <em>head</em> and a <em>body</em>. In Rego we say the rule head
is true <em>if</em> the rule body is true for some set of variable assignments. In
the example above <code>any_public_networks := true</code> is the head and <code>some net in input.networks; net.public</code> is the body.</p><p>You can query for the value generated by rules just like any other value:</p><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete/1:query" data-lang="live:example/complete/1:query">any_public_networks</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete/1:output" data-lang="live:example/complete/1:output">true</code></pre></div><p>All values generated by rules can be queried via the global <code>data</code> variable.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete/1/abs:query:merge_down" data-lang="live:example/complete/1/abs:query:merge_down">data.example.rules.any_public_networks</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete/1/abs:output:merge_down" data-lang="live:example/complete/1/abs:output:merge_down">true</code></pre></div><blockquote><p>üí° You can query the value of any rule loaded into OPA by referring to it with an
absolute path. The path of a rule is always:
<code>data.&lt;package-path&gt;.&lt;rule-name&gt;</code>.</p></blockquote><p>If you omit the <code>= &lt;value&gt;</code> part of the rule head the value defaults to <code>true</code>.
You could rewrite the example above as follows without changing the meaning:</p><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete/elided:module:read_only,openable" data-lang="live:example/complete/elided:module:read_only,openable">any_public_networks if {
    some net in input.networks
    net.public
}</code></pre></div><p>To define constants, omit the rule body. When you omit the rule body it defaults
to <code>true</code>. Since the rule body is true, the rule head is always true/defined.</p><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete_constant:module:openable" data-lang="live:example/complete_constant:module:openable">package example.constants

pi := 3.14</code></pre></div><p>Constants defined like this can be queried just like any other values:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete_constant:query:merge_down" data-lang="live:example/complete_constant:query:merge_down">pi &gt; 3</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete_constant:output" data-lang="live:example/complete_constant:output">true</code></pre></div><p>If OPA cannot find variable assignments that satisfy the rule body, we say that
the rule is undefined. For example, if the <code>input</code> provided to OPA does not
include a public network then <code>any_public_networks</code> will be undefined (which is
not the same as false.) Below, OPA is given a different set of input networks
(none of which are public):</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete/1/undefined:input:merge_down" data-lang="live:example/complete/1/undefined:input:merge_down">{
    "networks": [
        {"id": "n1", "public": false},
        {"id": "n2", "public": false}
    ]
}</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete/1/undefined:query:merge_down" data-lang="live:example/complete/1/undefined:query:merge_down">any_public_networks</code></pre></div><div class="live--block-container live--block-container--error">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/complete/1/undefined:output:expect_undefined" data-lang="live:example/complete/1/undefined:output:expect_undefined">undefined decision</code></pre></div><h4 id="partial-rules">Partial Rules</h4><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set:module:hidden" data-lang="live:example/partial_set:module:hidden">package example</code></pre></div><p>Partial rules are if-then statements that generate a set of values and
assign that set to a variable. For example:</p><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set/1:module:openable" data-lang="live:example/partial_set/1:module:openable">public_network contains net.id if {
    some net in input.networks # some network exists and..
    net.public                 # it is public.
}</code></pre></div><p>In the example above <code>public_network contains net.id if</code> is the rule head and
<code>some net in input.networks; net.public</code> is the rule body. You can query for the entire
set of values just like any other value:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set/1/extent:query:merge_down" data-lang="live:example/partial_set/1/extent:query:merge_down">public_network</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set/1/extent:output" data-lang="live:example/partial_set/1/extent:output">[
  "net3",
  "net4"
]</code></pre></div><p>Iteration over the set of values can be done with the <code>some ... in ...</code> expression:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set/1/iteration_some:query:merge_down" data-lang="live:example/partial_set/1/iteration_some:query:merge_down">some net in public_network</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set/1/iteration_some:output" data-lang="live:example/partial_set/1/iteration_some:output">+--------+
|  net   |
+--------+
| "net3" |
| "net4" |
+--------+</code></pre></div><p>With a literal, or a bound variable, you can check if the value exists in the set
via <code>... in ...</code>:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set/1/exists_in:query:merge_down" data-lang="live:example/partial_set/1/exists_in:query:merge_down">"net3" in public_network</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set/1/exists_in:output" data-lang="live:example/partial_set/1/exists_in:output">true</code></pre></div><p>You can also iterate over the set of values by referencing the set elements with a
variable:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set/1/iteration:query:merge_down" data-lang="live:example/partial_set/1/iteration:query:merge_down">some n; public_network[n]</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set/1/iteration:output" data-lang="live:example/partial_set/1/iteration:output">+--------+-------------------+
|   n    | public_network[n] |
+--------+-------------------+
| "net3" | "net3"            |
| "net4" | "net4"            |
+--------+-------------------+</code></pre></div><p>Lastly, you can check if a value exists in the set using the same syntax:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set/1/exists:query:merge_down" data-lang="live:example/partial_set/1/exists:query:merge_down">public_network["net3"]</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/partial_set/1/exists:output" data-lang="live:example/partial_set/1/exists:output">"net3"</code></pre></div><p>In addition to partially defining sets, You can also partially define key/value
pairs (aka objects). See
<a href="https://www.openpolicyagent.org/docs/latest/policy-language/#rules">Rules</a> in
the language guide for more information.</p><h4 id="logical-or">Logical OR</h4><p>When you join multiple expressions together in a query you are expressing
logical AND. To express logical OR in Rego you define multiple rules with the
same name. Let‚Äôs look at an example.</p><p>Imagine you wanted to know if any servers expose protocols that give clients
shell access. To determine this you could define a complete rule that declares
<code>shell_accessible</code> to be <code>true</code> if any servers expose the <code>"telnet"</code> or <code>"ssh"</code>
protocols:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/logical_or/complete:module:openable,merge_down" data-lang="live:example/logical_or/complete:module:openable,merge_down">package example.logical_or

default shell_accessible := false

shell_accessible if {
	input.servers[_].protocols[_] == "telnet"
}

shell_accessible if {
	input.servers[_].protocols[_] == "ssh"
}</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/logical_or/complete:input:merge_down" data-lang="live:example/logical_or/complete:input:merge_down">{
    "servers": [
        {
            "id": "busybox",
            "protocols": ["http", "telnet"]
        },
        {
            "id": "web",
            "protocols": ["https"]
        }
    ]
}</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/logical_or/complete:query:merge_down" data-lang="live:example/logical_or/complete:query:merge_down">shell_accessible</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/logical_or/complete:output" data-lang="live:example/logical_or/complete:output">true</code></pre></div><blockquote><p>üí° The <code>default</code> keyword tells OPA to assign a value to the variable if all of
the other rules with the same name are undefined.</p></blockquote><p>When you use logical OR with partial rules, each rule definition contributes
to the set of values assigned to the variable. For example, the example above
could be modified to generate a set of servers that expose <code>"telnet"</code> or
<code>"ssh"</code>.</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/logical_or/partial_set:module:openable,merge_down" data-lang="live:example/logical_or/partial_set:module:openable,merge_down">package example.logical_or

shell_accessible contains server.id if {
	server := input.servers[_]
	server.protocols[_] == "telnet"
}

shell_accessible contains server.id if {
	server := input.servers[_]
	server.protocols[_] == "ssh"
}</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/logical_or/partial_set:input:merge_down" data-lang="live:example/logical_or/partial_set:input:merge_down">{
    "servers": [
        {
            "id": "busybox",
            "protocols": ["http", "telnet"]
        },
        {
            "id": "db",
            "protocols": ["mysql", "ssh"]
        },
        {
            "id": "web",
            "protocols": ["https"]
        }
    ]
}</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/logical_or/partial_set:query:merge_down" data-lang="live:example/logical_or/partial_set:query:merge_down">shell_accessible</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/logical_or/partial_set:output" data-lang="live:example/logical_or/partial_set:output">[
  "busybox",
  "db"
]</code></pre></div><article class="message is-info"><div class="message-body">üí° there‚Äôs a <a href="https://www.styra.com/blog/how-to-express-or-in-rego/">blog post</a> that goes into much more detail
on this topic showing different methods express OR in idiomatic Rego for different use cases.</div></article><h3 id="putting-it-together">Putting It Together</h3><p>The sections above explain the core concepts in Rego. To put it all together
let‚Äôs review the desired policy (in English):</p><pre tabindex="0"><code>1. Servers reachable from the Internet must not expose the insecure 'http' protocol.
2. Servers are not allowed to expose the 'telnet' protocol.
</code></pre><p>At a high-level the policy needs to identify servers that violate some
conditions. To implement this policy we could define rules called <code>violation</code>
that generate a set of servers that are in violation.</p><p>For example:</p><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/final:module:openable,merge_down" data-lang="live:example/final:module:openable,merge_down">package example

allow if {                                          # allow is true if...
    count(violation) == 0                           # there are zero violations.
}

violation contains server.id if {                   # a server is in the violation set if...
    some server in public_servers                   # it exists in the 'public_servers' set and...
    "http" in server.protocols                      # it contains the insecure "http" protocol.
}

violation contains server.id if {                   # a server is in the violation set if...
    some server in input.servers                    # it exists in the input.servers collection and...
    "telnet" in server.protocols                    # it contains the "telnet" protocol.
}

public_servers contains server if {                 # a server exists in the public_servers set if...
    some server in input.servers                    # it exists in the input.servers collection and...

    some port in server.ports                       # it references a port in the input.ports collection and...
    some input_port in input.ports
    port == input_port.id

    some input_network in input.networks            # the port references a network in the input.networks collection and...
    input_port.network == input_network.id
    input_network.public                            # the network is public.
}</code></pre></div><div class="live--block-container live--block-container--merged-down">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Query">
      <img class="live--icon--img" src="/live-blocks/icons/query.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/final:query:merge_down" data-lang="live:example/final:query:merge_down">some x; violation[x]</code></pre></div><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/final:output" data-lang="live:example/final:output">+-----------+--------------+
|     x     | violation[x] |
+-----------+--------------+
| "busybox" | "busybox"    |
| "ci"      | "ci"         |
+-----------+--------------+</code></pre></div><h2 id="running-opa">Running OPA</h2><p>This section explains how you can query OPA directly and interact with it on
your own machine.</p><h3 id="1-download-opa">1. Download OPA</h3><p>To get started download an OPA binary for your platform from
<a href="https://github.com/open-policy-agent/opa/releases">GitHub releases</a>:</p><p>On macOS (ARM 64-bit):</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>curl -L -o opa https://openpolicyagent.org/downloads/v1.0.0/opa_darwin_arm64_static
</span></span></code></pre></div><p>Or using Homebrew:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>brew install opa
</span></span></code></pre></div><p>On Linux (64-bit):</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>curl -L -o opa https://openpolicyagent.org/downloads/v1.0.0/opa_linux_amd64_static
</span></span></code></pre></div><article class="message is-info"><div class="message-body">Windows users can obtain the OPA executable from <a href="https://openpolicyagent.org/downloads/v1.0.0/opa_windows_amd64.exe">here</a>.
The steps below are the same for Windows users except the executable name will be different.
Windows executable file name is opa_windows_amd64.exe, which inclues file extension name ‚Äôexe‚Äô. The checksums file name is opa_windows_amd64.exe.sha256.
Windows users can obtain the checksums from <a href="https://openpolicyagent.org/downloads/v1.0.0/opa_windows_amd64.exe.sha256">here</a>.</div></article><p>Set permissions on the OPA executable:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>chmod <span style="color:#0000cf;font-weight:700">755</span> ./opa
</span></span></code></pre></div><article class="message is-info"><div class="message-body">You can also download and run OPA via Docker. The latest stable image tag is
<code>openpolicyagent/opa:latest</code>.</div></article><h4 id="checksums">Checksums</h4><p>Checksums for all binaries are available in the download path by appending <code>.sha256</code> to the binary filename.
Verify the macOS binary checksum:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>curl -L -o opa_darwin_amd64 https://openpolicyagent.org/downloads/v1.0.0/opa_darwin_amd64
</span></span><span style="display:flex"><span>curl -L -o opa_darwin_amd64.sha256 https://openpolicyagent.org/downloads/v1.0.0/opa_darwin_amd64.sha256
</span></span><span style="display:flex"><span>shasum -c opa_darwin_amd64.sha256
</span></span></code></pre></div><h3 id="2-try-opa-eval">2. Try <code>opa eval</code></h3><p>The simplest way to interact with OPA is via the command-line using the <a href="cli/#opa-eval"><code>opa eval</code> sub-command</a>.
It is a swiss-army knife that you can use to evaluate arbitrary Rego expressions and policies.
<code>opa eval</code> supports a large number of options for controlling evaluation.
Commonly used flags include:</p><table><thead><tr><th>Flag</th><th>Short</th><th>Description</th></tr></thead><tbody><tr><td><code>--bundle</code></td><td><code>-b</code></td><td>Load a <a href="management-bundles/#bundle-file-format">bundle file</a> or directory into OPA. This flag can be repeated.</td></tr><tr><td><code>--data</code></td><td><code>-d</code></td><td>Load policy or data files into OPA. This flag can be repeated.</td></tr><tr><td><code>--input</code></td><td><code>-i</code></td><td>Load a data file and use it as <code>input</code>. This flag cannot be repeated.</td></tr><tr><td><code>--format</code></td><td><code>-f</code></td><td>Set the output format to use. The default is <code>json</code> and is intended for programmatic use. The <code>pretty</code> format emits more human-readable output.</td></tr><tr><td><code>--fail</code></td><td>n/a</td><td>Exit with a non-zero exit code if the query is undefined.</td></tr><tr><td><code>--fail-defined</code></td><td>n/a</td><td>Exit with a non-zero exit code if the query is not undefined.</td></tr></tbody></table><p>For example:</p><p><strong>input.json</strong>:</p><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/using_opa:input" data-lang="live:example/using_opa:input">{
    "servers": [
        {"id": "app", "protocols": ["https", "ssh"], "ports": ["p1", "p2", "p3"]},
        {"id": "db", "protocols": ["mysql"], "ports": ["p3"]},
        {"id": "cache", "protocols": ["memcache"], "ports": ["p3"]},
        {"id": "ci", "protocols": ["http"], "ports": ["p1", "p2"]},
        {"id": "busybox", "protocols": ["telnet"], "ports": ["p1"]}
    ],
    "networks": [
        {"id": "net1", "public": false},
        {"id": "net2", "public": false},
        {"id": "net3", "public": true},
        {"id": "net4", "public": true}
    ],
    "ports": [
        {"id": "p1", "network": "net1"},
        {"id": "p2", "network": "net3"},
        {"id": "p3", "network": "net2"}
    ]
}</code></pre></div><p><strong>example.rego</strong>:</p><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre tabindex="0"><code class="language-live:example/using_opa:module:openable,read_only" data-lang="live:example/using_opa:module:openable,read_only">package example

default allow := false                              # unless otherwise defined, allow is false

allow if {                                          # allow is true if...
    count(violation) == 0                           # there are zero violations.
}

violation contains server.id if {                   # a server is in the violation set if...
    some server
    public_servers[server]                           # it exists in the 'public_servers' set and...
    server.protocols[_] == "http"                   # it contains the insecure "http" protocol.
}

violation contains server.id if {                   # a server is in the violation set if...
    server := input.servers[_]                      # it exists in the input.servers collection and...
    server.protocols[_] == "telnet"                 # it contains the "telnet" protocol.
}

public_servers contains server if {                  # a server exists in the 'public_servers' set if...
    some i, j
    server := input.servers[_]                      # it exists in the input.servers collection and...
    server.ports[_] == input.ports[i].id            # it references a port in the input.ports collection and...
    input.ports[i].network == input.networks[j].id  # the port references a network in the input.networks collection and...
    input.networks[j].public                        # the network is public.
}</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"># Evaluate a trivial expression.</span>
</span></span><span style="display:flex"><span>./opa <span style="color:#204a87">eval</span> <span style="color:#4e9a06">"1*2+3"</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"># Evaluate a policy on the command line.</span>
</span></span><span style="display:flex"><span>./opa <span style="color:#204a87">eval</span> -i input.json -d example.rego <span style="color:#4e9a06">"data.example.violation[x]"</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"># Evaluate a policy on the command line and use the exit code.</span>
</span></span><span style="display:flex"><span>./opa <span style="color:#204a87">eval</span> --fail-defined -i input.json -d example.rego <span style="color:#4e9a06">"data.example.violation[x]"</span>
</span></span><span style="display:flex"><span><span style="color:#204a87">echo</span> <span style="color:#000">$?</span>
</span></span></code></pre></div><h3 id="3-try-opa-run-interactive">3. Try <code>opa run</code> (interactive)</h3><p>OPA includes an interactive shell or REPL (Read-Eval-Print-Loop) accessible via
the <a href="cli/#opa-run"><code>opa run</code> sub-command</a>.
You can use the REPL to experiment with policies and prototype new ones.</p><p>To start the REPL just:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>./opa run
</span></span></code></pre></div><p>When you enter statements in the REPL, OPA evaluates them and prints the result.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#204a87;font-weight:700">true</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">true</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#0000cf;font-weight:700">3</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#0000cf;font-weight:700">14</span>
</span></span><span style="display:flex"><span><span style="color:#0000cf;font-weight:700">3</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#0000cf;font-weight:700">14</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#ce5c00;font-weight:700">[</span><span style="color:#4e9a06">"hello"</span><span style="color:#000;font-weight:700">,</span> <span style="color:#4e9a06">"world"</span><span style="color:#ce5c00;font-weight:700">]</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">[</span>
</span></span><span style="display:flex"><span>  <span style="color:#4e9a06">"hello"</span><span style="color:#000;font-weight:700">,</span>
</span></span><span style="display:flex"><span>  <span style="color:#4e9a06">"world"</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">]</span>
</span></span></code></pre></div><p>Most REPLs let you define variables that you can reference later on. OPA allows
you to do something similar. For example, you can define a <code>pi</code> constant as
follows:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#000">pi</span> <span style="color:#000;font-weight:700">:</span><span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#0000cf;font-weight:700">3</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#0000cf;font-weight:700">14</span>
</span></span></code></pre></div><p>Once ‚Äúpi‚Äù is defined, you query for the value and write expressions in terms of
it:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#000">pi</span>
</span></span><span style="display:flex"><span><span style="color:#0000cf;font-weight:700">3</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#0000cf;font-weight:700">14</span>
</span></span><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#000">pi</span> <span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#0000cf;font-weight:700">3</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">true</span>
</span></span></code></pre></div><p>Quit out of the REPL by pressing Control-D or typing <code>exit</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#204a87">exit</span>
</span></span></code></pre></div><p>You can load policy and data files into the REPL by passing them on the command
line. By default, JSON and YAML files are rooted under <code>data</code>.</p><pre tabindex="0"><code>opa run input.json
</code></pre><p>Run a few queries to poke around the data:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">servers</span><span style="color:#ce5c00;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#ce5c00;font-weight:700">].</span><span style="color:#000">protocols</span><span style="color:#ce5c00;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#ce5c00;font-weight:700">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">servers</span><span style="color:#ce5c00;font-weight:700">[</span><span style="color:#000">i</span><span style="color:#ce5c00;font-weight:700">].</span><span style="color:#000">protocols</span><span style="color:#ce5c00;font-weight:700">[</span><span style="color:#000">j</span><span style="color:#ce5c00;font-weight:700">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#000">net</span> <span style="color:#000;font-weight:700">:</span><span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">networks</span><span style="color:#ce5c00;font-weight:700">[</span><span style="color:#000">_</span><span style="color:#ce5c00;font-weight:700">]</span><span style="color:#000;font-weight:700">;</span> <span style="color:#000">net</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">public</span>
</span></span></code></pre></div><p>To set a data file as the <code>input</code> document in the REPL prefix the file path:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>opa run example.rego repl.input:input.json
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">example</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">public_servers</span><span style="color:#ce5c00;font-weight:700">[</span><span style="color:#000">s</span><span style="color:#ce5c00;font-weight:700">]</span>
</span></span></code></pre></div><article class="message is-info"><div class="message-body">Prefixing file paths with a reference controls where file is loaded under
<code>data</code>. By convention, the REPL sets the <code>input</code> document that queries see by
reading <code>data.repl.input</code> each time a statement is evaluated. See <code>help input</code>
for details in the REPL.</div></article><p>Quit out of the REPL by pressing Control-D or typing <code>exit</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="display:flex"><span><span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#204a87">exit</span>
</span></span></code></pre></div><h3 id="4-try-opa-run-server">4. Try <code>opa run</code> (server)</h3><p>To integrate with OPA you can run it as a server and execute queries over HTTP.
You can start OPA as a server with <code>-s</code> or <code>--server</code>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>./opa run --server ./example.rego
</span></span></code></pre></div><p>By default OPA listens for HTTP connections on <code>localhost:8181</code>. See <code>opa run --help</code> for a list of options to change the listening address, enable TLS, and
more.</p><p>Inside of another terminal use <code>curl</code> (or a similar tool) to access OPA‚Äôs HTTP
API. When you query the <code>/v1/data</code> HTTP API you must wrap input data inside of a
JSON object:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span><span style="color:#000;font-weight:700">{</span>
</span></span><span style="display:flex"><span>    <span style="color:#204a87;font-weight:700">"input"</span><span style="color:#000;font-weight:700">:</span> <span style="color:#a40000">&lt;value&gt;</span>
</span></span><span style="display:flex"><span><span style="color:#000;font-weight:700">}</span>
</span></span></code></pre></div><p>Create a copy the input file for sending via <code>curl</code>:</p><pre tabindex="0"><code>cat &lt;&lt;EOF &gt; v1-data-input.json
{
    "input": $(cat input.json)
}
EOF
</code></pre><p>Execute a few <code>curl</code> requests and inspect the output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>curl localhost:8181/v1/data/example/violation -d @v1-data-input.json -H <span style="color:#4e9a06">'Content-Type: application/json'</span>
</span></span><span style="display:flex"><span>curl localhost:8181/v1/data/example/allow -d @v1-data-input.json -H <span style="color:#4e9a06">'Content-Type: application/json'</span>
</span></span></code></pre></div><p>By default <code>data.system.main</code> is used to serve policy queries without a path.
When you execute queries without providing a path, you do not have to wrap the
input. If the <code>data.system.main</code> decision is undefined it is treated as an
error:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>curl localhost:8181 -i -d @input.json -H <span style="color:#4e9a06">'Content-Type: application/json'</span>
</span></span></code></pre></div><p>You can restart OPA and configure to use any decision as the default decision:</p><pre tabindex="0"><code>./opa run --server --set=default_decision=example/allow ./example.rego
</code></pre><p>Re-run the last <code>curl</code> command from above:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>curl localhost:8181 -i -d @input.json -H <span style="color:#4e9a06">'Content-Type: application/json'</span>
</span></span></code></pre></div><h3 id="5-try-opa-as-a-go-library">5. Try OPA as a Go library</h3><p>OPA can be embedded inside Go programs as a library. The simplest way to embed
OPA as a library is to import the <code>github.com/open-policy-agent/opa/rego</code>
package.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">import</span> <span style="color:#4e9a06">"github.com/open-policy-agent/opa/rego"</span>
</span></span></code></pre></div><p>Call the <code>rego.New</code> function to create an object that can be prepared or
evaluated:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="display:flex"><span><span style="color:#000">r</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">rego</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">New</span><span style="color:#000;font-weight:700">(</span>
</span></span><span style="display:flex"><span>    <span style="color:#000">rego</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Query</span><span style="color:#000;font-weight:700">(</span><span style="color:#4e9a06">"x = data.example.allow"</span><span style="color:#000;font-weight:700">),</span>
</span></span><span style="display:flex"><span>    <span style="color:#000">rego</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Load</span><span style="color:#000;font-weight:700">([]</span><span style="color:#204a87;font-weight:700">string</span><span style="color:#000;font-weight:700">{</span><span style="color:#4e9a06">"./example.rego"</span><span style="color:#000;font-weight:700">},</span> <span style="color:#204a87;font-weight:700">nil</span><span style="color:#000;font-weight:700">))</span>
</span></span></code></pre></div><p>The <code>rego.Rego</code> supports several options that let you customize evaluation. See
the <a href="https://godoc.org/github.com/open-policy-agent/opa/rego">GoDoc</a> page for
details. After constructing a new <code>rego.Rego</code> object you can call
<code>PrepareForEval()</code> to obtain an executable query. If <code>PrepareForEval()</code> fails it
indicates one of the options passed to the <code>rego.New()</code> call was invalid (e.g.,
parse error, compile error, etc.)</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="display:flex"><span><span style="color:#000">ctx</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">context</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Background</span><span style="color:#000;font-weight:700">()</span>
</span></span><span style="display:flex"><span><span style="color:#000">query</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">r</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">PrepareForEval</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">ctx</span><span style="color:#000;font-weight:700">)</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">!=</span> <span style="color:#204a87;font-weight:700">nil</span> <span style="color:#000;font-weight:700">{</span>
</span></span><span style="display:flex"><span>    <span style="color:#8f5902;font-style:italic">// handle error
</span></span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:700">}</span>
</span></span></code></pre></div><p>The prepared query object can be cached in-memory, shared across multiple
goroutines, and invoked repeatedly with different inputs. Call <code>Eval()</code> to
execute the prepared query.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="display:flex"><span><span style="color:#000">bs</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">ioutil</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">ReadFile</span><span style="color:#000;font-weight:700">(</span><span style="color:#4e9a06">"./input.json"</span><span style="color:#000;font-weight:700">)</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">!=</span> <span style="color:#204a87;font-weight:700">nil</span> <span style="color:#000;font-weight:700">{</span>
</span></span><span style="display:flex"><span>    <span style="color:#8f5902;font-style:italic">// handle error
</span></span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:700">}</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">var</span> <span style="color:#000">input</span> <span style="color:#204a87;font-weight:700">interface</span><span style="color:#000;font-weight:700">{}</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">json</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Unmarshal</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">bs</span><span style="color:#000;font-weight:700">,</span> <span style="color:#ce5c00;font-weight:700">&amp;</span><span style="color:#000">input</span><span style="color:#000;font-weight:700">);</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">!=</span> <span style="color:#204a87;font-weight:700">nil</span> <span style="color:#000;font-weight:700">{</span>
</span></span><span style="display:flex"><span>    <span style="color:#8f5902;font-style:italic">// handle error
</span></span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:700">}</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#000">rs</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">query</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Eval</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">ctx</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">rego</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">EvalInput</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">input</span><span style="color:#000;font-weight:700">))</span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">!=</span> <span style="color:#204a87;font-weight:700">nil</span> <span style="color:#000;font-weight:700">{</span>
</span></span><span style="display:flex"><span>    <span style="color:#8f5902;font-style:italic">// handle error
</span></span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:700">}</span>
</span></span></code></pre></div><p>The policy decision is contained in the results returned by the <code>Eval()</code> call.
You can inspect the decision and handle it accordingly:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="display:flex"><span><span style="color:#8f5902;font-style:italic">// In this example we expect a single result (stored in the variable 'x').
</span></span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">fmt</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:700">(</span><span style="color:#4e9a06">"Result:"</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">rs</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">].</span><span style="color:#000">Bindings</span><span style="color:#000;font-weight:700">[</span><span style="color:#4e9a06">"x"</span><span style="color:#000;font-weight:700">])</span>
</span></span></code></pre></div><p>You can combine the steps above into a simple command-line program that
evaluates policies and outputs the result:</p><p><strong>main.go</strong>:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="display:flex"><span><span style="color:#204a87;font-weight:700">package</span> <span style="color:#000">main</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">import</span> <span style="color:#000;font-weight:700">(</span>
</span></span><span style="display:flex"><span>	<span style="color:#4e9a06">"context"</span>
</span></span><span style="display:flex"><span>	<span style="color:#4e9a06">"encoding/json"</span>
</span></span><span style="display:flex"><span>	<span style="color:#4e9a06">"fmt"</span>
</span></span><span style="display:flex"><span>	<span style="color:#4e9a06">"log"</span>
</span></span><span style="display:flex"><span>	<span style="color:#4e9a06">"os"</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>	<span style="color:#4e9a06">"github.com/open-policy-agent/opa/rego"</span>
</span></span><span style="display:flex"><span><span style="color:#000;font-weight:700">)</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#204a87;font-weight:700">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:700">()</span> <span style="color:#000;font-weight:700">{</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>	<span style="color:#000">ctx</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">context</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Background</span><span style="color:#000;font-weight:700">()</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>	<span style="color:#8f5902;font-style:italic">// Construct a Rego object that can be prepared or evaluated.
</span></span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">r</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">rego</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">New</span><span style="color:#000;font-weight:700">(</span>
</span></span><span style="display:flex"><span>		<span style="color:#000">rego</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Query</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">os</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Args</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">2</span><span style="color:#000;font-weight:700">]),</span>
</span></span><span style="display:flex"><span>		<span style="color:#000">rego</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Load</span><span style="color:#000;font-weight:700">([]</span><span style="color:#204a87;font-weight:700">string</span><span style="color:#000;font-weight:700">{</span><span style="color:#000">os</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Args</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">]},</span> <span style="color:#204a87;font-weight:700">nil</span><span style="color:#000;font-weight:700">))</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>	<span style="color:#8f5902;font-style:italic">// Create a prepared query that can be evaluated.
</span></span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">query</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">r</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">PrepareForEval</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">ctx</span><span style="color:#000;font-weight:700">)</span>
</span></span><span style="display:flex"><span>	<span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">!=</span> <span style="color:#204a87;font-weight:700">nil</span> <span style="color:#000;font-weight:700">{</span>
</span></span><span style="display:flex"><span>		<span style="color:#000">log</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Fatal</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:700">)</span>
</span></span><span style="display:flex"><span>	<span style="color:#000;font-weight:700">}</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>	<span style="color:#8f5902;font-style:italic">// Load the input document from stdin.
</span></span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#204a87;font-weight:700">var</span> <span style="color:#000">input</span> <span style="color:#204a87;font-weight:700">interface</span><span style="color:#000;font-weight:700">{}</span>
</span></span><span style="display:flex"><span>	<span style="color:#000">dec</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">json</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">NewDecoder</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">os</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Stdin</span><span style="color:#000;font-weight:700">)</span>
</span></span><span style="display:flex"><span>	<span style="color:#000">dec</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">UseNumber</span><span style="color:#000;font-weight:700">()</span>
</span></span><span style="display:flex"><span>	<span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">dec</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Decode</span><span style="color:#000;font-weight:700">(</span><span style="color:#ce5c00;font-weight:700">&amp;</span><span style="color:#000">input</span><span style="color:#000;font-weight:700">);</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">!=</span> <span style="color:#204a87;font-weight:700">nil</span> <span style="color:#000;font-weight:700">{</span>
</span></span><span style="display:flex"><span>		<span style="color:#000">log</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Fatal</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:700">)</span>
</span></span><span style="display:flex"><span>	<span style="color:#000;font-weight:700">}</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>	<span style="color:#8f5902;font-style:italic">// Execute the prepared query.
</span></span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">rs</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">:=</span> <span style="color:#000">query</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Eval</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">ctx</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">rego</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">EvalInput</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">input</span><span style="color:#000;font-weight:700">))</span>
</span></span><span style="display:flex"><span>	<span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:700">!=</span> <span style="color:#204a87;font-weight:700">nil</span> <span style="color:#000;font-weight:700">{</span>
</span></span><span style="display:flex"><span>		<span style="color:#000">log</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Fatal</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:700">)</span>
</span></span><span style="display:flex"><span>	<span style="color:#000;font-weight:700">}</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>    <span style="color:#8f5902;font-style:italic">// Do something with the result.
</span></span></span><span style="display:flex"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">fmt</span><span style="color:#000;font-weight:700">.</span><span style="color:#000">Println</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">rs</span><span style="color:#000;font-weight:700">)</span>
</span></span><span style="display:flex"><span><span style="color:#000;font-weight:700">}</span>
</span></span></code></pre></div><p>Run the code above as follows:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>go run main.go example.rego <span style="color:#4e9a06">'data.example.violation'</span> &lt; input.json
</span></span></code></pre></div><h2 id="next-steps">Next Steps</h2><p>Congratulations on making it through the introduction to OPA. If you made it
this far you have learned the core concepts behind OPA‚Äôs policy language as well
as how to get OPA and run it on your own.</p><p>If you have more questions about how to write policies in Rego check out:</p><ul><li>The <a href="policy-reference">Policy Reference</a> page for reference documentation on built-in functions.</li><li>The <a href="policy-language">Policy Language</a> page for complete descriptions of all language features.</li></ul><p>If you want to try OPA for a specific use case check out:</p><ul><li>The <a href="ecosystem">Ecosystem</a> page which showcases various of OPA integrations.</li></ul><p>Some popular tutorials include:</p><ul><li>The <a href="kubernetes-introduction">Kubernetes</a> page for how to use OPA as an admission controller in Kubernetes.</li><li>The <a href="envoy-introduction">Envoy</a> page for how to use OPA as an external authorizer with Envoy.</li><li>The <a href="terraform">Terraform</a> page for how to use OPA to validate Terraform plans.</li></ul><p>Don‚Äôt forget to install the OPA (Rego) Plugin for your favorite <a href="editor-and-ide-support">IDE or Text Editor</a></p></div><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}.feedback--question{margin-bottom:1em}.feedback--title{font-size:1.75em}</style><div class="d-print-none"><h2 class="feedback--title">Feedback</h2><p class="feedback--question">Was this page helpful?</p><button class="button feedback--answer feedback--answer-yes">Yes</button>
<button class="button feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href="https://github.com/open-policy-agent/opa/issues/new">tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href="https://github.com/open-policy-agent/opa/issues/new">tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof ga!="function")return;const t={command:"send",hitType:"event",category:"Helpful",action:"click",label:window.location.pathname,value:e};ga(t.command,t.hitType,t.category,t.action,t.label,t.value)};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><div class="toc-padding"></div></section></div></article></div></div><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" onerror="console.error(&quot;Error loading the docsearch.min.js script&quot;)"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.7.0/tocbot.min.js" integrity="sha512-0yvqkr9Ldt1VsW3izBRlvZuz0Sd1Yu+ZRZSFg33ogi0FJi7FlzP3s1QOrA0Fd0XbAEXMdSrLQBlCFyHq4kNEEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="/js/app.9e4213d527d0e4feb2e5745ae3027ae3aa8214213f59240049d879d6677db168.js" integrity="sha256-nkIT1SfQ5P6y5XRa4wJ646qCFCE/WSQASdh51md9sWg="></script>
<script src="/js/anchor.min.js"></script>
<script>console.log("You are reading the docs for version latest of Open Policy Agent"),docsearch({container:"#docsearch",appId:"P4N61UNFMP",indexName:"openpolicyagent",apiKey:"40a3909859478f0b23c385214feab2ef",searchParameters:{facetFilters:["version:latest"]}})</script></div><script src="/js/live-blocks.js"></script></body></html>