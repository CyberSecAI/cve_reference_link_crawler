

* [Docs](/docs/)
* [Download](/docs/#running-opa)
* [Ecosystem](/ecosystem/)
* [Security](/security)
* [Support](/support)
* [Community](/community)
* [Play](https://play.openpolicyagent.org/)
* [Blog](https://blog.openpolicyagent.org/)
* [![Twitter](/img/twitter-icon.png)Twitter](https://twitter.com/openpolicyagent)
* [![Slack](/img/slack-icon.png)Slack](https://slack.openpolicyagent.org/)
* [![GitHub](/img/github-icon.png)GitHub](https://github.com/open-policy-agent/opa)
# Policy-based control for cloud native environments

Flexible, fine-grained control for
administrators across the stack![](/img/banner-image.jpg)
![](/img/banner-image-wide.jpg)

Stop using a different policy language, policy model, and policy
API for every product and service you use. Use OPA for a unified
toolset and framework for policy across the cloud native stack.

Whether for one service or for all your services, use OPA to
decouple policy from the service's code so you can release,
analyze, and review policies (which security and compliance teams
love) without sacrificing availability or performance.

Created By

[![](./img/styra-logo.jpg)](https://styra.com)

OPA is now maintained by Styra and a large community of contributors

![](./img/gray-top.png)
## Declarative Policy

Context-aware, Expressive, Fast, Portable

* [![](./img/policyIcon-1.png)
  Kubernetes](#tabs-1)
* [![](./img/envoy-square.png)
  Envoy](#tabs-2)
* [![](./img/policyIcon-4.png)
  Application](#tabs-4)

[Ensure all images come
from a trusted registry](#v-pills-k8s-1-desktop-content)
[Stop ingresses from using
the same host name](#v-pills-k8s-2-desktop-content)
![](/live-blocks/icons/input.svg)

```
                                    {
    "apiVersion": "admission.k8s.io/v1",
    "kind": "AdmissionReview",
    "request": {
        "kind": {
            "group": "",
            "kind": "Pod",
            "version": "v1"
        },
        "object": {
            "metadata": {
                "name": "myapp"
            },
            "spec": {
                "containers": [
                    {
                        "image": "nginx",
                        "name": "nginx-frontend"
                    },
                    {
                        "image": "mysql",
                        "name": "mysql-backend"
                    }
                ]
            }
        }
    }
}

```
![](/live-blocks/icons/module.svg)

```
                                          package kubernetes.admission

import rego.v1

deny contains sprintf("image '%s' comes from untrusted registry", [container.image]) if {
	input.request.kind.kind == "Pod"
	some container in input.request.object.spec.containers
	not startswith(container.image, "hooli.com/")
}

```
![](/live-blocks/icons/output.svg)

```
                                    {
  "deny": [
    "image 'mysql' comes from untrusted registry",
    "image 'nginx' comes from untrusted registry"
  ]
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/2TdExAXjo7)
![](/live-blocks/icons/input.svg)

```
                                    {
    "apiVersion": "admission.k8s.io/v1beta1",
    "kind": "AdmissionReview",
    "request": {
        "kind": {
            "group": "extensions",
            "kind": "Ingress",
            "version": "v1beta1"
        },
        "object": {
            "metadata": {
                "name": "prod",
                "namespace": "bar"
            },
            "spec": {
                "rules": [
                    {
                        "host": "initech.com",
                        "http": {
                            "paths": [
                                {
                                    "backend": {
                                        "serviceName": "banking",
                                        "servicePort": 443
                                    },
                                    "path": "/finance"
                                }
                            ]
                        }
                    }
                ]
            }
        }
    }
}

```
![](/live-blocks/icons/module.svg)

```
                                      package kubernetes.admission

import rego.v1

# Reject any ingress with the same host as an existing ingress
deny contains msg if {
	input.request.kind.kind == "Ingress"

	# iterate over all hosts in input Ingress
	some rule in input.request.object.spec.rules
	newhost := rule.host

	# iterate over all existing ingresses and all hosts for each ingress
	some namespace, name
	some oldrule in data.kubernetes.ingresses[namespace][name].spec.rules
	oldhost := oldrule.host

	# reject if the oldhost and the newhost are the same
	newhost == oldhost
	msg := sprintf("ingress host conflicts with ingress %s/%s", [namespace, name])
}

```
![](/live-blocks/icons/output.svg)

```
                                      {
  "deny": []
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/Rca3eAwibZ)[Allow everyone to run GET on
`/pets`](#v-pills-envoy-1-desktop-content)
[Allow frontend service to
run GET on `/pets/owners`](#v-pills-envoy-2-desktop-content)
![](/live-blocks/icons/input.svg)

```
                                  {
    "attributes": {
        "destination": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 8000
                        },
                        "address": "172.17.0.8"
                    }
                }
            }
        },
        "request": {
            "http": {
                "headers": {
                    ":authority": "example-app",
                    ":method": "GET",
                    ":path": "/pets",
                    "user-agent": "Wget",
                    "x-forwarded-proto": "http",
                    "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
                },
                "host": "example-app",
                "id": "8910035251488566126",
                "method": "GET",
                "path": "/pets",
                "protocol": "HTTP/1.1"
            }
        },
        "source": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 54292
                        },
                        "address": "172.17.0.6"
                    }
                }
            }
        }
    },
    "parsed_path": [
        "pets"
    ]
}

```
![](/live-blocks/icons/module.svg)

```
                                    package envoy.authz

import rego.v1

# allow all GET requests to /pets
default allow := false

allow if {
	input.attributes.request.http.method == "GET"
	input.attributes.request.http.path == "/pets"
}

```
![](/live-blocks/icons/output.svg)

```
                                  {
  "allow": true
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/iW9PCMpsMk)
![](/live-blocks/icons/input.svg)

```
                                  {
    "attributes": {
        "destination": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 8000
                        },
                        "address": "172.17.0.8"
                    }
                }
            }
        },
        "request": {
            "http": {
                "headers": {
                    ":authority": "example-app",
                    ":method": "GET",
                    ":path": "/pets/owners",
                    "user-agent": "Wget",
                    "x-forwarded-client-cert": "By=spiffe://domain.test/db-server;Hash=331f2f4eb2a1729fa4e0f46c8c663786098151ae571fed7b66680e970f6a0f94;URI=spiffe://domain.test/frontend",
                    "x-forwarded-proto": "http",
                    "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
                },
                "host": "example-app",
                "id": "8910035251488566126",
                "method": "GET",
                "path": "/pets/owners",
                "protocol": "HTTP/1.1"
            }
        },
        "source": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 54292
                        },
                        "address": "172.17.0.6"
                    }
                }
            }
        }
    },
    "parsed_path": [
        "pets",
        "owners"
    ]
}

```
![](/live-blocks/icons/module.svg)

```
                                        package envoy.authz

import rego.v1

# allow only the frontend service to GET /pets/owners
default allow := false

allow if {
	http_request.path == "/pets/owners"
	http_request.method == "GET"
	source_spiffe_id == "spiffe://domain.test/frontend"
}

source_spiffe_id := client_id if {
	[_, _, uri_type_san] := split(http_request.headers["x-forwarded-client-cert"], ";")
	[_, client_id] := split(uri_type_san, "=")
}

http_request := input.attributes.request.http

```
![](/live-blocks/icons/output.svg)

```
                                  {
  "allow": true,
  "http_request": {
    "headers": {
      ":authority": "example-app",
      ":method": "GET",
      ":path": "/pets/owners",
      "user-agent": "Wget",
      "x-forwarded-client-cert": "By=spiffe://domain.test/db-server;Hash=331f2f4eb2a1729fa4e0f46c8c663786098151ae571fed7b66680e970f6a0f94;URI=spiffe://domain.test/frontend",
      "x-forwarded-proto": "http",
      "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
    },
    "host": "example-app",
    "id": "8910035251488566126",
    "method": "GET",
    "path": "/pets/owners",
    "protocol": "HTTP/1.1"
  },
  "source_spiffe_id": "spiffe://domain.test/frontend"
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/z0g4W3er2Z)[Only the pet's owner can
update that pet's information](#v-pills-app-1-desktop-content)
[Only employees,
authenticated with a JWT, can see already adopted
pets](#v-pills-app-2-desktop-content)
![](/live-blocks/icons/input.svg)

```
                                    {
    "method": "PUT",
    "owner": "bob@hooli.com",
    "path": [
        "pets",
        "pet113-987"
    ],
    "user": "alice@hooli.com"
}

```
![](/live-blocks/icons/module.svg)

```
                                    package application.authz

import rego.v1

# Only owner can update the pet's information
# Ownership information is provided as part of OPA's input
default allow := false

allow if {
	input.method == "PUT"
	some petid
	input.path = ["pets", petid]
	input.user == input.owner
}

```
![](/live-blocks/icons/output.svg)

```
                                  {
  "allow": false
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/PFqSN1WAiH)
![](/live-blocks/icons/input.svg)

```
                                  {
    "pet_list": [
        {
            "breed": "St. Bernard",
            "name": "Cujo",
            "up_for_adoption": false
        },
        {
            "breed": "Collie",
            "name": "Lassie",
            "up_for_adoption": true
        }
    ],
    "token": "eyJ1IjoiSFMyNTYiLCJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiYWxpY2UiLCJlbXBsb3llZSI6dHJ1ZSwibmFtZSI6IkFsaWNlIFNtaXRoIn0.vMBYEW8VK9XM7yPkKTu1C3Gy1tOq1A0d4-xYMkkRpEc"
}

```
![](/live-blocks/icons/module.svg)

```
                                    package application.authz

import rego.v1

# Everyone can see pets up for adoption
allowed_pets contains pet if {
	some pet in input.pet_list
	pet.up_for_adoption
}

# Employees can see all pets.
allowed_pets contains pet if {
	[_, payload, _] := io.jwt.decode(input.token)
	payload.employee
	some pet in input.pet_list
}

```
![](/live-blocks/icons/output.svg)

```
                                        {
  "allowed_pets": [
    {
      "breed": "Collie",
      "name": "Lassie",
      "up_for_adoption": true
    },
    {
      "breed": "St. Bernard",
      "name": "Cujo",
      "up_for_adoption": false
    }
  ]
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/E8VVxu66Bu)
## Declarative Policy

Context-aware, Expressive, Fast, Portable[![](./img/policyIcon-1.png)

Kubernetes

![](./img/downArrow.svg)](#kubernetes)[![](./img/policyIcon-2.png)

Envoy

![](./img/downArrow.svg)](#envoy)[![](./img/policyIcon-4.png)

Application

![](./img/downArrow.svg)](#application)![](./img/policyIcon-1.png)

Kubernetes

[Ensure all images come from a
trusted registry](#v-pills-k8s-1-mobile-content)
[Stop
ingresses from using the same host name](#v-pills-k8s-2-mobile-content)
![](/live-blocks/icons/input.svg)

```
                              {
    "apiVersion": "admission.k8s.io/v1beta1",
    "kind": "AdmissionReview",
    "request": {
        "kind": {
            "group": "",
            "kind": "Pod",
            "version": "v1"
        },
        "object": {
            "metadata": {
                "name": "myapp"
            },
            "spec": {
                "containers": [
                    {
                        "image": "nginx",
                        "name": "nginx-frontend"
                    },
                    {
                        "image": "mysql",
                        "name": "mysql-backend"
                    }
                ]
            }
        }
    }
}

```
![](/live-blocks/icons/module.svg)

```
                              package kubernetes.admission

import rego.v1

deny contains sprintf("image '%s' comes from untrusted registry", [container.image]) if {
	input.request.kind.kind == "Pod"
	some container in input.request.object.spec.containers
	not startswith(container.image, "hooli.com/")
}

```
![](/live-blocks/icons/output.svg)

```
                              {
  "deny": [
    "image 'mysql' comes from untrusted registry",
    "image 'nginx' comes from untrusted registry"
  ]
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/2TdExAXjo7)
![](/live-blocks/icons/input.svg)

```
                              {
    "apiVersion": "admission.k8s.io/v1beta1",
    "kind": "AdmissionReview",
    "request": {
        "kind": {
            "group": "extensions",
            "kind": "Ingress",
            "version": "v1beta1"
        },
        "object": {
            "metadata": {
                "name": "prod",
                "namespace": "bar"
            },
            "spec": {
                "rules": [
                    {
                        "host": "initech.com",
                        "http": {
                            "paths": [
                                {
                                    "backend": {
                                        "serviceName": "banking",
                                        "servicePort": 443
                                    },
                                    "path": "/finance"
                                }
                            ]
                        }
                    }
                ]
            }
        }
    }
}

```
![](/live-blocks/icons/module.svg)

```
                              package kubernetes.admission

import rego.v1

# Reject any ingress with the same host as an existing ingress
deny contains msg if {
	input.request.kind.kind == "Ingress"

	# iterate over all hosts in input Ingress
	some rule in input.request.object.spec.rules
	newhost := rule.host

	# iterate over all existing ingresses and all hosts for each ingress
	some namespace, name
	some oldrule in data.kubernetes.ingresses[namespace][name].spec.rules
	oldhost := oldrule.host

	# reject if the oldhost and the newhost are the same
	newhost == oldhost
	msg := sprintf("ingress host conflicts with ingress %s/%s", [namespace, name])
}

```
![](/live-blocks/icons/output.svg)

```
                              {
  "deny": []
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/Rca3eAwibZ)![](./img/policyIcon-2.png)

Envoy

[Allow everyone to run GET on
`/pets`](#v-pills-envoy-1-mobile-content)
[Allow
frontend service to run GET on `/pets/owners`](#v-pills-envoy-2-mobile-content)
![](/live-blocks/icons/input.svg)

```
                              {
    "attributes": {
        "destination": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 8000
                        },
                        "address": "172.17.0.8"
                    }
                }
            }
        },
        "request": {
            "http": {
                "headers": {
                    ":authority": "example-app",
                    ":method": "GET",
                    ":path": "/pets",
                    "user-agent": "Wget",
                    "x-forwarded-proto": "http",
                    "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
                },
                "host": "example-app",
                "id": "8910035251488566126",
                "method": "GET",
                "path": "/pets",
                "protocol": "HTTP/1.1"
            }
        },
        "source": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 54292
                        },
                        "address": "172.17.0.6"
                    }
                }
            }
        }
    },
    "parsed_path": [
        "pets"
    ]
}

```
![](/live-blocks/icons/module.svg)

```
                              package envoy.authz

import future.keywords

# allow all GET requests to /pets
default allow := false

allow if {
	input.attributes.request.http.method == "GET"
	input.attributes.request.http.path == "/pets"
}

```
![](/live-blocks/icons/output.svg)

```
                              {
  "allow": true
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/iW9PCMpsMk)
![](/live-blocks/icons/input.svg)

```
                              {
    "attributes": {
        "destination": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 8000
                        },
                        "address": "172.17.0.8"
                    }
                }
            }
        },
        "request": {
            "http": {
                "headers": {
                    ":authority": "example-app",
                    ":method": "GET",
                    ":path": "/pets/owners",
                    "user-agent": "Wget",
                    "x-forwarded-client-cert": "By=spiffe://domain.test/db-server;Hash=331f2f4eb2a1729fa4e0f46c8c663786098151ae571fed7b66680e970f6a0f94;URI=spiffe://domain.test/frontend",
                    "x-forwarded-proto": "http",
                    "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
                },
                "host": "example-app",
                "id": "8910035251488566126",
                "method": "GET",
                "path": "/pets/owners",
                "protocol": "HTTP/1.1"
            }
        },
        "source": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 54292
                        },
                        "address": "172.17.0.6"
                    }
                }
            }
        }
    },
    "parsed_path": [
        "pets",
        "owners"
    ]
}

```
![](/live-blocks/icons/module.svg)

```
                              package envoy.authz

import future.keywords
import input.attributes.request.http as http_request

# allow only the frontend service to GET /pets/owners
default allow := false

allow if {
	http_request.path == "/pets/owners"
	http_request.method == "GET"
	source_spiffe_id == "spiffe://domain.test/frontend"
}

source_spiffe_id = client_id if {
	[_, _, uri_type_san] := split(http_request.headers["x-forwarded-client-cert"], ";")
	[_, client_id] := split(uri_type_san, "=")
}

```
![](/live-blocks/icons/output.svg)

```
                              {
  "allow": true,
  "source_spiffe_id": "spiffe://domain.test/frontend"
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/z0g4W3er2Z)![](./img/policyIcon-4.png)

Application

[Only the pet's owner can update
that pet's information](#v-pills-app-1-mobile-content)
[Only
employees, authenticated with a JWT, can see already
adopted pets](#v-pills-app-2-mobile-content)
![](/live-blocks/icons/input.svg)

```
                              {
    "method": "PUT",
    "owner": "bob@hooli.com",
    "path": [
        "pets",
        "pet113-987"
    ],
    "user": "alice@hooli.com"
}

```
![](/live-blocks/icons/module.svg)

```
                              package application.authz

import rego.v1

# Only owner can update the pet's information
# Ownership information is provided as part of OPA's input
default allow := false

allow if {
	input.method == "PUT"
	some petid
	input.path = ["pets", petid]
	input.user == input.owner
}

```
![](/live-blocks/icons/output.svg)

```
                              {
  "allow": false
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/PFqSN1WAiH)![](/live-blocks/icons/input.svg)

```
                              {
    "pet_list": [
        {
            "breed": "St. Bernard",
            "name": "Cujo",
            "up_for_adoption": false
        },
        {
            "breed": "Collie",
            "name": "Lassie",
            "up_for_adoption": true
        }
    ],
    "token": "eyJ1IjoiSFMyNTYiLCJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiYWxpY2UiLCJlbXBsb3llZSI6dHJ1ZSwibmFtZSI6IkFsaWNlIFNtaXRoIn0.vMBYEW8VK9XM7yPkKTu1C3Gy1tOq1A0d4-xYMkkRpEc"
}

```
![](/live-blocks/icons/module.svg)

```
                              package application.authz

import rego.v1

# Everyone can see pets up for adoption
allowed_pets contains pet if {
	some pet in input.pet_list
	pet.up_for_adoption
}

# Employees can see all pets.
allowed_pets contains pet if {
	[_, payload, _] := io.jwt.decode(input.token)
	payload.employee
	some pet in input.pet_list
}

```
![](/live-blocks/icons/output.svg)

```
                              {
  "allowed_pets": [
    {
      "breed": "Collie",
      "name": "Lassie",
      "up_for_adoption": true
    },
    {
      "breed": "St. Bernard",
      "name": "Cujo",
      "up_for_adoption": false
    }
  ]
}

```
[Open In Playground
![](/live-blocks/icons/playground-open.svg)](https://play.openpolicyagent.org/p/E8VVxu66Bu)

Declarative. Express policy in
a high-level,
declarative language that promotes safe,
performant, fine-grained controls. Use a language
purpose-built for policy in a world where JSON is
pervasive. Iterate, traverse hierarchies, and apply
150+ built-ins like string manipulation and JWT
decoding to declare the policies you want enforced.

Context-aware. Leverage
external information to
write the policies you really care about. Stop
inventing roles that represent complex relationships
that years down the road no one will understand.
Instead, write logic that adapts to the world around
it and attach that logic to the systems that need it.

Learn More[Kubernetes](./docs/latest/kubernetes-introduction/)
[Envoy](./docs/latest/envoy-introduction/)
[Terraform](./docs/latest/terraform/)
[Kafka](./docs/latest/kafka-authorization/)
[SQL](https://blog.openpolicyagent.org/write-policy-in-opa-enforce-policy-in-sql-d9d24db93bf4)
[Linux](./docs/latest/ssh-and-sudo-authorization/)![](./img/curve.png)
## Architectural Flexibility

Balance integration, availability,
consistency
### Daemon

### Service

![](./img/Deployment-Options-3.png)Policy
(Rego)Data
(JSON)

Deploy OPA as a separate process on the same
host as your service. Integrate OPA by changing
your service’s code, importing an OPA-enabled
library, or using a network proxy integrated with OPA.

### Library

### Service

![](./img/logo.png)![](./img/Deployment-Options-1.png)Policy
(Rego)Data
(JSON)

Embed OPA policies into your service. Integrate OPA as a Go
library
that evaluates policy, or integrate a WebAssembly runtime
and use OPA
to compile policy to WebAssembly instructions.

Learn More[Daemon](./docs/latest/deployments/)
[Library](./docs/latest/integration/#integrating-with-the-go-api)![](./img/curve-up.png)
## Tools for Policy Authoring

IDEs, Sharing, Profiling, Testing, Coverage![](./img/tools-playground.png)
#### Rego Playground for Policy Sharing

![](./img/tools-vscode.png)
#### VS Code for Policy Authoring

![](./img/tools-cli.png)
#### CLI and REPL for complete control

OPA embraces policy-as-code, complete with tools that help people
use and understand the policies they put
in
place. Integrated development environments, testing, profiling,
coverage, automated performance tuning, and
hot
reloading aren’t just things you need for programming--you need them
for policy too, and OPA delivers.

Learn More[VS Code](https://marketplace.visualstudio.com/items?itemName=tsandall.opa)
[Rego Playground](https://play.openpolicyagent.org/)
[General Tooling](./docs/latest/#running-opa)
[OPA GitHub](https://github.com/open-policy-agent)Open Policy Agent is a Cloud Native Computing Foundation
Graduated project.![](img/cloud-native-logo.png)

© 2025 Open Policy Agent contributors.
Licensed under the Apache License, Version 2.0. See the
[contributing documentation](/docs/latest/contributing/)
for information about contributing.

The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation,
please see our [Trademark Usage page](https://www.linuxfoundation.org/legal/trademark-usage).

