=== Content from plugins.trac.wordpress.org_51854477_20250110_213046.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fdownload-manager%2Ftags%2F3.2.83%2Fsrc%2FPackage%2Fviews%2Fpackages-shortcode-toolbar.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/download-manager/trunk/src/Package/views/packages-shortcode-toolbar.php?rev=2799791 "Revision 2799791")
* [Next Revision](/browser/download-manager/trunk/src/Package/views/packages-shortcode-toolbar.php?rev=3040495 "Revision 3040495") →
* [Blame](/browser/download-manager/trunk/src/Package/views/packages-shortcode-toolbar.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/download-manager/tags/3.2.83/src/Package/views/packages-shortcode-toolbar.php)

---

# [source:](/browser?order=name "Go to repository root") [download-manager](/browser/download-manager?order=name "View download-manager")/[tags](/browser/download-manager/tags?order=name "View tags")/[3.2.83](/browser/download-manager/tags/3.2.83?order=name "View 3.2.83")/[src](/browser/download-manager/tags/3.2.83/src?order=name "View src")/[Package](/browser/download-manager/tags/3.2.83/src/Package?order=name "View Package")/[views](/browser/download-manager/tags/3.2.83/src/Package/views?order=name "View views")/[packages-shortcode-toolbar.php](/browser/download-manager/tags/3.2.83/src/Package/views/packages-shortcode-toolbar.php?order=name "View packages-shortcode-toolbar.php")

View diff against:

View revision:

| [Last change](/changeset/2825417/download-manager/trunk/src/Package/views/packages-shortcode-toolbar.php "View differences") on this file was [2825417](/changeset/2825417/ "View changeset 2825417"), checked in by codename065, [2 years ago](/timeline?from=2022-11-28T18%3A45%3A15Z&precision=second "See timeline at 11/28/2022 06:45:15 PM") |
| --- |
| 3.2.60 - 2022.11.29  * Fixed an input validation issue with the search bar in wpdm shortcodes * Added a new page template |
| * Property **svn:eol-style** set to   *`native`* | |
| **File size:** 6.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Base: wpdmpro |
| [4](#L4) | \* Developer: shahjada |
| [5](#L5) | \* Team: W3 Eden |
| [6](#L6) | \* Date: 6/6/20 09:48 |
| [7](#L7) | \*/ |
| [8](#L8) |  |
| [9](#L9) | //$tbgrid - Toolbar grid layout setting variable, 12 grid layout distribute amonng search bar, order by dropdown, order dropdown, and filter button |
| [10](#L10) | //$sr - Search bar width |
| [11](#L11) | //$ob - Orderby dropdown width |
| [12](#L12) | //$od - Order dropdown width |
| [13](#L13) | //$bt - Button area width |
| [14](#L14) | if(!defined("ABSPATH")) die(); |
| [15](#L15) | list($sr, $ob, $od, $bt) = [6,2,2,2]; |
| [16](#L16) | if(isset($tbgrid)){ |
| [17](#L17) | list($sr, $ob, $od, $bt) = explode(",", $tbgrid); |
| [18](#L18) | } |
| [19](#L19) | //Show  toolbar on post type archive |
| [20](#L20) | if(is\_post\_type\_archive()) $toolbar = 1; |
| [21](#L21) | if ($toolbar) { |
| [22](#L22) | ?> |
| [23](#L23) | <form method="get" class="<?php if(isset($async) && (int)$async === 1) echo '\_\_wpdm\_submit\_async'; ?>" data-container="#content\_<?php echo $scid; ?>" id="sc\_form\_<?php echo $scid; ?>" style="margin-bottom: 15px"> |
| [24](#L24) | <?php |
| [25](#L25) | if ($toolbar !== 'skinny' && $title !== '') { |
| [26](#L26) |  |
| [27](#L27) |  |
| [28](#L28) | ?> |
| [29](#L29) | <div class="panel panel-default card category-panel wpdm-shortcode-toolbar"> |
| [30](#L30) | <div class="panel-body card-body"> |
| [31](#L31) | <div class="media"> |
| [32](#L32) | <?php echo isset($icon) ? $icon : ''; ?> |
| [33](#L33) | <div class="media-body"> |
| [34](#L34) | <h3 style="margin: 0"><?php echo $title; ?></h3> |
| [35](#L35) | <?php echo $desc; ?> |
| [36](#L36) | </div> |
| [37](#L37) | </div> |
| [38](#L38) | </div> |
| [39](#L39) | <div class="panel-footer card-footer"> |
| [40](#L40) | <div class="row"> |
| [41](#L41) | <div class="col-lg-<?php echo $sr; ?> col-md-12"> |
| [42](#L42) | <input type="text" name="skw" value="<?php echo stripslashes\_deep(wpdm\_query\_var('skw', 'esc\_attr')) ?>" placeholder="<?php echo \_\_( "Search Keyword...", "download-manager" ); ?>" class="form-control" /> |
| [43](#L43) | </div> |
| [44](#L44) | <div class="col-lg-<?php echo $ob; ?> col-md-4"> |
| [45](#L45) | <select name="orderby" class="wpdm-custom-select custom-select"> |
| [46](#L46) | <option value="date" disabled="disabled"><?php echo \_\_( "Order By:", "download-manager" ) ?></option> |
| [47](#L47) | <option value="date" <?php selected('date', wpdm\_query\_var('orderby')) ?>><?php echo \_\_( "Publish Date", "download-manager" ) ?></option> |
| [48](#L48) | <option value="title" <?php selected('title', wpdm\_query\_var('orderby')) ?>><?php echo \_\_( "Title", "download-manager" ) ?></option> |
| [49](#L49) | <option value="update\_date" <?php selected('update\_date', wpdm\_query\_var('orderby')) ?>><?php echo \_\_( "Update Date", "download-manager" ) ?></option> |
| [50](#L50) | <option value="downloads" <?php selected('downloads', wpdm\_query\_var('orderby')) ?>><?php echo \_\_( "Downloads", "download-manager" ) ?></option> |
| [51](#L51) | <option value="views" <?php selected('views', wpdm\_query\_var('orderby')) ?>><?php echo \_\_( "Views", "download-manager" ) ?></option> |
| [52](#L52) | </select> |
| [53](#L53) | </div> |
| [54](#L54) | <div class="col-lg-<?php echo $od; ?> col-md-4"> |
| [55](#L55) | <select name="order" class="wpdm-custom-select custom-select"> |
| [56](#L56) | <option value="desc" disabled="disabled"><?php echo \_\_( "Order:", "download-manager" ) ?></option> |
| [57](#L57) | <option value="desc" <?php selected('desc', wpdm\_query\_var('order')) ?>><?php echo \_\_( "Descending", "download-manager" ) ?></option> |
| [58](#L58) | <option value="asc" <?php selected('asc', wpdm\_query\_var('order')) ?>><?php echo \_\_( "Ascending", "download-manager" ) ?></option> |
| [59](#L59) | </select> |
| [60](#L60) | </div> |
| [61](#L61) | <div class="col-lg-<?php echo $bt; ?> col-md-4"> |
| [62](#L62) | <button type="submit" class="btn btn-secondary btn-block"><?php echo \_\_( "Apply Filter", "download-manager" ) ?></button> |
| [63](#L63) | </div> |
| [64](#L64) | </div> |
| [65](#L65) |  |
| [66](#L66) | </div> |
| [67](#L67) | </div> |
| [68](#L68) | <?php |
| [69](#L69) | } else { |
| [70](#L70) | ?> |
| [71](#L71) |  |
| [72](#L72) | <div class="card panel panel-default wpdm-shortcode-toolbar"> |
| [73](#L73) | <div class="card-body panel-body"> |
| [74](#L74) | <div class="row"> |
| [75](#L75) | <div class="col-lg-<?php echo $sr; ?> col-md-12"> |
| [76](#L76) | <input type="search" name="skw" value="<?php echo stripslashes\_deep(wpdm\_query\_var('skw', 'esc\_attr')) ?>" placeholder="<?php echo \_\_( "Search Keyword...", "download-manager" ); ?>" class="form-control" /> |
| [77](#L77) | </div> |
| [78](#L78) | <div class="col-lg-<?php echo $ob; ?> col-md-4"> |
| [79](#L79) | <select name="orderby" class="wpdm-custom-select custom-select"> |
| [80](#L80) | <option value="date" disabled="disabled"><?php echo \_\_( "Order By:", "download-manager" ) ?></option> |
| [81](#L81) | <option value="date" <?php selected('date', wpdm\_query\_var('orderby')) ?>><?php echo \_\_( "Publish Date", "download-manager" ) ?></option> |
| [82](#L82) | <option value="title" <?php selected('title', wpdm\_query\_var('orderby')) ?>><?php echo \_\_( "Title", "download-manager" ) ?></option> |
| [83](#L83) | <option value="update\_date" <?php selected('update\_date', wpdm\_query\_var('orderby')) ?>><?php echo \_\_( "Update Date", "download-manager" ) ?></option> |
| [84](#L84) | <option value="downloads" <?php selected('downloads', wpdm\_query\_var('orderby')) ?>><?php echo \_\_( "Downloads", "download-manager" ) ?></option> |
| [85](#L85) | <option value="views" <?php selected('views', wpdm\_query\_var('orderby')) ?>><?php echo \_\_( "Views", "download-manager" ) ?></option> |
| [86](#L86) | </select> |
| [87](#L87) | </div> |
| [88](#L88) | <div class="col-lg-<?php echo $od; ?> col-md-4"> |
| [89](#L89) | <select name="order" class="wpdm-custom-select custom-select"> |
| [90](#L90) | <option value="desc" disabled="disabled"><?php echo \_\_( "Order:", "download-manager" ) ?></option> |
| [91](#L91) | <option value="desc" <?php selected('desc', wpdm\_query\_var('order')) ?>><?php echo \_\_( "Descending", "download-manager" ) ?></option> |
| [92](#L92) | <option value="asc" <?php selected('asc', wpdm\_query\_var('order')) ?>><?php echo \_\_( "Ascending", "download-manager" ) ?></option> |
| [93](#L93) | </select> |
| [94](#L94) | </div> |
| [95](#L95) | <div class="col-lg-<?php echo $bt; ?> col-md-4"> |
| [96](#L96) | <button type="submit" class="btn btn-secondary btn-block"><?php echo \_\_( "Apply Filter", "download-manager" ) ?></button> |
| [97](#L97) | </div> |
| [98](#L98) | </div> |
| [99](#L99) | </div> |
| [100](#L100) | </div> |
| [101](#L101) |  |
| [102](#L102) | <?php |
| [103](#L103) | } |
| [104](#L104) | ?> |
| [105](#L105) | </form> |
| [106](#L106) | <div class="spacer mb-3 d-block clearfix"></div> |
| [107](#L107) | <?php } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/download-manager/tags/3.2.83/src/Package/views/packages-shortcode-toolbar.php?format=txt)
* [Original Format](/export/3220461/download-manager/tags/3.2.83/src/Package/views/packages-shortcode-toolbar.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_36c86459_20250110_213054.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Download Manager <= 3.2.85 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Download Manager <= 3.2.85 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2023-6954](https://www.cve.org/CVERecord?id=CVE-2023-6954) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | February 28, 2024 |
| Last Updated | March 13, 2024 |
| Researcher | [Richard Telleng (stueotue)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/richard-telleng) |

### Description

The Download Manager Pro plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the plugin's shortcode(s) in all versions up to, and including, 3.2.85 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers with contributor-level and above permissions to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/download-manager/tags/3.2.83/src/Category/Shortcodes.php#L14)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/download-manager/tags/3.2.83/src/Package/Shortcodes.php#L106)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/download-manager/tags/3.2.83/src/Package/views/packages-shortcode.php)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/download-manager/tags/3.2.83/src/Package/views/packages-shortcode-toolbar.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdownload-manager%2Fdownload-manager-3285-authenticated-contributor-stored-cross-site-scripting-via-shortcode&t=Download%20Manager%20%3C%3D%203.2.85%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdownload-manager%2Fdownload-manager-3285-authenticated-contributor-stored-cross-site-scripting-via-shortcode&text=Download%20Manager%20%3C%3D%203.2.85%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdownload-manager%2Fdownload-manager-3285-authenticated-contributor-stored-cross-site-scripting-via-shortcode "LinkedIn")
Email

## Vulnerability Details for Download Manager

#### [Download Manager](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/download-manager)

| Software Type | Plugin |
| --- | --- |
| Software Slug | download-manager [(view on wordpress.org)](https://wordpress.org/plugins/download-manager) |
| Patched? | Yes |
| Remediation | Update to version 3.2.86, or a newer patched version |
| Affected Version | * <= 3.2.85 |
| Patched Version | * 3.2.86 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_880daae1_20250110_213033.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fdownload-manager%2Ftags%2F3.2.83%2Fsrc%2FCategory%2FShortcodes.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/download-manager/trunk/src/Category/Shortcodes.php?rev=2558306 "Revision 2558306")
* [Next Revision](/browser/download-manager/trunk/src/Category/Shortcodes.php?rev=3040495 "Revision 3040495") →
* [Blame](/browser/download-manager/trunk/src/Category/Shortcodes.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/download-manager/tags/3.2.83/src/Category/Shortcodes.php)

---

# [source:](/browser?order=name "Go to repository root") [download-manager](/browser/download-manager?order=name "View download-manager")/[tags](/browser/download-manager/tags?order=name "View tags")/[3.2.83](/browser/download-manager/tags/3.2.83?order=name "View 3.2.83")/[src](/browser/download-manager/tags/3.2.83/src?order=name "View src")/[Category](/browser/download-manager/tags/3.2.83/src/Category?order=name "View Category")/[Shortcodes.php](/browser/download-manager/tags/3.2.83/src/Category/Shortcodes.php?order=name "View Shortcodes.php")

View diff against:

View revision:

| [Last change](/changeset/2605221/download-manager/trunk/src/Category/Shortcodes.php "View differences") on this file was [2605221](/changeset/2605221/ "View changeset 2605221"), checked in by codename065, [3 years ago](/timeline?from=2021-09-27T01%3A57%3A28Z&precision=second "See timeline at 09/27/2021 01:57:28 AM") |
| --- |
| 3.2.16 - 2021.09.27  * Fixed an issue with the pagination function * Improved UI class * Improved category and packages shortcode * Fixed package sorting issue with the category and package shortcode * Fixed RTL layout issue with wpdm admin settings page |
| * Property **svn:eol-style** set to   *`native`* | |
| **File size:** 1.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) |  |
| [4](#L4) | namespace WPDM\Category; |
| [5](#L5) |  |
| [6](#L6) |  |
| [7](#L7) | use WPDM\\_\_\Template; |
| [8](#L8) | use WPDM\\_\_\Query; |
| [9](#L9) |  |
| [10](#L10) | class Shortcodes |
| [11](#L11) | { |
| [12](#L12) | function \_\_construct() |
| [13](#L13) | { |
| [14](#L14) | add\_shortcode("wpdm\_category", [$this, 'listPackages']); |
| [15](#L15) | add\_shortcode('wpdm\_category\_link', [$this, 'categoryLink']); |
| [16](#L16) | } |
| [17](#L17) |  |
| [18](#L18) | function listPackages($params = array('id' => '', 'operator' => 'IN', 'items\_per\_page' => 10, 'title' => false, 'desc' => false, 'orderby' => 'create\_date', 'order' => 'desc', 'paging' => false, 'toolbar' => 1, 'template' => '', 'cols' => 3, 'colspad' => 2, 'colsphone' => 1, 'morelink' => 1)) |
| [19](#L19) | { |
| [20](#L20) | $params['categories'] = $params['id']; |
| [21](#L21) | $params['catsc'] = 1; |
| [22](#L22) | unset($params['id']); |
| [23](#L23) |  |
| [24](#L24) | if(!in\_array(wpdm\_valueof($params, 'cat\_field'), ['id', 'term\_id'])) { |
| [25](#L25) | $ids = []; |
| [26](#L26) | foreach (explode(",", $params['categories']) as $slug) { |
| [27](#L27) | $term = get\_term\_by('slug', $slug, 'wpdmcategory'); |
| [28](#L28) | if($term) |
| [29](#L29) | $ids[] = $term->term\_id; |
| [30](#L30) | } |
| [31](#L31) | if(count($ids) > 0) { |
| [32](#L32) | $params['categories'] = implode(",", $ids); |
| [33](#L33) | $params['cat\_field'] = 'id'; |
| [34](#L34) | } |
| [35](#L35) | } |
| [36](#L36) | return WPDM()->package->shortCodes->packages($params); |
| [37](#L37) |  |
| [38](#L38) | } |
| [39](#L39) |  |
| [40](#L40) | function categoryLink($params) |
| [41](#L41) | { |
| [42](#L42) | $category = new Category(wpdm\_valueof($params, 'id')); |
| [43](#L43) | if(!$category->ID) return ''; |
| [44](#L44) | $cat = (array)$category; |
| [45](#L45) | $cat['icon'] = $category->icon ? "<img src='{category->icon}' alt='{$category->name}' />" : ""; |
| [46](#L46) | $template = isset($params['template']) && $params['template'] != '' ? $params['template'] : 'category-link-shortcode.php'; |
| [47](#L47) | return Template::output($template, $cat, \_\_DIR\_\_.'/views'); |
| [48](#L48) | } |
| [49](#L49) |  |
| [50](#L50) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/download-manager/tags/3.2.83/src/Category/Shortcodes.php?format=txt)
* [Original Format](/export/3220461/download-manager/tags/3.2.83/src/Category/Shortcodes.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_4aa9e970_20250110_213039.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fdownload-manager%2Ftags%2F3.2.83%2Fsrc%2FPackage%2FShortcodes.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/download-manager/trunk/src/Package/Shortcodes.php?rev=2852690 "Revision 2852690")
* [Next Revision](/browser/download-manager/trunk/src/Package/Shortcodes.php?rev=3038209 "Revision 3038209") →
* [Blame](/browser/download-manager/trunk/src/Package/Shortcodes.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/download-manager/tags/3.2.83/src/Package/Shortcodes.php)

---

# [source:](/browser?order=name "Go to repository root") [download-manager](/browser/download-manager?order=name "View download-manager")/[tags](/browser/download-manager/tags?order=name "View tags")/[3.2.83](/browser/download-manager/tags/3.2.83?order=name "View 3.2.83")/[src](/browser/download-manager/tags/3.2.83/src?order=name "View src")/[Package](/browser/download-manager/tags/3.2.83/src/Package?order=name "View Package")/[Shortcodes.php](/browser/download-manager/tags/3.2.83/src/Package/Shortcodes.php?order=name "View Shortcodes.php")

View diff against:

View revision:

| [Last change](/changeset/2936865/download-manager/trunk/src/Package/Shortcodes.php "View differences") on this file was [2936865](/changeset/2936865/ "View changeset 2936865"), checked in by codename065, [18 months ago](/timeline?from=2023-07-11T01%3A15%3A08Z&precision=second "See timeline at 07/11/2023 01:15:08 AM") |
| --- |
| 3.2.74 - 2023.07.11  * Added a new hook to control frontend styles * Added a shortcode parameter to add custom message to show when no package found |
| * Property **svn:eol-style** set to   *`native`* | |
| **File size:** 17.6 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) |  |
| [4](#L4) | namespace WPDM\Package; |
| [5](#L5) |  |
| [6](#L6) |  |
| [7](#L7) | use WPDM\\_\_\\_\_; |
| [8](#L8) | use WPDM\\_\_\Template; |
| [9](#L9) | use WPDM\\_\_\Crypt; |
| [10](#L10) | use WPDM\\_\_\Query; |
| [11](#L11) |  |
| [12](#L12) | class Shortcodes |
| [13](#L13) | { |
| [14](#L14) | function \_\_construct() |
| [15](#L15) | { |
| [16](#L16) | // Single package shortcode |
| [17](#L17) | add\_shortcode("wpdm\_package", [$this, 'singlePackage']); |
| [18](#L18) |  |
| [19](#L19) | // Generate direct download link |
| [20](#L20) | add\_shortcode('wpdm\_direct\_link', [$this, 'directLink']); |
| [21](#L21) |  |
| [22](#L22) | // Show all packages |
| [23](#L23) | add\_shortcode('wpdm\_packages', [$this, 'packages']); |
| [24](#L24) |  |
| [25](#L25) | //Packages by tag |
| [26](#L26) | add\_shortcode("wpdm\_tag", [$this, 'packagesByTag']); |
| [27](#L27) |  |
| [28](#L28) | // Total Package Count |
| [29](#L29) | add\_shortcode('wpdm\_download\_count', [$this, 'totalDownloads']); |
| [30](#L30) |  |
| [31](#L31) | // Total Package Count |
| [32](#L32) | add\_shortcode('wpdm\_package\_count', [$this, 'totalPackages']); |
| [33](#L33) |  |
| [34](#L34) | // Show all packages in a responsive table |
| [35](#L35) | add\_shortcode('wpdm\_all\_packages', [$this, 'allPackages']); |
| [36](#L36) | add\_shortcode('wpdm-all-packages', [$this, 'allPackages']); |
| [37](#L37) |  |
| [38](#L38) | //Search downloads |
| [39](#L39) | add\_shortcode('wpdm\_search\_result', [$this, 'searchResult']); |
| [40](#L40) |  |
| [41](#L41) |  |
| [42](#L42) | } |
| [43](#L43) |  |
| [44](#L44) | /\*\* |
| [45](#L45) | \* Callback function for [wpdm\_package..] |
| [46](#L46) | \* @param array $params |
| [47](#L47) | \* @return string |
| [48](#L48) | \*/ |
| [49](#L49) | function singlePackage($params = []) |
| [50](#L50) | { |
| [51](#L51) | $id = wpdm\_valueof($params, 'id', [ 'validate' => 'int' ]); |
| [52](#L52) |  |
| [53](#L53) | if(!$id && is\_singular('wpdmpro')) $id = get\_the\_ID(); |
| [54](#L54) |  |
| [55](#L55) | //Return if id is invalid |
| [56](#L56) | if (!$id || get\_post\_type($id) !== 'wpdmpro') return ''; |
| [57](#L57) |  |
| [58](#L58) | //Link template |
| [59](#L59) | $template = isset($params['template']) ? $params['template'] : get\_post\_meta($id, '\_\_wpdm\_template', true); |
| [60](#L60) | if ($template == '') $template = 'link-template-default.php'; |
| [61](#L61) | $pack = new Package($id); |
| [62](#L62) | $html = "<div class='w3eden'>" . $pack->fetchTemplate($template, $id, 'link') . "</div>"; |
| [63](#L63) |  |
| [64](#L64) | return $html; |
| [65](#L65) | } |
| [66](#L66) |  |
| [67](#L67) | /\*\* |
| [68](#L68) | \* @usage Generate direct link to download |
| [69](#L69) | \* @param $params |
| [70](#L70) | \* @param string $content |
| [71](#L71) | \* @return string |
| [72](#L72) | \*/ |
| [73](#L73) | function directLink($params, $content = "") |
| [74](#L74) | { |
| [75](#L75) | extract($params); |
| [76](#L76) |  |
| [77](#L77) | global $wpdb; |
| [78](#L78) | $ID = (int)$params['id']; |
| [79](#L79) |  |
| [80](#L80) | if (WPDM()->package->isLocked($ID)) |
| [81](#L81) | $linkURL = get\_permalink($ID); |
| [82](#L82) | else |
| [83](#L83) | $linkURL = home\_url("/?wpdmdl=" . $ID); |
| [84](#L84) |  |
| [85](#L85) | $extras = isset($params['extras']) ? wpdm\_sanitize\_var($params['extras'], 'txt') : ""; |
| [86](#L86) | $target = isset($params['target']) ? "target='" . wpdm\_sanitize\_var($params['target'], 'txt') . "'" : ""; |
| [87](#L87) | $class = isset($params['class']) ? "class='" . wpdm\_sanitize\_var($params['class'], 'txt') . "'" : ""; |
| [88](#L88) | $style = isset($params['style']) ? "style='" . wpdm\_sanitize\_var($params['style'], 'txt') . "'" : ""; |
| [89](#L89) | $rel = isset($params['rel']) ? "rel='" . wpdm\_sanitize\_var($params['rel'], 'txt') . "'" : ""; |
| [90](#L90) | $eid = isset($params['eid']) ? "id='" . wpdm\_sanitize\_var($params['eid'], 'txt') . "'" : ""; |
| [91](#L91) | $linkLabel = isset($params['label']) && !empty($params['label']) ? $params['label'] : get\_post\_meta($ID, '\_\_wpdm\_link\_label', true); |
| [92](#L92) | $linkLabel = empty($linkLabel) ? get\_the\_title($ID) : $linkLabel; |
| [93](#L93) | $linkLabel = wpdm\_sanitize\_var($linkLabel, 'kses'); |
| [94](#L94) | return "<a {$target} {$class} {$eid} {$style} {$rel} {$extras} href='$linkURL'>$linkLabel</a>"; |
| [95](#L95) |  |
| [96](#L96) | } |
| [97](#L97) |  |
| [98](#L98) | /\*\* |
| [99](#L99) | \* @param array $params |
| [100](#L100) | \* @return string |
| [101](#L101) | \*/ |
| [102](#L102) | /\*\* |
| [103](#L103) | \* @param array $params |
| [104](#L104) | \* @return string |
| [105](#L105) | \*/ |
| [106](#L106) | function packages($params = array('items\_per\_page' => 10, 'title' => '', 'desc' => '', 'orderby' => 'date', 'order' => 'DESC', 'paging' => false, 'page\_numbers' => true, 'toolbar' => 1, 'template' => '', 'cols' => 3, 'colspad' => 2, 'colsphone' => 1, 'tags' => '', 'categories' => '', 'year' => '', 'month' => '', 's' => '', 'css\_class' => 'wpdm\_packages', 'scid' => '', 'async' => 1, 'tax' => '', 'terms' => '', 'not\_found' => 'No downloads available!')) |
| [107](#L107) | { |
| [108](#L108) | global $current\_user, $post; |
| [109](#L109) |  |
| [110](#L110) | static $wpdm\_packages = 0; |
| [111](#L111) |  |
| [112](#L112) | $params = \_\_::a($params, ['items\_per\_page' => 10, 'title' => '', 'desc' => '', 'orderby' => 'date', 'order' => 'DESC', 'paging' => false, 'page\_numbers' => true, 'toolbar' => 1, 'template' => '', 'cols' => 3, 'colspad' => 2, 'colsphone' => 1, 'tags' => '', 'categories' => '', 'year' => '', 'month' => '', 's' => '', 'css\_class' => 'wpdm\_packages', 'scid' => '', 'async' => 1, 'tax' => '', 'terms' => '', 'not\_found' => 'No downloads available!']); |
| [113](#L113) |  |
| [114](#L114) | // When login=1, show login form for guests/visitors |
| [115](#L115) | if (isset($params['login']) && $params['login'] == 1 && !is\_user\_logged\_in()) |
| [116](#L116) | return WPDM()->user->login->form($params); |
| [117](#L117) |  |
| [118](#L118) | // To generate unique sections ID when someone uses multiple shortcode on a page |
| [119](#L119) | $wpdm\_packages++; |
| [120](#L120) |  |
| [121](#L121) | // $scparams = Initial unprocessed shortcode parameters |
| [122](#L122) | $scparams = $params; |
| [123](#L123) |  |
| [124](#L124) |  |
| [125](#L125) |  |
| [126](#L126) | $async = \_\_::valueof($params, 'async', ['default' => 0, 'validate' => 'int']); |
| [127](#L127) | $items\_per\_page = \_\_::valueof($params, 'items\_per\_page', 10); |
| [128](#L128) | if($items\_per\_page < 1) $items\_per\_page = 10; |
| [129](#L129) | $scid = \_\_::valueof($params, 'scid', ['default' => 'wpdm\_package\_'.$wpdm\_packages, 'validate' => 'txt']); |
| [130](#L130) | $cwd\_class = "col-lg-" . (int)(12 / \_\_::valueof($params, 'cols', ['default' => 3, 'validate' => 'int'])); |
| [131](#L131) | $cwdsm\_class = "col-md-" . (int)(12 /  \_\_::valueof($params, 'colspad', ['default' => 2, 'validate' => 'int'])); |
| [132](#L132) | $cwdxs\_class = "col-" . (int)(12 /  \_\_::valueof($params, 'colsphone', ['default' => 1, 'validate' => 'int'])); |
| [133](#L133) |  |
| [134](#L134) | $title = \_\_::valueof($params, 'title', ['validate' => 'txt']); |
| [135](#L135) | $desc = \_\_::valueof($params, 'desc', ['validate' => 'txt']); |
| [136](#L136) | $toolbar = \_\_::valueof($params, 'toolbar', ['default' => 1, 'validate' => 'int']); |
| [137](#L137) | $paging = \_\_::valueof($params, 'paging', ['default' => 1, 'validate' => 'int']); |
| [138](#L138) |  |
| [139](#L139) | $order\_field = \_\_::valueof($params, 'orderby', 'date'); |
| [140](#L140) | $order\_field = isset($\_REQUEST['orderby'])? wpdm\_query\_var('orderby') : $order\_field; |
| [141](#L141) | $order = \_\_::valueof($params, 'order', 'desc'); |
| [142](#L142) | $order = isset($\_REQUEST['order'])? wpdm\_query\_var('order') : $order; |
| [143](#L143) |  |
| [144](#L144) | $currentPage = \_\_::query\_var('cp', 'int'); |
| [145](#L145) | if (!$currentPage) $currentPage = 1; |
| [146](#L146) |  |
| [147](#L147) | $query = new Query(); |
| [148](#L148) | $query->items\_per\_page(wpdm\_valueof($params, 'items\_per\_page', 10)); |
| [149](#L149) | $query->paged($currentPage); |
| [150](#L150) | $query->sort($order\_field, $order); |
| [151](#L151) |  |
| [152](#L152) | foreach ($scparams as $key => $value) { |
| [153](#L153) | if (method\_exists($query, $key) && !in\_array($key, ['categories', 'tags'])) { |
| [154](#L154) | $query->$key($value); |
| [155](#L155) | } |
| [156](#L156) | } |
| [157](#L157) |  |
| [158](#L158) | /\*\* |
| [159](#L159) | \* Process "categories" parameter |
| [160](#L160) | \* Usually values are category slug(s), users may use id(s) too |
| [161](#L161) | \* If users uses slugs, convert slugs into ids |
| [162](#L162) | \*\*/ |
| [163](#L163) | if(wpdm\_valueof($scparams, 'categories') !== '') { |
| [164](#L164) | $categories = wpdm\_valueof($scparams, 'categories'); |
| [165](#L165) | $categories = explode(",", $categories); |
| [166](#L166) | /\*\* |
| [167](#L167) | \* Convert slugs to ID |
| [168](#L168) | \*/ |
| [169](#L169) | foreach ($categories as &$cat) { |
| [170](#L170) | if (!is\_numeric($cat) && $cat !== '') { |
| [171](#L171) | $catObj = get\_term\_by('slug', $cat, 'wpdmcategory'); |
| [172](#L172) | $cat = $catObj->term\_id; |
| [173](#L173) | } |
| [174](#L174) | } |
| [175](#L175) | $operator = wpdm\_valueof($scparams, 'operator', ['default' => 'IN']); |
| [176](#L176) | $include\_children = wpdm\_valueof($scparams, 'include\_children', ['default' => false]); |
| [177](#L177) | $query->categories($categories, 'term\_id', $operator, $include\_children); |
| [178](#L178) | } |
| [179](#L179) |  |
| [180](#L180) | if(wpdm\_valueof($scparams, 'tags') !== '') { |
| [181](#L181) | $tags = wpdm\_valueof($scparams, 'tags'); |
| [182](#L182) | $operator = wpdm\_valueof($scparams, 'operator', ['default' => 'IN']); |
| [183](#L183) | $query->tags($tags, 'slug', $operator); |
| [184](#L184) | } |
| [185](#L185) |  |
| [186](#L186) | if (wpdm\_query\_var('skw', 'txt') != '') { |
| [187](#L187) | $query->s(wpdm\_query\_var('skw', 'txt')); |
| [188](#L188) | } |
| [189](#L189) |  |
| [190](#L190) | if(wpdm\_valueof($scparams, 'tax') !== '') { |
| [191](#L191) | $\_terms = explode("|", wpdm\_valueof($scparams, 'terms')); |
| [192](#L192) | $taxos = explode("|", wpdm\_valueof($scparams, 'tax')); |
| [193](#L193) | foreach ($taxos as $index => $\_taxo) { |
| [194](#L194) | $terms = wpdm\_valueof($\_terms, $index); |
| [195](#L195) | $terms = explode(",", $terms); |
| [196](#L196) | if(count($terms) > 0) { |
| [197](#L197) |  |
| [198](#L198) | $query->taxonomy($\_taxo, $terms); |
| [199](#L199) | } |
| [200](#L200) | } |
| [201](#L201) | } |
| [202](#L202) |  |
| [203](#L203) | $query->taxonomy\_relation(wpdm\_valueof($scparams, 'relation', ['default' => 'AND'])); |
| [204](#L204) |  |
| [205](#L205) | if (get\_option('\_wpdm\_hide\_all', 0) == 1) { |
| [206](#L206) | $query->meta("\_\_wpdm\_access", '"guest"'); |
| [207](#L207) |  |
| [208](#L208) | if (is\_user\_logged\_in()) { |
| [209](#L209) | foreach ($current\_user->roles as $role) { |
| [210](#L210) | $query->meta("\_\_wpdm\_access", $role); |
| [211](#L211) | } |
| [212](#L212) | $query->meta\_relation('OR'); |
| [213](#L213) | } |
| [214](#L214) | } |
| [215](#L215) |  |
| [216](#L216) | // Date filter |
| [217](#L217) | if (isset($scparams['year']) || isset($scparams['month']) || isset($scparams['day'])) { |
| [218](#L218) |  |
| [219](#L219) | if (isset($scparams['day'])) { |
| [220](#L220) | $day = ($scparams['day'] == 'today') ? date('d') : $scparams['day']; |
| [221](#L221) | $query->filter('day', $day); |
| [222](#L222) | } |
| [223](#L223) |  |
| [224](#L224) | if (isset($scparams['month'])) { |
| [225](#L225) | $month = ($scparams['month'] == 'this') ? date('Ym') : $scparams['month']; |
| [226](#L226) | $query->filter('m', $month); |
| [227](#L227) | } |
| [228](#L228) |  |
| [229](#L229) | if (isset($scparams['year'])) { |
| [230](#L230) | $year = ($scparams['year'] == 'this') ? date('Y') : $scparams['year']; |
| [231](#L231) | $query->filter('year', $year); |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) | if (isset($scparams['week'])) { |
| [235](#L235) | $week = ($scparams['week'] == 'this') ? date('W') : $scparams['week']; |
| [236](#L236) | $query->filter('week', $week); |
| [237](#L237) | } |
| [238](#L238) | } |
| [239](#L239) |  |
| [240](#L240) | $query->post\_status('publish'); |
| [241](#L241) | $query->process(); |
| [242](#L242) | $total = $query->count; |
| [243](#L243) | $packages = $query->packages(); |
| [244](#L244) |  |
| [245](#L245) | $pages = ceil($total / $items\_per\_page); |
| [246](#L246) | $page = isset($\_GET['cp']) ? (int)$\_GET['cp'] : 1; |
| [247](#L247) | $start = ($page - 1) \* $items\_per\_page; |
| [248](#L248) |  |
| [249](#L249) |  |
| [250](#L250) | $html = ''; |
| [251](#L251) |  |
| [252](#L252) | foreach ($packages as $pack){ |
| [253](#L253) | $pack = (array)$pack; |
| [254](#L254) | //$repeater = "<div class='{$cwd\_class} {$cwdsm\_class} {$cwdxs\_class}'>" . \WPDM\Package::fetchTemplate(wpdm\_valueof($scparams, 'template', 'link-template-default.php'), $pack) . "</div>"; |
| [255](#L255) | $repeater = "<div class='{$cwd\_class} {$cwdsm\_class} {$cwdxs\_class}'>" . WPDM()->package->fetchTemplate(wpdm\_valueof($scparams, 'template', 'link-template-default.php'), $pack) . "</div>"; |
| [256](#L256) | $html .= $repeater; |
| [257](#L257) |  |
| [258](#L258) | } |
| [259](#L259) |  |
| [260](#L260) | $not\_found\_msg = wpdm\_valueof($scparams, 'not\_found') ?: \_\_('No downloads found!', WPDM\_TEXT\_DOMAIN); |
| [261](#L261) | if($total === 0) $html = "<div class='col-md-12'>{$not\_found\_msg}</div>"; |
| [262](#L262) |  |
| [263](#L263) | $html = "<div class='row'>{$html}</div>"; |
| [264](#L264) |  |
| [265](#L265) | $\_scparams = Crypt::encrypt($scparams); |
| [266](#L266) | if (!isset($paging) || intval($paging) == 1) { |
| [267](#L267) | //sc\_params={$\_scparams}& |
| [268](#L268) | $pag\_links = wpdm\_paginate\_links($total, $items\_per\_page, $page, 'cp', array( 'format' => "?cp=%#%",'container' => '#content\_' . $scid, 'async' => $async, 'next\_text' => ' <i style="display: inline-block;width: 8px;height: 8px;border-right: 2px solid;border-top: 2px solid;transform: rotate(45deg);margin-left: -2px;margin-top: -2px;"></i> ', 'prev\_text' => ' <i style="display: inline-block;width: 8px;height: 8px;border-right: 2px solid;border-bottom: 2px solid;transform: rotate(135deg);margin-left: 2px;margin-top: -2px;"></i> ')); |
| [269](#L269) | $pagination = "<div style='clear:both'></div>" . $pag\_links . "<div style='clear:both'></div>"; |
| [270](#L270) | } else |
| [271](#L271) | $pagination = ""; |
| [272](#L272) |  |
| [273](#L273) | global $post; |
| [274](#L274) |  |
| [275](#L275) | $burl = get\_permalink(); |
| [276](#L276) | $sap = get\_option('permalink\_structure') ? '?' : '&'; |
| [277](#L277) | $burl = $burl . $sap; |
| [278](#L278) | if (isset($\_GET['p']) && $\_GET['p'] != '') $burl .= 'p=' . wpdm\_query\_var('p', 'txt') . '&'; |
| [279](#L279) | if (isset($\_GET['src']) && $\_GET['src'] != '') $burl .= 'src=' . wpdm\_query\_var('src', 'txt') . '&'; |
| [280](#L280) | $orderby = isset($\_GET['orderby']) ? wpdm\_query\_var('orderby', 'txt') : 'date'; |
| [281](#L281) | $order = ucfirst($order); |
| [282](#L282) |  |
| [283](#L283) | $order\_field = " " . \_\_(ucwords(str\_replace("\_", " ", $order\_field)), "wpdmpro"); |
| [284](#L284) | $ttitle = \_\_("Title", "download-manager"); |
| [285](#L285) | $tdls = \_\_("Downloads", "download-manager"); |
| [286](#L286) | $tcdate = \_\_("Publish Date", "download-manager"); |
| [287](#L287) | $tudate = \_\_("Update Date", "download-manager"); |
| [288](#L288) | $tasc = \_\_("Asc", "download-manager"); |
| [289](#L289) | $tdsc = \_\_("Desc", "download-manager"); |
| [290](#L290) | $tsrc = \_\_("Search", "download-manager"); |
| [291](#L291) | $ord = \_\_("Order", "download-manager"); |
| [292](#L292) | $order\_by\_label = \_\_("Order By", "download-manager"); |
| [293](#L293) |  |
| [294](#L294) | $css\_class = isset($scparams['css\_class']) ? sanitize\_text\_field($scparams['css\_class']) : ''; |
| [295](#L295) | $desc = isset($scparams['desc']) ? sanitize\_text\_field($scparams['desc']) : ''; |
| [296](#L296) |  |
| [297](#L297) | $toolbar = isset($toolbar) ? $toolbar : 0; |
| [298](#L298) |  |
| [299](#L299) | ob\_start(); |
| [300](#L300) | include Template::locate("packages-shortcode.php", \_\_DIR\_\_.'/views'); |
| [301](#L301) | $content = ob\_get\_clean(); |
| [302](#L302) | return $content; |
| [303](#L303) | } |
| [304](#L304) |  |
| [305](#L305) | /\*\* |
| [306](#L306) | \* @usage Show packages by tag |
| [307](#L307) | \* @param $params |
| [308](#L308) | \* @return string |
| [309](#L309) | \*/ |
| [310](#L310) | function packagesByTag($params) |
| [311](#L311) | { |
| [312](#L312) | if(!$params || !isset($params['id'])) return ''; |
| [313](#L313) |  |
| [314](#L314) | $params['tags'] = $params['id']; |
| [315](#L315) | unset($params['id']); |
| [316](#L316) | return $this->packages($params); |
| [317](#L317) |  |
| [318](#L318) | } |
| [319](#L319) |  |
| [320](#L320) |  |
| [321](#L321) | /\*\* |
| [322](#L322) | \* @param array $params |
| [323](#L323) | \* @return array|null|\WP\_Post |
| [324](#L324) | \* @usage Shortcode callback function for [wpdm\_search\_result] |
| [325](#L325) | \*/ |
| [326](#L326) | function searchResult($params = array()) |
| [327](#L327) | { |
| [328](#L328) | global $wpdb; |
| [329](#L329) |  |
| [330](#L330) | if (is\_array($params)) |
| [331](#L331) | @extract($params); |
| [332](#L332) | $template = isset($template) && $template != '' ? $template : 'link-template-calltoaction3'; |
| [333](#L333) | $async = isset($async) ? $async : 0; |
| [334](#L334) | update\_post\_meta(get\_the\_ID(), "\_\_wpdm\_link\_template", $template); |
| [335](#L335) | $strm = wpdm\_query\_var('search', 'esc\_attr'); |
| [336](#L336) | if ($strm === '') $strm = wpdm\_query\_var('s', 'esc\_attr'); |
| [337](#L337) | //$strm = esc\_attr($strm); |
| [338](#L338) | $html = ''; |
| [339](#L339) | $cols = isset($cols) ? $cols : 1; |
| [340](#L340) | $items\_per\_page = isset($items\_per\_page) ? $items\_per\_page : $cols \* 6; |
| [341](#L341) | update\_post\_meta(get\_the\_ID(), "\_\_wpdm\_items\_per\_page", $items\_per\_page); |
| [342](#L342) | $colspad = isset($colspad) ? $colspad : 1; |
| [343](#L343) | $colsphone = isset($colsphone) ? $colsphone : 1; |
| [344](#L344) | if (($strm == '' && isset($init) && $init == 1) || $strm != '') |
| [345](#L345) | $html = $this->packages(array('items\_per\_page' => $items\_per\_page, 'template' => $template, 's' => $strm, 'paging' => true, 'toolbar' => 0, 'cols' => $cols, 'colsphone' => $colsphone, 'colspad' => $colspad, 'async' => $async)); |
| [346](#L346) | $html = "<div class='w3eden'><form id='wpdm-search-form' style='margin-bottom: 20px'><div class='input-group input-group-lg'><div class='input-group-addon input-group-prepend'><span class=\"input-group-text\"><i class='fas fa-search'></i></span></div><input type='text' name='search' value='" . $strm . "' class='form-control input-lg' /></div></form>{$html}</div>"; |
| [347](#L347) | return str\_replace(array("\r", "\n"), "", $html); |
| [348](#L348) | } |
| [349](#L349) |  |
| [350](#L350) | /\*\* |
| [351](#L351) | \* @usage Short-code function for total download count |
| [352](#L352) | \* @param array $params |
| [353](#L353) | \* @return mixed |
| [354](#L354) | \*/ |
| [355](#L355) | function totalDownloads($params = array()) |
| [356](#L356) | { |
| [357](#L357) | global $wpdb; |
| [358](#L358) | $download\_count = $wpdb->get\_var("select sum(meta\_value) from {$wpdb->prefix}postmeta where meta\_key='\_\_wpdm\_download\_count'"); |
| [359](#L359) | return $download\_count; |
| [360](#L360) | } |
| [361](#L361) |  |
| [362](#L362) | /\*\* |
| [363](#L363) | \* @usage Short-code function for total package count |
| [364](#L364) | \* @param array $params |
| [365](#L365) | \* @return mixed |
| [366](#L366) | \*/ |
| [367](#L367) | function totalPackages($params = array()) |
| [368](#L368) | { |
| [369](#L369) | if (isset($params['cat'])) { |
| [370](#L370) | $term = get\_term\_by("slug", $params['cat']); |
| [371](#L371) | if (is\_object($term) && isset($term->count)) return $term->count; |
| [372](#L372) | return 0; |
| [373](#L373) | } |
| [374](#L374) | if (isset($params['author'])) { |
| [375](#L375) | $user\_post\_count = count\_user\_posts($params['author'], 'wpdmpro'); |
| [376](#L376) | return $user\_post\_count; |
| [377](#L377) | } |
| [378](#L378) | $count\_posts = wp\_count\_posts('wpdmpro'); |
| [379](#L379) | $status = isset($params['status']) ? $params['status'] : 'publish'; |
| [380](#L380) | if ($status == 'draft') return $count\_posts->draft; |
| [381](#L381) | if ($status == 'pending') return $count\_posts->pending; |
| [382](#L382) | return $count\_posts->publish; |
| [383](#L383) | } |
| [384](#L384) |  |
| [385](#L385) | /\*\* |
| [386](#L386) | \* @usage Short-code [wpdm\_all\_packages] to list all packages in tabular format |
| [387](#L387) | \* @param array $params |
| [388](#L388) | \* @return string |
| [389](#L389) | \*/ |
| [390](#L390) | function allPackages($params = array()) |
| [391](#L391) | { |
| [392](#L392) | global $wpdb, $current\_user, $wp\_query; |
| [393](#L393) |  |
| [394](#L394) | $params = \_\_::a($params, ['items\_per\_page' => 20]); |
| [395](#L395) |  |
| [396](#L396) | $items = isset($params['items\_per\_page']) && $params['items\_per\_page'] > 0 ? $params['items\_per\_page'] : 20; |
| [397](#L397) | $offset = $cp = 0; |
| [398](#L398) | if (isset($params['jstable']) && $params['jstable'] == 1) { |
| [399](#L399) | $items = 2000; |
| [400](#L400) | } else { |
| [401](#L401) | $cp = wpdm\_query\_var('cp', ['validate' => 'int', 'default' => 1]); |
| [402](#L402) | $offset = ($cp - 1) \* $items; |
| [403](#L403) |  |
| [404](#L404) | } |
| [405](#L405) | $terms = isset($params['categories']) ? explode(",", $params['categories']) : array(); |
| [406](#L406) | $tag = isset($params['tag']) ? $params['tag'] : ''; |
| [407](#L407) | if (isset($\_GET['wpdmc'])) $terms = array(wpdm\_query\_var('wpdmc', 'txt')); |
| [408](#L408) | $total\_files = wp\_count\_posts('wpdmpro')->publish; |
| [409](#L409) | if (count($terms) > 0) { |
| [410](#L410) | $tax\_query = array(array( |
| [411](#L411) | 'taxonomy' => 'wpdmcategory', |
| [412](#L412) | 'field' => 'slug', |
| [413](#L413) | 'terms' => $terms, |
| [414](#L414) | 'operator' => 'IN', |
| [415](#L415) | 'include\_children' => false |
| [416](#L416) | )); |
| [417](#L417) | } |
| [418](#L418) | if ($tag != '') { |
| [419](#L419) | $params['tag'] = $tag; |
| [420](#L420) | } |
| [421](#L421) | if (isset($params['login']) && $params['login'] == 1 && !is\_user\_logged\_in()) |
| [422](#L422) | return WPDM()->user->login->form($params); |
| [423](#L423) | else { |
| [424](#L424) | ob\_start(); |
| [425](#L425) | //include(wpdm\_tpl\_path("wpdm-all-downloads.php")); |
| [426](#L426) | include Template::locate("all-packages-shortcode.php", \_\_DIR\_\_.'/views'); |
| [427](#L427) | $data = ob\_get\_clean(); |
| [428](#L428) | return $data; |
| [429](#L429) | } |
| [430](#L430) | } |
| [431](#L431) |  |
| [432](#L432) | } |
| [433](#L433) |  |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/download-manager/tags/3.2.83/src/Package/Shortcodes.php?format=txt)
* [Original Format](/export/3220461/download-manager/tags/3.2.83/src/Package/Shortcodes.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_d6e89a0d_20250110_213053.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fdownload-manager%2Ftags%2F3.2.83%2Fsrc%2FPackage%2Fviews%2Fpackages-shortcode.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/download-manager/trunk/src/Package/views/packages-shortcode.php?rev=2605221 "Revision 2605221")
* [Next Revision](/browser/download-manager/trunk/src/Package/views/packages-shortcode.php?rev=3040495 "Revision 3040495") →
* [Blame](/browser/download-manager/trunk/src/Package/views/packages-shortcode.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/download-manager/tags/3.2.83/src/Package/views/packages-shortcode.php)

---

# [source:](/browser?order=name "Go to repository root") [download-manager](/browser/download-manager?order=name "View download-manager")/[tags](/browser/download-manager/tags?order=name "View tags")/[3.2.83](/browser/download-manager/tags/3.2.83?order=name "View 3.2.83")/[src](/browser/download-manager/tags/3.2.83/src?order=name "View src")/[Package](/browser/download-manager/tags/3.2.83/src/Package?order=name "View Package")/[views](/browser/download-manager/tags/3.2.83/src/Package/views?order=name "View views")/[packages-shortcode.php](/browser/download-manager/tags/3.2.83/src/Package/views/packages-shortcode.php?order=name "View packages-shortcode.php")

View diff against:

View revision:

| [Last change](/changeset/2843158/download-manager/trunk/src/Package/views/packages-shortcode.php "View differences") on this file was [2843158](/changeset/2843158/ "View changeset 2843158"), checked in by codename065, [2 years ago](/timeline?from=2023-01-04T02%3A48%3A05Z&precision=second "See timeline at 01/04/2023 02:48:05 AM") |
| --- |
| 3.2.65 - 2023.01.04  * Improved email templates * Improved internal codebase |
| * Property **svn:eol-style** set to   *`native`* | |
| **File size:** 1.0 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Base: wpdmpro |
| [4](#L4) | \* Developer: shahjada |
| [5](#L5) | \* Team: W3 Eden |
| [6](#L6) | \* Date: 6/6/20 06:35 |
| [7](#L7) | \*/ |
| [8](#L8) | if (!defined("ABSPATH")) die(); |
| [9](#L9) | $category\_shortcode = wpdm\_valueof($scparams, 'catsc', ['validate' => 'int']); |
| [10](#L10) | $toolbar\_file = $category\_shortcode === 1  ? "category-shortcode-toolbar.php" : "packages-shortcode-toolbar.php"; |
| [11](#L11) |  |
| [12](#L12) | /\* |
| [13](#L13) | tbgrid - Toolbar grid layout setting variable, 12 grid layout distribute amonng search bar, order by dropdown, order dropdown, and filter button |
| [14](#L14) | $sr - Search bar width |
| [15](#L15) | $ob - Orderby dropdown width |
| [16](#L16) | $od - Order dropdown width |
| [17](#L17) | $bt - Button area width |
| [18](#L18) | \*/ |
| [19](#L19) | list($sr, $ob, $od, $bt) = [6,2,2,2]; |
| [20](#L20) | if(isset($scparams['tbgrid'])){ |
| [21](#L21) | list($sr, $ob, $od, $bt) = explode(",", $scparams['tbgrid']); |
| [22](#L22) | } |
| [23](#L23) |  |
| [24](#L24) | ?> |
| [25](#L25) | <div class='w3eden'> |
| [26](#L26) | <div class='<?php echo esc\_attr($css\_class); ?>'> |
| [27](#L27) |  |
| [28](#L28) | <?php include \WPDM\\_\_\Template::locate($toolbar\_file, \_\_DIR\_\_); ?> |
| [29](#L29) |  |
| [30](#L30) | <div id="content\_<?php echo esc\_attr($scid); ?>"> |
| [31](#L31) | <?php echo $html ?> |
| [32](#L32) | <?php echo $pagination ?> |
| [33](#L33) | </div> |
| [34](#L34) |  |
| [35](#L35) | <div style='clear:both'></div> |
| [36](#L36) | </div> |
| [37](#L37) | </div> |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/download-manager/tags/3.2.83/src/Package/views/packages-shortcode.php?format=txt)
* [Original Format](/export/3220461/download-manager/tags/3.2.83/src/Package/views/packages-shortcode.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


