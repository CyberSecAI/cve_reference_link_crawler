

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=25e3ce59c1200f1f0563e39de151f34962ab0fe1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=25e3ce59c1200f1f0563e39de151f34962ab0fe1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=25e3ce59c1200f1f0563e39de151f34962ab0fe1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=25e3ce59c1200f1f0563e39de151f34962ab0fe1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jocelyn Falempe <jfalempe@redhat.com> | 2024-03-12 10:35:12 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-03 15:11:51 +0200 |
| commit | [25e3ce59c1200f1f0563e39de151f34962ab0fe1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=25e3ce59c1200f1f0563e39de151f34962ab0fe1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=25e3ce59c1200f1f0563e39de151f34962ab0fe1)) | |
| tree | [255a01c4486910495cd8772fc69024393fd6880c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=25e3ce59c1200f1f0563e39de151f34962ab0fe1) | |
| parent | [7e9edb569fd9f688d887e36db8170f6e22bafbc8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7e9edb569fd9f688d887e36db8170f6e22bafbc8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=25e3ce59c1200f1f0563e39de151f34962ab0fe1&id2=7e9edb569fd9f688d887e36db8170f6e22bafbc8)) | |
| download | [linux-25e3ce59c1200f1f0563e39de151f34962ab0fe1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-25e3ce59c1200f1f0563e39de151f34962ab0fe1.tar.gz) | |

drm/vmwgfx: Create debugfs ttm\_resource\_manager entry only if neededcommit 4be9075fec0a639384ed19975634b662bfab938f upstream.
The driver creates /sys/kernel/debug/dri/0/mob\_ttm even when the
corresponding ttm\_resource\_manager is not allocated.
This leads to a crash when trying to read from this file.
Add a check to create mob\_ttm, system\_mob\_ttm, and gmr\_ttm debug file
only when the corresponding ttm\_resource\_manager is allocated.
crash> bt
PID: 3133409 TASK: ffff8fe4834a5000 CPU: 3 COMMAND: "grep"
#0 [ffffb954506b3b20] machine\_kexec at ffffffffb2a6bec3
#1 [ffffb954506b3b78] \_\_crash\_kexec at ffffffffb2bb598a
#2 [ffffb954506b3c38] crash\_kexec at ffffffffb2bb68c1
#3 [ffffb954506b3c50] oops\_end at ffffffffb2a2a9b1
#4 [ffffb954506b3c70] no\_context at ffffffffb2a7e913
#5 [ffffb954506b3cc8] \_\_bad\_area\_nosemaphore at ffffffffb2a7ec8c
#6 [ffffb954506b3d10] do\_page\_fault at ffffffffb2a7f887
#7 [ffffb954506b3d40] page\_fault at ffffffffb360116e
[exception RIP: ttm\_resource\_manager\_debug+0x11]
RIP: ffffffffc04afd11 RSP: ffffb954506b3df0 RFLAGS: 00010246
RAX: ffff8fe41a6d1200 RBX: 0000000000000000 RCX: 0000000000000940
RDX: 0000000000000000 RSI: ffffffffc04b4338 RDI: 0000000000000000
RBP: ffffb954506b3e08 R8: ffff8fee3ffad000 R9: 0000000000000000
R10: ffff8fe41a76a000 R11: 0000000000000001 R12: 00000000ffffffff
R13: 0000000000000001 R14: ffff8fe5bb6f3900 R15: ffff8fe41a6d1200
ORIG\_RAX: ffffffffffffffff CS: 0010 SS: 0018
#8 [ffffb954506b3e00] ttm\_resource\_manager\_show at ffffffffc04afde7 [ttm]
#9 [ffffb954506b3e30] seq\_read at ffffffffb2d8f9f3
RIP: 00007f4c4eda8985 RSP: 00007ffdbba9e9f8 RFLAGS: 00000246
RAX: ffffffffffffffda RBX: 000000000037e000 RCX: 00007f4c4eda8985
RDX: 000000000037e000 RSI: 00007f4c41573000 RDI: 0000000000000003
RBP: 000000000037e000 R8: 0000000000000000 R9: 000000000037fe30
R10: 0000000000000000 R11: 0000000000000246 R12: 00007f4c41573000
R13: 0000000000000003 R14: 00007f4c41572010 R15: 0000000000000003
ORIG\_RAX: 0000000000000000 CS: 0033 SS: 002b
Signed-off-by: Jocelyn Falempe <jfalempe@redhat.com>
Fixes: af4a25bbe5e7 ("drm/vmwgfx: Add debugfs entries for various ttm resource managers")
Cc: <stable@vger.kernel.org>
Reviewed-by: Zack Rusin <zack.rusin@broadcom.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240312093551.196609-1-jfalempe@redhat.com](https://patchwork.freedesktop.org/patch/msgid/20240312093551.196609-1-jfalempe%40redhat.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=25e3ce59c1200f1f0563e39de151f34962ab0fe1)

| -rw-r--r-- | [drivers/gpu/drm/vmwgfx/vmwgfx\_drv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/vmwgfx/vmwgfx_drv.c?id=25e3ce59c1200f1f0563e39de151f34962ab0fe1) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 6 deletions

| diff --git a/drivers/gpu/drm/vmwgfx/vmwgfx\_drv.c b/drivers/gpu/drm/vmwgfx/vmwgfx\_drv.cindex d3e308fdfd5be8..c7d90f96d16a67 100644--- a/[drivers/gpu/drm/vmwgfx/vmwgfx\_drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/vmwgfx/vmwgfx_drv.c?id=7e9edb569fd9f688d887e36db8170f6e22bafbc8)+++ b/[drivers/gpu/drm/vmwgfx/vmwgfx\_drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/vmwgfx/vmwgfx_drv.c?id=25e3ce59c1200f1f0563e39de151f34962ab0fe1)@@ -1444,12 +1444,15 @@ static void vmw\_debugfs\_resource\_managers\_init(struct vmw\_private \*vmw) root, "system\_ttm"); ttm\_resource\_manager\_create\_debugfs(ttm\_manager\_type(&vmw->bdev, TTM\_PL\_VRAM), root, "vram\_ttm");- ttm\_resource\_manager\_create\_debugfs(ttm\_manager\_type(&vmw->bdev, VMW\_PL\_GMR),- root, "gmr\_ttm");- ttm\_resource\_manager\_create\_debugfs(ttm\_manager\_type(&vmw->bdev, VMW\_PL\_MOB),- root, "mob\_ttm");- ttm\_resource\_manager\_create\_debugfs(ttm\_manager\_type(&vmw->bdev, VMW\_PL\_SYSTEM),- root, "system\_mob\_ttm");+ if (vmw->has\_gmr)+ ttm\_resource\_manager\_create\_debugfs(ttm\_manager\_type(&vmw->bdev, VMW\_PL\_GMR),+ root, "gmr\_ttm");+ if (vmw->has\_mob) {+ ttm\_resource\_manager\_create\_debugfs(ttm\_manager\_type(&vmw->bdev, VMW\_PL\_MOB),+ root, "mob\_ttm");+ ttm\_resource\_manager\_create\_debugfs(ttm\_manager\_type(&vmw->bdev, VMW\_PL\_SYSTEM),+ root, "system\_mob\_ttm");+ } }  static int vmwgfx\_pm\_notifier(struct notifier\_block \*nb, unsigned long val, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:22:10 +0000

