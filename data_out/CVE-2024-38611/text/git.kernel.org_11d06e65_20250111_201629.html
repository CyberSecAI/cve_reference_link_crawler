

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c1a3803e5bb91c13e9ad582003e4288f67f06cd9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c1a3803e5bb91c13e9ad582003e4288f67f06cd9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c1a3803e5bb91c13e9ad582003e4288f67f06cd9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c1a3803e5bb91c13e9ad582003e4288f67f06cd9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Uwe Kleine-König <u.kleine-koenig@pengutronix.de> | 2024-03-24 17:00:44 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:12:02 +0200 |
| commit | [c1a3803e5bb91c13e9ad582003e4288f67f06cd9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c1a3803e5bb91c13e9ad582003e4288f67f06cd9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c1a3803e5bb91c13e9ad582003e4288f67f06cd9)) | |
| tree | [efd78ef2e09d3e598ef2875ecbfa9927b0f0c958](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c1a3803e5bb91c13e9ad582003e4288f67f06cd9) | |
| parent | [dd271f136601520e2cfee2438a68afaafe176f9c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dd271f136601520e2cfee2438a68afaafe176f9c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c1a3803e5bb91c13e9ad582003e4288f67f06cd9&id2=dd271f136601520e2cfee2438a68afaafe176f9c)) | |
| download | [linux-c1a3803e5bb91c13e9ad582003e4288f67f06cd9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c1a3803e5bb91c13e9ad582003e4288f67f06cd9.tar.gz) | |

media: i2c: et8ek8: Don't strip remove function when driver is builtin[ Upstream commit 545b215736c5c4b354e182d99c578a472ac9bfce ]
Using \_\_exit for the remove function results in the remove callback
being discarded with CONFIG\_VIDEO\_ET8EK8=y. When such a device gets
unbound (e.g. using sysfs or hotplug), the driver is just removed
without the cleanup being performed. This results in resource leaks. Fix
it by compiling in the remove callback unconditionally.
This also fixes a W=1 modpost warning:
WARNING: modpost: drivers/media/i2c/et8ek8/et8ek8: section mismatch in reference: et8ek8\_i2c\_driver+0x10 (section: .data) -> et8ek8\_remove (section: .exit.text)
Fixes: c5254e72b8ed ("[media] media: Driver for Toshiba et8ek8 5MP sensor")
Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Signed-off-by: Sakari Ailus <sakari.ailus@linux.intel.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c1a3803e5bb91c13e9ad582003e4288f67f06cd9)

| -rw-r--r-- | [drivers/media/i2c/et8ek8/et8ek8\_driver.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/i2c/et8ek8/et8ek8_driver.c?id=c1a3803e5bb91c13e9ad582003e4288f67f06cd9) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/media/i2c/et8ek8/et8ek8\_driver.c b/drivers/media/i2c/et8ek8/et8ek8\_driver.cindex d6fc843f9368e5..0d6f0f8506f76f 100644--- a/[drivers/media/i2c/et8ek8/et8ek8\_driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/et8ek8/et8ek8_driver.c?id=dd271f136601520e2cfee2438a68afaafe176f9c)+++ b/[drivers/media/i2c/et8ek8/et8ek8\_driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/i2c/et8ek8/et8ek8_driver.c?id=c1a3803e5bb91c13e9ad582003e4288f67f06cd9)@@ -1460,7 +1460,7 @@ err\_mutex: return ret; } -static void \_\_exit et8ek8\_remove(struct i2c\_client \*client)+static void et8ek8\_remove(struct i2c\_client \*client) { struct v4l2\_subdev \*subdev = i2c\_get\_clientdata(client); struct et8ek8\_sensor \*sensor = to\_et8ek8\_sensor(subdev);@@ -1502,7 +1502,7 @@ static struct i2c\_driver et8ek8\_i2c\_driver = { .of\_match\_table = et8ek8\_of\_table, }, .probe = et8ek8\_probe,- .remove = \_\_exit\_p(et8ek8\_remove),+ .remove = et8ek8\_remove, .id\_table = et8ek8\_id\_table, }; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:15:06 +0000

