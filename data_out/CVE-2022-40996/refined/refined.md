- **Root cause of vulnerability:** The `DetranCLI` binary uses `sprintf` with format strings to construct commands. The size of the input parameters are not validated against the buffer size, which leads to stack-based buffer overflows.
- **Weaknesses/vulnerabilities present:** Stack-based buffer overflow vulnerabilities due to the usage of `sprintf` without size checks when handling command parameters.
- **Impact of exploitation:** Arbitrary command execution by sending a sequence of crafted network packets. This can lead to full control of the device.
- **Attack vectors:** Sending specially crafted network packets to the device.
- **Required attacker capabilities/position:** The attacker needs the ability to send network packets to the device. Access to the device's CLI interface is also needed which may imply needing valid credentials.

**Specific details for CVE-2022-40996:**

- **Vulnerable command template:**
  ```
  no firmwall srcmac (WORD|null) srcip (A.B.C.D|null) dstip (A.B.C.D|null) protocol (none|tcp|udp|icmp) srcport (<1-65535>|null) dstport (<1-65535>|null) policy (drop|accept) description (WORD|null)
  ```
- **Vulnerable code:**
  ```c
  sprintf(buff_0x100,"%d<%s<%s<%s<%d<%s<%s<%d<%s",1,*argv,argv[1],argv[2],depentent_on_argv[3],argv[4],argv[5],depentent_on_argv[6],argv[7]);
  ```
- This command is used to remove firewall rules based on source MAC address.
- The `sprintf` function copies the command parameters into `buff_0x100` (a 256-byte buffer). If any of the parameters are too long, a stack-based buffer overflow occurs.