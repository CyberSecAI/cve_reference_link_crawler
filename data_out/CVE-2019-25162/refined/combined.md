=== Content from git.kernel.org_550d8333_20250110_140659.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e4c72c06c367758a14f227c847f9d623f1994ecf)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e4c72c06c367758a14f227c847f9d623f1994ecf)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e4c72c06c367758a14f227c847f9d623f1994ecf)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e4c72c06c367758a14f227c847f9d623f1994ecf)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xu Wang <vulab@iscas.ac.cn> | 2019-12-27 09:34:32 +0000 |
| --- | --- | --- |
| committer | Wolfram Sang <wsa@kernel.org> | 2022-06-16 21:39:40 +0200 |
| commit | [e4c72c06c367758a14f227c847f9d623f1994ecf](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e4c72c06c367758a14f227c847f9d623f1994ecf) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e4c72c06c367758a14f227c847f9d623f1994ecf)) | |
| tree | [bea84d2a77eb97f4a861e6e9e3a31babdac91a02](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e4c72c06c367758a14f227c847f9d623f1994ecf) | |
| parent | [4dc1372ffb82c5f08ada7b9cb75a04dcfe49cd96](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4dc1372ffb82c5f08ada7b9cb75a04dcfe49cd96) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e4c72c06c367758a14f227c847f9d623f1994ecf&id2=4dc1372ffb82c5f08ada7b9cb75a04dcfe49cd96)) | |
| download | [linux-e4c72c06c367758a14f227c847f9d623f1994ecf.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e4c72c06c367758a14f227c847f9d623f1994ecf.tar.gz) | |

i2c: Fix a potential use after freeFree the adap structure only after we are done using it.
This patch just moves the put\_device() down a bit to avoid the
use after free.
Fixes: 611e12ea0f12 ("i2c: core: manage i2c bus device refcount in i2c\_[get|put]\_adapter")
Signed-off-by: Xu Wang <vulab@iscas.ac.cn>
[wsa: added comment to the code, added Fixes tag]
Signed-off-by: Wolfram Sang <wsa@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e4c72c06c367758a14f227c847f9d623f1994ecf)

| -rw-r--r-- | [drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/i2c/i2c-core-base.c?id=e4c72c06c367758a14f227c847f9d623f1994ecf) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/i2c/i2c-core-base.c b/drivers/i2c/i2c-core-base.cindex 8ae47e0bbd67f3..10f35f942066ae 100644--- a/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=4dc1372ffb82c5f08ada7b9cb75a04dcfe49cd96)+++ b/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=e4c72c06c367758a14f227c847f9d623f1994ecf)@@ -2461,8 +2461,9 @@ void i2c\_put\_adapter(struct i2c\_adapter \*adap) if (!adap) return; - put\_device(&adap->dev); module\_put(adap->owner);+ /\* Should be last, otherwise we risk use-after-free with 'adap' \*/+ put\_device(&adap->dev); } EXPORT\_SYMBOL(i2c\_put\_adapter); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:23:56 +0000



=== Content from git.kernel.org_8bd8b51c_20250110_140659.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e8e1a046cf87c8b1363e5de835114f2779e2aaf4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8e1a046cf87c8b1363e5de835114f2779e2aaf4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8e1a046cf87c8b1363e5de835114f2779e2aaf4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8e1a046cf87c8b1363e5de835114f2779e2aaf4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xu Wang <vulab@iscas.ac.cn> | 2019-12-27 09:34:32 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-08-17 14:40:48 +0200 |
| commit | [e8e1a046cf87c8b1363e5de835114f2779e2aaf4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8e1a046cf87c8b1363e5de835114f2779e2aaf4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e8e1a046cf87c8b1363e5de835114f2779e2aaf4)) | |
| tree | [852bac7223c7ec7e70d27b77454c09502d00a687](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8e1a046cf87c8b1363e5de835114f2779e2aaf4) | |
| parent | [7b26b7277f2d99cce2ecf4e90655b3dcf9660df8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7b26b7277f2d99cce2ecf4e90655b3dcf9660df8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8e1a046cf87c8b1363e5de835114f2779e2aaf4&id2=7b26b7277f2d99cce2ecf4e90655b3dcf9660df8)) | |
| download | [linux-e8e1a046cf87c8b1363e5de835114f2779e2aaf4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e8e1a046cf87c8b1363e5de835114f2779e2aaf4.tar.gz) | |

i2c: Fix a potential use after free[ Upstream commit e4c72c06c367758a14f227c847f9d623f1994ecf ]
Free the adap structure only after we are done using it.
This patch just moves the put\_device() down a bit to avoid the
use after free.
Fixes: 611e12ea0f12 ("i2c: core: manage i2c bus device refcount in i2c\_[get|put]\_adapter")
Signed-off-by: Xu Wang <vulab@iscas.ac.cn>
[wsa: added comment to the code, added Fixes tag]
Signed-off-by: Wolfram Sang <wsa@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8e1a046cf87c8b1363e5de835114f2779e2aaf4)

| -rw-r--r-- | [drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/i2c/i2c-core-base.c?id=e8e1a046cf87c8b1363e5de835114f2779e2aaf4) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/i2c/i2c-core-base.c b/drivers/i2c/i2c-core-base.cindex d43db2c3876e79..19a317fdcf5bff 100644--- a/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=7b26b7277f2d99cce2ecf4e90655b3dcf9660df8)+++ b/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=e8e1a046cf87c8b1363e5de835114f2779e2aaf4)@@ -2467,8 +2467,9 @@ void i2c\_put\_adapter(struct i2c\_adapter \*adap) if (!adap) return; - put\_device(&adap->dev); module\_put(adap->owner);+ /\* Should be last, otherwise we risk use-after-free with 'adap' \*/+ put\_device(&adap->dev); } EXPORT\_SYMBOL(i2c\_put\_adapter); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:24:01 +0000



=== Content from git.kernel.org_c2ae75a8_20250110_140659.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e6412ba3b6508bdf9c074d310bf4144afa6aec1a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e6412ba3b6508bdf9c074d310bf4144afa6aec1a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e6412ba3b6508bdf9c074d310bf4144afa6aec1a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e6412ba3b6508bdf9c074d310bf4144afa6aec1a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xu Wang <vulab@iscas.ac.cn> | 2019-12-27 09:34:32 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-08-25 11:11:16 +0200 |
| commit | [e6412ba3b6508bdf9c074d310bf4144afa6aec1a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e6412ba3b6508bdf9c074d310bf4144afa6aec1a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e6412ba3b6508bdf9c074d310bf4144afa6aec1a)) | |
| tree | [83750909112292d074d7d4960ab87c5440ec58f7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e6412ba3b6508bdf9c074d310bf4144afa6aec1a) | |
| parent | [c323dfdf91cff6c3185883b184d01d28889e1b4c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c323dfdf91cff6c3185883b184d01d28889e1b4c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e6412ba3b6508bdf9c074d310bf4144afa6aec1a&id2=c323dfdf91cff6c3185883b184d01d28889e1b4c)) | |
| download | [linux-e6412ba3b6508bdf9c074d310bf4144afa6aec1a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e6412ba3b6508bdf9c074d310bf4144afa6aec1a.tar.gz) | |

i2c: Fix a potential use after free[ Upstream commit e4c72c06c367758a14f227c847f9d623f1994ecf ]
Free the adap structure only after we are done using it.
This patch just moves the put\_device() down a bit to avoid the
use after free.
Fixes: 611e12ea0f12 ("i2c: core: manage i2c bus device refcount in i2c\_[get|put]\_adapter")
Signed-off-by: Xu Wang <vulab@iscas.ac.cn>
[wsa: added comment to the code, added Fixes tag]
Signed-off-by: Wolfram Sang <wsa@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e6412ba3b6508bdf9c074d310bf4144afa6aec1a)

| -rw-r--r-- | [drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/i2c/i2c-core-base.c?id=e6412ba3b6508bdf9c074d310bf4144afa6aec1a) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/i2c/i2c-core-base.c b/drivers/i2c/i2c-core-base.cindex b7fe8075f2b89d..c1fc49365189a8 100644--- a/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=c323dfdf91cff6c3185883b184d01d28889e1b4c)+++ b/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=e6412ba3b6508bdf9c074d310bf4144afa6aec1a)@@ -2243,8 +2243,9 @@ void i2c\_put\_adapter(struct i2c\_adapter \*adap) if (!adap) return; - put\_device(&adap->dev); module\_put(adap->owner);+ /\* Should be last, otherwise we risk use-after-free with 'adap' \*/+ put\_device(&adap->dev); } EXPORT\_SYMBOL(i2c\_put\_adapter); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:23:58 +0000



=== Content from git.kernel.org_b61f9537_20250110_140658.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=12b0606000d0828630c033bf0c74c748464fe87d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=12b0606000d0828630c033bf0c74c748464fe87d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=12b0606000d0828630c033bf0c74c748464fe87d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=12b0606000d0828630c033bf0c74c748464fe87d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xu Wang <vulab@iscas.ac.cn> | 2019-12-27 09:34:32 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-08-17 15:14:30 +0200 |
| commit | [12b0606000d0828630c033bf0c74c748464fe87d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=12b0606000d0828630c033bf0c74c748464fe87d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=12b0606000d0828630c033bf0c74c748464fe87d)) | |
| tree | [646dee9f8dfcf1bd451f96f1db517137a9d6d1ee](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=12b0606000d0828630c033bf0c74c748464fe87d) | |
| parent | [56a1d1be57b956b5493ce6c18c993730dbbc11b8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56a1d1be57b956b5493ce6c18c993730dbbc11b8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=12b0606000d0828630c033bf0c74c748464fe87d&id2=56a1d1be57b956b5493ce6c18c993730dbbc11b8)) | |
| download | [linux-12b0606000d0828630c033bf0c74c748464fe87d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-12b0606000d0828630c033bf0c74c748464fe87d.tar.gz) | |

i2c: Fix a potential use after free[ Upstream commit e4c72c06c367758a14f227c847f9d623f1994ecf ]
Free the adap structure only after we are done using it.
This patch just moves the put\_device() down a bit to avoid the
use after free.
Fixes: 611e12ea0f12 ("i2c: core: manage i2c bus device refcount in i2c\_[get|put]\_adapter")
Signed-off-by: Xu Wang <vulab@iscas.ac.cn>
[wsa: added comment to the code, added Fixes tag]
Signed-off-by: Wolfram Sang <wsa@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=12b0606000d0828630c033bf0c74c748464fe87d)

| -rw-r--r-- | [drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/i2c/i2c-core-base.c?id=12b0606000d0828630c033bf0c74c748464fe87d) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/i2c/i2c-core-base.c b/drivers/i2c/i2c-core-base.cindex d43db2c3876e79..19a317fdcf5bff 100644--- a/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=56a1d1be57b956b5493ce6c18c993730dbbc11b8)+++ b/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=12b0606000d0828630c033bf0c74c748464fe87d)@@ -2467,8 +2467,9 @@ void i2c\_put\_adapter(struct i2c\_adapter \*adap) if (!adap) return; - put\_device(&adap->dev); module\_put(adap->owner);+ /\* Should be last, otherwise we risk use-after-free with 'adap' \*/+ put\_device(&adap->dev); } EXPORT\_SYMBOL(i2c\_put\_adapter); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:23:44 +0000



=== Content from git.kernel.org_77c82f9e_20250110_140659.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=81cb31756888bb062e92d2dca21cd629d77a46a9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=81cb31756888bb062e92d2dca21cd629d77a46a9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=81cb31756888bb062e92d2dca21cd629d77a46a9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=81cb31756888bb062e92d2dca21cd629d77a46a9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xu Wang <vulab@iscas.ac.cn> | 2019-12-27 09:34:32 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-08-21 15:15:40 +0200 |
| commit | [81cb31756888bb062e92d2dca21cd629d77a46a9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=81cb31756888bb062e92d2dca21cd629d77a46a9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=81cb31756888bb062e92d2dca21cd629d77a46a9)) | |
| tree | [3d22f1a23479c337caf07da36040355f5d61b0a0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=81cb31756888bb062e92d2dca21cd629d77a46a9) | |
| parent | [d0412d8f693e6f00b6cda80cc3ae1fbc7c14d392](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d0412d8f693e6f00b6cda80cc3ae1fbc7c14d392) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=81cb31756888bb062e92d2dca21cd629d77a46a9&id2=d0412d8f693e6f00b6cda80cc3ae1fbc7c14d392)) | |
| download | [linux-81cb31756888bb062e92d2dca21cd629d77a46a9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-81cb31756888bb062e92d2dca21cd629d77a46a9.tar.gz) | |

i2c: Fix a potential use after free[ Upstream commit e4c72c06c367758a14f227c847f9d623f1994ecf ]
Free the adap structure only after we are done using it.
This patch just moves the put\_device() down a bit to avoid the
use after free.
Fixes: 611e12ea0f12 ("i2c: core: manage i2c bus device refcount in i2c\_[get|put]\_adapter")
Signed-off-by: Xu Wang <vulab@iscas.ac.cn>
[wsa: added comment to the code, added Fixes tag]
Signed-off-by: Wolfram Sang <wsa@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=81cb31756888bb062e92d2dca21cd629d77a46a9)

| -rw-r--r-- | [drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/i2c/i2c-core-base.c?id=81cb31756888bb062e92d2dca21cd629d77a46a9) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/i2c/i2c-core-base.c b/drivers/i2c/i2c-core-base.cindex bdce6d3e532733..34fecf97a355b8 100644--- a/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=d0412d8f693e6f00b6cda80cc3ae1fbc7c14d392)+++ b/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=81cb31756888bb062e92d2dca21cd629d77a46a9)@@ -2405,8 +2405,9 @@ void i2c\_put\_adapter(struct i2c\_adapter \*adap) if (!adap) return; - put\_device(&adap->dev); module\_put(adap->owner);+ /\* Should be last, otherwise we risk use-after-free with 'adap' \*/+ put\_device(&adap->dev); } EXPORT\_SYMBOL(i2c\_put\_adapter); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:23:51 +0000



=== Content from git.kernel.org_3f9c21d7_20250110_140658.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=23a191b132cd87f746c62f3dc27da33683d85829)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=23a191b132cd87f746c62f3dc27da33683d85829)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=23a191b132cd87f746c62f3dc27da33683d85829)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=23a191b132cd87f746c62f3dc27da33683d85829)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xu Wang <vulab@iscas.ac.cn> | 2019-12-27 09:34:32 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-08-25 11:15:04 +0200 |
| commit | [23a191b132cd87f746c62f3dc27da33683d85829](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=23a191b132cd87f746c62f3dc27da33683d85829) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=23a191b132cd87f746c62f3dc27da33683d85829)) | |
| tree | [33ff4e18540111e428c9192a897042b24533ebf0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=23a191b132cd87f746c62f3dc27da33683d85829) | |
| parent | [1bd7f9784d3bbf74129756a7e90bcb4b3a7b1e89](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1bd7f9784d3bbf74129756a7e90bcb4b3a7b1e89) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=23a191b132cd87f746c62f3dc27da33683d85829&id2=1bd7f9784d3bbf74129756a7e90bcb4b3a7b1e89)) | |
| download | [linux-23a191b132cd87f746c62f3dc27da33683d85829.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-23a191b132cd87f746c62f3dc27da33683d85829.tar.gz) | |

i2c: Fix a potential use after free[ Upstream commit e4c72c06c367758a14f227c847f9d623f1994ecf ]
Free the adap structure only after we are done using it.
This patch just moves the put\_device() down a bit to avoid the
use after free.
Fixes: 611e12ea0f12 ("i2c: core: manage i2c bus device refcount in i2c\_[get|put]\_adapter")
Signed-off-by: Xu Wang <vulab@iscas.ac.cn>
[wsa: added comment to the code, added Fixes tag]
Signed-off-by: Wolfram Sang <wsa@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=23a191b132cd87f746c62f3dc27da33683d85829)

| -rw-r--r-- | [drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/i2c/i2c-core-base.c?id=23a191b132cd87f746c62f3dc27da33683d85829) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/i2c/i2c-core-base.c b/drivers/i2c/i2c-core-base.cindex 2a43f4e46af04d..9079be0d51d155 100644--- a/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=1bd7f9784d3bbf74129756a7e90bcb4b3a7b1e89)+++ b/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=23a191b132cd87f746c62f3dc27da33683d85829)@@ -2273,8 +2273,9 @@ void i2c\_put\_adapter(struct i2c\_adapter \*adap) if (!adap) return; - put\_device(&adap->dev); module\_put(adap->owner);+ /\* Should be last, otherwise we risk use-after-free with 'adap' \*/+ put\_device(&adap->dev); } EXPORT\_SYMBOL(i2c\_put\_adapter); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:23:46 +0000



=== Content from git.kernel.org_3dd79ec3_20250110_140659.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=35927d7509ab9bf41896b7e44f639504eae08af7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=35927d7509ab9bf41896b7e44f639504eae08af7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=35927d7509ab9bf41896b7e44f639504eae08af7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35927d7509ab9bf41896b7e44f639504eae08af7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xu Wang <vulab@iscas.ac.cn> | 2019-12-27 09:34:32 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-08-17 14:23:20 +0200 |
| commit | [35927d7509ab9bf41896b7e44f639504eae08af7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=35927d7509ab9bf41896b7e44f639504eae08af7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=35927d7509ab9bf41896b7e44f639504eae08af7)) | |
| tree | [1db27c695e768ef8c39c8ad083fda33d269e6de6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=35927d7509ab9bf41896b7e44f639504eae08af7) | |
| parent | [8b4bba610f5218569cd2b9cf9fad5626b0aa4ba4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8b4bba610f5218569cd2b9cf9fad5626b0aa4ba4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35927d7509ab9bf41896b7e44f639504eae08af7&id2=8b4bba610f5218569cd2b9cf9fad5626b0aa4ba4)) | |
| download | [linux-35927d7509ab9bf41896b7e44f639504eae08af7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-35927d7509ab9bf41896b7e44f639504eae08af7.tar.gz) | |

i2c: Fix a potential use after free[ Upstream commit e4c72c06c367758a14f227c847f9d623f1994ecf ]
Free the adap structure only after we are done using it.
This patch just moves the put\_device() down a bit to avoid the
use after free.
Fixes: 611e12ea0f12 ("i2c: core: manage i2c bus device refcount in i2c\_[get|put]\_adapter")
Signed-off-by: Xu Wang <vulab@iscas.ac.cn>
[wsa: added comment to the code, added Fixes tag]
Signed-off-by: Wolfram Sang <wsa@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35927d7509ab9bf41896b7e44f639504eae08af7)

| -rw-r--r-- | [drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/i2c/i2c-core-base.c?id=35927d7509ab9bf41896b7e44f639504eae08af7) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/i2c/i2c-core-base.c b/drivers/i2c/i2c-core-base.cindex cfbef70e8ba70e..8fb065caf30b43 100644--- a/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=8b4bba610f5218569cd2b9cf9fad5626b0aa4ba4)+++ b/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=35927d7509ab9bf41896b7e44f639504eae08af7)@@ -2464,8 +2464,9 @@ void i2c\_put\_adapter(struct i2c\_adapter \*adap) if (!adap) return; - put\_device(&adap->dev); module\_put(adap->owner);+ /\* Should be last, otherwise we risk use-after-free with 'adap' \*/+ put\_device(&adap->dev); } EXPORT\_SYMBOL(i2c\_put\_adapter); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:05:36 +0000



=== Content from git.kernel.org_72fdf027_20250110_140659.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=871a1e94929a27bf6e2cd99523865c840bbc2d87)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=871a1e94929a27bf6e2cd99523865c840bbc2d87)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=871a1e94929a27bf6e2cd99523865c840bbc2d87)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=871a1e94929a27bf6e2cd99523865c840bbc2d87)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xu Wang <vulab@iscas.ac.cn> | 2019-12-27 09:34:32 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-08-25 11:17:38 +0200 |
| commit | [871a1e94929a27bf6e2cd99523865c840bbc2d87](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=871a1e94929a27bf6e2cd99523865c840bbc2d87) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=871a1e94929a27bf6e2cd99523865c840bbc2d87)) | |
| tree | [da218cd9967c6d7eb076f12d5fd29cd77c068f6d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=871a1e94929a27bf6e2cd99523865c840bbc2d87) | |
| parent | [127ecd6b1f17455c0cbedb5d153847dfa2750be7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=127ecd6b1f17455c0cbedb5d153847dfa2750be7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=871a1e94929a27bf6e2cd99523865c840bbc2d87&id2=127ecd6b1f17455c0cbedb5d153847dfa2750be7)) | |
| download | [linux-871a1e94929a27bf6e2cd99523865c840bbc2d87.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-871a1e94929a27bf6e2cd99523865c840bbc2d87.tar.gz) | |

i2c: Fix a potential use after free[ Upstream commit e4c72c06c367758a14f227c847f9d623f1994ecf ]
Free the adap structure only after we are done using it.
This patch just moves the put\_device() down a bit to avoid the
use after free.
Fixes: 611e12ea0f12 ("i2c: core: manage i2c bus device refcount in i2c\_[get|put]\_adapter")
Signed-off-by: Xu Wang <vulab@iscas.ac.cn>
[wsa: added comment to the code, added Fixes tag]
Signed-off-by: Wolfram Sang <wsa@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=871a1e94929a27bf6e2cd99523865c840bbc2d87)

| -rw-r--r-- | [drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/i2c/i2c-core-base.c?id=871a1e94929a27bf6e2cd99523865c840bbc2d87) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/i2c/i2c-core-base.c b/drivers/i2c/i2c-core-base.cindex 1b93fae58ec753..964e8a29b27b4c 100644--- a/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=127ecd6b1f17455c0cbedb5d153847dfa2750be7)+++ b/[drivers/i2c/i2c-core-base.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/i2c/i2c-core-base.c?id=871a1e94929a27bf6e2cd99523865c840bbc2d87)@@ -2358,8 +2358,9 @@ void i2c\_put\_adapter(struct i2c\_adapter \*adap) if (!adap) return; - put\_device(&adap->dev); module\_put(adap->owner);+ /\* Should be last, otherwise we risk use-after-free with 'adap' \*/+ put\_device(&adap->dev); } EXPORT\_SYMBOL(i2c\_put\_adapter); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:23:54 +0000


