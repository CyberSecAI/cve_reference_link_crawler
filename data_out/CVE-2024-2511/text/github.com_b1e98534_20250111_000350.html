
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssl%2Fopenssl%2Fcommit%2Fe9d7083e241670332e0443da0f0d4ffb52829f08)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssl%2Fopenssl%2Fcommit%2Fe9d7083e241670332e0443da0f0d4ffb52829f08)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=openssl%2Fopenssl)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[openssl](/openssl)
/
**[openssl](/openssl/openssl)**
Public

* [Notifications](/login?return_to=%2Fopenssl%2Fopenssl) You must be signed in to change notification settings
* [Fork
  10.2k](/login?return_to=%2Fopenssl%2Fopenssl)
* [Star
   26.3k](/login?return_to=%2Fopenssl%2Fopenssl)

* [Code](/openssl/openssl)
* [Issues
  1.6k](/openssl/openssl/issues)
* [Pull requests
  267](/openssl/openssl/pulls)
* [Discussions](/openssl/openssl/discussions)
* [Actions](/openssl/openssl/actions)
* [Projects
  1](/openssl/openssl/projects)
* [Security](/openssl/openssl/security)
* [Insights](/openssl/openssl/pulse)

Additional navigation options

* [Code](/openssl/openssl)
* [Issues](/openssl/openssl/issues)
* [Pull requests](/openssl/openssl/pulls)
* [Discussions](/openssl/openssl/discussions)
* [Actions](/openssl/openssl/actions)
* [Projects](/openssl/openssl/projects)
* [Security](/openssl/openssl/security)
* [Insights](/openssl/openssl/pulse)

## Commit

[Permalink](/openssl/openssl/commit/e9d7083e241670332e0443da0f0d4ffb52829f08)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix unconstrained session cache growth in TLSv1.3

[Browse files](/openssl/openssl/tree/e9d7083e241670332e0443da0f0d4ffb52829f08)
Browse the repository at this point in the history

```
In TLSv1.3 we create a new session object for each ticket that we send.
We do this by duplicating the original session. If SSL_OP_NO_TICKET is in
use then the new session will be added to the session cache. However, if
early data is not in use (and therefore anti-replay protection is being
used), then multiple threads could be resuming from the same session
simultaneously. If this happens and a problem occurs on one of the threads,
then the original session object could be marked as not_resumable. When we
duplicate the session object this not_resumable status gets copied into the
new session object. The new session object is then added to the session
cache even though it is not_resumable.

Subsequently, another bug means that the session_id_length is set to 0 for
sessions that are marked as not_resumable - even though that session is
still in the cache. Once this happens the session can never be removed from
the cache. When that object gets to be the session cache tail object the
cache never shrinks again and grows indefinitely.

[CVE-2024-2511](https://github.com/advisories/GHSA-299c-jvhc-gxj8 "CVE-2024-2511")

Reviewed-by: Neil Horman <nhorman@openssl.org>
Reviewed-by: Tomas Mraz <tomas@openssl.org>
(Merged from [#24043](https://github.com/openssl/openssl/pull/24043))
```

* Loading branch information

[![@mattcaswell](https://avatars.githubusercontent.com/u/7422273?s=40&v=4)](/mattcaswell) [![@t8m](https://avatars.githubusercontent.com/u/7125407?s=40&v=4)](/t8m)

[mattcaswell](/openssl/openssl/commits?author=mattcaswell "View all commits by mattcaswell")
authored and
[t8m](/openssl/openssl/commits?author=t8m "View all commits by t8m")
committed
Apr 8, 2024

1 parent
[95b20bb](/openssl/openssl/commit/95b20bbb17a38f7dfa50259e85a42cb680d01c00)

commit e9d7083

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**27 additions**
and
**11 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ssl

  + ssl/ssl\_lib.c
    [ssl\_lib.c](#diff-38e1eecb6013c2fe8bf194e5020ce1afd6e31c371d7849e041464ad822fe745b)
  + ssl/ssl\_sess.c
    [ssl\_sess.c](#diff-22fc393105cea4f5fb077938bbf0b5985155ce3c2ae6cb559ad014de07c35ee4)
  + statem

    - ssl/statem/statem\_srvr.c
      [statem\_srvr.c](#diff-ad8331ef7b6455d502e8ad14077f12dfd78ee38d79be0227f2c99a8a2eafd8a5)

## There are no files selected for viewing

5 changes: 3 additions & 2 deletions

5
[ssl/ssl\_lib.c](#diff-38e1eecb6013c2fe8bf194e5020ce1afd6e31c371d7849e041464ad822fe745b "ssl/ssl_lib.c")

Show comments

[View file](/openssl/openssl/blob/e9d7083e241670332e0443da0f0d4ffb52829f08/ssl/ssl_lib.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4457,9 +4457,10 @@ void ssl\_update\_cache(SSL\_CONNECTION \*s, int mode) |
|  |  |  |
|  |  | /\* |
|  |  | \* If the session\_id\_length is 0, we are not supposed to cache it, and it |
|  |  | \* would be rather hard to do anyway :-) |
|  |  | \* would be rather hard to do anyway :-). Also if the session has already |
|  |  | \* been marked as not\_resumable we should not cache it for later reuse. |
|  |  | \*/ |
|  |  | if (s->session->session\_id\_length == 0) |
|  |  | if (s->session->session\_id\_length == 0 || s->session->not\_resumable) |
|  |  | return; |
|  |  |  |
|  |  | /\* |
| Expand Down | |  |

28 changes: 22 additions & 6 deletions

28
[ssl/ssl\_sess.c](#diff-22fc393105cea4f5fb077938bbf0b5985155ce3c2ae6cb559ad014de07c35ee4 "ssl/ssl_sess.c")

Show comments

[View file](/openssl/openssl/blob/e9d7083e241670332e0443da0f0d4ffb52829f08/ssl/ssl_sess.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -127,16 +127,11 @@ SSL\_SESSION \*SSL\_SESSION\_new(void) |
|  |  | return ss; |
|  |  | } |
|  |  |  |
|  |  | SSL\_SESSION \*SSL\_SESSION\_dup(const SSL\_SESSION \*src) |
|  |  | { |
|  |  | return ssl\_session\_dup(src, 1); |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | \* Create a new SSL\_SESSION and duplicate the contents of |src| into it. If |
|  |  | \* ticket == 0 then no ticket information is duplicated, otherwise it is. |
|  |  | \*/ |
|  |  | SSL\_SESSION \*ssl\_session\_dup(const SSL\_SESSION \*src, int ticket) |
|  |  | static SSL\_SESSION \*ssl\_session\_dup\_intern(const SSL\_SESSION \*src, int ticket) |
|  |  | { |
|  |  | SSL\_SESSION \*dest; |
|  |  |  |
| Expand Down  Expand Up | | @@ -265,6 +260,27 @@ SSL\_SESSION \*ssl\_session\_dup(const SSL\_SESSION \*src, int ticket) |
|  |  | return NULL; |
|  |  | } |
|  |  |  |
|  |  | SSL\_SESSION \*SSL\_SESSION\_dup(const SSL\_SESSION \*src) |
|  |  | { |
|  |  | return ssl\_session\_dup\_intern(src, 1); |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | \* Used internally when duplicating a session which might be already shared. |
|  |  | \* We will have resumed the original session. Subsequently we might have marked |
|  |  | \* it as non-resumable (e.g. in another thread) - but this copy should be ok to |
|  |  | \* resume from. |
|  |  | \*/ |
|  |  | SSL\_SESSION \*ssl\_session\_dup(const SSL\_SESSION \*src, int ticket) |
|  |  | { |
|  |  | SSL\_SESSION \*sess = ssl\_session\_dup\_intern(src, ticket); |
|  |  |  |
|  |  | if (sess != NULL) |
|  |  | sess->not\_resumable = 0; |
|  |  |  |
|  |  | return sess; |
|  |  | } |
|  |  |  |
|  |  | const unsigned char \*SSL\_SESSION\_get\_id(const SSL\_SESSION \*s, unsigned int \*len) |
|  |  | { |
|  |  | if (len) |
| Expand Down | |  |

5 changes: 2 additions & 3 deletions

5
[ssl/statem/statem\_srvr.c](#diff-ad8331ef7b6455d502e8ad14077f12dfd78ee38d79be0227f2c99a8a2eafd8a5 "ssl/statem/statem_srvr.c")

Show comments

[View file](/openssl/openssl/blob/e9d7083e241670332e0443da0f0d4ffb52829f08/ssl/statem/statem_srvr.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2445,9 +2445,8 @@ CON\_FUNC\_RETURN tls\_construct\_server\_hello(SSL\_CONNECTION \*s, WPACKET \*pkt) |
|  |  | \* so the following won't overwrite an ID that we're supposed |
|  |  | \* to send back. |
|  |  | \*/ |
|  |  | if (s->session->not\_resumable || |
|  |  | (!(SSL\_CONNECTION\_GET\_CTX(s)->session\_cache\_mode & SSL\_SESS\_CACHE\_SERVER) |
|  |  | && !s->hit)) |
|  |  | if (!(SSL\_CONNECTION\_GET\_CTX(s)->session\_cache\_mode & SSL\_SESS\_CACHE\_SERVER) |
|  |  | && !s->hit) |
|  |  | s->session->session\_id\_length = 0; |
|  |  |  |
|  |  | if (usetls13) { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e9d7083`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssl%2Fopenssl%2Fcommit%2Fe9d7083e241670332e0443da0f0d4ffb52829f08) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

