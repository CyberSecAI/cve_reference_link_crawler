=== Content from plugins.trac.wordpress.org_5afc7fcb_20250111_153048.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Flifeline-donation%2Ftrunk%2Fvendor%2Fwebinane%2Fwebinane-commerce%2Fincludes%2FClasses%2FCheckout.php%3Frev%3D2490935)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← Previous Revision
* [Latest Revision](/browser/lifeline-donation/trunk/vendor/webinane/webinane-commerce/includes/Classes/Checkout.php)
* Next Revision →
* [Blame](/browser/lifeline-donation/trunk/vendor/webinane/webinane-commerce/includes/Classes/Checkout.php?annotate=blame&rev=2490935 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/lifeline-donation/trunk/vendor/webinane/webinane-commerce/includes/Classes/Checkout.php?rev=2490935)

---

# [source:](/browser?rev=2490935&order=name "Go to repository root") [lifeline-donation](/browser/lifeline-donation?rev=2490935&order=name "View lifeline-donation")/[trunk](/browser/lifeline-donation/trunk?rev=2490935&order=name "View trunk")/[vendor](/browser/lifeline-donation/trunk/vendor?rev=2490935&order=name "View vendor")/[webinane](/browser/lifeline-donation/trunk/vendor/webinane?rev=2490935&order=name "View webinane")/[webinane-commerce](/browser/lifeline-donation/trunk/vendor/webinane/webinane-commerce?rev=2490935&order=name "View webinane-commerce")/[includes](/browser/lifeline-donation/trunk/vendor/webinane/webinane-commerce/includes?rev=2490935&order=name "View includes")/[Classes](/browser/lifeline-donation/trunk/vendor/webinane/webinane-commerce/includes/Classes?rev=2490935&order=name "View Classes")/[Checkout.php](/browser/lifeline-donation/trunk/vendor/webinane/webinane-commerce/includes/Classes/Checkout.php?rev=2490935&order=name "View Checkout.php") @ [2490935](/changeset/2490935/ "View changeset 2490935")

View diff against:

View revision:

| [Last change](/changeset/2490935/lifeline-donation/trunk/vendor/webinane/webinane-commerce/includes/Classes/Checkout.php "View differences") on this file since 2490935 was [2490935](/changeset/2490935/ "View changeset 2490935"), checked in by webinnane, [4 years ago](/timeline?from=2021-03-09T19%3A18%3A50Z&precision=second "See timeline at 03/09/2021 07:18:50 PM") |
| --- |
| new version |
| **File size:** 10.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | namespace WebinaneCommerce\Classes; |
| [3](#L3) |  |
| [4](#L4) | use WebinaneCommerce\Classes\Customers; |
| [5](#L5) | use WebinaneCommerce\Classes\Session; |
| [6](#L6) |  |
| [7](#L7) | class Checkout { |
| [8](#L8) |  |
| [9](#L9) | static function init() { |
| [10](#L10) |  |
| [11](#L11) | add\_action('wp\_ajax\_\_wpcommerce\_checkout\_data', array(\_\_CLASS\_\_, 'checkout\_data')); |
| [12](#L12) | add\_action('wp\_ajax\_nopriv\_\_wpcommerce\_checkout\_data', array(\_\_CLASS\_\_, 'checkout\_data')); |
| [13](#L13) |  |
| [14](#L14) | add\_action('wpcm\_process\_checkout', array(\_\_CLASS\_\_, 'process\_checkout')); |
| [15](#L15) |  |
| [16](#L16) | add\_action('wp\_enqueue\_scripts', array(\_\_CLASS\_\_, 'enqueue' ) ); |
| [17](#L17) |  |
| [18](#L18) | add\_filter('body\_class', array(\_\_CLASS\_\_, 'body\_class')); |
| [19](#L19) | } |
| [20](#L20) |  |
| [21](#L21) | static function enqueue() { |
| [22](#L22) | $key = 'nonce\_wpcm\_fieldsphpwpcommerce\_frontend\_checkout\_form\_customer\_info'; |
| [23](#L23) | $\_post = filter\_input\_array(INPUT\_POST, FILTER\_SANITIZE\_STRING); |
| [24](#L24) |  |
| [25](#L25) | if( isset( $\_POST[$key]) && wpcm\_is\_checkout\_page() ) { |
| [26](#L26) | $nonce = esc\_attr( webinane\_set($\_POST, $key ) ); |
| [27](#L27) | if( ! wp\_verify\_nonce( $nonce, $key ) ) { |
| [28](#L28) | wpcm\_redirect\_back\_checkout();wp\_die(); |
| [29](#L29) | } |
| [30](#L30) | do\_action('wpcm\_process\_checkout', $\_post); |
| [31](#L31) | } |
| [32](#L32) |  |
| [33](#L33) | if( wpcm\_is\_checkout\_page() ) { |
| [34](#L34) | wp\_enqueue\_style('wpcm-bootstrap', WNCM\_URL . 'assets/css/bootstrap.min.css'); |
| [35](#L35) | wp\_enqueue\_style('bootstrap-datetimepicker', WNCM\_URL . 'assets/css/bootstrap-datetimepicker.min.css'); |
| [36](#L36) | wp\_enqueue\_style('fontawesome', WNCM\_URL . 'assets/css/fontawesome.min.css'); |
| [37](#L37) | wp\_enqueue\_style('bootstrap-touchspin', WNCM\_URL . 'assets/css/jquery.bootstrap-touchspin.min.css'); |
| [38](#L38) |  |
| [39](#L39) | wp\_enqueue\_style('wpcm\_responsive', WNCM\_URL . 'assets/css/responsive.css'); |
| [40](#L40) | wp\_enqueue\_style('wpcm\_style', WNCM\_URL . 'assets/css/style.css'); |
| [41](#L41) | } |
| [42](#L42) | } |
| [43](#L43) | /\*\* |
| [44](#L44) | \* Finally add to cart. |
| [45](#L45) | \* |
| [46](#L46) | \* @param array $args [description] |
| [47](#L47) | \*/ |
| [48](#L48) | static function add\_to\_cart($args = array() ) { |
| [49](#L49) |  |
| [50](#L50) | $id = webinane\_set( $args, 'item\_id' ); |
| [51](#L51) | $data = Session::get\_session\_data\_by\_key('cart'); |
| [52](#L52) |  |
| [53](#L53) | if ( isset( $data[ $id ] ) ) { |
| [54](#L54) |  |
| [55](#L55) | $data[$id]['quantity'] += (float) webinane\_set( $args, 'quantity', 1 ); |
| [56](#L56) | } else { |
| [57](#L57) | $data[$id] = array( |
| [58](#L58) | 'item\_id'               => $id, |
| [59](#L59) | 'quantity'              => (int) webinane\_set( $args, 'quantity', 1 ), |
| [60](#L60) | 'price'                 => (float) webinane\_set( $args, 'price', 1 ) |
| [61](#L61) | ); |
| [62](#L62) | } |
| [63](#L63) |  |
| [64](#L64) | Session::set\_session\_data('cart', $data); |
| [65](#L65) |  |
| [66](#L66) | return esc\_html\_\_( 'Added to cart', 'lifeline-donation' ); |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | /\*\* |
| [70](#L70) | \* Finally add to cart. |
| [71](#L71) | \* |
| [72](#L72) | \* @param array $args [description] |
| [73](#L73) | \*/ |
| [74](#L74) | static function remove\_from\_cart($args = array() ) { |
| [75](#L75) |  |
| [76](#L76) | $id = webinane\_set( $args, 'item\_id' ); |
| [77](#L77) | $data = Session::get\_session\_data\_by\_key('cart'); |
| [78](#L78) |  |
| [79](#L79) | if ( isset( $data[ $id ] ) ) { |
| [80](#L80) | unset($data[ $id ]); |
| [81](#L81) | } |
| [82](#L82) |  |
| [83](#L83) | Session::set\_session\_data('cart', $data); |
| [84](#L84) |  |
| [85](#L85) | return esc\_html\_\_( 'Removed from cart', 'lifeline-donation' ); |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | /\*\* |
| [89](#L89) | \* [checkout\_page\_orders description] |
| [90](#L90) | \* |
| [91](#L91) | \* @return [type] [description] |
| [92](#L92) | \*/ |
| [93](#L93) | static function checkout\_page\_orders() { |
| [94](#L94) |  |
| [95](#L95) | webinane\_template( 'checkout/orders.php' ); |
| [96](#L96) | } |
| [97](#L97) |  |
| [98](#L98) | /\*\* |
| [99](#L99) | \* [checkout\_page\_gateways description] |
| [100](#L100) | \* |
| [101](#L101) | \* @return [type] [description] |
| [102](#L102) | \*/ |
| [103](#L103) | static function checkout\_page\_gateways() { |
| [104](#L104) | $gateways = wpcm\_get\_active\_gateways()->get\_options(); |
| [105](#L105) |  |
| [106](#L106) | $names = apply\_filters( 'wpcm\_gateways\_names', array('offline\_payment', 'paypal') ); |
| [107](#L107) |  |
| [108](#L108) | webinane\_template('checkout/gateways.php', compact('gateways', 'names')); |
| [109](#L109) |  |
| [110](#L110) | } |
| [111](#L111) |  |
| [112](#L112) | /\*\* |
| [113](#L113) | \* [checkout\_form\_button description] |
| [114](#L114) | \* @return [type] [description] |
| [115](#L115) | \*/ |
| [116](#L116) | static function checkout\_form\_button() { |
| [117](#L117) |  |
| [118](#L118) | webinane\_template('checkout/button.php'); |
| [119](#L119) | } |
| [120](#L120) |  |
| [121](#L121) | /\*\* |
| [122](#L122) | \* [process\_checkout description] |
| [123](#L123) | \* @return [type] [description] |
| [124](#L124) | \*/ |
| [125](#L125) | static function process\_checkout() { |
| [126](#L126) | do\_action( 'wpcm\_pre\_process\_purchase' ); |
| [127](#L127) |  |
| [128](#L128) | $\_post = filter\_input\_array(INPUT\_POST, FILTER\_SANITIZE\_STRING); |
| [129](#L129) |  |
| [130](#L130) | $is\_ajax = isset( $\_post['is\_ajax'] ); |
| [131](#L131) |  |
| [132](#L132) | $nonce = esc\_attr( webinane\_set($\_post, 'nonce') ); |
| [133](#L133) |  |
| [134](#L134) | if ( ! wp\_verify\_nonce( $nonce, WPCM\_GLOBAL\_KEY )) { |
| [135](#L135) | wp\_send\_json\_error( array( 'message' => esc\_html\_\_( 'Security verification failed', 'lifeline-donation' ) ) ); |
| [136](#L136) | } |
| [137](#L137) |  |
| [138](#L138) | // Make sure the cart isn't empty |
| [139](#L139) | if ( ! wpcm\_get\_cart\_content() ) { |
| [140](#L140) | $valid\_data = false; |
| [141](#L141) | wp\_send\_json\_error( array( 'empty\_cart' => esc\_html\_\_( 'Your cart is empty', 'lifeline-donation' ) ) ); |
| [142](#L142) | } else { |
| [143](#L143) | // Validate the form $\_POST data |
| [144](#L144) | $valid\_data = self::validate\_fields($\_post, $is\_ajax); |
| [145](#L145) |  |
| [146](#L146) | // Allow themes and plugins to hook to errors |
| [147](#L147) | do\_action( 'wpcm\_checkout\_error\_checks', $valid\_data, $\_post ); |
| [148](#L148) | } |
| [149](#L149) |  |
| [150](#L150) | if( ! is\_user\_logged\_in() ) { |
| [151](#L151) | $email = sanitize\_email( webinane\_set( webinane\_set( $\_post, 'billing' ), 'email' ) ); |
| [152](#L152) |  |
| [153](#L153) | if( ! $email ) { |
| [154](#L154) | wp\_send\_json\_error( esc\_html\_\_( 'Please provide a valid email', 'lifeline-donation' ) ); |
| [155](#L155) | } |
| [156](#L156) |  |
| [157](#L157) | $user\_id = username\_exists( $email ); |
| [158](#L158) |  |
| [159](#L159) | if ( ! $user\_id && false == email\_exists( $email ) ) { |
| [160](#L160) | $random\_password = wp\_generate\_password(); |
| [161](#L161) | $user\_id = wp\_create\_user( $email, $random\_password, $email ); |
| [162](#L162) | if( is\_wp\_error( $user\_id ) ) { |
| [163](#L163) | wp\_send\_json\_error( $user\_id->getMessage() ); |
| [164](#L164) | } |
| [165](#L165) | wp\_send\_new\_user\_notifications( $user\_id, 'both' ); |
| [166](#L166) | wp\_set\_auth\_cookie( $user\_id, true ); |
| [167](#L167) | } else { |
| [168](#L168) | $user\_id = ( $user\_id ) ? $user\_id : email\_exists( $email ); |
| [169](#L169) |  |
| [170](#L170) | if( $user\_id ) { |
| [171](#L171) | wp\_set\_auth\_cookie( $user\_id, true ); |
| [172](#L172) | } else { |
| [173](#L173) | wp\_send\_json\_error( esc\_html\_\_('Something went wrong', 'lifeline-donation' ) ); |
| [174](#L174) | } |
| [175](#L175) | } |
| [176](#L176) | } |
| [177](#L177) |  |
| [178](#L178) | // Validate the user |
| [179](#L179) | $user = wp\_get\_current\_user(); |
| [180](#L180) |  |
| [181](#L181) | if( ! isset( $user->ID ) ) { |
| [182](#L182) | wp\_send\_json\_error( esc\_html\_\_( 'Please refresh the page and try again', 'lifeline-donation' ) ); |
| [183](#L183) | } |
| [184](#L184) |  |
| [185](#L185) | // Let extensions validate fields after user is logged in if user has used login/registration form |
| [186](#L186) |  |
| [187](#L187) | if ( false === $valid\_data || ! $user ) { |
| [188](#L188) | if ( $is\_ajax ) { |
| [189](#L189) | do\_action( 'wpcm\_ajax\_checkout\_errors' ); |
| [190](#L190) | wp\_die(); |
| [191](#L191) | } else { |
| [192](#L192) | return false; |
| [193](#L193) | } |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) | $billing = webinane\_set( $\_post, 'billing' ); |
| [197](#L197) | $shipping = webinane\_set( $\_post, 'shipping' ); |
| [198](#L198) |  |
| [199](#L199) | // Setup user information |
| [200](#L200) | $user\_info = array( |
| [201](#L201) | 'id'         => ($user->ID) ? $user->ID : 0, |
| [202](#L202) | 'email'      => ($user->user\_email) ? $user->user\_email : sanitize\_email( webinane\_set( $billing, 'email') ), |
| [203](#L203) | 'first\_name' => ($user->user\_first) ? $user->user\_first : esc\_attr( webinane\_set( $billing, 'first\_name' ) ), |
| [204](#L204) | 'last\_name' => ($user->user\_last) ? $user->user\_last : esc\_attr( webinane\_set( $billing, 'last\_name' ) ), |
| [205](#L205) | 'address'    => ! empty( $user->address ) ? $user->address : esc\_attr(webinane\_set( $billing, 'address\_line\_1')), |
| [206](#L206) | ); |
| [207](#L207) |  |
| [208](#L208) | // Update a customer record if they have added/updated information |
| [209](#L209) | $customer = new Customers( $user\_info['email'], $\_post ); |
| [210](#L210) | $customer->insert\_meta($customer->customer, $\_post); |
| [211](#L211) | if ( $is\_ajax ) { |
| [212](#L212) | } |
| [213](#L213) |  |
| [214](#L214) | $auth\_key = defined( 'AUTH\_KEY' ) ? AUTH\_KEY : ''; |
| [215](#L215) | // Set up the unique purchase key. If we are resuming a payment, we'll overwrite this with the existing key. |
| [216](#L216) | $purchase\_key     = strtolower( md5( $user\_info['email'] . date( 'Y-m-d H:i:s' ) . $auth\_key . uniqid( 'wpcm', true ) ) ); |
| [217](#L217) |  |
| [218](#L218) | // Setup purchase information |
| [219](#L219) | $purchase\_data = array( |
| [220](#L220) | 'items'        => wpcm\_get\_cart\_content(), |
| [221](#L221) |  |
| [222](#L222) | 'subtotal'     => wpcm\_get\_cart\_subtotal(),    // Amount before taxes and discounts |
| [223](#L223) |  |
| [224](#L224) | 'price'        => wpcm\_get\_cart\_total(),    // Amount after taxes |
| [225](#L225) | 'purchase\_key' => $purchase\_key, |
| [226](#L226) | 'user\_email'   => $user\_info['email'], |
| [227](#L227) | 'date'         => date( 'Y-m-d H:i:s', current\_time( 'timestamp' ) ), |
| [228](#L228) | 'user\_info'    => stripslashes\_deep( $user\_info ), |
| [229](#L229) | 'post\_data'    => $\_post, |
| [230](#L230) | 'gateway'      => $valid\_data['gateway'], |
| [231](#L231) | ); |
| [232](#L232) |  |
| [233](#L233) | // Add the user data for hooks |
| [234](#L234) | $valid\_data['user'] = $user; |
| [235](#L235) |  |
| [236](#L236) | // Allow themes and plugins to hook before the gateway |
| [237](#L237) | do\_action( 'wpcm\_checkout\_before\_gateway', $\_post, $user\_info, $valid\_data ); |
| [238](#L238) |  |
| [239](#L239) | // If the total amount in the cart is 0, send to the manual gateway. This emulates a free download purchase |
| [240](#L240) | if ( !$purchase\_data['price'] ) { |
| [241](#L241) | // Revert to manual |
| [242](#L242) | $purchase\_data['gateway'] = 'offline'; |
| [243](#L243) | $\_POST['payment-gateway'] = 'offline'; |
| [244](#L244) | } |
| [245](#L245) |  |
| [246](#L246) | // Setup the data we're storing in the purchase session |
| [247](#L247) |  |
| [248](#L248) | // Make sure credit card numbers are never stored in sessions |
| [249](#L249) |  |
| [250](#L250) | // Used for showing download links to non logged-in users after purchase, and for other plugins needing purchase data. |
| [251](#L251) | // Send info to the gateway for payment processing |
| [252](#L252) | wpcm\_send\_to\_gateway( $purchase\_data['gateway'], $purchase\_data ); |
| [253](#L253) | wp\_die(); |
| [254](#L254) | } |
| [255](#L255) |  |
| [256](#L256) | /\*\* |
| [257](#L257) | \* This method is used to validation the checkout form submitted data. |
| [258](#L258) | \* |
| [259](#L259) | \* @param  array   $data     An array of user submitted data. |
| [260](#L260) | \* @param  boolean $is\_ajax  Whether the request is an ajax or simple. |
| [261](#L261) | \* @return mix               If ajax then sends the json data, throw exception or array if successful. |
| [262](#L262) | \*/ |
| [263](#L263) | static function validate\_fields($data, $is\_ajax) { |
| [264](#L264) | $rules = apply\_filters( 'webinane\_commerce\_checkout\_form\_validation\_rules', [ |
| [265](#L265) | 'billing.email'                         => 'required|email', |
| [266](#L266) | 'billing.first\_name'            => 'required|min:4', |
| [267](#L267) | // 'billing.last\_name'                  => 'required|min:4', |
| [268](#L268) | 'billing.address\_line\_1'        => 'required|min:10', |
| [269](#L269) | 'billing.city'                          => 'required', |
| [270](#L270) | 'billing.base\_country'          => 'required', |
| [271](#L271) | 'nonce'                                         => 'required', |
| [272](#L272) | 'gateway'                                       => 'required' |
| [273](#L273) | ] ); |
| [274](#L274) |  |
| [275](#L275) | $validation = wpcm\_validator()->make($data, $rules); |
| [276](#L276) |  |
| [277](#L277) | // or this way: |
| [278](#L278) | $validation->setAliases([ |
| [279](#L279) | 'billing.email' => esc\_html\_\_('Billing Email', 'lifeline-donation'), |
| [280](#L280) | 'billing.first\_name' => esc\_html\_\_('Billing First Name', 'lifeline-donation'), |
| [281](#L281) | 'billing.address\_line\_1' => esc\_html\_\_('Billing Address', 'lifeline-donation'), |
| [282](#L282) | 'billing.city' => esc\_html\_\_('Billing City', 'lifeline-donation'), |
| [283](#L283) | 'billing.base\_country' => esc\_html\_\_('Billing Country', 'lifeline-donation'), |
| [284](#L284) | 'nonce' => esc\_html\_\_('Security check', 'lifeline-donation'), |
| [285](#L285) | 'gateway' => esc\_html\_\_('Payment Gateway', 'lifeline-donation'), |
| [286](#L286) | ]); |
| [287](#L287) |  |
| [288](#L288) | // then validate |
| [289](#L289) | $validation->validate(); |
| [290](#L290) |  |
| [291](#L291) | if ($validation->fails()) { |
| [292](#L292) | // handling errors |
| [293](#L293) | $errors = $validation->errors(); |
| [294](#L294) | if( $is\_ajax ) { |
| [295](#L295) | wp\_send\_json\_error( array('message' => implode("\n", $errors->all("<p>:message</p>")) ) ); |
| [296](#L296) | } |
| [297](#L297) | throw new \Exception($errors, 1); |
| [298](#L298) | } |
| [299](#L299) |  |
| [300](#L300) | return $data; |
| [301](#L301) | } |
| [302](#L302) |  |
| [303](#L303) | static function body\_class($classes) { |
| [304](#L304) |  |
| [305](#L305) | if( is\_page() ) { |
| [306](#L306) | if( wpcm\_is\_checkout\_page() ) { |
| [307](#L307) | $classes[] = 'wpcm-checkout-page'; |
| [308](#L308) | } |
| [309](#L309) | } |
| [310](#L310) | return $classes; |
| [311](#L311) | } |
| [312](#L312) |  |
| [313](#L313) | static function checkout\_data() { |
| [314](#L314) |  |
| [315](#L315) | $user = wp\_get\_current\_user(); |
| [316](#L316) | $settings = get\_option('\_wpcommerce\_settings'); |
| [317](#L317) |  |
| [318](#L318) | $countries = wpcm\_countries()->toArray(); |
| [319](#L319) |  |
| [320](#L320) | $symbol = webinane\_currency\_symbol(); |
| [321](#L321) |  |
| [322](#L322) | $cart = (array) wpcm\_get\_cart\_content(); |
| [323](#L323) |  |
| [324](#L324) | $items = array(); |
| [325](#L325) |  |
| [326](#L326) | if( $cart ) { |
| [327](#L327) | foreach( $cart as $c ) { |
| [328](#L328) | $collection = collect($c); |
| [329](#L329) | $items[$collection->get('item\_id')] = array( |
| [330](#L330) | 'thumb'                 => wp\_get\_attachment\_image\_src( get\_post\_thumbnail\_id( $collection->get('item\_id') ), 'thumbnail' ), |
| [331](#L331) | 'link'                  => get\_permalink($collection->get('item\_id')), |
| [332](#L332) | 'title'                 => get\_the\_title( $collection->get('item\_id')), |
| [333](#L333) | 'qty'                   => webinane\_set( $c, 'quantity'), |
| [334](#L334) | 'price'                 => webinane\_set( $c, 'price'), |
| [335](#L335) | ); |
| [336](#L336) | } |
| [337](#L337) | } |
| [338](#L338) |  |
| [339](#L339) | $cart['symbol'] = $symbol; |
| [340](#L340) |  |
| [341](#L341) | $customer = ($user->ID) ? new Customers( $user->user\_email ) : array(); |
| [342](#L342) | if( $customer ) { |
| [343](#L343) | $customer = $customer->full\_customer\_info(); |
| [344](#L344) | } |
| [345](#L345) | wp\_send\_json(compact('countries', 'cart', 'customer', 'items')); |
| [346](#L346) | } |
| [347](#L347) | } |
| [348](#L348) |  |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/lifeline-donation/trunk/vendor/webinane/webinane-commerce/includes/Classes/Checkout.php?rev=2490935&format=txt)
* [Original Format](/export/2490935/lifeline-donation/trunk/vendor/webinane/webinane-commerce/includes/Classes/Checkout.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_acbff999_20250111_153049.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Lifeline Donation <= 1.2.6 - Authentication Bypass

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Lifeline Donation <= 1.2.6 - Authentication Bypass

9.8

**Authentication Bypass Using an Alternate Path or Channel**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2024-5432](https://www.cve.org/CVERecord?id=CVE-2024-5432) |
| --- | --- |
| CVSS | 9.8 (Critical) |
| Publicly Published | June 19, 2024 |
| Last Updated | June 20, 2024 |
| Researcher | [István Márton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) |

### Description

The Lifeline Donation plugin for WordPress is vulnerable to authentication bypass in versions up to, and including, 1.2.6. This is due to insufficient verification on the user being supplied during the checkout through the plugin. This makes it possible for unauthenticated attackers to log in as any existing user on the site, such as an administrator, if they have access to the email.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/lifeline-donation/trunk/includes/class-lifeline-donation.php?rev=2575844#L292)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/lifeline-donation/trunk/vendor/webinane/webinane-commerce/includes/Classes/Checkout.php?rev=2490935#L125)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Flifeline-donation%2Flifeline-donation-126-authentication-bypass&t=Lifeline%20Donation%20%3C%3D%201.2.6%20-%20Authentication%20Bypass "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Flifeline-donation%2Flifeline-donation-126-authentication-bypass&text=Lifeline%20Donation%20%3C%3D%201.2.6%20-%20Authentication%20Bypass "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Flifeline-donation%2Flifeline-donation-126-authentication-bypass "LinkedIn")
Email

## Vulnerability Details for Lifeline Donation

#### [Lifeline Donation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/lifeline-donation)

| Software Type | Plugin |
| --- | --- |
| Software Slug | lifeline-donation [(view on wordpress.org)](https://wordpress.org/plugins/lifeline-donation) |
| Patched? | No |
| Remediation | No known patch available. Please review the vulnerability's details in depth and employ mitigations based on your organization's risk tolerance. It may be best to uninstall the affected software and find a replacement. |
| Affected Version | * <= 1.2.6 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_89113dcf_20250111_153022.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Flifeline-donation%2Ftrunk%2Fincludes%2Fclass-lifeline-donation.php%3Frev%3D2575844)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/lifeline-donation/trunk/includes/class-lifeline-donation.php?rev=2490935 "Revision 2490935")
* [Latest Revision](/browser/lifeline-donation/trunk/includes/class-lifeline-donation.php)
* Next Revision →
* [Blame](/browser/lifeline-donation/trunk/includes/class-lifeline-donation.php?annotate=blame&rev=2575844 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/lifeline-donation/trunk/includes/class-lifeline-donation.php?rev=2575844)

---

# [source:](/browser?rev=2575844&order=name "Go to repository root") [lifeline-donation](/browser/lifeline-donation?rev=2575844&order=name "View lifeline-donation")/[trunk](/browser/lifeline-donation/trunk?rev=2575844&order=name "View trunk")/[includes](/browser/lifeline-donation/trunk/includes?rev=2575844&order=name "View includes")/[class-lifeline-donation.php](/browser/lifeline-donation/trunk/includes/class-lifeline-donation.php?rev=2575844&order=name "View class-lifeline-donation.php") @ [2575844](/changeset/2575844/ "View changeset 2575844")

View diff against:

View revision:

| [Last change](/changeset/2575844/lifeline-donation/trunk/includes/class-lifeline-donation.php "View differences") on this file since 2575844 was [2575844](/changeset/2575844/ "View changeset 2575844"), checked in by webinnane, [3 years ago](/timeline?from=2021-07-31T20%3A41%3A07Z&precision=second "See timeline at 07/31/2021 08:41:07 PM") |
| --- |
| version 1.2.6 |
| **File size:** 18.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Lifeline Donation |
| [4](#L4) | \* |
| [5](#L5) | \* @package WordPress |
| [6](#L6) | \*/ |
| [7](#L7) |  |
| [8](#L8) | use LifelineDoantion\Classes\GeneralDonation; |
| [9](#L9) | use LifelineDoantion\Classes\SingleDonation; |
| [10](#L10) | use LifelineDonation\Classes\DbUpgradeFromThree; |
| [11](#L11) | use LifelineDonation\Classes\LifelineDonation; |
| [12](#L12) | use WebinaneCommerce\Classes\Customers; |
| [13](#L13) | use WebinaneCommerce\Classes\Orders; |
| [14](#L14) | use WebinaneCommerce\Fields\Select; |
| [15](#L15) | use WebinaneCommerce\Models\OrderItems; |
| [16](#L16) |  |
| [17](#L17) | /\*\* |
| [18](#L18) | \* Webinane Donation main class. |
| [19](#L19) | \*/ |
| [20](#L20) | class Lifeline\_Donation { |
| [21](#L21) |  |
| [22](#L22) |  |
| [23](#L23) | /\*\* |
| [24](#L24) | \* Init method. |
| [25](#L25) | \* |
| [26](#L26) | \* @return void [description] |
| [27](#L27) | \*/ |
| [28](#L28) | public static function init() { |
| [29](#L29) | add\_action( 'get\_footer', array( \_\_CLASS\_\_, 'donation\_modal' ), 4 ); |
| [30](#L30) | add\_action( 'wp\_enqueue\_scripts', array( \_\_CLASS\_\_, 'enqueue' ), 1000 ); |
| [31](#L31) |  |
| [32](#L32) | add\_filter( 'wpcommerce\_admin\_orders\_metabox\_title', array( \_\_CLASS\_\_, 'donation\_metabox\_title' ) ); |
| [33](#L33) | add\_filter( 'wpcommerce\_settings', array( \_\_CLASS\_\_, 'settings' ) ); |
| [34](#L34) |  |
| [35](#L35) | add\_filter( 'manage\_cause\_posts\_columns', array( \_\_CLASS\_\_, 'cpt\_columns' ) ); |
| [36](#L36) | add\_filter( 'manage\_project\_posts\_columns', array( \_\_CLASS\_\_, 'cpt\_columns' ) ); |
| [37](#L37) | add\_action( 'manage\_posts\_custom\_column', array( \_\_CLASS\_\_, 'custom\_columns' ) ); |
| [38](#L38) |  |
| [39](#L39) | add\_filter( 'wpcommerce\_metabox\_fields\_supported\_post\_types', array( \_\_CLASS\_\_, 'get\_supported\_post\_types' ) ); |
| [40](#L40) |  |
| [41](#L41) | add\_shortcode( 'webinane\_donation\_page', array( \_\_CLASS\_\_, 'shortcode\_donation\_page' ) ); |
| [42](#L42) |  |
| [43](#L43) | add\_action( 'wp\_ajax\_webinane\_donation\_admin\_order\_data', array( \_\_CLASS\_\_, 'admin\_order\_data' ) ); |
| [44](#L44) | self::image\_sizes(); |
| [45](#L45) |  |
| [46](#L46) | add\_filter( |
| [47](#L47) | 'wpcm\_orders\_admin\_menu\_label', |
| [48](#L48) | function( $label ) { |
| [49](#L49) | return esc\_html\_\_( 'Donations', 'lifeline-donation' ); |
| [50](#L50) | } |
| [51](#L51) | ); |
| [52](#L52) | add\_filter( |
| [53](#L53) | 'wpcm\_order\_admin\_menu\_label', |
| [54](#L54) | function( $label ) { |
| [55](#L55) | return esc\_html\_\_( 'Donation', 'lifeline-donation' ); |
| [56](#L56) | } |
| [57](#L57) | ); |
| [58](#L58) | add\_filter( |
| [59](#L59) | 'wpcm\_price\_label', |
| [60](#L60) | function( $label ) { |
| [61](#L61) | return esc\_html\_\_( 'Donation', 'lifeline-donation' ); |
| [62](#L62) | } |
| [63](#L63) | ); |
| [64](#L64) |  |
| [65](#L65) |  |
| [66](#L66) | add\_action( 'wpcm\_new\_order\_process\_meta', array( \_\_CLASS\_\_, 'update\_donation\_meta' ), 10, 2 ); |
| [67](#L67) | add\_action( 'admin\_enqueue\_scripts', array( \_\_CLASS\_\_, 'admin\_enqueue' ) ); |
| [68](#L68) |  |
| [69](#L69) | add\_action('wp\_ajax\_lifelie\_donation\_load\_modal\_html', array(\_\_CLASS\_\_, 'donation\_modal\_component')); |
| [70](#L70) | add\_action('wp\_ajax\_nopriv\_lifelie\_donation\_load\_modal\_html', array(\_\_CLASS\_\_, 'donation\_modal\_component')); |
| [71](#L71) |  |
| [72](#L72) | add\_action('wp\_body\_open', array(\_\_CLASS\_\_, 'preloader')); |
| [73](#L73) |  |
| [74](#L74) | add\_filter('webinane\_commerce/settings/display\_settings', array(\_\_CLASS\_\_, 'display\_settings')); |
| [75](#L75) | // add\_filter('wpcm\_new\_order\_customer\_email\_template', [\_\_CLASS\_\_, 'new\_donation\_email\_template'], 30, 3); |
| [76](#L76) | // add\_filter('wpcm\_new\_order\_owner\_email\_template', [\_\_CLASS\_\_, 'new\_donation\_admin\_email\_template'], 30, 3); |
| [77](#L77) |  |
| [78](#L78) | add\_filter('lifeline\_donation/settings', function($settings) { |
| [79](#L79) | $settings[] = require LIFELINE\_DONATION\_PATH . 'config/donation\_settings.php'; |
| [80](#L80) | // $settings[] = require LIFELINE\_DONATION\_PATH . 'config/donation\_button.php'; |
| [81](#L81) | $settings[] = require LIFELINE\_DONATION\_PATH . 'config/general\_popup.php'; |
| [82](#L82) | $settings[] = require LIFELINE\_DONATION\_PATH . 'config/posttype\_popup.php'; |
| [83](#L83) | $settings[] = require LIFELINE\_DONATION\_PATH . 'config/menu\_button.php'; |
| [84](#L84) | $settings[] = require LIFELINE\_DONATION\_PATH . 'config/archive\_setting.php'; |
| [85](#L85) |  |
| [86](#L86) | return $settings; |
| [87](#L87) | }); |
| [88](#L88) |  |
| [89](#L89) | } |
| [90](#L90) |  |
| [91](#L91) |  |
| [92](#L92) | /\*\* |
| [93](#L93) | \* [donation\_modal\_component description] |
| [94](#L94) | \* |
| [95](#L95) | \* @return [type] [description] |
| [96](#L96) | \*/ |
| [97](#L97) | public static function donation\_modal\_component() { |
| [98](#L98) | $settings = wpcm\_get\_settings(); |
| [99](#L99) | if ( ( $settings->get( 'donation\_Cpost\_type' ) == 'donation\_popup\_box' ) || ( $settings->get( 'donation\_general\_type' ) == 'donation\_popup\_box' ) ) { |
| [100](#L100) |  |
| [101](#L101) | $modal\_style = $settings->get( 'donation\_popup\_style' ); |
| [102](#L102) | if ( 'style2' == $modal\_style ) { |
| [103](#L103) | $file = get\_theme\_file\_path( 'lifeline-donation/modal/modal2.php' ); |
| [104](#L104) | } elseif ( 'style3' == $modal\_style ) { |
| [105](#L105) | $file = get\_theme\_file\_path( 'lifeline-donation/modal/modal3.php' ); |
| [106](#L106) |  |
| [107](#L107) | } else { |
| [108](#L108) | $file = get\_theme\_file\_path( 'lifeline-donation/modal/modal.php' ); |
| [109](#L109) | } |
| [110](#L110) |  |
| [111](#L111) | if ( file\_exists( $file ) ) { |
| [112](#L112) | ob\_start(); |
| [113](#L113) | include $file; |
| [114](#L114) | $content = ob\_get\_clean(); |
| [115](#L115) | wp\_send\_json(array('data' => $content)); |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) |  |
| [119](#L119) | ob\_start(); |
| [120](#L120) |  |
| [121](#L121) | if ( 'style2' == $modal\_style ) { |
| [122](#L122) | include LIFELINE\_DONATION\_PATH . 'templates/modal/modal2.php'; |
| [123](#L123) | } elseif ( 'style3' == $modal\_style ) { |
| [124](#L124) | include LIFELINE\_DONATION\_PATH . 'templates/modal/modal3.php'; |
| [125](#L125) | } else { |
| [126](#L126) | include LIFELINE\_DONATION\_PATH . 'templates/modal/modal.php'; |
| [127](#L127) | } |
| [128](#L128) |  |
| [129](#L129) | $content = ob\_get\_clean(); |
| [130](#L130) |  |
| [131](#L131) | wp\_send\_json(array('data' => $content)); |
| [132](#L132) | } |
| [133](#L133) | } |
| [134](#L134) | /\*\* |
| [135](#L135) | \* Donation modal. |
| [136](#L136) | \* |
| [137](#L137) | \* @return [type] [description] |
| [138](#L138) | \*/ |
| [139](#L139) | public static function donation\_modal() { |
| [140](#L140) |  |
| [141](#L141) | $settings = wpcm\_get\_settings(); |
| [142](#L142) | // printr($settings); |
| [143](#L143) | if ( ( $settings->get( 'donation\_Cpost\_type' ) == 'donation\_popup\_box' ) || ( $settings->get( 'donation\_general\_type' ) == 'donation\_popup\_box' ) ) { |
| [144](#L144) |  |
| [145](#L145) | $modal\_style = $settings->get( 'donation\_popup\_style' ); |
| [146](#L146) | if ( 'style2' == $modal\_style ) { |
| [147](#L147) | $file = get\_theme\_file\_path( 'lifeline-donation/modal2.php' ); |
| [148](#L148) | } elseif ( 'style3' == $modal\_style ) { |
| [149](#L149) | $file = get\_theme\_file\_path( 'lifeline-donation/modal2.php' ); |
| [150](#L150) |  |
| [151](#L151) | } else { |
| [152](#L152) | $file = get\_theme\_file\_path( 'lifeline-donation/modal.php' ); |
| [153](#L153) | } |
| [154](#L154) |  |
| [155](#L155) | if ( file\_exists( $file ) ) { |
| [156](#L156) | include $file; |
| [157](#L157) | return; |
| [158](#L158) | } |
| [159](#L159) |  |
| [160](#L160) | $js = 'jQuery(document).ready(function($){ |
| [161](#L161) | $(document).on(\'webinane\_donation\_modal\_opened\', function(app){ |
| [162](#L162) | $(\'.donation-wrapper-content.lifeline-donation-modal\').addClass(\'active\'); |
| [163](#L163) | if($.fn.perfectScrollbar !== undefined) { |
| [164](#L164) | $(\'.donation-wrapper-content.lifeline-donation-modal\').perfectScrollbar(); |
| [165](#L165) | } |
| [166](#L166) | }); |
| [167](#L167) |  |
| [168](#L168) | $(document).on(\'webinane\_donation\_modal\_closed\', function(app){ |
| [169](#L169) | $(\'.donation-wrapper-content.lifeline-donation-modal\').removeClass(\'active\'); |
| [170](#L170) | }) |
| [171](#L171) | });'; |
| [172](#L172) |  |
| [173](#L173) | wp\_add\_inline\_script( 'lifeline-donation-modal', $js ); |
| [174](#L174) |  |
| [175](#L175) | if ( 'style2' == $modal\_style ) { |
| [176](#L176) | include LIFELINE\_DONATION\_PATH . 'templates/modal2.php'; |
| [177](#L177) | } elseif ( 'style3' == $modal\_style ) { |
| [178](#L178) | include LIFELINE\_DONATION\_PATH . 'templates/modal3.php'; |
| [179](#L179) | } else { |
| [180](#L180) | include LIFELINE\_DONATION\_PATH . 'templates/modal.php'; |
| [181](#L181) | } |
| [182](#L182) | } |
| [183](#L183) | } |
| [184](#L184) |  |
| [185](#L185) | /\*\* |
| [186](#L186) | \* Add image sizes. |
| [187](#L187) | \* |
| [188](#L188) | \* @return void [description] |
| [189](#L189) | \*/ |
| [190](#L190) | public static function image\_sizes() { |
| [191](#L191) | add\_image\_size( 'wi\_donation\_460x490', 460, 490, true ); |
| [192](#L192) | add\_image\_size( 'wi\_donation\_350x270', 350, 270, true ); |
| [193](#L193) | add\_image\_size( 'wi\_donation\_370x475', 370, 475, true ); |
| [194](#L194) | add\_image\_size( 'wi\_donation\_540x380', 540, 380, true ); |
| [195](#L195) | } |
| [196](#L196) |  |
| [197](#L197) | /\*\* |
| [198](#L198) | \* Donation modal enquque scripts and styles. |
| [199](#L199) | \* |
| [200](#L200) | \* @return void [description] |
| [201](#L201) | \*/ |
| [202](#L202) | public static function enqueue() { |
| [203](#L203) |  |
| [204](#L204) | wp\_enqueue\_style( array( 'wpcommerce\_main' ) ); |
| [205](#L205) | global $post; |
| [206](#L206) |  |
| [207](#L207) | $settings = wpcm\_get\_settings(); |
| [208](#L208) |  |
| [209](#L209) | $min = (WP\_DEBUG) ? '.min' : ''; |
| [210](#L210) | $show\_style = array\_get($settings, 'donation\_enable\_plugin\_css', true); |
| [211](#L211) | $show\_style = ( 'false' === $show\_style || ! $show\_style ) ? false : $show\_style; |
| [212](#L212) | $show\_style = apply\_filters( 'webinane\_donation\_load\_plugin\_style', $show\_style, $settings ); |
| [213](#L213) |  |
| [214](#L214) |  |
| [215](#L215) | if ( $show\_style ) { |
| [216](#L216) | wp\_enqueue\_style( 'lifeline-donation-syle', LIFELINE\_DONATION\_URL . 'assets/css/style'.$min.'.css', array(), LifelineDonation::$version ); |
| [217](#L217) | } |
| [218](#L218) |  |
| [219](#L219) |  |
| [220](#L220) | wp\_register\_style( 'webinane-shortcodes', LIFELINE\_DONATION\_URL . 'assets/css/webinane-shortcodes'.$min.'.css', array(), LifelineDonation::$version ); |
| [221](#L221) | wp\_register\_style( 'webinane-flat-icon', LIFELINE\_DONATION\_URL . 'assets/css/flaticon.css', array(), LifelineDonation::$version ); |
| [222](#L222) | wp\_register\_script( 'knob', LIFELINE\_DONATION\_URL . 'assets/js/jquery.knob.js', array( 'jquery' ), LifelineDonation::$version, true ); |
| [223](#L223) |  |
| [224](#L224) | wp\_register\_script( 'select2', LIFELINE\_DONATION\_URL . 'assets/js/select2.min.js', array( 'jquery' ), LifelineDonation::$version, true ); |
| [225](#L225) |  |
| [226](#L226) | wp\_register\_script( 'lifeline-donation-modal', LIFELINE\_DONATION\_URL . 'assets/js/index.js', array( 'element-ui-en', 'knob', 'select2' ), 1.0, true ); |
| [227](#L227) |  |
| [228](#L228) | wp\_enqueue\_script( array( 'wp-i18n', 'underscore', 'lifeline-donation-modal' ) ); |
| [229](#L229) | wp\_set\_script\_translations( 'lifeline-donation-modal', 'lifeline-donation', LIFELINE\_DONATION\_PATH . 'languages' ); |
| [230](#L230) | } |
| [231](#L231) |  |
| [232](#L232) | /\*\* |
| [233](#L233) | \* [fontend\_donation\_form\_data description] |
| [234](#L234) | \* |
| [235](#L235) | \* @return void [description] |
| [236](#L236) | \*/ |
| [237](#L237) | public static function fontend\_donation\_form\_data() { |
| [238](#L238) | $\_post = filter\_input\_array( INPUT\_POST, FILTER\_SANITIZE\_STRING ); |
| [239](#L239) |  |
| [240](#L240) | $nonce = sanitize\_text\_field( webinane\_set( $\_post, 'nonce' ) ); |
| [241](#L241) |  |
| [242](#L242) | if ( ! wp\_verify\_nonce( $nonce, WPCM\_GLOBAL\_KEY ) ) { |
| [243](#L243) | wp\_send\_json( |
| [244](#L244) | array( |
| [245](#L245) | 'success' => false, |
| [246](#L246) | 'message' => esc\_html\_\_( |
| [247](#L247) | 'Security verification failed', |
| [248](#L248) | 'lifeline-donation' |
| [249](#L249) | ), |
| [250](#L250) | ), |
| [251](#L251) | 403 |
| [252](#L252) | ); |
| [253](#L253) | } |
| [254](#L254) |  |
| [255](#L255) | if( array\_get($\_post, 'type') == 'general') { |
| [256](#L256) | GeneralDonation::instance()->getData($\_post); |
| [257](#L257) | } else { |
| [258](#L258) | SingleDonation::instance()->getData($\_post); |
| [259](#L259) | } |
| [260](#L260) |  |
| [261](#L261) |  |
| [262](#L262) | } |
| [263](#L263) |  |
| [264](#L264) | /\*\* |
| [265](#L265) | \* Get currency symbol. |
| [266](#L266) | \* |
| [267](#L267) | \* @return void [description] |
| [268](#L268) | \*/ |
| [269](#L269) | public static function currency\_symbol() { |
| [270](#L270) | $\_post = filter\_input\_array( INPUT\_POST, FILTER\_SANITIZE\_STRING ); |
| [271](#L271) | if ( ! sanitize\_text\_field( webinane\_set( $\_post, 'currency' ) ) ) { |
| [272](#L272) | wp\_send\_json\_error( array( 'message' => esc\_html\_\_( 'No currency data provided', 'lifeline-donation' ) ) ); |
| [273](#L273) | } |
| [274](#L274) |  |
| [275](#L275) | $currency = sanitize\_text\_field( webinane\_set( $\_post, 'currency' ) ); |
| [276](#L276) | $currencies = webinane\_array( webinane\_currencies() ); |
| [277](#L277) |  |
| [278](#L278) | $symbol = $currencies->filter( |
| [279](#L279) | function( $value ) use ( $currency ) { |
| [280](#L280) | return $value['iso']['code'] == $currency; |
| [281](#L281) | } |
| [282](#L282) | )->first(); |
| [283](#L283) |  |
| [284](#L284) | $symbol = array\_get( $symbol, 'units.major.symbol', '$' ); |
| [285](#L285) | wp\_send\_json\_success( $symbol ); |
| [286](#L286) | } |
| [287](#L287) | /\*\* |
| [288](#L288) | \* Donate now. |
| [289](#L289) | \* |
| [290](#L290) | \* @return void [description] |
| [291](#L291) | \*/ |
| [292](#L292) | public static function donate\_now() { |
| [293](#L293) | $\_post = filter\_input\_array( INPUT\_POST, FILTER\_SANITIZE\_STRING ); |
| [294](#L294) |  |
| [295](#L295) | $nonce = sanitize\_text\_field( webinane\_set( $\_post, 'nonce' ) ); |
| [296](#L296) |  |
| [297](#L297) | if ( ! wp\_verify\_nonce( $nonce, WPCM\_GLOBAL\_KEY ) ) { |
| [298](#L298) | wp\_send\_json( |
| [299](#L299) | array( |
| [300](#L300) | 'success' => false, |
| [301](#L301) | 'message' => esc\_html\_\_( |
| [302](#L302) | 'Security verification failed', |
| [303](#L303) | 'lifeline-donation' |
| [304](#L304) | ), |
| [305](#L305) | ), |
| [306](#L306) | 403 |
| [307](#L307) | ); |
| [308](#L308) | } |
| [309](#L309) |  |
| [310](#L310) | $type = array\_get($\_post, 'type'); |
| [311](#L311) | if($type == 'general') { |
| [312](#L312) | GeneralDonation::instance()->donateNow($\_post); |
| [313](#L313) | } else { |
| [314](#L314) | SingleDonation::instance()->donateNow($\_post); |
| [315](#L315) | } |
| [316](#L316) | } |
| [317](#L317) |  |
| [318](#L318) | /\*\* |
| [319](#L319) | \* Metabox title. |
| [320](#L320) | \* |
| [321](#L321) | \* @return [type] [description] |
| [322](#L322) | \*/ |
| [323](#L323) | public static function donation\_metabox\_title() { |
| [324](#L324) | return esc\_html\_\_( 'Donation Setting', 'lifeline-donation' ); |
| [325](#L325) | } |
| [326](#L326) |  |
| [327](#L327) | /\*\* |
| [328](#L328) | \* Load settings. |
| [329](#L329) | \* |
| [330](#L330) | \* @param  [type] $settings [description]. |
| [331](#L331) | \* |
| [332](#L332) | \* @return [type]           [description] |
| [333](#L333) | \*/ |
| [334](#L334) | public static function settings( $settings ) { |
| [335](#L335) | $donation\_settings = require LIFELINE\_DONATION\_PATH . 'config/settings.php'; |
| [336](#L336) | // $donation\_button = require LIFELINE\_DONATION\_PATH . 'config/donation\_button.php'; |
| [337](#L337) | // $archive\_setting = require LIFELINE\_DONATION\_PATH . 'config/archive\_setting.php'; |
| [338](#L338) | /\*if ( $donation\_settings ) { |
| [339](#L339) | $settings = array\_merge( (array) $settings, $donation\_settings ); |
| [340](#L340) | } |
| [341](#L341) | if ( $donation\_button ) { |
| [342](#L342) | $settings = array\_merge( (array) $settings, $donation\_button ); |
| [343](#L343) | } |
| [344](#L344) | if ( $archive\_setting ) { |
| [345](#L345) | $settings = array\_merge( (array) $settings, $archive\_setting ); |
| [346](#L346) | }\*/ |
| [347](#L347) | $settings = array\_merge($settings, $donation\_settings); |
| [348](#L348) | return $settings; |
| [349](#L349) | } |
| [350](#L350) |  |
| [351](#L351) | /\*\* |
| [352](#L352) | \* Display settings. |
| [353](#L353) | \* |
| [354](#L354) | \* @param  [type] $settings [description]. |
| [355](#L355) | \* |
| [356](#L356) | \* @return [type]           [description] |
| [357](#L357) | \*/ |
| [358](#L358) | public static function display\_settings( $settings ) { |
| [359](#L359) | $\_setting = array( |
| [360](#L360) | Select::make( |
| [361](#L361) | esc\_html\_\_( 'Donation History Page', 'lifeline-donation' ), |
| [362](#L362) | 'donors\_donation\_listing\_page' |
| [363](#L363) | )->setOptions(wpcm\_posts\_data(array('post\_type' => 'page', 'posts\_per\_page' => 100))) |
| [364](#L364) | ->setHelp( |
| [365](#L365) | esc\_html\_\_( 'This page shows a complete donation history for the specific user. The donation history "shortcode should be on this page."', 'lifeline-donation' ) |
| [366](#L366) | ), |
| [367](#L367) | ); |
| [368](#L368) | $settings = array\_merge( (array) $settings, $\_setting ); |
| [369](#L369) |  |
| [370](#L370) | foreach($settings as $key => $value ) { |
| [371](#L371) | if(in\_array($value->attribute, array('checkout\_page', 'redirect\_to\_checkout'))) { |
| [372](#L372) | unset( $settings[ $key ] ); |
| [373](#L373) | } |
| [374](#L374) | } |
| [375](#L375) |  |
| [376](#L376) | return array\_values($settings); |
| [377](#L377) | } |
| [378](#L378) |  |
| [379](#L379) | /\*\* |
| [380](#L380) | \* Custom post types columns. |
| [381](#L381) | \* |
| [382](#L382) | \* @param  [type] $columns [description]. |
| [383](#L383) | \* |
| [384](#L384) | \* @return [type]          [description] |
| [385](#L385) | \*/ |
| [386](#L386) | public static function cpt\_columns( $columns ) { |
| [387](#L387) | $mycol = array( |
| [388](#L388) | 'cb' => '<input type="checkbox" />', |
| [389](#L389) | 'thumbnail' => '<span><span title="Thumbnail" class="dashicons dashicons-format-image"><span class="screen-reader-text">' . esc\_html\_\_( 'Thumbnail', 'lifeline-donation' ) . '</span></span></span>', |
| [390](#L390) | ); |
| [391](#L391) |  |
| [392](#L392) | $columns = array\_merge( $mycol, $columns ); |
| [393](#L393) |  |
| [394](#L394) | $columns['collected']= esc\_html\_\_('Collected', 'lifeline-donation'); |
| [395](#L395) | $columns['target']= esc\_html\_\_('Target', 'lifeline-donation'); |
| [396](#L396) |  |
| [397](#L397) | return $columns; |
| [398](#L398) | } |
| [399](#L399) |  |
| [400](#L400) | /\*\* |
| [401](#L401) | \* Custom column |
| [402](#L402) | \* |
| [403](#L403) | \* @param  [type] $column [description]. |
| [404](#L404) | \* |
| [405](#L405) | \* @return [type]         [description] |
| [406](#L406) | \*/ |
| [407](#L407) | public static function custom\_columns( $column ) { |
| [408](#L408) | global $post, $wpdb; |
| [409](#L409) |  |
| [410](#L410) | if ( ! in\_array( $post->post\_type, array( 'cause', 'project', 'product' ) ) ) { |
| [411](#L411) | return; |
| [412](#L412) | } |
| [413](#L413) |  |
| [414](#L414) | switch ( $column ) { |
| [415](#L415) | case 'thumbnail': |
| [416](#L416) | echo get\_the\_post\_thumbnail( $post, array( 50, 50 ) ); |
| [417](#L417) | break; |
| [418](#L418) | case 'collected': |
| [419](#L419) | $ids = $post->ID; |
| [420](#L420) | $orders = OrderItems::whereHas( |
| [421](#L421) | 'order', |
| [422](#L422) | function( $query ) use ( $ids ) { |
| [423](#L423) | return $query->where( 'post\_id', $ids )->status( 'completed' ); |
| [424](#L424) | } |
| [425](#L425) | )->sum( 'price' ); |
| [426](#L426) | echo '<strong>'.webinane\_currency\_symbol().'</strong>' . $orders; |
| [427](#L427) | break; |
| [428](#L428) | case 'target': |
| [429](#L429) | $key\_set = ''; |
| [430](#L430) | if($post->post\_type == 'cause'){ |
| [431](#L431) | $key\_set = 'causes\_settings'; |
| [432](#L432) | } |
| [433](#L433) | if($post->post\_type == 'project'){ |
| [434](#L434) | $key\_set = 'project\_settings'; |
| [435](#L435) | } |
| [436](#L436) | $meta = get\_post\_meta($post->ID, $key\_set, true); |
| [437](#L437) | if(webinane\_set($meta,'donation')){ |
| [438](#L438) | echo '<strong>'.webinane\_currency\_symbol().'</strong>' . webinane\_set($meta,'donation'); |
| [439](#L439) | }else{ |
| [440](#L440) | echo '<strong>'.webinane\_currency\_symbol().'</strong> 0'; |
| [441](#L441) | } |
| [442](#L442) | break; |
| [443](#L443) |  |
| [444](#L444) | } |
| [445](#L445) | } |
| [446](#L446) |  |
| [447](#L447) | /\*\* |
| [448](#L448) | \* Hookup enabled post types |
| [449](#L449) | \* |
| [450](#L450) | \* @param  [type] $post\_types [description]. |
| [451](#L451) | \* |
| [452](#L452) | \* @return [type]             [description] |
| [453](#L453) | \*/ |
| [454](#L454) | public static function get\_supported\_post\_types( $post\_types ) { |
| [455](#L455) |  |
| [456](#L456) | if ( wpcm\_get\_settings()->get( 'donation\_causes\_status' ) ) { |
| [457](#L457) | $post\_types[] = 'cause'; |
| [458](#L458) | } |
| [459](#L459) |  |
| [460](#L460) | if ( wpcm\_get\_settings()->get( 'donation\_projects\_status' ) ) { |
| [461](#L461) | $post\_types[] = 'project'; |
| [462](#L462) | } |
| [463](#L463) |  |
| [464](#L464) | return $post\_types; |
| [465](#L465) | } |
| [466](#L466) |  |
| [467](#L467) | /\*\* |
| [468](#L468) | \* Change the upgrade status after completion. |
| [469](#L469) | \* |
| [470](#L470) | \* @param  [type] $status [description]. |
| [471](#L471) | \* |
| [472](#L472) | \* @return [type]         [description] |
| [473](#L473) | \*/ |
| [474](#L474) | public static function db\_upgrade\_status( $status ) { |
| [475](#L475) | $query = new WP\_Query( array( 'post\_type' => 'lif\_causes' ) ); |
| [476](#L476) |  |
| [477](#L477) | if ( $query->have\_posts() ) { |
| [478](#L478) | $res = 'YES'; |
| [479](#L479) | } else { |
| [480](#L480) | $res = 'NO'; |
| [481](#L481) | } |
| [482](#L482) | wp\_reset\_postdata(); |
| [483](#L483) |  |
| [484](#L484) | return $res; |
| [485](#L485) | } |
| [486](#L486) |  |
| [487](#L487) | /\*\* |
| [488](#L488) | \* Finally run db update. |
| [489](#L489) | \* |
| [490](#L490) | \* @return void [description] |
| [491](#L491) | \*/ |
| [492](#L492) | public static function run\_database\_upgrade() { |
| [493](#L493) | DbUpgradeFromThree::init(); |
| [494](#L494) | } |
| [495](#L495) |  |
| [496](#L496) |  |
| [497](#L497) | /\*\* |
| [498](#L498) | \* Shortcode Donation page. |
| [499](#L499) | \* |
| [500](#L500) | \* @param  array  $atts     Array of attributes. |
| [501](#L501) | \* @param  string $content HTML content. |
| [502](#L502) | \* @param  string $tag     shortcode name. |
| [503](#L503) | \* @return string          Returns the output of shortcode. |
| [504](#L504) | \*/ |
| [505](#L505) | public static function shortcode\_donation\_page( $atts, $content = null, $tag ) { |
| [506](#L506) |  |
| [507](#L507) | $id = webinane\_set( $atts, 'id' ); |
| [508](#L508) | $style = webinane\_set( $atts, 'style' ); |
| [509](#L509) | $title = webinane\_set( $atts, 'title' ); |
| [510](#L510) | if ( isset( $\_GET['post\_id'] ) ) { |
| [511](#L511) | $id = sanitize\_text\_field( webinane\_set( $\_GET, 'post\_id' ) ); |
| [512](#L512) | } |
| [513](#L513) |  |
| [514](#L514) | /\*if ( ! absint( $id ) ) { |
| [515](#L515) | return '<div class="alert alert-warning">' . esc\_html\_\_( 'Donation ID is not provided, please visit homepage', 'lifeline-donation' ) . '</div>'; |
| [516](#L516) | }\*/ |
| [517](#L517) |  |
| [518](#L518) | wp\_enqueue\_script( array( 'lifeline-donation-modal' ) ); |
| [519](#L519) |  |
| [520](#L520) | $file = ''; |
| [521](#L521) | if ( 'style1' == $style ) { |
| [522](#L522) | $file = get\_theme\_file\_path( 'lifeline-donation/donation-templates/donation-page.php' ); |
| [523](#L523) | } |
| [524](#L524) | if ( 'style2' == $style ) { |
| [525](#L525) | $file = get\_theme\_file\_path( 'lifeline-donation/donation-templates/donation-page-2.php' ); |
| [526](#L526) | } |
| [527](#L527) |  |
| [528](#L528) | ob\_start(); |
| [529](#L529) |  |
| [530](#L530) | if ( file\_exists( $file ) ) { |
| [531](#L531) | include $file; |
| [532](#L532) | return ob\_get\_clean(); |
| [533](#L533) | } |
| [534](#L534) | if ( 'style2' == $style ) { |
| [535](#L535) |  |
| [536](#L536) | include LIFELINE\_DONATION\_PATH . 'templates/donation-templates/donation-page-2.php'; |
| [537](#L537) | } else if ( 'style3' == $style ) { |
| [538](#L538) | include LIFELINE\_DONATION\_PATH . 'templates/donation-templates/donation-page-3.php'; |
| [539](#L539) | } else { |
| [540](#L540) | include LIFELINE\_DONATION\_PATH . 'templates/donation-templates/donation-page.php'; |
| [541](#L541) | } |
| [542](#L542) |  |
| [543](#L543) | return ob\_get\_clean(); |
| [544](#L544) | } |
| [545](#L545) |  |
| [546](#L546) | /\*\* |
| [547](#L547) | \* [new\_donation\_email\_template description] |
| [548](#L548) | \* |
| [549](#L549) | \* @param  [type] $template    [description]. |
| [550](#L550) | \* @param  [type] $order       [description]. |
| [551](#L551) | \* @param  [type] $customer\_id [description]. |
| [552](#L552) | \* |
| [553](#L553) | \* @return [type]              [description] |
| [554](#L554) | \*/ |
| [555](#L555) | public static function new\_donation\_email\_template( $template, $order, $customer\_id ) { |
| [556](#L556) | ob\_start(); |
| [557](#L557) | include LIFELINE\_DONATION\_PATH . 'templates/emails/customer-new-donation.php'; |
| [558](#L558) | return ob\_get\_clean(); |
| [559](#L559) | } |
| [560](#L560) | /\*\* |
| [561](#L561) | \* [new\_donation\_email\_template description] |
| [562](#L562) | \* |
| [563](#L563) | \* @param  [type] $template    [description]. |
| [564](#L564) | \* @param  [type] $order       [description]. |
| [565](#L565) | \* @param  [type] $customer\_id [description]. |
| [566](#L566) | \* |
| [567](#L567) | \* @return [type]              [description] |
| [568](#L568) | \*/ |
| [569](#L569) | public static function new\_donation\_admin\_email\_template( $template, $order, $customer\_id ) { |
| [570](#L570) |  |
| [571](#L571) | ob\_start(); |
| [572](#L572) | include LIFELINE\_DONATION\_PATH . 'templates/emails/owner-new-donation.php'; |
| [573](#L573) | return ob\_get\_clean(); |
| [574](#L574) | } |
| [575](#L575) |  |
| [576](#L576) | /\*\* |
| [577](#L577) | \* [update\_donation\_meta description] |
| [578](#L578) | \* |
| [579](#L579) | \* @param  [type] $data  [description]. |
| [580](#L580) | \* @param  [type] $order [description]. |
| [581](#L581) | \* |
| [582](#L582) | \* @return void        [description] |
| [583](#L583) | \*/ |
| [584](#L584) | public static function update\_donation\_meta( $data, $order ) { |
| [585](#L585) |  |
| [586](#L586) | $dropdown = array\_get( $data, 'post\_data.extras.dropdown' ); |
| [587](#L587) | if ( $dropdown ) { |
| [588](#L588) | update\_post\_meta( $order->ID, '\_donation\_extra\_dropdown', $dropdown ); |
| [589](#L589) | } |
| [590](#L590) | } |
| [591](#L591) |  |
| [592](#L592) | /\*\* |
| [593](#L593) | \* [admin\_enqueue description] |
| [594](#L594) | \* |
| [595](#L595) | \* @return void [description] |
| [596](#L596) | \*/ |
| [597](#L597) | public static function admin\_enqueue() { |
| [598](#L598) | global $post\_type; |
| [599](#L599) |  |
| [600](#L600) | if ( 'orders' === $post\_type ) { |
| [601](#L601) | wp\_enqueue\_script( 'lifeline-donation', LIFELINE\_DONATION\_URL . 'assets/js/admin.js', array( 'vuejs' ), '1.0.3', true ); |
| [602](#L602) | } |
| [603](#L603) | } |
| [604](#L604) |  |
| [605](#L605) | /\*\* |
| [606](#L606) | \* [admin\_order\_data description] |
| [607](#L607) | \* |
| [608](#L608) | \* @return void [description] |
| [609](#L609) | \*/ |
| [610](#L610) | public static function admin\_order\_data() { |
| [611](#L611) | $\_post = filter\_input\_array( INPUT\_POST, FILTER\_SANITIZE\_STRING ); |
| [612](#L612) | $id = absint( sanitize\_text\_field( array\_get( $\_post, 'id' ) ) ); |
| [613](#L613) |  |
| [614](#L614) | if ( $id ) { |
| [615](#L615) | $meta = get\_post\_meta( $id, '\_donation\_extra\_dropdown', true ); |
| [616](#L616) |  |
| [617](#L617) | wp\_send\_json\_success( $meta ); |
| [618](#L618) | } |
| [619](#L619) | wp\_send\_json\_success( '' ); |
| [620](#L620) | } |
| [621](#L621) |  |
| [622](#L622) |  |
| [623](#L623) | public static function preloader() { |
| [624](#L624) | ?> |
| [625](#L625) | <div class="donation-modal-wraper"></div> |
| [626](#L626) | <div class="donation-modal-preloader"><div class="my\_loader"></div></div> |
| [627](#L627) | <div class="donation-modal-box"></div> |
| [628](#L628) | <?php |
| [629](#L629) | } |
| [630](#L630) | } |
| [631](#L631) |  |
| [632](#L632) | Lifeline\_Donation::init(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/lifeline-donation/trunk/includes/class-lifeline-donation.php?rev=2575844&format=txt)
* [Original Format](/export/2575844/lifeline-donation/trunk/includes/class-lifeline-donation.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


