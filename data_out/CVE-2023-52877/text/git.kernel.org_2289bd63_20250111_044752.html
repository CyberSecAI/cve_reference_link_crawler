

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e5f53a68a596e04df3fde3099273435a30b6fdac)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e5f53a68a596e04df3fde3099273435a30b6fdac)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5f53a68a596e04df3fde3099273435a30b6fdac)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5f53a68a596e04df3fde3099273435a30b6fdac)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jimmy Hu <hhhuuu@google.com> | 2023-10-20 01:21:32 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-08 17:26:50 +0100 |
| commit | [e5f53a68a596e04df3fde3099273435a30b6fdac](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5f53a68a596e04df3fde3099273435a30b6fdac) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e5f53a68a596e04df3fde3099273435a30b6fdac)) | |
| tree | [2ee672d2b5923799ada76c33d4e78bf712c91758](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e5f53a68a596e04df3fde3099273435a30b6fdac) | |
| parent | [7c4855b22a3fecb4f28cadabe7b2bff55bf6ebef](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7c4855b22a3fecb4f28cadabe7b2bff55bf6ebef) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5f53a68a596e04df3fde3099273435a30b6fdac&id2=7c4855b22a3fecb4f28cadabe7b2bff55bf6ebef)) | |
| download | [linux-e5f53a68a596e04df3fde3099273435a30b6fdac.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e5f53a68a596e04df3fde3099273435a30b6fdac.tar.gz) | |

usb: typec: tcpm: Fix NULL pointer dereference in tcpm\_pd\_svdm()commit 4987daf86c152ff882d51572d154ad12e4ff3a4b upstream.
It is possible that typec\_register\_partner() returns ERR\_PTR on failure.
When port->partner is an error, a NULL pointer dereference may occur as
shown below.
[91222.095236][ T319] typec port0: failed to register partner (-17)
...
[91225.061491][ T319] Unable to handle kernel NULL pointer dereference
at virtual address 000000000000039f
[91225.274642][ T319] pc : tcpm\_pd\_data\_request+0x310/0x13fc
[91225.274646][ T319] lr : tcpm\_pd\_data\_request+0x298/0x13fc
[91225.308067][ T319] Call trace:
[91225.308070][ T319] tcpm\_pd\_data\_request+0x310/0x13fc
[91225.308073][ T319] tcpm\_pd\_rx\_handler+0x100/0x9e8
[91225.355900][ T319] kthread\_worker\_fn+0x178/0x58c
[91225.355902][ T319] kthread+0x150/0x200
[91225.355905][ T319] ret\_from\_fork+0x10/0x30
Add a check for port->partner to avoid dereferencing a NULL pointer.
Fixes: 5e1d4c49fbc8 ("usb: typec: tcpm: Determine common SVDM Version")
Cc: stable@vger.kernel.org
Signed-off-by: Jimmy Hu <hhhuuu@google.com>
Link: [https://lore.kernel.org/r/20231020012132.100960-1-hhhuuu@google.com](https://lore.kernel.org/r/20231020012132.100960-1-hhhuuu%40google.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5f53a68a596e04df3fde3099273435a30b6fdac)

| -rw-r--r-- | [drivers/usb/typec/tcpm/tcpm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/typec/tcpm/tcpm.c?id=e5f53a68a596e04df3fde3099273435a30b6fdac) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/drivers/usb/typec/tcpm/tcpm.c b/drivers/usb/typec/tcpm/tcpm.cindex 7833518c60388d..d917b133d2a504 100644--- a/[drivers/usb/typec/tcpm/tcpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/typec/tcpm/tcpm.c?id=7c4855b22a3fecb4f28cadabe7b2bff55bf6ebef)+++ b/[drivers/usb/typec/tcpm/tcpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/typec/tcpm/tcpm.c?id=e5f53a68a596e04df3fde3099273435a30b6fdac)@@ -1608,6 +1608,9 @@ static int tcpm\_pd\_svdm(struct tcpm\_port \*port, struct typec\_altmode \*adev, if (PD\_VDO\_VID(p[0]) != USB\_SID\_PD) break; + if (IS\_ERR\_OR\_NULL(port->partner))+ break;+ if (PD\_VDO\_SVDM\_VER(p[0]) < svdm\_version) { typec\_partner\_set\_svdm\_version(port->partner, PD\_VDO\_SVDM\_VER(p[0])); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:46:29 +0000

