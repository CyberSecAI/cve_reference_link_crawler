=== Content from github.com_1c9b8ffd_20250111_145826.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fcf2772fab0af5573da775e7437e6acdca424f26e%2Fmodules%2Fui_extensions.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fcf2772fab0af5573da775e7437e6acdca424f26e%2Fmodules%2Fui_extensions.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=AUTOMATIC1111%2Fstable-diffusion-webui)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AUTOMATIC1111](/AUTOMATIC1111)
/
**[stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui)**
Public

* [Notifications](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui) You must be signed in to change notification settings
* [Fork
  27.3k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)
* [Star
   146k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues
  2.3k](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests
  51](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects
  0](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

Additional navigation options

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

## Files

 cf2772f
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e/modules)
/
# ui\_extensions.py

Copy path Blame  Blame
## Latest commit

## History

[History](/AUTOMATIC1111/stable-diffusion-webui/commits/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py)672 lines (522 loc) · 27.8 KB cf2772f
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e/modules)
/
# ui\_extensions.py

Top
## File metadata and controls

* Code
* Blame

672 lines (522 loc) · 27.8 KB[Raw](https://github.com/AUTOMATIC1111/stable-diffusion-webui/raw/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672import jsonimport osimport threadingimport timefrom datetime import datetime, timezone
import git
import gradio as grimport htmlimport shutilimport errno
from modules import extensions, shared, paths, config\_states, errors, restartfrom modules.paths\_internal import config\_states\_dirfrom modules.call\_queue import wrap\_gradio\_gpu\_call
available\_extensions = {"extensions": []}STYLE\_PRIMARY = ' style="color: var(--primary-400)"'
def check\_access(): assert not shared.cmd\_opts.disable\_extension\_access, "extension access disabled because of command line flags"
def apply\_and\_restart(disable\_list, update\_list, disable\_all): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 update = json.loads(update\_list) assert type(update) == list, f"wrong update\_list data for apply\_and\_restart: {update\_list}"
 if update: save\_config\_state("Backup (pre-update)")
 update = set(update)
 for ext in extensions.extensions: if ext.name not in update: continue
 try: ext.fetch\_and\_reset\_hard() except Exception: errors.report(f"Error getting updates for {ext.name}", exc\_info=True)
 shared.opts.disabled\_extensions = disabled shared.opts.disable\_all\_extensions = disable\_all shared.opts.save(shared.config\_filename)
 if restart.is\_restartable(): restart.restart\_program() else: restart.stop\_program()
def save\_config\_state(name): current\_config\_state = config\_states.get\_config() if not name: name = "Config" current\_config\_state["name"] = name timestamp = datetime.now().strftime('%Y\_%m\_%d-%H\_%M\_%S') filename = os.path.join(config\_states\_dir, f"{timestamp}\_{name}.json") print(f"Saving backup of webui/extension state to {filename}.") with open(filename, "w", encoding="utf-8") as f: json.dump(current\_config\_state, f, indent=4, ensure\_ascii=False) config\_states.list\_config\_states() new\_value = next(iter(config\_states.all\_config\_states.keys()), "Current") new\_choices = ["Current"] + list(config\_states.all\_config\_states.keys()) return gr.Dropdown.update(value=new\_value, choices=new\_choices), f"<span>Saved current webui/extension state to \"{filename}\"</span>"
def restore\_config\_state(confirmed, config\_state\_name, restore\_type): if config\_state\_name == "Current": return "<span>Select a config to restore from.</span>" if not confirmed: return "<span>Cancelled.</span>"
 check\_access()
 config\_state = config\_states.all\_config\_states[config\_state\_name]
 print(f"\*\*\* Restoring webui state from backup: {restore\_type} \*\*\*")
 if restore\_type == "extensions" or restore\_type == "both": shared.opts.restore\_config\_state\_file = config\_state["filepath"] shared.opts.save(shared.config\_filename)
 if restore\_type == "webui" or restore\_type == "both": config\_states.restore\_webui\_config(config\_state)
 shared.state.request\_restart()
 return ""
def check\_updates(id\_task, disable\_list): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 exts = [ext for ext in extensions.extensions if ext.remote is not None and ext.name not in disabled] shared.state.job\_count = len(exts)
 for ext in exts: shared.state.textinfo = ext.name
 try: ext.check\_updates() except FileNotFoundError as e: if 'FETCH\_HEAD' not in str(e): raise except Exception: errors.report(f"Error checking updates for {ext.name}", exc\_info=True)
 shared.state.nextjob()
 return extension\_table(), ""
def make\_commit\_link(commit\_hash, remote, text=None): if text is None: text = commit\_hash[:8] if remote.startswith("https://github.com/"): if remote.endswith(".git"): remote = remote[:-4] href = remote + "/commit/" + commit\_hash return f'<a href="{href}" target="\_blank">{text}</a>' else: return text
def extension\_table(): code = f"""<!-- {time.time()} --> <table id="extensions"> <thead> <tr> <th> <input class="gr-check-radio gr-checkbox all\_extensions\_toggle" type="checkbox" {'checked="checked"' if all(ext.enabled for ext in extensions.extensions) else ''} onchange="toggle\_all\_extensions(event)" /> <abbr title="Use checkbox to enable the extension; it will be enabled or disabled when you click apply button">Extension</abbr> </th> <th>URL</th> <th>Branch</th> <th>Version</th> <th>Date</th> <th><abbr title="Use checkbox to mark the extension for update; it will be updated when you click apply button">Update</abbr></th> </tr> </thead> <tbody> """
 for ext in extensions.extensions: ext: extensions.Extension ext.read\_info\_from\_repo()
 remote = f"""<a href="{html.escape(ext.remote or '')}" target="\_blank">{html.escape("built-in" if ext.is\_builtin else ext.remote or '')}</a>"""
 if ext.can\_update: ext\_status = f"""<label><input class="gr-check-radio gr-checkbox" name="update\_{html.escape(ext.name)}" checked="checked" type="checkbox">{html.escape(ext.status)}</label>""" else: ext\_status = ext.status
 style = "" if shared.cmd\_opts.disable\_extra\_extensions and not ext.is\_builtin or shared.opts.disable\_all\_extensions == "extra" and not ext.is\_builtin or shared.cmd\_opts.disable\_all\_extensions or shared.opts.disable\_all\_extensions == "all": style = STYLE\_PRIMARY
 version\_link = ext.version if ext.commit\_hash and ext.remote: version\_link = make\_commit\_link(ext.commit\_hash, ext.remote, ext.version)
 code += f""" <tr> <td><label{style}><input class="gr-check-radio gr-checkbox extension\_toggle" name="enable\_{html.escape(ext.name)}" type="checkbox" {'checked="checked"' if ext.enabled else ''} onchange="toggle\_extension(event)" />{html.escape(ext.name)}</label></td> <td>{remote}</td> <td>{ext.branch}</td> <td>{version\_link}</td> <td>{datetime.fromtimestamp(ext.commit\_date) if ext.commit\_date else ""}</td> <td{' class="extension\_status"' if ext.remote is not None else ''}>{ext\_status}</td> </tr> """
 code += """ </tbody> </table> """
 return code
def update\_config\_states\_table(state\_name): if state\_name == "Current": config\_state = config\_states.get\_config() else: config\_state = config\_states.all\_config\_states[state\_name]
 config\_name = config\_state.get("name", "Config") created\_date = datetime.fromtimestamp(config\_state["created\_at"]).strftime('%Y-%m-%d %H:%M:%S') filepath = config\_state.get("filepath", "<unknown>")
 try: webui\_remote = config\_state["webui"]["remote"] or "" webui\_branch = config\_state["webui"]["branch"] webui\_commit\_hash = config\_state["webui"]["commit\_hash"] or "<unknown>" webui\_commit\_date = config\_state["webui"]["commit\_date"] if webui\_commit\_date: webui\_commit\_date = time.asctime(time.gmtime(webui\_commit\_date)) else: webui\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(webui\_remote)}" target="\_blank">{html.escape(webui\_remote or '')}</a>""" commit\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote) date\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote, webui\_commit\_date)
 current\_webui = config\_states.get\_webui\_config()
 style\_remote = "" style\_branch = "" style\_commit = "" if current\_webui["remote"] != webui\_remote: style\_remote = STYLE\_PRIMARY if current\_webui["branch"] != webui\_branch: style\_branch = STYLE\_PRIMARY if current\_webui["commit\_hash"] != webui\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>WebUI State</h2><table id="config\_state\_webui"> <thead> <tr> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody> <tr> <td> <label{style\_remote}>{remote}</label> </td> <td> <label{style\_branch}>{webui\_branch}</label> </td> <td> <label{style\_commit}>{commit\_link}</label> </td> <td> <label{style\_commit}>{date\_link}</label> </td> </tr> </tbody></table><h2>Extension State</h2><table id="config\_state\_extensions"> <thead> <tr> <th>Extension</th> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody>"""
 ext\_map = {ext.name: ext for ext in extensions.extensions}
 for ext\_name, ext\_conf in config\_state["extensions"].items(): ext\_remote = ext\_conf["remote"] or "" ext\_branch = ext\_conf["branch"] or "<unknown>" ext\_enabled = ext\_conf["enabled"] ext\_commit\_hash = ext\_conf["commit\_hash"] or "<unknown>" ext\_commit\_date = ext\_conf["commit\_date"] if ext\_commit\_date: ext\_commit\_date = time.asctime(time.gmtime(ext\_commit\_date)) else: ext\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(ext\_remote)}" target="\_blank">{html.escape(ext\_remote or '')}</a>""" commit\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote) date\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote, ext\_commit\_date)
 style\_enabled = "" style\_remote = "" style\_branch = "" style\_commit = "" if ext\_name in ext\_map: current\_ext = ext\_map[ext\_name] current\_ext.read\_info\_from\_repo() if current\_ext.enabled != ext\_enabled: style\_enabled = STYLE\_PRIMARY if current\_ext.remote != ext\_remote: style\_remote = STYLE\_PRIMARY if current\_ext.branch != ext\_branch: style\_branch = STYLE\_PRIMARY if current\_ext.commit\_hash != ext\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code += f""" <tr> <td><label{style\_enabled}><input class="gr-check-radio gr-checkbox" type="checkbox" disabled="true" {'checked="checked"' if ext\_enabled else ''}>{html.escape(ext\_name)}</label></td> <td><label{style\_remote}>{remote}</label></td> <td><label{style\_branch}>{ext\_branch}</label></td> <td><label{style\_commit}>{commit\_link}</label></td> <td><label{style\_commit}>{date\_link}</label></td> </tr>"""
 code += """ </tbody></table>"""
 except Exception as e: print(f"[ERROR]: Config states {filepath}, {e}") code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>This file is corrupted</h2>"""
 return code
def normalize\_git\_url(url): if url is None: return ""
 url = url.replace(".git", "") return url
def get\_extension\_dirname\_from\_url(url): \*parts, last\_part = url.split('/') return normalize\_git\_url(last\_part)
def install\_extension\_from\_url(dirname, url, branch\_name=None): check\_access()
 if isinstance(dirname, str): dirname = dirname.strip() if isinstance(url, str): url = url.strip()
 assert url, 'No URL specified'
 if dirname is None or dirname == "": dirname = get\_extension\_dirname\_from\_url(url)
 target\_dir = os.path.join(extensions.extensions\_dir, dirname) assert not os.path.exists(target\_dir), f'Extension directory already exists: {target\_dir}'
 normalized\_url = normalize\_git\_url(url) if any(x for x in extensions.extensions if normalize\_git\_url(x.remote) == normalized\_url): raise Exception(f'Extension with this URL is already installed: {url}')
 tmpdir = os.path.join(paths.data\_path, "tmp", dirname)
 try: shutil.rmtree(tmpdir, True) if not branch\_name: # if no branch is specified, use the default branch with git.Repo.clone\_from(url, tmpdir, filter=['blob:none']) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() else: with git.Repo.clone\_from(url, tmpdir, filter=['blob:none'], branch=branch\_name) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() try: os.rename(tmpdir, target\_dir) except OSError as err: if err.errno == errno.EXDEV: # Cross device link, typical in docker or when tmp/ and extensions/ are on different file systems # Since we can't use a rename, do the slower but more versitile shutil.move() shutil.move(tmpdir, target\_dir) else: # Something else, not enough free space, permissions, etc. rethrow it so that it gets handled. raise err
 import launch launch.run\_extension\_installer(target\_dir)
 extensions.list\_extensions() return [extension\_table(), html.escape(f"Installed into {target\_dir}. Use Installed tab to restart.")] finally: shutil.rmtree(tmpdir, True)
def install\_extension\_from\_index(url, hide\_tags, sort\_column, filter\_text): ext\_table, message = install\_extension\_from\_url(None, url)
 code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ext\_table, message, ''
def refresh\_available\_extensions(url, hide\_tags, sort\_column): global available\_extensions
 import urllib.request with urllib.request.urlopen(url) as response: text = response.read()
 available\_extensions = json.loads(text)
 code, tags = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column)
 return url, code, gr.CheckboxGroup.update(choices=tags), '', ''
def refresh\_available\_extensions\_for\_tags(hide\_tags, sort\_column, filter\_text): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
def search\_extensions(filter\_text, hide\_tags, sort\_column): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
sort\_ordering = [ # (reverse, order\_by\_function) (True, lambda x: x.get('added', 'z')), (False, lambda x: x.get('added', 'z')), (False, lambda x: x.get('name', 'z')), (True, lambda x: x.get('name', 'z')), (False, lambda x: 'z'), (True, lambda x: x.get('commit\_time', '')), (True, lambda x: x.get('created\_at', '')), (True, lambda x: x.get('stars', 0)),]
def get\_date(info: dict, key): try: return datetime.strptime(info.get(key), "%Y-%m-%dT%H:%M:%SZ").replace(tzinfo=timezone.utc).astimezone().strftime("%Y-%m-%d") except (ValueError, TypeError): return ''
def refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text=""): extlist = available\_extensions["extensions"] installed\_extensions = {extension.name for extension in extensions.extensions} installed\_extension\_urls = {normalize\_git\_url(extension.remote) for extension in extensions.extensions if extension.remote is not None}
 tags = available\_extensions.get("tags", {}) tags\_to\_hide = set(hide\_tags) hidden = 0
 code = f"""<!-- {time.time()} --> <table id="available\_extensions"> <thead> <tr> <th>Extension</th> <th>Description</th> <th>Action</th> </tr> </thead> <tbody> """
 sort\_reverse, sort\_function = sort\_ordering[sort\_column if 0 <= sort\_column < len(sort\_ordering) else 0]
 for ext in sorted(extlist, key=sort\_function, reverse=sort\_reverse): name = ext.get("name", "noname") stars = int(ext.get("stars", 0)) added = ext.get('added', 'unknown') update\_time = get\_date(ext, 'commit\_time') create\_time = get\_date(ext, 'created\_at') url = ext.get("url", None) description = ext.get("description", "") extension\_tags = ext.get("tags", [])
 if url is None: continue
 existing = get\_extension\_dirname\_from\_url(url) in installed\_extensions or normalize\_git\_url(url) in installed\_extension\_urls extension\_tags = extension\_tags + ["installed"] if existing else extension\_tags
 if any(x for x in extension\_tags if x in tags\_to\_hide): hidden += 1 continue
 if filter\_text and filter\_text.strip(): if filter\_text.lower() not in html.escape(name).lower() and filter\_text.lower() not in html.escape(description).lower(): hidden += 1 continue
 install\_code = f"""<button onclick="install\_extension\_from\_index(this, '{html.escape(url)}')" {"disabled=disabled" if existing else ""} class="lg secondary gradio-button custom-button">{"Install" if not existing else "Installed"}</button>"""
 tags\_text = ", ".join([f"<span class='extension-tag' title='{tags.get(x, '')}'>{x}</span>" for x in extension\_tags])
 code += f""" <tr> <td><a href="{html.escape(url)}" target="\_blank">{html.escape(name)}</a><br />{tags\_text}</td> <td>{html.escape(description)}<p class="info"> <span class="date\_added">Update: {html.escape(update\_time)} Added: {html.escape(added)} Created: {html.escape(create\_time)}</span><span class="star\_count">stars: <b>{stars}</b></a></p></td> <td>{install\_code}</td> </tr>
 """
 for tag in [x for x in extension\_tags if x not in tags]: tags[tag] = tag
 code += """ </tbody> </table> """
 if hidden > 0: code += f"<p>Extension hidden: {hidden}</p>"
 return code, list(tags)
def preload\_extensions\_git\_metadata(): for extension in extensions.extensions: extension.read\_info\_from\_repo()
def create\_ui(): import modules.ui
 config\_states.list\_config\_states()
 threading.Thread(target=preload\_extensions\_git\_metadata).start()
 with gr.Blocks(analytics\_enabled=False) as ui: with gr.Tabs(elem\_id="tabs\_extensions"): with gr.TabItem("Installed", id="installed"):
 with gr.Row(elem\_id="extensions\_installed\_top"): apply\_label = ("Apply and restart UI" if restart.is\_restartable() else "Apply and quit") apply = gr.Button(value=apply\_label, variant="primary") check = gr.Button(value="Check for updates") extensions\_disable\_all = gr.Radio(label="Disable all extensions", choices=["none", "extra", "all"], value=shared.opts.disable\_all\_extensions, elem\_id="extensions\_disable\_all") extensions\_disabled\_list = gr.Text(elem\_id="extensions\_disabled\_list", visible=False, container=False) extensions\_update\_list = gr.Text(elem\_id="extensions\_update\_list", visible=False, container=False)
 html = ""
 if shared.cmd\_opts.disable\_all\_extensions or shared.cmd\_opts.disable\_extra\_extensions or shared.opts.disable\_all\_extensions != "none": if shared.cmd\_opts.disable\_all\_extensions: msg = '"--disable-all-extensions" was used, remove it to load all extensions again' elif shared.opts.disable\_all\_extensions != "none": msg = '"Disable all extensions" was set, change it to "none" to load all extensions again' elif shared.cmd\_opts.disable\_extra\_extensions: msg = '"--disable-extra-extensions" was used, remove it to load all extensions again' html = f'<span style="color: var(--primary-400);">{msg}</span>'
 with gr.Row(): info = gr.HTML(html)
 with gr.Row(elem\_classes="progress-container"): extensions\_table = gr.HTML('Loading...', elem\_id="extensions\_installed\_html")
 ui.load(fn=extension\_table, inputs=[], outputs=[extensions\_table])
 apply.click( fn=apply\_and\_restart, \_js="extensions\_apply", inputs=[extensions\_disabled\_list, extensions\_update\_list, extensions\_disable\_all], outputs=[], )
 check.click( fn=wrap\_gradio\_gpu\_call(check\_updates, extra\_outputs=[gr.update()]), \_js="extensions\_check", inputs=[info, extensions\_disabled\_list], outputs=[extensions\_table, info], )
 with gr.TabItem("Available", id="available"): with gr.Row(): refresh\_available\_extensions\_button = gr.Button(value="Load from:", variant="primary") extensions\_index\_url = os.environ.get('WEBUI\_EXTENSIONS\_INDEX', "https://raw.githubusercontent.com/AUTOMATIC1111/stable-diffusion-webui-extensions/master/index.json") available\_extensions\_index = gr.Text(value=extensions\_index\_url, label="Extension index URL", container=False) extension\_to\_install = gr.Text(elem\_id="extension\_to\_install", visible=False) install\_extension\_button = gr.Button(elem\_id="install\_extension\_button", visible=False)
 with gr.Row(): hide\_tags = gr.CheckboxGroup(value=["ads", "localization", "installed"], label="Hide extensions with tags", choices=["script", "ads", "localization", "installed"]) sort\_column = gr.Radio(value="newest first", label="Order", choices=["newest first", "oldest first", "a-z", "z-a", "internal order",'update time', 'create time', "stars"], type="index")
 with gr.Row(): search\_extensions\_text = gr.Text(label="Search", container=False)
 install\_result = gr.HTML() available\_extensions\_table = gr.HTML()
 refresh\_available\_extensions\_button.click( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions, extra\_outputs=[gr.update(), gr.update(), gr.update(), gr.update()]), inputs=[available\_extensions\_index, hide\_tags, sort\_column], outputs=[available\_extensions\_index, available\_extensions\_table, hide\_tags, search\_extensions\_text, install\_result], )
 install\_extension\_button.click( fn=modules.ui.wrap\_gradio\_call(install\_extension\_from\_index, extra\_outputs=[gr.update(), gr.update()]), inputs=[extension\_to\_install, hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, extensions\_table, install\_result], )
 search\_extensions\_text.change( fn=modules.ui.wrap\_gradio\_call(search\_extensions, extra\_outputs=[gr.update()]), inputs=[search\_extensions\_text, hide\_tags, sort\_column], outputs=[available\_extensions\_table, install\_result], )
 hide\_tags.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 sort\_column.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 with gr.TabItem("Install from URL", id="install\_from\_url"): install\_url = gr.Text(label="URL for extension's git repository") install\_branch = gr.Text(label="Specific branch name", placeholder="Leave empty for default main branch") install\_dirname = gr.Text(label="Local directory name", placeholder="Leave empty for auto") install\_button = gr.Button(value="Install", variant="primary") install\_result = gr.HTML(elem\_id="extension\_install\_result")
 install\_button.click( fn=modules.ui.wrap\_gradio\_call(lambda \*args: [gr.update(), \*install\_extension\_from\_url(\*args)], extra\_outputs=[gr.update(), gr.update()]), inputs=[install\_dirname, install\_url, install\_branch], outputs=[install\_url, extensions\_table, install\_result], )
 with gr.TabItem("Backup/Restore"): with gr.Row(elem\_id="extensions\_backup\_top\_row"): config\_states\_list = gr.Dropdown(label="Saved Configs", elem\_id="extension\_backup\_saved\_configs", value="Current", choices=["Current"] + list(config\_states.all\_config\_states.keys())) modules.ui.create\_refresh\_button(config\_states\_list, config\_states.list\_config\_states, lambda: {"choices": ["Current"] + list(config\_states.all\_config\_states.keys())}, "refresh\_config\_states") config\_restore\_type = gr.Radio(label="State to restore", choices=["extensions", "webui", "both"], value="extensions", elem\_id="extension\_backup\_restore\_type") config\_restore\_button = gr.Button(value="Restore Selected Config", variant="primary", elem\_id="extension\_backup\_restore") with gr.Row(elem\_id="extensions\_backup\_top\_row2"): config\_save\_name = gr.Textbox("", placeholder="Config Name", show\_label=False) config\_save\_button = gr.Button(value="Save Current Config")
 config\_states\_info = gr.HTML("") config\_states\_table = gr.HTML("Loading...") ui.load(fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table])
 config\_save\_button.click(fn=save\_config\_state, inputs=[config\_save\_name], outputs=[config\_states\_list, config\_states\_info])
 dummy\_component = gr.Label(visible=False) config\_restore\_button.click(fn=restore\_config\_state, \_js="config\_state\_confirm\_restore", inputs=[dummy\_component, config\_states\_list, config\_restore\_type], outputs=[config\_states\_info])
 config\_states\_list.change( fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table], )
 return ui

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_194ebf76_20250111_145827.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fcf2772fab0af5573da775e7437e6acdca424f26e%2Fmodules%2Fui_extensions.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fcf2772fab0af5573da775e7437e6acdca424f26e%2Fmodules%2Fui_extensions.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=AUTOMATIC1111%2Fstable-diffusion-webui)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AUTOMATIC1111](/AUTOMATIC1111)
/
**[stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui)**
Public

* [Notifications](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui) You must be signed in to change notification settings
* [Fork
  27.3k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)
* [Star
   146k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues
  2.3k](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests
  51](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects
  0](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

Additional navigation options

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

## Files

 cf2772f
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e/modules)
/
# ui\_extensions.py

Copy path Blame  Blame
## Latest commit

## History

[History](/AUTOMATIC1111/stable-diffusion-webui/commits/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py)672 lines (522 loc) · 27.8 KB cf2772f
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e/modules)
/
# ui\_extensions.py

Top
## File metadata and controls

* Code
* Blame

672 lines (522 loc) · 27.8 KB[Raw](https://github.com/AUTOMATIC1111/stable-diffusion-webui/raw/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672import jsonimport osimport threadingimport timefrom datetime import datetime, timezone
import git
import gradio as grimport htmlimport shutilimport errno
from modules import extensions, shared, paths, config\_states, errors, restartfrom modules.paths\_internal import config\_states\_dirfrom modules.call\_queue import wrap\_gradio\_gpu\_call
available\_extensions = {"extensions": []}STYLE\_PRIMARY = ' style="color: var(--primary-400)"'
def check\_access(): assert not shared.cmd\_opts.disable\_extension\_access, "extension access disabled because of command line flags"
def apply\_and\_restart(disable\_list, update\_list, disable\_all): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 update = json.loads(update\_list) assert type(update) == list, f"wrong update\_list data for apply\_and\_restart: {update\_list}"
 if update: save\_config\_state("Backup (pre-update)")
 update = set(update)
 for ext in extensions.extensions: if ext.name not in update: continue
 try: ext.fetch\_and\_reset\_hard() except Exception: errors.report(f"Error getting updates for {ext.name}", exc\_info=True)
 shared.opts.disabled\_extensions = disabled shared.opts.disable\_all\_extensions = disable\_all shared.opts.save(shared.config\_filename)
 if restart.is\_restartable(): restart.restart\_program() else: restart.stop\_program()
def save\_config\_state(name): current\_config\_state = config\_states.get\_config() if not name: name = "Config" current\_config\_state["name"] = name timestamp = datetime.now().strftime('%Y\_%m\_%d-%H\_%M\_%S') filename = os.path.join(config\_states\_dir, f"{timestamp}\_{name}.json") print(f"Saving backup of webui/extension state to {filename}.") with open(filename, "w", encoding="utf-8") as f: json.dump(current\_config\_state, f, indent=4, ensure\_ascii=False) config\_states.list\_config\_states() new\_value = next(iter(config\_states.all\_config\_states.keys()), "Current") new\_choices = ["Current"] + list(config\_states.all\_config\_states.keys()) return gr.Dropdown.update(value=new\_value, choices=new\_choices), f"<span>Saved current webui/extension state to \"{filename}\"</span>"
def restore\_config\_state(confirmed, config\_state\_name, restore\_type): if config\_state\_name == "Current": return "<span>Select a config to restore from.</span>" if not confirmed: return "<span>Cancelled.</span>"
 check\_access()
 config\_state = config\_states.all\_config\_states[config\_state\_name]
 print(f"\*\*\* Restoring webui state from backup: {restore\_type} \*\*\*")
 if restore\_type == "extensions" or restore\_type == "both": shared.opts.restore\_config\_state\_file = config\_state["filepath"] shared.opts.save(shared.config\_filename)
 if restore\_type == "webui" or restore\_type == "both": config\_states.restore\_webui\_config(config\_state)
 shared.state.request\_restart()
 return ""
def check\_updates(id\_task, disable\_list): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 exts = [ext for ext in extensions.extensions if ext.remote is not None and ext.name not in disabled] shared.state.job\_count = len(exts)
 for ext in exts: shared.state.textinfo = ext.name
 try: ext.check\_updates() except FileNotFoundError as e: if 'FETCH\_HEAD' not in str(e): raise except Exception: errors.report(f"Error checking updates for {ext.name}", exc\_info=True)
 shared.state.nextjob()
 return extension\_table(), ""
def make\_commit\_link(commit\_hash, remote, text=None): if text is None: text = commit\_hash[:8] if remote.startswith("https://github.com/"): if remote.endswith(".git"): remote = remote[:-4] href = remote + "/commit/" + commit\_hash return f'<a href="{href}" target="\_blank">{text}</a>' else: return text
def extension\_table(): code = f"""<!-- {time.time()} --> <table id="extensions"> <thead> <tr> <th> <input class="gr-check-radio gr-checkbox all\_extensions\_toggle" type="checkbox" {'checked="checked"' if all(ext.enabled for ext in extensions.extensions) else ''} onchange="toggle\_all\_extensions(event)" /> <abbr title="Use checkbox to enable the extension; it will be enabled or disabled when you click apply button">Extension</abbr> </th> <th>URL</th> <th>Branch</th> <th>Version</th> <th>Date</th> <th><abbr title="Use checkbox to mark the extension for update; it will be updated when you click apply button">Update</abbr></th> </tr> </thead> <tbody> """
 for ext in extensions.extensions: ext: extensions.Extension ext.read\_info\_from\_repo()
 remote = f"""<a href="{html.escape(ext.remote or '')}" target="\_blank">{html.escape("built-in" if ext.is\_builtin else ext.remote or '')}</a>"""
 if ext.can\_update: ext\_status = f"""<label><input class="gr-check-radio gr-checkbox" name="update\_{html.escape(ext.name)}" checked="checked" type="checkbox">{html.escape(ext.status)}</label>""" else: ext\_status = ext.status
 style = "" if shared.cmd\_opts.disable\_extra\_extensions and not ext.is\_builtin or shared.opts.disable\_all\_extensions == "extra" and not ext.is\_builtin or shared.cmd\_opts.disable\_all\_extensions or shared.opts.disable\_all\_extensions == "all": style = STYLE\_PRIMARY
 version\_link = ext.version if ext.commit\_hash and ext.remote: version\_link = make\_commit\_link(ext.commit\_hash, ext.remote, ext.version)
 code += f""" <tr> <td><label{style}><input class="gr-check-radio gr-checkbox extension\_toggle" name="enable\_{html.escape(ext.name)}" type="checkbox" {'checked="checked"' if ext.enabled else ''} onchange="toggle\_extension(event)" />{html.escape(ext.name)}</label></td> <td>{remote}</td> <td>{ext.branch}</td> <td>{version\_link}</td> <td>{datetime.fromtimestamp(ext.commit\_date) if ext.commit\_date else ""}</td> <td{' class="extension\_status"' if ext.remote is not None else ''}>{ext\_status}</td> </tr> """
 code += """ </tbody> </table> """
 return code
def update\_config\_states\_table(state\_name): if state\_name == "Current": config\_state = config\_states.get\_config() else: config\_state = config\_states.all\_config\_states[state\_name]
 config\_name = config\_state.get("name", "Config") created\_date = datetime.fromtimestamp(config\_state["created\_at"]).strftime('%Y-%m-%d %H:%M:%S') filepath = config\_state.get("filepath", "<unknown>")
 try: webui\_remote = config\_state["webui"]["remote"] or "" webui\_branch = config\_state["webui"]["branch"] webui\_commit\_hash = config\_state["webui"]["commit\_hash"] or "<unknown>" webui\_commit\_date = config\_state["webui"]["commit\_date"] if webui\_commit\_date: webui\_commit\_date = time.asctime(time.gmtime(webui\_commit\_date)) else: webui\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(webui\_remote)}" target="\_blank">{html.escape(webui\_remote or '')}</a>""" commit\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote) date\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote, webui\_commit\_date)
 current\_webui = config\_states.get\_webui\_config()
 style\_remote = "" style\_branch = "" style\_commit = "" if current\_webui["remote"] != webui\_remote: style\_remote = STYLE\_PRIMARY if current\_webui["branch"] != webui\_branch: style\_branch = STYLE\_PRIMARY if current\_webui["commit\_hash"] != webui\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>WebUI State</h2><table id="config\_state\_webui"> <thead> <tr> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody> <tr> <td> <label{style\_remote}>{remote}</label> </td> <td> <label{style\_branch}>{webui\_branch}</label> </td> <td> <label{style\_commit}>{commit\_link}</label> </td> <td> <label{style\_commit}>{date\_link}</label> </td> </tr> </tbody></table><h2>Extension State</h2><table id="config\_state\_extensions"> <thead> <tr> <th>Extension</th> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody>"""
 ext\_map = {ext.name: ext for ext in extensions.extensions}
 for ext\_name, ext\_conf in config\_state["extensions"].items(): ext\_remote = ext\_conf["remote"] or "" ext\_branch = ext\_conf["branch"] or "<unknown>" ext\_enabled = ext\_conf["enabled"] ext\_commit\_hash = ext\_conf["commit\_hash"] or "<unknown>" ext\_commit\_date = ext\_conf["commit\_date"] if ext\_commit\_date: ext\_commit\_date = time.asctime(time.gmtime(ext\_commit\_date)) else: ext\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(ext\_remote)}" target="\_blank">{html.escape(ext\_remote or '')}</a>""" commit\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote) date\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote, ext\_commit\_date)
 style\_enabled = "" style\_remote = "" style\_branch = "" style\_commit = "" if ext\_name in ext\_map: current\_ext = ext\_map[ext\_name] current\_ext.read\_info\_from\_repo() if current\_ext.enabled != ext\_enabled: style\_enabled = STYLE\_PRIMARY if current\_ext.remote != ext\_remote: style\_remote = STYLE\_PRIMARY if current\_ext.branch != ext\_branch: style\_branch = STYLE\_PRIMARY if current\_ext.commit\_hash != ext\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code += f""" <tr> <td><label{style\_enabled}><input class="gr-check-radio gr-checkbox" type="checkbox" disabled="true" {'checked="checked"' if ext\_enabled else ''}>{html.escape(ext\_name)}</label></td> <td><label{style\_remote}>{remote}</label></td> <td><label{style\_branch}>{ext\_branch}</label></td> <td><label{style\_commit}>{commit\_link}</label></td> <td><label{style\_commit}>{date\_link}</label></td> </tr>"""
 code += """ </tbody></table>"""
 except Exception as e: print(f"[ERROR]: Config states {filepath}, {e}") code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>This file is corrupted</h2>"""
 return code
def normalize\_git\_url(url): if url is None: return ""
 url = url.replace(".git", "") return url
def get\_extension\_dirname\_from\_url(url): \*parts, last\_part = url.split('/') return normalize\_git\_url(last\_part)
def install\_extension\_from\_url(dirname, url, branch\_name=None): check\_access()
 if isinstance(dirname, str): dirname = dirname.strip() if isinstance(url, str): url = url.strip()
 assert url, 'No URL specified'
 if dirname is None or dirname == "": dirname = get\_extension\_dirname\_from\_url(url)
 target\_dir = os.path.join(extensions.extensions\_dir, dirname) assert not os.path.exists(target\_dir), f'Extension directory already exists: {target\_dir}'
 normalized\_url = normalize\_git\_url(url) if any(x for x in extensions.extensions if normalize\_git\_url(x.remote) == normalized\_url): raise Exception(f'Extension with this URL is already installed: {url}')
 tmpdir = os.path.join(paths.data\_path, "tmp", dirname)
 try: shutil.rmtree(tmpdir, True) if not branch\_name: # if no branch is specified, use the default branch with git.Repo.clone\_from(url, tmpdir, filter=['blob:none']) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() else: with git.Repo.clone\_from(url, tmpdir, filter=['blob:none'], branch=branch\_name) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() try: os.rename(tmpdir, target\_dir) except OSError as err: if err.errno == errno.EXDEV: # Cross device link, typical in docker or when tmp/ and extensions/ are on different file systems # Since we can't use a rename, do the slower but more versitile shutil.move() shutil.move(tmpdir, target\_dir) else: # Something else, not enough free space, permissions, etc. rethrow it so that it gets handled. raise err
 import launch launch.run\_extension\_installer(target\_dir)
 extensions.list\_extensions() return [extension\_table(), html.escape(f"Installed into {target\_dir}. Use Installed tab to restart.")] finally: shutil.rmtree(tmpdir, True)
def install\_extension\_from\_index(url, hide\_tags, sort\_column, filter\_text): ext\_table, message = install\_extension\_from\_url(None, url)
 code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ext\_table, message, ''
def refresh\_available\_extensions(url, hide\_tags, sort\_column): global available\_extensions
 import urllib.request with urllib.request.urlopen(url) as response: text = response.read()
 available\_extensions = json.loads(text)
 code, tags = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column)
 return url, code, gr.CheckboxGroup.update(choices=tags), '', ''
def refresh\_available\_extensions\_for\_tags(hide\_tags, sort\_column, filter\_text): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
def search\_extensions(filter\_text, hide\_tags, sort\_column): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
sort\_ordering = [ # (reverse, order\_by\_function) (True, lambda x: x.get('added', 'z')), (False, lambda x: x.get('added', 'z')), (False, lambda x: x.get('name', 'z')), (True, lambda x: x.get('name', 'z')), (False, lambda x: 'z'), (True, lambda x: x.get('commit\_time', '')), (True, lambda x: x.get('created\_at', '')), (True, lambda x: x.get('stars', 0)),]
def get\_date(info: dict, key): try: return datetime.strptime(info.get(key), "%Y-%m-%dT%H:%M:%SZ").replace(tzinfo=timezone.utc).astimezone().strftime("%Y-%m-%d") except (ValueError, TypeError): return ''
def refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text=""): extlist = available\_extensions["extensions"] installed\_extensions = {extension.name for extension in extensions.extensions} installed\_extension\_urls = {normalize\_git\_url(extension.remote) for extension in extensions.extensions if extension.remote is not None}
 tags = available\_extensions.get("tags", {}) tags\_to\_hide = set(hide\_tags) hidden = 0
 code = f"""<!-- {time.time()} --> <table id="available\_extensions"> <thead> <tr> <th>Extension</th> <th>Description</th> <th>Action</th> </tr> </thead> <tbody> """
 sort\_reverse, sort\_function = sort\_ordering[sort\_column if 0 <= sort\_column < len(sort\_ordering) else 0]
 for ext in sorted(extlist, key=sort\_function, reverse=sort\_reverse): name = ext.get("name", "noname") stars = int(ext.get("stars", 0)) added = ext.get('added', 'unknown') update\_time = get\_date(ext, 'commit\_time') create\_time = get\_date(ext, 'created\_at') url = ext.get("url", None) description = ext.get("description", "") extension\_tags = ext.get("tags", [])
 if url is None: continue
 existing = get\_extension\_dirname\_from\_url(url) in installed\_extensions or normalize\_git\_url(url) in installed\_extension\_urls extension\_tags = extension\_tags + ["installed"] if existing else extension\_tags
 if any(x for x in extension\_tags if x in tags\_to\_hide): hidden += 1 continue
 if filter\_text and filter\_text.strip(): if filter\_text.lower() not in html.escape(name).lower() and filter\_text.lower() not in html.escape(description).lower(): hidden += 1 continue
 install\_code = f"""<button onclick="install\_extension\_from\_index(this, '{html.escape(url)}')" {"disabled=disabled" if existing else ""} class="lg secondary gradio-button custom-button">{"Install" if not existing else "Installed"}</button>"""
 tags\_text = ", ".join([f"<span class='extension-tag' title='{tags.get(x, '')}'>{x}</span>" for x in extension\_tags])
 code += f""" <tr> <td><a href="{html.escape(url)}" target="\_blank">{html.escape(name)}</a><br />{tags\_text}</td> <td>{html.escape(description)}<p class="info"> <span class="date\_added">Update: {html.escape(update\_time)} Added: {html.escape(added)} Created: {html.escape(create\_time)}</span><span class="star\_count">stars: <b>{stars}</b></a></p></td> <td>{install\_code}</td> </tr>
 """
 for tag in [x for x in extension\_tags if x not in tags]: tags[tag] = tag
 code += """ </tbody> </table> """
 if hidden > 0: code += f"<p>Extension hidden: {hidden}</p>"
 return code, list(tags)
def preload\_extensions\_git\_metadata(): for extension in extensions.extensions: extension.read\_info\_from\_repo()
def create\_ui(): import modules.ui
 config\_states.list\_config\_states()
 threading.Thread(target=preload\_extensions\_git\_metadata).start()
 with gr.Blocks(analytics\_enabled=False) as ui: with gr.Tabs(elem\_id="tabs\_extensions"): with gr.TabItem("Installed", id="installed"):
 with gr.Row(elem\_id="extensions\_installed\_top"): apply\_label = ("Apply and restart UI" if restart.is\_restartable() else "Apply and quit") apply = gr.Button(value=apply\_label, variant="primary") check = gr.Button(value="Check for updates") extensions\_disable\_all = gr.Radio(label="Disable all extensions", choices=["none", "extra", "all"], value=shared.opts.disable\_all\_extensions, elem\_id="extensions\_disable\_all") extensions\_disabled\_list = gr.Text(elem\_id="extensions\_disabled\_list", visible=False, container=False) extensions\_update\_list = gr.Text(elem\_id="extensions\_update\_list", visible=False, container=False)
 html = ""
 if shared.cmd\_opts.disable\_all\_extensions or shared.cmd\_opts.disable\_extra\_extensions or shared.opts.disable\_all\_extensions != "none": if shared.cmd\_opts.disable\_all\_extensions: msg = '"--disable-all-extensions" was used, remove it to load all extensions again' elif shared.opts.disable\_all\_extensions != "none": msg = '"Disable all extensions" was set, change it to "none" to load all extensions again' elif shared.cmd\_opts.disable\_extra\_extensions: msg = '"--disable-extra-extensions" was used, remove it to load all extensions again' html = f'<span style="color: var(--primary-400);">{msg}</span>'
 with gr.Row(): info = gr.HTML(html)
 with gr.Row(elem\_classes="progress-container"): extensions\_table = gr.HTML('Loading...', elem\_id="extensions\_installed\_html")
 ui.load(fn=extension\_table, inputs=[], outputs=[extensions\_table])
 apply.click( fn=apply\_and\_restart, \_js="extensions\_apply", inputs=[extensions\_disabled\_list, extensions\_update\_list, extensions\_disable\_all], outputs=[], )
 check.click( fn=wrap\_gradio\_gpu\_call(check\_updates, extra\_outputs=[gr.update()]), \_js="extensions\_check", inputs=[info, extensions\_disabled\_list], outputs=[extensions\_table, info], )
 with gr.TabItem("Available", id="available"): with gr.Row(): refresh\_available\_extensions\_button = gr.Button(value="Load from:", variant="primary") extensions\_index\_url = os.environ.get('WEBUI\_EXTENSIONS\_INDEX', "https://raw.githubusercontent.com/AUTOMATIC1111/stable-diffusion-webui-extensions/master/index.json") available\_extensions\_index = gr.Text(value=extensions\_index\_url, label="Extension index URL", container=False) extension\_to\_install = gr.Text(elem\_id="extension\_to\_install", visible=False) install\_extension\_button = gr.Button(elem\_id="install\_extension\_button", visible=False)
 with gr.Row(): hide\_tags = gr.CheckboxGroup(value=["ads", "localization", "installed"], label="Hide extensions with tags", choices=["script", "ads", "localization", "installed"]) sort\_column = gr.Radio(value="newest first", label="Order", choices=["newest first", "oldest first", "a-z", "z-a", "internal order",'update time', 'create time', "stars"], type="index")
 with gr.Row(): search\_extensions\_text = gr.Text(label="Search", container=False)
 install\_result = gr.HTML() available\_extensions\_table = gr.HTML()
 refresh\_available\_extensions\_button.click( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions, extra\_outputs=[gr.update(), gr.update(), gr.update(), gr.update()]), inputs=[available\_extensions\_index, hide\_tags, sort\_column], outputs=[available\_extensions\_index, available\_extensions\_table, hide\_tags, search\_extensions\_text, install\_result], )
 install\_extension\_button.click( fn=modules.ui.wrap\_gradio\_call(install\_extension\_from\_index, extra\_outputs=[gr.update(), gr.update()]), inputs=[extension\_to\_install, hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, extensions\_table, install\_result], )
 search\_extensions\_text.change( fn=modules.ui.wrap\_gradio\_call(search\_extensions, extra\_outputs=[gr.update()]), inputs=[search\_extensions\_text, hide\_tags, sort\_column], outputs=[available\_extensions\_table, install\_result], )
 hide\_tags.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 sort\_column.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 with gr.TabItem("Install from URL", id="install\_from\_url"): install\_url = gr.Text(label="URL for extension's git repository") install\_branch = gr.Text(label="Specific branch name", placeholder="Leave empty for default main branch") install\_dirname = gr.Text(label="Local directory name", placeholder="Leave empty for auto") install\_button = gr.Button(value="Install", variant="primary") install\_result = gr.HTML(elem\_id="extension\_install\_result")
 install\_button.click( fn=modules.ui.wrap\_gradio\_call(lambda \*args: [gr.update(), \*install\_extension\_from\_url(\*args)], extra\_outputs=[gr.update(), gr.update()]), inputs=[install\_dirname, install\_url, install\_branch], outputs=[install\_url, extensions\_table, install\_result], )
 with gr.TabItem("Backup/Restore"): with gr.Row(elem\_id="extensions\_backup\_top\_row"): config\_states\_list = gr.Dropdown(label="Saved Configs", elem\_id="extension\_backup\_saved\_configs", value="Current", choices=["Current"] + list(config\_states.all\_config\_states.keys())) modules.ui.create\_refresh\_button(config\_states\_list, config\_states.list\_config\_states, lambda: {"choices": ["Current"] + list(config\_states.all\_config\_states.keys())}, "refresh\_config\_states") config\_restore\_type = gr.Radio(label="State to restore", choices=["extensions", "webui", "both"], value="extensions", elem\_id="extension\_backup\_restore\_type") config\_restore\_button = gr.Button(value="Restore Selected Config", variant="primary", elem\_id="extension\_backup\_restore") with gr.Row(elem\_id="extensions\_backup\_top\_row2"): config\_save\_name = gr.Textbox("", placeholder="Config Name", show\_label=False) config\_save\_button = gr.Button(value="Save Current Config")
 config\_states\_info = gr.HTML("") config\_states\_table = gr.HTML("Loading...") ui.load(fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table])
 config\_save\_button.click(fn=save\_config\_state, inputs=[config\_save\_name], outputs=[config\_states\_list, config\_states\_info])
 dummy\_component = gr.Label(visible=False) config\_restore\_button.click(fn=restore\_config\_state, \_js="config\_state\_confirm\_restore", inputs=[dummy\_component, config\_states\_list, config\_restore\_type], outputs=[config\_states\_info])
 config\_states\_list.change( fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table], )
 return ui

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a1b8ba27_20250111_145833.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fcommit%2Fd9708c92b444894bce8070e4dcfaa093f8eb8d43)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fcommit%2Fd9708c92b444894bce8070e4dcfaa093f8eb8d43)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=AUTOMATIC1111%2Fstable-diffusion-webui)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AUTOMATIC1111](/AUTOMATIC1111)
/
**[stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui)**
Public

* [Notifications](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui) You must be signed in to change notification settings
* [Fork
  27.3k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)
* [Star
   146k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues
  2.3k](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests
  51](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects
  0](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

Additional navigation options

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

## Commit

[Permalink](/AUTOMATIC1111/stable-diffusion-webui/commit/d9708c92b444894bce8070e4dcfaa093f8eb8d43)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix limited file write (thanks, Sylwia)

[Browse files](/AUTOMATIC1111/stable-diffusion-webui/tree/d9708c92b444894bce8070e4dcfaa093f8eb8d43)
Browse the repository at this point in the history

* Loading branch information

[![@AUTOMATIC1111](https://avatars.githubusercontent.com/u/20920490?s=40&v=4)](/AUTOMATIC1111)

[AUTOMATIC1111](/AUTOMATIC1111/stable-diffusion-webui/commits?author=AUTOMATIC1111 "View all commits by AUTOMATIC1111")
committed
Apr 8, 2024

1 parent
[e164031](/AUTOMATIC1111/stable-diffusion-webui/commit/e1640314df34b4cc8ed0422ab04a2886a3d9beb3)

commit d9708c9

Showing
**1 changed file**
with
**3 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

5 changes: 3 additions & 2 deletions

5
[modules/ui\_extensions.py](#diff-d79e09395f50cb04df09d0a7155e162a652f504549d263db7360a976bf757850 "modules/ui_extensions.py")

Show comments

[View file](/AUTOMATIC1111/stable-diffusion-webui/blob/d9708c92b444894bce8070e4dcfaa093f8eb8d43/modules/ui_extensions.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -58,8 +58,9 @@ def apply\_and\_restart(disable\_list, update\_list, disable\_all): |
|  |  |  |
|  |  | def save\_config\_state(name): |
|  |  | current\_config\_state = config\_states.get\_config() |
|  |  | if not name: |
|  |  | name = "Config" |
|  |  |  |
|  |  | name = os.path.basename(name or "Config") |
|  |  |  |
|  |  | current\_config\_state["name"] = name |
|  |  | timestamp = datetime.now().strftime('%Y\_%m\_%d-%H\_%M\_%S') |
|  |  | filename = os.path.join(config\_states\_dir, f"{timestamp}\_{name}.json") |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d9708c9`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fcommit%2Fd9708c92b444894bce8070e4dcfaa093f8eb8d43) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_07015f2c_20250111_145830.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fcf2772fab0af5573da775e7437e6acdca424f26e%2Fmodules%2Fui_extensions.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fcf2772fab0af5573da775e7437e6acdca424f26e%2Fmodules%2Fui_extensions.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=AUTOMATIC1111%2Fstable-diffusion-webui)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AUTOMATIC1111](/AUTOMATIC1111)
/
**[stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui)**
Public

* [Notifications](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui) You must be signed in to change notification settings
* [Fork
  27.3k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)
* [Star
   146k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues
  2.3k](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests
  51](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects
  0](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

Additional navigation options

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

## Files

 cf2772f
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e/modules)
/
# ui\_extensions.py

Copy path Blame  Blame
## Latest commit

## History

[History](/AUTOMATIC1111/stable-diffusion-webui/commits/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py)672 lines (522 loc) · 27.8 KB cf2772f
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e/modules)
/
# ui\_extensions.py

Top
## File metadata and controls

* Code
* Blame

672 lines (522 loc) · 27.8 KB[Raw](https://github.com/AUTOMATIC1111/stable-diffusion-webui/raw/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672import jsonimport osimport threadingimport timefrom datetime import datetime, timezone
import git
import gradio as grimport htmlimport shutilimport errno
from modules import extensions, shared, paths, config\_states, errors, restartfrom modules.paths\_internal import config\_states\_dirfrom modules.call\_queue import wrap\_gradio\_gpu\_call
available\_extensions = {"extensions": []}STYLE\_PRIMARY = ' style="color: var(--primary-400)"'
def check\_access(): assert not shared.cmd\_opts.disable\_extension\_access, "extension access disabled because of command line flags"
def apply\_and\_restart(disable\_list, update\_list, disable\_all): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 update = json.loads(update\_list) assert type(update) == list, f"wrong update\_list data for apply\_and\_restart: {update\_list}"
 if update: save\_config\_state("Backup (pre-update)")
 update = set(update)
 for ext in extensions.extensions: if ext.name not in update: continue
 try: ext.fetch\_and\_reset\_hard() except Exception: errors.report(f"Error getting updates for {ext.name}", exc\_info=True)
 shared.opts.disabled\_extensions = disabled shared.opts.disable\_all\_extensions = disable\_all shared.opts.save(shared.config\_filename)
 if restart.is\_restartable(): restart.restart\_program() else: restart.stop\_program()
def save\_config\_state(name): current\_config\_state = config\_states.get\_config() if not name: name = "Config" current\_config\_state["name"] = name timestamp = datetime.now().strftime('%Y\_%m\_%d-%H\_%M\_%S') filename = os.path.join(config\_states\_dir, f"{timestamp}\_{name}.json") print(f"Saving backup of webui/extension state to {filename}.") with open(filename, "w", encoding="utf-8") as f: json.dump(current\_config\_state, f, indent=4, ensure\_ascii=False) config\_states.list\_config\_states() new\_value = next(iter(config\_states.all\_config\_states.keys()), "Current") new\_choices = ["Current"] + list(config\_states.all\_config\_states.keys()) return gr.Dropdown.update(value=new\_value, choices=new\_choices), f"<span>Saved current webui/extension state to \"{filename}\"</span>"
def restore\_config\_state(confirmed, config\_state\_name, restore\_type): if config\_state\_name == "Current": return "<span>Select a config to restore from.</span>" if not confirmed: return "<span>Cancelled.</span>"
 check\_access()
 config\_state = config\_states.all\_config\_states[config\_state\_name]
 print(f"\*\*\* Restoring webui state from backup: {restore\_type} \*\*\*")
 if restore\_type == "extensions" or restore\_type == "both": shared.opts.restore\_config\_state\_file = config\_state["filepath"] shared.opts.save(shared.config\_filename)
 if restore\_type == "webui" or restore\_type == "both": config\_states.restore\_webui\_config(config\_state)
 shared.state.request\_restart()
 return ""
def check\_updates(id\_task, disable\_list): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 exts = [ext for ext in extensions.extensions if ext.remote is not None and ext.name not in disabled] shared.state.job\_count = len(exts)
 for ext in exts: shared.state.textinfo = ext.name
 try: ext.check\_updates() except FileNotFoundError as e: if 'FETCH\_HEAD' not in str(e): raise except Exception: errors.report(f"Error checking updates for {ext.name}", exc\_info=True)
 shared.state.nextjob()
 return extension\_table(), ""
def make\_commit\_link(commit\_hash, remote, text=None): if text is None: text = commit\_hash[:8] if remote.startswith("https://github.com/"): if remote.endswith(".git"): remote = remote[:-4] href = remote + "/commit/" + commit\_hash return f'<a href="{href}" target="\_blank">{text}</a>' else: return text
def extension\_table(): code = f"""<!-- {time.time()} --> <table id="extensions"> <thead> <tr> <th> <input class="gr-check-radio gr-checkbox all\_extensions\_toggle" type="checkbox" {'checked="checked"' if all(ext.enabled for ext in extensions.extensions) else ''} onchange="toggle\_all\_extensions(event)" /> <abbr title="Use checkbox to enable the extension; it will be enabled or disabled when you click apply button">Extension</abbr> </th> <th>URL</th> <th>Branch</th> <th>Version</th> <th>Date</th> <th><abbr title="Use checkbox to mark the extension for update; it will be updated when you click apply button">Update</abbr></th> </tr> </thead> <tbody> """
 for ext in extensions.extensions: ext: extensions.Extension ext.read\_info\_from\_repo()
 remote = f"""<a href="{html.escape(ext.remote or '')}" target="\_blank">{html.escape("built-in" if ext.is\_builtin else ext.remote or '')}</a>"""
 if ext.can\_update: ext\_status = f"""<label><input class="gr-check-radio gr-checkbox" name="update\_{html.escape(ext.name)}" checked="checked" type="checkbox">{html.escape(ext.status)}</label>""" else: ext\_status = ext.status
 style = "" if shared.cmd\_opts.disable\_extra\_extensions and not ext.is\_builtin or shared.opts.disable\_all\_extensions == "extra" and not ext.is\_builtin or shared.cmd\_opts.disable\_all\_extensions or shared.opts.disable\_all\_extensions == "all": style = STYLE\_PRIMARY
 version\_link = ext.version if ext.commit\_hash and ext.remote: version\_link = make\_commit\_link(ext.commit\_hash, ext.remote, ext.version)
 code += f""" <tr> <td><label{style}><input class="gr-check-radio gr-checkbox extension\_toggle" name="enable\_{html.escape(ext.name)}" type="checkbox" {'checked="checked"' if ext.enabled else ''} onchange="toggle\_extension(event)" />{html.escape(ext.name)}</label></td> <td>{remote}</td> <td>{ext.branch}</td> <td>{version\_link}</td> <td>{datetime.fromtimestamp(ext.commit\_date) if ext.commit\_date else ""}</td> <td{' class="extension\_status"' if ext.remote is not None else ''}>{ext\_status}</td> </tr> """
 code += """ </tbody> </table> """
 return code
def update\_config\_states\_table(state\_name): if state\_name == "Current": config\_state = config\_states.get\_config() else: config\_state = config\_states.all\_config\_states[state\_name]
 config\_name = config\_state.get("name", "Config") created\_date = datetime.fromtimestamp(config\_state["created\_at"]).strftime('%Y-%m-%d %H:%M:%S') filepath = config\_state.get("filepath", "<unknown>")
 try: webui\_remote = config\_state["webui"]["remote"] or "" webui\_branch = config\_state["webui"]["branch"] webui\_commit\_hash = config\_state["webui"]["commit\_hash"] or "<unknown>" webui\_commit\_date = config\_state["webui"]["commit\_date"] if webui\_commit\_date: webui\_commit\_date = time.asctime(time.gmtime(webui\_commit\_date)) else: webui\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(webui\_remote)}" target="\_blank">{html.escape(webui\_remote or '')}</a>""" commit\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote) date\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote, webui\_commit\_date)
 current\_webui = config\_states.get\_webui\_config()
 style\_remote = "" style\_branch = "" style\_commit = "" if current\_webui["remote"] != webui\_remote: style\_remote = STYLE\_PRIMARY if current\_webui["branch"] != webui\_branch: style\_branch = STYLE\_PRIMARY if current\_webui["commit\_hash"] != webui\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>WebUI State</h2><table id="config\_state\_webui"> <thead> <tr> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody> <tr> <td> <label{style\_remote}>{remote}</label> </td> <td> <label{style\_branch}>{webui\_branch}</label> </td> <td> <label{style\_commit}>{commit\_link}</label> </td> <td> <label{style\_commit}>{date\_link}</label> </td> </tr> </tbody></table><h2>Extension State</h2><table id="config\_state\_extensions"> <thead> <tr> <th>Extension</th> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody>"""
 ext\_map = {ext.name: ext for ext in extensions.extensions}
 for ext\_name, ext\_conf in config\_state["extensions"].items(): ext\_remote = ext\_conf["remote"] or "" ext\_branch = ext\_conf["branch"] or "<unknown>" ext\_enabled = ext\_conf["enabled"] ext\_commit\_hash = ext\_conf["commit\_hash"] or "<unknown>" ext\_commit\_date = ext\_conf["commit\_date"] if ext\_commit\_date: ext\_commit\_date = time.asctime(time.gmtime(ext\_commit\_date)) else: ext\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(ext\_remote)}" target="\_blank">{html.escape(ext\_remote or '')}</a>""" commit\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote) date\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote, ext\_commit\_date)
 style\_enabled = "" style\_remote = "" style\_branch = "" style\_commit = "" if ext\_name in ext\_map: current\_ext = ext\_map[ext\_name] current\_ext.read\_info\_from\_repo() if current\_ext.enabled != ext\_enabled: style\_enabled = STYLE\_PRIMARY if current\_ext.remote != ext\_remote: style\_remote = STYLE\_PRIMARY if current\_ext.branch != ext\_branch: style\_branch = STYLE\_PRIMARY if current\_ext.commit\_hash != ext\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code += f""" <tr> <td><label{style\_enabled}><input class="gr-check-radio gr-checkbox" type="checkbox" disabled="true" {'checked="checked"' if ext\_enabled else ''}>{html.escape(ext\_name)}</label></td> <td><label{style\_remote}>{remote}</label></td> <td><label{style\_branch}>{ext\_branch}</label></td> <td><label{style\_commit}>{commit\_link}</label></td> <td><label{style\_commit}>{date\_link}</label></td> </tr>"""
 code += """ </tbody></table>"""
 except Exception as e: print(f"[ERROR]: Config states {filepath}, {e}") code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>This file is corrupted</h2>"""
 return code
def normalize\_git\_url(url): if url is None: return ""
 url = url.replace(".git", "") return url
def get\_extension\_dirname\_from\_url(url): \*parts, last\_part = url.split('/') return normalize\_git\_url(last\_part)
def install\_extension\_from\_url(dirname, url, branch\_name=None): check\_access()
 if isinstance(dirname, str): dirname = dirname.strip() if isinstance(url, str): url = url.strip()
 assert url, 'No URL specified'
 if dirname is None or dirname == "": dirname = get\_extension\_dirname\_from\_url(url)
 target\_dir = os.path.join(extensions.extensions\_dir, dirname) assert not os.path.exists(target\_dir), f'Extension directory already exists: {target\_dir}'
 normalized\_url = normalize\_git\_url(url) if any(x for x in extensions.extensions if normalize\_git\_url(x.remote) == normalized\_url): raise Exception(f'Extension with this URL is already installed: {url}')
 tmpdir = os.path.join(paths.data\_path, "tmp", dirname)
 try: shutil.rmtree(tmpdir, True) if not branch\_name: # if no branch is specified, use the default branch with git.Repo.clone\_from(url, tmpdir, filter=['blob:none']) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() else: with git.Repo.clone\_from(url, tmpdir, filter=['blob:none'], branch=branch\_name) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() try: os.rename(tmpdir, target\_dir) except OSError as err: if err.errno == errno.EXDEV: # Cross device link, typical in docker or when tmp/ and extensions/ are on different file systems # Since we can't use a rename, do the slower but more versitile shutil.move() shutil.move(tmpdir, target\_dir) else: # Something else, not enough free space, permissions, etc. rethrow it so that it gets handled. raise err
 import launch launch.run\_extension\_installer(target\_dir)
 extensions.list\_extensions() return [extension\_table(), html.escape(f"Installed into {target\_dir}. Use Installed tab to restart.")] finally: shutil.rmtree(tmpdir, True)
def install\_extension\_from\_index(url, hide\_tags, sort\_column, filter\_text): ext\_table, message = install\_extension\_from\_url(None, url)
 code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ext\_table, message, ''
def refresh\_available\_extensions(url, hide\_tags, sort\_column): global available\_extensions
 import urllib.request with urllib.request.urlopen(url) as response: text = response.read()
 available\_extensions = json.loads(text)
 code, tags = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column)
 return url, code, gr.CheckboxGroup.update(choices=tags), '', ''
def refresh\_available\_extensions\_for\_tags(hide\_tags, sort\_column, filter\_text): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
def search\_extensions(filter\_text, hide\_tags, sort\_column): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
sort\_ordering = [ # (reverse, order\_by\_function) (True, lambda x: x.get('added', 'z')), (False, lambda x: x.get('added', 'z')), (False, lambda x: x.get('name', 'z')), (True, lambda x: x.get('name', 'z')), (False, lambda x: 'z'), (True, lambda x: x.get('commit\_time', '')), (True, lambda x: x.get('created\_at', '')), (True, lambda x: x.get('stars', 0)),]
def get\_date(info: dict, key): try: return datetime.strptime(info.get(key), "%Y-%m-%dT%H:%M:%SZ").replace(tzinfo=timezone.utc).astimezone().strftime("%Y-%m-%d") except (ValueError, TypeError): return ''
def refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text=""): extlist = available\_extensions["extensions"] installed\_extensions = {extension.name for extension in extensions.extensions} installed\_extension\_urls = {normalize\_git\_url(extension.remote) for extension in extensions.extensions if extension.remote is not None}
 tags = available\_extensions.get("tags", {}) tags\_to\_hide = set(hide\_tags) hidden = 0
 code = f"""<!-- {time.time()} --> <table id="available\_extensions"> <thead> <tr> <th>Extension</th> <th>Description</th> <th>Action</th> </tr> </thead> <tbody> """
 sort\_reverse, sort\_function = sort\_ordering[sort\_column if 0 <= sort\_column < len(sort\_ordering) else 0]
 for ext in sorted(extlist, key=sort\_function, reverse=sort\_reverse): name = ext.get("name", "noname") stars = int(ext.get("stars", 0)) added = ext.get('added', 'unknown') update\_time = get\_date(ext, 'commit\_time') create\_time = get\_date(ext, 'created\_at') url = ext.get("url", None) description = ext.get("description", "") extension\_tags = ext.get("tags", [])
 if url is None: continue
 existing = get\_extension\_dirname\_from\_url(url) in installed\_extensions or normalize\_git\_url(url) in installed\_extension\_urls extension\_tags = extension\_tags + ["installed"] if existing else extension\_tags
 if any(x for x in extension\_tags if x in tags\_to\_hide): hidden += 1 continue
 if filter\_text and filter\_text.strip(): if filter\_text.lower() not in html.escape(name).lower() and filter\_text.lower() not in html.escape(description).lower(): hidden += 1 continue
 install\_code = f"""<button onclick="install\_extension\_from\_index(this, '{html.escape(url)}')" {"disabled=disabled" if existing else ""} class="lg secondary gradio-button custom-button">{"Install" if not existing else "Installed"}</button>"""
 tags\_text = ", ".join([f"<span class='extension-tag' title='{tags.get(x, '')}'>{x}</span>" for x in extension\_tags])
 code += f""" <tr> <td><a href="{html.escape(url)}" target="\_blank">{html.escape(name)}</a><br />{tags\_text}</td> <td>{html.escape(description)}<p class="info"> <span class="date\_added">Update: {html.escape(update\_time)} Added: {html.escape(added)} Created: {html.escape(create\_time)}</span><span class="star\_count">stars: <b>{stars}</b></a></p></td> <td>{install\_code}</td> </tr>
 """
 for tag in [x for x in extension\_tags if x not in tags]: tags[tag] = tag
 code += """ </tbody> </table> """
 if hidden > 0: code += f"<p>Extension hidden: {hidden}</p>"
 return code, list(tags)
def preload\_extensions\_git\_metadata(): for extension in extensions.extensions: extension.read\_info\_from\_repo()
def create\_ui(): import modules.ui
 config\_states.list\_config\_states()
 threading.Thread(target=preload\_extensions\_git\_metadata).start()
 with gr.Blocks(analytics\_enabled=False) as ui: with gr.Tabs(elem\_id="tabs\_extensions"): with gr.TabItem("Installed", id="installed"):
 with gr.Row(elem\_id="extensions\_installed\_top"): apply\_label = ("Apply and restart UI" if restart.is\_restartable() else "Apply and quit") apply = gr.Button(value=apply\_label, variant="primary") check = gr.Button(value="Check for updates") extensions\_disable\_all = gr.Radio(label="Disable all extensions", choices=["none", "extra", "all"], value=shared.opts.disable\_all\_extensions, elem\_id="extensions\_disable\_all") extensions\_disabled\_list = gr.Text(elem\_id="extensions\_disabled\_list", visible=False, container=False) extensions\_update\_list = gr.Text(elem\_id="extensions\_update\_list", visible=False, container=False)
 html = ""
 if shared.cmd\_opts.disable\_all\_extensions or shared.cmd\_opts.disable\_extra\_extensions or shared.opts.disable\_all\_extensions != "none": if shared.cmd\_opts.disable\_all\_extensions: msg = '"--disable-all-extensions" was used, remove it to load all extensions again' elif shared.opts.disable\_all\_extensions != "none": msg = '"Disable all extensions" was set, change it to "none" to load all extensions again' elif shared.cmd\_opts.disable\_extra\_extensions: msg = '"--disable-extra-extensions" was used, remove it to load all extensions again' html = f'<span style="color: var(--primary-400);">{msg}</span>'
 with gr.Row(): info = gr.HTML(html)
 with gr.Row(elem\_classes="progress-container"): extensions\_table = gr.HTML('Loading...', elem\_id="extensions\_installed\_html")
 ui.load(fn=extension\_table, inputs=[], outputs=[extensions\_table])
 apply.click( fn=apply\_and\_restart, \_js="extensions\_apply", inputs=[extensions\_disabled\_list, extensions\_update\_list, extensions\_disable\_all], outputs=[], )
 check.click( fn=wrap\_gradio\_gpu\_call(check\_updates, extra\_outputs=[gr.update()]), \_js="extensions\_check", inputs=[info, extensions\_disabled\_list], outputs=[extensions\_table, info], )
 with gr.TabItem("Available", id="available"): with gr.Row(): refresh\_available\_extensions\_button = gr.Button(value="Load from:", variant="primary") extensions\_index\_url = os.environ.get('WEBUI\_EXTENSIONS\_INDEX', "https://raw.githubusercontent.com/AUTOMATIC1111/stable-diffusion-webui-extensions/master/index.json") available\_extensions\_index = gr.Text(value=extensions\_index\_url, label="Extension index URL", container=False) extension\_to\_install = gr.Text(elem\_id="extension\_to\_install", visible=False) install\_extension\_button = gr.Button(elem\_id="install\_extension\_button", visible=False)
 with gr.Row(): hide\_tags = gr.CheckboxGroup(value=["ads", "localization", "installed"], label="Hide extensions with tags", choices=["script", "ads", "localization", "installed"]) sort\_column = gr.Radio(value="newest first", label="Order", choices=["newest first", "oldest first", "a-z", "z-a", "internal order",'update time', 'create time', "stars"], type="index")
 with gr.Row(): search\_extensions\_text = gr.Text(label="Search", container=False)
 install\_result = gr.HTML() available\_extensions\_table = gr.HTML()
 refresh\_available\_extensions\_button.click( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions, extra\_outputs=[gr.update(), gr.update(), gr.update(), gr.update()]), inputs=[available\_extensions\_index, hide\_tags, sort\_column], outputs=[available\_extensions\_index, available\_extensions\_table, hide\_tags, search\_extensions\_text, install\_result], )
 install\_extension\_button.click( fn=modules.ui.wrap\_gradio\_call(install\_extension\_from\_index, extra\_outputs=[gr.update(), gr.update()]), inputs=[extension\_to\_install, hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, extensions\_table, install\_result], )
 search\_extensions\_text.change( fn=modules.ui.wrap\_gradio\_call(search\_extensions, extra\_outputs=[gr.update()]), inputs=[search\_extensions\_text, hide\_tags, sort\_column], outputs=[available\_extensions\_table, install\_result], )
 hide\_tags.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 sort\_column.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 with gr.TabItem("Install from URL", id="install\_from\_url"): install\_url = gr.Text(label="URL for extension's git repository") install\_branch = gr.Text(label="Specific branch name", placeholder="Leave empty for default main branch") install\_dirname = gr.Text(label="Local directory name", placeholder="Leave empty for auto") install\_button = gr.Button(value="Install", variant="primary") install\_result = gr.HTML(elem\_id="extension\_install\_result")
 install\_button.click( fn=modules.ui.wrap\_gradio\_call(lambda \*args: [gr.update(), \*install\_extension\_from\_url(\*args)], extra\_outputs=[gr.update(), gr.update()]), inputs=[install\_dirname, install\_url, install\_branch], outputs=[install\_url, extensions\_table, install\_result], )
 with gr.TabItem("Backup/Restore"): with gr.Row(elem\_id="extensions\_backup\_top\_row"): config\_states\_list = gr.Dropdown(label="Saved Configs", elem\_id="extension\_backup\_saved\_configs", value="Current", choices=["Current"] + list(config\_states.all\_config\_states.keys())) modules.ui.create\_refresh\_button(config\_states\_list, config\_states.list\_config\_states, lambda: {"choices": ["Current"] + list(config\_states.all\_config\_states.keys())}, "refresh\_config\_states") config\_restore\_type = gr.Radio(label="State to restore", choices=["extensions", "webui", "both"], value="extensions", elem\_id="extension\_backup\_restore\_type") config\_restore\_button = gr.Button(value="Restore Selected Config", variant="primary", elem\_id="extension\_backup\_restore") with gr.Row(elem\_id="extensions\_backup\_top\_row2"): config\_save\_name = gr.Textbox("", placeholder="Config Name", show\_label=False) config\_save\_button = gr.Button(value="Save Current Config")
 config\_states\_info = gr.HTML("") config\_states\_table = gr.HTML("Loading...") ui.load(fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table])
 config\_save\_button.click(fn=save\_config\_state, inputs=[config\_save\_name], outputs=[config\_states\_list, config\_states\_info])
 dummy\_component = gr.Label(visible=False) config\_restore\_button.click(fn=restore\_config\_state, \_js="config\_state\_confirm\_restore", inputs=[dummy\_component, config\_states\_list, config\_restore\_type], outputs=[config\_states\_info])
 config\_states\_list.change( fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table], )
 return ui

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from securitylab.github.com_775bdf1b_20250111_145834.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

April 12, 2024
# GHSL-2024-010: Limited file write in Stable-diffusion-webui - CVE-2024-31462

[![Author avatar](https://avatars.githubusercontent.com/u/102833689)
Sylwia Budzynska](https://github.com/sylwia-budzynska)

## Coordinated Disclosure Timeline

* 2024-02-08: Sent the report to the maintainer’s email.
* 2024-03-11: Sent a follow up email.
* 2024-04-08: Created a [discussion post](https://github.com/AUTOMATIC1111/stable-diffusion-webui/discussions/15461) asking for a contact person.
* 2024-04-08: Fix is created for the dev branch and as a release candidate. The maintainer asks for Security Lab to request a CVE themselves.
* 2024-04-09: CVE-2024-31462 is assigned.

## Summary

Stable-diffusion-webui 1.7.0 is vulnerable to a limited file write affecting Windows systems.

## Project

stable-diffusion-webui

## Tested Version

[1.7.0](https://github.com/AUTOMATIC1111/stable-diffusion-webui/releases/tag/v1.7.0)

## Details

### Limited file write in `modules/ui_extensions.py` (`GHSL-2024-010`)

The [`create_ui` method (Backup/Restore tab)](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py#L646-L660) in [modules/ui\_extensions.py](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/v1.7.0/modules/ui_extensions.py) takes user input into the [`config_save_name`](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py#L653) variable on line 653. This user input is later used in the [`save_config_state`](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py#L59) method and used to create a file path [on line 65](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py#L65), which is afterwards opened for writing on [line 67](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py#L67), which leads to a limited file write exploitable on Windows systems.

```
def save_config_state(name):
    current_config_state = config_states.get_config()
    if not name:
        name = "Config"
    current_config_state["name"] = name
    timestamp = datetime.now().strftime('%Y_%m_%d-%H_%M_%S')
    filename = os.path.join(config_states_dir, f"{timestamp}_{name}.json")
    print(f"Saving backup of webui/extension state to {filename}.")
    with open(filename, "w", encoding="utf-8") as f:
        json.dump(current_config_state, f, indent=4, ensure_ascii=False)

```

This issue was found with the help of CodeQL.

#### Impact

This issue may lead to limited file write. It allows for writing json files anywhere on the server.

## CVE

* CVE-2024-31462

## Credit

This issue was discovered and reported by GHSL team member [@sylwia-budzynska (Sylwia Budzynska)](https://github.com/sylwia-budzynska). The vulnerability was found with the help of CodeQL’s [path injection query](https://codeql.github.com/codeql-query-help/python/py-path-injection/) and additional modeling.

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2024-010` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information



=== Content from github.com_53825466_20250111_145832.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fv1.7.0%2Fmodules%2Fui_extensions.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fv1.7.0%2Fmodules%2Fui_extensions.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=AUTOMATIC1111%2Fstable-diffusion-webui)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AUTOMATIC1111](/AUTOMATIC1111)
/
**[stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui)**
Public

* [Notifications](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui) You must be signed in to change notification settings
* [Fork
  27.3k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)
* [Star
   146k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)

* [Code](/AUTOMATIC1111/stable-diffusion-webui/tree/v1.7.0)
* [Issues
  2.3k](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests
  51](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects
  0](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

Additional navigation options

* [Code](/AUTOMATIC1111/stable-diffusion-webui/tree/v1.7.0)
* [Issues](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

## Files

 v1.7.0
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/v1.7.0)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/v1.7.0/modules)
/
# ui\_extensions.py

Copy path Blame  Blame
## Latest commit

## History

[History](/AUTOMATIC1111/stable-diffusion-webui/commits/v1.7.0/modules/ui_extensions.py)672 lines (522 loc) · 27.8 KB v1.7.0
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/v1.7.0)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/v1.7.0/modules)
/
# ui\_extensions.py

Top
## File metadata and controls

* Code
* Blame

672 lines (522 loc) · 27.8 KB[Raw](https://github.com/AUTOMATIC1111/stable-diffusion-webui/raw/refs/tags/v1.7.0/modules/ui_extensions.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672import jsonimport osimport threadingimport timefrom datetime import datetime, timezone
import git
import gradio as grimport htmlimport shutilimport errno
from modules import extensions, shared, paths, config\_states, errors, restartfrom modules.paths\_internal import config\_states\_dirfrom modules.call\_queue import wrap\_gradio\_gpu\_call
available\_extensions = {"extensions": []}STYLE\_PRIMARY = ' style="color: var(--primary-400)"'
def check\_access(): assert not shared.cmd\_opts.disable\_extension\_access, "extension access disabled because of command line flags"
def apply\_and\_restart(disable\_list, update\_list, disable\_all): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 update = json.loads(update\_list) assert type(update) == list, f"wrong update\_list data for apply\_and\_restart: {update\_list}"
 if update: save\_config\_state("Backup (pre-update)")
 update = set(update)
 for ext in extensions.extensions: if ext.name not in update: continue
 try: ext.fetch\_and\_reset\_hard() except Exception: errors.report(f"Error getting updates for {ext.name}", exc\_info=True)
 shared.opts.disabled\_extensions = disabled shared.opts.disable\_all\_extensions = disable\_all shared.opts.save(shared.config\_filename)
 if restart.is\_restartable(): restart.restart\_program() else: restart.stop\_program()
def save\_config\_state(name): current\_config\_state = config\_states.get\_config() if not name: name = "Config" current\_config\_state["name"] = name timestamp = datetime.now().strftime('%Y\_%m\_%d-%H\_%M\_%S') filename = os.path.join(config\_states\_dir, f"{timestamp}\_{name}.json") print(f"Saving backup of webui/extension state to {filename}.") with open(filename, "w", encoding="utf-8") as f: json.dump(current\_config\_state, f, indent=4, ensure\_ascii=False) config\_states.list\_config\_states() new\_value = next(iter(config\_states.all\_config\_states.keys()), "Current") new\_choices = ["Current"] + list(config\_states.all\_config\_states.keys()) return gr.Dropdown.update(value=new\_value, choices=new\_choices), f"<span>Saved current webui/extension state to \"{filename}\"</span>"
def restore\_config\_state(confirmed, config\_state\_name, restore\_type): if config\_state\_name == "Current": return "<span>Select a config to restore from.</span>" if not confirmed: return "<span>Cancelled.</span>"
 check\_access()
 config\_state = config\_states.all\_config\_states[config\_state\_name]
 print(f"\*\*\* Restoring webui state from backup: {restore\_type} \*\*\*")
 if restore\_type == "extensions" or restore\_type == "both": shared.opts.restore\_config\_state\_file = config\_state["filepath"] shared.opts.save(shared.config\_filename)
 if restore\_type == "webui" or restore\_type == "both": config\_states.restore\_webui\_config(config\_state)
 shared.state.request\_restart()
 return ""
def check\_updates(id\_task, disable\_list): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 exts = [ext for ext in extensions.extensions if ext.remote is not None and ext.name not in disabled] shared.state.job\_count = len(exts)
 for ext in exts: shared.state.textinfo = ext.name
 try: ext.check\_updates() except FileNotFoundError as e: if 'FETCH\_HEAD' not in str(e): raise except Exception: errors.report(f"Error checking updates for {ext.name}", exc\_info=True)
 shared.state.nextjob()
 return extension\_table(), ""
def make\_commit\_link(commit\_hash, remote, text=None): if text is None: text = commit\_hash[:8] if remote.startswith("https://github.com/"): if remote.endswith(".git"): remote = remote[:-4] href = remote + "/commit/" + commit\_hash return f'<a href="{href}" target="\_blank">{text}</a>' else: return text
def extension\_table(): code = f"""<!-- {time.time()} --> <table id="extensions"> <thead> <tr> <th> <input class="gr-check-radio gr-checkbox all\_extensions\_toggle" type="checkbox" {'checked="checked"' if all(ext.enabled for ext in extensions.extensions) else ''} onchange="toggle\_all\_extensions(event)" /> <abbr title="Use checkbox to enable the extension; it will be enabled or disabled when you click apply button">Extension</abbr> </th> <th>URL</th> <th>Branch</th> <th>Version</th> <th>Date</th> <th><abbr title="Use checkbox to mark the extension for update; it will be updated when you click apply button">Update</abbr></th> </tr> </thead> <tbody> """
 for ext in extensions.extensions: ext: extensions.Extension ext.read\_info\_from\_repo()
 remote = f"""<a href="{html.escape(ext.remote or '')}" target="\_blank">{html.escape("built-in" if ext.is\_builtin else ext.remote or '')}</a>"""
 if ext.can\_update: ext\_status = f"""<label><input class="gr-check-radio gr-checkbox" name="update\_{html.escape(ext.name)}" checked="checked" type="checkbox">{html.escape(ext.status)}</label>""" else: ext\_status = ext.status
 style = "" if shared.cmd\_opts.disable\_extra\_extensions and not ext.is\_builtin or shared.opts.disable\_all\_extensions == "extra" and not ext.is\_builtin or shared.cmd\_opts.disable\_all\_extensions or shared.opts.disable\_all\_extensions == "all": style = STYLE\_PRIMARY
 version\_link = ext.version if ext.commit\_hash and ext.remote: version\_link = make\_commit\_link(ext.commit\_hash, ext.remote, ext.version)
 code += f""" <tr> <td><label{style}><input class="gr-check-radio gr-checkbox extension\_toggle" name="enable\_{html.escape(ext.name)}" type="checkbox" {'checked="checked"' if ext.enabled else ''} onchange="toggle\_extension(event)" />{html.escape(ext.name)}</label></td> <td>{remote}</td> <td>{ext.branch}</td> <td>{version\_link}</td> <td>{datetime.fromtimestamp(ext.commit\_date) if ext.commit\_date else ""}</td> <td{' class="extension\_status"' if ext.remote is not None else ''}>{ext\_status}</td> </tr> """
 code += """ </tbody> </table> """
 return code
def update\_config\_states\_table(state\_name): if state\_name == "Current": config\_state = config\_states.get\_config() else: config\_state = config\_states.all\_config\_states[state\_name]
 config\_name = config\_state.get("name", "Config") created\_date = datetime.fromtimestamp(config\_state["created\_at"]).strftime('%Y-%m-%d %H:%M:%S') filepath = config\_state.get("filepath", "<unknown>")
 try: webui\_remote = config\_state["webui"]["remote"] or "" webui\_branch = config\_state["webui"]["branch"] webui\_commit\_hash = config\_state["webui"]["commit\_hash"] or "<unknown>" webui\_commit\_date = config\_state["webui"]["commit\_date"] if webui\_commit\_date: webui\_commit\_date = time.asctime(time.gmtime(webui\_commit\_date)) else: webui\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(webui\_remote)}" target="\_blank">{html.escape(webui\_remote or '')}</a>""" commit\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote) date\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote, webui\_commit\_date)
 current\_webui = config\_states.get\_webui\_config()
 style\_remote = "" style\_branch = "" style\_commit = "" if current\_webui["remote"] != webui\_remote: style\_remote = STYLE\_PRIMARY if current\_webui["branch"] != webui\_branch: style\_branch = STYLE\_PRIMARY if current\_webui["commit\_hash"] != webui\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>WebUI State</h2><table id="config\_state\_webui"> <thead> <tr> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody> <tr> <td> <label{style\_remote}>{remote}</label> </td> <td> <label{style\_branch}>{webui\_branch}</label> </td> <td> <label{style\_commit}>{commit\_link}</label> </td> <td> <label{style\_commit}>{date\_link}</label> </td> </tr> </tbody></table><h2>Extension State</h2><table id="config\_state\_extensions"> <thead> <tr> <th>Extension</th> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody>"""
 ext\_map = {ext.name: ext for ext in extensions.extensions}
 for ext\_name, ext\_conf in config\_state["extensions"].items(): ext\_remote = ext\_conf["remote"] or "" ext\_branch = ext\_conf["branch"] or "<unknown>" ext\_enabled = ext\_conf["enabled"] ext\_commit\_hash = ext\_conf["commit\_hash"] or "<unknown>" ext\_commit\_date = ext\_conf["commit\_date"] if ext\_commit\_date: ext\_commit\_date = time.asctime(time.gmtime(ext\_commit\_date)) else: ext\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(ext\_remote)}" target="\_blank">{html.escape(ext\_remote or '')}</a>""" commit\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote) date\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote, ext\_commit\_date)
 style\_enabled = "" style\_remote = "" style\_branch = "" style\_commit = "" if ext\_name in ext\_map: current\_ext = ext\_map[ext\_name] current\_ext.read\_info\_from\_repo() if current\_ext.enabled != ext\_enabled: style\_enabled = STYLE\_PRIMARY if current\_ext.remote != ext\_remote: style\_remote = STYLE\_PRIMARY if current\_ext.branch != ext\_branch: style\_branch = STYLE\_PRIMARY if current\_ext.commit\_hash != ext\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code += f""" <tr> <td><label{style\_enabled}><input class="gr-check-radio gr-checkbox" type="checkbox" disabled="true" {'checked="checked"' if ext\_enabled else ''}>{html.escape(ext\_name)}</label></td> <td><label{style\_remote}>{remote}</label></td> <td><label{style\_branch}>{ext\_branch}</label></td> <td><label{style\_commit}>{commit\_link}</label></td> <td><label{style\_commit}>{date\_link}</label></td> </tr>"""
 code += """ </tbody></table>"""
 except Exception as e: print(f"[ERROR]: Config states {filepath}, {e}") code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>This file is corrupted</h2>"""
 return code
def normalize\_git\_url(url): if url is None: return ""
 url = url.replace(".git", "") return url
def get\_extension\_dirname\_from\_url(url): \*parts, last\_part = url.split('/') return normalize\_git\_url(last\_part)
def install\_extension\_from\_url(dirname, url, branch\_name=None): check\_access()
 if isinstance(dirname, str): dirname = dirname.strip() if isinstance(url, str): url = url.strip()
 assert url, 'No URL specified'
 if dirname is None or dirname == "": dirname = get\_extension\_dirname\_from\_url(url)
 target\_dir = os.path.join(extensions.extensions\_dir, dirname) assert not os.path.exists(target\_dir), f'Extension directory already exists: {target\_dir}'
 normalized\_url = normalize\_git\_url(url) if any(x for x in extensions.extensions if normalize\_git\_url(x.remote) == normalized\_url): raise Exception(f'Extension with this URL is already installed: {url}')
 tmpdir = os.path.join(paths.data\_path, "tmp", dirname)
 try: shutil.rmtree(tmpdir, True) if not branch\_name: # if no branch is specified, use the default branch with git.Repo.clone\_from(url, tmpdir, filter=['blob:none']) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() else: with git.Repo.clone\_from(url, tmpdir, filter=['blob:none'], branch=branch\_name) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() try: os.rename(tmpdir, target\_dir) except OSError as err: if err.errno == errno.EXDEV: # Cross device link, typical in docker or when tmp/ and extensions/ are on different file systems # Since we can't use a rename, do the slower but more versitile shutil.move() shutil.move(tmpdir, target\_dir) else: # Something else, not enough free space, permissions, etc. rethrow it so that it gets handled. raise err
 import launch launch.run\_extension\_installer(target\_dir)
 extensions.list\_extensions() return [extension\_table(), html.escape(f"Installed into {target\_dir}. Use Installed tab to restart.")] finally: shutil.rmtree(tmpdir, True)
def install\_extension\_from\_index(url, hide\_tags, sort\_column, filter\_text): ext\_table, message = install\_extension\_from\_url(None, url)
 code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ext\_table, message, ''
def refresh\_available\_extensions(url, hide\_tags, sort\_column): global available\_extensions
 import urllib.request with urllib.request.urlopen(url) as response: text = response.read()
 available\_extensions = json.loads(text)
 code, tags = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column)
 return url, code, gr.CheckboxGroup.update(choices=tags), '', ''
def refresh\_available\_extensions\_for\_tags(hide\_tags, sort\_column, filter\_text): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
def search\_extensions(filter\_text, hide\_tags, sort\_column): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
sort\_ordering = [ # (reverse, order\_by\_function) (True, lambda x: x.get('added', 'z')), (False, lambda x: x.get('added', 'z')), (False, lambda x: x.get('name', 'z')), (True, lambda x: x.get('name', 'z')), (False, lambda x: 'z'), (True, lambda x: x.get('commit\_time', '')), (True, lambda x: x.get('created\_at', '')), (True, lambda x: x.get('stars', 0)),]
def get\_date(info: dict, key): try: return datetime.strptime(info.get(key), "%Y-%m-%dT%H:%M:%SZ").replace(tzinfo=timezone.utc).astimezone().strftime("%Y-%m-%d") except (ValueError, TypeError): return ''
def refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text=""): extlist = available\_extensions["extensions"] installed\_extensions = {extension.name for extension in extensions.extensions} installed\_extension\_urls = {normalize\_git\_url(extension.remote) for extension in extensions.extensions if extension.remote is not None}
 tags = available\_extensions.get("tags", {}) tags\_to\_hide = set(hide\_tags) hidden = 0
 code = f"""<!-- {time.time()} --> <table id="available\_extensions"> <thead> <tr> <th>Extension</th> <th>Description</th> <th>Action</th> </tr> </thead> <tbody> """
 sort\_reverse, sort\_function = sort\_ordering[sort\_column if 0 <= sort\_column < len(sort\_ordering) else 0]
 for ext in sorted(extlist, key=sort\_function, reverse=sort\_reverse): name = ext.get("name", "noname") stars = int(ext.get("stars", 0)) added = ext.get('added', 'unknown') update\_time = get\_date(ext, 'commit\_time') create\_time = get\_date(ext, 'created\_at') url = ext.get("url", None) description = ext.get("description", "") extension\_tags = ext.get("tags", [])
 if url is None: continue
 existing = get\_extension\_dirname\_from\_url(url) in installed\_extensions or normalize\_git\_url(url) in installed\_extension\_urls extension\_tags = extension\_tags + ["installed"] if existing else extension\_tags
 if any(x for x in extension\_tags if x in tags\_to\_hide): hidden += 1 continue
 if filter\_text and filter\_text.strip(): if filter\_text.lower() not in html.escape(name).lower() and filter\_text.lower() not in html.escape(description).lower(): hidden += 1 continue
 install\_code = f"""<button onclick="install\_extension\_from\_index(this, '{html.escape(url)}')" {"disabled=disabled" if existing else ""} class="lg secondary gradio-button custom-button">{"Install" if not existing else "Installed"}</button>"""
 tags\_text = ", ".join([f"<span class='extension-tag' title='{tags.get(x, '')}'>{x}</span>" for x in extension\_tags])
 code += f""" <tr> <td><a href="{html.escape(url)}" target="\_blank">{html.escape(name)}</a><br />{tags\_text}</td> <td>{html.escape(description)}<p class="info"> <span class="date\_added">Update: {html.escape(update\_time)} Added: {html.escape(added)} Created: {html.escape(create\_time)}</span><span class="star\_count">stars: <b>{stars}</b></a></p></td> <td>{install\_code}</td> </tr>
 """
 for tag in [x for x in extension\_tags if x not in tags]: tags[tag] = tag
 code += """ </tbody> </table> """
 if hidden > 0: code += f"<p>Extension hidden: {hidden}</p>"
 return code, list(tags)
def preload\_extensions\_git\_metadata(): for extension in extensions.extensions: extension.read\_info\_from\_repo()
def create\_ui(): import modules.ui
 config\_states.list\_config\_states()
 threading.Thread(target=preload\_extensions\_git\_metadata).start()
 with gr.Blocks(analytics\_enabled=False) as ui: with gr.Tabs(elem\_id="tabs\_extensions"): with gr.TabItem("Installed", id="installed"):
 with gr.Row(elem\_id="extensions\_installed\_top"): apply\_label = ("Apply and restart UI" if restart.is\_restartable() else "Apply and quit") apply = gr.Button(value=apply\_label, variant="primary") check = gr.Button(value="Check for updates") extensions\_disable\_all = gr.Radio(label="Disable all extensions", choices=["none", "extra", "all"], value=shared.opts.disable\_all\_extensions, elem\_id="extensions\_disable\_all") extensions\_disabled\_list = gr.Text(elem\_id="extensions\_disabled\_list", visible=False, container=False) extensions\_update\_list = gr.Text(elem\_id="extensions\_update\_list", visible=False, container=False)
 html = ""
 if shared.cmd\_opts.disable\_all\_extensions or shared.cmd\_opts.disable\_extra\_extensions or shared.opts.disable\_all\_extensions != "none": if shared.cmd\_opts.disable\_all\_extensions: msg = '"--disable-all-extensions" was used, remove it to load all extensions again' elif shared.opts.disable\_all\_extensions != "none": msg = '"Disable all extensions" was set, change it to "none" to load all extensions again' elif shared.cmd\_opts.disable\_extra\_extensions: msg = '"--disable-extra-extensions" was used, remove it to load all extensions again' html = f'<span style="color: var(--primary-400);">{msg}</span>'
 with gr.Row(): info = gr.HTML(html)
 with gr.Row(elem\_classes="progress-container"): extensions\_table = gr.HTML('Loading...', elem\_id="extensions\_installed\_html")
 ui.load(fn=extension\_table, inputs=[], outputs=[extensions\_table])
 apply.click( fn=apply\_and\_restart, \_js="extensions\_apply", inputs=[extensions\_disabled\_list, extensions\_update\_list, extensions\_disable\_all], outputs=[], )
 check.click( fn=wrap\_gradio\_gpu\_call(check\_updates, extra\_outputs=[gr.update()]), \_js="extensions\_check", inputs=[info, extensions\_disabled\_list], outputs=[extensions\_table, info], )
 with gr.TabItem("Available", id="available"): with gr.Row(): refresh\_available\_extensions\_button = gr.Button(value="Load from:", variant="primary") extensions\_index\_url = os.environ.get('WEBUI\_EXTENSIONS\_INDEX', "https://raw.githubusercontent.com/AUTOMATIC1111/stable-diffusion-webui-extensions/master/index.json") available\_extensions\_index = gr.Text(value=extensions\_index\_url, label="Extension index URL", container=False) extension\_to\_install = gr.Text(elem\_id="extension\_to\_install", visible=False) install\_extension\_button = gr.Button(elem\_id="install\_extension\_button", visible=False)
 with gr.Row(): hide\_tags = gr.CheckboxGroup(value=["ads", "localization", "installed"], label="Hide extensions with tags", choices=["script", "ads", "localization", "installed"]) sort\_column = gr.Radio(value="newest first", label="Order", choices=["newest first", "oldest first", "a-z", "z-a", "internal order",'update time', 'create time', "stars"], type="index")
 with gr.Row(): search\_extensions\_text = gr.Text(label="Search", container=False)
 install\_result = gr.HTML() available\_extensions\_table = gr.HTML()
 refresh\_available\_extensions\_button.click( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions, extra\_outputs=[gr.update(), gr.update(), gr.update(), gr.update()]), inputs=[available\_extensions\_index, hide\_tags, sort\_column], outputs=[available\_extensions\_index, available\_extensions\_table, hide\_tags, search\_extensions\_text, install\_result], )
 install\_extension\_button.click( fn=modules.ui.wrap\_gradio\_call(install\_extension\_from\_index, extra\_outputs=[gr.update(), gr.update()]), inputs=[extension\_to\_install, hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, extensions\_table, install\_result], )
 search\_extensions\_text.change( fn=modules.ui.wrap\_gradio\_call(search\_extensions, extra\_outputs=[gr.update()]), inputs=[search\_extensions\_text, hide\_tags, sort\_column], outputs=[available\_extensions\_table, install\_result], )
 hide\_tags.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 sort\_column.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 with gr.TabItem("Install from URL", id="install\_from\_url"): install\_url = gr.Text(label="URL for extension's git repository") install\_branch = gr.Text(label="Specific branch name", placeholder="Leave empty for default main branch") install\_dirname = gr.Text(label="Local directory name", placeholder="Leave empty for auto") install\_button = gr.Button(value="Install", variant="primary") install\_result = gr.HTML(elem\_id="extension\_install\_result")
 install\_button.click( fn=modules.ui.wrap\_gradio\_call(lambda \*args: [gr.update(), \*install\_extension\_from\_url(\*args)], extra\_outputs=[gr.update(), gr.update()]), inputs=[install\_dirname, install\_url, install\_branch], outputs=[install\_url, extensions\_table, install\_result], )
 with gr.TabItem("Backup/Restore"): with gr.Row(elem\_id="extensions\_backup\_top\_row"): config\_states\_list = gr.Dropdown(label="Saved Configs", elem\_id="extension\_backup\_saved\_configs", value="Current", choices=["Current"] + list(config\_states.all\_config\_states.keys())) modules.ui.create\_refresh\_button(config\_states\_list, config\_states.list\_config\_states, lambda: {"choices": ["Current"] + list(config\_states.all\_config\_states.keys())}, "refresh\_config\_states") config\_restore\_type = gr.Radio(label="State to restore", choices=["extensions", "webui", "both"], value="extensions", elem\_id="extension\_backup\_restore\_type") config\_restore\_button = gr.Button(value="Restore Selected Config", variant="primary", elem\_id="extension\_backup\_restore") with gr.Row(elem\_id="extensions\_backup\_top\_row2"): config\_save\_name = gr.Textbox("", placeholder="Config Name", show\_label=False) config\_save\_button = gr.Button(value="Save Current Config")
 config\_states\_info = gr.HTML("") config\_states\_table = gr.HTML("Loading...") ui.load(fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table])
 config\_save\_button.click(fn=save\_config\_state, inputs=[config\_save\_name], outputs=[config\_states\_list, config\_states\_info])
 dummy\_component = gr.Label(visible=False) config\_restore\_button.click(fn=restore\_config\_state, \_js="config\_state\_confirm\_restore", inputs=[dummy\_component, config\_states\_list, config\_restore\_type], outputs=[config\_states\_info])
 config\_states\_list.change( fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table], )
 return ui

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_34eac5c2_20250111_145829.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fcf2772fab0af5573da775e7437e6acdca424f26e%2Fmodules%2Fui_extensions.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fcf2772fab0af5573da775e7437e6acdca424f26e%2Fmodules%2Fui_extensions.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=AUTOMATIC1111%2Fstable-diffusion-webui)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AUTOMATIC1111](/AUTOMATIC1111)
/
**[stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui)**
Public

* [Notifications](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui) You must be signed in to change notification settings
* [Fork
  27.3k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)
* [Star
   146k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues
  2.3k](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests
  51](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects
  0](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

Additional navigation options

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

## Files

 cf2772f
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e/modules)
/
# ui\_extensions.py

Copy path Blame  Blame
## Latest commit

## History

[History](/AUTOMATIC1111/stable-diffusion-webui/commits/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py)672 lines (522 loc) · 27.8 KB cf2772f
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e/modules)
/
# ui\_extensions.py

Top
## File metadata and controls

* Code
* Blame

672 lines (522 loc) · 27.8 KB[Raw](https://github.com/AUTOMATIC1111/stable-diffusion-webui/raw/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672import jsonimport osimport threadingimport timefrom datetime import datetime, timezone
import git
import gradio as grimport htmlimport shutilimport errno
from modules import extensions, shared, paths, config\_states, errors, restartfrom modules.paths\_internal import config\_states\_dirfrom modules.call\_queue import wrap\_gradio\_gpu\_call
available\_extensions = {"extensions": []}STYLE\_PRIMARY = ' style="color: var(--primary-400)"'
def check\_access(): assert not shared.cmd\_opts.disable\_extension\_access, "extension access disabled because of command line flags"
def apply\_and\_restart(disable\_list, update\_list, disable\_all): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 update = json.loads(update\_list) assert type(update) == list, f"wrong update\_list data for apply\_and\_restart: {update\_list}"
 if update: save\_config\_state("Backup (pre-update)")
 update = set(update)
 for ext in extensions.extensions: if ext.name not in update: continue
 try: ext.fetch\_and\_reset\_hard() except Exception: errors.report(f"Error getting updates for {ext.name}", exc\_info=True)
 shared.opts.disabled\_extensions = disabled shared.opts.disable\_all\_extensions = disable\_all shared.opts.save(shared.config\_filename)
 if restart.is\_restartable(): restart.restart\_program() else: restart.stop\_program()
def save\_config\_state(name): current\_config\_state = config\_states.get\_config() if not name: name = "Config" current\_config\_state["name"] = name timestamp = datetime.now().strftime('%Y\_%m\_%d-%H\_%M\_%S') filename = os.path.join(config\_states\_dir, f"{timestamp}\_{name}.json") print(f"Saving backup of webui/extension state to {filename}.") with open(filename, "w", encoding="utf-8") as f: json.dump(current\_config\_state, f, indent=4, ensure\_ascii=False) config\_states.list\_config\_states() new\_value = next(iter(config\_states.all\_config\_states.keys()), "Current") new\_choices = ["Current"] + list(config\_states.all\_config\_states.keys()) return gr.Dropdown.update(value=new\_value, choices=new\_choices), f"<span>Saved current webui/extension state to \"{filename}\"</span>"
def restore\_config\_state(confirmed, config\_state\_name, restore\_type): if config\_state\_name == "Current": return "<span>Select a config to restore from.</span>" if not confirmed: return "<span>Cancelled.</span>"
 check\_access()
 config\_state = config\_states.all\_config\_states[config\_state\_name]
 print(f"\*\*\* Restoring webui state from backup: {restore\_type} \*\*\*")
 if restore\_type == "extensions" or restore\_type == "both": shared.opts.restore\_config\_state\_file = config\_state["filepath"] shared.opts.save(shared.config\_filename)
 if restore\_type == "webui" or restore\_type == "both": config\_states.restore\_webui\_config(config\_state)
 shared.state.request\_restart()
 return ""
def check\_updates(id\_task, disable\_list): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 exts = [ext for ext in extensions.extensions if ext.remote is not None and ext.name not in disabled] shared.state.job\_count = len(exts)
 for ext in exts: shared.state.textinfo = ext.name
 try: ext.check\_updates() except FileNotFoundError as e: if 'FETCH\_HEAD' not in str(e): raise except Exception: errors.report(f"Error checking updates for {ext.name}", exc\_info=True)
 shared.state.nextjob()
 return extension\_table(), ""
def make\_commit\_link(commit\_hash, remote, text=None): if text is None: text = commit\_hash[:8] if remote.startswith("https://github.com/"): if remote.endswith(".git"): remote = remote[:-4] href = remote + "/commit/" + commit\_hash return f'<a href="{href}" target="\_blank">{text}</a>' else: return text
def extension\_table(): code = f"""<!-- {time.time()} --> <table id="extensions"> <thead> <tr> <th> <input class="gr-check-radio gr-checkbox all\_extensions\_toggle" type="checkbox" {'checked="checked"' if all(ext.enabled for ext in extensions.extensions) else ''} onchange="toggle\_all\_extensions(event)" /> <abbr title="Use checkbox to enable the extension; it will be enabled or disabled when you click apply button">Extension</abbr> </th> <th>URL</th> <th>Branch</th> <th>Version</th> <th>Date</th> <th><abbr title="Use checkbox to mark the extension for update; it will be updated when you click apply button">Update</abbr></th> </tr> </thead> <tbody> """
 for ext in extensions.extensions: ext: extensions.Extension ext.read\_info\_from\_repo()
 remote = f"""<a href="{html.escape(ext.remote or '')}" target="\_blank">{html.escape("built-in" if ext.is\_builtin else ext.remote or '')}</a>"""
 if ext.can\_update: ext\_status = f"""<label><input class="gr-check-radio gr-checkbox" name="update\_{html.escape(ext.name)}" checked="checked" type="checkbox">{html.escape(ext.status)}</label>""" else: ext\_status = ext.status
 style = "" if shared.cmd\_opts.disable\_extra\_extensions and not ext.is\_builtin or shared.opts.disable\_all\_extensions == "extra" and not ext.is\_builtin or shared.cmd\_opts.disable\_all\_extensions or shared.opts.disable\_all\_extensions == "all": style = STYLE\_PRIMARY
 version\_link = ext.version if ext.commit\_hash and ext.remote: version\_link = make\_commit\_link(ext.commit\_hash, ext.remote, ext.version)
 code += f""" <tr> <td><label{style}><input class="gr-check-radio gr-checkbox extension\_toggle" name="enable\_{html.escape(ext.name)}" type="checkbox" {'checked="checked"' if ext.enabled else ''} onchange="toggle\_extension(event)" />{html.escape(ext.name)}</label></td> <td>{remote}</td> <td>{ext.branch}</td> <td>{version\_link}</td> <td>{datetime.fromtimestamp(ext.commit\_date) if ext.commit\_date else ""}</td> <td{' class="extension\_status"' if ext.remote is not None else ''}>{ext\_status}</td> </tr> """
 code += """ </tbody> </table> """
 return code
def update\_config\_states\_table(state\_name): if state\_name == "Current": config\_state = config\_states.get\_config() else: config\_state = config\_states.all\_config\_states[state\_name]
 config\_name = config\_state.get("name", "Config") created\_date = datetime.fromtimestamp(config\_state["created\_at"]).strftime('%Y-%m-%d %H:%M:%S') filepath = config\_state.get("filepath", "<unknown>")
 try: webui\_remote = config\_state["webui"]["remote"] or "" webui\_branch = config\_state["webui"]["branch"] webui\_commit\_hash = config\_state["webui"]["commit\_hash"] or "<unknown>" webui\_commit\_date = config\_state["webui"]["commit\_date"] if webui\_commit\_date: webui\_commit\_date = time.asctime(time.gmtime(webui\_commit\_date)) else: webui\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(webui\_remote)}" target="\_blank">{html.escape(webui\_remote or '')}</a>""" commit\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote) date\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote, webui\_commit\_date)
 current\_webui = config\_states.get\_webui\_config()
 style\_remote = "" style\_branch = "" style\_commit = "" if current\_webui["remote"] != webui\_remote: style\_remote = STYLE\_PRIMARY if current\_webui["branch"] != webui\_branch: style\_branch = STYLE\_PRIMARY if current\_webui["commit\_hash"] != webui\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>WebUI State</h2><table id="config\_state\_webui"> <thead> <tr> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody> <tr> <td> <label{style\_remote}>{remote}</label> </td> <td> <label{style\_branch}>{webui\_branch}</label> </td> <td> <label{style\_commit}>{commit\_link}</label> </td> <td> <label{style\_commit}>{date\_link}</label> </td> </tr> </tbody></table><h2>Extension State</h2><table id="config\_state\_extensions"> <thead> <tr> <th>Extension</th> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody>"""
 ext\_map = {ext.name: ext for ext in extensions.extensions}
 for ext\_name, ext\_conf in config\_state["extensions"].items(): ext\_remote = ext\_conf["remote"] or "" ext\_branch = ext\_conf["branch"] or "<unknown>" ext\_enabled = ext\_conf["enabled"] ext\_commit\_hash = ext\_conf["commit\_hash"] or "<unknown>" ext\_commit\_date = ext\_conf["commit\_date"] if ext\_commit\_date: ext\_commit\_date = time.asctime(time.gmtime(ext\_commit\_date)) else: ext\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(ext\_remote)}" target="\_blank">{html.escape(ext\_remote or '')}</a>""" commit\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote) date\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote, ext\_commit\_date)
 style\_enabled = "" style\_remote = "" style\_branch = "" style\_commit = "" if ext\_name in ext\_map: current\_ext = ext\_map[ext\_name] current\_ext.read\_info\_from\_repo() if current\_ext.enabled != ext\_enabled: style\_enabled = STYLE\_PRIMARY if current\_ext.remote != ext\_remote: style\_remote = STYLE\_PRIMARY if current\_ext.branch != ext\_branch: style\_branch = STYLE\_PRIMARY if current\_ext.commit\_hash != ext\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code += f""" <tr> <td><label{style\_enabled}><input class="gr-check-radio gr-checkbox" type="checkbox" disabled="true" {'checked="checked"' if ext\_enabled else ''}>{html.escape(ext\_name)}</label></td> <td><label{style\_remote}>{remote}</label></td> <td><label{style\_branch}>{ext\_branch}</label></td> <td><label{style\_commit}>{commit\_link}</label></td> <td><label{style\_commit}>{date\_link}</label></td> </tr>"""
 code += """ </tbody></table>"""
 except Exception as e: print(f"[ERROR]: Config states {filepath}, {e}") code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>This file is corrupted</h2>"""
 return code
def normalize\_git\_url(url): if url is None: return ""
 url = url.replace(".git", "") return url
def get\_extension\_dirname\_from\_url(url): \*parts, last\_part = url.split('/') return normalize\_git\_url(last\_part)
def install\_extension\_from\_url(dirname, url, branch\_name=None): check\_access()
 if isinstance(dirname, str): dirname = dirname.strip() if isinstance(url, str): url = url.strip()
 assert url, 'No URL specified'
 if dirname is None or dirname == "": dirname = get\_extension\_dirname\_from\_url(url)
 target\_dir = os.path.join(extensions.extensions\_dir, dirname) assert not os.path.exists(target\_dir), f'Extension directory already exists: {target\_dir}'
 normalized\_url = normalize\_git\_url(url) if any(x for x in extensions.extensions if normalize\_git\_url(x.remote) == normalized\_url): raise Exception(f'Extension with this URL is already installed: {url}')
 tmpdir = os.path.join(paths.data\_path, "tmp", dirname)
 try: shutil.rmtree(tmpdir, True) if not branch\_name: # if no branch is specified, use the default branch with git.Repo.clone\_from(url, tmpdir, filter=['blob:none']) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() else: with git.Repo.clone\_from(url, tmpdir, filter=['blob:none'], branch=branch\_name) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() try: os.rename(tmpdir, target\_dir) except OSError as err: if err.errno == errno.EXDEV: # Cross device link, typical in docker or when tmp/ and extensions/ are on different file systems # Since we can't use a rename, do the slower but more versitile shutil.move() shutil.move(tmpdir, target\_dir) else: # Something else, not enough free space, permissions, etc. rethrow it so that it gets handled. raise err
 import launch launch.run\_extension\_installer(target\_dir)
 extensions.list\_extensions() return [extension\_table(), html.escape(f"Installed into {target\_dir}. Use Installed tab to restart.")] finally: shutil.rmtree(tmpdir, True)
def install\_extension\_from\_index(url, hide\_tags, sort\_column, filter\_text): ext\_table, message = install\_extension\_from\_url(None, url)
 code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ext\_table, message, ''
def refresh\_available\_extensions(url, hide\_tags, sort\_column): global available\_extensions
 import urllib.request with urllib.request.urlopen(url) as response: text = response.read()
 available\_extensions = json.loads(text)
 code, tags = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column)
 return url, code, gr.CheckboxGroup.update(choices=tags), '', ''
def refresh\_available\_extensions\_for\_tags(hide\_tags, sort\_column, filter\_text): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
def search\_extensions(filter\_text, hide\_tags, sort\_column): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
sort\_ordering = [ # (reverse, order\_by\_function) (True, lambda x: x.get('added', 'z')), (False, lambda x: x.get('added', 'z')), (False, lambda x: x.get('name', 'z')), (True, lambda x: x.get('name', 'z')), (False, lambda x: 'z'), (True, lambda x: x.get('commit\_time', '')), (True, lambda x: x.get('created\_at', '')), (True, lambda x: x.get('stars', 0)),]
def get\_date(info: dict, key): try: return datetime.strptime(info.get(key), "%Y-%m-%dT%H:%M:%SZ").replace(tzinfo=timezone.utc).astimezone().strftime("%Y-%m-%d") except (ValueError, TypeError): return ''
def refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text=""): extlist = available\_extensions["extensions"] installed\_extensions = {extension.name for extension in extensions.extensions} installed\_extension\_urls = {normalize\_git\_url(extension.remote) for extension in extensions.extensions if extension.remote is not None}
 tags = available\_extensions.get("tags", {}) tags\_to\_hide = set(hide\_tags) hidden = 0
 code = f"""<!-- {time.time()} --> <table id="available\_extensions"> <thead> <tr> <th>Extension</th> <th>Description</th> <th>Action</th> </tr> </thead> <tbody> """
 sort\_reverse, sort\_function = sort\_ordering[sort\_column if 0 <= sort\_column < len(sort\_ordering) else 0]
 for ext in sorted(extlist, key=sort\_function, reverse=sort\_reverse): name = ext.get("name", "noname") stars = int(ext.get("stars", 0)) added = ext.get('added', 'unknown') update\_time = get\_date(ext, 'commit\_time') create\_time = get\_date(ext, 'created\_at') url = ext.get("url", None) description = ext.get("description", "") extension\_tags = ext.get("tags", [])
 if url is None: continue
 existing = get\_extension\_dirname\_from\_url(url) in installed\_extensions or normalize\_git\_url(url) in installed\_extension\_urls extension\_tags = extension\_tags + ["installed"] if existing else extension\_tags
 if any(x for x in extension\_tags if x in tags\_to\_hide): hidden += 1 continue
 if filter\_text and filter\_text.strip(): if filter\_text.lower() not in html.escape(name).lower() and filter\_text.lower() not in html.escape(description).lower(): hidden += 1 continue
 install\_code = f"""<button onclick="install\_extension\_from\_index(this, '{html.escape(url)}')" {"disabled=disabled" if existing else ""} class="lg secondary gradio-button custom-button">{"Install" if not existing else "Installed"}</button>"""
 tags\_text = ", ".join([f"<span class='extension-tag' title='{tags.get(x, '')}'>{x}</span>" for x in extension\_tags])
 code += f""" <tr> <td><a href="{html.escape(url)}" target="\_blank">{html.escape(name)}</a><br />{tags\_text}</td> <td>{html.escape(description)}<p class="info"> <span class="date\_added">Update: {html.escape(update\_time)} Added: {html.escape(added)} Created: {html.escape(create\_time)}</span><span class="star\_count">stars: <b>{stars}</b></a></p></td> <td>{install\_code}</td> </tr>
 """
 for tag in [x for x in extension\_tags if x not in tags]: tags[tag] = tag
 code += """ </tbody> </table> """
 if hidden > 0: code += f"<p>Extension hidden: {hidden}</p>"
 return code, list(tags)
def preload\_extensions\_git\_metadata(): for extension in extensions.extensions: extension.read\_info\_from\_repo()
def create\_ui(): import modules.ui
 config\_states.list\_config\_states()
 threading.Thread(target=preload\_extensions\_git\_metadata).start()
 with gr.Blocks(analytics\_enabled=False) as ui: with gr.Tabs(elem\_id="tabs\_extensions"): with gr.TabItem("Installed", id="installed"):
 with gr.Row(elem\_id="extensions\_installed\_top"): apply\_label = ("Apply and restart UI" if restart.is\_restartable() else "Apply and quit") apply = gr.Button(value=apply\_label, variant="primary") check = gr.Button(value="Check for updates") extensions\_disable\_all = gr.Radio(label="Disable all extensions", choices=["none", "extra", "all"], value=shared.opts.disable\_all\_extensions, elem\_id="extensions\_disable\_all") extensions\_disabled\_list = gr.Text(elem\_id="extensions\_disabled\_list", visible=False, container=False) extensions\_update\_list = gr.Text(elem\_id="extensions\_update\_list", visible=False, container=False)
 html = ""
 if shared.cmd\_opts.disable\_all\_extensions or shared.cmd\_opts.disable\_extra\_extensions or shared.opts.disable\_all\_extensions != "none": if shared.cmd\_opts.disable\_all\_extensions: msg = '"--disable-all-extensions" was used, remove it to load all extensions again' elif shared.opts.disable\_all\_extensions != "none": msg = '"Disable all extensions" was set, change it to "none" to load all extensions again' elif shared.cmd\_opts.disable\_extra\_extensions: msg = '"--disable-extra-extensions" was used, remove it to load all extensions again' html = f'<span style="color: var(--primary-400);">{msg}</span>'
 with gr.Row(): info = gr.HTML(html)
 with gr.Row(elem\_classes="progress-container"): extensions\_table = gr.HTML('Loading...', elem\_id="extensions\_installed\_html")
 ui.load(fn=extension\_table, inputs=[], outputs=[extensions\_table])
 apply.click( fn=apply\_and\_restart, \_js="extensions\_apply", inputs=[extensions\_disabled\_list, extensions\_update\_list, extensions\_disable\_all], outputs=[], )
 check.click( fn=wrap\_gradio\_gpu\_call(check\_updates, extra\_outputs=[gr.update()]), \_js="extensions\_check", inputs=[info, extensions\_disabled\_list], outputs=[extensions\_table, info], )
 with gr.TabItem("Available", id="available"): with gr.Row(): refresh\_available\_extensions\_button = gr.Button(value="Load from:", variant="primary") extensions\_index\_url = os.environ.get('WEBUI\_EXTENSIONS\_INDEX', "https://raw.githubusercontent.com/AUTOMATIC1111/stable-diffusion-webui-extensions/master/index.json") available\_extensions\_index = gr.Text(value=extensions\_index\_url, label="Extension index URL", container=False) extension\_to\_install = gr.Text(elem\_id="extension\_to\_install", visible=False) install\_extension\_button = gr.Button(elem\_id="install\_extension\_button", visible=False)
 with gr.Row(): hide\_tags = gr.CheckboxGroup(value=["ads", "localization", "installed"], label="Hide extensions with tags", choices=["script", "ads", "localization", "installed"]) sort\_column = gr.Radio(value="newest first", label="Order", choices=["newest first", "oldest first", "a-z", "z-a", "internal order",'update time', 'create time', "stars"], type="index")
 with gr.Row(): search\_extensions\_text = gr.Text(label="Search", container=False)
 install\_result = gr.HTML() available\_extensions\_table = gr.HTML()
 refresh\_available\_extensions\_button.click( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions, extra\_outputs=[gr.update(), gr.update(), gr.update(), gr.update()]), inputs=[available\_extensions\_index, hide\_tags, sort\_column], outputs=[available\_extensions\_index, available\_extensions\_table, hide\_tags, search\_extensions\_text, install\_result], )
 install\_extension\_button.click( fn=modules.ui.wrap\_gradio\_call(install\_extension\_from\_index, extra\_outputs=[gr.update(), gr.update()]), inputs=[extension\_to\_install, hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, extensions\_table, install\_result], )
 search\_extensions\_text.change( fn=modules.ui.wrap\_gradio\_call(search\_extensions, extra\_outputs=[gr.update()]), inputs=[search\_extensions\_text, hide\_tags, sort\_column], outputs=[available\_extensions\_table, install\_result], )
 hide\_tags.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 sort\_column.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 with gr.TabItem("Install from URL", id="install\_from\_url"): install\_url = gr.Text(label="URL for extension's git repository") install\_branch = gr.Text(label="Specific branch name", placeholder="Leave empty for default main branch") install\_dirname = gr.Text(label="Local directory name", placeholder="Leave empty for auto") install\_button = gr.Button(value="Install", variant="primary") install\_result = gr.HTML(elem\_id="extension\_install\_result")
 install\_button.click( fn=modules.ui.wrap\_gradio\_call(lambda \*args: [gr.update(), \*install\_extension\_from\_url(\*args)], extra\_outputs=[gr.update(), gr.update()]), inputs=[install\_dirname, install\_url, install\_branch], outputs=[install\_url, extensions\_table, install\_result], )
 with gr.TabItem("Backup/Restore"): with gr.Row(elem\_id="extensions\_backup\_top\_row"): config\_states\_list = gr.Dropdown(label="Saved Configs", elem\_id="extension\_backup\_saved\_configs", value="Current", choices=["Current"] + list(config\_states.all\_config\_states.keys())) modules.ui.create\_refresh\_button(config\_states\_list, config\_states.list\_config\_states, lambda: {"choices": ["Current"] + list(config\_states.all\_config\_states.keys())}, "refresh\_config\_states") config\_restore\_type = gr.Radio(label="State to restore", choices=["extensions", "webui", "both"], value="extensions", elem\_id="extension\_backup\_restore\_type") config\_restore\_button = gr.Button(value="Restore Selected Config", variant="primary", elem\_id="extension\_backup\_restore") with gr.Row(elem\_id="extensions\_backup\_top\_row2"): config\_save\_name = gr.Textbox("", placeholder="Config Name", show\_label=False) config\_save\_button = gr.Button(value="Save Current Config")
 config\_states\_info = gr.HTML("") config\_states\_table = gr.HTML("Loading...") ui.load(fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table])
 config\_save\_button.click(fn=save\_config\_state, inputs=[config\_save\_name], outputs=[config\_states\_list, config\_states\_info])
 dummy\_component = gr.Label(visible=False) config\_restore\_button.click(fn=restore\_config\_state, \_js="config\_state\_confirm\_restore", inputs=[dummy\_component, config\_states\_list, config\_restore\_type], outputs=[config\_states\_info])
 config\_states\_list.change( fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table], )
 return ui

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_11fa6022_20250111_145834.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fdiscussions%2F15461)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fdiscussions%2F15461)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fdiscussions_fragments%2Fdiscussion_layout&source=header-repo&source_repo=AUTOMATIC1111%2Fstable-diffusion-webui)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AUTOMATIC1111](/AUTOMATIC1111)
/
**[stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui)**
Public

* [Notifications](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui) You must be signed in to change notification settings
* [Fork
  27.3k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)
* [Star
   146k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues
  2.3k](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests
  51](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects
  0](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

Additional navigation options

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

# Vulnerability report contact person or email #15461

[sylwia-budzynska](/sylwia-budzynska)
started this conversation in
[General](/AUTOMATIC1111/stable-diffusion-webui/discussions/categories/general)

[Vulnerability report contact person or email](#top)
#15461

[![@sylwia-budzynska](https://avatars.githubusercontent.com/u/102833689?s=40&v=4)
sylwia-budzynska](/sylwia-budzynska)

Apr 8, 2024
·
1 comments
·
2 replies

[Return to top](#top)

Discussion options

# {{title}}

Something went wrong.

Quote reply

## [sylwia-budzynska](/sylwia-budzynska) [Apr 8, 2024](#discussion-6477791)

 -

| Hello,  Two months ago (on 8th of February) I sent a vulnerability report to the maintainer's email, but I haven't heard back. Please let me know if you'd like me to send the report to another email address or in another way, e.g. via private vulnerability reporting feature (see [docs](https://docs.github.com/en/code-security/security-advisories/working-with-repository-security-advisories/configuring-private-vulnerability-reporting-for-a-repository#enabling-or-disabling-private-vulnerability-reporting-for-a-repository) on how to enable private vulnerability reporting). Thank you! |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

## Replies: 1 comment · 2 replies

* [Oldest](/AUTOMATIC1111/stable-diffusion-webui/discussions/15461?sort=old)
* [Newest](/AUTOMATIC1111/stable-diffusion-webui/discussions/15461?sort=new)
* [Top](/AUTOMATIC1111/stable-diffusion-webui/discussions/15461?sort=top)

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

### [w-e-w](/w-e-w) [Apr 8, 2024](#discussioncomment-9045010) Collaborator

 -

| I pinged AUTO on discord |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

 👍
1

All reactions

* 👍
  1

2 replies

[![@sylwia-budzynska](https://avatars.githubusercontent.com/u/102833689?s=60&v=4)](/sylwia-budzynska)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [sylwia-budzynska](/sylwia-budzynska) [Apr 8, 2024](#discussioncomment-9045107) Author

 -

| Thank you! |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@w-e-w](https://avatars.githubusercontent.com/u/40751091?s=60&v=4)](/w-e-w)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [w-e-w](/w-e-w) [Apr 8, 2024](#discussioncomment-9046351) Collaborator

 -

| he pushed fix |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fdiscussions%2F15461)

Category

[💬

General](/AUTOMATIC1111/stable-diffusion-webui/discussions/categories/general)

Labels

None yet

2 participants

[![@sylwia-budzynska](https://avatars.githubusercontent.com/u/102833689?s=48&v=4)](/sylwia-budzynska) [![@w-e-w](https://avatars.githubusercontent.com/u/40751091?s=48&v=4)](/w-e-w)

Heading

Bold

Italic

Quote

Code

Link

---

Numbered list

Unordered list

Task list

---

Attach files

Mention

Reference

Menu

* Heading
* Bold
* Italic
* Quote
* Code
* Link
* Numbered list
* Unordered list
* Task list
* Attach files
* Mention
* Reference

# Select a reply

 Loading

  [Create a new saved reply](/settings/replies?return_to=1)

 👍
1
  reacted with thumbs up emoji

 👎
1
  reacted with thumbs down emoji

 😄
1
  reacted with laugh emoji

 🎉
1
  reacted with hooray emoji

 😕
1
  reacted with confused emoji

 ❤️
1
  reacted with heart emoji

 🚀
1
  reacted with rocket emoji

 👀
1
  reacted with eyes emoji

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c7840a07_20250111_145824.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fcf2772fab0af5573da775e7437e6acdca424f26e%2Fmodules%2Fui_extensions.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAUTOMATIC1111%2Fstable-diffusion-webui%2Fblob%2Fcf2772fab0af5573da775e7437e6acdca424f26e%2Fmodules%2Fui_extensions.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=AUTOMATIC1111%2Fstable-diffusion-webui)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AUTOMATIC1111](/AUTOMATIC1111)
/
**[stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui)**
Public

* [Notifications](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui) You must be signed in to change notification settings
* [Fork
  27.3k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)
* [Star
   146k](/login?return_to=%2FAUTOMATIC1111%2Fstable-diffusion-webui)

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues
  2.3k](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests
  51](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects
  0](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

Additional navigation options

* [Code](/AUTOMATIC1111/stable-diffusion-webui)
* [Issues](/AUTOMATIC1111/stable-diffusion-webui/issues)
* [Pull requests](/AUTOMATIC1111/stable-diffusion-webui/pulls)
* [Discussions](/AUTOMATIC1111/stable-diffusion-webui/discussions)
* [Actions](/AUTOMATIC1111/stable-diffusion-webui/actions)
* [Projects](/AUTOMATIC1111/stable-diffusion-webui/projects)
* [Wiki](/AUTOMATIC1111/stable-diffusion-webui/wiki)
* [Security](/AUTOMATIC1111/stable-diffusion-webui/security)
* [Insights](/AUTOMATIC1111/stable-diffusion-webui/pulse)

## Files

 cf2772f
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e/modules)
/
# ui\_extensions.py

Copy path Blame  Blame
## Latest commit

## History

[History](/AUTOMATIC1111/stable-diffusion-webui/commits/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py)672 lines (522 loc) · 27.8 KB cf2772f
## Breadcrumbs

1. [stable-diffusion-webui](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e)
2. /[modules](/AUTOMATIC1111/stable-diffusion-webui/tree/cf2772fab0af5573da775e7437e6acdca424f26e/modules)
/
# ui\_extensions.py

Top
## File metadata and controls

* Code
* Blame

672 lines (522 loc) · 27.8 KB[Raw](https://github.com/AUTOMATIC1111/stable-diffusion-webui/raw/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672import jsonimport osimport threadingimport timefrom datetime import datetime, timezone
import git
import gradio as grimport htmlimport shutilimport errno
from modules import extensions, shared, paths, config\_states, errors, restartfrom modules.paths\_internal import config\_states\_dirfrom modules.call\_queue import wrap\_gradio\_gpu\_call
available\_extensions = {"extensions": []}STYLE\_PRIMARY = ' style="color: var(--primary-400)"'
def check\_access(): assert not shared.cmd\_opts.disable\_extension\_access, "extension access disabled because of command line flags"
def apply\_and\_restart(disable\_list, update\_list, disable\_all): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 update = json.loads(update\_list) assert type(update) == list, f"wrong update\_list data for apply\_and\_restart: {update\_list}"
 if update: save\_config\_state("Backup (pre-update)")
 update = set(update)
 for ext in extensions.extensions: if ext.name not in update: continue
 try: ext.fetch\_and\_reset\_hard() except Exception: errors.report(f"Error getting updates for {ext.name}", exc\_info=True)
 shared.opts.disabled\_extensions = disabled shared.opts.disable\_all\_extensions = disable\_all shared.opts.save(shared.config\_filename)
 if restart.is\_restartable(): restart.restart\_program() else: restart.stop\_program()
def save\_config\_state(name): current\_config\_state = config\_states.get\_config() if not name: name = "Config" current\_config\_state["name"] = name timestamp = datetime.now().strftime('%Y\_%m\_%d-%H\_%M\_%S') filename = os.path.join(config\_states\_dir, f"{timestamp}\_{name}.json") print(f"Saving backup of webui/extension state to {filename}.") with open(filename, "w", encoding="utf-8") as f: json.dump(current\_config\_state, f, indent=4, ensure\_ascii=False) config\_states.list\_config\_states() new\_value = next(iter(config\_states.all\_config\_states.keys()), "Current") new\_choices = ["Current"] + list(config\_states.all\_config\_states.keys()) return gr.Dropdown.update(value=new\_value, choices=new\_choices), f"<span>Saved current webui/extension state to \"{filename}\"</span>"
def restore\_config\_state(confirmed, config\_state\_name, restore\_type): if config\_state\_name == "Current": return "<span>Select a config to restore from.</span>" if not confirmed: return "<span>Cancelled.</span>"
 check\_access()
 config\_state = config\_states.all\_config\_states[config\_state\_name]
 print(f"\*\*\* Restoring webui state from backup: {restore\_type} \*\*\*")
 if restore\_type == "extensions" or restore\_type == "both": shared.opts.restore\_config\_state\_file = config\_state["filepath"] shared.opts.save(shared.config\_filename)
 if restore\_type == "webui" or restore\_type == "both": config\_states.restore\_webui\_config(config\_state)
 shared.state.request\_restart()
 return ""
def check\_updates(id\_task, disable\_list): check\_access()
 disabled = json.loads(disable\_list) assert type(disabled) == list, f"wrong disable\_list data for apply\_and\_restart: {disable\_list}"
 exts = [ext for ext in extensions.extensions if ext.remote is not None and ext.name not in disabled] shared.state.job\_count = len(exts)
 for ext in exts: shared.state.textinfo = ext.name
 try: ext.check\_updates() except FileNotFoundError as e: if 'FETCH\_HEAD' not in str(e): raise except Exception: errors.report(f"Error checking updates for {ext.name}", exc\_info=True)
 shared.state.nextjob()
 return extension\_table(), ""
def make\_commit\_link(commit\_hash, remote, text=None): if text is None: text = commit\_hash[:8] if remote.startswith("https://github.com/"): if remote.endswith(".git"): remote = remote[:-4] href = remote + "/commit/" + commit\_hash return f'<a href="{href}" target="\_blank">{text}</a>' else: return text
def extension\_table(): code = f"""<!-- {time.time()} --> <table id="extensions"> <thead> <tr> <th> <input class="gr-check-radio gr-checkbox all\_extensions\_toggle" type="checkbox" {'checked="checked"' if all(ext.enabled for ext in extensions.extensions) else ''} onchange="toggle\_all\_extensions(event)" /> <abbr title="Use checkbox to enable the extension; it will be enabled or disabled when you click apply button">Extension</abbr> </th> <th>URL</th> <th>Branch</th> <th>Version</th> <th>Date</th> <th><abbr title="Use checkbox to mark the extension for update; it will be updated when you click apply button">Update</abbr></th> </tr> </thead> <tbody> """
 for ext in extensions.extensions: ext: extensions.Extension ext.read\_info\_from\_repo()
 remote = f"""<a href="{html.escape(ext.remote or '')}" target="\_blank">{html.escape("built-in" if ext.is\_builtin else ext.remote or '')}</a>"""
 if ext.can\_update: ext\_status = f"""<label><input class="gr-check-radio gr-checkbox" name="update\_{html.escape(ext.name)}" checked="checked" type="checkbox">{html.escape(ext.status)}</label>""" else: ext\_status = ext.status
 style = "" if shared.cmd\_opts.disable\_extra\_extensions and not ext.is\_builtin or shared.opts.disable\_all\_extensions == "extra" and not ext.is\_builtin or shared.cmd\_opts.disable\_all\_extensions or shared.opts.disable\_all\_extensions == "all": style = STYLE\_PRIMARY
 version\_link = ext.version if ext.commit\_hash and ext.remote: version\_link = make\_commit\_link(ext.commit\_hash, ext.remote, ext.version)
 code += f""" <tr> <td><label{style}><input class="gr-check-radio gr-checkbox extension\_toggle" name="enable\_{html.escape(ext.name)}" type="checkbox" {'checked="checked"' if ext.enabled else ''} onchange="toggle\_extension(event)" />{html.escape(ext.name)}</label></td> <td>{remote}</td> <td>{ext.branch}</td> <td>{version\_link}</td> <td>{datetime.fromtimestamp(ext.commit\_date) if ext.commit\_date else ""}</td> <td{' class="extension\_status"' if ext.remote is not None else ''}>{ext\_status}</td> </tr> """
 code += """ </tbody> </table> """
 return code
def update\_config\_states\_table(state\_name): if state\_name == "Current": config\_state = config\_states.get\_config() else: config\_state = config\_states.all\_config\_states[state\_name]
 config\_name = config\_state.get("name", "Config") created\_date = datetime.fromtimestamp(config\_state["created\_at"]).strftime('%Y-%m-%d %H:%M:%S') filepath = config\_state.get("filepath", "<unknown>")
 try: webui\_remote = config\_state["webui"]["remote"] or "" webui\_branch = config\_state["webui"]["branch"] webui\_commit\_hash = config\_state["webui"]["commit\_hash"] or "<unknown>" webui\_commit\_date = config\_state["webui"]["commit\_date"] if webui\_commit\_date: webui\_commit\_date = time.asctime(time.gmtime(webui\_commit\_date)) else: webui\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(webui\_remote)}" target="\_blank">{html.escape(webui\_remote or '')}</a>""" commit\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote) date\_link = make\_commit\_link(webui\_commit\_hash, webui\_remote, webui\_commit\_date)
 current\_webui = config\_states.get\_webui\_config()
 style\_remote = "" style\_branch = "" style\_commit = "" if current\_webui["remote"] != webui\_remote: style\_remote = STYLE\_PRIMARY if current\_webui["branch"] != webui\_branch: style\_branch = STYLE\_PRIMARY if current\_webui["commit\_hash"] != webui\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>WebUI State</h2><table id="config\_state\_webui"> <thead> <tr> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody> <tr> <td> <label{style\_remote}>{remote}</label> </td> <td> <label{style\_branch}>{webui\_branch}</label> </td> <td> <label{style\_commit}>{commit\_link}</label> </td> <td> <label{style\_commit}>{date\_link}</label> </td> </tr> </tbody></table><h2>Extension State</h2><table id="config\_state\_extensions"> <thead> <tr> <th>Extension</th> <th>URL</th> <th>Branch</th> <th>Commit</th> <th>Date</th> </tr> </thead> <tbody>"""
 ext\_map = {ext.name: ext for ext in extensions.extensions}
 for ext\_name, ext\_conf in config\_state["extensions"].items(): ext\_remote = ext\_conf["remote"] or "" ext\_branch = ext\_conf["branch"] or "<unknown>" ext\_enabled = ext\_conf["enabled"] ext\_commit\_hash = ext\_conf["commit\_hash"] or "<unknown>" ext\_commit\_date = ext\_conf["commit\_date"] if ext\_commit\_date: ext\_commit\_date = time.asctime(time.gmtime(ext\_commit\_date)) else: ext\_commit\_date = "<unknown>"
 remote = f"""<a href="{html.escape(ext\_remote)}" target="\_blank">{html.escape(ext\_remote or '')}</a>""" commit\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote) date\_link = make\_commit\_link(ext\_commit\_hash, ext\_remote, ext\_commit\_date)
 style\_enabled = "" style\_remote = "" style\_branch = "" style\_commit = "" if ext\_name in ext\_map: current\_ext = ext\_map[ext\_name] current\_ext.read\_info\_from\_repo() if current\_ext.enabled != ext\_enabled: style\_enabled = STYLE\_PRIMARY if current\_ext.remote != ext\_remote: style\_remote = STYLE\_PRIMARY if current\_ext.branch != ext\_branch: style\_branch = STYLE\_PRIMARY if current\_ext.commit\_hash != ext\_commit\_hash: style\_commit = STYLE\_PRIMARY
 code += f""" <tr> <td><label{style\_enabled}><input class="gr-check-radio gr-checkbox" type="checkbox" disabled="true" {'checked="checked"' if ext\_enabled else ''}>{html.escape(ext\_name)}</label></td> <td><label{style\_remote}>{remote}</label></td> <td><label{style\_branch}>{ext\_branch}</label></td> <td><label{style\_commit}>{commit\_link}</label></td> <td><label{style\_commit}>{date\_link}</label></td> </tr>"""
 code += """ </tbody></table>"""
 except Exception as e: print(f"[ERROR]: Config states {filepath}, {e}") code = f"""<!-- {time.time()} --><h2>Config Backup: {config\_name}</h2><div><b>Filepath:</b> {filepath}</div><div><b>Created at:</b> {created\_date}</div><h2>This file is corrupted</h2>"""
 return code
def normalize\_git\_url(url): if url is None: return ""
 url = url.replace(".git", "") return url
def get\_extension\_dirname\_from\_url(url): \*parts, last\_part = url.split('/') return normalize\_git\_url(last\_part)
def install\_extension\_from\_url(dirname, url, branch\_name=None): check\_access()
 if isinstance(dirname, str): dirname = dirname.strip() if isinstance(url, str): url = url.strip()
 assert url, 'No URL specified'
 if dirname is None or dirname == "": dirname = get\_extension\_dirname\_from\_url(url)
 target\_dir = os.path.join(extensions.extensions\_dir, dirname) assert not os.path.exists(target\_dir), f'Extension directory already exists: {target\_dir}'
 normalized\_url = normalize\_git\_url(url) if any(x for x in extensions.extensions if normalize\_git\_url(x.remote) == normalized\_url): raise Exception(f'Extension with this URL is already installed: {url}')
 tmpdir = os.path.join(paths.data\_path, "tmp", dirname)
 try: shutil.rmtree(tmpdir, True) if not branch\_name: # if no branch is specified, use the default branch with git.Repo.clone\_from(url, tmpdir, filter=['blob:none']) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() else: with git.Repo.clone\_from(url, tmpdir, filter=['blob:none'], branch=branch\_name) as repo: repo.remote().fetch() for submodule in repo.submodules: submodule.update() try: os.rename(tmpdir, target\_dir) except OSError as err: if err.errno == errno.EXDEV: # Cross device link, typical in docker or when tmp/ and extensions/ are on different file systems # Since we can't use a rename, do the slower but more versitile shutil.move() shutil.move(tmpdir, target\_dir) else: # Something else, not enough free space, permissions, etc. rethrow it so that it gets handled. raise err
 import launch launch.run\_extension\_installer(target\_dir)
 extensions.list\_extensions() return [extension\_table(), html.escape(f"Installed into {target\_dir}. Use Installed tab to restart.")] finally: shutil.rmtree(tmpdir, True)
def install\_extension\_from\_index(url, hide\_tags, sort\_column, filter\_text): ext\_table, message = install\_extension\_from\_url(None, url)
 code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ext\_table, message, ''
def refresh\_available\_extensions(url, hide\_tags, sort\_column): global available\_extensions
 import urllib.request with urllib.request.urlopen(url) as response: text = response.read()
 available\_extensions = json.loads(text)
 code, tags = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column)
 return url, code, gr.CheckboxGroup.update(choices=tags), '', ''
def refresh\_available\_extensions\_for\_tags(hide\_tags, sort\_column, filter\_text): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
def search\_extensions(filter\_text, hide\_tags, sort\_column): code, \_ = refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text)
 return code, ''
sort\_ordering = [ # (reverse, order\_by\_function) (True, lambda x: x.get('added', 'z')), (False, lambda x: x.get('added', 'z')), (False, lambda x: x.get('name', 'z')), (True, lambda x: x.get('name', 'z')), (False, lambda x: 'z'), (True, lambda x: x.get('commit\_time', '')), (True, lambda x: x.get('created\_at', '')), (True, lambda x: x.get('stars', 0)),]
def get\_date(info: dict, key): try: return datetime.strptime(info.get(key), "%Y-%m-%dT%H:%M:%SZ").replace(tzinfo=timezone.utc).astimezone().strftime("%Y-%m-%d") except (ValueError, TypeError): return ''
def refresh\_available\_extensions\_from\_data(hide\_tags, sort\_column, filter\_text=""): extlist = available\_extensions["extensions"] installed\_extensions = {extension.name for extension in extensions.extensions} installed\_extension\_urls = {normalize\_git\_url(extension.remote) for extension in extensions.extensions if extension.remote is not None}
 tags = available\_extensions.get("tags", {}) tags\_to\_hide = set(hide\_tags) hidden = 0
 code = f"""<!-- {time.time()} --> <table id="available\_extensions"> <thead> <tr> <th>Extension</th> <th>Description</th> <th>Action</th> </tr> </thead> <tbody> """
 sort\_reverse, sort\_function = sort\_ordering[sort\_column if 0 <= sort\_column < len(sort\_ordering) else 0]
 for ext in sorted(extlist, key=sort\_function, reverse=sort\_reverse): name = ext.get("name", "noname") stars = int(ext.get("stars", 0)) added = ext.get('added', 'unknown') update\_time = get\_date(ext, 'commit\_time') create\_time = get\_date(ext, 'created\_at') url = ext.get("url", None) description = ext.get("description", "") extension\_tags = ext.get("tags", [])
 if url is None: continue
 existing = get\_extension\_dirname\_from\_url(url) in installed\_extensions or normalize\_git\_url(url) in installed\_extension\_urls extension\_tags = extension\_tags + ["installed"] if existing else extension\_tags
 if any(x for x in extension\_tags if x in tags\_to\_hide): hidden += 1 continue
 if filter\_text and filter\_text.strip(): if filter\_text.lower() not in html.escape(name).lower() and filter\_text.lower() not in html.escape(description).lower(): hidden += 1 continue
 install\_code = f"""<button onclick="install\_extension\_from\_index(this, '{html.escape(url)}')" {"disabled=disabled" if existing else ""} class="lg secondary gradio-button custom-button">{"Install" if not existing else "Installed"}</button>"""
 tags\_text = ", ".join([f"<span class='extension-tag' title='{tags.get(x, '')}'>{x}</span>" for x in extension\_tags])
 code += f""" <tr> <td><a href="{html.escape(url)}" target="\_blank">{html.escape(name)}</a><br />{tags\_text}</td> <td>{html.escape(description)}<p class="info"> <span class="date\_added">Update: {html.escape(update\_time)} Added: {html.escape(added)} Created: {html.escape(create\_time)}</span><span class="star\_count">stars: <b>{stars}</b></a></p></td> <td>{install\_code}</td> </tr>
 """
 for tag in [x for x in extension\_tags if x not in tags]: tags[tag] = tag
 code += """ </tbody> </table> """
 if hidden > 0: code += f"<p>Extension hidden: {hidden}</p>"
 return code, list(tags)
def preload\_extensions\_git\_metadata(): for extension in extensions.extensions: extension.read\_info\_from\_repo()
def create\_ui(): import modules.ui
 config\_states.list\_config\_states()
 threading.Thread(target=preload\_extensions\_git\_metadata).start()
 with gr.Blocks(analytics\_enabled=False) as ui: with gr.Tabs(elem\_id="tabs\_extensions"): with gr.TabItem("Installed", id="installed"):
 with gr.Row(elem\_id="extensions\_installed\_top"): apply\_label = ("Apply and restart UI" if restart.is\_restartable() else "Apply and quit") apply = gr.Button(value=apply\_label, variant="primary") check = gr.Button(value="Check for updates") extensions\_disable\_all = gr.Radio(label="Disable all extensions", choices=["none", "extra", "all"], value=shared.opts.disable\_all\_extensions, elem\_id="extensions\_disable\_all") extensions\_disabled\_list = gr.Text(elem\_id="extensions\_disabled\_list", visible=False, container=False) extensions\_update\_list = gr.Text(elem\_id="extensions\_update\_list", visible=False, container=False)
 html = ""
 if shared.cmd\_opts.disable\_all\_extensions or shared.cmd\_opts.disable\_extra\_extensions or shared.opts.disable\_all\_extensions != "none": if shared.cmd\_opts.disable\_all\_extensions: msg = '"--disable-all-extensions" was used, remove it to load all extensions again' elif shared.opts.disable\_all\_extensions != "none": msg = '"Disable all extensions" was set, change it to "none" to load all extensions again' elif shared.cmd\_opts.disable\_extra\_extensions: msg = '"--disable-extra-extensions" was used, remove it to load all extensions again' html = f'<span style="color: var(--primary-400);">{msg}</span>'
 with gr.Row(): info = gr.HTML(html)
 with gr.Row(elem\_classes="progress-container"): extensions\_table = gr.HTML('Loading...', elem\_id="extensions\_installed\_html")
 ui.load(fn=extension\_table, inputs=[], outputs=[extensions\_table])
 apply.click( fn=apply\_and\_restart, \_js="extensions\_apply", inputs=[extensions\_disabled\_list, extensions\_update\_list, extensions\_disable\_all], outputs=[], )
 check.click( fn=wrap\_gradio\_gpu\_call(check\_updates, extra\_outputs=[gr.update()]), \_js="extensions\_check", inputs=[info, extensions\_disabled\_list], outputs=[extensions\_table, info], )
 with gr.TabItem("Available", id="available"): with gr.Row(): refresh\_available\_extensions\_button = gr.Button(value="Load from:", variant="primary") extensions\_index\_url = os.environ.get('WEBUI\_EXTENSIONS\_INDEX', "https://raw.githubusercontent.com/AUTOMATIC1111/stable-diffusion-webui-extensions/master/index.json") available\_extensions\_index = gr.Text(value=extensions\_index\_url, label="Extension index URL", container=False) extension\_to\_install = gr.Text(elem\_id="extension\_to\_install", visible=False) install\_extension\_button = gr.Button(elem\_id="install\_extension\_button", visible=False)
 with gr.Row(): hide\_tags = gr.CheckboxGroup(value=["ads", "localization", "installed"], label="Hide extensions with tags", choices=["script", "ads", "localization", "installed"]) sort\_column = gr.Radio(value="newest first", label="Order", choices=["newest first", "oldest first", "a-z", "z-a", "internal order",'update time', 'create time', "stars"], type="index")
 with gr.Row(): search\_extensions\_text = gr.Text(label="Search", container=False)
 install\_result = gr.HTML() available\_extensions\_table = gr.HTML()
 refresh\_available\_extensions\_button.click( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions, extra\_outputs=[gr.update(), gr.update(), gr.update(), gr.update()]), inputs=[available\_extensions\_index, hide\_tags, sort\_column], outputs=[available\_extensions\_index, available\_extensions\_table, hide\_tags, search\_extensions\_text, install\_result], )
 install\_extension\_button.click( fn=modules.ui.wrap\_gradio\_call(install\_extension\_from\_index, extra\_outputs=[gr.update(), gr.update()]), inputs=[extension\_to\_install, hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, extensions\_table, install\_result], )
 search\_extensions\_text.change( fn=modules.ui.wrap\_gradio\_call(search\_extensions, extra\_outputs=[gr.update()]), inputs=[search\_extensions\_text, hide\_tags, sort\_column], outputs=[available\_extensions\_table, install\_result], )
 hide\_tags.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 sort\_column.change( fn=modules.ui.wrap\_gradio\_call(refresh\_available\_extensions\_for\_tags, extra\_outputs=[gr.update()]), inputs=[hide\_tags, sort\_column, search\_extensions\_text], outputs=[available\_extensions\_table, install\_result] )
 with gr.TabItem("Install from URL", id="install\_from\_url"): install\_url = gr.Text(label="URL for extension's git repository") install\_branch = gr.Text(label="Specific branch name", placeholder="Leave empty for default main branch") install\_dirname = gr.Text(label="Local directory name", placeholder="Leave empty for auto") install\_button = gr.Button(value="Install", variant="primary") install\_result = gr.HTML(elem\_id="extension\_install\_result")
 install\_button.click( fn=modules.ui.wrap\_gradio\_call(lambda \*args: [gr.update(), \*install\_extension\_from\_url(\*args)], extra\_outputs=[gr.update(), gr.update()]), inputs=[install\_dirname, install\_url, install\_branch], outputs=[install\_url, extensions\_table, install\_result], )
 with gr.TabItem("Backup/Restore"): with gr.Row(elem\_id="extensions\_backup\_top\_row"): config\_states\_list = gr.Dropdown(label="Saved Configs", elem\_id="extension\_backup\_saved\_configs", value="Current", choices=["Current"] + list(config\_states.all\_config\_states.keys())) modules.ui.create\_refresh\_button(config\_states\_list, config\_states.list\_config\_states, lambda: {"choices": ["Current"] + list(config\_states.all\_config\_states.keys())}, "refresh\_config\_states") config\_restore\_type = gr.Radio(label="State to restore", choices=["extensions", "webui", "both"], value="extensions", elem\_id="extension\_backup\_restore\_type") config\_restore\_button = gr.Button(value="Restore Selected Config", variant="primary", elem\_id="extension\_backup\_restore") with gr.Row(elem\_id="extensions\_backup\_top\_row2"): config\_save\_name = gr.Textbox("", placeholder="Config Name", show\_label=False) config\_save\_button = gr.Button(value="Save Current Config")
 config\_states\_info = gr.HTML("") config\_states\_table = gr.HTML("Loading...") ui.load(fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table])
 config\_save\_button.click(fn=save\_config\_state, inputs=[config\_save\_name], outputs=[config\_states\_list, config\_states\_info])
 dummy\_component = gr.Label(visible=False) config\_restore\_button.click(fn=restore\_config\_state, \_js="config\_state\_confirm\_restore", inputs=[dummy\_component, config\_states\_list, config\_restore\_type], outputs=[config\_states\_info])
 config\_states\_list.change( fn=update\_config\_states\_table, inputs=[config\_states\_list], outputs=[config\_states\_table], )
 return ui

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from securitylab.github.com_cd3c3405_20250111_145834.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

April 12, 2024
# GHSL-2024-010: Limited file write in Stable-diffusion-webui - CVE-2024-31462

[![Author avatar](https://avatars.githubusercontent.com/u/102833689)
Sylwia Budzynska](https://github.com/sylwia-budzynska)

## Coordinated Disclosure Timeline

* 2024-02-08: Sent the report to the maintainer’s email.
* 2024-03-11: Sent a follow up email.
* 2024-04-08: Created a [discussion post](https://github.com/AUTOMATIC1111/stable-diffusion-webui/discussions/15461) asking for a contact person.
* 2024-04-08: Fix is created for the dev branch and as a release candidate. The maintainer asks for Security Lab to request a CVE themselves.
* 2024-04-09: CVE-2024-31462 is assigned.

## Summary

Stable-diffusion-webui 1.7.0 is vulnerable to a limited file write affecting Windows systems.

## Project

stable-diffusion-webui

## Tested Version

[1.7.0](https://github.com/AUTOMATIC1111/stable-diffusion-webui/releases/tag/v1.7.0)

## Details

### Limited file write in `modules/ui_extensions.py` (`GHSL-2024-010`)

The [`create_ui` method (Backup/Restore tab)](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py#L646-L660) in [modules/ui\_extensions.py](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/v1.7.0/modules/ui_extensions.py) takes user input into the [`config_save_name`](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py#L653) variable on line 653. This user input is later used in the [`save_config_state`](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py#L59) method and used to create a file path [on line 65](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py#L65), which is afterwards opened for writing on [line 67](https://github.com/AUTOMATIC1111/stable-diffusion-webui/blob/cf2772fab0af5573da775e7437e6acdca424f26e/modules/ui_extensions.py#L67), which leads to a limited file write exploitable on Windows systems.

```
def save_config_state(name):
    current_config_state = config_states.get_config()
    if not name:
        name = "Config"
    current_config_state["name"] = name
    timestamp = datetime.now().strftime('%Y_%m_%d-%H_%M_%S')
    filename = os.path.join(config_states_dir, f"{timestamp}_{name}.json")
    print(f"Saving backup of webui/extension state to {filename}.")
    with open(filename, "w", encoding="utf-8") as f:
        json.dump(current_config_state, f, indent=4, ensure_ascii=False)

```

This issue was found with the help of CodeQL.

#### Impact

This issue may lead to limited file write. It allows for writing json files anywhere on the server.

## CVE

* CVE-2024-31462

## Credit

This issue was discovered and reported by GHSL team member [@sylwia-budzynska (Sylwia Budzynska)](https://github.com/sylwia-budzynska). The vulnerability was found with the help of CodeQL’s [path injection query](https://codeql.github.com/codeql-query-help/python/py-path-injection/) and additional modeling.

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2024-010` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information


