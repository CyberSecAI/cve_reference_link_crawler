
[![Splunk Security Content Logo](https://research.splunk.com/images/logo.svg)](https://research.splunk.com/)

* [Analytic Stories](https://research.splunk.com/stories/)
* [Detections](https://research.splunk.com/detections/)
* [Playbooks](https://research.splunk.com/playbooks/)
* [Data Sources](https://research.splunk.com/sources/)
* [Blog](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)
* [About](http://splunk.com/threat-research)
* [![GitHub Repo](https://research.splunk.com/images/GitHubMarkLight.svg)](https://github.com/splunk/security_content)

## Table of Contents

* + [Description](#description)
  + [Search](#search)
  + [Data Source](#data-source)
  + [Macros Used](#macros-used)
  + [Annotations](#annotations)
  + [Default Configuration](#default-configuration)
  + [Implementation](#implementation)
  + [Known False Positives](#known-false-positives)
  + [Associated Analytic Story](#associated-analytic-story)
  + [Risk Based Analytics (RBA)](#risk-based-analytics-rba)
  + [References](#references)
  + [Detection Testing](#detection-testing)

# Detection: Splunk RCE via Splunk Secure Gateway Splunk Mobile alerts feature

Updated Date: 2024-10-17
ID: baa41f09-df48-4375-8991-520beea161be
Author: Rod Soto
[Type: Hunting](#default-configuration)
[Product: Splunk Enterprise Security](https://www.splunk.com/en_us/products/enterprise-security.html)
### Description

The following analytic identifies potential exploitation attempts against the Splunk Secure Gateway App's Mobile Alerts feature in Splunk versions 9.0, 8.2.x, and 8.1.x. It detects suspicious activity by monitoring requests to the mobile alerts endpoint using specific URI paths and query parameters. This activity is significant because an authenticated user could exploit this vulnerability to execute arbitrary operating system commands remotely. If confirmed malicious, this could lead to unauthorized code execution, compromising the integrity and security of the Splunk environment.

### Search

```
1`splunkda` uri_path="/servicesNS/nobody/splunk_secure_gateway/storage/collections/data/mobile_alerts*" sort="notification.created_at:-1"
2| table  clientip file host method uri_query sort
3| `splunk_rce_via_splunk_secure_gateway__splunk_mobile_alerts_feature_filter`

```
### Data Source

| Name | Platform | Sourcetype | Source |
| --- | --- | --- | --- |
| [Splunk](/sources/d8a2c791-460b-4756-a8e5-ecade77b21e3) | Splunk icon [Splunk](/platform/splunk) | `'splunkd_ui_access'` | `'splunkd_ui_access.log'` |

### Macros Used

| Name | Value |
| --- | --- |
| [splunkda](https://github.com/splunk/security_content/blob/develop/macros/splunkda.yml) | `index=_internal sourcetype=splunkd_access` |
| splunk\_rce\_via\_splunk\_secure\_gateway\_\_splunk\_mobile\_alerts\_feature\_filter | `search *` |

`splunk_rce_via_splunk_secure_gateway__splunk_mobile_alerts_feature_filter` is an empty macro by default. It allows the user to filter out any results (false positives) without editing the SPL.
### Annotations

- MITRE ATT&CK

+ Kill Chain Phases

+ NIST

+ CIS

- Threat Actors

| ID | Technique | Tactic |
| --- | --- | --- |
| [T1210](https://attack.mitre.org/techniques/T1210/) | Exploitation of Remote Services | Lateral Movement |

KillChainPhase.EXPLOITAITON

NistCategory.DE\_AE

Cis18Value.CIS\_10

APT28
Dragonfly
Earth Lusca
Ember Bear
FIN7
Fox Kitten
MuddyWater
Threat Group-3390
Tonto Team
Wizard Spider
menuPass

### Default Configuration

This detection is configured by default in Splunk Enterprise Security to run with the following settings:

| Setting | Value |
| --- | --- |
| Disabled | true |
| Cron Schedule | `0 * * * *` |
| Earliest Time | `-70m@m` |
| Latest Time | `-10m@m` |
| Schedule Window | `auto` |
| Creates Risk Event | False |

This configuration file applies to all detections of type hunting.
### Implementation

This search only applies if Splunk Mobile Gateway is deployed in the vulnerable Splunk versions.

### Known False Positives

This detection does not require you to ingest any new data. The detection does require the ability to search the \_internal index. Focus of this search is "uri\_path=/servicesNS/nobody/splunk\_secure\_gateway/storage/collections/data/mobile\_alerts\*" which is the injection point.

### Associated Analytic Story

* [Splunk Vulnerabilities](/stories/splunk_vulnerabilities/)

### Risk Based Analytics (RBA)

| Risk Message | Risk Score | Impact | Confidence |
| --- | --- | --- | --- |
| Possible exploitation attempt from $clientip$ | 81 | 90 | 90 |

The Risk Score is calculated by the following formula: Risk Score = (Impact \* Confidence/100). Initial Confidence and Impact is set by the analytic author.
### References

* <https://www.splunk.com/en_us/product-security.html>

### Detection Testing

| Test Type | Status | Dataset | Source | Sourcetype |
| --- | --- | --- | --- | --- |
| Validation | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | N/A | N/A | N/A |
| Unit | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1210/splunk/splunk_rce_via_secure_gateway_splunk_mobile_alerts_feature.log) | `/opt/splunk/var/log/splunk/splunkd_access.log` | `splunkd_access` |
| Integration | â Passing | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1210/splunk/splunk_rce_via_secure_gateway_splunk_mobile_alerts_feature.log) | `/opt/splunk/var/log/splunk/splunkd_access.log` | `splunkd_access` |

Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)

---

Source: [GitHub](https://github.com/splunk/security_content/tree/develop/detections/application/splunk_rce_via_splunk_secure_gateway__splunk_mobile_alerts_feature.yml) |
Version: **3**

[Detection: Splunk RCE via Serialized Session Payload](https://research.splunk.com/application/d1d8fda6-874a-400f-82cf-dcbb59d8e4db/ "Detection: Splunk RCE via Serialized Session Payload")

[Detection: Splunk RCE via User XSLT](https://research.splunk.com/application/6cb7e011-55fb-48e3-a98d-164fa854e37e/ "Detection: Splunk RCE via User XSLT")

Â© 2005 - 2024 Splunk LLC All rights reserved.

