=== Content from plugins.trac.wordpress.org_bac05afc_20250111_102614.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwisdm-reports-for-learndash%2Ftrunk%2Fincludes%2Fadmin%2Fclass-admin-functions.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?rev=3083439 "Revision 3083439")
* Next Revision →
* [Blame](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php)

---

# [source:](/browser?order=name "Go to repository root") [wisdm-reports-for-learndash](/browser/wisdm-reports-for-learndash?order=name "View wisdm-reports-for-learndash")/[trunk](/browser/wisdm-reports-for-learndash/trunk?order=name "View trunk")/[includes](/browser/wisdm-reports-for-learndash/trunk/includes?order=name "View includes")/[admin](/browser/wisdm-reports-for-learndash/trunk/includes/admin?order=name "View admin")/[class-admin-functions.php](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?order=name "View class-admin-functions.php")

View diff against:

View revision:

| [Last change](/changeset/3119784/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php "View differences") on this file was [3119784](/changeset/3119784/ "View changeset 3119784"), checked in by stellarwp, [6 months ago](/timeline?from=2024-07-17T02%3A25%3A45Z&precision=second "See timeline at 07/17/2024 02:25:45 AM") |
| --- |
| Tag version 1.8.2.2 |
| **File size:** 18.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* This file contains the class admin functions. |
| [4](#L4) | \* |
| [5](#L5) | \* @package learndash-reports-by-wisdmlabs |
| [6](#L6) | \*/ |
| [7](#L7) |  |
| [8](#L8) | namespace WisdmReportsLearndash; |
| [9](#L9) |  |
| [10](#L10) | class Admin\_Functions { |
| [11](#L11) |  |
| [12](#L12) | protected static $instance = null; |
| [13](#L13) |  |
| [14](#L14) | /\*\* |
| [15](#L15) | \* This function has been used to create the static instance of the admin functions class. |
| [16](#L16) | \*/ |
| [17](#L17) | public static function instance() { |
| [18](#L18) | if ( is\_null( self::$instance ) ) { |
| [19](#L19) | self::$instance = new self(); |
| [20](#L20) | } |
| [21](#L21) | return self::$instance; |
| [22](#L22) | } |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* This is the constructor for the class that will instantiate all processes related to the class. |
| [26](#L26) | \*/ |
| [27](#L27) | public function \_\_construct() { |
| [28](#L28) | $this->init\_hooks(); |
| [29](#L29) | } |
| [30](#L30) |  |
| [31](#L31) | /\*\* |
| [32](#L32) | \* This method is used to add all the admin related actions and filter hooks. |
| [33](#L33) | \*/ |
| [34](#L34) | public function init\_hooks() { |
| [35](#L35) | add\_action( 'wp\_ajax\_wrld\_page\_visit', array( $this, 'update\_reporting\_page\_visit' ) ); |
| [36](#L36) | add\_action( 'wp\_ajax\_wrld\_gutenberg\_block\_visit', array( $this, 'wp\_ajax\_wrld\_gutenberg\_block\_visit' ) ); |
| [37](#L37) | add\_action( 'wp\_ajax\_wrld\_notice\_action', array( $this, 'wrld\_notice\_action' ) ); |
| [38](#L38) | add\_action( 'init', array( $this, 'wrld\_create\_patterns\_page' ), 99 ); |
| [39](#L39) | add\_action( 'init', array( $this, 'wrld\_create\_student\_patterns\_page' ), 99 ); |
| [40](#L40) | // settings page ajax actions |
| [41](#L41) | add\_action( 'wp\_ajax\_wrld\_set\_configuration', array( $this, 'wrld\_set\_configuration' ) ); |
| [42](#L42) | add\_action( 'wp\_ajax\_wrld\_update\_settings', array( $this, 'wrld\_update\_settings' ) ); |
| [43](#L43) | add\_action( 'wp\_ajax\_wrld\_exclude\_settings\_save', array( $this, 'wrld\_exclude\_settings\_save' ) ); |
| [44](#L44) | add\_action( 'wp\_ajax\_apply\_time\_tracking\_settings', array( $this, 'apply\_time\_tracking\_settings' ) ); |
| [45](#L45) | add\_action( 'wp\_ajax\_wrld\_exclude\_load\_users', array( $this, 'wrld\_exclude\_load\_users' ) ); |
| [46](#L46) | // Welcome modal |
| [47](#L47) | add\_action( 'wp\_ajax\_wrld\_welcome\_modal\_action', array( $this, 'wrld\_welcome\_modal\_action' ) ); |
| [48](#L48) | add\_action( 'wp\_ajax\_wrld\_autoupdate\_dashboard', array( $this, 'wrld\_autoupdate\_dashboard' ) ); |
| [49](#L49) | // add\_action( 'admin\_notices', array( $this, 'wrld\_pattern\_update\_notice' ) ); |
| [50](#L50) | } |
| [51](#L51) |  |
| [52](#L52) | public static function wp\_ajax\_wrld\_gutenberg\_block\_visit() { |
| [53](#L53) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [54](#L54) |  |
| [55](#L55) | if ( ! wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ) ) { |
| [56](#L56) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [60](#L60) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [61](#L61) | } |
| [62](#L62) |  |
| [63](#L63) | $option\_key = isset( $\_REQUEST['option\_key'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['option\_key'] ) ) : null; |
| [64](#L64) |  |
| [65](#L65) | if ( empty( $option\_key ) ) { |
| [66](#L66) | wp\_send\_json\_error( esc\_html\_\_( 'Invalid option key.', 'learndash-reports-by-wisdmlabs' ) ); |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | update\_option( $option\_key, true ); |
| [70](#L70) |  |
| [71](#L71) | wp\_send\_json\_success( |
| [72](#L72) | array( |
| [73](#L73) | 'updated' => $option\_key, |
| [74](#L74) | ) |
| [75](#L75) | ); |
| [76](#L76) | } |
| [77](#L77) |  |
| [78](#L78) | public function wrld\_pattern\_update\_notice() { |
| [79](#L79) | // phpcs:ignore WordPress.Security.NonceVerification.Recommended -- Data is not used for action or DB query. |
| [80](#L80) | if ( ! isset( $\_GET['updated\_pattern'] ) ) { |
| [81](#L81) | return; |
| [82](#L82) | } |
| [83](#L83) | echo "<div class='notice notice-success'> |
| [84](#L84) | <p>Dashboard Page successfully updated.</p> |
| [85](#L85) | </div>"; |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | public function wrld\_autoupdate\_dashboard() { |
| [89](#L89) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [90](#L90) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [91](#L91) | if ( ! $nonce\_valid ) { |
| [92](#L92) | wp\_send\_json\_error( |
| [93](#L93) | array( |
| [94](#L94) | 'success' => true, |
| [95](#L95) | 'message' => \_\_( |
| [96](#L96) | 'Nonce verification failed', |
| [97](#L97) | 'learndash-reports-by-wisdmlabs' |
| [98](#L98) | ), |
| [99](#L99) | ) |
| [100](#L100) | ); |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [104](#L104) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [105](#L105) | } |
| [106](#L106) |  |
| [107](#L107) | global $wrld\_pattern; |
| [108](#L108) | $reports\_page = get\_option( 'ldrp\_reporting\_page', false ); |
| [109](#L109) | $data         = array( |
| [110](#L110) | 'ID'           => $reports\_page, |
| [111](#L111) | 'post\_content' => $wrld\_pattern, |
| [112](#L112) | ); |
| [113](#L113) | wp\_update\_post( $data ); |
| [114](#L114) | wp\_send\_json\_success( |
| [115](#L115) | array( |
| [116](#L116) | 'url' => add\_query\_arg( |
| [117](#L117) | array( |
| [118](#L118) | 'updated\_pattern' => 1, |
| [119](#L119) | 'dla\_op'          => true, |
| [120](#L120) | 'dla\_oq'          => true, |
| [121](#L121) | ), |
| [122](#L122) | get\_permalink( $reports\_page ) |
| [123](#L123) | ), |
| [124](#L124) | ) |
| [125](#L125) | ); |
| [126](#L126) | die(); |
| [127](#L127) | } |
| [128](#L128) |  |
| [129](#L129) | /\*\* |
| [130](#L130) | \* This action is hooked to the ajax callback action 'wp\_ajax\_wrld\_page\_visit', |
| [131](#L131) | \* on called verifies if the request is from the correct source & update teh value for the |
| [132](#L132) | \* option 'wrld\_reporting\_page\_visited'. |
| [133](#L133) | \*/ |
| [134](#L134) | public static function update\_reporting\_page\_visit() { |
| [135](#L135) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [136](#L136) | if ( wp\_verify\_nonce( $nonce, 'reports-firrst-install-modal' ) ) { |
| [137](#L137) | // update\_option( 'wrld\_reporting\_page\_visited', 2 ); |
| [138](#L138) | wp\_send\_json\_success(); |
| [139](#L139) | } |
| [140](#L140) | wp\_send\_json\_error(); |
| [141](#L141) | } |
| [142](#L142) |  |
| [143](#L143) |  |
| [144](#L144) | /\*\* |
| [145](#L145) | \* This action is hooked to the ajax callback action 'wp\_ajax\_wrld\_notice\_action', |
| [146](#L146) | \* on called verifies if the request is from the correct source & update the value for the |
| [147](#L147) | \* option 'wrld\_last\_skipped\_on'. |
| [148](#L148) | \*/ |
| [149](#L149) | public static function wrld\_notice\_action() { |
| [150](#L150) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [151](#L151) | if ( wp\_verify\_nonce( $nonce, 'wrld-review-notice' ) ) { |
| [152](#L152) | $user\_action = sanitize\_text\_field( wp\_unslash( $\_REQUEST['user\_action'] ) ); |
| [153](#L153) | switch ( $user\_action ) { |
| [154](#L154) | case 'wisdm-reports-for-ld-remind-later': |
| [155](#L155) | case 'wisdm-reports-for-ld-post-review': |
| [156](#L156) | case 'close': |
| [157](#L157) | update\_option( 'wrld\_last\_skipped\_on', time() ); |
| [158](#L158) | break; |
| [159](#L159) | default: |
| [160](#L160) | update\_option( 'ld-reports-review-dismissed', time() ); |
| [161](#L161) | break; |
| [162](#L162) | } |
| [163](#L163) | wp\_send\_json\_success(); |
| [164](#L164) | } |
| [165](#L165) | wp\_send\_json\_error(); |
| [166](#L166) | } |
| [167](#L167) |  |
| [168](#L168) | public function show\_wisdm\_reports\_submenu() { |
| [169](#L169) | ?> |
| [170](#L170) | <div class="wrap"> |
| [171](#L171) | <h1><?php esc\_html\_e( 'Reports', 'learndash-reports-by-wisdmlabs' ); ?></h1> |
| [172](#L172) | <?php |
| [173](#L173) | $dashboard\_id = get\_option( 'ldrp\_reporting\_page', false ); |
| [174](#L174) | if ( ! $dashboard\_id || 'publish' !== get\_post\_status( $dashboard\_id ) ) { |
| [175](#L175) | ?> |
| [176](#L176) | <p><?php esc\_html\_e( 'The page seems to have been deleted/removed. Please click on the link below to create the page manually.', 'learndash-reports-by-wisdmlabs' ); ?> |
| [177](#L177) | </p> |
| [178](#L178) | <a |
| [179](#L179) | href="<?php echo esc\_attr( add\_query\_arg( array( 'create\_wisdm\_reports' => true ) ) ); ?>"><?php esc\_html\_e( 'Create Reports Dashboard', 'learndash-reports-by-wisdmlabs' ); ?></a> |
| [180](#L180) | <?php |
| [181](#L181) | } else { |
| [182](#L182) | ?> |
| [183](#L183) | <p><a class="primary-button primary-btn components-button is-primary" |
| [184](#L184) | href="<?php echo esc\_url( get\_permalink( $dashboard\_id ) ); ?>" target="\_blank" |
| [185](#L185) | style="background:#007cba;color:#fff;text-decoration:none;text-shadow:none;outline:1px solid transparent;padding:6px 12px;border-radius:2px;"><?php esc\_html\_e( 'Launch Reports Dashboard', 'learndash-reports-by-wisdmlabs' ); ?></a> |
| [186](#L186) | </p> |
| [187](#L187) | <?php |
| [188](#L188) | } |
| [189](#L189) | ?> |
| [190](#L190) | </div> |
| [191](#L191) | <?php |
| [192](#L192) | } |
| [193](#L193) |  |
| [194](#L194) | /\*\* |
| [195](#L195) | \* This function creates the page with the default WRLD pattern when a get parameter 'create\_wisdm\_reports' is set. |
| [196](#L196) | \*/ |
| [197](#L197) | public function wrld\_create\_patterns\_page() { |
| [198](#L198) | $new\_page\_creation = filter\_input( INPUT\_GET, 'create\_wisdm\_reports', FILTER\_VALIDATE\_BOOLEAN ); |
| [199](#L199) | $created\_page      = get\_option( 'ldrp\_reporting\_page', false ); |
| [200](#L200) |  |
| [201](#L201) | if ( $created\_page && 'publish' !== get\_post\_status( $created\_page ) ) { |
| [202](#L202) | if ( ! empty( $new\_page\_creation ) ) { |
| [203](#L203) | wrld\_create\_patterns\_page( true ); |
| [204](#L204) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_page\_creation\_notice' ); |
| [205](#L205) | } |
| [206](#L206) | } elseif ( false == $created\_page ) { |
| [207](#L207) | wrld\_create\_patterns\_page( false ); |
| [208](#L208) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_page\_creation\_notice' ); |
| [209](#L209) | } |
| [210](#L210) | } |
| [211](#L211) | /\*\* |
| [212](#L212) | \* This function creates the page with the default WRLD pattern when a get parameter 'create\_wisdm\_reports' is set. |
| [213](#L213) | \*/ |
| [214](#L214) | public function wrld\_create\_student\_patterns\_page() { |
| [215](#L215) | $new\_page\_creation = filter\_input( INPUT\_GET, 'create\_student\_reports', FILTER\_VALIDATE\_BOOLEAN ); |
| [216](#L216) | $created\_page      = get\_option( 'ldrp\_student\_page', false ); |
| [217](#L217) |  |
| [218](#L218) | if ( $created\_page && 'publish' !== get\_post\_status( $created\_page ) ) { |
| [219](#L219) | if ( ! empty( $new\_page\_creation ) ) { |
| [220](#L220) | wrld\_create\_student\_patterns\_page( true ); |
| [221](#L221) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_student\_page\_creation\_notice' ); |
| [222](#L222) | } |
| [223](#L223) | } elseif ( false == $created\_page ) { |
| [224](#L224) | wrld\_create\_student\_patterns\_page( false ); |
| [225](#L225) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_student\_page\_creation\_notice' ); |
| [226](#L226) | } |
| [227](#L227) | } |
| [228](#L228) |  |
| [229](#L229) | /\*\* |
| [230](#L230) | \* The function checks if the plugin specified is installed on the website. |
| [231](#L231) | \* - Currently works only for the WordPress single site. |
| [232](#L232) | \* |
| [233](#L233) | \* @param $plugin\_slug plugin path and plugin file name, ex : learndash-reports-pro/learndash-reports-pro.php. |
| [234](#L234) | \*/ |
| [235](#L235) | public static function is\_plugin\_installed( $plugin\_slug ) { |
| [236](#L236) | if ( empty( $plugin\_slug ) ) { |
| [237](#L237) | return false; |
| [238](#L238) | } |
| [239](#L239) |  |
| [240](#L240) | // Check if needed functions exists - if not, require them |
| [241](#L241) | if ( ! function\_exists( 'get\_plugins' ) || ! function\_exists( 'is\_plugin\_active' ) ) { |
| [242](#L242) | require\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
| [243](#L243) | } |
| [244](#L244) |  |
| [245](#L245) | $installed\_plugins = get\_plugins(); |
| [246](#L246) | return array\_key\_exists( $plugin\_slug, $installed\_plugins ) || in\_array( $plugin\_slug, $installed\_plugins, true ); |
| [247](#L247) | } |
| [248](#L248) |  |
| [249](#L249) | /\*\* |
| [250](#L250) | \* Shows admin a notice on the admin dashboard. |
| [251](#L251) | \*/ |
| [252](#L252) | public static function report\_page\_creation\_notice() { |
| [253](#L253) | echo '<div class="notice notice-success is-dismissible"><p>'; |
| [254](#L254) | echo esc\_html\_\_( 'Successfully created Reports For LearnDash page', 'learndash-reports-by-wisdmlabs' ); |
| [255](#L255) | echo '</p></div>'; |
| [256](#L256) | } |
| [257](#L257) |  |
| [258](#L258) | /\*\* |
| [259](#L259) | \* Shows admin a notice on the admin dashboard. |
| [260](#L260) | \*/ |
| [261](#L261) | public static function report\_student\_page\_creation\_notice() { |
| [262](#L262) | echo '<div class="notice notice-success is-dismissible"><p>'; |
| [263](#L263) | echo esc\_html\_\_( 'Successfully created Reports For LearnDash Student Quiz Reports page', 'learndash-reports-by-wisdmlabs' ); |
| [264](#L264) | echo '</p></div>'; |
| [265](#L265) | } |
| [266](#L266) |  |
| [267](#L267) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [268](#L268) | \* Actions for admin dashboard settings \* |
| [269](#L269) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [270](#L270) |  |
| [271](#L271) | /\*\* |
| [272](#L272) | \* Skip license activation. |
| [273](#L273) | \* |
| [274](#L274) | \* @deprecated 1.8.2 This method is no longer used. |
| [275](#L275) | \*/ |
| [276](#L276) | public static function wrld\_skip\_license\_activation() { |
| [277](#L277) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [278](#L278) | } |
| [279](#L279) |  |
| [280](#L280) | public static function wrld\_exclude\_settings\_save() { |
| [281](#L281) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [282](#L282) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [283](#L283) | if ( ! $nonce\_valid ) { |
| [284](#L284) | wp\_send\_json\_error( |
| [285](#L285) | array( |
| [286](#L286) | 'success' => true, |
| [287](#L287) | 'message' => \_\_( |
| [288](#L288) | 'Nonce verification failed', |
| [289](#L289) | 'learndash-reports-by-wisdmlabs' |
| [290](#L290) | ), |
| [291](#L291) | ) |
| [292](#L292) | ); |
| [293](#L293) | } |
| [294](#L294) |  |
| [295](#L295) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [296](#L296) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [297](#L297) | } |
| [298](#L298) |  |
| [299](#L299) | $type  = filter\_input( INPUT\_POST, 'type', FILTER\_SANITIZE\_STRING ); |
| [300](#L300) | $value = filter\_input( INPUT\_POST, 'value', FILTER\_DEFAULT, FILTER\_REQUIRE\_ARRAY ); |
| [301](#L301) |  |
| [302](#L302) | update\_option( 'exclude\_' . $type, $value ); |
| [303](#L303) |  |
| [304](#L304) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [305](#L305) | } |
| [306](#L306) |  |
| [307](#L307) | public static function apply\_time\_tracking\_settings() { |
| [308](#L308) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [309](#L309) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [310](#L310) | if ( ! $nonce\_valid ) { |
| [311](#L311) | wp\_send\_json\_error( |
| [312](#L312) | array( |
| [313](#L313) | 'success' => true, |
| [314](#L314) | 'message' => \_\_( |
| [315](#L315) | 'Nonce verification failed', |
| [316](#L316) | 'learndash-reports-by-wisdmlabs' |
| [317](#L317) | ), |
| [318](#L318) | ) |
| [319](#L319) | ); |
| [320](#L320) | } |
| [321](#L321) |  |
| [322](#L322) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [323](#L323) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [324](#L324) | } |
| [325](#L325) |  |
| [326](#L326) | $status   = filter\_input( INPUT\_POST, 'status', FILTER\_SANITIZE\_STRING ); |
| [327](#L327) | $timer    = filter\_input( INPUT\_POST, 'timeout', FILTER\_SANITIZE\_NUMBER\_INT ); |
| [328](#L328) | $message  = filter\_input( INPUT\_POST, 'message', FILTER\_SANITIZE\_STRING ); |
| [329](#L329) | $btnlabel = filter\_input( INPUT\_POST, 'btnlabel', FILTER\_SANITIZE\_STRING ); |
| [330](#L330) |  |
| [331](#L331) | if ( ! empty( $timer ) ) { |
| [332](#L332) | update\_option( 'wrld\_time\_tracking\_timer', $timer ); |
| [333](#L333) | } |
| [334](#L334) | if ( ! empty( $message ) ) { |
| [335](#L335) | update\_option( 'wrld\_time\_tracking\_message', $message ); |
| [336](#L336) | } |
| [337](#L337) | if ( ! empty( $btnlabel ) ) { |
| [338](#L338) | update\_option( 'wrld\_time\_tracking\_btnlabel', $btnlabel ); |
| [339](#L339) | } |
| [340](#L340) | if ( ! empty( $status ) ) { |
| [341](#L341) | $all\_updates  = get\_option( 'wrld\_time\_tracking\_log', false ); |
| [342](#L342) | $current\_time = current\_time( 'timestamp' ); |
| [343](#L343) | if ( ! empty( $all\_updates ) ) { |
| [344](#L344) | $all\_updates[] = $current\_time; |
| [345](#L345) | } else { |
| [346](#L346) | $all\_updates = array( $current\_time ); |
| [347](#L347) | } |
| [348](#L348) | update\_option( 'wrld\_time\_tracking\_status', $status ); |
| [349](#L349) | update\_option( 'wrld\_time\_tracking\_last\_update', $current\_time ); |
| [350](#L350) | update\_option( 'wrld\_time\_tracking\_log', $all\_updates ); |
| [351](#L351) | wp\_send\_json\_success( |
| [352](#L352) | array( |
| [353](#L353) | 'success' => true, |
| [354](#L354) | 'time'    => date\_i18n( |
| [355](#L355) | 'Y-m-d H:i:s', |
| [356](#L356) | $current\_time |
| [357](#L357) | ), |
| [358](#L358) | ) |
| [359](#L359) | ); |
| [360](#L360) | } |
| [361](#L361) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [362](#L362) |  |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | public static function wrld\_exclude\_load\_users() { |
| [366](#L366) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [367](#L367) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [368](#L368) | if ( ! $nonce\_valid ) { |
| [369](#L369) | wp\_send\_json\_error( |
| [370](#L370) | array( |
| [371](#L371) | 'success' => true, |
| [372](#L372) | 'message' => \_\_( |
| [373](#L373) | 'Nonce verification failed', |
| [374](#L374) | 'learndash-reports-by-wisdmlabs' |
| [375](#L375) | ), |
| [376](#L376) | ) |
| [377](#L377) | ); |
| [378](#L378) | } |
| [379](#L379) |  |
| [380](#L380) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [381](#L381) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [382](#L382) | } |
| [383](#L383) |  |
| [384](#L384) | $page   = filter\_input( INPUT\_POST, 'page', FILTER\_VALIDATE\_INT ); |
| [385](#L385) | $search = filter\_input( INPUT\_POST, 'search', FILTER\_SANITIZE\_STRING ); |
| [386](#L386) |  |
| [387](#L387) | if ( empty( $page ) ) { |
| [388](#L388) | $page = 1; |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | $args = array( |
| [392](#L392) | 'number'         => 10, |
| [393](#L393) | 'paged'          => $page, |
| [394](#L394) | 'search\_columns' => array( |
| [395](#L395) | 'user\_login', |
| [396](#L396) | 'user\_email', |
| [397](#L397) | 'user\_nicename', |
| [398](#L398) | 'display\_name', |
| [399](#L399) | ), |
| [400](#L400) | 'fields'         => array( |
| [401](#L401) | 'ID', |
| [402](#L402) | 'display\_name', |
| [403](#L403) | ), |
| [404](#L404) | ); |
| [405](#L405) |  |
| [406](#L406) | if ( ! empty( $search ) ) { |
| [407](#L407) | $args['search'] = '\*' . $search . '\*'; |
| [408](#L408) | } |
| [409](#L409) |  |
| [410](#L410) | $users = get\_users( $args ); |
| [411](#L411) | if ( empty( $users ) ) { |
| [412](#L412) | wp\_send\_json\_error(); |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | wp\_send\_json\_success( |
| [416](#L416) | array( |
| [417](#L417) | 'success' => true, |
| [418](#L418) | 'data'    => $users, |
| [419](#L419) | ) |
| [420](#L420) | ); |
| [421](#L421) | } |
| [422](#L422) |  |
| [423](#L423) | /\*\* |
| [424](#L424) | \* A function hooked to the ajax action wrld\_license\_activate, |
| [425](#L425) | \* resposible for initiating the activation request for the |
| [426](#L426) | \* reports pro plugin license key. |
| [427](#L427) | \* |
| [428](#L428) | \* @since 1.2.0 |
| [429](#L429) | \* @deprecated 1.8.2 This method is no longer used. |
| [430](#L430) | \*/ |
| [431](#L431) | public static function wrld\_license\_activate() { |
| [432](#L432) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [433](#L433) | } |
| [434](#L434) |  |
| [435](#L435) | /\*\* |
| [436](#L436) | \* A function hooked to the ajax action wrld\_license\_deactivate, |
| [437](#L437) | \* resposible for initiating the deactivation request for the |
| [438](#L438) | \* reports pro plugin license key. |
| [439](#L439) | \* |
| [440](#L440) | \* @since 1.2.0 |
| [441](#L441) | \* @deprecated 1.8.2 This method is no longer used. |
| [442](#L442) | \*/ |
| [443](#L443) | public static function wrld\_license\_deactivate() { |
| [444](#L444) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [445](#L445) | } |
| [446](#L446) |  |
| [447](#L447) | /\*\* |
| [448](#L448) | \* A function hooked to the ajax action wrld\_set\_configuration, |
| [449](#L449) | \* resposible for setting up the configuration which enables inclusion |
| [450](#L450) | \* of the reports page link in the primary menu. |
| [451](#L451) | \* |
| [452](#L452) | \* @since 1.2.0 |
| [453](#L453) | \*/ |
| [454](#L454) | public static function wrld\_set\_configuration() { |
| [455](#L455) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [456](#L456) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [457](#L457) | if ( ! $nonce\_valid ) { |
| [458](#L458) | wp\_send\_json\_error( |
| [459](#L459) | array( |
| [460](#L460) | 'success' => true, |
| [461](#L461) | 'message' => \_\_( |
| [462](#L462) | 'Nonce verification failed', |
| [463](#L463) | 'learndash-reports-by-wisdmlabs' |
| [464](#L464) | ), |
| [465](#L465) | ) |
| [466](#L466) | ); |
| [467](#L467) | } |
| [468](#L468) |  |
| [469](#L469) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [470](#L470) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [471](#L471) | } |
| [472](#L472) |  |
| [473](#L473) | $settings\_data = get\_option( 'wrld\_settings', array() ); |
| [474](#L474) | if ( isset( $\_REQUEST['add\_in\_menu'] ) ) { |
| [475](#L475) | $settings\_data['wrld-menu-config-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_in\_menu'] ) ); |
| [476](#L476) | } |
| [477](#L477) | if ( isset( $\_REQUEST['add\_student\_in\_menu'] ) ) { |
| [478](#L478) | $settings\_data['wrld-menu-student-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_student\_in\_menu'] ) ); |
| [479](#L479) | } |
| [480](#L480) | update\_option( 'wrld\_settings', $settings\_data ); |
| [481](#L481) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [482](#L482) | } |
| [483](#L483) |  |
| [484](#L484) | /\*\* |
| [485](#L485) | \* A function hooked to the ajax action wrld\_update\_settings, |
| [486](#L486) | \* resposible for setting up the configuration which enables inclusion |
| [487](#L487) | \* of the reports page link in the primary menu. |
| [488](#L488) | \* |
| [489](#L489) | \* @since 1.2.0 |
| [490](#L490) | \*/ |
| [491](#L491) | public static function wrld\_update\_settings() { |
| [492](#L492) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [493](#L493) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [494](#L494) | if ( ! $nonce\_valid ) { |
| [495](#L495) | wp\_send\_json\_error( |
| [496](#L496) | array( |
| [497](#L497) | 'success' => false, |
| [498](#L498) | 'message' => \_\_( |
| [499](#L499) | 'Nonce verification failed', |
| [500](#L500) | 'learndash-reports-by-wisdmlabs' |
| [501](#L501) | ), |
| [502](#L502) | ) |
| [503](#L503) | ); |
| [504](#L504) | } |
| [505](#L505) |  |
| [506](#L506) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [507](#L507) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [508](#L508) | } |
| [509](#L509) |  |
| [510](#L510) | $settings\_data = get\_option( 'wrld\_settings', array() ); |
| [511](#L511) | if ( isset( $\_REQUEST['access\_to\_group\_leader'] ) ) { |
| [512](#L512) | $access\_for\_group\_leader = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['access\_to\_group\_leader'] ) ); |
| [513](#L513) | } |
| [514](#L514) | if ( isset( $\_REQUEST['access\_to\_wdm\_instructor'] ) ) { |
| [515](#L515) | $access\_for\_wdm\_instructor = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['access\_to\_wdm\_instructor'] ) ); |
| [516](#L516) | } |
| [517](#L517) | if ( isset( $\_REQUEST['add\_in\_menu'] ) ) { |
| [518](#L518) | $settings\_data['wrld-menu-config-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_in\_menu'] ) ); |
| [519](#L519) | } |
| [520](#L520) | if ( isset( $\_REQUEST['add\_student\_in\_menu'] ) ) { |
| [521](#L521) | $settings\_data['wrld-menu-student-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_student\_in\_menu'] ) ); |
| [522](#L522) | } |
| [523](#L523) |  |
| [524](#L524) | if ( isset( $access\_for\_group\_leader ) || isset( $access\_for\_wdm\_instructor ) ) { |
| [525](#L525) | $settings\_data['dashboard-access-roles'] = array( |
| [526](#L526) | 'group\_leader'   => $access\_for\_group\_leader, |
| [527](#L527) | 'wdm\_instructor' => $access\_for\_wdm\_instructor, |
| [528](#L528) | ); |
| [529](#L529) | } |
| [530](#L530) | update\_option( 'wrld\_settings', $settings\_data ); |
| [531](#L531) | wp\_send\_json\_success( array( 'settings\_data' => $settings\_data ) ); |
| [532](#L532) |  |
| [533](#L533) | } |
| [534](#L534) |  |
| [535](#L535) | /\*\* |
| [536](#L536) | \* @deprecated 1.8.2 This method is no longer used. |
| [537](#L537) | \*/ |
| [538](#L538) | public function wrld\_license\_page\_visit() { |
| [539](#L539) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [540](#L540) | } |
| [541](#L541) |  |
| [542](#L542) | /\*\* |
| [543](#L543) | \* Add the Helpscout Beacon script on the Reports Settings backend pages. |
| [544](#L544) | \* Callback to action hook 'ldgr\_helpscout\_beacon'. |
| [545](#L545) | \* |
| [546](#L546) | \* @since 4.9.10 |
| [547](#L547) | \* @deprecated 1.8.2 This method is no longer used. |
| [548](#L548) | \*/ |
| [549](#L549) | public function wrld\_add\_beacon\_helpscout\_script() { |
| [550](#L550) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [551](#L551) | } |
| [552](#L552) |  |
| [553](#L553) | /\*\* |
| [554](#L554) | \* Calling function to the helpscout beacon. |
| [555](#L555) | \* Callback to action hook 'wrld\_helpscout\_beacon'. |
| [556](#L556) | \* |
| [557](#L557) | \* @since 4.9.10 |
| [558](#L558) | \* @deprecated 1.8.2 This method is no longer used. |
| [559](#L559) | \*/ |
| [560](#L560) | public function wrld\_load\_beacon\_helpscout() { |
| [561](#L561) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [562](#L562) | } |
| [563](#L563) |  |
| [564](#L564) | } |
| [565](#L565) |  |
| [566](#L566) | \WisdmReportsLearndash\Admin\_Functions::instance(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?format=txt)
* [Original Format](/export/3220658/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_d9db2968_20250111_102616.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# LearnDash LMS - Reports Free <= 1.8.2.1 - Missing Authorization to Plugin Settings Update

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   LearnDash LMS - Reports Free <= 1.8.2.1 - Missing Authorization to Plugin Settings Update

5.4

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L)

| CVE | [CVE-2024-5648](https://www.cve.org/CVERecord?id=CVE-2024-5648) |
| --- | --- |
| CVSS | 5.4 (Medium) |
| Publicly Published | July 8, 2024 |
| Last Updated | August 1, 2024 |
| Researcher | [Lucio Sá](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lucio-sa) |

### Description

The LearnDash LMS – Reports plugin for WordPress is vulnerable to unauthorized modification of data due to a missing capability check on several functions (i.e. wrld\_set\_configuration, wrld\_exclude\_settings\_save, apply\_time\_tracking\_settings, wp\_ajax\_wrld\_gutenberg\_block\_visit, etc..) in all versions up to, and including, 1.8.2.1. This makes it possible for authenticated attackers, with subscriber-level access and above, to update various plugin settings.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php#L52)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php#L261)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php#L284)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php#L423)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php#L455)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3119784/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwisdm-reports-for-learndash%2Flearndash-lms-reports-free-182-missing-authorization-to-plugin-settings-update&t=LearnDash%20LMS%20-%20Reports%20Free%20%3C%3D%201.8.2.1%20-%20Missing%20Authorization%20to%20Plugin%20Settings%20Update "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwisdm-reports-for-learndash%2Flearndash-lms-reports-free-182-missing-authorization-to-plugin-settings-update&text=LearnDash%20LMS%20-%20Reports%20Free%20%3C%3D%201.8.2.1%20-%20Missing%20Authorization%20to%20Plugin%20Settings%20Update "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwisdm-reports-for-learndash%2Flearndash-lms-reports-free-182-missing-authorization-to-plugin-settings-update "LinkedIn")
Email

## Vulnerability Details for LearnDash LMS – Reports

#### [LearnDash LMS – Reports](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wisdm-reports-for-learndash)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wisdm-reports-for-learndash [(view on wordpress.org)](https://wordpress.org/plugins/wisdm-reports-for-learndash) |
| Patched? | Yes |
| Remediation | Update to version 1.8.2.2, or a newer patched version |
| Affected Version | * <= 1.8.2.1 |
| Patched Version | * 1.8.2.2 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_fe205595_20250111_102615.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwisdm-reports-for-learndash%2Ftrunk%2Fincludes%2Fadmin%2Fclass-admin-functions.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?rev=3083439 "Revision 3083439")
* Next Revision →
* [Blame](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php)

---

# [source:](/browser?order=name "Go to repository root") [wisdm-reports-for-learndash](/browser/wisdm-reports-for-learndash?order=name "View wisdm-reports-for-learndash")/[trunk](/browser/wisdm-reports-for-learndash/trunk?order=name "View trunk")/[includes](/browser/wisdm-reports-for-learndash/trunk/includes?order=name "View includes")/[admin](/browser/wisdm-reports-for-learndash/trunk/includes/admin?order=name "View admin")/[class-admin-functions.php](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?order=name "View class-admin-functions.php")

View diff against:

View revision:

| [Last change](/changeset/3119784/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php "View differences") on this file was [3119784](/changeset/3119784/ "View changeset 3119784"), checked in by stellarwp, [6 months ago](/timeline?from=2024-07-17T02%3A25%3A45Z&precision=second "See timeline at 07/17/2024 02:25:45 AM") |
| --- |
| Tag version 1.8.2.2 |
| **File size:** 18.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* This file contains the class admin functions. |
| [4](#L4) | \* |
| [5](#L5) | \* @package learndash-reports-by-wisdmlabs |
| [6](#L6) | \*/ |
| [7](#L7) |  |
| [8](#L8) | namespace WisdmReportsLearndash; |
| [9](#L9) |  |
| [10](#L10) | class Admin\_Functions { |
| [11](#L11) |  |
| [12](#L12) | protected static $instance = null; |
| [13](#L13) |  |
| [14](#L14) | /\*\* |
| [15](#L15) | \* This function has been used to create the static instance of the admin functions class. |
| [16](#L16) | \*/ |
| [17](#L17) | public static function instance() { |
| [18](#L18) | if ( is\_null( self::$instance ) ) { |
| [19](#L19) | self::$instance = new self(); |
| [20](#L20) | } |
| [21](#L21) | return self::$instance; |
| [22](#L22) | } |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* This is the constructor for the class that will instantiate all processes related to the class. |
| [26](#L26) | \*/ |
| [27](#L27) | public function \_\_construct() { |
| [28](#L28) | $this->init\_hooks(); |
| [29](#L29) | } |
| [30](#L30) |  |
| [31](#L31) | /\*\* |
| [32](#L32) | \* This method is used to add all the admin related actions and filter hooks. |
| [33](#L33) | \*/ |
| [34](#L34) | public function init\_hooks() { |
| [35](#L35) | add\_action( 'wp\_ajax\_wrld\_page\_visit', array( $this, 'update\_reporting\_page\_visit' ) ); |
| [36](#L36) | add\_action( 'wp\_ajax\_wrld\_gutenberg\_block\_visit', array( $this, 'wp\_ajax\_wrld\_gutenberg\_block\_visit' ) ); |
| [37](#L37) | add\_action( 'wp\_ajax\_wrld\_notice\_action', array( $this, 'wrld\_notice\_action' ) ); |
| [38](#L38) | add\_action( 'init', array( $this, 'wrld\_create\_patterns\_page' ), 99 ); |
| [39](#L39) | add\_action( 'init', array( $this, 'wrld\_create\_student\_patterns\_page' ), 99 ); |
| [40](#L40) | // settings page ajax actions |
| [41](#L41) | add\_action( 'wp\_ajax\_wrld\_set\_configuration', array( $this, 'wrld\_set\_configuration' ) ); |
| [42](#L42) | add\_action( 'wp\_ajax\_wrld\_update\_settings', array( $this, 'wrld\_update\_settings' ) ); |
| [43](#L43) | add\_action( 'wp\_ajax\_wrld\_exclude\_settings\_save', array( $this, 'wrld\_exclude\_settings\_save' ) ); |
| [44](#L44) | add\_action( 'wp\_ajax\_apply\_time\_tracking\_settings', array( $this, 'apply\_time\_tracking\_settings' ) ); |
| [45](#L45) | add\_action( 'wp\_ajax\_wrld\_exclude\_load\_users', array( $this, 'wrld\_exclude\_load\_users' ) ); |
| [46](#L46) | // Welcome modal |
| [47](#L47) | add\_action( 'wp\_ajax\_wrld\_welcome\_modal\_action', array( $this, 'wrld\_welcome\_modal\_action' ) ); |
| [48](#L48) | add\_action( 'wp\_ajax\_wrld\_autoupdate\_dashboard', array( $this, 'wrld\_autoupdate\_dashboard' ) ); |
| [49](#L49) | // add\_action( 'admin\_notices', array( $this, 'wrld\_pattern\_update\_notice' ) ); |
| [50](#L50) | } |
| [51](#L51) |  |
| [52](#L52) | public static function wp\_ajax\_wrld\_gutenberg\_block\_visit() { |
| [53](#L53) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [54](#L54) |  |
| [55](#L55) | if ( ! wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ) ) { |
| [56](#L56) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [60](#L60) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [61](#L61) | } |
| [62](#L62) |  |
| [63](#L63) | $option\_key = isset( $\_REQUEST['option\_key'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['option\_key'] ) ) : null; |
| [64](#L64) |  |
| [65](#L65) | if ( empty( $option\_key ) ) { |
| [66](#L66) | wp\_send\_json\_error( esc\_html\_\_( 'Invalid option key.', 'learndash-reports-by-wisdmlabs' ) ); |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | update\_option( $option\_key, true ); |
| [70](#L70) |  |
| [71](#L71) | wp\_send\_json\_success( |
| [72](#L72) | array( |
| [73](#L73) | 'updated' => $option\_key, |
| [74](#L74) | ) |
| [75](#L75) | ); |
| [76](#L76) | } |
| [77](#L77) |  |
| [78](#L78) | public function wrld\_pattern\_update\_notice() { |
| [79](#L79) | // phpcs:ignore WordPress.Security.NonceVerification.Recommended -- Data is not used for action or DB query. |
| [80](#L80) | if ( ! isset( $\_GET['updated\_pattern'] ) ) { |
| [81](#L81) | return; |
| [82](#L82) | } |
| [83](#L83) | echo "<div class='notice notice-success'> |
| [84](#L84) | <p>Dashboard Page successfully updated.</p> |
| [85](#L85) | </div>"; |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | public function wrld\_autoupdate\_dashboard() { |
| [89](#L89) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [90](#L90) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [91](#L91) | if ( ! $nonce\_valid ) { |
| [92](#L92) | wp\_send\_json\_error( |
| [93](#L93) | array( |
| [94](#L94) | 'success' => true, |
| [95](#L95) | 'message' => \_\_( |
| [96](#L96) | 'Nonce verification failed', |
| [97](#L97) | 'learndash-reports-by-wisdmlabs' |
| [98](#L98) | ), |
| [99](#L99) | ) |
| [100](#L100) | ); |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [104](#L104) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [105](#L105) | } |
| [106](#L106) |  |
| [107](#L107) | global $wrld\_pattern; |
| [108](#L108) | $reports\_page = get\_option( 'ldrp\_reporting\_page', false ); |
| [109](#L109) | $data         = array( |
| [110](#L110) | 'ID'           => $reports\_page, |
| [111](#L111) | 'post\_content' => $wrld\_pattern, |
| [112](#L112) | ); |
| [113](#L113) | wp\_update\_post( $data ); |
| [114](#L114) | wp\_send\_json\_success( |
| [115](#L115) | array( |
| [116](#L116) | 'url' => add\_query\_arg( |
| [117](#L117) | array( |
| [118](#L118) | 'updated\_pattern' => 1, |
| [119](#L119) | 'dla\_op'          => true, |
| [120](#L120) | 'dla\_oq'          => true, |
| [121](#L121) | ), |
| [122](#L122) | get\_permalink( $reports\_page ) |
| [123](#L123) | ), |
| [124](#L124) | ) |
| [125](#L125) | ); |
| [126](#L126) | die(); |
| [127](#L127) | } |
| [128](#L128) |  |
| [129](#L129) | /\*\* |
| [130](#L130) | \* This action is hooked to the ajax callback action 'wp\_ajax\_wrld\_page\_visit', |
| [131](#L131) | \* on called verifies if the request is from the correct source & update teh value for the |
| [132](#L132) | \* option 'wrld\_reporting\_page\_visited'. |
| [133](#L133) | \*/ |
| [134](#L134) | public static function update\_reporting\_page\_visit() { |
| [135](#L135) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [136](#L136) | if ( wp\_verify\_nonce( $nonce, 'reports-firrst-install-modal' ) ) { |
| [137](#L137) | // update\_option( 'wrld\_reporting\_page\_visited', 2 ); |
| [138](#L138) | wp\_send\_json\_success(); |
| [139](#L139) | } |
| [140](#L140) | wp\_send\_json\_error(); |
| [141](#L141) | } |
| [142](#L142) |  |
| [143](#L143) |  |
| [144](#L144) | /\*\* |
| [145](#L145) | \* This action is hooked to the ajax callback action 'wp\_ajax\_wrld\_notice\_action', |
| [146](#L146) | \* on called verifies if the request is from the correct source & update the value for the |
| [147](#L147) | \* option 'wrld\_last\_skipped\_on'. |
| [148](#L148) | \*/ |
| [149](#L149) | public static function wrld\_notice\_action() { |
| [150](#L150) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [151](#L151) | if ( wp\_verify\_nonce( $nonce, 'wrld-review-notice' ) ) { |
| [152](#L152) | $user\_action = sanitize\_text\_field( wp\_unslash( $\_REQUEST['user\_action'] ) ); |
| [153](#L153) | switch ( $user\_action ) { |
| [154](#L154) | case 'wisdm-reports-for-ld-remind-later': |
| [155](#L155) | case 'wisdm-reports-for-ld-post-review': |
| [156](#L156) | case 'close': |
| [157](#L157) | update\_option( 'wrld\_last\_skipped\_on', time() ); |
| [158](#L158) | break; |
| [159](#L159) | default: |
| [160](#L160) | update\_option( 'ld-reports-review-dismissed', time() ); |
| [161](#L161) | break; |
| [162](#L162) | } |
| [163](#L163) | wp\_send\_json\_success(); |
| [164](#L164) | } |
| [165](#L165) | wp\_send\_json\_error(); |
| [166](#L166) | } |
| [167](#L167) |  |
| [168](#L168) | public function show\_wisdm\_reports\_submenu() { |
| [169](#L169) | ?> |
| [170](#L170) | <div class="wrap"> |
| [171](#L171) | <h1><?php esc\_html\_e( 'Reports', 'learndash-reports-by-wisdmlabs' ); ?></h1> |
| [172](#L172) | <?php |
| [173](#L173) | $dashboard\_id = get\_option( 'ldrp\_reporting\_page', false ); |
| [174](#L174) | if ( ! $dashboard\_id || 'publish' !== get\_post\_status( $dashboard\_id ) ) { |
| [175](#L175) | ?> |
| [176](#L176) | <p><?php esc\_html\_e( 'The page seems to have been deleted/removed. Please click on the link below to create the page manually.', 'learndash-reports-by-wisdmlabs' ); ?> |
| [177](#L177) | </p> |
| [178](#L178) | <a |
| [179](#L179) | href="<?php echo esc\_attr( add\_query\_arg( array( 'create\_wisdm\_reports' => true ) ) ); ?>"><?php esc\_html\_e( 'Create Reports Dashboard', 'learndash-reports-by-wisdmlabs' ); ?></a> |
| [180](#L180) | <?php |
| [181](#L181) | } else { |
| [182](#L182) | ?> |
| [183](#L183) | <p><a class="primary-button primary-btn components-button is-primary" |
| [184](#L184) | href="<?php echo esc\_url( get\_permalink( $dashboard\_id ) ); ?>" target="\_blank" |
| [185](#L185) | style="background:#007cba;color:#fff;text-decoration:none;text-shadow:none;outline:1px solid transparent;padding:6px 12px;border-radius:2px;"><?php esc\_html\_e( 'Launch Reports Dashboard', 'learndash-reports-by-wisdmlabs' ); ?></a> |
| [186](#L186) | </p> |
| [187](#L187) | <?php |
| [188](#L188) | } |
| [189](#L189) | ?> |
| [190](#L190) | </div> |
| [191](#L191) | <?php |
| [192](#L192) | } |
| [193](#L193) |  |
| [194](#L194) | /\*\* |
| [195](#L195) | \* This function creates the page with the default WRLD pattern when a get parameter 'create\_wisdm\_reports' is set. |
| [196](#L196) | \*/ |
| [197](#L197) | public function wrld\_create\_patterns\_page() { |
| [198](#L198) | $new\_page\_creation = filter\_input( INPUT\_GET, 'create\_wisdm\_reports', FILTER\_VALIDATE\_BOOLEAN ); |
| [199](#L199) | $created\_page      = get\_option( 'ldrp\_reporting\_page', false ); |
| [200](#L200) |  |
| [201](#L201) | if ( $created\_page && 'publish' !== get\_post\_status( $created\_page ) ) { |
| [202](#L202) | if ( ! empty( $new\_page\_creation ) ) { |
| [203](#L203) | wrld\_create\_patterns\_page( true ); |
| [204](#L204) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_page\_creation\_notice' ); |
| [205](#L205) | } |
| [206](#L206) | } elseif ( false == $created\_page ) { |
| [207](#L207) | wrld\_create\_patterns\_page( false ); |
| [208](#L208) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_page\_creation\_notice' ); |
| [209](#L209) | } |
| [210](#L210) | } |
| [211](#L211) | /\*\* |
| [212](#L212) | \* This function creates the page with the default WRLD pattern when a get parameter 'create\_wisdm\_reports' is set. |
| [213](#L213) | \*/ |
| [214](#L214) | public function wrld\_create\_student\_patterns\_page() { |
| [215](#L215) | $new\_page\_creation = filter\_input( INPUT\_GET, 'create\_student\_reports', FILTER\_VALIDATE\_BOOLEAN ); |
| [216](#L216) | $created\_page      = get\_option( 'ldrp\_student\_page', false ); |
| [217](#L217) |  |
| [218](#L218) | if ( $created\_page && 'publish' !== get\_post\_status( $created\_page ) ) { |
| [219](#L219) | if ( ! empty( $new\_page\_creation ) ) { |
| [220](#L220) | wrld\_create\_student\_patterns\_page( true ); |
| [221](#L221) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_student\_page\_creation\_notice' ); |
| [222](#L222) | } |
| [223](#L223) | } elseif ( false == $created\_page ) { |
| [224](#L224) | wrld\_create\_student\_patterns\_page( false ); |
| [225](#L225) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_student\_page\_creation\_notice' ); |
| [226](#L226) | } |
| [227](#L227) | } |
| [228](#L228) |  |
| [229](#L229) | /\*\* |
| [230](#L230) | \* The function checks if the plugin specified is installed on the website. |
| [231](#L231) | \* - Currently works only for the WordPress single site. |
| [232](#L232) | \* |
| [233](#L233) | \* @param $plugin\_slug plugin path and plugin file name, ex : learndash-reports-pro/learndash-reports-pro.php. |
| [234](#L234) | \*/ |
| [235](#L235) | public static function is\_plugin\_installed( $plugin\_slug ) { |
| [236](#L236) | if ( empty( $plugin\_slug ) ) { |
| [237](#L237) | return false; |
| [238](#L238) | } |
| [239](#L239) |  |
| [240](#L240) | // Check if needed functions exists - if not, require them |
| [241](#L241) | if ( ! function\_exists( 'get\_plugins' ) || ! function\_exists( 'is\_plugin\_active' ) ) { |
| [242](#L242) | require\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
| [243](#L243) | } |
| [244](#L244) |  |
| [245](#L245) | $installed\_plugins = get\_plugins(); |
| [246](#L246) | return array\_key\_exists( $plugin\_slug, $installed\_plugins ) || in\_array( $plugin\_slug, $installed\_plugins, true ); |
| [247](#L247) | } |
| [248](#L248) |  |
| [249](#L249) | /\*\* |
| [250](#L250) | \* Shows admin a notice on the admin dashboard. |
| [251](#L251) | \*/ |
| [252](#L252) | public static function report\_page\_creation\_notice() { |
| [253](#L253) | echo '<div class="notice notice-success is-dismissible"><p>'; |
| [254](#L254) | echo esc\_html\_\_( 'Successfully created Reports For LearnDash page', 'learndash-reports-by-wisdmlabs' ); |
| [255](#L255) | echo '</p></div>'; |
| [256](#L256) | } |
| [257](#L257) |  |
| [258](#L258) | /\*\* |
| [259](#L259) | \* Shows admin a notice on the admin dashboard. |
| [260](#L260) | \*/ |
| [261](#L261) | public static function report\_student\_page\_creation\_notice() { |
| [262](#L262) | echo '<div class="notice notice-success is-dismissible"><p>'; |
| [263](#L263) | echo esc\_html\_\_( 'Successfully created Reports For LearnDash Student Quiz Reports page', 'learndash-reports-by-wisdmlabs' ); |
| [264](#L264) | echo '</p></div>'; |
| [265](#L265) | } |
| [266](#L266) |  |
| [267](#L267) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [268](#L268) | \* Actions for admin dashboard settings \* |
| [269](#L269) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [270](#L270) |  |
| [271](#L271) | /\*\* |
| [272](#L272) | \* Skip license activation. |
| [273](#L273) | \* |
| [274](#L274) | \* @deprecated 1.8.2 This method is no longer used. |
| [275](#L275) | \*/ |
| [276](#L276) | public static function wrld\_skip\_license\_activation() { |
| [277](#L277) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [278](#L278) | } |
| [279](#L279) |  |
| [280](#L280) | public static function wrld\_exclude\_settings\_save() { |
| [281](#L281) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [282](#L282) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [283](#L283) | if ( ! $nonce\_valid ) { |
| [284](#L284) | wp\_send\_json\_error( |
| [285](#L285) | array( |
| [286](#L286) | 'success' => true, |
| [287](#L287) | 'message' => \_\_( |
| [288](#L288) | 'Nonce verification failed', |
| [289](#L289) | 'learndash-reports-by-wisdmlabs' |
| [290](#L290) | ), |
| [291](#L291) | ) |
| [292](#L292) | ); |
| [293](#L293) | } |
| [294](#L294) |  |
| [295](#L295) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [296](#L296) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [297](#L297) | } |
| [298](#L298) |  |
| [299](#L299) | $type  = filter\_input( INPUT\_POST, 'type', FILTER\_SANITIZE\_STRING ); |
| [300](#L300) | $value = filter\_input( INPUT\_POST, 'value', FILTER\_DEFAULT, FILTER\_REQUIRE\_ARRAY ); |
| [301](#L301) |  |
| [302](#L302) | update\_option( 'exclude\_' . $type, $value ); |
| [303](#L303) |  |
| [304](#L304) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [305](#L305) | } |
| [306](#L306) |  |
| [307](#L307) | public static function apply\_time\_tracking\_settings() { |
| [308](#L308) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [309](#L309) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [310](#L310) | if ( ! $nonce\_valid ) { |
| [311](#L311) | wp\_send\_json\_error( |
| [312](#L312) | array( |
| [313](#L313) | 'success' => true, |
| [314](#L314) | 'message' => \_\_( |
| [315](#L315) | 'Nonce verification failed', |
| [316](#L316) | 'learndash-reports-by-wisdmlabs' |
| [317](#L317) | ), |
| [318](#L318) | ) |
| [319](#L319) | ); |
| [320](#L320) | } |
| [321](#L321) |  |
| [322](#L322) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [323](#L323) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [324](#L324) | } |
| [325](#L325) |  |
| [326](#L326) | $status   = filter\_input( INPUT\_POST, 'status', FILTER\_SANITIZE\_STRING ); |
| [327](#L327) | $timer    = filter\_input( INPUT\_POST, 'timeout', FILTER\_SANITIZE\_NUMBER\_INT ); |
| [328](#L328) | $message  = filter\_input( INPUT\_POST, 'message', FILTER\_SANITIZE\_STRING ); |
| [329](#L329) | $btnlabel = filter\_input( INPUT\_POST, 'btnlabel', FILTER\_SANITIZE\_STRING ); |
| [330](#L330) |  |
| [331](#L331) | if ( ! empty( $timer ) ) { |
| [332](#L332) | update\_option( 'wrld\_time\_tracking\_timer', $timer ); |
| [333](#L333) | } |
| [334](#L334) | if ( ! empty( $message ) ) { |
| [335](#L335) | update\_option( 'wrld\_time\_tracking\_message', $message ); |
| [336](#L336) | } |
| [337](#L337) | if ( ! empty( $btnlabel ) ) { |
| [338](#L338) | update\_option( 'wrld\_time\_tracking\_btnlabel', $btnlabel ); |
| [339](#L339) | } |
| [340](#L340) | if ( ! empty( $status ) ) { |
| [341](#L341) | $all\_updates  = get\_option( 'wrld\_time\_tracking\_log', false ); |
| [342](#L342) | $current\_time = current\_time( 'timestamp' ); |
| [343](#L343) | if ( ! empty( $all\_updates ) ) { |
| [344](#L344) | $all\_updates[] = $current\_time; |
| [345](#L345) | } else { |
| [346](#L346) | $all\_updates = array( $current\_time ); |
| [347](#L347) | } |
| [348](#L348) | update\_option( 'wrld\_time\_tracking\_status', $status ); |
| [349](#L349) | update\_option( 'wrld\_time\_tracking\_last\_update', $current\_time ); |
| [350](#L350) | update\_option( 'wrld\_time\_tracking\_log', $all\_updates ); |
| [351](#L351) | wp\_send\_json\_success( |
| [352](#L352) | array( |
| [353](#L353) | 'success' => true, |
| [354](#L354) | 'time'    => date\_i18n( |
| [355](#L355) | 'Y-m-d H:i:s', |
| [356](#L356) | $current\_time |
| [357](#L357) | ), |
| [358](#L358) | ) |
| [359](#L359) | ); |
| [360](#L360) | } |
| [361](#L361) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [362](#L362) |  |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | public static function wrld\_exclude\_load\_users() { |
| [366](#L366) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [367](#L367) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [368](#L368) | if ( ! $nonce\_valid ) { |
| [369](#L369) | wp\_send\_json\_error( |
| [370](#L370) | array( |
| [371](#L371) | 'success' => true, |
| [372](#L372) | 'message' => \_\_( |
| [373](#L373) | 'Nonce verification failed', |
| [374](#L374) | 'learndash-reports-by-wisdmlabs' |
| [375](#L375) | ), |
| [376](#L376) | ) |
| [377](#L377) | ); |
| [378](#L378) | } |
| [379](#L379) |  |
| [380](#L380) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [381](#L381) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [382](#L382) | } |
| [383](#L383) |  |
| [384](#L384) | $page   = filter\_input( INPUT\_POST, 'page', FILTER\_VALIDATE\_INT ); |
| [385](#L385) | $search = filter\_input( INPUT\_POST, 'search', FILTER\_SANITIZE\_STRING ); |
| [386](#L386) |  |
| [387](#L387) | if ( empty( $page ) ) { |
| [388](#L388) | $page = 1; |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | $args = array( |
| [392](#L392) | 'number'         => 10, |
| [393](#L393) | 'paged'          => $page, |
| [394](#L394) | 'search\_columns' => array( |
| [395](#L395) | 'user\_login', |
| [396](#L396) | 'user\_email', |
| [397](#L397) | 'user\_nicename', |
| [398](#L398) | 'display\_name', |
| [399](#L399) | ), |
| [400](#L400) | 'fields'         => array( |
| [401](#L401) | 'ID', |
| [402](#L402) | 'display\_name', |
| [403](#L403) | ), |
| [404](#L404) | ); |
| [405](#L405) |  |
| [406](#L406) | if ( ! empty( $search ) ) { |
| [407](#L407) | $args['search'] = '\*' . $search . '\*'; |
| [408](#L408) | } |
| [409](#L409) |  |
| [410](#L410) | $users = get\_users( $args ); |
| [411](#L411) | if ( empty( $users ) ) { |
| [412](#L412) | wp\_send\_json\_error(); |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | wp\_send\_json\_success( |
| [416](#L416) | array( |
| [417](#L417) | 'success' => true, |
| [418](#L418) | 'data'    => $users, |
| [419](#L419) | ) |
| [420](#L420) | ); |
| [421](#L421) | } |
| [422](#L422) |  |
| [423](#L423) | /\*\* |
| [424](#L424) | \* A function hooked to the ajax action wrld\_license\_activate, |
| [425](#L425) | \* resposible for initiating the activation request for the |
| [426](#L426) | \* reports pro plugin license key. |
| [427](#L427) | \* |
| [428](#L428) | \* @since 1.2.0 |
| [429](#L429) | \* @deprecated 1.8.2 This method is no longer used. |
| [430](#L430) | \*/ |
| [431](#L431) | public static function wrld\_license\_activate() { |
| [432](#L432) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [433](#L433) | } |
| [434](#L434) |  |
| [435](#L435) | /\*\* |
| [436](#L436) | \* A function hooked to the ajax action wrld\_license\_deactivate, |
| [437](#L437) | \* resposible for initiating the deactivation request for the |
| [438](#L438) | \* reports pro plugin license key. |
| [439](#L439) | \* |
| [440](#L440) | \* @since 1.2.0 |
| [441](#L441) | \* @deprecated 1.8.2 This method is no longer used. |
| [442](#L442) | \*/ |
| [443](#L443) | public static function wrld\_license\_deactivate() { |
| [444](#L444) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [445](#L445) | } |
| [446](#L446) |  |
| [447](#L447) | /\*\* |
| [448](#L448) | \* A function hooked to the ajax action wrld\_set\_configuration, |
| [449](#L449) | \* resposible for setting up the configuration which enables inclusion |
| [450](#L450) | \* of the reports page link in the primary menu. |
| [451](#L451) | \* |
| [452](#L452) | \* @since 1.2.0 |
| [453](#L453) | \*/ |
| [454](#L454) | public static function wrld\_set\_configuration() { |
| [455](#L455) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [456](#L456) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [457](#L457) | if ( ! $nonce\_valid ) { |
| [458](#L458) | wp\_send\_json\_error( |
| [459](#L459) | array( |
| [460](#L460) | 'success' => true, |
| [461](#L461) | 'message' => \_\_( |
| [462](#L462) | 'Nonce verification failed', |
| [463](#L463) | 'learndash-reports-by-wisdmlabs' |
| [464](#L464) | ), |
| [465](#L465) | ) |
| [466](#L466) | ); |
| [467](#L467) | } |
| [468](#L468) |  |
| [469](#L469) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [470](#L470) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [471](#L471) | } |
| [472](#L472) |  |
| [473](#L473) | $settings\_data = get\_option( 'wrld\_settings', array() ); |
| [474](#L474) | if ( isset( $\_REQUEST['add\_in\_menu'] ) ) { |
| [475](#L475) | $settings\_data['wrld-menu-config-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_in\_menu'] ) ); |
| [476](#L476) | } |
| [477](#L477) | if ( isset( $\_REQUEST['add\_student\_in\_menu'] ) ) { |
| [478](#L478) | $settings\_data['wrld-menu-student-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_student\_in\_menu'] ) ); |
| [479](#L479) | } |
| [480](#L480) | update\_option( 'wrld\_settings', $settings\_data ); |
| [481](#L481) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [482](#L482) | } |
| [483](#L483) |  |
| [484](#L484) | /\*\* |
| [485](#L485) | \* A function hooked to the ajax action wrld\_update\_settings, |
| [486](#L486) | \* resposible for setting up the configuration which enables inclusion |
| [487](#L487) | \* of the reports page link in the primary menu. |
| [488](#L488) | \* |
| [489](#L489) | \* @since 1.2.0 |
| [490](#L490) | \*/ |
| [491](#L491) | public static function wrld\_update\_settings() { |
| [492](#L492) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [493](#L493) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [494](#L494) | if ( ! $nonce\_valid ) { |
| [495](#L495) | wp\_send\_json\_error( |
| [496](#L496) | array( |
| [497](#L497) | 'success' => false, |
| [498](#L498) | 'message' => \_\_( |
| [499](#L499) | 'Nonce verification failed', |
| [500](#L500) | 'learndash-reports-by-wisdmlabs' |
| [501](#L501) | ), |
| [502](#L502) | ) |
| [503](#L503) | ); |
| [504](#L504) | } |
| [505](#L505) |  |
| [506](#L506) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [507](#L507) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [508](#L508) | } |
| [509](#L509) |  |
| [510](#L510) | $settings\_data = get\_option( 'wrld\_settings', array() ); |
| [511](#L511) | if ( isset( $\_REQUEST['access\_to\_group\_leader'] ) ) { |
| [512](#L512) | $access\_for\_group\_leader = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['access\_to\_group\_leader'] ) ); |
| [513](#L513) | } |
| [514](#L514) | if ( isset( $\_REQUEST['access\_to\_wdm\_instructor'] ) ) { |
| [515](#L515) | $access\_for\_wdm\_instructor = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['access\_to\_wdm\_instructor'] ) ); |
| [516](#L516) | } |
| [517](#L517) | if ( isset( $\_REQUEST['add\_in\_menu'] ) ) { |
| [518](#L518) | $settings\_data['wrld-menu-config-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_in\_menu'] ) ); |
| [519](#L519) | } |
| [520](#L520) | if ( isset( $\_REQUEST['add\_student\_in\_menu'] ) ) { |
| [521](#L521) | $settings\_data['wrld-menu-student-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_student\_in\_menu'] ) ); |
| [522](#L522) | } |
| [523](#L523) |  |
| [524](#L524) | if ( isset( $access\_for\_group\_leader ) || isset( $access\_for\_wdm\_instructor ) ) { |
| [525](#L525) | $settings\_data['dashboard-access-roles'] = array( |
| [526](#L526) | 'group\_leader'   => $access\_for\_group\_leader, |
| [527](#L527) | 'wdm\_instructor' => $access\_for\_wdm\_instructor, |
| [528](#L528) | ); |
| [529](#L529) | } |
| [530](#L530) | update\_option( 'wrld\_settings', $settings\_data ); |
| [531](#L531) | wp\_send\_json\_success( array( 'settings\_data' => $settings\_data ) ); |
| [532](#L532) |  |
| [533](#L533) | } |
| [534](#L534) |  |
| [535](#L535) | /\*\* |
| [536](#L536) | \* @deprecated 1.8.2 This method is no longer used. |
| [537](#L537) | \*/ |
| [538](#L538) | public function wrld\_license\_page\_visit() { |
| [539](#L539) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [540](#L540) | } |
| [541](#L541) |  |
| [542](#L542) | /\*\* |
| [543](#L543) | \* Add the Helpscout Beacon script on the Reports Settings backend pages. |
| [544](#L544) | \* Callback to action hook 'ldgr\_helpscout\_beacon'. |
| [545](#L545) | \* |
| [546](#L546) | \* @since 4.9.10 |
| [547](#L547) | \* @deprecated 1.8.2 This method is no longer used. |
| [548](#L548) | \*/ |
| [549](#L549) | public function wrld\_add\_beacon\_helpscout\_script() { |
| [550](#L550) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [551](#L551) | } |
| [552](#L552) |  |
| [553](#L553) | /\*\* |
| [554](#L554) | \* Calling function to the helpscout beacon. |
| [555](#L555) | \* Callback to action hook 'wrld\_helpscout\_beacon'. |
| [556](#L556) | \* |
| [557](#L557) | \* @since 4.9.10 |
| [558](#L558) | \* @deprecated 1.8.2 This method is no longer used. |
| [559](#L559) | \*/ |
| [560](#L560) | public function wrld\_load\_beacon\_helpscout() { |
| [561](#L561) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [562](#L562) | } |
| [563](#L563) |  |
| [564](#L564) | } |
| [565](#L565) |  |
| [566](#L566) | \WisdmReportsLearndash\Admin\_Functions::instance(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?format=txt)
* [Original Format](/export/3220658/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_9717d9a4_20250111_102613.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwisdm-reports-for-learndash%2Ftrunk%2Fincludes%2Fadmin%2Fclass-admin-functions.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?rev=3083439 "Revision 3083439")
* Next Revision →
* [Blame](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php)

---

# [source:](/browser?order=name "Go to repository root") [wisdm-reports-for-learndash](/browser/wisdm-reports-for-learndash?order=name "View wisdm-reports-for-learndash")/[trunk](/browser/wisdm-reports-for-learndash/trunk?order=name "View trunk")/[includes](/browser/wisdm-reports-for-learndash/trunk/includes?order=name "View includes")/[admin](/browser/wisdm-reports-for-learndash/trunk/includes/admin?order=name "View admin")/[class-admin-functions.php](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?order=name "View class-admin-functions.php")

View diff against:

View revision:

| [Last change](/changeset/3119784/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php "View differences") on this file was [3119784](/changeset/3119784/ "View changeset 3119784"), checked in by stellarwp, [6 months ago](/timeline?from=2024-07-17T02%3A25%3A45Z&precision=second "See timeline at 07/17/2024 02:25:45 AM") |
| --- |
| Tag version 1.8.2.2 |
| **File size:** 18.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* This file contains the class admin functions. |
| [4](#L4) | \* |
| [5](#L5) | \* @package learndash-reports-by-wisdmlabs |
| [6](#L6) | \*/ |
| [7](#L7) |  |
| [8](#L8) | namespace WisdmReportsLearndash; |
| [9](#L9) |  |
| [10](#L10) | class Admin\_Functions { |
| [11](#L11) |  |
| [12](#L12) | protected static $instance = null; |
| [13](#L13) |  |
| [14](#L14) | /\*\* |
| [15](#L15) | \* This function has been used to create the static instance of the admin functions class. |
| [16](#L16) | \*/ |
| [17](#L17) | public static function instance() { |
| [18](#L18) | if ( is\_null( self::$instance ) ) { |
| [19](#L19) | self::$instance = new self(); |
| [20](#L20) | } |
| [21](#L21) | return self::$instance; |
| [22](#L22) | } |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* This is the constructor for the class that will instantiate all processes related to the class. |
| [26](#L26) | \*/ |
| [27](#L27) | public function \_\_construct() { |
| [28](#L28) | $this->init\_hooks(); |
| [29](#L29) | } |
| [30](#L30) |  |
| [31](#L31) | /\*\* |
| [32](#L32) | \* This method is used to add all the admin related actions and filter hooks. |
| [33](#L33) | \*/ |
| [34](#L34) | public function init\_hooks() { |
| [35](#L35) | add\_action( 'wp\_ajax\_wrld\_page\_visit', array( $this, 'update\_reporting\_page\_visit' ) ); |
| [36](#L36) | add\_action( 'wp\_ajax\_wrld\_gutenberg\_block\_visit', array( $this, 'wp\_ajax\_wrld\_gutenberg\_block\_visit' ) ); |
| [37](#L37) | add\_action( 'wp\_ajax\_wrld\_notice\_action', array( $this, 'wrld\_notice\_action' ) ); |
| [38](#L38) | add\_action( 'init', array( $this, 'wrld\_create\_patterns\_page' ), 99 ); |
| [39](#L39) | add\_action( 'init', array( $this, 'wrld\_create\_student\_patterns\_page' ), 99 ); |
| [40](#L40) | // settings page ajax actions |
| [41](#L41) | add\_action( 'wp\_ajax\_wrld\_set\_configuration', array( $this, 'wrld\_set\_configuration' ) ); |
| [42](#L42) | add\_action( 'wp\_ajax\_wrld\_update\_settings', array( $this, 'wrld\_update\_settings' ) ); |
| [43](#L43) | add\_action( 'wp\_ajax\_wrld\_exclude\_settings\_save', array( $this, 'wrld\_exclude\_settings\_save' ) ); |
| [44](#L44) | add\_action( 'wp\_ajax\_apply\_time\_tracking\_settings', array( $this, 'apply\_time\_tracking\_settings' ) ); |
| [45](#L45) | add\_action( 'wp\_ajax\_wrld\_exclude\_load\_users', array( $this, 'wrld\_exclude\_load\_users' ) ); |
| [46](#L46) | // Welcome modal |
| [47](#L47) | add\_action( 'wp\_ajax\_wrld\_welcome\_modal\_action', array( $this, 'wrld\_welcome\_modal\_action' ) ); |
| [48](#L48) | add\_action( 'wp\_ajax\_wrld\_autoupdate\_dashboard', array( $this, 'wrld\_autoupdate\_dashboard' ) ); |
| [49](#L49) | // add\_action( 'admin\_notices', array( $this, 'wrld\_pattern\_update\_notice' ) ); |
| [50](#L50) | } |
| [51](#L51) |  |
| [52](#L52) | public static function wp\_ajax\_wrld\_gutenberg\_block\_visit() { |
| [53](#L53) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [54](#L54) |  |
| [55](#L55) | if ( ! wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ) ) { |
| [56](#L56) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [60](#L60) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [61](#L61) | } |
| [62](#L62) |  |
| [63](#L63) | $option\_key = isset( $\_REQUEST['option\_key'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['option\_key'] ) ) : null; |
| [64](#L64) |  |
| [65](#L65) | if ( empty( $option\_key ) ) { |
| [66](#L66) | wp\_send\_json\_error( esc\_html\_\_( 'Invalid option key.', 'learndash-reports-by-wisdmlabs' ) ); |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | update\_option( $option\_key, true ); |
| [70](#L70) |  |
| [71](#L71) | wp\_send\_json\_success( |
| [72](#L72) | array( |
| [73](#L73) | 'updated' => $option\_key, |
| [74](#L74) | ) |
| [75](#L75) | ); |
| [76](#L76) | } |
| [77](#L77) |  |
| [78](#L78) | public function wrld\_pattern\_update\_notice() { |
| [79](#L79) | // phpcs:ignore WordPress.Security.NonceVerification.Recommended -- Data is not used for action or DB query. |
| [80](#L80) | if ( ! isset( $\_GET['updated\_pattern'] ) ) { |
| [81](#L81) | return; |
| [82](#L82) | } |
| [83](#L83) | echo "<div class='notice notice-success'> |
| [84](#L84) | <p>Dashboard Page successfully updated.</p> |
| [85](#L85) | </div>"; |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | public function wrld\_autoupdate\_dashboard() { |
| [89](#L89) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [90](#L90) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [91](#L91) | if ( ! $nonce\_valid ) { |
| [92](#L92) | wp\_send\_json\_error( |
| [93](#L93) | array( |
| [94](#L94) | 'success' => true, |
| [95](#L95) | 'message' => \_\_( |
| [96](#L96) | 'Nonce verification failed', |
| [97](#L97) | 'learndash-reports-by-wisdmlabs' |
| [98](#L98) | ), |
| [99](#L99) | ) |
| [100](#L100) | ); |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [104](#L104) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [105](#L105) | } |
| [106](#L106) |  |
| [107](#L107) | global $wrld\_pattern; |
| [108](#L108) | $reports\_page = get\_option( 'ldrp\_reporting\_page', false ); |
| [109](#L109) | $data         = array( |
| [110](#L110) | 'ID'           => $reports\_page, |
| [111](#L111) | 'post\_content' => $wrld\_pattern, |
| [112](#L112) | ); |
| [113](#L113) | wp\_update\_post( $data ); |
| [114](#L114) | wp\_send\_json\_success( |
| [115](#L115) | array( |
| [116](#L116) | 'url' => add\_query\_arg( |
| [117](#L117) | array( |
| [118](#L118) | 'updated\_pattern' => 1, |
| [119](#L119) | 'dla\_op'          => true, |
| [120](#L120) | 'dla\_oq'          => true, |
| [121](#L121) | ), |
| [122](#L122) | get\_permalink( $reports\_page ) |
| [123](#L123) | ), |
| [124](#L124) | ) |
| [125](#L125) | ); |
| [126](#L126) | die(); |
| [127](#L127) | } |
| [128](#L128) |  |
| [129](#L129) | /\*\* |
| [130](#L130) | \* This action is hooked to the ajax callback action 'wp\_ajax\_wrld\_page\_visit', |
| [131](#L131) | \* on called verifies if the request is from the correct source & update teh value for the |
| [132](#L132) | \* option 'wrld\_reporting\_page\_visited'. |
| [133](#L133) | \*/ |
| [134](#L134) | public static function update\_reporting\_page\_visit() { |
| [135](#L135) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [136](#L136) | if ( wp\_verify\_nonce( $nonce, 'reports-firrst-install-modal' ) ) { |
| [137](#L137) | // update\_option( 'wrld\_reporting\_page\_visited', 2 ); |
| [138](#L138) | wp\_send\_json\_success(); |
| [139](#L139) | } |
| [140](#L140) | wp\_send\_json\_error(); |
| [141](#L141) | } |
| [142](#L142) |  |
| [143](#L143) |  |
| [144](#L144) | /\*\* |
| [145](#L145) | \* This action is hooked to the ajax callback action 'wp\_ajax\_wrld\_notice\_action', |
| [146](#L146) | \* on called verifies if the request is from the correct source & update the value for the |
| [147](#L147) | \* option 'wrld\_last\_skipped\_on'. |
| [148](#L148) | \*/ |
| [149](#L149) | public static function wrld\_notice\_action() { |
| [150](#L150) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [151](#L151) | if ( wp\_verify\_nonce( $nonce, 'wrld-review-notice' ) ) { |
| [152](#L152) | $user\_action = sanitize\_text\_field( wp\_unslash( $\_REQUEST['user\_action'] ) ); |
| [153](#L153) | switch ( $user\_action ) { |
| [154](#L154) | case 'wisdm-reports-for-ld-remind-later': |
| [155](#L155) | case 'wisdm-reports-for-ld-post-review': |
| [156](#L156) | case 'close': |
| [157](#L157) | update\_option( 'wrld\_last\_skipped\_on', time() ); |
| [158](#L158) | break; |
| [159](#L159) | default: |
| [160](#L160) | update\_option( 'ld-reports-review-dismissed', time() ); |
| [161](#L161) | break; |
| [162](#L162) | } |
| [163](#L163) | wp\_send\_json\_success(); |
| [164](#L164) | } |
| [165](#L165) | wp\_send\_json\_error(); |
| [166](#L166) | } |
| [167](#L167) |  |
| [168](#L168) | public function show\_wisdm\_reports\_submenu() { |
| [169](#L169) | ?> |
| [170](#L170) | <div class="wrap"> |
| [171](#L171) | <h1><?php esc\_html\_e( 'Reports', 'learndash-reports-by-wisdmlabs' ); ?></h1> |
| [172](#L172) | <?php |
| [173](#L173) | $dashboard\_id = get\_option( 'ldrp\_reporting\_page', false ); |
| [174](#L174) | if ( ! $dashboard\_id || 'publish' !== get\_post\_status( $dashboard\_id ) ) { |
| [175](#L175) | ?> |
| [176](#L176) | <p><?php esc\_html\_e( 'The page seems to have been deleted/removed. Please click on the link below to create the page manually.', 'learndash-reports-by-wisdmlabs' ); ?> |
| [177](#L177) | </p> |
| [178](#L178) | <a |
| [179](#L179) | href="<?php echo esc\_attr( add\_query\_arg( array( 'create\_wisdm\_reports' => true ) ) ); ?>"><?php esc\_html\_e( 'Create Reports Dashboard', 'learndash-reports-by-wisdmlabs' ); ?></a> |
| [180](#L180) | <?php |
| [181](#L181) | } else { |
| [182](#L182) | ?> |
| [183](#L183) | <p><a class="primary-button primary-btn components-button is-primary" |
| [184](#L184) | href="<?php echo esc\_url( get\_permalink( $dashboard\_id ) ); ?>" target="\_blank" |
| [185](#L185) | style="background:#007cba;color:#fff;text-decoration:none;text-shadow:none;outline:1px solid transparent;padding:6px 12px;border-radius:2px;"><?php esc\_html\_e( 'Launch Reports Dashboard', 'learndash-reports-by-wisdmlabs' ); ?></a> |
| [186](#L186) | </p> |
| [187](#L187) | <?php |
| [188](#L188) | } |
| [189](#L189) | ?> |
| [190](#L190) | </div> |
| [191](#L191) | <?php |
| [192](#L192) | } |
| [193](#L193) |  |
| [194](#L194) | /\*\* |
| [195](#L195) | \* This function creates the page with the default WRLD pattern when a get parameter 'create\_wisdm\_reports' is set. |
| [196](#L196) | \*/ |
| [197](#L197) | public function wrld\_create\_patterns\_page() { |
| [198](#L198) | $new\_page\_creation = filter\_input( INPUT\_GET, 'create\_wisdm\_reports', FILTER\_VALIDATE\_BOOLEAN ); |
| [199](#L199) | $created\_page      = get\_option( 'ldrp\_reporting\_page', false ); |
| [200](#L200) |  |
| [201](#L201) | if ( $created\_page && 'publish' !== get\_post\_status( $created\_page ) ) { |
| [202](#L202) | if ( ! empty( $new\_page\_creation ) ) { |
| [203](#L203) | wrld\_create\_patterns\_page( true ); |
| [204](#L204) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_page\_creation\_notice' ); |
| [205](#L205) | } |
| [206](#L206) | } elseif ( false == $created\_page ) { |
| [207](#L207) | wrld\_create\_patterns\_page( false ); |
| [208](#L208) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_page\_creation\_notice' ); |
| [209](#L209) | } |
| [210](#L210) | } |
| [211](#L211) | /\*\* |
| [212](#L212) | \* This function creates the page with the default WRLD pattern when a get parameter 'create\_wisdm\_reports' is set. |
| [213](#L213) | \*/ |
| [214](#L214) | public function wrld\_create\_student\_patterns\_page() { |
| [215](#L215) | $new\_page\_creation = filter\_input( INPUT\_GET, 'create\_student\_reports', FILTER\_VALIDATE\_BOOLEAN ); |
| [216](#L216) | $created\_page      = get\_option( 'ldrp\_student\_page', false ); |
| [217](#L217) |  |
| [218](#L218) | if ( $created\_page && 'publish' !== get\_post\_status( $created\_page ) ) { |
| [219](#L219) | if ( ! empty( $new\_page\_creation ) ) { |
| [220](#L220) | wrld\_create\_student\_patterns\_page( true ); |
| [221](#L221) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_student\_page\_creation\_notice' ); |
| [222](#L222) | } |
| [223](#L223) | } elseif ( false == $created\_page ) { |
| [224](#L224) | wrld\_create\_student\_patterns\_page( false ); |
| [225](#L225) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_student\_page\_creation\_notice' ); |
| [226](#L226) | } |
| [227](#L227) | } |
| [228](#L228) |  |
| [229](#L229) | /\*\* |
| [230](#L230) | \* The function checks if the plugin specified is installed on the website. |
| [231](#L231) | \* - Currently works only for the WordPress single site. |
| [232](#L232) | \* |
| [233](#L233) | \* @param $plugin\_slug plugin path and plugin file name, ex : learndash-reports-pro/learndash-reports-pro.php. |
| [234](#L234) | \*/ |
| [235](#L235) | public static function is\_plugin\_installed( $plugin\_slug ) { |
| [236](#L236) | if ( empty( $plugin\_slug ) ) { |
| [237](#L237) | return false; |
| [238](#L238) | } |
| [239](#L239) |  |
| [240](#L240) | // Check if needed functions exists - if not, require them |
| [241](#L241) | if ( ! function\_exists( 'get\_plugins' ) || ! function\_exists( 'is\_plugin\_active' ) ) { |
| [242](#L242) | require\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
| [243](#L243) | } |
| [244](#L244) |  |
| [245](#L245) | $installed\_plugins = get\_plugins(); |
| [246](#L246) | return array\_key\_exists( $plugin\_slug, $installed\_plugins ) || in\_array( $plugin\_slug, $installed\_plugins, true ); |
| [247](#L247) | } |
| [248](#L248) |  |
| [249](#L249) | /\*\* |
| [250](#L250) | \* Shows admin a notice on the admin dashboard. |
| [251](#L251) | \*/ |
| [252](#L252) | public static function report\_page\_creation\_notice() { |
| [253](#L253) | echo '<div class="notice notice-success is-dismissible"><p>'; |
| [254](#L254) | echo esc\_html\_\_( 'Successfully created Reports For LearnDash page', 'learndash-reports-by-wisdmlabs' ); |
| [255](#L255) | echo '</p></div>'; |
| [256](#L256) | } |
| [257](#L257) |  |
| [258](#L258) | /\*\* |
| [259](#L259) | \* Shows admin a notice on the admin dashboard. |
| [260](#L260) | \*/ |
| [261](#L261) | public static function report\_student\_page\_creation\_notice() { |
| [262](#L262) | echo '<div class="notice notice-success is-dismissible"><p>'; |
| [263](#L263) | echo esc\_html\_\_( 'Successfully created Reports For LearnDash Student Quiz Reports page', 'learndash-reports-by-wisdmlabs' ); |
| [264](#L264) | echo '</p></div>'; |
| [265](#L265) | } |
| [266](#L266) |  |
| [267](#L267) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [268](#L268) | \* Actions for admin dashboard settings \* |
| [269](#L269) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [270](#L270) |  |
| [271](#L271) | /\*\* |
| [272](#L272) | \* Skip license activation. |
| [273](#L273) | \* |
| [274](#L274) | \* @deprecated 1.8.2 This method is no longer used. |
| [275](#L275) | \*/ |
| [276](#L276) | public static function wrld\_skip\_license\_activation() { |
| [277](#L277) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [278](#L278) | } |
| [279](#L279) |  |
| [280](#L280) | public static function wrld\_exclude\_settings\_save() { |
| [281](#L281) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [282](#L282) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [283](#L283) | if ( ! $nonce\_valid ) { |
| [284](#L284) | wp\_send\_json\_error( |
| [285](#L285) | array( |
| [286](#L286) | 'success' => true, |
| [287](#L287) | 'message' => \_\_( |
| [288](#L288) | 'Nonce verification failed', |
| [289](#L289) | 'learndash-reports-by-wisdmlabs' |
| [290](#L290) | ), |
| [291](#L291) | ) |
| [292](#L292) | ); |
| [293](#L293) | } |
| [294](#L294) |  |
| [295](#L295) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [296](#L296) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [297](#L297) | } |
| [298](#L298) |  |
| [299](#L299) | $type  = filter\_input( INPUT\_POST, 'type', FILTER\_SANITIZE\_STRING ); |
| [300](#L300) | $value = filter\_input( INPUT\_POST, 'value', FILTER\_DEFAULT, FILTER\_REQUIRE\_ARRAY ); |
| [301](#L301) |  |
| [302](#L302) | update\_option( 'exclude\_' . $type, $value ); |
| [303](#L303) |  |
| [304](#L304) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [305](#L305) | } |
| [306](#L306) |  |
| [307](#L307) | public static function apply\_time\_tracking\_settings() { |
| [308](#L308) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [309](#L309) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [310](#L310) | if ( ! $nonce\_valid ) { |
| [311](#L311) | wp\_send\_json\_error( |
| [312](#L312) | array( |
| [313](#L313) | 'success' => true, |
| [314](#L314) | 'message' => \_\_( |
| [315](#L315) | 'Nonce verification failed', |
| [316](#L316) | 'learndash-reports-by-wisdmlabs' |
| [317](#L317) | ), |
| [318](#L318) | ) |
| [319](#L319) | ); |
| [320](#L320) | } |
| [321](#L321) |  |
| [322](#L322) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [323](#L323) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [324](#L324) | } |
| [325](#L325) |  |
| [326](#L326) | $status   = filter\_input( INPUT\_POST, 'status', FILTER\_SANITIZE\_STRING ); |
| [327](#L327) | $timer    = filter\_input( INPUT\_POST, 'timeout', FILTER\_SANITIZE\_NUMBER\_INT ); |
| [328](#L328) | $message  = filter\_input( INPUT\_POST, 'message', FILTER\_SANITIZE\_STRING ); |
| [329](#L329) | $btnlabel = filter\_input( INPUT\_POST, 'btnlabel', FILTER\_SANITIZE\_STRING ); |
| [330](#L330) |  |
| [331](#L331) | if ( ! empty( $timer ) ) { |
| [332](#L332) | update\_option( 'wrld\_time\_tracking\_timer', $timer ); |
| [333](#L333) | } |
| [334](#L334) | if ( ! empty( $message ) ) { |
| [335](#L335) | update\_option( 'wrld\_time\_tracking\_message', $message ); |
| [336](#L336) | } |
| [337](#L337) | if ( ! empty( $btnlabel ) ) { |
| [338](#L338) | update\_option( 'wrld\_time\_tracking\_btnlabel', $btnlabel ); |
| [339](#L339) | } |
| [340](#L340) | if ( ! empty( $status ) ) { |
| [341](#L341) | $all\_updates  = get\_option( 'wrld\_time\_tracking\_log', false ); |
| [342](#L342) | $current\_time = current\_time( 'timestamp' ); |
| [343](#L343) | if ( ! empty( $all\_updates ) ) { |
| [344](#L344) | $all\_updates[] = $current\_time; |
| [345](#L345) | } else { |
| [346](#L346) | $all\_updates = array( $current\_time ); |
| [347](#L347) | } |
| [348](#L348) | update\_option( 'wrld\_time\_tracking\_status', $status ); |
| [349](#L349) | update\_option( 'wrld\_time\_tracking\_last\_update', $current\_time ); |
| [350](#L350) | update\_option( 'wrld\_time\_tracking\_log', $all\_updates ); |
| [351](#L351) | wp\_send\_json\_success( |
| [352](#L352) | array( |
| [353](#L353) | 'success' => true, |
| [354](#L354) | 'time'    => date\_i18n( |
| [355](#L355) | 'Y-m-d H:i:s', |
| [356](#L356) | $current\_time |
| [357](#L357) | ), |
| [358](#L358) | ) |
| [359](#L359) | ); |
| [360](#L360) | } |
| [361](#L361) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [362](#L362) |  |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | public static function wrld\_exclude\_load\_users() { |
| [366](#L366) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [367](#L367) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [368](#L368) | if ( ! $nonce\_valid ) { |
| [369](#L369) | wp\_send\_json\_error( |
| [370](#L370) | array( |
| [371](#L371) | 'success' => true, |
| [372](#L372) | 'message' => \_\_( |
| [373](#L373) | 'Nonce verification failed', |
| [374](#L374) | 'learndash-reports-by-wisdmlabs' |
| [375](#L375) | ), |
| [376](#L376) | ) |
| [377](#L377) | ); |
| [378](#L378) | } |
| [379](#L379) |  |
| [380](#L380) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [381](#L381) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [382](#L382) | } |
| [383](#L383) |  |
| [384](#L384) | $page   = filter\_input( INPUT\_POST, 'page', FILTER\_VALIDATE\_INT ); |
| [385](#L385) | $search = filter\_input( INPUT\_POST, 'search', FILTER\_SANITIZE\_STRING ); |
| [386](#L386) |  |
| [387](#L387) | if ( empty( $page ) ) { |
| [388](#L388) | $page = 1; |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | $args = array( |
| [392](#L392) | 'number'         => 10, |
| [393](#L393) | 'paged'          => $page, |
| [394](#L394) | 'search\_columns' => array( |
| [395](#L395) | 'user\_login', |
| [396](#L396) | 'user\_email', |
| [397](#L397) | 'user\_nicename', |
| [398](#L398) | 'display\_name', |
| [399](#L399) | ), |
| [400](#L400) | 'fields'         => array( |
| [401](#L401) | 'ID', |
| [402](#L402) | 'display\_name', |
| [403](#L403) | ), |
| [404](#L404) | ); |
| [405](#L405) |  |
| [406](#L406) | if ( ! empty( $search ) ) { |
| [407](#L407) | $args['search'] = '\*' . $search . '\*'; |
| [408](#L408) | } |
| [409](#L409) |  |
| [410](#L410) | $users = get\_users( $args ); |
| [411](#L411) | if ( empty( $users ) ) { |
| [412](#L412) | wp\_send\_json\_error(); |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | wp\_send\_json\_success( |
| [416](#L416) | array( |
| [417](#L417) | 'success' => true, |
| [418](#L418) | 'data'    => $users, |
| [419](#L419) | ) |
| [420](#L420) | ); |
| [421](#L421) | } |
| [422](#L422) |  |
| [423](#L423) | /\*\* |
| [424](#L424) | \* A function hooked to the ajax action wrld\_license\_activate, |
| [425](#L425) | \* resposible for initiating the activation request for the |
| [426](#L426) | \* reports pro plugin license key. |
| [427](#L427) | \* |
| [428](#L428) | \* @since 1.2.0 |
| [429](#L429) | \* @deprecated 1.8.2 This method is no longer used. |
| [430](#L430) | \*/ |
| [431](#L431) | public static function wrld\_license\_activate() { |
| [432](#L432) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [433](#L433) | } |
| [434](#L434) |  |
| [435](#L435) | /\*\* |
| [436](#L436) | \* A function hooked to the ajax action wrld\_license\_deactivate, |
| [437](#L437) | \* resposible for initiating the deactivation request for the |
| [438](#L438) | \* reports pro plugin license key. |
| [439](#L439) | \* |
| [440](#L440) | \* @since 1.2.0 |
| [441](#L441) | \* @deprecated 1.8.2 This method is no longer used. |
| [442](#L442) | \*/ |
| [443](#L443) | public static function wrld\_license\_deactivate() { |
| [444](#L444) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [445](#L445) | } |
| [446](#L446) |  |
| [447](#L447) | /\*\* |
| [448](#L448) | \* A function hooked to the ajax action wrld\_set\_configuration, |
| [449](#L449) | \* resposible for setting up the configuration which enables inclusion |
| [450](#L450) | \* of the reports page link in the primary menu. |
| [451](#L451) | \* |
| [452](#L452) | \* @since 1.2.0 |
| [453](#L453) | \*/ |
| [454](#L454) | public static function wrld\_set\_configuration() { |
| [455](#L455) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [456](#L456) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [457](#L457) | if ( ! $nonce\_valid ) { |
| [458](#L458) | wp\_send\_json\_error( |
| [459](#L459) | array( |
| [460](#L460) | 'success' => true, |
| [461](#L461) | 'message' => \_\_( |
| [462](#L462) | 'Nonce verification failed', |
| [463](#L463) | 'learndash-reports-by-wisdmlabs' |
| [464](#L464) | ), |
| [465](#L465) | ) |
| [466](#L466) | ); |
| [467](#L467) | } |
| [468](#L468) |  |
| [469](#L469) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [470](#L470) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [471](#L471) | } |
| [472](#L472) |  |
| [473](#L473) | $settings\_data = get\_option( 'wrld\_settings', array() ); |
| [474](#L474) | if ( isset( $\_REQUEST['add\_in\_menu'] ) ) { |
| [475](#L475) | $settings\_data['wrld-menu-config-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_in\_menu'] ) ); |
| [476](#L476) | } |
| [477](#L477) | if ( isset( $\_REQUEST['add\_student\_in\_menu'] ) ) { |
| [478](#L478) | $settings\_data['wrld-menu-student-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_student\_in\_menu'] ) ); |
| [479](#L479) | } |
| [480](#L480) | update\_option( 'wrld\_settings', $settings\_data ); |
| [481](#L481) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [482](#L482) | } |
| [483](#L483) |  |
| [484](#L484) | /\*\* |
| [485](#L485) | \* A function hooked to the ajax action wrld\_update\_settings, |
| [486](#L486) | \* resposible for setting up the configuration which enables inclusion |
| [487](#L487) | \* of the reports page link in the primary menu. |
| [488](#L488) | \* |
| [489](#L489) | \* @since 1.2.0 |
| [490](#L490) | \*/ |
| [491](#L491) | public static function wrld\_update\_settings() { |
| [492](#L492) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [493](#L493) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [494](#L494) | if ( ! $nonce\_valid ) { |
| [495](#L495) | wp\_send\_json\_error( |
| [496](#L496) | array( |
| [497](#L497) | 'success' => false, |
| [498](#L498) | 'message' => \_\_( |
| [499](#L499) | 'Nonce verification failed', |
| [500](#L500) | 'learndash-reports-by-wisdmlabs' |
| [501](#L501) | ), |
| [502](#L502) | ) |
| [503](#L503) | ); |
| [504](#L504) | } |
| [505](#L505) |  |
| [506](#L506) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [507](#L507) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [508](#L508) | } |
| [509](#L509) |  |
| [510](#L510) | $settings\_data = get\_option( 'wrld\_settings', array() ); |
| [511](#L511) | if ( isset( $\_REQUEST['access\_to\_group\_leader'] ) ) { |
| [512](#L512) | $access\_for\_group\_leader = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['access\_to\_group\_leader'] ) ); |
| [513](#L513) | } |
| [514](#L514) | if ( isset( $\_REQUEST['access\_to\_wdm\_instructor'] ) ) { |
| [515](#L515) | $access\_for\_wdm\_instructor = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['access\_to\_wdm\_instructor'] ) ); |
| [516](#L516) | } |
| [517](#L517) | if ( isset( $\_REQUEST['add\_in\_menu'] ) ) { |
| [518](#L518) | $settings\_data['wrld-menu-config-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_in\_menu'] ) ); |
| [519](#L519) | } |
| [520](#L520) | if ( isset( $\_REQUEST['add\_student\_in\_menu'] ) ) { |
| [521](#L521) | $settings\_data['wrld-menu-student-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_student\_in\_menu'] ) ); |
| [522](#L522) | } |
| [523](#L523) |  |
| [524](#L524) | if ( isset( $access\_for\_group\_leader ) || isset( $access\_for\_wdm\_instructor ) ) { |
| [525](#L525) | $settings\_data['dashboard-access-roles'] = array( |
| [526](#L526) | 'group\_leader'   => $access\_for\_group\_leader, |
| [527](#L527) | 'wdm\_instructor' => $access\_for\_wdm\_instructor, |
| [528](#L528) | ); |
| [529](#L529) | } |
| [530](#L530) | update\_option( 'wrld\_settings', $settings\_data ); |
| [531](#L531) | wp\_send\_json\_success( array( 'settings\_data' => $settings\_data ) ); |
| [532](#L532) |  |
| [533](#L533) | } |
| [534](#L534) |  |
| [535](#L535) | /\*\* |
| [536](#L536) | \* @deprecated 1.8.2 This method is no longer used. |
| [537](#L537) | \*/ |
| [538](#L538) | public function wrld\_license\_page\_visit() { |
| [539](#L539) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [540](#L540) | } |
| [541](#L541) |  |
| [542](#L542) | /\*\* |
| [543](#L543) | \* Add the Helpscout Beacon script on the Reports Settings backend pages. |
| [544](#L544) | \* Callback to action hook 'ldgr\_helpscout\_beacon'. |
| [545](#L545) | \* |
| [546](#L546) | \* @since 4.9.10 |
| [547](#L547) | \* @deprecated 1.8.2 This method is no longer used. |
| [548](#L548) | \*/ |
| [549](#L549) | public function wrld\_add\_beacon\_helpscout\_script() { |
| [550](#L550) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [551](#L551) | } |
| [552](#L552) |  |
| [553](#L553) | /\*\* |
| [554](#L554) | \* Calling function to the helpscout beacon. |
| [555](#L555) | \* Callback to action hook 'wrld\_helpscout\_beacon'. |
| [556](#L556) | \* |
| [557](#L557) | \* @since 4.9.10 |
| [558](#L558) | \* @deprecated 1.8.2 This method is no longer used. |
| [559](#L559) | \*/ |
| [560](#L560) | public function wrld\_load\_beacon\_helpscout() { |
| [561](#L561) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [562](#L562) | } |
| [563](#L563) |  |
| [564](#L564) | } |
| [565](#L565) |  |
| [566](#L566) | \WisdmReportsLearndash\Admin\_Functions::instance(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?format=txt)
* [Original Format](/export/3220658/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_dbae0c5d_20250111_102614.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwisdm-reports-for-learndash%2Ftrunk%2Fincludes%2Fadmin%2Fclass-admin-functions.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?rev=3083439 "Revision 3083439")
* Next Revision →
* [Blame](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php)

---

# [source:](/browser?order=name "Go to repository root") [wisdm-reports-for-learndash](/browser/wisdm-reports-for-learndash?order=name "View wisdm-reports-for-learndash")/[trunk](/browser/wisdm-reports-for-learndash/trunk?order=name "View trunk")/[includes](/browser/wisdm-reports-for-learndash/trunk/includes?order=name "View includes")/[admin](/browser/wisdm-reports-for-learndash/trunk/includes/admin?order=name "View admin")/[class-admin-functions.php](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?order=name "View class-admin-functions.php")

View diff against:

View revision:

| [Last change](/changeset/3119784/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php "View differences") on this file was [3119784](/changeset/3119784/ "View changeset 3119784"), checked in by stellarwp, [6 months ago](/timeline?from=2024-07-17T02%3A25%3A45Z&precision=second "See timeline at 07/17/2024 02:25:45 AM") |
| --- |
| Tag version 1.8.2.2 |
| **File size:** 18.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* This file contains the class admin functions. |
| [4](#L4) | \* |
| [5](#L5) | \* @package learndash-reports-by-wisdmlabs |
| [6](#L6) | \*/ |
| [7](#L7) |  |
| [8](#L8) | namespace WisdmReportsLearndash; |
| [9](#L9) |  |
| [10](#L10) | class Admin\_Functions { |
| [11](#L11) |  |
| [12](#L12) | protected static $instance = null; |
| [13](#L13) |  |
| [14](#L14) | /\*\* |
| [15](#L15) | \* This function has been used to create the static instance of the admin functions class. |
| [16](#L16) | \*/ |
| [17](#L17) | public static function instance() { |
| [18](#L18) | if ( is\_null( self::$instance ) ) { |
| [19](#L19) | self::$instance = new self(); |
| [20](#L20) | } |
| [21](#L21) | return self::$instance; |
| [22](#L22) | } |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* This is the constructor for the class that will instantiate all processes related to the class. |
| [26](#L26) | \*/ |
| [27](#L27) | public function \_\_construct() { |
| [28](#L28) | $this->init\_hooks(); |
| [29](#L29) | } |
| [30](#L30) |  |
| [31](#L31) | /\*\* |
| [32](#L32) | \* This method is used to add all the admin related actions and filter hooks. |
| [33](#L33) | \*/ |
| [34](#L34) | public function init\_hooks() { |
| [35](#L35) | add\_action( 'wp\_ajax\_wrld\_page\_visit', array( $this, 'update\_reporting\_page\_visit' ) ); |
| [36](#L36) | add\_action( 'wp\_ajax\_wrld\_gutenberg\_block\_visit', array( $this, 'wp\_ajax\_wrld\_gutenberg\_block\_visit' ) ); |
| [37](#L37) | add\_action( 'wp\_ajax\_wrld\_notice\_action', array( $this, 'wrld\_notice\_action' ) ); |
| [38](#L38) | add\_action( 'init', array( $this, 'wrld\_create\_patterns\_page' ), 99 ); |
| [39](#L39) | add\_action( 'init', array( $this, 'wrld\_create\_student\_patterns\_page' ), 99 ); |
| [40](#L40) | // settings page ajax actions |
| [41](#L41) | add\_action( 'wp\_ajax\_wrld\_set\_configuration', array( $this, 'wrld\_set\_configuration' ) ); |
| [42](#L42) | add\_action( 'wp\_ajax\_wrld\_update\_settings', array( $this, 'wrld\_update\_settings' ) ); |
| [43](#L43) | add\_action( 'wp\_ajax\_wrld\_exclude\_settings\_save', array( $this, 'wrld\_exclude\_settings\_save' ) ); |
| [44](#L44) | add\_action( 'wp\_ajax\_apply\_time\_tracking\_settings', array( $this, 'apply\_time\_tracking\_settings' ) ); |
| [45](#L45) | add\_action( 'wp\_ajax\_wrld\_exclude\_load\_users', array( $this, 'wrld\_exclude\_load\_users' ) ); |
| [46](#L46) | // Welcome modal |
| [47](#L47) | add\_action( 'wp\_ajax\_wrld\_welcome\_modal\_action', array( $this, 'wrld\_welcome\_modal\_action' ) ); |
| [48](#L48) | add\_action( 'wp\_ajax\_wrld\_autoupdate\_dashboard', array( $this, 'wrld\_autoupdate\_dashboard' ) ); |
| [49](#L49) | // add\_action( 'admin\_notices', array( $this, 'wrld\_pattern\_update\_notice' ) ); |
| [50](#L50) | } |
| [51](#L51) |  |
| [52](#L52) | public static function wp\_ajax\_wrld\_gutenberg\_block\_visit() { |
| [53](#L53) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [54](#L54) |  |
| [55](#L55) | if ( ! wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ) ) { |
| [56](#L56) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [60](#L60) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [61](#L61) | } |
| [62](#L62) |  |
| [63](#L63) | $option\_key = isset( $\_REQUEST['option\_key'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['option\_key'] ) ) : null; |
| [64](#L64) |  |
| [65](#L65) | if ( empty( $option\_key ) ) { |
| [66](#L66) | wp\_send\_json\_error( esc\_html\_\_( 'Invalid option key.', 'learndash-reports-by-wisdmlabs' ) ); |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | update\_option( $option\_key, true ); |
| [70](#L70) |  |
| [71](#L71) | wp\_send\_json\_success( |
| [72](#L72) | array( |
| [73](#L73) | 'updated' => $option\_key, |
| [74](#L74) | ) |
| [75](#L75) | ); |
| [76](#L76) | } |
| [77](#L77) |  |
| [78](#L78) | public function wrld\_pattern\_update\_notice() { |
| [79](#L79) | // phpcs:ignore WordPress.Security.NonceVerification.Recommended -- Data is not used for action or DB query. |
| [80](#L80) | if ( ! isset( $\_GET['updated\_pattern'] ) ) { |
| [81](#L81) | return; |
| [82](#L82) | } |
| [83](#L83) | echo "<div class='notice notice-success'> |
| [84](#L84) | <p>Dashboard Page successfully updated.</p> |
| [85](#L85) | </div>"; |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | public function wrld\_autoupdate\_dashboard() { |
| [89](#L89) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [90](#L90) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [91](#L91) | if ( ! $nonce\_valid ) { |
| [92](#L92) | wp\_send\_json\_error( |
| [93](#L93) | array( |
| [94](#L94) | 'success' => true, |
| [95](#L95) | 'message' => \_\_( |
| [96](#L96) | 'Nonce verification failed', |
| [97](#L97) | 'learndash-reports-by-wisdmlabs' |
| [98](#L98) | ), |
| [99](#L99) | ) |
| [100](#L100) | ); |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [104](#L104) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [105](#L105) | } |
| [106](#L106) |  |
| [107](#L107) | global $wrld\_pattern; |
| [108](#L108) | $reports\_page = get\_option( 'ldrp\_reporting\_page', false ); |
| [109](#L109) | $data         = array( |
| [110](#L110) | 'ID'           => $reports\_page, |
| [111](#L111) | 'post\_content' => $wrld\_pattern, |
| [112](#L112) | ); |
| [113](#L113) | wp\_update\_post( $data ); |
| [114](#L114) | wp\_send\_json\_success( |
| [115](#L115) | array( |
| [116](#L116) | 'url' => add\_query\_arg( |
| [117](#L117) | array( |
| [118](#L118) | 'updated\_pattern' => 1, |
| [119](#L119) | 'dla\_op'          => true, |
| [120](#L120) | 'dla\_oq'          => true, |
| [121](#L121) | ), |
| [122](#L122) | get\_permalink( $reports\_page ) |
| [123](#L123) | ), |
| [124](#L124) | ) |
| [125](#L125) | ); |
| [126](#L126) | die(); |
| [127](#L127) | } |
| [128](#L128) |  |
| [129](#L129) | /\*\* |
| [130](#L130) | \* This action is hooked to the ajax callback action 'wp\_ajax\_wrld\_page\_visit', |
| [131](#L131) | \* on called verifies if the request is from the correct source & update teh value for the |
| [132](#L132) | \* option 'wrld\_reporting\_page\_visited'. |
| [133](#L133) | \*/ |
| [134](#L134) | public static function update\_reporting\_page\_visit() { |
| [135](#L135) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [136](#L136) | if ( wp\_verify\_nonce( $nonce, 'reports-firrst-install-modal' ) ) { |
| [137](#L137) | // update\_option( 'wrld\_reporting\_page\_visited', 2 ); |
| [138](#L138) | wp\_send\_json\_success(); |
| [139](#L139) | } |
| [140](#L140) | wp\_send\_json\_error(); |
| [141](#L141) | } |
| [142](#L142) |  |
| [143](#L143) |  |
| [144](#L144) | /\*\* |
| [145](#L145) | \* This action is hooked to the ajax callback action 'wp\_ajax\_wrld\_notice\_action', |
| [146](#L146) | \* on called verifies if the request is from the correct source & update the value for the |
| [147](#L147) | \* option 'wrld\_last\_skipped\_on'. |
| [148](#L148) | \*/ |
| [149](#L149) | public static function wrld\_notice\_action() { |
| [150](#L150) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [151](#L151) | if ( wp\_verify\_nonce( $nonce, 'wrld-review-notice' ) ) { |
| [152](#L152) | $user\_action = sanitize\_text\_field( wp\_unslash( $\_REQUEST['user\_action'] ) ); |
| [153](#L153) | switch ( $user\_action ) { |
| [154](#L154) | case 'wisdm-reports-for-ld-remind-later': |
| [155](#L155) | case 'wisdm-reports-for-ld-post-review': |
| [156](#L156) | case 'close': |
| [157](#L157) | update\_option( 'wrld\_last\_skipped\_on', time() ); |
| [158](#L158) | break; |
| [159](#L159) | default: |
| [160](#L160) | update\_option( 'ld-reports-review-dismissed', time() ); |
| [161](#L161) | break; |
| [162](#L162) | } |
| [163](#L163) | wp\_send\_json\_success(); |
| [164](#L164) | } |
| [165](#L165) | wp\_send\_json\_error(); |
| [166](#L166) | } |
| [167](#L167) |  |
| [168](#L168) | public function show\_wisdm\_reports\_submenu() { |
| [169](#L169) | ?> |
| [170](#L170) | <div class="wrap"> |
| [171](#L171) | <h1><?php esc\_html\_e( 'Reports', 'learndash-reports-by-wisdmlabs' ); ?></h1> |
| [172](#L172) | <?php |
| [173](#L173) | $dashboard\_id = get\_option( 'ldrp\_reporting\_page', false ); |
| [174](#L174) | if ( ! $dashboard\_id || 'publish' !== get\_post\_status( $dashboard\_id ) ) { |
| [175](#L175) | ?> |
| [176](#L176) | <p><?php esc\_html\_e( 'The page seems to have been deleted/removed. Please click on the link below to create the page manually.', 'learndash-reports-by-wisdmlabs' ); ?> |
| [177](#L177) | </p> |
| [178](#L178) | <a |
| [179](#L179) | href="<?php echo esc\_attr( add\_query\_arg( array( 'create\_wisdm\_reports' => true ) ) ); ?>"><?php esc\_html\_e( 'Create Reports Dashboard', 'learndash-reports-by-wisdmlabs' ); ?></a> |
| [180](#L180) | <?php |
| [181](#L181) | } else { |
| [182](#L182) | ?> |
| [183](#L183) | <p><a class="primary-button primary-btn components-button is-primary" |
| [184](#L184) | href="<?php echo esc\_url( get\_permalink( $dashboard\_id ) ); ?>" target="\_blank" |
| [185](#L185) | style="background:#007cba;color:#fff;text-decoration:none;text-shadow:none;outline:1px solid transparent;padding:6px 12px;border-radius:2px;"><?php esc\_html\_e( 'Launch Reports Dashboard', 'learndash-reports-by-wisdmlabs' ); ?></a> |
| [186](#L186) | </p> |
| [187](#L187) | <?php |
| [188](#L188) | } |
| [189](#L189) | ?> |
| [190](#L190) | </div> |
| [191](#L191) | <?php |
| [192](#L192) | } |
| [193](#L193) |  |
| [194](#L194) | /\*\* |
| [195](#L195) | \* This function creates the page with the default WRLD pattern when a get parameter 'create\_wisdm\_reports' is set. |
| [196](#L196) | \*/ |
| [197](#L197) | public function wrld\_create\_patterns\_page() { |
| [198](#L198) | $new\_page\_creation = filter\_input( INPUT\_GET, 'create\_wisdm\_reports', FILTER\_VALIDATE\_BOOLEAN ); |
| [199](#L199) | $created\_page      = get\_option( 'ldrp\_reporting\_page', false ); |
| [200](#L200) |  |
| [201](#L201) | if ( $created\_page && 'publish' !== get\_post\_status( $created\_page ) ) { |
| [202](#L202) | if ( ! empty( $new\_page\_creation ) ) { |
| [203](#L203) | wrld\_create\_patterns\_page( true ); |
| [204](#L204) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_page\_creation\_notice' ); |
| [205](#L205) | } |
| [206](#L206) | } elseif ( false == $created\_page ) { |
| [207](#L207) | wrld\_create\_patterns\_page( false ); |
| [208](#L208) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_page\_creation\_notice' ); |
| [209](#L209) | } |
| [210](#L210) | } |
| [211](#L211) | /\*\* |
| [212](#L212) | \* This function creates the page with the default WRLD pattern when a get parameter 'create\_wisdm\_reports' is set. |
| [213](#L213) | \*/ |
| [214](#L214) | public function wrld\_create\_student\_patterns\_page() { |
| [215](#L215) | $new\_page\_creation = filter\_input( INPUT\_GET, 'create\_student\_reports', FILTER\_VALIDATE\_BOOLEAN ); |
| [216](#L216) | $created\_page      = get\_option( 'ldrp\_student\_page', false ); |
| [217](#L217) |  |
| [218](#L218) | if ( $created\_page && 'publish' !== get\_post\_status( $created\_page ) ) { |
| [219](#L219) | if ( ! empty( $new\_page\_creation ) ) { |
| [220](#L220) | wrld\_create\_student\_patterns\_page( true ); |
| [221](#L221) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_student\_page\_creation\_notice' ); |
| [222](#L222) | } |
| [223](#L223) | } elseif ( false == $created\_page ) { |
| [224](#L224) | wrld\_create\_student\_patterns\_page( false ); |
| [225](#L225) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_student\_page\_creation\_notice' ); |
| [226](#L226) | } |
| [227](#L227) | } |
| [228](#L228) |  |
| [229](#L229) | /\*\* |
| [230](#L230) | \* The function checks if the plugin specified is installed on the website. |
| [231](#L231) | \* - Currently works only for the WordPress single site. |
| [232](#L232) | \* |
| [233](#L233) | \* @param $plugin\_slug plugin path and plugin file name, ex : learndash-reports-pro/learndash-reports-pro.php. |
| [234](#L234) | \*/ |
| [235](#L235) | public static function is\_plugin\_installed( $plugin\_slug ) { |
| [236](#L236) | if ( empty( $plugin\_slug ) ) { |
| [237](#L237) | return false; |
| [238](#L238) | } |
| [239](#L239) |  |
| [240](#L240) | // Check if needed functions exists - if not, require them |
| [241](#L241) | if ( ! function\_exists( 'get\_plugins' ) || ! function\_exists( 'is\_plugin\_active' ) ) { |
| [242](#L242) | require\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
| [243](#L243) | } |
| [244](#L244) |  |
| [245](#L245) | $installed\_plugins = get\_plugins(); |
| [246](#L246) | return array\_key\_exists( $plugin\_slug, $installed\_plugins ) || in\_array( $plugin\_slug, $installed\_plugins, true ); |
| [247](#L247) | } |
| [248](#L248) |  |
| [249](#L249) | /\*\* |
| [250](#L250) | \* Shows admin a notice on the admin dashboard. |
| [251](#L251) | \*/ |
| [252](#L252) | public static function report\_page\_creation\_notice() { |
| [253](#L253) | echo '<div class="notice notice-success is-dismissible"><p>'; |
| [254](#L254) | echo esc\_html\_\_( 'Successfully created Reports For LearnDash page', 'learndash-reports-by-wisdmlabs' ); |
| [255](#L255) | echo '</p></div>'; |
| [256](#L256) | } |
| [257](#L257) |  |
| [258](#L258) | /\*\* |
| [259](#L259) | \* Shows admin a notice on the admin dashboard. |
| [260](#L260) | \*/ |
| [261](#L261) | public static function report\_student\_page\_creation\_notice() { |
| [262](#L262) | echo '<div class="notice notice-success is-dismissible"><p>'; |
| [263](#L263) | echo esc\_html\_\_( 'Successfully created Reports For LearnDash Student Quiz Reports page', 'learndash-reports-by-wisdmlabs' ); |
| [264](#L264) | echo '</p></div>'; |
| [265](#L265) | } |
| [266](#L266) |  |
| [267](#L267) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [268](#L268) | \* Actions for admin dashboard settings \* |
| [269](#L269) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [270](#L270) |  |
| [271](#L271) | /\*\* |
| [272](#L272) | \* Skip license activation. |
| [273](#L273) | \* |
| [274](#L274) | \* @deprecated 1.8.2 This method is no longer used. |
| [275](#L275) | \*/ |
| [276](#L276) | public static function wrld\_skip\_license\_activation() { |
| [277](#L277) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [278](#L278) | } |
| [279](#L279) |  |
| [280](#L280) | public static function wrld\_exclude\_settings\_save() { |
| [281](#L281) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [282](#L282) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [283](#L283) | if ( ! $nonce\_valid ) { |
| [284](#L284) | wp\_send\_json\_error( |
| [285](#L285) | array( |
| [286](#L286) | 'success' => true, |
| [287](#L287) | 'message' => \_\_( |
| [288](#L288) | 'Nonce verification failed', |
| [289](#L289) | 'learndash-reports-by-wisdmlabs' |
| [290](#L290) | ), |
| [291](#L291) | ) |
| [292](#L292) | ); |
| [293](#L293) | } |
| [294](#L294) |  |
| [295](#L295) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [296](#L296) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [297](#L297) | } |
| [298](#L298) |  |
| [299](#L299) | $type  = filter\_input( INPUT\_POST, 'type', FILTER\_SANITIZE\_STRING ); |
| [300](#L300) | $value = filter\_input( INPUT\_POST, 'value', FILTER\_DEFAULT, FILTER\_REQUIRE\_ARRAY ); |
| [301](#L301) |  |
| [302](#L302) | update\_option( 'exclude\_' . $type, $value ); |
| [303](#L303) |  |
| [304](#L304) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [305](#L305) | } |
| [306](#L306) |  |
| [307](#L307) | public static function apply\_time\_tracking\_settings() { |
| [308](#L308) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [309](#L309) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [310](#L310) | if ( ! $nonce\_valid ) { |
| [311](#L311) | wp\_send\_json\_error( |
| [312](#L312) | array( |
| [313](#L313) | 'success' => true, |
| [314](#L314) | 'message' => \_\_( |
| [315](#L315) | 'Nonce verification failed', |
| [316](#L316) | 'learndash-reports-by-wisdmlabs' |
| [317](#L317) | ), |
| [318](#L318) | ) |
| [319](#L319) | ); |
| [320](#L320) | } |
| [321](#L321) |  |
| [322](#L322) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [323](#L323) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [324](#L324) | } |
| [325](#L325) |  |
| [326](#L326) | $status   = filter\_input( INPUT\_POST, 'status', FILTER\_SANITIZE\_STRING ); |
| [327](#L327) | $timer    = filter\_input( INPUT\_POST, 'timeout', FILTER\_SANITIZE\_NUMBER\_INT ); |
| [328](#L328) | $message  = filter\_input( INPUT\_POST, 'message', FILTER\_SANITIZE\_STRING ); |
| [329](#L329) | $btnlabel = filter\_input( INPUT\_POST, 'btnlabel', FILTER\_SANITIZE\_STRING ); |
| [330](#L330) |  |
| [331](#L331) | if ( ! empty( $timer ) ) { |
| [332](#L332) | update\_option( 'wrld\_time\_tracking\_timer', $timer ); |
| [333](#L333) | } |
| [334](#L334) | if ( ! empty( $message ) ) { |
| [335](#L335) | update\_option( 'wrld\_time\_tracking\_message', $message ); |
| [336](#L336) | } |
| [337](#L337) | if ( ! empty( $btnlabel ) ) { |
| [338](#L338) | update\_option( 'wrld\_time\_tracking\_btnlabel', $btnlabel ); |
| [339](#L339) | } |
| [340](#L340) | if ( ! empty( $status ) ) { |
| [341](#L341) | $all\_updates  = get\_option( 'wrld\_time\_tracking\_log', false ); |
| [342](#L342) | $current\_time = current\_time( 'timestamp' ); |
| [343](#L343) | if ( ! empty( $all\_updates ) ) { |
| [344](#L344) | $all\_updates[] = $current\_time; |
| [345](#L345) | } else { |
| [346](#L346) | $all\_updates = array( $current\_time ); |
| [347](#L347) | } |
| [348](#L348) | update\_option( 'wrld\_time\_tracking\_status', $status ); |
| [349](#L349) | update\_option( 'wrld\_time\_tracking\_last\_update', $current\_time ); |
| [350](#L350) | update\_option( 'wrld\_time\_tracking\_log', $all\_updates ); |
| [351](#L351) | wp\_send\_json\_success( |
| [352](#L352) | array( |
| [353](#L353) | 'success' => true, |
| [354](#L354) | 'time'    => date\_i18n( |
| [355](#L355) | 'Y-m-d H:i:s', |
| [356](#L356) | $current\_time |
| [357](#L357) | ), |
| [358](#L358) | ) |
| [359](#L359) | ); |
| [360](#L360) | } |
| [361](#L361) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [362](#L362) |  |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | public static function wrld\_exclude\_load\_users() { |
| [366](#L366) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [367](#L367) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [368](#L368) | if ( ! $nonce\_valid ) { |
| [369](#L369) | wp\_send\_json\_error( |
| [370](#L370) | array( |
| [371](#L371) | 'success' => true, |
| [372](#L372) | 'message' => \_\_( |
| [373](#L373) | 'Nonce verification failed', |
| [374](#L374) | 'learndash-reports-by-wisdmlabs' |
| [375](#L375) | ), |
| [376](#L376) | ) |
| [377](#L377) | ); |
| [378](#L378) | } |
| [379](#L379) |  |
| [380](#L380) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [381](#L381) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [382](#L382) | } |
| [383](#L383) |  |
| [384](#L384) | $page   = filter\_input( INPUT\_POST, 'page', FILTER\_VALIDATE\_INT ); |
| [385](#L385) | $search = filter\_input( INPUT\_POST, 'search', FILTER\_SANITIZE\_STRING ); |
| [386](#L386) |  |
| [387](#L387) | if ( empty( $page ) ) { |
| [388](#L388) | $page = 1; |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | $args = array( |
| [392](#L392) | 'number'         => 10, |
| [393](#L393) | 'paged'          => $page, |
| [394](#L394) | 'search\_columns' => array( |
| [395](#L395) | 'user\_login', |
| [396](#L396) | 'user\_email', |
| [397](#L397) | 'user\_nicename', |
| [398](#L398) | 'display\_name', |
| [399](#L399) | ), |
| [400](#L400) | 'fields'         => array( |
| [401](#L401) | 'ID', |
| [402](#L402) | 'display\_name', |
| [403](#L403) | ), |
| [404](#L404) | ); |
| [405](#L405) |  |
| [406](#L406) | if ( ! empty( $search ) ) { |
| [407](#L407) | $args['search'] = '\*' . $search . '\*'; |
| [408](#L408) | } |
| [409](#L409) |  |
| [410](#L410) | $users = get\_users( $args ); |
| [411](#L411) | if ( empty( $users ) ) { |
| [412](#L412) | wp\_send\_json\_error(); |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | wp\_send\_json\_success( |
| [416](#L416) | array( |
| [417](#L417) | 'success' => true, |
| [418](#L418) | 'data'    => $users, |
| [419](#L419) | ) |
| [420](#L420) | ); |
| [421](#L421) | } |
| [422](#L422) |  |
| [423](#L423) | /\*\* |
| [424](#L424) | \* A function hooked to the ajax action wrld\_license\_activate, |
| [425](#L425) | \* resposible for initiating the activation request for the |
| [426](#L426) | \* reports pro plugin license key. |
| [427](#L427) | \* |
| [428](#L428) | \* @since 1.2.0 |
| [429](#L429) | \* @deprecated 1.8.2 This method is no longer used. |
| [430](#L430) | \*/ |
| [431](#L431) | public static function wrld\_license\_activate() { |
| [432](#L432) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [433](#L433) | } |
| [434](#L434) |  |
| [435](#L435) | /\*\* |
| [436](#L436) | \* A function hooked to the ajax action wrld\_license\_deactivate, |
| [437](#L437) | \* resposible for initiating the deactivation request for the |
| [438](#L438) | \* reports pro plugin license key. |
| [439](#L439) | \* |
| [440](#L440) | \* @since 1.2.0 |
| [441](#L441) | \* @deprecated 1.8.2 This method is no longer used. |
| [442](#L442) | \*/ |
| [443](#L443) | public static function wrld\_license\_deactivate() { |
| [444](#L444) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [445](#L445) | } |
| [446](#L446) |  |
| [447](#L447) | /\*\* |
| [448](#L448) | \* A function hooked to the ajax action wrld\_set\_configuration, |
| [449](#L449) | \* resposible for setting up the configuration which enables inclusion |
| [450](#L450) | \* of the reports page link in the primary menu. |
| [451](#L451) | \* |
| [452](#L452) | \* @since 1.2.0 |
| [453](#L453) | \*/ |
| [454](#L454) | public static function wrld\_set\_configuration() { |
| [455](#L455) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [456](#L456) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [457](#L457) | if ( ! $nonce\_valid ) { |
| [458](#L458) | wp\_send\_json\_error( |
| [459](#L459) | array( |
| [460](#L460) | 'success' => true, |
| [461](#L461) | 'message' => \_\_( |
| [462](#L462) | 'Nonce verification failed', |
| [463](#L463) | 'learndash-reports-by-wisdmlabs' |
| [464](#L464) | ), |
| [465](#L465) | ) |
| [466](#L466) | ); |
| [467](#L467) | } |
| [468](#L468) |  |
| [469](#L469) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [470](#L470) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [471](#L471) | } |
| [472](#L472) |  |
| [473](#L473) | $settings\_data = get\_option( 'wrld\_settings', array() ); |
| [474](#L474) | if ( isset( $\_REQUEST['add\_in\_menu'] ) ) { |
| [475](#L475) | $settings\_data['wrld-menu-config-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_in\_menu'] ) ); |
| [476](#L476) | } |
| [477](#L477) | if ( isset( $\_REQUEST['add\_student\_in\_menu'] ) ) { |
| [478](#L478) | $settings\_data['wrld-menu-student-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_student\_in\_menu'] ) ); |
| [479](#L479) | } |
| [480](#L480) | update\_option( 'wrld\_settings', $settings\_data ); |
| [481](#L481) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [482](#L482) | } |
| [483](#L483) |  |
| [484](#L484) | /\*\* |
| [485](#L485) | \* A function hooked to the ajax action wrld\_update\_settings, |
| [486](#L486) | \* resposible for setting up the configuration which enables inclusion |
| [487](#L487) | \* of the reports page link in the primary menu. |
| [488](#L488) | \* |
| [489](#L489) | \* @since 1.2.0 |
| [490](#L490) | \*/ |
| [491](#L491) | public static function wrld\_update\_settings() { |
| [492](#L492) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [493](#L493) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [494](#L494) | if ( ! $nonce\_valid ) { |
| [495](#L495) | wp\_send\_json\_error( |
| [496](#L496) | array( |
| [497](#L497) | 'success' => false, |
| [498](#L498) | 'message' => \_\_( |
| [499](#L499) | 'Nonce verification failed', |
| [500](#L500) | 'learndash-reports-by-wisdmlabs' |
| [501](#L501) | ), |
| [502](#L502) | ) |
| [503](#L503) | ); |
| [504](#L504) | } |
| [505](#L505) |  |
| [506](#L506) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [507](#L507) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [508](#L508) | } |
| [509](#L509) |  |
| [510](#L510) | $settings\_data = get\_option( 'wrld\_settings', array() ); |
| [511](#L511) | if ( isset( $\_REQUEST['access\_to\_group\_leader'] ) ) { |
| [512](#L512) | $access\_for\_group\_leader = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['access\_to\_group\_leader'] ) ); |
| [513](#L513) | } |
| [514](#L514) | if ( isset( $\_REQUEST['access\_to\_wdm\_instructor'] ) ) { |
| [515](#L515) | $access\_for\_wdm\_instructor = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['access\_to\_wdm\_instructor'] ) ); |
| [516](#L516) | } |
| [517](#L517) | if ( isset( $\_REQUEST['add\_in\_menu'] ) ) { |
| [518](#L518) | $settings\_data['wrld-menu-config-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_in\_menu'] ) ); |
| [519](#L519) | } |
| [520](#L520) | if ( isset( $\_REQUEST['add\_student\_in\_menu'] ) ) { |
| [521](#L521) | $settings\_data['wrld-menu-student-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_student\_in\_menu'] ) ); |
| [522](#L522) | } |
| [523](#L523) |  |
| [524](#L524) | if ( isset( $access\_for\_group\_leader ) || isset( $access\_for\_wdm\_instructor ) ) { |
| [525](#L525) | $settings\_data['dashboard-access-roles'] = array( |
| [526](#L526) | 'group\_leader'   => $access\_for\_group\_leader, |
| [527](#L527) | 'wdm\_instructor' => $access\_for\_wdm\_instructor, |
| [528](#L528) | ); |
| [529](#L529) | } |
| [530](#L530) | update\_option( 'wrld\_settings', $settings\_data ); |
| [531](#L531) | wp\_send\_json\_success( array( 'settings\_data' => $settings\_data ) ); |
| [532](#L532) |  |
| [533](#L533) | } |
| [534](#L534) |  |
| [535](#L535) | /\*\* |
| [536](#L536) | \* @deprecated 1.8.2 This method is no longer used. |
| [537](#L537) | \*/ |
| [538](#L538) | public function wrld\_license\_page\_visit() { |
| [539](#L539) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [540](#L540) | } |
| [541](#L541) |  |
| [542](#L542) | /\*\* |
| [543](#L543) | \* Add the Helpscout Beacon script on the Reports Settings backend pages. |
| [544](#L544) | \* Callback to action hook 'ldgr\_helpscout\_beacon'. |
| [545](#L545) | \* |
| [546](#L546) | \* @since 4.9.10 |
| [547](#L547) | \* @deprecated 1.8.2 This method is no longer used. |
| [548](#L548) | \*/ |
| [549](#L549) | public function wrld\_add\_beacon\_helpscout\_script() { |
| [550](#L550) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [551](#L551) | } |
| [552](#L552) |  |
| [553](#L553) | /\*\* |
| [554](#L554) | \* Calling function to the helpscout beacon. |
| [555](#L555) | \* Callback to action hook 'wrld\_helpscout\_beacon'. |
| [556](#L556) | \* |
| [557](#L557) | \* @since 4.9.10 |
| [558](#L558) | \* @deprecated 1.8.2 This method is no longer used. |
| [559](#L559) | \*/ |
| [560](#L560) | public function wrld\_load\_beacon\_helpscout() { |
| [561](#L561) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [562](#L562) | } |
| [563](#L563) |  |
| [564](#L564) | } |
| [565](#L565) |  |
| [566](#L566) | \WisdmReportsLearndash\Admin\_Functions::instance(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?format=txt)
* [Original Format](/export/3220658/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_ae64f066_20250111_102612.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwisdm-reports-for-learndash%2Ftrunk%2Fincludes%2Fadmin%2Fclass-admin-functions.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?rev=3083439 "Revision 3083439")
* Next Revision →
* [Blame](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php)

---

# [source:](/browser?order=name "Go to repository root") [wisdm-reports-for-learndash](/browser/wisdm-reports-for-learndash?order=name "View wisdm-reports-for-learndash")/[trunk](/browser/wisdm-reports-for-learndash/trunk?order=name "View trunk")/[includes](/browser/wisdm-reports-for-learndash/trunk/includes?order=name "View includes")/[admin](/browser/wisdm-reports-for-learndash/trunk/includes/admin?order=name "View admin")/[class-admin-functions.php](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?order=name "View class-admin-functions.php")

View diff against:

View revision:

| [Last change](/changeset/3119784/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php "View differences") on this file was [3119784](/changeset/3119784/ "View changeset 3119784"), checked in by stellarwp, [6 months ago](/timeline?from=2024-07-17T02%3A25%3A45Z&precision=second "See timeline at 07/17/2024 02:25:45 AM") |
| --- |
| Tag version 1.8.2.2 |
| **File size:** 18.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* This file contains the class admin functions. |
| [4](#L4) | \* |
| [5](#L5) | \* @package learndash-reports-by-wisdmlabs |
| [6](#L6) | \*/ |
| [7](#L7) |  |
| [8](#L8) | namespace WisdmReportsLearndash; |
| [9](#L9) |  |
| [10](#L10) | class Admin\_Functions { |
| [11](#L11) |  |
| [12](#L12) | protected static $instance = null; |
| [13](#L13) |  |
| [14](#L14) | /\*\* |
| [15](#L15) | \* This function has been used to create the static instance of the admin functions class. |
| [16](#L16) | \*/ |
| [17](#L17) | public static function instance() { |
| [18](#L18) | if ( is\_null( self::$instance ) ) { |
| [19](#L19) | self::$instance = new self(); |
| [20](#L20) | } |
| [21](#L21) | return self::$instance; |
| [22](#L22) | } |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* This is the constructor for the class that will instantiate all processes related to the class. |
| [26](#L26) | \*/ |
| [27](#L27) | public function \_\_construct() { |
| [28](#L28) | $this->init\_hooks(); |
| [29](#L29) | } |
| [30](#L30) |  |
| [31](#L31) | /\*\* |
| [32](#L32) | \* This method is used to add all the admin related actions and filter hooks. |
| [33](#L33) | \*/ |
| [34](#L34) | public function init\_hooks() { |
| [35](#L35) | add\_action( 'wp\_ajax\_wrld\_page\_visit', array( $this, 'update\_reporting\_page\_visit' ) ); |
| [36](#L36) | add\_action( 'wp\_ajax\_wrld\_gutenberg\_block\_visit', array( $this, 'wp\_ajax\_wrld\_gutenberg\_block\_visit' ) ); |
| [37](#L37) | add\_action( 'wp\_ajax\_wrld\_notice\_action', array( $this, 'wrld\_notice\_action' ) ); |
| [38](#L38) | add\_action( 'init', array( $this, 'wrld\_create\_patterns\_page' ), 99 ); |
| [39](#L39) | add\_action( 'init', array( $this, 'wrld\_create\_student\_patterns\_page' ), 99 ); |
| [40](#L40) | // settings page ajax actions |
| [41](#L41) | add\_action( 'wp\_ajax\_wrld\_set\_configuration', array( $this, 'wrld\_set\_configuration' ) ); |
| [42](#L42) | add\_action( 'wp\_ajax\_wrld\_update\_settings', array( $this, 'wrld\_update\_settings' ) ); |
| [43](#L43) | add\_action( 'wp\_ajax\_wrld\_exclude\_settings\_save', array( $this, 'wrld\_exclude\_settings\_save' ) ); |
| [44](#L44) | add\_action( 'wp\_ajax\_apply\_time\_tracking\_settings', array( $this, 'apply\_time\_tracking\_settings' ) ); |
| [45](#L45) | add\_action( 'wp\_ajax\_wrld\_exclude\_load\_users', array( $this, 'wrld\_exclude\_load\_users' ) ); |
| [46](#L46) | // Welcome modal |
| [47](#L47) | add\_action( 'wp\_ajax\_wrld\_welcome\_modal\_action', array( $this, 'wrld\_welcome\_modal\_action' ) ); |
| [48](#L48) | add\_action( 'wp\_ajax\_wrld\_autoupdate\_dashboard', array( $this, 'wrld\_autoupdate\_dashboard' ) ); |
| [49](#L49) | // add\_action( 'admin\_notices', array( $this, 'wrld\_pattern\_update\_notice' ) ); |
| [50](#L50) | } |
| [51](#L51) |  |
| [52](#L52) | public static function wp\_ajax\_wrld\_gutenberg\_block\_visit() { |
| [53](#L53) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [54](#L54) |  |
| [55](#L55) | if ( ! wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ) ) { |
| [56](#L56) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [60](#L60) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [61](#L61) | } |
| [62](#L62) |  |
| [63](#L63) | $option\_key = isset( $\_REQUEST['option\_key'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['option\_key'] ) ) : null; |
| [64](#L64) |  |
| [65](#L65) | if ( empty( $option\_key ) ) { |
| [66](#L66) | wp\_send\_json\_error( esc\_html\_\_( 'Invalid option key.', 'learndash-reports-by-wisdmlabs' ) ); |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | update\_option( $option\_key, true ); |
| [70](#L70) |  |
| [71](#L71) | wp\_send\_json\_success( |
| [72](#L72) | array( |
| [73](#L73) | 'updated' => $option\_key, |
| [74](#L74) | ) |
| [75](#L75) | ); |
| [76](#L76) | } |
| [77](#L77) |  |
| [78](#L78) | public function wrld\_pattern\_update\_notice() { |
| [79](#L79) | // phpcs:ignore WordPress.Security.NonceVerification.Recommended -- Data is not used for action or DB query. |
| [80](#L80) | if ( ! isset( $\_GET['updated\_pattern'] ) ) { |
| [81](#L81) | return; |
| [82](#L82) | } |
| [83](#L83) | echo "<div class='notice notice-success'> |
| [84](#L84) | <p>Dashboard Page successfully updated.</p> |
| [85](#L85) | </div>"; |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | public function wrld\_autoupdate\_dashboard() { |
| [89](#L89) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [90](#L90) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [91](#L91) | if ( ! $nonce\_valid ) { |
| [92](#L92) | wp\_send\_json\_error( |
| [93](#L93) | array( |
| [94](#L94) | 'success' => true, |
| [95](#L95) | 'message' => \_\_( |
| [96](#L96) | 'Nonce verification failed', |
| [97](#L97) | 'learndash-reports-by-wisdmlabs' |
| [98](#L98) | ), |
| [99](#L99) | ) |
| [100](#L100) | ); |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [104](#L104) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [105](#L105) | } |
| [106](#L106) |  |
| [107](#L107) | global $wrld\_pattern; |
| [108](#L108) | $reports\_page = get\_option( 'ldrp\_reporting\_page', false ); |
| [109](#L109) | $data         = array( |
| [110](#L110) | 'ID'           => $reports\_page, |
| [111](#L111) | 'post\_content' => $wrld\_pattern, |
| [112](#L112) | ); |
| [113](#L113) | wp\_update\_post( $data ); |
| [114](#L114) | wp\_send\_json\_success( |
| [115](#L115) | array( |
| [116](#L116) | 'url' => add\_query\_arg( |
| [117](#L117) | array( |
| [118](#L118) | 'updated\_pattern' => 1, |
| [119](#L119) | 'dla\_op'          => true, |
| [120](#L120) | 'dla\_oq'          => true, |
| [121](#L121) | ), |
| [122](#L122) | get\_permalink( $reports\_page ) |
| [123](#L123) | ), |
| [124](#L124) | ) |
| [125](#L125) | ); |
| [126](#L126) | die(); |
| [127](#L127) | } |
| [128](#L128) |  |
| [129](#L129) | /\*\* |
| [130](#L130) | \* This action is hooked to the ajax callback action 'wp\_ajax\_wrld\_page\_visit', |
| [131](#L131) | \* on called verifies if the request is from the correct source & update teh value for the |
| [132](#L132) | \* option 'wrld\_reporting\_page\_visited'. |
| [133](#L133) | \*/ |
| [134](#L134) | public static function update\_reporting\_page\_visit() { |
| [135](#L135) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [136](#L136) | if ( wp\_verify\_nonce( $nonce, 'reports-firrst-install-modal' ) ) { |
| [137](#L137) | // update\_option( 'wrld\_reporting\_page\_visited', 2 ); |
| [138](#L138) | wp\_send\_json\_success(); |
| [139](#L139) | } |
| [140](#L140) | wp\_send\_json\_error(); |
| [141](#L141) | } |
| [142](#L142) |  |
| [143](#L143) |  |
| [144](#L144) | /\*\* |
| [145](#L145) | \* This action is hooked to the ajax callback action 'wp\_ajax\_wrld\_notice\_action', |
| [146](#L146) | \* on called verifies if the request is from the correct source & update the value for the |
| [147](#L147) | \* option 'wrld\_last\_skipped\_on'. |
| [148](#L148) | \*/ |
| [149](#L149) | public static function wrld\_notice\_action() { |
| [150](#L150) | $nonce = ! empty( $\_REQUEST['wp\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['wp\_nonce'] ) ) : ''; |
| [151](#L151) | if ( wp\_verify\_nonce( $nonce, 'wrld-review-notice' ) ) { |
| [152](#L152) | $user\_action = sanitize\_text\_field( wp\_unslash( $\_REQUEST['user\_action'] ) ); |
| [153](#L153) | switch ( $user\_action ) { |
| [154](#L154) | case 'wisdm-reports-for-ld-remind-later': |
| [155](#L155) | case 'wisdm-reports-for-ld-post-review': |
| [156](#L156) | case 'close': |
| [157](#L157) | update\_option( 'wrld\_last\_skipped\_on', time() ); |
| [158](#L158) | break; |
| [159](#L159) | default: |
| [160](#L160) | update\_option( 'ld-reports-review-dismissed', time() ); |
| [161](#L161) | break; |
| [162](#L162) | } |
| [163](#L163) | wp\_send\_json\_success(); |
| [164](#L164) | } |
| [165](#L165) | wp\_send\_json\_error(); |
| [166](#L166) | } |
| [167](#L167) |  |
| [168](#L168) | public function show\_wisdm\_reports\_submenu() { |
| [169](#L169) | ?> |
| [170](#L170) | <div class="wrap"> |
| [171](#L171) | <h1><?php esc\_html\_e( 'Reports', 'learndash-reports-by-wisdmlabs' ); ?></h1> |
| [172](#L172) | <?php |
| [173](#L173) | $dashboard\_id = get\_option( 'ldrp\_reporting\_page', false ); |
| [174](#L174) | if ( ! $dashboard\_id || 'publish' !== get\_post\_status( $dashboard\_id ) ) { |
| [175](#L175) | ?> |
| [176](#L176) | <p><?php esc\_html\_e( 'The page seems to have been deleted/removed. Please click on the link below to create the page manually.', 'learndash-reports-by-wisdmlabs' ); ?> |
| [177](#L177) | </p> |
| [178](#L178) | <a |
| [179](#L179) | href="<?php echo esc\_attr( add\_query\_arg( array( 'create\_wisdm\_reports' => true ) ) ); ?>"><?php esc\_html\_e( 'Create Reports Dashboard', 'learndash-reports-by-wisdmlabs' ); ?></a> |
| [180](#L180) | <?php |
| [181](#L181) | } else { |
| [182](#L182) | ?> |
| [183](#L183) | <p><a class="primary-button primary-btn components-button is-primary" |
| [184](#L184) | href="<?php echo esc\_url( get\_permalink( $dashboard\_id ) ); ?>" target="\_blank" |
| [185](#L185) | style="background:#007cba;color:#fff;text-decoration:none;text-shadow:none;outline:1px solid transparent;padding:6px 12px;border-radius:2px;"><?php esc\_html\_e( 'Launch Reports Dashboard', 'learndash-reports-by-wisdmlabs' ); ?></a> |
| [186](#L186) | </p> |
| [187](#L187) | <?php |
| [188](#L188) | } |
| [189](#L189) | ?> |
| [190](#L190) | </div> |
| [191](#L191) | <?php |
| [192](#L192) | } |
| [193](#L193) |  |
| [194](#L194) | /\*\* |
| [195](#L195) | \* This function creates the page with the default WRLD pattern when a get parameter 'create\_wisdm\_reports' is set. |
| [196](#L196) | \*/ |
| [197](#L197) | public function wrld\_create\_patterns\_page() { |
| [198](#L198) | $new\_page\_creation = filter\_input( INPUT\_GET, 'create\_wisdm\_reports', FILTER\_VALIDATE\_BOOLEAN ); |
| [199](#L199) | $created\_page      = get\_option( 'ldrp\_reporting\_page', false ); |
| [200](#L200) |  |
| [201](#L201) | if ( $created\_page && 'publish' !== get\_post\_status( $created\_page ) ) { |
| [202](#L202) | if ( ! empty( $new\_page\_creation ) ) { |
| [203](#L203) | wrld\_create\_patterns\_page( true ); |
| [204](#L204) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_page\_creation\_notice' ); |
| [205](#L205) | } |
| [206](#L206) | } elseif ( false == $created\_page ) { |
| [207](#L207) | wrld\_create\_patterns\_page( false ); |
| [208](#L208) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_page\_creation\_notice' ); |
| [209](#L209) | } |
| [210](#L210) | } |
| [211](#L211) | /\*\* |
| [212](#L212) | \* This function creates the page with the default WRLD pattern when a get parameter 'create\_wisdm\_reports' is set. |
| [213](#L213) | \*/ |
| [214](#L214) | public function wrld\_create\_student\_patterns\_page() { |
| [215](#L215) | $new\_page\_creation = filter\_input( INPUT\_GET, 'create\_student\_reports', FILTER\_VALIDATE\_BOOLEAN ); |
| [216](#L216) | $created\_page      = get\_option( 'ldrp\_student\_page', false ); |
| [217](#L217) |  |
| [218](#L218) | if ( $created\_page && 'publish' !== get\_post\_status( $created\_page ) ) { |
| [219](#L219) | if ( ! empty( $new\_page\_creation ) ) { |
| [220](#L220) | wrld\_create\_student\_patterns\_page( true ); |
| [221](#L221) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_student\_page\_creation\_notice' ); |
| [222](#L222) | } |
| [223](#L223) | } elseif ( false == $created\_page ) { |
| [224](#L224) | wrld\_create\_student\_patterns\_page( false ); |
| [225](#L225) | // add\_action( 'admin\_notices', '\WisdmReportsLearndash\Admin\_Functions::report\_student\_page\_creation\_notice' ); |
| [226](#L226) | } |
| [227](#L227) | } |
| [228](#L228) |  |
| [229](#L229) | /\*\* |
| [230](#L230) | \* The function checks if the plugin specified is installed on the website. |
| [231](#L231) | \* - Currently works only for the WordPress single site. |
| [232](#L232) | \* |
| [233](#L233) | \* @param $plugin\_slug plugin path and plugin file name, ex : learndash-reports-pro/learndash-reports-pro.php. |
| [234](#L234) | \*/ |
| [235](#L235) | public static function is\_plugin\_installed( $plugin\_slug ) { |
| [236](#L236) | if ( empty( $plugin\_slug ) ) { |
| [237](#L237) | return false; |
| [238](#L238) | } |
| [239](#L239) |  |
| [240](#L240) | // Check if needed functions exists - if not, require them |
| [241](#L241) | if ( ! function\_exists( 'get\_plugins' ) || ! function\_exists( 'is\_plugin\_active' ) ) { |
| [242](#L242) | require\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
| [243](#L243) | } |
| [244](#L244) |  |
| [245](#L245) | $installed\_plugins = get\_plugins(); |
| [246](#L246) | return array\_key\_exists( $plugin\_slug, $installed\_plugins ) || in\_array( $plugin\_slug, $installed\_plugins, true ); |
| [247](#L247) | } |
| [248](#L248) |  |
| [249](#L249) | /\*\* |
| [250](#L250) | \* Shows admin a notice on the admin dashboard. |
| [251](#L251) | \*/ |
| [252](#L252) | public static function report\_page\_creation\_notice() { |
| [253](#L253) | echo '<div class="notice notice-success is-dismissible"><p>'; |
| [254](#L254) | echo esc\_html\_\_( 'Successfully created Reports For LearnDash page', 'learndash-reports-by-wisdmlabs' ); |
| [255](#L255) | echo '</p></div>'; |
| [256](#L256) | } |
| [257](#L257) |  |
| [258](#L258) | /\*\* |
| [259](#L259) | \* Shows admin a notice on the admin dashboard. |
| [260](#L260) | \*/ |
| [261](#L261) | public static function report\_student\_page\_creation\_notice() { |
| [262](#L262) | echo '<div class="notice notice-success is-dismissible"><p>'; |
| [263](#L263) | echo esc\_html\_\_( 'Successfully created Reports For LearnDash Student Quiz Reports page', 'learndash-reports-by-wisdmlabs' ); |
| [264](#L264) | echo '</p></div>'; |
| [265](#L265) | } |
| [266](#L266) |  |
| [267](#L267) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [268](#L268) | \* Actions for admin dashboard settings \* |
| [269](#L269) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [270](#L270) |  |
| [271](#L271) | /\*\* |
| [272](#L272) | \* Skip license activation. |
| [273](#L273) | \* |
| [274](#L274) | \* @deprecated 1.8.2 This method is no longer used. |
| [275](#L275) | \*/ |
| [276](#L276) | public static function wrld\_skip\_license\_activation() { |
| [277](#L277) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [278](#L278) | } |
| [279](#L279) |  |
| [280](#L280) | public static function wrld\_exclude\_settings\_save() { |
| [281](#L281) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [282](#L282) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [283](#L283) | if ( ! $nonce\_valid ) { |
| [284](#L284) | wp\_send\_json\_error( |
| [285](#L285) | array( |
| [286](#L286) | 'success' => true, |
| [287](#L287) | 'message' => \_\_( |
| [288](#L288) | 'Nonce verification failed', |
| [289](#L289) | 'learndash-reports-by-wisdmlabs' |
| [290](#L290) | ), |
| [291](#L291) | ) |
| [292](#L292) | ); |
| [293](#L293) | } |
| [294](#L294) |  |
| [295](#L295) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [296](#L296) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [297](#L297) | } |
| [298](#L298) |  |
| [299](#L299) | $type  = filter\_input( INPUT\_POST, 'type', FILTER\_SANITIZE\_STRING ); |
| [300](#L300) | $value = filter\_input( INPUT\_POST, 'value', FILTER\_DEFAULT, FILTER\_REQUIRE\_ARRAY ); |
| [301](#L301) |  |
| [302](#L302) | update\_option( 'exclude\_' . $type, $value ); |
| [303](#L303) |  |
| [304](#L304) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [305](#L305) | } |
| [306](#L306) |  |
| [307](#L307) | public static function apply\_time\_tracking\_settings() { |
| [308](#L308) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [309](#L309) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [310](#L310) | if ( ! $nonce\_valid ) { |
| [311](#L311) | wp\_send\_json\_error( |
| [312](#L312) | array( |
| [313](#L313) | 'success' => true, |
| [314](#L314) | 'message' => \_\_( |
| [315](#L315) | 'Nonce verification failed', |
| [316](#L316) | 'learndash-reports-by-wisdmlabs' |
| [317](#L317) | ), |
| [318](#L318) | ) |
| [319](#L319) | ); |
| [320](#L320) | } |
| [321](#L321) |  |
| [322](#L322) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [323](#L323) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [324](#L324) | } |
| [325](#L325) |  |
| [326](#L326) | $status   = filter\_input( INPUT\_POST, 'status', FILTER\_SANITIZE\_STRING ); |
| [327](#L327) | $timer    = filter\_input( INPUT\_POST, 'timeout', FILTER\_SANITIZE\_NUMBER\_INT ); |
| [328](#L328) | $message  = filter\_input( INPUT\_POST, 'message', FILTER\_SANITIZE\_STRING ); |
| [329](#L329) | $btnlabel = filter\_input( INPUT\_POST, 'btnlabel', FILTER\_SANITIZE\_STRING ); |
| [330](#L330) |  |
| [331](#L331) | if ( ! empty( $timer ) ) { |
| [332](#L332) | update\_option( 'wrld\_time\_tracking\_timer', $timer ); |
| [333](#L333) | } |
| [334](#L334) | if ( ! empty( $message ) ) { |
| [335](#L335) | update\_option( 'wrld\_time\_tracking\_message', $message ); |
| [336](#L336) | } |
| [337](#L337) | if ( ! empty( $btnlabel ) ) { |
| [338](#L338) | update\_option( 'wrld\_time\_tracking\_btnlabel', $btnlabel ); |
| [339](#L339) | } |
| [340](#L340) | if ( ! empty( $status ) ) { |
| [341](#L341) | $all\_updates  = get\_option( 'wrld\_time\_tracking\_log', false ); |
| [342](#L342) | $current\_time = current\_time( 'timestamp' ); |
| [343](#L343) | if ( ! empty( $all\_updates ) ) { |
| [344](#L344) | $all\_updates[] = $current\_time; |
| [345](#L345) | } else { |
| [346](#L346) | $all\_updates = array( $current\_time ); |
| [347](#L347) | } |
| [348](#L348) | update\_option( 'wrld\_time\_tracking\_status', $status ); |
| [349](#L349) | update\_option( 'wrld\_time\_tracking\_last\_update', $current\_time ); |
| [350](#L350) | update\_option( 'wrld\_time\_tracking\_log', $all\_updates ); |
| [351](#L351) | wp\_send\_json\_success( |
| [352](#L352) | array( |
| [353](#L353) | 'success' => true, |
| [354](#L354) | 'time'    => date\_i18n( |
| [355](#L355) | 'Y-m-d H:i:s', |
| [356](#L356) | $current\_time |
| [357](#L357) | ), |
| [358](#L358) | ) |
| [359](#L359) | ); |
| [360](#L360) | } |
| [361](#L361) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [362](#L362) |  |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | public static function wrld\_exclude\_load\_users() { |
| [366](#L366) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [367](#L367) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [368](#L368) | if ( ! $nonce\_valid ) { |
| [369](#L369) | wp\_send\_json\_error( |
| [370](#L370) | array( |
| [371](#L371) | 'success' => true, |
| [372](#L372) | 'message' => \_\_( |
| [373](#L373) | 'Nonce verification failed', |
| [374](#L374) | 'learndash-reports-by-wisdmlabs' |
| [375](#L375) | ), |
| [376](#L376) | ) |
| [377](#L377) | ); |
| [378](#L378) | } |
| [379](#L379) |  |
| [380](#L380) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [381](#L381) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [382](#L382) | } |
| [383](#L383) |  |
| [384](#L384) | $page   = filter\_input( INPUT\_POST, 'page', FILTER\_VALIDATE\_INT ); |
| [385](#L385) | $search = filter\_input( INPUT\_POST, 'search', FILTER\_SANITIZE\_STRING ); |
| [386](#L386) |  |
| [387](#L387) | if ( empty( $page ) ) { |
| [388](#L388) | $page = 1; |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | $args = array( |
| [392](#L392) | 'number'         => 10, |
| [393](#L393) | 'paged'          => $page, |
| [394](#L394) | 'search\_columns' => array( |
| [395](#L395) | 'user\_login', |
| [396](#L396) | 'user\_email', |
| [397](#L397) | 'user\_nicename', |
| [398](#L398) | 'display\_name', |
| [399](#L399) | ), |
| [400](#L400) | 'fields'         => array( |
| [401](#L401) | 'ID', |
| [402](#L402) | 'display\_name', |
| [403](#L403) | ), |
| [404](#L404) | ); |
| [405](#L405) |  |
| [406](#L406) | if ( ! empty( $search ) ) { |
| [407](#L407) | $args['search'] = '\*' . $search . '\*'; |
| [408](#L408) | } |
| [409](#L409) |  |
| [410](#L410) | $users = get\_users( $args ); |
| [411](#L411) | if ( empty( $users ) ) { |
| [412](#L412) | wp\_send\_json\_error(); |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | wp\_send\_json\_success( |
| [416](#L416) | array( |
| [417](#L417) | 'success' => true, |
| [418](#L418) | 'data'    => $users, |
| [419](#L419) | ) |
| [420](#L420) | ); |
| [421](#L421) | } |
| [422](#L422) |  |
| [423](#L423) | /\*\* |
| [424](#L424) | \* A function hooked to the ajax action wrld\_license\_activate, |
| [425](#L425) | \* resposible for initiating the activation request for the |
| [426](#L426) | \* reports pro plugin license key. |
| [427](#L427) | \* |
| [428](#L428) | \* @since 1.2.0 |
| [429](#L429) | \* @deprecated 1.8.2 This method is no longer used. |
| [430](#L430) | \*/ |
| [431](#L431) | public static function wrld\_license\_activate() { |
| [432](#L432) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [433](#L433) | } |
| [434](#L434) |  |
| [435](#L435) | /\*\* |
| [436](#L436) | \* A function hooked to the ajax action wrld\_license\_deactivate, |
| [437](#L437) | \* resposible for initiating the deactivation request for the |
| [438](#L438) | \* reports pro plugin license key. |
| [439](#L439) | \* |
| [440](#L440) | \* @since 1.2.0 |
| [441](#L441) | \* @deprecated 1.8.2 This method is no longer used. |
| [442](#L442) | \*/ |
| [443](#L443) | public static function wrld\_license\_deactivate() { |
| [444](#L444) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [445](#L445) | } |
| [446](#L446) |  |
| [447](#L447) | /\*\* |
| [448](#L448) | \* A function hooked to the ajax action wrld\_set\_configuration, |
| [449](#L449) | \* resposible for setting up the configuration which enables inclusion |
| [450](#L450) | \* of the reports page link in the primary menu. |
| [451](#L451) | \* |
| [452](#L452) | \* @since 1.2.0 |
| [453](#L453) | \*/ |
| [454](#L454) | public static function wrld\_set\_configuration() { |
| [455](#L455) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [456](#L456) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [457](#L457) | if ( ! $nonce\_valid ) { |
| [458](#L458) | wp\_send\_json\_error( |
| [459](#L459) | array( |
| [460](#L460) | 'success' => true, |
| [461](#L461) | 'message' => \_\_( |
| [462](#L462) | 'Nonce verification failed', |
| [463](#L463) | 'learndash-reports-by-wisdmlabs' |
| [464](#L464) | ), |
| [465](#L465) | ) |
| [466](#L466) | ); |
| [467](#L467) | } |
| [468](#L468) |  |
| [469](#L469) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [470](#L470) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [471](#L471) | } |
| [472](#L472) |  |
| [473](#L473) | $settings\_data = get\_option( 'wrld\_settings', array() ); |
| [474](#L474) | if ( isset( $\_REQUEST['add\_in\_menu'] ) ) { |
| [475](#L475) | $settings\_data['wrld-menu-config-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_in\_menu'] ) ); |
| [476](#L476) | } |
| [477](#L477) | if ( isset( $\_REQUEST['add\_student\_in\_menu'] ) ) { |
| [478](#L478) | $settings\_data['wrld-menu-student-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_student\_in\_menu'] ) ); |
| [479](#L479) | } |
| [480](#L480) | update\_option( 'wrld\_settings', $settings\_data ); |
| [481](#L481) | wp\_send\_json\_success( array( 'success' => true ) ); |
| [482](#L482) | } |
| [483](#L483) |  |
| [484](#L484) | /\*\* |
| [485](#L485) | \* A function hooked to the ajax action wrld\_update\_settings, |
| [486](#L486) | \* resposible for setting up the configuration which enables inclusion |
| [487](#L487) | \* of the reports page link in the primary menu. |
| [488](#L488) | \* |
| [489](#L489) | \* @since 1.2.0 |
| [490](#L490) | \*/ |
| [491](#L491) | public static function wrld\_update\_settings() { |
| [492](#L492) | $nonce       = isset( $\_REQUEST['nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['nonce'] ) ) : ''; |
| [493](#L493) | $nonce\_valid = wp\_verify\_nonce( $nonce, 'wrld-admin-settings' ); |
| [494](#L494) | if ( ! $nonce\_valid ) { |
| [495](#L495) | wp\_send\_json\_error( |
| [496](#L496) | array( |
| [497](#L497) | 'success' => false, |
| [498](#L498) | 'message' => \_\_( |
| [499](#L499) | 'Nonce verification failed', |
| [500](#L500) | 'learndash-reports-by-wisdmlabs' |
| [501](#L501) | ), |
| [502](#L502) | ) |
| [503](#L503) | ); |
| [504](#L504) | } |
| [505](#L505) |  |
| [506](#L506) | if ( ! current\_user\_can( LEARNDASH\_ADMIN\_CAPABILITY\_CHECK ) ) { |
| [507](#L507) | wp\_send\_json\_error( esc\_html\_\_( "You don't have permission to do this action.", 'learndash-reports-by-wisdmlabs' ) ); |
| [508](#L508) | } |
| [509](#L509) |  |
| [510](#L510) | $settings\_data = get\_option( 'wrld\_settings', array() ); |
| [511](#L511) | if ( isset( $\_REQUEST['access\_to\_group\_leader'] ) ) { |
| [512](#L512) | $access\_for\_group\_leader = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['access\_to\_group\_leader'] ) ); |
| [513](#L513) | } |
| [514](#L514) | if ( isset( $\_REQUEST['access\_to\_wdm\_instructor'] ) ) { |
| [515](#L515) | $access\_for\_wdm\_instructor = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['access\_to\_wdm\_instructor'] ) ); |
| [516](#L516) | } |
| [517](#L517) | if ( isset( $\_REQUEST['add\_in\_menu'] ) ) { |
| [518](#L518) | $settings\_data['wrld-menu-config-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_in\_menu'] ) ); |
| [519](#L519) | } |
| [520](#L520) | if ( isset( $\_REQUEST['add\_student\_in\_menu'] ) ) { |
| [521](#L521) | $settings\_data['wrld-menu-student-setting'] = 'true' === sanitize\_text\_field( wp\_unslash( $\_REQUEST['add\_student\_in\_menu'] ) ); |
| [522](#L522) | } |
| [523](#L523) |  |
| [524](#L524) | if ( isset( $access\_for\_group\_leader ) || isset( $access\_for\_wdm\_instructor ) ) { |
| [525](#L525) | $settings\_data['dashboard-access-roles'] = array( |
| [526](#L526) | 'group\_leader'   => $access\_for\_group\_leader, |
| [527](#L527) | 'wdm\_instructor' => $access\_for\_wdm\_instructor, |
| [528](#L528) | ); |
| [529](#L529) | } |
| [530](#L530) | update\_option( 'wrld\_settings', $settings\_data ); |
| [531](#L531) | wp\_send\_json\_success( array( 'settings\_data' => $settings\_data ) ); |
| [532](#L532) |  |
| [533](#L533) | } |
| [534](#L534) |  |
| [535](#L535) | /\*\* |
| [536](#L536) | \* @deprecated 1.8.2 This method is no longer used. |
| [537](#L537) | \*/ |
| [538](#L538) | public function wrld\_license\_page\_visit() { |
| [539](#L539) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [540](#L540) | } |
| [541](#L541) |  |
| [542](#L542) | /\*\* |
| [543](#L543) | \* Add the Helpscout Beacon script on the Reports Settings backend pages. |
| [544](#L544) | \* Callback to action hook 'ldgr\_helpscout\_beacon'. |
| [545](#L545) | \* |
| [546](#L546) | \* @since 4.9.10 |
| [547](#L547) | \* @deprecated 1.8.2 This method is no longer used. |
| [548](#L548) | \*/ |
| [549](#L549) | public function wrld\_add\_beacon\_helpscout\_script() { |
| [550](#L550) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [551](#L551) | } |
| [552](#L552) |  |
| [553](#L553) | /\*\* |
| [554](#L554) | \* Calling function to the helpscout beacon. |
| [555](#L555) | \* Callback to action hook 'wrld\_helpscout\_beacon'. |
| [556](#L556) | \* |
| [557](#L557) | \* @since 4.9.10 |
| [558](#L558) | \* @deprecated 1.8.2 This method is no longer used. |
| [559](#L559) | \*/ |
| [560](#L560) | public function wrld\_load\_beacon\_helpscout() { |
| [561](#L561) | \_deprecated\_function( \_\_METHOD\_\_, '1.8.2' ); |
| [562](#L562) | } |
| [563](#L563) |  |
| [564](#L564) | } |
| [565](#L565) |  |
| [566](#L566) | \WisdmReportsLearndash\Admin\_Functions::instance(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php?format=txt)
* [Original Format](/export/3220658/wisdm-reports-for-learndash/trunk/includes/admin/class-admin-functions.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


