
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMessagePack-CSharp%2FMessagePack-CSharp%2Fcommit%2Ff8d40b3ad0be01c6e56cb51ecea81f59d98c192d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMessagePack-CSharp%2FMessagePack-CSharp%2Fcommit%2Ff8d40b3ad0be01c6e56cb51ecea81f59d98c192d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=MessagePack-CSharp%2FMessagePack-CSharp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MessagePack-CSharp](/MessagePack-CSharp)
/
**[MessagePack-CSharp](/MessagePack-CSharp/MessagePack-CSharp)**
Public

* [Notifications](/login?return_to=%2FMessagePack-CSharp%2FMessagePack-CSharp) You must be signed in to change notification settings
* [Fork
  710](/login?return_to=%2FMessagePack-CSharp%2FMessagePack-CSharp)
* [Star
   5.9k](/login?return_to=%2FMessagePack-CSharp%2FMessagePack-CSharp)

* [Code](/MessagePack-CSharp/MessagePack-CSharp)
* [Issues
  76](/MessagePack-CSharp/MessagePack-CSharp/issues)
* [Pull requests
  1](/MessagePack-CSharp/MessagePack-CSharp/pulls)
* [Discussions](/MessagePack-CSharp/MessagePack-CSharp/discussions)
* [Actions](/MessagePack-CSharp/MessagePack-CSharp/actions)
* [Security](/MessagePack-CSharp/MessagePack-CSharp/security)
* [Insights](/MessagePack-CSharp/MessagePack-CSharp/pulse)

Additional navigation options

* [Code](/MessagePack-CSharp/MessagePack-CSharp)
* [Issues](/MessagePack-CSharp/MessagePack-CSharp/issues)
* [Pull requests](/MessagePack-CSharp/MessagePack-CSharp/pulls)
* [Discussions](/MessagePack-CSharp/MessagePack-CSharp/discussions)
* [Actions](/MessagePack-CSharp/MessagePack-CSharp/actions)
* [Security](/MessagePack-CSharp/MessagePack-CSharp/security)
* [Insights](/MessagePack-CSharp/MessagePack-CSharp/pulse)

## Commit

[Permalink](/MessagePack-CSharp/MessagePack-CSharp/commit/f8d40b3ad0be01c6e56cb51ecea81f59d98c192d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#2014](https://github.com/MessagePack-CSharp/MessagePack-CSharp/pull/2014) from MessagePack-CSharp/secureHash

[Browse files](/MessagePack-CSharp/MessagePack-CSharp/tree/f8d40b3ad0be01c6e56cb51ecea81f59d98c192d)
Browse the repository at this point in the history

```
Use a collision-resistant hash algorithm for untrusted data
```

* Loading branch information

[![@AArnott](https://avatars.githubusercontent.com/u/3548?s=40&v=4)](/AArnott)

[AArnott](/MessagePack-CSharp/MessagePack-CSharp/commits?author=AArnott "View all commits by AArnott")
authored
Oct 17, 2024

2 parents
[3a90034](/MessagePack-CSharp/MessagePack-CSharp/commit/3a90034c2b1d2a0f6e1205bdc68c43c98faf7f9e)
+
[ad2d135](/MessagePack-CSharp/MessagePack-CSharp/commit/ad2d135fd90de69f83904fde958653e38b0c220c)

commit f8d40b3

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**541 additions**
and
**131 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* sandbox/DynamicCodeDumper

  + sandbox/DynamicCodeDumper/DynamicCodeDumper.csproj
    [DynamicCodeDumper.csproj](#diff-3d3bd5aa3e6dfc3bb6ddcd3ec2d1406ef22af48dc6c78f0bad9baff9a51be405)
* src/MessagePack.UnityClient/Assets/Scripts

  + MessagePack

    - src/MessagePack.UnityClient/Assets/Scripts/MessagePack/MessagePackSecurity.cs
      [MessagePackSecurity.cs](#diff-2a64ed8a894381c12aea4b4800ac865b1c0345d0d85c46dfff41d4bc9a8ce264)
    - src/MessagePack.UnityClient/Assets/Scripts/MessagePack/SipHash.cs
      [SipHash.cs](#diff-92e9bb389673d4796e7d879de7465ed9ba60a1b8158e3882db46a0b0eafcc241)
    - src/MessagePack.UnityClient/Assets/Scripts/MessagePack/SipHash.cs.meta
      [SipHash.cs.meta](#diff-34ca8da77c7c1b6f3d9fb01c84010730b8d3fb71ab2ddf51520d03d38dc5303c)
  + Tests/ShareTests

    - src/MessagePack.UnityClient/Assets/Scripts/Tests/ShareTests/MessagePackSecurityTests.cs
      [MessagePackSecurityTests.cs](#diff-161574006d959c9eb019e2cb0aa8e7d07e8455d2fe70fe58a309909bd8185b34)
    - src/MessagePack.UnityClient/Assets/Scripts/Tests/ShareTests/SipHashTests.cs
      [SipHashTests.cs](#diff-aa439e38dc148d4bb653ad0ee873fe6436ceac9786e429dc809788654f7ce3bb)
    - src/MessagePack.UnityClient/Assets/Scripts/Tests/ShareTests/SipHashTests.cs.meta
      [SipHashTests.cs.meta](#diff-523567789be0abe1ad34bff08f03e95da84a98f5f5b179b91fa206be2a196b26)
* tests/MessagePack.Tests

  + tests/MessagePack.Tests/MessagePack.Tests.csproj
    [MessagePack.Tests.csproj](#diff-03c1d75ac19160c6939e4bd67e3dbaabf54c143c1d155b42d1aa36235fdf970c)

## There are no files selected for viewing

3 changes: 3 additions & 0 deletions

3
[sandbox/DynamicCodeDumper/DynamicCodeDumper.csproj](#diff-3d3bd5aa3e6dfc3bb6ddcd3ec2d1406ef22af48dc6c78f0bad9baff9a51be405 "sandbox/DynamicCodeDumper/DynamicCodeDumper.csproj")

Show comments

[View file](/MessagePack-CSharp/MessagePack-CSharp/blob/f8d40b3ad0be01c6e56cb51ecea81f59d98c192d/sandbox/DynamicCodeDumper/DynamicCodeDumper.csproj)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -79,6 +79,9 @@ |
|  |  | <Compile Include="..\..\src\MessagePack.UnityClient\Assets\Scripts\MessagePack\MessagePackSecurity.cs"> |
|  |  | <Link>Code\MessagePackSecurity.cs</Link> |
|  |  | </Compile> |
|  |  | <Compile Include="..\..\src\MessagePack.UnityClient\Assets\Scripts\MessagePack\SipHash.cs"> |
|  |  | <Link>Code\SipHash.cs</Link> |
|  |  | </Compile> |
|  |  | <Compile Include="..\..\src\MessagePack.UnityClient\Assets\Scripts\MessagePack\MonoProtection.cs"> |
|  |  | <Link>Code\MonoProtection.cs</Link> |
|  |  | </Compile> |
| Expand Down | |  |

235 changes: 109 additions & 126 deletions

235
[src/MessagePack.UnityClient/Assets/Scripts/MessagePack/MessagePackSecurity.cs](#diff-2a64ed8a894381c12aea4b4800ac865b1c0345d0d85c46dfff41d4bc9a8ce264 "src/MessagePack.UnityClient/Assets/Scripts/MessagePack/MessagePackSecurity.cs")

Show comments

[View file](/MessagePack-CSharp/MessagePack-CSharp/blob/f8d40b3ad0be01c6e56cb51ecea81f59d98c192d/src/MessagePack.UnityClient/Assets/Scripts/MessagePack/MessagePackSecurity.cs)
Edit file

Delete file

Load diff

Large diffs are not rendered by default.

Oops, something went wrong.

Retry

287 changes: 287 additions & 0 deletions

287
[src/MessagePack.UnityClient/Assets/Scripts/MessagePack/SipHash.cs](#diff-92e9bb389673d4796e7d879de7465ed9ba60a1b8158e3882db46a0b0eafcc241 "src/MessagePack.UnityClient/Assets/Scripts/MessagePack/SipHash.cs")

Show comments

[View file](/MessagePack-CSharp/MessagePack-CSharp/blob/f8d40b3ad0be01c6e56cb51ecea81f59d98c192d/src/MessagePack.UnityClient/Assets/Scripts/MessagePack/SipHash.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,287 @@ |
|  |  | ﻿// Copyright (c) All contributors. All rights reserved. |
|  |  | // Licensed under the MIT license. See LICENSE file in the project root for full license information. |
|  |  |  |
|  |  | //// Originally from: https://github.com/paya-cz/siphash |
|  |  | //// Author: Pavel Werl |
|  |  | //// License: Public Domain |
|  |  | //// SipHash website: https://131002.net/siphash/ |
|  |  |  |
|  |  | using System; |
|  |  | using System.Buffers; |
|  |  | using System.Buffers.Binary; |
|  |  | using System.Runtime.CompilerServices; |
|  |  | using System.Runtime.InteropServices; |
|  |  | using System.Security.Cryptography; |
|  |  |  |
|  |  | namespace MessagePack |
|  |  | { |
|  |  | /// <summary> |
|  |  | /// Implements the <see href="https://en.wikipedia.org/wiki/SipHash">SipHash pseudo-random function</see>. |
|  |  | /// </summary> |
|  |  | /// <remarks> |
|  |  | /// This class is immutable and thread-safe. |
|  |  | /// </remarks> |
|  |  | internal class SipHash |
|  |  | { |
|  |  | /// <summary> |
|  |  | /// Part of the initial 256-bit internal state. |
|  |  | /// </summary> |
|  |  | private readonly ulong initialState0; |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Part of the initial 256-bit internal state. |
|  |  | /// </summary> |
|  |  | private readonly ulong initialState1; |
|  |  |  |
|  |  | /// <summary>Initializes a new instance of the <see cref="SipHash"/> class using a random key.</summary> |
|  |  | public SipHash() |
|  |  | { |
|  |  | using RandomNumberGenerator rng = RandomNumberGenerator.Create(); |
|  |  | #if SPAN\_BUILTIN |
|  |  | Span<byte> key = stackalloc byte[16]; |
|  |  | rng.GetBytes(key); |
|  |  | #else |
|  |  | byte[] buffer = ArrayPool<byte>.Shared.Rent(16); |
|  |  | rng.GetBytes(buffer, 0, 16); |
|  |  | Span<byte> key = buffer; |
|  |  | #endif |
|  |  |  |
|  |  | this.initialState0 = 0x736f6d6570736575UL ^ BinaryPrimitives.ReadUInt64LittleEndian(key); |
|  |  | this.initialState1 = 0x646f72616e646f6dUL ^ BinaryPrimitives.ReadUInt64LittleEndian(key.Slice(sizeof(ulong))); |
|  |  |  |
|  |  | #if !SPAN\_BUILTIN |
|  |  | ArrayPool<byte>.Shared.Return(buffer); |
|  |  | #endif |
|  |  | } |
|  |  |  |
|  |  | /// <summary>Initializes a new instance of the <see cref="SipHash"/> class using the specified 128-bit key.</summary> |
|  |  | /// <param name="key">Key for the SipHash pseudo-random function. Must be exactly 16 bytes long.</param> |
|  |  | /// <exception cref="ArgumentException">Thrown when <paramref name="key"/> is not exactly 16 bytes long (128 bits).</exception> |
|  |  | public SipHash(ReadOnlySpan<byte> key) |
|  |  | { |
|  |  | if (key.Length != 16) |
|  |  | { |
|  |  | throw new ArgumentException("SipHash key must be exactly 128-bit long (16 bytes).", nameof(key)); |
|  |  | } |
|  |  |  |
|  |  | this.initialState0 = 0x736f6d6570736575UL ^ BinaryPrimitives.ReadUInt64LittleEndian(key); |
|  |  | this.initialState1 = 0x646f72616e646f6dUL ^ BinaryPrimitives.ReadUInt64LittleEndian(key.Slice(sizeof(ulong))); |
|  |  | } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Gets a 128-bit SipHash key. |
|  |  | /// </summary> |
|  |  | /// <param name="key">The 16-byte buffer that receives the key originally provided to the constructor.</param> |
|  |  | public void GetKey(Span<byte> key) |
|  |  | { |
|  |  | if (key.Length != 16) |
|  |  | { |
|  |  | throw new ArgumentException("SipHash key must be exactly 128-bit long (16 bytes).", nameof(key)); |
|  |  | } |
|  |  |  |
|  |  | BinaryPrimitives.WriteUInt64LittleEndian(key, this.initialState0 ^ 0x736f6d6570736575UL); |
|  |  | BinaryPrimitives.WriteUInt64LittleEndian(key.Slice(sizeof(ulong)), this.initialState1 ^ 0x646f72616e646f6dUL); |
|  |  | } |
|  |  |  |
|  |  | /// <summary>Computes 64-bit SipHash tag for the specified message.</summary> |
|  |  | /// <param name="data">The byte array for which to computer SipHash tag.</param> |
|  |  | /// <returns>Returns 64-bit (8 bytes) SipHash tag.</returns> |
|  |  | public long Compute(ReadOnlySpan<byte> data) |
|  |  | { |
|  |  | unchecked |
|  |  | { |
|  |  | // SipHash internal state |
|  |  | ulong v0 = this.initialState0; |
|  |  | ulong v1 = this.initialState1; |
|  |  |  |
|  |  | // It is faster to load the initialStateX fields from memory again than to reference v0 and v1: |
|  |  | ulong v2 = 0x1F160A001E161714UL ^ this.initialState0; |
|  |  | ulong v3 = 0x100A160317100A1EUL ^ this.initialState1; |
|  |  |  |
|  |  | // We process data in 64-bit blocks |
|  |  | ulong block; |
|  |  |  |
|  |  | // The last 64-bit block of data |
|  |  | int finalBlockPosition = data.Length & ~7; |
|  |  |  |
|  |  | // Process the input data in blocks of 64 bits |
|  |  | for (int blockPosition = 0; blockPosition < finalBlockPosition; blockPosition += sizeof(ulong)) |
|  |  | { |
|  |  | block = MemoryMarshal.Read<ulong>(data.Slice(blockPosition)); |
|  |  |  |
|  |  | v3 ^= block; |
|  |  |  |
|  |  | // Round 1 |
|  |  | v0 += v1; |
|  |  | v2 += v3; |
|  |  | v1 = v1 << 13 | v1 >> 51; |
|  |  | v3 = v3 << 16 | v3 >> 48; |
|  |  | v1 ^= v0; |
|  |  | v3 ^= v2; |
|  |  | v0 = v0 << 32 | v0 >> 32; |
|  |  | v2 += v1; |
|  |  | v0 += v3; |
|  |  | v1 = v1 << 17 | v1 >> 47; |
|  |  | v3 = v3 << 21 | v3 >> 43; |
|  |  | v1 ^= v2; |
|  |  | v3 ^= v0; |
|  |  | v2 = v2 << 32 | v2 >> 32; |
|  |  |  |
|  |  | // Round 2 |
|  |  | v0 += v1; |
|  |  | v2 += v3; |
|  |  | v1 = v1 << 13 | v1 >> 51; |
|  |  | v3 = v3 << 16 | v3 >> 48; |
|  |  | v1 ^= v0; |
|  |  | v3 ^= v2; |
|  |  | v0 = v0 << 32 | v0 >> 32; |
|  |  | v2 += v1; |
|  |  | v0 += v3; |
|  |  | v1 = v1 << 17 | v1 >> 47; |
|  |  | v3 = v3 << 21 | v3 >> 43; |
|  |  | v1 ^= v2; |
|  |  | v3 ^= v0; |
|  |  | v2 = v2 << 32 | v2 >> 32; |
|  |  |  |
|  |  | v0 ^= block; |
|  |  | } |
|  |  |  |
|  |  | // Load the remaining bytes |
|  |  | block = (ulong)data.Length << 56; |
|  |  | switch (data.Length & 7) |
|  |  | { |
|  |  | case 7: |
|  |  | block |= MemoryMarshal.Read<uint>(data.Slice(finalBlockPosition)) | (ulong)MemoryMarshal.Read<ushort>(data.Slice(finalBlockPosition + 4)) << 32 | (ulong)data[finalBlockPosition + 6] << 48; |
|  |  | break; |
|  |  | case 6: |
|  |  | block |= MemoryMarshal.Read<uint>(data.Slice(finalBlockPosition)) | (ulong)MemoryMarshal.Read<ushort>(data.Slice(finalBlockPosition + 4)) << 32; |
|  |  | break; |
|  |  | case 5: |
|  |  | block |= MemoryMarshal.Read<uint>(data.Slice(finalBlockPosition)) | (ulong)data[finalBlockPosition + 4] << 32; |
|  |  | break; |
|  |  | case 4: |
|  |  | block |= MemoryMarshal.Read<uint>(data.Slice(finalBlockPosition)); |
|  |  | break; |
|  |  | case 3: |
|  |  | block |= MemoryMarshal.Read<ushort>(data.Slice(finalBlockPosition)) | (ulong)data[finalBlockPosition + 2] << 16; |
|  |  | break; |
|  |  | case 2: |
|  |  | block |= MemoryMarshal.Read<ushort>(data.Slice(finalBlockPosition)); |
|  |  | break; |
|  |  | case 1: |
|  |  | block |= data[finalBlockPosition]; |
|  |  | break; |
|  |  | } |
|  |  |  |
|  |  | // Process the final block |
|  |  | { |
|  |  | v3 ^= block; |
|  |  |  |
|  |  | // Round 1 |
|  |  | v0 += v1; |
|  |  | v2 += v3; |
|  |  | v1 = v1 << 13 | v1 >> 51; |
|  |  | v3 = v3 << 16 | v3 >> 48; |
|  |  | v1 ^= v0; |
|  |  | v3 ^= v2; |
|  |  | v0 = v0 << 32 | v0 >> 32; |
|  |  | v2 += v1; |
|  |  | v0 += v3; |
|  |  | v1 = v1 << 17 | v1 >> 47; |
|  |  | v3 = v3 << 21 | v3 >> 43; |
|  |  | v1 ^= v2; |
|  |  | v3 ^= v0; |
|  |  | v2 = v2 << 32 | v2 >> 32; |
|  |  |  |
|  |  | // Round 2 |
|  |  | v0 += v1; |
|  |  | v2 += v3; |
|  |  | v1 = v1 << 13 | v1 >> 51; |
|  |  | v3 = v3 << 16 | v3 >> 48; |
|  |  | v1 ^= v0; |
|  |  | v3 ^= v2; |
|  |  | v0 = v0 << 32 | v0 >> 32; |
|  |  | v2 += v1; |
|  |  | v0 += v3; |
|  |  | v1 = v1 << 17 | v1 >> 47; |
|  |  | v3 = v3 << 21 | v3 >> 43; |
|  |  | v1 ^= v2; |
|  |  | v3 ^= v0; |
|  |  | v2 = v2 << 32 | v2 >> 32; |
|  |  |  |
|  |  | v0 ^= block; |
|  |  | v2 ^= 0xff; |
|  |  | } |
|  |  |  |
|  |  | // 4 finalization rounds |
|  |  | { |
|  |  | // Round 1 |
|  |  | v0 += v1; |
|  |  | v2 += v3; |
|  |  | v1 = v1 << 13 | v1 >> 51; |
|  |  | v3 = v3 << 16 | v3 >> 48; |
|  |  | v1 ^= v0; |
|  |  | v3 ^= v2; |
|  |  | v0 = v0 << 32 | v0 >> 32; |
|  |  | v2 += v1; |
|  |  | v0 += v3; |
|  |  | v1 = v1 << 17 | v1 >> 47; |
|  |  | v3 = v3 << 21 | v3 >> 43; |
|  |  | v1 ^= v2; |
|  |  | v3 ^= v0; |
|  |  | v2 = v2 << 32 | v2 >> 32; |
|  |  |  |
|  |  | // Round 2 |
|  |  | v0 += v1; |
|  |  | v2 += v3; |
|  |  | v1 = v1 << 13 | v1 >> 51; |
|  |  | v3 = v3 << 16 | v3 >> 48; |
|  |  | v1 ^= v0; |
|  |  | v3 ^= v2; |
|  |  | v0 = v0 << 32 | v0 >> 32; |
|  |  | v2 += v1; |
|  |  | v0 += v3; |
|  |  | v1 = v1 << 17 | v1 >> 47; |
|  |  | v3 = v3 << 21 | v3 >> 43; |
|  |  | v1 ^= v2; |
|  |  | v3 ^= v0; |
|  |  | v2 = v2 << 32 | v2 >> 32; |
|  |  |  |
|  |  | // Round 3 |
|  |  | v0 += v1; |
|  |  | v2 += v3; |
|  |  | v1 = v1 << 13 | v1 >> 51; |
|  |  | v3 = v3 << 16 | v3 >> 48; |
|  |  | v1 ^= v0; |
|  |  | v3 ^= v2; |
|  |  | v0 = v0 << 32 | v0 >> 32; |
|  |  | v2 += v1; |
|  |  | v0 += v3; |
|  |  | v1 = v1 << 17 | v1 >> 47; |
|  |  | v3 = v3 << 21 | v3 >> 43; |
|  |  | v1 ^= v2; |
|  |  | v3 ^= v0; |
|  |  | v2 = v2 << 32 | v2 >> 32; |
|  |  |  |
|  |  | // Round 4 |
|  |  | v0 += v1; |
|  |  | v2 += v3; |
|  |  | v1 = v1 << 13 | v1 >> 51; |
|  |  | v3 = v3 << 16 | v3 >> 48; |
|  |  | v1 ^= v0; |
|  |  | v3 ^= v2; |
|  |  | v0 = v0 << 32 | v0 >> 32; |
|  |  | v2 += v1; |
|  |  | v0 += v3; |
|  |  | v1 = v1 << 17 | v1 >> 47; |
|  |  | v3 = v3 << 21 | v3 >> 43; |
|  |  | v1 ^= v2; |
|  |  | v3 ^= v0; |
|  |  | v2 = v2 << 32 | v2 >> 32; |
|  |  | } |
|  |  |  |
|  |  | return (long)((v0 ^ v1) ^ (v2 ^ v3)); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |

11 changes: 11 additions & 0 deletions

11
[src/MessagePack.UnityClient/Assets/Scripts/MessagePack/SipHash.cs.meta](#diff-34ca8da77c7c1b6f3d9fb01c84010730b8d3fb71ab2ddf51520d03d38dc5303c "src/MessagePack.UnityClient/Assets/Scripts/MessagePack/SipHash.cs.meta")

Show comments

[View file](/MessagePack-CSharp/MessagePack-CSharp/blob/f8d40b3ad0be01c6e56cb51ecea81f59d98c192d/src/MessagePack.UnityClient/Assets/Scripts/MessagePack/SipHash.cs.meta)
Edit file

Delete file

Load diff

Some generated files are not rendered by default. Learn more about [how customized files appear on GitHub](https://docs.github.com/github/administering-a-repository/customizing-how-changed-files-appear-on-github).

Oops, something went wrong.

Retry

7 changes: 2 additions & 5 deletions

7
[src/MessagePack.UnityClient/Assets/Scripts/Tests/ShareTests/MessagePackSecurityTests.cs](#diff-161574006d959c9eb019e2cb0aa8e7d07e8455d2fe70fe58a309909bd8185b34 "src/MessagePack.UnityClient/Assets/Scripts/Tests/ShareTests/MessagePackSecurityTests.cs")

Show comments

[View file](/MessagePack-CSharp/MessagePack-CSharp/blob/f8d40b3ad0be01c6e56cb51ecea81f59d98c192d/src/MessagePack.UnityClient/Assets/Scripts/Tests/ShareTests/MessagePackSecurityTests.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -125,11 +125,8 @@ public void EqualityComparer\_Enums() |
|  |  | Assert.NotNull(MessagePackSecurity.UntrustedData.GetEqualityComparer<SomeUInt16Enum>()); |
|  |  | Assert.NotNull(MessagePackSecurity.UntrustedData.GetEqualityComparer<SomeInt32Enum>()); |
|  |  | Assert.NotNull(MessagePackSecurity.UntrustedData.GetEqualityComparer<SomeUInt32Enum>()); |
|  |  |  |
|  |  | // Supporting enums with backing integers that exceed 32-bits would likely require Ref.Emit of new types |
|  |  | // since C# doesn't let us cast T to the underlying int type. |
|  |  | Assert.Throws<TypeAccessException>(() => MessagePackSecurity.UntrustedData.GetEqualityComparer<SomeInt64Enum>()); |
|  |  | Assert.Throws<TypeAccessException>(() => MessagePackSecurity.UntrustedData.GetEqualityComparer<SomeUInt64Enum>()); |
|  |  | Assert.NotNull(MessagePackSecurity.UntrustedData.GetEqualityComparer<SomeInt64Enum>()); |
|  |  | Assert.NotNull(MessagePackSecurity.UntrustedData.GetEqualityComparer<SomeUInt64Enum>()); |
|  |  | } |
|  |  |  |
|  |  | [Fact] |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f8d40b3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMessagePack-CSharp%2FMessagePack-CSharp%2Fcommit%2Ff8d40b3ad0be01c6e56cb51ecea81f59d98c192d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

