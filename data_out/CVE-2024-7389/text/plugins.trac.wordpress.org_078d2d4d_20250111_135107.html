

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3047085%2Fforminator%2Ftrunk%2Faddons%2Fpro%2Fhubspot%2Flib%2Fclass-forminator-addon-hubspot-wp-api.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2933305/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php "Changeset 2933305 for forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php")
* [Next Change](/changeset/3081877/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php "Changeset 3081877 for forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php") →

---

# Changeset [3047085](/changeset/3047085 "Show full changeset") for [forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=3047085 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
03/07/2024 12:44:30 PM
([10 months](/timeline?from=2024-03-07T12%3A44%3A30Z&precision=second "See timeline at 03/07/2024 12:44:30 PM") ago)

Author:
ivansvyrskyi
Message:

Release 1.29.2

File:

1 edited

* [forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=3047085 "Show entry in browser")
  (modified)
  ([5 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php](/changeset/3047085/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php "Show the changeset 3047085 restricted to forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php")

  | [r2933305](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=2933305#L11 "Show revision 2933305 of this file in browser") | [r3047085](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=3047085#L11 "Show revision 3047085 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | const AUTHORIZE\_URL = 'https://app.hubspot.com/oauth/authorize'; |
  | 12 | 12 | const CLIENT\_ID     = 'd4c00215-5579-414c-a831-95be7218239b'; |
  | 13 |  | ~~const CLIENT\_SECRET = '502c3a75-38fe-4a1f-9fc4-ff2464b639bf';~~ |
  | 14 |  | ~~const HAPIKEY       = '7cf97e44-4037-4708-a032-0955318e0e76';~~ |
  | 15 | 13 |  |
  | 16 | 14 | public static $oauth\_scopes = 'tickets crm.lists.write crm.lists.read crm.objects.contacts.write crm.objects.contacts.read crm.schemas.contacts.write crm.schemas.contacts.read'; |
  | […](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=2933305#L172) | […](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=3047085#L170) |  |
  | 172 | 170 | $this->\_last\_url\_request = $url; |
  | 173 | 171 |  |
  | 174 |  | $headers = array( |
  | 175 |  | 'Authorization' => 'Bearer ' . ( ! empty( $access\_token ) ? $access\_token : self::HAPIKEY ), |
  | 176 |  | ); |
  |  | 172 | $headers = array(); |
  |  | 173 | if ( $access\_token ) { |
  |  | 174 | $headers = array( |
  |  | 175 | 'Authorization' => 'Bearer ' . $access\_token, |
  |  | 176 | ); |
  |  | 177 | } |
  | 177 | 178 |  |
  | 178 | 179 | if ( 'GET' !== $verb && ! $json ) { |
  | […](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=2933305#L385) | […](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=3047085#L386) |  |
  | 385 | 386 | $response = $this->get\_access\_token( $args ); |
  | 386 | 387 |  |
  | 387 |  | if ( ! ~~is\_wp\_error( $response ) && !~~ empty( $response->access\_token ) ) { |
  |  | 388 | if ( ! empty( $response->access\_token ) ) { |
  | 388 | 389 | return $response->access\_token; |
  | 389 | 390 | } |
  | […](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=2933305#L442) | […](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=3047085#L443) |  |
  | 442 | 443 | public function get\_access\_token( $args = array() ) { |
  | 443 | 444 | $default\_args = array( |
  | 444 |  | 'grant\_type'    => 'authorization\_code', |
  | 445 |  | 'client\_id'     => self::CLIENT\_ID, |
  | 446 |  | 'client\_secret' => self::CLIENT\_SECRET, |
  | 447 |  | 'scope'         => rawurlencode( self::$oauth\_scopes ), |
  |  | 445 | 'grant\_type' => 'authorization\_code', |
  |  | 446 | 'state'      => 'state', // It's added just because state param is required on the final endpoint. It's unuseful here. |
  | 448 | 447 | ); |
  | 449 | 448 | $args         = array\_merge( $default\_args, $args ); |
  | 450 | 449 |  |
  | 451 |  | $response = $this->request( |
  | 452 |  | 'POST', |
  | 453 |  | 'oauth/v1/token', |
  | 454 |  | $args, |
  | 455 |  | '' |
  |  | 450 | $url = Forminator\_Addon\_Hubspot::redirect\_uri( |
  |  | 451 | 'hubspot', |
  |  | 452 | 'get\_access\_token', |
  |  | 453 | $args |
  | 456 | 454 | ); |
  | 457 |  | if ( ! is\_wp\_error( $response ) && ! empty( $response->refresh\_token ) ) { |
  |  | 455 |  |
  |  | 456 | $res      = wp\_remote\_get( $url ); |
  |  | 457 | $body     = is\_wp\_error( $res ) || ! $res ? '' : wp\_remote\_retrieve\_body( $res ); |
  |  | 458 | $response = $body ? json\_decode( $body ) : ''; |
  |  | 459 | if ( ! empty( $response->refresh\_token ) ) { |
  | 458 | 460 | $token\_data = get\_object\_vars( $response ); |
  | 459 | 461 |  |
  | […](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=2933305#L462) | […](/browser/forminator/trunk/addons/pro/hubspot/lib/class-forminator-addon-hubspot-wp-api.php?rev=3047085#L464) |  |
  | 462 | 464 | // Update auth token. |
  | 463 | 465 | $this->update\_auth\_token( $token\_data ); |
  |  | 466 | } elseif ( isset( $response->error ) ) { |
  |  | 467 | if ( 'failed\_request' === $response->error ) { |
  |  | 468 | $error = esc\_html\_\_( 'Failed to process request, make sure your API URL is correct and your server has internet connection.', 'forminator' ); |
  |  | 469 | } else { |
  |  | 470 | $error = sprintf( esc\_html\_\_( 'Failed to process request : %s', 'forminator' ), esc\_html( $response->error ) ); |
  |  | 471 | } |
  |  | 472 |  |
  |  | 473 | throw new Forminator\_Addon\_Hubspot\_Wp\_Api\_Exception( $error ); |
  | 464 | 474 | } |
  | 465 | 475 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3047085)
* [Zip Archive](?format=zip&new=3047085)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

