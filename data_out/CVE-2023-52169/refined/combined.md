=== Content from dfir.ru_77d78ede_20250111_004631.html ===

[Skip to content](#content)

[My DFIR Blog](https://dfir.ru/)

Digital Forensics & Incident Response & Reverse Engineering

Menu

* [Home](/)
* [About Me](https://dfir.ru/me/)
* [My Tools](https://dfir.ru/tools/)

# Vulnerabilities in 7-Zip and¬†ntfs3

[June 19, 2024September 4, 2024](https://dfir.ru/2024/06/19/vulnerabilities-in-7-zip-and-ntfs3/) ~ [msuhanov](https://dfir.ru/author/msuhanov/)

As I demonstrated [before](https://dfir.ru/2023/11/01/cve-2023-45897-a-vulnerability-in-the-linux-exfat-userspace-tools/), the same malformed file system structures can cause overflows/over-reads in independently developed software.

Here is a recent example: a buffer overflow vulnerability found in 7-Zip ‚Äî [CVE-2023-52168](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-52168). This vulnerability is similar to one previously discovered by me in [the ntfsck tool](https://github.com/tuxera/ntfs-3g/issues/16) (from the NTFS-3G driver) ‚Äî [CVE-2021-46790](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-46790).

And even more: a buffer over-read vulnerability in 7-Zip ‚Äî [CVE-2023-52169](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-52169). It shares the same mechanics as a kernel memory disclosure vulnerability in the Linux ntfs3 driver ‚Äî [CVE-2023-45896](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-45896).

Two buffer overflow vulnerabilities mentioned above are caused by the so-called [update sequence array](https://flatcap.github.io/linux-ntfs/ntfs/concepts/fixup.html).

This is an array of two-byte elements which is used in the NTFS file system to reliably detect torn (partial) writes of multiple sectors to traditional storage devices (like hard disk drives).

Let‚Äôs consider the following scenario: we have a data chunk (e.g., a file system structure) that spans across two sectors. We need to update the whole structure (i.e., two adjacent sectors) at once.

In the HDD world, in general, we can [atomically overwrite one sector](https://news.ycombinator.com/item?id=36570264)\*. But we have two of them‚Ä¶ If there is a system crash or a power loss event before we write to the second sector (let‚Äôs call it ‚Äú*sector #2*‚Äù), but after we wrote to the first one (‚Äú*sector #1*‚Äù), we would end up with inconsistent data (sector #1 contains ‚Äúnew‚Äù data, while sector #2 contains ‚Äúold‚Äù data).

*\* ‚Äî keep in mind that, outside of the HDD world, byte-addressable storage devices break this assumption.*

If there are no additional measures to detect such inconsistencies, software parsing that data chuck would use ‚Äúold‚Äù (and no longer valid) data from sector #2 while thinking it is ‚Äúnew‚Äù (like in sector #1, which is the only sector updated before the failure).

Today, developers use checksums to validate on-disk data (we can calculate a checksum over bytes from both sectors and store it somewhere, in one of those sectors). But the NTFS file system was designed to use another approach:

* the NTFS driver creates a two-byte (16-bit) placeholder value;
* the NTFS driver copies the last two bytes from sector #1 and from sector #2 into sector #1, into the update sequence array specifically (this happens in memory);
* the NTFS driver replaces the last two bytes of those two sectors with that placeholder value and also stores the placeholder value into the update sequence array (again, in memory);
* the NTFS driver writes both sectors to the underlying drive.

Here is an example (with 4 sectors used by one structure):

![](https://dfir.ru/wp-content/uploads/2024/06/d0a1d0bdd0b8d0bcd0bed0ba-d18dd0bad180d0b0d0bdd0b0-d0bed182-2024-06-17-23-44-05.png?w=587)

([Source](https://flatcap.github.io/linux-ntfs/ntfs/concepts/fixup.html).)

So, when reading from a drive, we can easily detect torn writes\* by comparing the last two bytes of each sector (within a single multi-sector structure) against a placeholder value, which is recorded in the first sector (of that multi-sector structure). (It is assumed that a placeholder value is different on every write of that multi-sector structure.)

*\* ‚Äî and even subsector torn writes, because the placeholder value is stored in the beginning of the first sector as well as in its last two bytes. If there was a failure when writing to the sector (i.e., a partial write), these values are going to be different.*

If the last two bytes of a current sector match the placeholder value, this sector is up-to-date (and we can restore the original values of the last two bytes of that sector, since they were stored in the update sequence array, which is in sector #1). Otherwise, the sector wasn‚Äôt updated for some reason (there was a torn write).

The update sequence array is stored in sector #1 and it consists of the following elements:

* a placeholder value (two bytes);
* original values to be restored (two bytes each).

The update sequence array length (as a number of two-byte elements) is also stored in sector #1.

For a file system structure occupying 1024 bytes (i.e., two 512-byte sectors, like a file record segment in the NTFS file system), the only valid size of the update sequence array is 3 elements (one placeholder value, two original values). However, we can craft a file system image that contains more elements in the update sequence array than required.

Most NTFS drivers/parsers will reject such an invalid update sequence array, but if there are no proper boundary checks, it would trigger an out-of-bounds write of two bytes, at the following offsets: 512\*i-2 (in the 1024-byte case, when the allocated buffer size is 1024 bytes, *i* is 3, 4, 5 and so on).

This happened to the ntfsck tool ([report](https://github.com/tuxera/ntfs-3g/issues/16)). And now, to the 7-Zip archiver!

Before 7-Zip 24.01 beta, it was possible to craft a file system image that would trigger the overflow.

The vulnerable code in the NTFS handler was:

*In the CMftRec::Parse() function (some comments starting with ‚Äú//‚Äù are mine):*

```
  {
    UInt32 usaOffset;
    UInt32 numUsaItems;
    G16(p + 0x04, usaOffset); // 'p' here is 'ByteBuf' in another function below.
    G16(p + 0x06, numUsaItems); // Get the update sequence array length from a disk.

    /* NTFS stores (usn) to 2 last bytes in each sector (before writing record to disk).
       Original values of these two bytes are stored in table.
       So we restore original data from table */

    if ((usaOffset & 1) != 0
        || usaOffset + numUsaItems * 2 > ((UInt32)1 << sectorSizeLog) - 2
        || numUsaItems == 0
        || numUsaItems - 1 != numSectors) // 'numSectors' here is 'numSectorsInRec' in another function below.
      return false;

    [...]

    UInt16 usn = Get16(p + usaOffset); // Get the placeholder value that should be stored in the last two bytes of the sector.
    // PRF(printf("\nusn = %d", usn));
    for (UInt32 i = 1; i < numUsaItems; i++) // No proper boundary checks here! 'numUsaItems' is attacker-controlled!
    {
      void *pp = p + (i << sectorSizeLog) - 2;
      if (Get16(pp) != usn) // Check if the placeholder value matches the last two bytes of the current sector.
        return false;
      SetUi16(pp, Get16(p + usaOffset + i * 2)); // If so, restore the last two bytes of the current sector.
    }
  }
```

*In the CDatabase::Open() function:*

```
    UInt32 blockSize = 1 << 12; // 4096 bytes!
    ByteBuf.Alloc(blockSize); // Allocate the buffer containing 4096 bytes.
    RINOK(ReadStream_FALSE(InStream, ByteBuf, blockSize));

    {
      UInt32 allocSize = Get32(ByteBuf + 0x1C); // Read the allocated structure size from a disk.
      int t = GetLog(allocSize);
      if (t < (int)Header.SectorSizeLog)
        return S_FALSE;
      RecSizeLog = t;
      if (RecSizeLog > 15)
        return S_FALSE;
    }

    numSectorsInRec = 1 << (RecSizeLog - Header.SectorSizeLog);
    if (!mftRec.Parse(ByteBuf, Header.SectorSizeLog, numSectorsInRec, 0, NULL)) // 'numSectorsInRec' here is the same as 'numSectors' in the function above.
```

So, in general, in order to validate the number of the update sequence array elements, the code quoted above uses data from a disk (or a file system image) solely. Which is attacker-controlled, of course.

It is possible to craft a file system image in a way that: ‚Äò*allocSize*‚Äò is larger than 4096 bytes (e.g., 32768 bytes) and ‚Äò*numUsaItems ‚Äì 1 != numSectors*‚Äò is false, while the allocated buffer size (‚Äò*ByteBuf*‚Äò) is always 4096 bytes. When restoring the last two bytes of each sector, this allows out-of-bounds writes, beyond the boundary of the 4096-byte buffer.

*Such an overflow is very hard to exploit, but who knows‚Ä¶*

**Timeline** (for the 7-Zip archiver)

* 2023-08-18: the vulnerability was reported by me to Igor Pavlov.
* 2024-01-31: a fixed version (24.01 beta) is available.

---

And two buffer over-read vulnerabilities occur when parsing a file name from the NTFS file system.

In the NTFS file system, file names are stored as wide (UTF-16LE) strings in the $FILE\_NAME structure, which has the following layout:

![](https://dfir.ru/wp-content/uploads/2024/06/d0a1d0bdd0b8d0bcd0bed0ba-d18dd0bad180d0b0d0bdd0b0-d0bed182-2024-06-18-19-39-56.png?w=488)

([Source](https://flatcap.github.io/linux-ntfs/ntfs/attributes/file_name.html).)

The idea is to modify the $FILE\_NAME attribute, so its ‚Äú*Filename length in characters*‚Äù value becomes larger than a corresponding memory allocation containing the attribute. If there are no proper boundary checks, arbitrary data would appear as a part of a file name string.

In the NTFS handler (7-Zip), there was a typo in the file name length check:

```
bool CFileNameAttr::Parse(const Byte *p, unsigned size)
{
  if (size < 0x42)
    return false;
  G64(p + 0x00, ParentDirRef.Val);
  // G64(p + 0x08, CTime);
  // G64(p + 0x10, MTime);
  // G64(p + 0x18, ThisRecMTime);
  // G64(p + 0x20, ATime);
  // G64(p + 0x28, AllocatedSize);
  // G64(p + 0x30, DataSize);
  G32(p + 0x38, Attrib);
  // G16(p + 0x3C, PackedEaSize);
  NameType = p[0x41];
  unsigned len = p[0x40];
  if (0x42 + len > size) // Should be: 0x42 + len * 2 > size
    return false;
  if (len != 0)
    GetString(p + 0x42, len, Name); // This extracts a wide character string (UTF-16LE) from 'p + 0x42'.
  return true;
}
```

The check incorrectly treats the ‚Äú*Filename length in [UTF-16LE] characters*‚Äù field as ‚Äú*Filename length in bytes*‚Äù. So, it‚Äôs possible to include data beyond the $FILE\_NAME attribute in memory as a part of a file name string (if ‚Äò*0x42 + len > size*‚Äò is false, but ‚Äò*GetString(p + 0x42, len, Name)*‚Äò extracts data up to ‚Äò*p + 0x42 + len \* 2*‚Äò).

In the Linux ntfs3 driver, there is no check at all:

```
	if (ino == MFT_REC_ROOT)
		return 0;

	/* Skip meta files. Unless option to show metafiles is set. */
	if (!sbi->options->showmeta && ntfs_is_meta_file(sbi, ino))
		return 0;

	if (sbi->options->nohidden && (fname->dup.fa & FILE_ATTRIBUTE_HIDDEN))
		return 0;

	name_len = ntfs_utf16_to_nls(sbi, fname->name, fname->name_len, name,
				     PATH_MAX);
	if (name_len <= 0) {
		ntfs_warn(sbi->sb, "failed to convert name for inode %lx.",
			  ino);
		return 0;
	}
```

In both cases (ntfs3 and 7-Zip), a missing check exposes some memory beyond the intended buffer (exposed as a part of a file name string).

In the ntfs3 case, this exposes some amount of kernel memory to userspace programs. In my tests, an unprivileged user could leak addresses from the ‚Äú*/proc/kallsyms*‚Äù file by attaching a USB drive containing a crafted file system image, mounting it (in many Linux distributions, unprivileged users are allowed to mount file systems on removable drives), and listing its contents.

In the 7-Zip case, things are more complicated: there is no obvious impact of exposing bytes from memory allocations of an application launched by the same user. However, the 7-Zip library can be used by online services to parse archives uploaded by untrusted users. If the same application instance is used to parse archives uploaded by multiple users, this could expose secrets from one archive to a different user. *(**Update, 2024-07-03:** and there was one online service working this way, affected by the vulnerability.)*

**Timeline** (for the ntfs3 driver)

* 2023-08-13: the vulnerability was reported by me the Linux kernel security team.
* 2023-08-13: Greg KH and Linus Torvalds told me that this is not a security issue.

*According to Greg KH:*

> The filesystem developers say that ‚Äúmanually corrupted filesystem images are not a security problem‚Äù. But it is a bug, so let‚Äôs fix it and get it merged please. That‚Äôs the best way, and isn‚Äôt worth haggling over ‚Äúwas this specific bugfix a security fix‚Äù.
>
> Remember, in the kernel ‚Äúa bug is a bug is a bug‚Äù üôÇ

As a side note: unprivileged users can mount crafted file system images on removable drives, and exposing chunks of kernel memory to such users is a vulnerability. And even remote attack vectors are possible when a file system image is mounted from a network-based source (like NAS or SAN)‚Ä¶ Are your VMware ESXi datastores local?

*For the 7-Zip archiver, the timeline is the same as described above, in the overflow case (two vulnerabilities were reported and fixed together).*

**Update (2024-07-03):**

Igor Pavlov, the author of 7-Zip, refused to provide an advisory or any related change log entries.

> If we open it now *[my note: ‚Äúnow‚Äù is 272 days from the vulnerability report, 106 days from the released fix]*, it will increase the risks for possible attacks as I suppose.

[Here is a screenshot of my report](https://dfir.ru/wp-content/uploads/2024/07/screenshot-2024-07-03-at-02-13-40-7-zip-_-bugs-_-2402-two-vulnerabilities-in-the-ntfs-handler.png). The [patched code](https://github.com/ip7z/7zip/commit/fc662341e6f85da78ada0e443f6116b978f79f22) is‚Ä¶ For the overflow:

![](https://dfir.ru/wp-content/uploads/2024/06/image-1.png?w=759)

The ‚ÄúMftRecordSizeLog‚Äù variable is properly validated:

![](https://dfir.ru/wp-content/uploads/2024/06/image-2.png?w=591)

And, for the over-read:

![](https://dfir.ru/wp-content/uploads/2024/06/image.png?w=678)

Also, note that CVE IDs assigned to the new vulnerabilities described in this post are still marked as reserved.

MITRE didn‚Äôt reply to my publication request.

**Update (2024-08-28):** CVE-2023-45896 is now public, but marked as disputed (and fixed).

If unprivileged users read bytes from kernel memory, this is a vulnerability. ~~But if they do so using a malicious file system image, it‚Äôs not.~~

Two other CVE IDs (for 7-Zip) became public earlier (in July).

**Update (2024-09-04):** CVE-2023-45896 wasn‚Äôt fixed in the Linux kernel version 6.5.11, contrary to the CVE ID description.

> \*\* DISPUTED \*\* ntfs3 **in the Linux kernel before 6.5.11** allows a physically proximate attacker to read kernel memory by mounting a filesystem (e.g., if a Linux distribution is configured to allow unprivileged mounts of removable media) and then leveraging local access to trigger an out-of-bounds read. A length value can be larger than the amount of memory allocated. *[‚Ä¶]*

I was able to reproduce the issue using the Linux kernel version 6.8.0 (as shipped in Ubuntu 24.04.1).

It seems that MITRE misrecognized sanity checks implemented for the name field of the attribute header, because the actual out-of-bounds read reported by me was in the name field of the $FILE\_NAME structure, which is placed after the unnamed attribute header (see: [this](https://flatcap.github.io/linux-ntfs/ntfs/concepts/attribute_header.html) and [this](https://flatcap.github.io/linux-ntfs/ntfs/attributes/file_name.html)).

*Again: the vulnerability wasn‚Äôt fixed in the Linux kernel version 6.5.11!*

Here are the screenshots of my proof-of-concept code running on a ‚Äúfixed‚Äù version (this is exactly the same code that was originally sent to the Linux kernel security team):

![](https://dfir.ru/wp-content/uploads/2024/06/kernel_680_cve_not_fixed_1.png?w=949)![](https://dfir.ru/wp-content/uploads/2024/06/kernel_680_cve_not_fixed_2.png?w=950)
### Share this:

* [Twitter](https://dfir.ru/2024/06/19/vulnerabilities-in-7-zip-and-ntfs3/?share=twitter "Click to share on Twitter")
* [Facebook](https://dfir.ru/2024/06/19/vulnerabilities-in-7-zip-and-ntfs3/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

Posted in [NTFS](https://dfir.ru/category/ntfs/), [research](https://dfir.ru/category/research/), [vulnerability](https://dfir.ru/category/vulnerability/)

![](https://1.gravatar.com/avatar/7080afd45e36103ecb41521121b88abb23dc5eff14343f0deeede9c1c0cbd4e8?s=60&d=identicon&r=G)
## Published by msuhanov

[View all posts by msuhanov](https://dfir.ru/author/msuhanov/)

## Post navigation

[‚Äπ PreviousOperation-based prefetching](https://dfir.ru/2024/04/09/operation-based-prefetching/)[Next ‚Ä∫Multiple vulnerabilities in AMI file system¬†drivers](https://dfir.ru/2024/12/09/multiple-vulnerabilities-in-ami-file-system-drivers/)

## 5 thoughts on ‚ÄúVulnerabilities in 7-Zip and¬†ntfs3‚Äù

1. Pingback: [Week 25 ‚Äì 2024 ‚Äì This Week In 4n6](http://thisweekin4n6.com/2024/06/23/week-25-2024/)
3. Pingback: [7-Zip quietly fixes a buffer overflow vulnerability](https://stackdiary.com/7-zip-quietly-fixes-a-buffer-overflow-vulnerability/)
5. Pingback: [7-ZipÊÇÑÊÇÑ‰øÆÂæ©‰∫Ü‰∏ÄÂÄãÂÆâÂÖ®ÊºèÊ¥ûÂÖ∂‰ªñÂü∫Êñº7zÁöÑÂ£ìÁ∏ÆËªüÈ´î‰πüÈúÄÊõ¥Êñ∞ ‚Äì WONGCW Á∂≤Ë™å](https://blog.wongcw.com/2024/07/05/7-zip%E6%82%84%E6%82%84%E4%BF%AE%E5%BE%A9%E4%BA%86%E4%B8%80%E5%80%8B%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%E5%85%B6%E4%BB%96%E5%9F%BA%E6%96%BC7z%E7%9A%84%E5%A3%93%EF%BF%BD%25b)
7. Pingback: [CVE-2023-52168 & CVE-2023-52169 in 7-Zip Uncovered and Addressed: What You Need to Know - The Information Technology Daily](https://securityexpress.info/cve-2023-52168-cve-2023-52169-in-7-zip-uncovered-and-addressed-what-you-need-to-know/)
9. Pingback: [Multiple vulnerabilities in AMI file system drivers ‚Äì My DFIR Blog](https://dfir.ru/2024/12/09/multiple-vulnerabilities-in-ami-file-system-drivers/)

### Leave a comment [Cancel reply](/2024/06/19/vulnerabilities-in-7-zip-and-ntfs3/#respond)

Œî

Search for:

# Follow Blog via Email

Enter your email address to follow this blog and receive notifications of new posts by email.

Email Address:

Follow

Join 75 other subscribers

[Create a website or blog at WordPress.com](https://wordpress.com/?ref=footer_custom_svg "Create a website or blog at WordPress.com")

* [Comment](https://dfir.ru/2024/06/19/vulnerabilities-in-7-zip-and-ntfs3/#comments)
* Reblog
* Subscribe
  Subscribed

  + [![](https://dfir.ru/wp-content/uploads/2018/07/cropped-logo1.png?w=50) My DFIR Blog](https://dfir.ru)

  Join 75 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fdfir.ru%252F2024%252F06%252F19%252Fvulnerabilities-in-7-zip-and-ntfs3%252F)
* Privacy
* + [![](https://dfir.ru/wp-content/uploads/2018/07/cropped-logo1.png?w=50) My DFIR Blog](https://dfir.ru)
  + [Customize](https://dfirru.wordpress.com/wp-admin/customize.php?url=https%3A%2F%2Fdfirru.wordpress.com%2F2024%2F06%2F19%2Fvulnerabilities-in-7-zip-and-ntfs3%2F)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fdfir.ru%252F2024%252F06%252F19%252Fvulnerabilities-in-7-zip-and-ntfs3%252F)
  + [Copy shortlink](https://wp.me/pa5GsX-tV)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://dfir.ru/2024/06/19/vulnerabilities-in-7-zip-and-ntfs3/)
  + [View post in Reader](https://wordpress.com/read/blogs/149118243/posts/1855)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)



=== Content from www.openwall.com_f867649d_20250111_004631.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux ¬† *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper ¬† *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists ¬† *for password cracking*](/wordlists/)+ [passwdqc ¬† *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt ¬† *KDF & password hashing*](/yescrypt/)+ [yespower ¬† *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish ¬† *password hashing*](/crypt/)+ [phpass ¬† *ditto in PHP*](/phpass/)+ [tcb ¬† *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd ¬† *port scan detector*](/scanlogd/)+ [popa3d ¬† *tiny POP3 daemon*](/popa3d/)+ [blists ¬† *web interface to mailing lists*](/blists/)+ [msulogin ¬† *single user mode login*](/msulogin/)+ [php\_mt\_seed ¬† *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](9) [[next>]](11) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAKeu6dVdYwMWbrqUo34i8JMFWPxorbCwgBEM0LQkZsuojT6Zhw@mail.gmail.com>
Date: Wed, 3 Jul 2024 19:20:41 +0300
From: Maxim Suhanov <dfirblog@...il.com>
To: oss-security@...ts.openwall.com
Subject: CVE-2023-52168, CVE-2023-52169: buffer overflow, over-read
 vulnerabilities in the 7-Zip archiver

Reference:
<https://dfir.ru/2024/06/19/vulnerabilities-in-7-zip-and-ntfs3/>

Details:

In short, both vulnerabilities affect the "full" implementation (i.e.,
7zz and its library), which includes the NTFS parser.
Implementations not using the NTFS parser (e.g., 7za and 7zr) aren't affected.
Both vulnerabilities were silently fixed in 24.01 (beta). No advisory
(or a related change log entry) issued.

CVE-2023-52168:
> The NtfsHandler.cpp NTFS handler in 7-Zip through 23.01 contains a heap-based buffer
> overflow that allows an attacker to overwrite two bytes at multiple
> offsets beyond the allocated buffer size: buffer+512*i-2, for i=9, i=10,
> i=11, etc.

This vulnerability would be very hard to exploit to gain code execution.

CVE-2023-52169:
> The NtfsHandler.cpp NTFS handler in 7-Zip through 23.01 contains an out-of-bounds read
> that allows an attacker to read beyond the intended buffer.
> The bytes read beyond the intended buffer are presented as a part of a
> filename listed in the file system image. This has security relevance in
> known web-service use cases where untrusted users can upload files
> and have them extracted by a server-side 7-Zip process.

This over-read bug affects implementations that:
- use 7-Zip as a library to process archives, and
- run a single process to process archives from multiple (untrusted)
sources, and
- allow users to observe file names stored in their processed archives.

(Otherwise, there are no obvious security implications.)

Examples include online tools to convert/extract archives.
At least one online service was affected by this vulnerability: i.e.,
it allowed a remote attacker to leak chunks of data from a server-side
process.

Timeline:

* 2023-08-18: the vulnerability was reported to Igor Pavlov.
* 2024-01-31: a fixed version (24.01 beta) is available.

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_b0cf90a4_20250111_004631.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux ¬† *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper ¬† *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists ¬† *for password cracking*](/wordlists/)+ [passwdqc ¬† *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt ¬† *KDF & password hashing*](/yescrypt/)+ [yespower ¬† *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish ¬† *password hashing*](/crypt/)+ [phpass ¬† *ditto in PHP*](/phpass/)+ [tcb ¬† *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd ¬† *port scan detector*](/scanlogd/)+ [popa3d ¬† *tiny POP3 daemon*](/popa3d/)+ [blists ¬† *web interface to mailing lists*](/blists/)+ [msulogin ¬† *single user mode login*](/msulogin/)+ [php\_mt\_seed ¬† *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](9) [[next>]](11) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAKeu6dVdYwMWbrqUo34i8JMFWPxorbCwgBEM0LQkZsuojT6Zhw@mail.gmail.com>
Date: Wed, 3 Jul 2024 19:20:41 +0300
From: Maxim Suhanov <dfirblog@...il.com>
To: oss-security@...ts.openwall.com
Subject: CVE-2023-52168, CVE-2023-52169: buffer overflow, over-read
 vulnerabilities in the 7-Zip archiver

Reference:
<https://dfir.ru/2024/06/19/vulnerabilities-in-7-zip-and-ntfs3/>

Details:

In short, both vulnerabilities affect the "full" implementation (i.e.,
7zz and its library), which includes the NTFS parser.
Implementations not using the NTFS parser (e.g., 7za and 7zr) aren't affected.
Both vulnerabilities were silently fixed in 24.01 (beta). No advisory
(or a related change log entry) issued.

CVE-2023-52168:
> The NtfsHandler.cpp NTFS handler in 7-Zip through 23.01 contains a heap-based buffer
> overflow that allows an attacker to overwrite two bytes at multiple
> offsets beyond the allocated buffer size: buffer+512*i-2, for i=9, i=10,
> i=11, etc.

This vulnerability would be very hard to exploit to gain code execution.

CVE-2023-52169:
> The NtfsHandler.cpp NTFS handler in 7-Zip through 23.01 contains an out-of-bounds read
> that allows an attacker to read beyond the intended buffer.
> The bytes read beyond the intended buffer are presented as a part of a
> filename listed in the file system image. This has security relevance in
> known web-service use cases where untrusted users can upload files
> and have them extracted by a server-side 7-Zip process.

This over-read bug affects implementations that:
- use 7-Zip as a library to process archives, and
- run a single process to process archives from multiple (untrusted)
sources, and
- allow users to observe file names stored in their processed archives.

(Otherwise, there are no obvious security implications.)

Examples include online tools to convert/extract archives.
At least one online service was affected by this vulnerability: i.e.,
it allowed a remote attacker to leak chunks of data from a server-side
process.

Timeline:

* 2023-08-18: the vulnerability was reported to Igor Pavlov.
* 2024-01-31: a fixed version (24.01 beta) is available.

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


