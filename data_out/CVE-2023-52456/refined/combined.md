=== Content from git.kernel.org_52a7fd2f_20250111_040455.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9a662d06c22ddfa371958c2071dc350436be802b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9a662d06c22ddfa371958c2071dc350436be802b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9a662d06c22ddfa371958c2071dc350436be802b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9a662d06c22ddfa371958c2071dc350436be802b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paul Geurts <paul\_geurts@live.nl> | 2023-11-24 14:11:10 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 15:45:21 -0800 |
| commit | [9a662d06c22ddfa371958c2071dc350436be802b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9a662d06c22ddfa371958c2071dc350436be802b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9a662d06c22ddfa371958c2071dc350436be802b)) | |
| tree | [2919f8636f1e9b4615044f384c22bba85c81304c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9a662d06c22ddfa371958c2071dc350436be802b) | |
| parent | [ca48380cd6af00aa047dc09b358ed8aa782ff994](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ca48380cd6af00aa047dc09b358ed8aa782ff994) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9a662d06c22ddfa371958c2071dc350436be802b&id2=ca48380cd6af00aa047dc09b358ed8aa782ff994)) | |
| download | [linux-9a662d06c22ddfa371958c2071dc350436be802b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9a662d06c22ddfa371958c2071dc350436be802b.tar.gz) | |

serial: imx: fix tx statemachine deadlock[ Upstream commit 78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0 ]
When using the serial port as RS485 port, the tx statemachine is used to
control the RTS pin to drive the RS485 transceiver TX\_EN pin. When the
TTY port is closed in the middle of a transmission (for instance during
userland application crash), imx\_uart\_shutdown disables the interface
and disables the Transmission Complete interrupt. afer that,
imx\_uart\_stop\_tx bails on an incomplete transmission, to be retriggered
by the TC interrupt. This interrupt is disabled and therefore the tx
statemachine never transitions out of SEND. The statemachine is in
deadlock now, and the TX\_EN remains low, making the interface useless.
imx\_uart\_stop\_tx now checks for incomplete transmission AND whether TC
interrupts are enabled before bailing to be retriggered. This makes sure
the state machine handling is reached, and is properly set to
WAIT\_AFTER\_SEND.
Fixes: cb1a60923609 ("serial: imx: implement rts delaying for rs485")
Signed-off-by: Paul Geurts <paul\_geurts@live.nl>
Tested-by: Rasmus Villemoes <rasmus.villemoes@prevas.dk>
Tested-by: Eberhard Stoll <eberhard.stoll@gmx.de>
Link: [https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A@AM0PR09MB2675.eurprd09.prod.outlook.com](https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A%40AM0PR09MB2675.eurprd09.prod.outlook.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9a662d06c22ddfa371958c2071dc350436be802b)

| -rw-r--r-- | [drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/imx.c?id=9a662d06c22ddfa371958c2071dc350436be802b) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/tty/serial/imx.c b/drivers/tty/serial/imx.cindex 4cecc097408e5e..16207b9a8c81c3 100644--- a/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=ca48380cd6af00aa047dc09b358ed8aa782ff994)+++ b/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=9a662d06c22ddfa371958c2071dc350436be802b)@@ -415,13 +415,13 @@ static void imx\_uart\_stop\_tx(struct uart\_port \*port) ucr1 = imx\_uart\_readl(sport, UCR1); imx\_uart\_writel(sport, ucr1 & ~UCR1\_TRDYEN, UCR1); + ucr4 = imx\_uart\_readl(sport, UCR4); usr2 = imx\_uart\_readl(sport, USR2);- if (!(usr2 & USR2\_TXDC)) {+ if ((!(usr2 & USR2\_TXDC)) && (ucr4 & UCR4\_TCEN)) { /\* The shifter is still busy, so retry once TC triggers \*/ return; } - ucr4 = imx\_uart\_readl(sport, UCR4); ucr4 &= ~UCR4\_TCEN; imx\_uart\_writel(sport, ucr4, UCR4); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:03:32 +0000



=== Content from git.kernel.org_b685b1bb_20250111_040452.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paul Geurts <paul\_geurts@live.nl> | 2023-11-24 14:11:10 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 15:27:46 -0800 |
| commit | [63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06)) | |
| tree | [ca9769c59bf5274061f31b54f57f834a7aa7f36a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06) | |
| parent | [3f9ec4227e4406298e864e15b8b61421686a716c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3f9ec4227e4406298e864e15b8b61421686a716c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06&id2=3f9ec4227e4406298e864e15b8b61421686a716c)) | |
| download | [linux-63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06.tar.gz) | |

serial: imx: fix tx statemachine deadlock[ Upstream commit 78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0 ]
When using the serial port as RS485 port, the tx statemachine is used to
control the RTS pin to drive the RS485 transceiver TX\_EN pin. When the
TTY port is closed in the middle of a transmission (for instance during
userland application crash), imx\_uart\_shutdown disables the interface
and disables the Transmission Complete interrupt. afer that,
imx\_uart\_stop\_tx bails on an incomplete transmission, to be retriggered
by the TC interrupt. This interrupt is disabled and therefore the tx
statemachine never transitions out of SEND. The statemachine is in
deadlock now, and the TX\_EN remains low, making the interface useless.
imx\_uart\_stop\_tx now checks for incomplete transmission AND whether TC
interrupts are enabled before bailing to be retriggered. This makes sure
the state machine handling is reached, and is properly set to
WAIT\_AFTER\_SEND.
Fixes: cb1a60923609 ("serial: imx: implement rts delaying for rs485")
Signed-off-by: Paul Geurts <paul\_geurts@live.nl>
Tested-by: Rasmus Villemoes <rasmus.villemoes@prevas.dk>
Tested-by: Eberhard Stoll <eberhard.stoll@gmx.de>
Link: [https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A@AM0PR09MB2675.eurprd09.prod.outlook.com](https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A%40AM0PR09MB2675.eurprd09.prod.outlook.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06)

| -rw-r--r-- | [drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/imx.c?id=63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/tty/serial/imx.c b/drivers/tty/serial/imx.cindex 48c05fc1064e95..c2cc104225ecbc 100644--- a/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=3f9ec4227e4406298e864e15b8b61421686a716c)+++ b/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=63ee7be01a3f7d28b1ea8b8d7944f12bb7b0ed06)@@ -450,13 +450,13 @@ static void imx\_uart\_stop\_tx(struct uart\_port \*port) ucr1 = imx\_uart\_readl(sport, UCR1); imx\_uart\_writel(sport, ucr1 & ~UCR1\_TRDYEN, UCR1); + ucr4 = imx\_uart\_readl(sport, UCR4); usr2 = imx\_uart\_readl(sport, USR2);- if (!(usr2 & USR2\_TXDC)) {+ if ((!(usr2 & USR2\_TXDC)) && (ucr4 & UCR4\_TCEN)) { /\* The shifter is still busy, so retry once TC triggers \*/ return; } - ucr4 = imx\_uart\_readl(sport, UCR4); ucr4 &= ~UCR4\_TCEN; imx\_uart\_writel(sport, ucr4, UCR4); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:03:29 +0000



=== Content from git.kernel.org_f1c15c7f_20250111_040454.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paul Geurts <paul\_geurts@live.nl> | 2023-11-24 14:11:10 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-12-08 12:02:36 +0100 |
| commit | [78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0)) | |
| tree | [7a53b1c5ea52ecccff450586d745bf2a324f0b4d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0) | |
| parent | [d804987153e7bedf503f8e4ba649afe52cfd7f6d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d804987153e7bedf503f8e4ba649afe52cfd7f6d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0&id2=d804987153e7bedf503f8e4ba649afe52cfd7f6d)) | |
| download | [linux-78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0.tar.gz) | |

serial: imx: fix tx statemachine deadlockWhen using the serial port as RS485 port, the tx statemachine is used to
control the RTS pin to drive the RS485 transceiver TX\_EN pin. When the
TTY port is closed in the middle of a transmission (for instance during
userland application crash), imx\_uart\_shutdown disables the interface
and disables the Transmission Complete interrupt. afer that,
imx\_uart\_stop\_tx bails on an incomplete transmission, to be retriggered
by the TC interrupt. This interrupt is disabled and therefore the tx
statemachine never transitions out of SEND. The statemachine is in
deadlock now, and the TX\_EN remains low, making the interface useless.
imx\_uart\_stop\_tx now checks for incomplete transmission AND whether TC
interrupts are enabled before bailing to be retriggered. This makes sure
the state machine handling is reached, and is properly set to
WAIT\_AFTER\_SEND.
Fixes: cb1a60923609 ("serial: imx: implement rts delaying for rs485")
Signed-off-by: Paul Geurts <paul\_geurts@live.nl>
Tested-by: Rasmus Villemoes <rasmus.villemoes@prevas.dk>
Tested-by: Eberhard Stoll <eberhard.stoll@gmx.de>
Link: [https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A@AM0PR09MB2675.eurprd09.prod.outlook.com](https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A%40AM0PR09MB2675.eurprd09.prod.outlook.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0)

| -rw-r--r-- | [drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/imx.c?id=78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/tty/serial/imx.c b/drivers/tty/serial/imx.cindex 52dd8a6b87603f..e7e952bb7bb8a1 100644--- a/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=d804987153e7bedf503f8e4ba649afe52cfd7f6d)+++ b/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0)@@ -415,13 +415,13 @@ static void imx\_uart\_stop\_tx(struct uart\_port \*port) ucr1 = imx\_uart\_readl(sport, UCR1); imx\_uart\_writel(sport, ucr1 & ~UCR1\_TRDYEN, UCR1); + ucr4 = imx\_uart\_readl(sport, UCR4); usr2 = imx\_uart\_readl(sport, USR2);- if (!(usr2 & USR2\_TXDC)) {+ if ((!(usr2 & USR2\_TXDC)) && (ucr4 & UCR4\_TCEN)) { /\* The shifter is still busy, so retry once TC triggers \*/ return; } - ucr4 = imx\_uart\_readl(sport, UCR4); ucr4 &= ~UCR4\_TCEN; imx\_uart\_writel(sport, ucr4, UCR4); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:03:31 +0000



=== Content from git.kernel.org_ee77795d_20250111_040453.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6e04a9d30509fb53ba6df5d655ed61d607a7cfda)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6e04a9d30509fb53ba6df5d655ed61d607a7cfda)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6e04a9d30509fb53ba6df5d655ed61d607a7cfda)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6e04a9d30509fb53ba6df5d655ed61d607a7cfda)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paul Geurts <paul\_geurts@live.nl> | 2023-11-24 14:11:10 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 14:37:54 -0800 |
| commit | [6e04a9d30509fb53ba6df5d655ed61d607a7cfda](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6e04a9d30509fb53ba6df5d655ed61d607a7cfda) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6e04a9d30509fb53ba6df5d655ed61d607a7cfda)) | |
| tree | [6ec2d4ed98023ea30598f40d28117bd458dc760c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6e04a9d30509fb53ba6df5d655ed61d607a7cfda) | |
| parent | [6746f3e8939dd3cd8ebe928e3f913e9cdfcaffd5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6746f3e8939dd3cd8ebe928e3f913e9cdfcaffd5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6e04a9d30509fb53ba6df5d655ed61d607a7cfda&id2=6746f3e8939dd3cd8ebe928e3f913e9cdfcaffd5)) | |
| download | [linux-6e04a9d30509fb53ba6df5d655ed61d607a7cfda.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6e04a9d30509fb53ba6df5d655ed61d607a7cfda.tar.gz) | |

serial: imx: fix tx statemachine deadlock[ Upstream commit 78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0 ]
When using the serial port as RS485 port, the tx statemachine is used to
control the RTS pin to drive the RS485 transceiver TX\_EN pin. When the
TTY port is closed in the middle of a transmission (for instance during
userland application crash), imx\_uart\_shutdown disables the interface
and disables the Transmission Complete interrupt. afer that,
imx\_uart\_stop\_tx bails on an incomplete transmission, to be retriggered
by the TC interrupt. This interrupt is disabled and therefore the tx
statemachine never transitions out of SEND. The statemachine is in
deadlock now, and the TX\_EN remains low, making the interface useless.
imx\_uart\_stop\_tx now checks for incomplete transmission AND whether TC
interrupts are enabled before bailing to be retriggered. This makes sure
the state machine handling is reached, and is properly set to
WAIT\_AFTER\_SEND.
Fixes: cb1a60923609 ("serial: imx: implement rts delaying for rs485")
Signed-off-by: Paul Geurts <paul\_geurts@live.nl>
Tested-by: Rasmus Villemoes <rasmus.villemoes@prevas.dk>
Tested-by: Eberhard Stoll <eberhard.stoll@gmx.de>
Link: [https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A@AM0PR09MB2675.eurprd09.prod.outlook.com](https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A%40AM0PR09MB2675.eurprd09.prod.outlook.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6e04a9d30509fb53ba6df5d655ed61d607a7cfda)

| -rw-r--r-- | [drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/imx.c?id=6e04a9d30509fb53ba6df5d655ed61d607a7cfda) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/tty/serial/imx.c b/drivers/tty/serial/imx.cindex f236e4738b7865..8bb7d5b5de9da5 100644--- a/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=6746f3e8939dd3cd8ebe928e3f913e9cdfcaffd5)+++ b/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=6e04a9d30509fb53ba6df5d655ed61d607a7cfda)@@ -461,13 +461,13 @@ static void imx\_uart\_stop\_tx(struct uart\_port \*port) ucr1 = imx\_uart\_readl(sport, UCR1); imx\_uart\_writel(sport, ucr1 & ~UCR1\_TRDYEN, UCR1); + ucr4 = imx\_uart\_readl(sport, UCR4); usr2 = imx\_uart\_readl(sport, USR2);- if (!(usr2 & USR2\_TXDC)) {+ if ((!(usr2 & USR2\_TXDC)) && (ucr4 & UCR4\_TCEN)) { /\* The shifter is still busy, so retry once TC triggers \*/ return; } - ucr4 = imx\_uart\_readl(sport, UCR4); ucr4 &= ~UCR4\_TCEN; imx\_uart\_writel(sport, ucr4, UCR4); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:03:30 +0000



=== Content from git.kernel.org_bf8627b5_20250111_040453.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=763cd68746317b5d746dc2649a3295c1efb41181)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=763cd68746317b5d746dc2649a3295c1efb41181)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=763cd68746317b5d746dc2649a3295c1efb41181)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=763cd68746317b5d746dc2649a3295c1efb41181)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paul Geurts <paul\_geurts@live.nl> | 2023-11-24 14:11:10 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 15:35:52 -0800 |
| commit | [763cd68746317b5d746dc2649a3295c1efb41181](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=763cd68746317b5d746dc2649a3295c1efb41181) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=763cd68746317b5d746dc2649a3295c1efb41181)) | |
| tree | [f4fc86748b79b2954b04b8381ce328f89dd5413f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=763cd68746317b5d746dc2649a3295c1efb41181) | |
| parent | [2b327d0fe0d2f18c5f3c01905019d0192565bbe8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2b327d0fe0d2f18c5f3c01905019d0192565bbe8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=763cd68746317b5d746dc2649a3295c1efb41181&id2=2b327d0fe0d2f18c5f3c01905019d0192565bbe8)) | |
| download | [linux-763cd68746317b5d746dc2649a3295c1efb41181.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-763cd68746317b5d746dc2649a3295c1efb41181.tar.gz) | |

serial: imx: fix tx statemachine deadlock[ Upstream commit 78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0 ]
When using the serial port as RS485 port, the tx statemachine is used to
control the RTS pin to drive the RS485 transceiver TX\_EN pin. When the
TTY port is closed in the middle of a transmission (for instance during
userland application crash), imx\_uart\_shutdown disables the interface
and disables the Transmission Complete interrupt. afer that,
imx\_uart\_stop\_tx bails on an incomplete transmission, to be retriggered
by the TC interrupt. This interrupt is disabled and therefore the tx
statemachine never transitions out of SEND. The statemachine is in
deadlock now, and the TX\_EN remains low, making the interface useless.
imx\_uart\_stop\_tx now checks for incomplete transmission AND whether TC
interrupts are enabled before bailing to be retriggered. This makes sure
the state machine handling is reached, and is properly set to
WAIT\_AFTER\_SEND.
Fixes: cb1a60923609 ("serial: imx: implement rts delaying for rs485")
Signed-off-by: Paul Geurts <paul\_geurts@live.nl>
Tested-by: Rasmus Villemoes <rasmus.villemoes@prevas.dk>
Tested-by: Eberhard Stoll <eberhard.stoll@gmx.de>
Link: [https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A@AM0PR09MB2675.eurprd09.prod.outlook.com](https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A%40AM0PR09MB2675.eurprd09.prod.outlook.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=763cd68746317b5d746dc2649a3295c1efb41181)

| -rw-r--r-- | [drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/imx.c?id=763cd68746317b5d746dc2649a3295c1efb41181) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/tty/serial/imx.c b/drivers/tty/serial/imx.cindex 2e85c77e7c0dca..c084ac3bb4410b 100644--- a/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=2b327d0fe0d2f18c5f3c01905019d0192565bbe8)+++ b/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=763cd68746317b5d746dc2649a3295c1efb41181)@@ -421,13 +421,13 @@ static void imx\_uart\_stop\_tx(struct uart\_port \*port) ucr1 = imx\_uart\_readl(sport, UCR1); imx\_uart\_writel(sport, ucr1 & ~UCR1\_TRDYEN, UCR1); + ucr4 = imx\_uart\_readl(sport, UCR4); usr2 = imx\_uart\_readl(sport, USR2);- if (!(usr2 & USR2\_TXDC)) {+ if ((!(usr2 & USR2\_TXDC)) && (ucr4 & UCR4\_TCEN)) { /\* The shifter is still busy, so retry once TC triggers \*/ return; } - ucr4 = imx\_uart\_readl(sport, UCR4); ucr4 &= ~UCR4\_TCEN; imx\_uart\_writel(sport, ucr4, UCR4); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:03:30 +0000



=== Content from lists.debian.org_8e2a4762_20250111_040456.html ===


---

[[Date Prev](msg00015.html)][[Date Next](msg00017.html)]
[[Thread Prev](msg00015.html)][[Thread Next](msg00017.html)]
[[Date Index](maillist.html#00016)]
[[Thread Index](threads.html#00016)]

# [SECURITY] [DLA 3841-1] linux-5.10 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3841-1] linux-5.10 security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Tue, 25 Jun 2024 21:41:14 +0200
* *Message-id*: <[[🔎]](/msgid-search/ZnsdWnKC38pb009r%40decadent.org.uk) [ZnsdWnKC38pb009r@decadent.org.uk](msg00016.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3841-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
June 25, 2024                                 <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux-5.10
Version        : 5.10.209-2~deb10u1
CVE ID         : CVE-2023-6040 CVE-2023-6356 CVE-2023-6535 CVE-2023-6536
                 CVE-2023-6606 CVE-2023-6915 CVE-2023-39198 CVE-2023-46838
                 CVE-2023-51779 CVE-2023-52340 CVE-2023-52436 CVE-2023-52438
                 CVE-2023-52439 CVE-2023-52443 CVE-2023-52444 CVE-2023-52445
                 CVE-2023-52448 CVE-2023-52449 CVE-2023-52451 CVE-2023-52454
                 CVE-2023-52456 CVE-2023-52457 CVE-2023-52462 CVE-2023-52463
                 CVE-2023-52464 CVE-2023-52467 CVE-2023-52469 CVE-2023-52470
                 CVE-2023-52609 CVE-2023-52612 CVE-2023-52675 CVE-2023-52679
                 CVE-2023-52683 CVE-2023-52686 CVE-2023-52690 CVE-2023-52691
                 CVE-2023-52693 CVE-2023-52694 CVE-2023-52696 CVE-2023-52698
                 CVE-2024-0646 CVE-2024-1086 CVE-2024-24860 CVE-2024-26586
                 CVE-2024-26597 CVE-2024-26598 CVE-2024-26633

Several vulnerabilities were discovered in the Linux kernel that may
lead to a privilege escalation, denial of service or information
leaks.

For Debian 10 buster, these problems were fixed earlier in version
5.10.209-2~deb10u1.  This update additionally included many more bug
fixes from stable updates 5.10.206-5.10.209 inclusive.

For the detailed security status of linux-5.10 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux-5.10>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpU6AD6rO3sK.pgp)**

*Description:* PGP signature

---



=== Content from git.kernel.org_c2729b59_20250111_040455.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ff168d4fdb0e1ba35fb413a749b3d6cce918ec19)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ff168d4fdb0e1ba35fb413a749b3d6cce918ec19)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff168d4fdb0e1ba35fb413a749b3d6cce918ec19)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff168d4fdb0e1ba35fb413a749b3d6cce918ec19)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paul Geurts <paul\_geurts@live.nl> | 2023-11-24 14:11:10 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 14:52:51 -0800 |
| commit | [ff168d4fdb0e1ba35fb413a749b3d6cce918ec19](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff168d4fdb0e1ba35fb413a749b3d6cce918ec19) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ff168d4fdb0e1ba35fb413a749b3d6cce918ec19)) | |
| tree | [4e9af769974124e6daf00a820d99aa4a93fef12f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ff168d4fdb0e1ba35fb413a749b3d6cce918ec19) | |
| parent | [714778c29947cc8bf45b66d821373008c8ea9e98](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=714778c29947cc8bf45b66d821373008c8ea9e98) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff168d4fdb0e1ba35fb413a749b3d6cce918ec19&id2=714778c29947cc8bf45b66d821373008c8ea9e98)) | |
| download | [linux-ff168d4fdb0e1ba35fb413a749b3d6cce918ec19.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ff168d4fdb0e1ba35fb413a749b3d6cce918ec19.tar.gz) | |

serial: imx: fix tx statemachine deadlock[ Upstream commit 78d60dae9a0c9f09aa3d6477c94047df2fe6f7b0 ]
When using the serial port as RS485 port, the tx statemachine is used to
control the RTS pin to drive the RS485 transceiver TX\_EN pin. When the
TTY port is closed in the middle of a transmission (for instance during
userland application crash), imx\_uart\_shutdown disables the interface
and disables the Transmission Complete interrupt. afer that,
imx\_uart\_stop\_tx bails on an incomplete transmission, to be retriggered
by the TC interrupt. This interrupt is disabled and therefore the tx
statemachine never transitions out of SEND. The statemachine is in
deadlock now, and the TX\_EN remains low, making the interface useless.
imx\_uart\_stop\_tx now checks for incomplete transmission AND whether TC
interrupts are enabled before bailing to be retriggered. This makes sure
the state machine handling is reached, and is properly set to
WAIT\_AFTER\_SEND.
Fixes: cb1a60923609 ("serial: imx: implement rts delaying for rs485")
Signed-off-by: Paul Geurts <paul\_geurts@live.nl>
Tested-by: Rasmus Villemoes <rasmus.villemoes@prevas.dk>
Tested-by: Eberhard Stoll <eberhard.stoll@gmx.de>
Link: [https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A@AM0PR09MB2675.eurprd09.prod.outlook.com](https://lore.kernel.org/r/AM0PR09MB26758F651BC1B742EB45775995B8A%40AM0PR09MB2675.eurprd09.prod.outlook.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff168d4fdb0e1ba35fb413a749b3d6cce918ec19)

| -rw-r--r-- | [drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/imx.c?id=ff168d4fdb0e1ba35fb413a749b3d6cce918ec19) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/tty/serial/imx.c b/drivers/tty/serial/imx.cindex 4b9e82737e0be3..52f183889c9549 100644--- a/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=714778c29947cc8bf45b66d821373008c8ea9e98)+++ b/[drivers/tty/serial/imx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/imx.c?id=ff168d4fdb0e1ba35fb413a749b3d6cce918ec19)@@ -450,13 +450,13 @@ static void imx\_uart\_stop\_tx(struct uart\_port \*port) ucr1 = imx\_uart\_readl(sport, UCR1); imx\_uart\_writel(sport, ucr1 & ~UCR1\_TRDYEN, UCR1); + ucr4 = imx\_uart\_readl(sport, UCR4); usr2 = imx\_uart\_readl(sport, USR2);- if (!(usr2 & USR2\_TXDC)) {+ if ((!(usr2 & USR2\_TXDC)) && (ucr4 & UCR4\_TCEN)) { /\* The shifter is still busy, so retry once TC triggers \*/ return; } - ucr4 = imx\_uart\_readl(sport, UCR4); ucr4 &= ~UCR4\_TCEN; imx\_uart\_writel(sport, ucr4, UCR4); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:03:33 +0000


