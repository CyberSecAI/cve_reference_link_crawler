

[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

**Commit
36a894ae**

authored
Aug 21, 2022
by
**[![Zheyu Ma's avatar](https://secure.gravatar.com/avatar/45ff759a53235e02c0b55e2173820dea9b34259d50e0df9cf047e03b367a5d21?s=96&d=identicon "Zheyu Ma")](/zheyuma97)
[Zheyu Ma](/zheyuma97)**
Committed by
[Jason Wang](/jasowang)
Sep 02, 2022

[Browse files](/qemu-project/qemu/-/tree/36a894aeb64a2e02871016da1c37d4a4ca109182)

### net: tulip: Restrict DMA engine to memories

```

The DMA engine is started by I/O access and then itself accesses the
I/O registers, triggering a reentrancy bug.

The following log can reveal it:
==5637==ERROR: AddressSanitizer: stack-overflow
    #0 0x5595435f6078 in tulip_xmit_list_update qemu/hw/net/tulip.c:673
    #1 0x5595435f204a in tulip_write qemu/hw/net/tulip.c:805:13
    #2 0x559544637f86 in memory_region_write_accessor qemu/softmmu/memory.c:492:5
    #3 0x5595446379fa in access_with_adjusted_size qemu/softmmu/memory.c:554:18
    #4 0x5595446372fa in memory_region_dispatch_write qemu/softmmu/memory.c
    #5 0x55954468b74c in flatview_write_continue qemu/softmmu/physmem.c:2825:23
    #6 0x559544683662 in flatview_write qemu/softmmu/physmem.c:2867:12
    #7 0x5595446833f3 in address_space_write qemu/softmmu/physmem.c:2963:18
    #8 0x5595435fb082 in dma_memory_rw_relaxed qemu/include/sysemu/dma.h:87:12
    #9 0x5595435fb082 in dma_memory_rw qemu/include/sysemu/dma.h:130:12
    #10 0x5595435fb082 in dma_memory_write qemu/include/sysemu/dma.h:171:12
    #11 0x5595435fb082 in stl_le_dma qemu/include/sysemu/dma.h:272:1
    #12 0x5595435fb082 in stl_le_pci_dma qemu/include/hw/pci/pci.h:910:1
    #13 0x5595435fb082 in tulip_desc_write qemu/hw/net/tulip.c:101:9
    #14 0x5595435f7e3d in tulip_xmit_list_update qemu/hw/net/tulip.c:706:9
    #15 0x5595435f204a in tulip_write qemu/hw/net/tulip.c:805:13

Fix this bug by restricting the DMA engine to memories regions.

Signed-off-by: ![default avatar](https://secure.gravatar.com/avatar/45ff759a53235e02c0b55e2173820dea9b34259d50e0df9cf047e03b367a5d21?s=32&d=identicon)Zheyu Ma <zheyuma97@gmail.com>
Signed-off-by: [![Jason Wang's avatar](https://secure.gravatar.com/avatar/84fc00b985b91bfa000fb92ba5dc5e688f6b687fd8c32e18629693e61015eb8d?s=64&d=identicon "Jason Wang")](https://gitlab.com/jasowang "jasowang@redhat.com")[Jason Wang](https://gitlab.com/jasowang "jasowang@redhat.com") <jasowang@redhat.com>
```

parent
[3772cf0d](/qemu-project/qemu/-/commit/3772cf0d1b37d32e61dc314e9cc18ff745327ddd)

Loading

Loading

Loading

* [Changes
  1](/qemu-project/qemu/-/commit/36a894aeb64a2e02871016da1c37d4a4ca109182)

[Hide whitespace changes](/qemu-project/qemu/-/commit/36a894aeb64a2e02871016da1c37d4a4ca109182?action=show&controller=projects%2Fcommit&id=36a894aeb64a2e02871016da1c37d4a4ca109182&namespace_id=qemu-project&project_id=qemu&w=1)
[Inline](/qemu-project/qemu/-/commit/36a894aeb64a2e02871016da1c37d4a4ca109182?view=inline)
[Side-by-side](/qemu-project/qemu/-/commit/36a894aeb64a2e02871016da1c37d4a4ca109182?view=parallel)

Loading

* [Thomas Huth](/thuth)
  @thuth

  mentioned in issue [#1171 (closed)](/qemu-project/qemu/-/issues/1171 "tulip: DMA reentrancy issue leads to stack overflow (CVE-2022-2962)")

  ·

  [Sep 14, 2022](#note_1101128807)

  mentioned in issue [#1171 (closed)](/qemu-project/qemu/-/issues/1171 "tulip: DMA reentrancy issue leads to stack overflow (CVE-2022-2962)")

  mentioned in issue #1171

  Toggle commit list
* [Ghassane Ben El Aattar](/GhassaneBen)
  @GhassaneBen

  mentioned in commit [noi-techpark-premium/solda/mirrors/oniro-goofy@98a3c92f](/noi-techpark-premium/solda/mirrors/oniro-goofy/-/commit/98a3c92f8f701d7943e9be01ef57f41ab5880cce "qemu: backport upstream fix for CVE-2022-2962.")

  ·

  [Oct 28, 2022](#note_1152219064)

  mentioned in commit [noi-techpark-premium/solda/mirrors/oniro-goofy@98a3c92f](/noi-techpark-premium/solda/mirrors/oniro-goofy/-/commit/98a3c92f8f701d7943e9be01ef57f41ab5880cce "qemu: backport upstream fix for CVE-2022-2962.")

  mentioned in commit noi-techpark-premium/solda/mirrors/oniro-goofy@98a3c92f8f701d7943e9be01ef57f41ab5880cce

  Toggle commit list

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment

