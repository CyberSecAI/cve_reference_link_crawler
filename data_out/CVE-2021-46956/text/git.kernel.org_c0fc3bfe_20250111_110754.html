

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=310efc95c72c13faf855c692d19cd4d054d827c8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=310efc95c72c13faf855c692d19cd4d054d827c8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=310efc95c72c13faf855c692d19cd4d054d827c8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=310efc95c72c13faf855c692d19cd4d054d827c8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Luis Henriques <lhenriques@suse.de> | 2021-03-17 08:44:43 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-05-11 14:04:14 +0200 |
| commit | [310efc95c72c13faf855c692d19cd4d054d827c8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=310efc95c72c13faf855c692d19cd4d054d827c8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=310efc95c72c13faf855c692d19cd4d054d827c8)) | |
| tree | [9984ee20e1c19935ac13656dea53b151e432b6a8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=310efc95c72c13faf855c692d19cd4d054d827c8) | |
| parent | [2b28e26bd7761fe01566c71a74794030fdde526c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2b28e26bd7761fe01566c71a74794030fdde526c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=310efc95c72c13faf855c692d19cd4d054d827c8&id2=2b28e26bd7761fe01566c71a74794030fdde526c)) | |
| download | [linux-310efc95c72c13faf855c692d19cd4d054d827c8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-310efc95c72c13faf855c692d19cd4d054d827c8.tar.gz) | |

virtiofs: fix memory leak in virtio\_fs\_probe()commit c79c5e0178922a9e092ec8fed026750f39dcaef4 upstream.
When accidentally passing twice the same tag to qemu, kmemleak ended up
reporting a memory leak in virtiofs. Also, looking at the log I saw the
following error (that's when I realised the duplicated tag):
virtiofs: probe of virtio5 failed with error -17
Here's the kmemleak log for reference:
unreferenced object 0xffff888103d47800 (size 1024):
comm "systemd-udevd", pid 118, jiffies 4294893780 (age 18.340s)
hex dump (first 32 bytes):
00 00 00 00 ad 4e ad de ff ff ff ff 00 00 00 00 .....N..........
ff ff ff ff ff ff ff ff 80 90 02 a0 ff ff ff ff ................
backtrace:
[<000000000ebb87c1>] virtio\_fs\_probe+0x171/0x7ae [virtiofs]
[<00000000f8aca419>] virtio\_dev\_probe+0x15f/0x210
[<000000004d6baf3c>] really\_probe+0xea/0x430
[<00000000a6ceeac8>] device\_driver\_attach+0xa8/0xb0
[<00000000196f47a7>] \_\_driver\_attach+0x98/0x140
[<000000000b20601d>] bus\_for\_each\_dev+0x7b/0xc0
[<00000000399c7b7f>] bus\_add\_driver+0x11b/0x1f0
[<0000000032b09ba7>] driver\_register+0x8f/0xe0
[<00000000cdd55998>] 0xffffffffa002c013
[<000000000ea196a2>] do\_one\_initcall+0x64/0x2e0
[<0000000008f727ce>] do\_init\_module+0x5c/0x260
[<000000003cdedab6>] \_\_do\_sys\_finit\_module+0xb5/0x120
[<00000000ad2f48c6>] do\_syscall\_64+0x33/0x40
[<00000000809526b5>] entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Cc: stable@vger.kernel.org
Signed-off-by: Luis Henriques <lhenriques@suse.de>
Fixes: a62a8ef9d97d ("virtio-fs: add virtiofs filesystem")
Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
Reviewed-by: Vivek Goyal <vgoyal@redhat.com>
Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=310efc95c72c13faf855c692d19cd4d054d827c8)

| -rw-r--r-- | [fs/fuse/virtio\_fs.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/fuse/virtio_fs.c?id=310efc95c72c13faf855c692d19cd4d054d827c8) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/fs/fuse/virtio\_fs.c b/fs/fuse/virtio\_fs.cindex 7505f810276232..fadf6fb90fe22b 100644--- a/[fs/fuse/virtio\_fs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/fuse/virtio_fs.c?id=2b28e26bd7761fe01566c71a74794030fdde526c)+++ b/[fs/fuse/virtio\_fs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/fuse/virtio_fs.c?id=310efc95c72c13faf855c692d19cd4d054d827c8)@@ -667,6 +667,7 @@ static int virtio\_fs\_probe(struct virtio\_device \*vdev) out\_vqs: vdev->config->reset(vdev); virtio\_fs\_cleanup\_vqs(vdev, fs);+ kfree(fs->vqs);  out: vdev->priv = NULL; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 11:06:32 +0000

