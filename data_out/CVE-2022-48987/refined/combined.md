=== Content from git.kernel.org_e4829aac_20250111_032520.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2022-11-16 15:07:22 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-12-14 11:40:52 +0100 |
| commit | [d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3)) | |
| tree | [594a57eb2e34e14bf5848d917d3f74d0517f2031](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3) | |
| parent | [4ecccec6a0f55c3054e1f4820eb16c88dec2a5e0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4ecccec6a0f55c3054e1f4820eb16c88dec2a5e0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3&id2=4ecccec6a0f55c3054e1f4820eb16c88dec2a5e0)) | |
| download | [linux-d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3.tar.gz) | |

media: v4l2-dv-timings.c: fix too strict blanking sanity checkscommit 5eef2141776da02772c44ec406d6871a790761ee upstream.
Sanity checks were added to verify the v4l2\_bt\_timings blanking fields
in order to avoid integer overflows when userspace passes weird values.
But that assumed that userspace would correctly fill in the front porch,
backporch and sync values, but sometimes all you know is the total
blanking, which is then assigned to just one of these fields.
And that can fail with these checks.
So instead set a maximum for the total horizontal and vertical
blanking and check that each field remains below that.
That is still sufficient to avoid integer overflows, but it also
allows for more flexibility in how userspace fills in these fields.
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Fixes: 4b6d66a45ed3 ("media: v4l2-dv-timings: add sanity checks for blanking values")
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3)

| -rw-r--r-- | [drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/v4l2-core/v4l2-dv-timings.c?id=d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 6 deletions

| diff --git a/drivers/media/v4l2-core/v4l2-dv-timings.c b/drivers/media/v4l2-core/v4l2-dv-timings.cindex 003c32fed3f754..942d0005c55e82 100644--- a/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=4ecccec6a0f55c3054e1f4820eb16c88dec2a5e0)+++ b/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=d3d14cdf1c7ae2caa3e999bae95ba99e955fb7c3)@@ -145,6 +145,8 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, const struct v4l2\_bt\_timings \*bt = &t->bt; const struct v4l2\_bt\_timings\_cap \*cap = &dvcap->bt; u32 caps = cap->capabilities;+ const u32 max\_vert = 10240;+ u32 max\_hor = 3 \* bt->width;  if (t->type != V4L2\_DV\_BT\_656\_1120) return false;@@ -166,14 +168,20 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, if (!bt->interlaced && (bt->il\_vbackporch || bt->il\_vsync || bt->il\_vfrontporch)) return false;- if (bt->hfrontporch > 2 \* bt->width ||- bt->hsync > 1024 || bt->hbackporch > 1024)+ /\*+ \* Some video receivers cannot properly separate the frontporch,+ \* backporch and sync values, and instead they only have the total+ \* blanking. That can be assigned to any of these three fields.+ \* So just check that none of these are way out of range.+ \*/+ if (bt->hfrontporch > max\_hor ||+ bt->hsync > max\_hor || bt->hbackporch > max\_hor) return false;- if (bt->vfrontporch > 4096 ||- bt->vsync > 128 || bt->vbackporch > 4096)+ if (bt->vfrontporch > max\_vert ||+ bt->vsync > max\_vert || bt->vbackporch > max\_vert) return false;- if (bt->interlaced && (bt->il\_vfrontporch > 4096 ||- bt->il\_vsync > 128 || bt->il\_vbackporch > 4096))+ if (bt->interlaced && (bt->il\_vfrontporch > max\_vert ||+ bt->il\_vsync > max\_vert || bt->il\_vbackporch > max\_vert)) return false; return fnc == NULL || fnc(t, fnc\_handle); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 03:23:57 +0000



=== Content from git.kernel.org_d7d07280_20250111_032516.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4afc77068e36cee45b39d4fdc7513de26980f72c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4afc77068e36cee45b39d4fdc7513de26980f72c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4afc77068e36cee45b39d4fdc7513de26980f72c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4afc77068e36cee45b39d4fdc7513de26980f72c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2022-11-16 15:07:22 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-12-14 11:30:43 +0100 |
| commit | [4afc77068e36cee45b39d4fdc7513de26980f72c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4afc77068e36cee45b39d4fdc7513de26980f72c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4afc77068e36cee45b39d4fdc7513de26980f72c)) | |
| tree | [9f151b1f0c18c94c817b1f406bc7270d1ab389b2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4afc77068e36cee45b39d4fdc7513de26980f72c) | |
| parent | [91516ba54a023727c05a66c3efdaef6fccbae1b3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=91516ba54a023727c05a66c3efdaef6fccbae1b3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4afc77068e36cee45b39d4fdc7513de26980f72c&id2=91516ba54a023727c05a66c3efdaef6fccbae1b3)) | |
| download | [linux-4afc77068e36cee45b39d4fdc7513de26980f72c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4afc77068e36cee45b39d4fdc7513de26980f72c.tar.gz) | |

media: v4l2-dv-timings.c: fix too strict blanking sanity checkscommit 5eef2141776da02772c44ec406d6871a790761ee upstream.
Sanity checks were added to verify the v4l2\_bt\_timings blanking fields
in order to avoid integer overflows when userspace passes weird values.
But that assumed that userspace would correctly fill in the front porch,
backporch and sync values, but sometimes all you know is the total
blanking, which is then assigned to just one of these fields.
And that can fail with these checks.
So instead set a maximum for the total horizontal and vertical
blanking and check that each field remains below that.
That is still sufficient to avoid integer overflows, but it also
allows for more flexibility in how userspace fills in these fields.
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Fixes: 4b6d66a45ed3 ("media: v4l2-dv-timings: add sanity checks for blanking values")
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4afc77068e36cee45b39d4fdc7513de26980f72c)

| -rw-r--r-- | [drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/v4l2-core/v4l2-dv-timings.c?id=4afc77068e36cee45b39d4fdc7513de26980f72c) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 6 deletions

| diff --git a/drivers/media/v4l2-core/v4l2-dv-timings.c b/drivers/media/v4l2-core/v4l2-dv-timings.cindex 6d0775678f43a2..845ef4b2a4bff1 100644--- a/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=91516ba54a023727c05a66c3efdaef6fccbae1b3)+++ b/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=4afc77068e36cee45b39d4fdc7513de26980f72c)@@ -145,6 +145,8 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, const struct v4l2\_bt\_timings \*bt = &t->bt; const struct v4l2\_bt\_timings\_cap \*cap = &dvcap->bt; u32 caps = cap->capabilities;+ const u32 max\_vert = 10240;+ u32 max\_hor = 3 \* bt->width;  if (t->type != V4L2\_DV\_BT\_656\_1120) return false;@@ -166,14 +168,20 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, if (!bt->interlaced && (bt->il\_vbackporch || bt->il\_vsync || bt->il\_vfrontporch)) return false;- if (bt->hfrontporch > 2 \* bt->width ||- bt->hsync > 1024 || bt->hbackporch > 1024)+ /\*+ \* Some video receivers cannot properly separate the frontporch,+ \* backporch and sync values, and instead they only have the total+ \* blanking. That can be assigned to any of these three fields.+ \* So just check that none of these are way out of range.+ \*/+ if (bt->hfrontporch > max\_hor ||+ bt->hsync > max\_hor || bt->hbackporch > max\_hor) return false;- if (bt->vfrontporch > 4096 ||- bt->vsync > 128 || bt->vbackporch > 4096)+ if (bt->vfrontporch > max\_vert ||+ bt->vsync > max\_vert || bt->vbackporch > max\_vert) return false;- if (bt->interlaced && (bt->il\_vfrontporch > 4096 ||- bt->il\_vsync > 128 || bt->il\_vbackporch > 4096))+ if (bt->interlaced && (bt->il\_vfrontporch > max\_vert ||+ bt->il\_vsync > max\_vert || bt->il\_vbackporch > max\_vert)) return false; return fnc == NULL || fnc(t, fnc\_handle); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 03:23:54 +0000



=== Content from git.kernel.org_999ed1ff_20250111_032513.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0d73b49c4037199472b29574ae21c21aef493971)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0d73b49c4037199472b29574ae21c21aef493971)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0d73b49c4037199472b29574ae21c21aef493971)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0d73b49c4037199472b29574ae21c21aef493971)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2022-11-16 15:07:22 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-12-14 11:24:33 +0100 |
| commit | [0d73b49c4037199472b29574ae21c21aef493971](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0d73b49c4037199472b29574ae21c21aef493971) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0d73b49c4037199472b29574ae21c21aef493971)) | |
| tree | [7b8a74bbd94cdaaa23c8f4c796c1aa93b0150f49](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0d73b49c4037199472b29574ae21c21aef493971) | |
| parent | [a0e661a7df02de0c19109af6a0afbc62e4e2dc17](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a0e661a7df02de0c19109af6a0afbc62e4e2dc17) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0d73b49c4037199472b29574ae21c21aef493971&id2=a0e661a7df02de0c19109af6a0afbc62e4e2dc17)) | |
| download | [linux-0d73b49c4037199472b29574ae21c21aef493971.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0d73b49c4037199472b29574ae21c21aef493971.tar.gz) | |

media: v4l2-dv-timings.c: fix too strict blanking sanity checkscommit 5eef2141776da02772c44ec406d6871a790761ee upstream.
Sanity checks were added to verify the v4l2\_bt\_timings blanking fields
in order to avoid integer overflows when userspace passes weird values.
But that assumed that userspace would correctly fill in the front porch,
backporch and sync values, but sometimes all you know is the total
blanking, which is then assigned to just one of these fields.
And that can fail with these checks.
So instead set a maximum for the total horizontal and vertical
blanking and check that each field remains below that.
That is still sufficient to avoid integer overflows, but it also
allows for more flexibility in how userspace fills in these fields.
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Fixes: 4b6d66a45ed3 ("media: v4l2-dv-timings: add sanity checks for blanking values")
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0d73b49c4037199472b29574ae21c21aef493971)

| -rw-r--r-- | [drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/v4l2-core/v4l2-dv-timings.c?id=0d73b49c4037199472b29574ae21c21aef493971) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 6 deletions

| diff --git a/drivers/media/v4l2-core/v4l2-dv-timings.c b/drivers/media/v4l2-core/v4l2-dv-timings.cindex 12e04ac6a9ee14..32931421e2e5a9 100644--- a/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=a0e661a7df02de0c19109af6a0afbc62e4e2dc17)+++ b/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=0d73b49c4037199472b29574ae21c21aef493971)@@ -155,6 +155,8 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, const struct v4l2\_bt\_timings \*bt = &t->bt; const struct v4l2\_bt\_timings\_cap \*cap = &dvcap->bt; u32 caps = cap->capabilities;+ const u32 max\_vert = 10240;+ u32 max\_hor = 3 \* bt->width;  if (t->type != V4L2\_DV\_BT\_656\_1120) return false;@@ -176,14 +178,20 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, if (!bt->interlaced && (bt->il\_vbackporch || bt->il\_vsync || bt->il\_vfrontporch)) return false;- if (bt->hfrontporch > 2 \* bt->width ||- bt->hsync > 1024 || bt->hbackporch > 1024)+ /\*+ \* Some video receivers cannot properly separate the frontporch,+ \* backporch and sync values, and instead they only have the total+ \* blanking. That can be assigned to any of these three fields.+ \* So just check that none of these are way out of range.+ \*/+ if (bt->hfrontporch > max\_hor ||+ bt->hsync > max\_hor || bt->hbackporch > max\_hor) return false;- if (bt->vfrontporch > 4096 ||- bt->vsync > 128 || bt->vbackporch > 4096)+ if (bt->vfrontporch > max\_vert ||+ bt->vsync > max\_vert || bt->vbackporch > max\_vert) return false;- if (bt->interlaced && (bt->il\_vfrontporch > 4096 ||- bt->il\_vsync > 128 || bt->il\_vbackporch > 4096))+ if (bt->interlaced && (bt->il\_vfrontporch > max\_vert ||+ bt->il\_vsync > max\_vert || bt->il\_vbackporch > max\_vert)) return false; return fnc == NULL || fnc(t, fnc\_handle); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 03:23:51 +0000



=== Content from git.kernel.org_864e0391_20250111_032517.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5eef2141776da02772c44ec406d6871a790761ee)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5eef2141776da02772c44ec406d6871a790761ee)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5eef2141776da02772c44ec406d6871a790761ee)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5eef2141776da02772c44ec406d6871a790761ee)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2022-11-16 15:07:22 +0000 |
| --- | --- | --- |
| committer | Mauro Carvalho Chehab <mchehab@kernel.org> | 2022-11-23 12:02:30 +0000 |
| commit | [5eef2141776da02772c44ec406d6871a790761ee](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5eef2141776da02772c44ec406d6871a790761ee) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5eef2141776da02772c44ec406d6871a790761ee)) | |
| tree | [9a8b22baad430ba0672e6e4b89426725b9100957](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5eef2141776da02772c44ec406d6871a790761ee) | |
| parent | [de547896aac606a00435a219757a940ece142bf0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=de547896aac606a00435a219757a940ece142bf0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5eef2141776da02772c44ec406d6871a790761ee&id2=de547896aac606a00435a219757a940ece142bf0)) | |
| download | [linux-5eef2141776da02772c44ec406d6871a790761ee.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5eef2141776da02772c44ec406d6871a790761ee.tar.gz) | |

media: v4l2-dv-timings.c: fix too strict blanking sanity checksSanity checks were added to verify the v4l2\_bt\_timings blanking fields
in order to avoid integer overflows when userspace passes weird values.
But that assumed that userspace would correctly fill in the front porch,
backporch and sync values, but sometimes all you know is the total
blanking, which is then assigned to just one of these fields.
And that can fail with these checks.
So instead set a maximum for the total horizontal and vertical
blanking and check that each field remains below that.
That is still sufficient to avoid integer overflows, but it also
allows for more flexibility in how userspace fills in these fields.
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Fixes: 4b6d66a45ed3 ("media: v4l2-dv-timings: add sanity checks for blanking values")
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5eef2141776da02772c44ec406d6871a790761ee)

| -rw-r--r-- | [drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/v4l2-core/v4l2-dv-timings.c?id=5eef2141776da02772c44ec406d6871a790761ee) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 6 deletions

| diff --git a/drivers/media/v4l2-core/v4l2-dv-timings.c b/drivers/media/v4l2-core/v4l2-dv-timings.cindex 003c32fed3f754..942d0005c55e82 100644--- a/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=de547896aac606a00435a219757a940ece142bf0)+++ b/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=5eef2141776da02772c44ec406d6871a790761ee)@@ -145,6 +145,8 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, const struct v4l2\_bt\_timings \*bt = &t->bt; const struct v4l2\_bt\_timings\_cap \*cap = &dvcap->bt; u32 caps = cap->capabilities;+ const u32 max\_vert = 10240;+ u32 max\_hor = 3 \* bt->width;  if (t->type != V4L2\_DV\_BT\_656\_1120) return false;@@ -166,14 +168,20 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, if (!bt->interlaced && (bt->il\_vbackporch || bt->il\_vsync || bt->il\_vfrontporch)) return false;- if (bt->hfrontporch > 2 \* bt->width ||- bt->hsync > 1024 || bt->hbackporch > 1024)+ /\*+ \* Some video receivers cannot properly separate the frontporch,+ \* backporch and sync values, and instead they only have the total+ \* blanking. That can be assigned to any of these three fields.+ \* So just check that none of these are way out of range.+ \*/+ if (bt->hfrontporch > max\_hor ||+ bt->hsync > max\_hor || bt->hbackporch > max\_hor) return false;- if (bt->vfrontporch > 4096 ||- bt->vsync > 128 || bt->vbackporch > 4096)+ if (bt->vfrontporch > max\_vert ||+ bt->vsync > max\_vert || bt->vbackporch > max\_vert) return false;- if (bt->interlaced && (bt->il\_vfrontporch > 4096 ||- bt->il\_vsync > 128 || bt->il\_vbackporch > 4096))+ if (bt->interlaced && (bt->il\_vfrontporch > max\_vert ||+ bt->il\_vsync > max\_vert || bt->il\_vbackporch > max\_vert)) return false; return fnc == NULL || fnc(t, fnc\_handle); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 03:23:54 +0000



=== Content from git.kernel.org_d58709a2_20250111_032515.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=32f01f0306a98629508f84d7ef0d1d037bc274a2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=32f01f0306a98629508f84d7ef0d1d037bc274a2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=32f01f0306a98629508f84d7ef0d1d037bc274a2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=32f01f0306a98629508f84d7ef0d1d037bc274a2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2022-11-16 15:07:22 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-12-14 11:31:57 +0100 |
| commit | [32f01f0306a98629508f84d7ef0d1d037bc274a2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=32f01f0306a98629508f84d7ef0d1d037bc274a2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=32f01f0306a98629508f84d7ef0d1d037bc274a2)) | |
| tree | [d3eefb37343344a21bfb4f88f4115225dba0d501](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=32f01f0306a98629508f84d7ef0d1d037bc274a2) | |
| parent | [043b2bc96ca2a63d65c0683650ba4d491e8f0f24](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=043b2bc96ca2a63d65c0683650ba4d491e8f0f24) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=32f01f0306a98629508f84d7ef0d1d037bc274a2&id2=043b2bc96ca2a63d65c0683650ba4d491e8f0f24)) | |
| download | [linux-32f01f0306a98629508f84d7ef0d1d037bc274a2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-32f01f0306a98629508f84d7ef0d1d037bc274a2.tar.gz) | |

media: v4l2-dv-timings.c: fix too strict blanking sanity checkscommit 5eef2141776da02772c44ec406d6871a790761ee upstream.
Sanity checks were added to verify the v4l2\_bt\_timings blanking fields
in order to avoid integer overflows when userspace passes weird values.
But that assumed that userspace would correctly fill in the front porch,
backporch and sync values, but sometimes all you know is the total
blanking, which is then assigned to just one of these fields.
And that can fail with these checks.
So instead set a maximum for the total horizontal and vertical
blanking and check that each field remains below that.
That is still sufficient to avoid integer overflows, but it also
allows for more flexibility in how userspace fills in these fields.
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Fixes: 4b6d66a45ed3 ("media: v4l2-dv-timings: add sanity checks for blanking values")
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=32f01f0306a98629508f84d7ef0d1d037bc274a2)

| -rw-r--r-- | [drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/v4l2-core/v4l2-dv-timings.c?id=32f01f0306a98629508f84d7ef0d1d037bc274a2) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 6 deletions

| diff --git a/drivers/media/v4l2-core/v4l2-dv-timings.c b/drivers/media/v4l2-core/v4l2-dv-timings.cindex 003c32fed3f754..942d0005c55e82 100644--- a/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=043b2bc96ca2a63d65c0683650ba4d491e8f0f24)+++ b/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=32f01f0306a98629508f84d7ef0d1d037bc274a2)@@ -145,6 +145,8 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, const struct v4l2\_bt\_timings \*bt = &t->bt; const struct v4l2\_bt\_timings\_cap \*cap = &dvcap->bt; u32 caps = cap->capabilities;+ const u32 max\_vert = 10240;+ u32 max\_hor = 3 \* bt->width;  if (t->type != V4L2\_DV\_BT\_656\_1120) return false;@@ -166,14 +168,20 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, if (!bt->interlaced && (bt->il\_vbackporch || bt->il\_vsync || bt->il\_vfrontporch)) return false;- if (bt->hfrontporch > 2 \* bt->width ||- bt->hsync > 1024 || bt->hbackporch > 1024)+ /\*+ \* Some video receivers cannot properly separate the frontporch,+ \* backporch and sync values, and instead they only have the total+ \* blanking. That can be assigned to any of these three fields.+ \* So just check that none of these are way out of range.+ \*/+ if (bt->hfrontporch > max\_hor ||+ bt->hsync > max\_hor || bt->hbackporch > max\_hor) return false;- if (bt->vfrontporch > 4096 ||- bt->vsync > 128 || bt->vbackporch > 4096)+ if (bt->vfrontporch > max\_vert ||+ bt->vsync > max\_vert || bt->vbackporch > max\_vert) return false;- if (bt->interlaced && (bt->il\_vfrontporch > 4096 ||- bt->il\_vsync > 128 || bt->il\_vbackporch > 4096))+ if (bt->interlaced && (bt->il\_vfrontporch > max\_vert ||+ bt->il\_vsync > max\_vert || bt->il\_vbackporch > max\_vert)) return false; return fnc == NULL || fnc(t, fnc\_handle); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 03:23:53 +0000



=== Content from git.kernel.org_bcb98339_20250111_032514.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2572ab14b73aa45b6ae7e4c089ccf119fed5cf89)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2572ab14b73aa45b6ae7e4c089ccf119fed5cf89)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2572ab14b73aa45b6ae7e4c089ccf119fed5cf89)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2572ab14b73aa45b6ae7e4c089ccf119fed5cf89)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2022-11-16 15:07:22 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-12-14 11:28:27 +0100 |
| commit | [2572ab14b73aa45b6ae7e4c089ccf119fed5cf89](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2572ab14b73aa45b6ae7e4c089ccf119fed5cf89) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2572ab14b73aa45b6ae7e4c089ccf119fed5cf89)) | |
| tree | [3fd904349e5251b56aed7b639a6c6df305f56555](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2572ab14b73aa45b6ae7e4c089ccf119fed5cf89) | |
| parent | [47bd0eecc695e3f418a2743d5f7fc96829e68aa3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47bd0eecc695e3f418a2743d5f7fc96829e68aa3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2572ab14b73aa45b6ae7e4c089ccf119fed5cf89&id2=47bd0eecc695e3f418a2743d5f7fc96829e68aa3)) | |
| download | [linux-2572ab14b73aa45b6ae7e4c089ccf119fed5cf89.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2572ab14b73aa45b6ae7e4c089ccf119fed5cf89.tar.gz) | |

media: v4l2-dv-timings.c: fix too strict blanking sanity checkscommit 5eef2141776da02772c44ec406d6871a790761ee upstream.
Sanity checks were added to verify the v4l2\_bt\_timings blanking fields
in order to avoid integer overflows when userspace passes weird values.
But that assumed that userspace would correctly fill in the front porch,
backporch and sync values, but sometimes all you know is the total
blanking, which is then assigned to just one of these fields.
And that can fail with these checks.
So instead set a maximum for the total horizontal and vertical
blanking and check that each field remains below that.
That is still sufficient to avoid integer overflows, but it also
allows for more flexibility in how userspace fills in these fields.
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Fixes: 4b6d66a45ed3 ("media: v4l2-dv-timings: add sanity checks for blanking values")
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2572ab14b73aa45b6ae7e4c089ccf119fed5cf89)

| -rw-r--r-- | [drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/v4l2-core/v4l2-dv-timings.c?id=2572ab14b73aa45b6ae7e4c089ccf119fed5cf89) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 6 deletions

| diff --git a/drivers/media/v4l2-core/v4l2-dv-timings.c b/drivers/media/v4l2-core/v4l2-dv-timings.cindex 2c32124c182321..ec7d7f643ea7ed 100644--- a/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=47bd0eecc695e3f418a2743d5f7fc96829e68aa3)+++ b/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=2572ab14b73aa45b6ae7e4c089ccf119fed5cf89)@@ -145,6 +145,8 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, const struct v4l2\_bt\_timings \*bt = &t->bt; const struct v4l2\_bt\_timings\_cap \*cap = &dvcap->bt; u32 caps = cap->capabilities;+ const u32 max\_vert = 10240;+ u32 max\_hor = 3 \* bt->width;  if (t->type != V4L2\_DV\_BT\_656\_1120) return false;@@ -166,14 +168,20 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, if (!bt->interlaced && (bt->il\_vbackporch || bt->il\_vsync || bt->il\_vfrontporch)) return false;- if (bt->hfrontporch > 2 \* bt->width ||- bt->hsync > 1024 || bt->hbackporch > 1024)+ /\*+ \* Some video receivers cannot properly separate the frontporch,+ \* backporch and sync values, and instead they only have the total+ \* blanking. That can be assigned to any of these three fields.+ \* So just check that none of these are way out of range.+ \*/+ if (bt->hfrontporch > max\_hor ||+ bt->hsync > max\_hor || bt->hbackporch > max\_hor) return false;- if (bt->vfrontporch > 4096 ||- bt->vsync > 128 || bt->vbackporch > 4096)+ if (bt->vfrontporch > max\_vert ||+ bt->vsync > max\_vert || bt->vbackporch > max\_vert) return false;- if (bt->interlaced && (bt->il\_vfrontporch > 4096 ||- bt->il\_vsync > 128 || bt->il\_vbackporch > 4096))+ if (bt->interlaced && (bt->il\_vfrontporch > max\_vert ||+ bt->il\_vsync > max\_vert || bt->il\_vbackporch > max\_vert)) return false; return fnc == NULL || fnc(t, fnc\_handle); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 03:23:52 +0000



=== Content from git.kernel.org_6f2e5684_20250111_032519.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a2b56627c0d13009e02f6f2c0206c0451ed19a0e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a2b56627c0d13009e02f6f2c0206c0451ed19a0e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a2b56627c0d13009e02f6f2c0206c0451ed19a0e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a2b56627c0d13009e02f6f2c0206c0451ed19a0e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2022-11-16 15:07:22 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-12-14 11:26:13 +0100 |
| commit | [a2b56627c0d13009e02f6f2c0206c0451ed19a0e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a2b56627c0d13009e02f6f2c0206c0451ed19a0e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a2b56627c0d13009e02f6f2c0206c0451ed19a0e)) | |
| tree | [a67176330509dc5f5f869a0b491ea63835179f00](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a2b56627c0d13009e02f6f2c0206c0451ed19a0e) | |
| parent | [d9c76749c79a52692e71dc7a7f373d372573f213](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d9c76749c79a52692e71dc7a7f373d372573f213) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a2b56627c0d13009e02f6f2c0206c0451ed19a0e&id2=d9c76749c79a52692e71dc7a7f373d372573f213)) | |
| download | [linux-a2b56627c0d13009e02f6f2c0206c0451ed19a0e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a2b56627c0d13009e02f6f2c0206c0451ed19a0e.tar.gz) | |

media: v4l2-dv-timings.c: fix too strict blanking sanity checkscommit 5eef2141776da02772c44ec406d6871a790761ee upstream.
Sanity checks were added to verify the v4l2\_bt\_timings blanking fields
in order to avoid integer overflows when userspace passes weird values.
But that assumed that userspace would correctly fill in the front porch,
backporch and sync values, but sometimes all you know is the total
blanking, which is then assigned to just one of these fields.
And that can fail with these checks.
So instead set a maximum for the total horizontal and vertical
blanking and check that each field remains below that.
That is still sufficient to avoid integer overflows, but it also
allows for more flexibility in how userspace fills in these fields.
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Fixes: 4b6d66a45ed3 ("media: v4l2-dv-timings: add sanity checks for blanking values")
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a2b56627c0d13009e02f6f2c0206c0451ed19a0e)

| -rw-r--r-- | [drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/v4l2-core/v4l2-dv-timings.c?id=a2b56627c0d13009e02f6f2c0206c0451ed19a0e) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 6 deletions

| diff --git a/drivers/media/v4l2-core/v4l2-dv-timings.c b/drivers/media/v4l2-core/v4l2-dv-timings.cindex 4353e624a5853e..7e58c6a049bff9 100644--- a/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=d9c76749c79a52692e71dc7a7f373d372573f213)+++ b/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=a2b56627c0d13009e02f6f2c0206c0451ed19a0e)@@ -156,6 +156,8 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, const struct v4l2\_bt\_timings \*bt = &t->bt; const struct v4l2\_bt\_timings\_cap \*cap = &dvcap->bt; u32 caps = cap->capabilities;+ const u32 max\_vert = 10240;+ u32 max\_hor = 3 \* bt->width;  if (t->type != V4L2\_DV\_BT\_656\_1120) return false;@@ -177,14 +179,20 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, if (!bt->interlaced && (bt->il\_vbackporch || bt->il\_vsync || bt->il\_vfrontporch)) return false;- if (bt->hfrontporch > 2 \* bt->width ||- bt->hsync > 1024 || bt->hbackporch > 1024)+ /\*+ \* Some video receivers cannot properly separate the frontporch,+ \* backporch and sync values, and instead they only have the total+ \* blanking. That can be assigned to any of these three fields.+ \* So just check that none of these are way out of range.+ \*/+ if (bt->hfrontporch > max\_hor ||+ bt->hsync > max\_hor || bt->hbackporch > max\_hor) return false;- if (bt->vfrontporch > 4096 ||- bt->vsync > 128 || bt->vbackporch > 4096)+ if (bt->vfrontporch > max\_vert ||+ bt->vsync > max\_vert || bt->vbackporch > max\_vert) return false;- if (bt->interlaced && (bt->il\_vfrontporch > 4096 ||- bt->il\_vsync > 128 || bt->il\_vbackporch > 4096))+ if (bt->interlaced && (bt->il\_vfrontporch > max\_vert ||+ bt->il\_vsync > max\_vert || bt->il\_vbackporch > max\_vert)) return false; return fnc == NULL || fnc(t, fnc\_handle); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 03:23:56 +0000



=== Content from git.kernel.org_9ed46fdd_20250111_032518.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6fb8bc29bfa80707994a63cc97e2f9920e0b0608)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6fb8bc29bfa80707994a63cc97e2f9920e0b0608)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6fb8bc29bfa80707994a63cc97e2f9920e0b0608)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6fb8bc29bfa80707994a63cc97e2f9920e0b0608)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2022-11-16 15:07:22 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-12-14 11:37:19 +0100 |
| commit | [6fb8bc29bfa80707994a63cc97e2f9920e0b0608](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6fb8bc29bfa80707994a63cc97e2f9920e0b0608) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6fb8bc29bfa80707994a63cc97e2f9920e0b0608)) | |
| tree | [21bb7ff0a1ce46a2f2a24aeef12dfafc4a65c93a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6fb8bc29bfa80707994a63cc97e2f9920e0b0608) | |
| parent | [a4c575541eeb0836e7218755476f1ce3d45da1d6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a4c575541eeb0836e7218755476f1ce3d45da1d6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6fb8bc29bfa80707994a63cc97e2f9920e0b0608&id2=a4c575541eeb0836e7218755476f1ce3d45da1d6)) | |
| download | [linux-6fb8bc29bfa80707994a63cc97e2f9920e0b0608.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6fb8bc29bfa80707994a63cc97e2f9920e0b0608.tar.gz) | |

media: v4l2-dv-timings.c: fix too strict blanking sanity checkscommit 5eef2141776da02772c44ec406d6871a790761ee upstream.
Sanity checks were added to verify the v4l2\_bt\_timings blanking fields
in order to avoid integer overflows when userspace passes weird values.
But that assumed that userspace would correctly fill in the front porch,
backporch and sync values, but sometimes all you know is the total
blanking, which is then assigned to just one of these fields.
And that can fail with these checks.
So instead set a maximum for the total horizontal and vertical
blanking and check that each field remains below that.
That is still sufficient to avoid integer overflows, but it also
allows for more flexibility in how userspace fills in these fields.
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Fixes: 4b6d66a45ed3 ("media: v4l2-dv-timings: add sanity checks for blanking values")
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6fb8bc29bfa80707994a63cc97e2f9920e0b0608)

| -rw-r--r-- | [drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/v4l2-core/v4l2-dv-timings.c?id=6fb8bc29bfa80707994a63cc97e2f9920e0b0608) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 6 deletions

| diff --git a/drivers/media/v4l2-core/v4l2-dv-timings.c b/drivers/media/v4l2-core/v4l2-dv-timings.cindex 003c32fed3f754..942d0005c55e82 100644--- a/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=a4c575541eeb0836e7218755476f1ce3d45da1d6)+++ b/[drivers/media/v4l2-core/v4l2-dv-timings.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/v4l2-core/v4l2-dv-timings.c?id=6fb8bc29bfa80707994a63cc97e2f9920e0b0608)@@ -145,6 +145,8 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, const struct v4l2\_bt\_timings \*bt = &t->bt; const struct v4l2\_bt\_timings\_cap \*cap = &dvcap->bt; u32 caps = cap->capabilities;+ const u32 max\_vert = 10240;+ u32 max\_hor = 3 \* bt->width;  if (t->type != V4L2\_DV\_BT\_656\_1120) return false;@@ -166,14 +168,20 @@ bool v4l2\_valid\_dv\_timings(const struct v4l2\_dv\_timings \*t, if (!bt->interlaced && (bt->il\_vbackporch || bt->il\_vsync || bt->il\_vfrontporch)) return false;- if (bt->hfrontporch > 2 \* bt->width ||- bt->hsync > 1024 || bt->hbackporch > 1024)+ /\*+ \* Some video receivers cannot properly separate the frontporch,+ \* backporch and sync values, and instead they only have the total+ \* blanking. That can be assigned to any of these three fields.+ \* So just check that none of these are way out of range.+ \*/+ if (bt->hfrontporch > max\_hor ||+ bt->hsync > max\_hor || bt->hbackporch > max\_hor) return false;- if (bt->vfrontporch > 4096 ||- bt->vsync > 128 || bt->vbackporch > 4096)+ if (bt->vfrontporch > max\_vert ||+ bt->vsync > max\_vert || bt->vbackporch > max\_vert) return false;- if (bt->interlaced && (bt->il\_vfrontporch > 4096 ||- bt->il\_vsync > 128 || bt->il\_vbackporch > 4096))+ if (bt->interlaced && (bt->il\_vfrontporch > max\_vert ||+ bt->il\_vsync > max\_vert || bt->il\_vbackporch > max\_vert)) return false; return fnc == NULL || fnc(t, fnc\_handle); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 03:23:55 +0000


