=== Content from git.kernel.org_4e1c5b33_20250110_173841.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f347c26836c270199de1599c3cd466bb7747caa9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f347c26836c270199de1599c3cd466bb7747caa9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f347c26836c270199de1599c3cd466bb7747caa9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f347c26836c270199de1599c3cd466bb7747caa9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ye Bin <yebin10@huawei.com> | 2021-10-13 11:39:13 +0800 |
| --- | --- | --- |
| committer | Martin K. Petersen <martin.petersen@oracle.com> | 2021-10-18 22:38:35 -0400 |
| commit | [f347c26836c270199de1599c3cd466bb7747caa9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f347c26836c270199de1599c3cd466bb7747caa9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f347c26836c270199de1599c3cd466bb7747caa9)) | |
| tree | [14febf0a87b0e9124010873fc4d8d871a0ba625d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f347c26836c270199de1599c3cd466bb7747caa9) | |
| parent | [4e3ace0051e7e504b55d239daab8789dd89b863c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4e3ace0051e7e504b55d239daab8789dd89b863c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f347c26836c270199de1599c3cd466bb7747caa9&id2=4e3ace0051e7e504b55d239daab8789dd89b863c)) | |
| download | [linux-f347c26836c270199de1599c3cd466bb7747caa9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f347c26836c270199de1599c3cd466bb7747caa9.tar.gz) | |

scsi: scsi\_debug: Fix out-of-bound read in resp\_report\_tgtpgs()The following issue was observed running syzkaller:
BUG: KASAN: slab-out-of-bounds in memcpy include/linux/string.h:377 [inline]
BUG: KASAN: slab-out-of-bounds in sg\_copy\_buffer+0x150/0x1c0 lib/scatterlist.c:831
Read of size 2132 at addr ffff8880aea95dc8 by task syz-executor.0/9815
CPU: 0 PID: 9815 Comm: syz-executor.0 Not tainted 4.19.202-00874-gfc0fe04215a9 #2
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1 04/01/2014
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:77 [inline]
dump\_stack+0xe4/0x14a lib/dump\_stack.c:118
print\_address\_description+0x73/0x280 mm/kasan/report.c:253
kasan\_report\_error mm/kasan/report.c:352 [inline]
kasan\_report+0x272/0x370 mm/kasan/report.c:410
memcpy+0x1f/0x50 mm/kasan/kasan.c:302
memcpy include/linux/string.h:377 [inline]
sg\_copy\_buffer+0x150/0x1c0 lib/scatterlist.c:831
fill\_from\_dev\_buffer+0x14f/0x340 drivers/scsi/scsi\_debug.c:1021
resp\_report\_tgtpgs+0x5aa/0x770 drivers/scsi/scsi\_debug.c:1772
schedule\_resp+0x464/0x12f0 drivers/scsi/scsi\_debug.c:4429
scsi\_debug\_queuecommand+0x467/0x1390 drivers/scsi/scsi\_debug.c:5835
scsi\_dispatch\_cmd+0x3fc/0x9b0 drivers/scsi/scsi\_lib.c:1896
scsi\_request\_fn+0x1042/0x1810 drivers/scsi/scsi\_lib.c:2034
\_\_blk\_run\_queue\_uncond block/blk-core.c:464 [inline]
\_\_blk\_run\_queue+0x1a4/0x380 block/blk-core.c:484
blk\_execute\_rq\_nowait+0x1c2/0x2d0 block/blk-exec.c:78
sg\_common\_write.isra.19+0xd74/0x1dc0 drivers/scsi/sg.c:847
sg\_write.part.23+0x6e0/0xd00 drivers/scsi/sg.c:716
sg\_write+0x64/0xa0 drivers/scsi/sg.c:622
\_\_vfs\_write+0xed/0x690 fs/read\_write.c:485
kill\_bdev:block\_device:00000000e138492c
vfs\_write+0x184/0x4c0 fs/read\_write.c:549
ksys\_write+0x107/0x240 fs/read\_write.c:599
do\_syscall\_64+0xc2/0x560 arch/x86/entry/common.c:293
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
We get 'alen' from command its type is int. If userspace passes a large
length we will get a negative 'alen'.
Switch n, alen, and rlen to u32.
Link: [https://lore.kernel.org/r/20211013033913.2551004-3-yebin10@huawei.com](https://lore.kernel.org/r/20211013033913.2551004-3-yebin10%40huawei.com)
Acked-by: Douglas Gilbert <dgilbert@interlog.com>
Signed-off-by: Ye Bin <yebin10@huawei.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f347c26836c270199de1599c3cd466bb7747caa9)

| -rw-r--r-- | [drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/scsi/scsi_debug.c?id=f347c26836c270199de1599c3cd466bb7747caa9) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 3 deletions

| diff --git a/drivers/scsi/scsi\_debug.c b/drivers/scsi/scsi\_debug.cindex a71aa23f977397..e008950c3e7f90 100644--- a/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=4e3ace0051e7e504b55d239daab8789dd89b863c)+++ b/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=f347c26836c270199de1599c3cd466bb7747caa9)@@ -1896,8 +1896,9 @@ static int resp\_report\_tgtpgs(struct scsi\_cmnd \*scp, unsigned char \*cmd = scp->cmnd; unsigned char \*arr; int host\_no = devip->sdbg\_host->shost->host\_no;- int n, ret, alen, rlen; int port\_group\_a, port\_group\_b, port\_a, port\_b;+ u32 alen, n, rlen;+ int ret;  alen = get\_unaligned\_be32(cmd + 6); arr = kzalloc(SDEBUG\_MAX\_TGTPGS\_ARR\_SZ, GFP\_ATOMIC);@@ -1959,9 +1960,9 @@ static int resp\_report\_tgtpgs(struct scsi\_cmnd \*scp, \* - The constructed command length \* - The maximum array size \*/- rlen = min\_t(int, alen, n);+ rlen = min(alen, n); ret = fill\_from\_dev\_buffer(scp, arr,- min\_t(int, rlen, SDEBUG\_MAX\_TGTPGS\_ARR\_SZ));+ min\_t(u32, rlen, SDEBUG\_MAX\_TGTPGS\_ARR\_SZ)); kfree(arr); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:37:19 +0000



=== Content from git.kernel.org_5a41a1b3_20250110_173841.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8440377e1a5644779b4c8d013aa2a917f5fc83c3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8440377e1a5644779b4c8d013aa2a917f5fc83c3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8440377e1a5644779b4c8d013aa2a917f5fc83c3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8440377e1a5644779b4c8d013aa2a917f5fc83c3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ye Bin <yebin10@huawei.com> | 2021-10-13 11:39:13 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-11-26 10:39:11 +0100 |
| commit | [8440377e1a5644779b4c8d013aa2a917f5fc83c3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8440377e1a5644779b4c8d013aa2a917f5fc83c3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8440377e1a5644779b4c8d013aa2a917f5fc83c3)) | |
| tree | [1a7172f66073d6559884ae7d33dc415b853875df](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8440377e1a5644779b4c8d013aa2a917f5fc83c3) | |
| parent | [3e20cb072679bdb47747ccc8bee3233a4cf0765a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3e20cb072679bdb47747ccc8bee3233a4cf0765a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8440377e1a5644779b4c8d013aa2a917f5fc83c3&id2=3e20cb072679bdb47747ccc8bee3233a4cf0765a)) | |
| download | [linux-8440377e1a5644779b4c8d013aa2a917f5fc83c3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8440377e1a5644779b4c8d013aa2a917f5fc83c3.tar.gz) | |

scsi: scsi\_debug: Fix out-of-bound read in resp\_report\_tgtpgs()[ Upstream commit f347c26836c270199de1599c3cd466bb7747caa9 ]
The following issue was observed running syzkaller:
BUG: KASAN: slab-out-of-bounds in memcpy include/linux/string.h:377 [inline]
BUG: KASAN: slab-out-of-bounds in sg\_copy\_buffer+0x150/0x1c0 lib/scatterlist.c:831
Read of size 2132 at addr ffff8880aea95dc8 by task syz-executor.0/9815
CPU: 0 PID: 9815 Comm: syz-executor.0 Not tainted 4.19.202-00874-gfc0fe04215a9 #2
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1 04/01/2014
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:77 [inline]
dump\_stack+0xe4/0x14a lib/dump\_stack.c:118
print\_address\_description+0x73/0x280 mm/kasan/report.c:253
kasan\_report\_error mm/kasan/report.c:352 [inline]
kasan\_report+0x272/0x370 mm/kasan/report.c:410
memcpy+0x1f/0x50 mm/kasan/kasan.c:302
memcpy include/linux/string.h:377 [inline]
sg\_copy\_buffer+0x150/0x1c0 lib/scatterlist.c:831
fill\_from\_dev\_buffer+0x14f/0x340 drivers/scsi/scsi\_debug.c:1021
resp\_report\_tgtpgs+0x5aa/0x770 drivers/scsi/scsi\_debug.c:1772
schedule\_resp+0x464/0x12f0 drivers/scsi/scsi\_debug.c:4429
scsi\_debug\_queuecommand+0x467/0x1390 drivers/scsi/scsi\_debug.c:5835
scsi\_dispatch\_cmd+0x3fc/0x9b0 drivers/scsi/scsi\_lib.c:1896
scsi\_request\_fn+0x1042/0x1810 drivers/scsi/scsi\_lib.c:2034
\_\_blk\_run\_queue\_uncond block/blk-core.c:464 [inline]
\_\_blk\_run\_queue+0x1a4/0x380 block/blk-core.c:484
blk\_execute\_rq\_nowait+0x1c2/0x2d0 block/blk-exec.c:78
sg\_common\_write.isra.19+0xd74/0x1dc0 drivers/scsi/sg.c:847
sg\_write.part.23+0x6e0/0xd00 drivers/scsi/sg.c:716
sg\_write+0x64/0xa0 drivers/scsi/sg.c:622
\_\_vfs\_write+0xed/0x690 fs/read\_write.c:485
kill\_bdev:block\_device:00000000e138492c
vfs\_write+0x184/0x4c0 fs/read\_write.c:549
ksys\_write+0x107/0x240 fs/read\_write.c:599
do\_syscall\_64+0xc2/0x560 arch/x86/entry/common.c:293
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
We get 'alen' from command its type is int. If userspace passes a large
length we will get a negative 'alen'.
Switch n, alen, and rlen to u32.
Link: [https://lore.kernel.org/r/20211013033913.2551004-3-yebin10@huawei.com](https://lore.kernel.org/r/20211013033913.2551004-3-yebin10%40huawei.com)
Acked-by: Douglas Gilbert <dgilbert@interlog.com>
Signed-off-by: Ye Bin <yebin10@huawei.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8440377e1a5644779b4c8d013aa2a917f5fc83c3)

| -rw-r--r-- | [drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/scsi/scsi_debug.c?id=8440377e1a5644779b4c8d013aa2a917f5fc83c3) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 3 deletions

| diff --git a/drivers/scsi/scsi\_debug.c b/drivers/scsi/scsi\_debug.cindex 63504dc63d8781..3fc7c2a31c1913 100644--- a/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=3e20cb072679bdb47747ccc8bee3233a4cf0765a)+++ b/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=8440377e1a5644779b4c8d013aa2a917f5fc83c3)@@ -1895,8 +1895,9 @@ static int resp\_report\_tgtpgs(struct scsi\_cmnd \*scp, unsigned char \*cmd = scp->cmnd; unsigned char \*arr; int host\_no = devip->sdbg\_host->shost->host\_no;- int n, ret, alen, rlen; int port\_group\_a, port\_group\_b, port\_a, port\_b;+ u32 alen, n, rlen;+ int ret;  alen = get\_unaligned\_be32(cmd + 6); arr = kzalloc(SDEBUG\_MAX\_TGTPGS\_ARR\_SZ, GFP\_ATOMIC);@@ -1958,9 +1959,9 @@ static int resp\_report\_tgtpgs(struct scsi\_cmnd \*scp, \* - The constructed command length \* - The maximum array size \*/- rlen = min\_t(int, alen, n);+ rlen = min(alen, n); ret = fill\_from\_dev\_buffer(scp, arr,- min\_t(int, rlen, SDEBUG\_MAX\_TGTPGS\_ARR\_SZ));+ min\_t(u32, rlen, SDEBUG\_MAX\_TGTPGS\_ARR\_SZ)); kfree(arr); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:37:18 +0000



=== Content from git.kernel.org_3aaf7159_20250110_173839.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=66523553fa62c7878fc5441dc4e82be71934eb77)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=66523553fa62c7878fc5441dc4e82be71934eb77)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=66523553fa62c7878fc5441dc4e82be71934eb77)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=66523553fa62c7878fc5441dc4e82be71934eb77)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ye Bin <yebin10@huawei.com> | 2021-10-13 11:39:13 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-11-25 09:48:29 +0100 |
| commit | [66523553fa62c7878fc5441dc4e82be71934eb77](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=66523553fa62c7878fc5441dc4e82be71934eb77) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=66523553fa62c7878fc5441dc4e82be71934eb77)) | |
| tree | [20361cbfaa6723a1060616da78b6140ec7b0a150](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=66523553fa62c7878fc5441dc4e82be71934eb77) | |
| parent | [5b8bed6464ad6653586e30df046185fd816ad999](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5b8bed6464ad6653586e30df046185fd816ad999) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=66523553fa62c7878fc5441dc4e82be71934eb77&id2=5b8bed6464ad6653586e30df046185fd816ad999)) | |
| download | [linux-66523553fa62c7878fc5441dc4e82be71934eb77.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-66523553fa62c7878fc5441dc4e82be71934eb77.tar.gz) | |

scsi: scsi\_debug: Fix out-of-bound read in resp\_report\_tgtpgs()[ Upstream commit f347c26836c270199de1599c3cd466bb7747caa9 ]
The following issue was observed running syzkaller:
BUG: KASAN: slab-out-of-bounds in memcpy include/linux/string.h:377 [inline]
BUG: KASAN: slab-out-of-bounds in sg\_copy\_buffer+0x150/0x1c0 lib/scatterlist.c:831
Read of size 2132 at addr ffff8880aea95dc8 by task syz-executor.0/9815
CPU: 0 PID: 9815 Comm: syz-executor.0 Not tainted 4.19.202-00874-gfc0fe04215a9 #2
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1 04/01/2014
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:77 [inline]
dump\_stack+0xe4/0x14a lib/dump\_stack.c:118
print\_address\_description+0x73/0x280 mm/kasan/report.c:253
kasan\_report\_error mm/kasan/report.c:352 [inline]
kasan\_report+0x272/0x370 mm/kasan/report.c:410
memcpy+0x1f/0x50 mm/kasan/kasan.c:302
memcpy include/linux/string.h:377 [inline]
sg\_copy\_buffer+0x150/0x1c0 lib/scatterlist.c:831
fill\_from\_dev\_buffer+0x14f/0x340 drivers/scsi/scsi\_debug.c:1021
resp\_report\_tgtpgs+0x5aa/0x770 drivers/scsi/scsi\_debug.c:1772
schedule\_resp+0x464/0x12f0 drivers/scsi/scsi\_debug.c:4429
scsi\_debug\_queuecommand+0x467/0x1390 drivers/scsi/scsi\_debug.c:5835
scsi\_dispatch\_cmd+0x3fc/0x9b0 drivers/scsi/scsi\_lib.c:1896
scsi\_request\_fn+0x1042/0x1810 drivers/scsi/scsi\_lib.c:2034
\_\_blk\_run\_queue\_uncond block/blk-core.c:464 [inline]
\_\_blk\_run\_queue+0x1a4/0x380 block/blk-core.c:484
blk\_execute\_rq\_nowait+0x1c2/0x2d0 block/blk-exec.c:78
sg\_common\_write.isra.19+0xd74/0x1dc0 drivers/scsi/sg.c:847
sg\_write.part.23+0x6e0/0xd00 drivers/scsi/sg.c:716
sg\_write+0x64/0xa0 drivers/scsi/sg.c:622
\_\_vfs\_write+0xed/0x690 fs/read\_write.c:485
kill\_bdev:block\_device:00000000e138492c
vfs\_write+0x184/0x4c0 fs/read\_write.c:549
ksys\_write+0x107/0x240 fs/read\_write.c:599
do\_syscall\_64+0xc2/0x560 arch/x86/entry/common.c:293
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
We get 'alen' from command its type is int. If userspace passes a large
length we will get a negative 'alen'.
Switch n, alen, and rlen to u32.
Link: [https://lore.kernel.org/r/20211013033913.2551004-3-yebin10@huawei.com](https://lore.kernel.org/r/20211013033913.2551004-3-yebin10%40huawei.com)
Acked-by: Douglas Gilbert <dgilbert@interlog.com>
Signed-off-by: Ye Bin <yebin10@huawei.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=66523553fa62c7878fc5441dc4e82be71934eb77)

| -rw-r--r-- | [drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/scsi/scsi_debug.c?id=66523553fa62c7878fc5441dc4e82be71934eb77) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 3 deletions

| diff --git a/drivers/scsi/scsi\_debug.c b/drivers/scsi/scsi\_debug.cindex be044054574470..ead65cdfb522ea 100644--- a/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=5b8bed6464ad6653586e30df046185fd816ad999)+++ b/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=66523553fa62c7878fc5441dc4e82be71934eb77)@@ -1896,8 +1896,9 @@ static int resp\_report\_tgtpgs(struct scsi\_cmnd \*scp, unsigned char \*cmd = scp->cmnd; unsigned char \*arr; int host\_no = devip->sdbg\_host->shost->host\_no;- int n, ret, alen, rlen; int port\_group\_a, port\_group\_b, port\_a, port\_b;+ u32 alen, n, rlen;+ int ret;  alen = get\_unaligned\_be32(cmd + 6); arr = kzalloc(SDEBUG\_MAX\_TGTPGS\_ARR\_SZ, GFP\_ATOMIC);@@ -1959,9 +1960,9 @@ static int resp\_report\_tgtpgs(struct scsi\_cmnd \*scp, \* - The constructed command length \* - The maximum array size \*/- rlen = min\_t(int, alen, n);+ rlen = min(alen, n); ret = fill\_from\_dev\_buffer(scp, arr,- min\_t(int, rlen, SDEBUG\_MAX\_TGTPGS\_ARR\_SZ));+ min\_t(u32, rlen, SDEBUG\_MAX\_TGTPGS\_ARR\_SZ)); kfree(arr); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:37:17 +0000


