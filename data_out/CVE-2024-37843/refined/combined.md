=== Content from blog.smithsecurity.biz_51d28c1b_20250111_004151.html ===
[ğŸ”’theB10G](/)Ask or search...Ctrl +â€†K

* [â‰ï¸Welcome/whoami](/)
* [ğŸ‘¨â€ğŸ”¬Malware Analyst for a day](/malware-analyst-for-a-day)
* [ğŸ“§Spooky Scammers (Back for the holidays)](/spooky-scammers-back-for-the-holidays)
* [ğŸ’°Hacking the Scammers](/hacking-the-scammers)
* [ğŸ’°Systematic Destruction (Hacking the Scammers pt. 2)](/systematic-destruction-hacking-the-scammers-pt.-2)
* [ğŸ¤µâ€â™‚ï¸SQL Injection in Security Cleared Job Site](/sql-injection-in-security-cleared-job-site)
* [â†©ï¸XSS Security Policy Bypass](/xss-security-policy-bypass)
* [ğŸ“ŠCraft CMS Unauthenticated SQLi via GraphQL](/craft-cms-unauthenticated-sqli-via-graphql)
* [ğŸ¥MISI Hack the Building 2.0 Hospital Edition](/misi-hack-the-building-2.0-hospital-edition)
* [ğŸ“”Booked v2.5.5/LabArchives Scheduler Vulnerability](/booked-v2.5.5-labarchives-scheduler-vulnerability)
* [ğŸ´â€â˜ ï¸CTF Writ3ups](/ctf-writeups)
* [ğŸª–ARCENT Best Cyber Warrior 2023](/arcent-best-cyber-warrior-2023)
* [ğŸ’µBounty Hunter Writeup](/bounty-hunter-writeup)
* [ğŸª„Previse Writeup](/previse-writeup)
* [ğŸ‘¾eJPT certification Review](/ejpt-certification-review)
* [ğŸ”¥Sauna Writeup](/sauna-writeup)
* [ğŸƒâ€â™‚ï¸Active Writeup](/active-writeup)
* [ğŸš˜Driver Writeup](/driver-writeup)
* [âŒTrick Writeup](/trick-writeup)
* [ğŸ“ŠGraphQL Query Authentication Bypass Vuln](/graphql-query-authentication-bypass-vuln)
* [ğŸ•¸ï¸eWPT Certification Review](/ewpt-certification-review)
* [â˜€ï¸2022 DOE Cyberforce Competition](/2022-doe-cyberforce-competition)
* [â›ï¸Data Mining CVEs and Exploits](/data-mining-cves-and-exploits)
* [ğŸ’»eCPPTv2 Certification Review](/ecpptv2-certification-review)
* [Breaking GraphQL Presentation](/breaking-graphql-presentation)
* [Springshare LibApps Stored XSS](/springshare-libapps-stored-xss)

[Powered by GitBook](https://www.gitbook.com/?utm_source=content&utm_medium=trademark&utm_campaign=uSROL4SI6SkTn8EwsIii)On this page

Was this helpful?

Last updated 6 months ago

During a private assessment I discovered a public facing GraphQL endpoint with introspection enabled. After some further digging I found that the majority of the calls could be made without authentication. These calls had a lot of options that seemed to affect the query being done on the database so I decided to play around with a few of the queries. In doing so I discovered that the orderBy argument returns a very verbose error that contains full paths to files a well as the query being executed itself.

Because I now could get an insight into what was running on the backend, Craft CMS (Pro or enterprise edition because of the GraphQL endpoint), I could figure out exactly how I wanted to craft the query in order to get some sort of SQL injection. To do this though I needed to escape and write to the query itself.

This part took the longest surprisingly because it wasnâ€™t as simple as adding a â€œ or â€˜. After two days of messing about with the queries I found it. Including `\`` in the query, basically anywhere seemed to do the trick. And in the end, for the payload, I ended up just doing â€œ`â€” \\` \n`â€.

Getting a query to execute now also turned out to be harder than expected and was not, and still is not, as easy as pointing SQLmap at the call and letting it do its thing. Because these are stacked queries and the injection point was injecting into two locations I had to find a way to complete the current query, without errors, and get it to execute the next query without errors. I was able to do this but the last part of the data would always error out, and still does, but the queries are executed before it errors. I was unable to get rid of the now junk data at the end because no MySQL comments worked on all the lines, even multi-line (/\*) comments. I believe this is due to the queries having a bunch of new lines in them and also the fact that the multiline comments couldnâ€™t be closed at the end. Someone smarter than me might manage to find a way to do this though.

Because of those blocks I could only manage to get Blind (Time-Based) SQL injection, but this is still very powerful for an attacker and they can still read out of the databases and possibly even get RCE as the default DB user for MySQL in Craft CMS is root, allowing for write access to the system which can be abused by uploading things like PHP webshells.

This issue was patched in Craft CMS 3.7.32.

POC is located .

This has been assigned .

[PreviousXSS Security Policy Bypass](/xss-security-policy-bypass)[NextMISI Hack the Building 2.0 Hospital Edition](/misi-hack-the-building-2.0-hospital-edition)
# ğŸ“ŠCraft CMS Unauthenticated SQLi via GraphQL

Craft CMS Unauthenticated Blind (time-based) SQL Injection via GraphQL API Endpoint. Craft CMS <= 3.7.31

[here](https://github.com/gsmith257-cyber/CVE-2024-37843-POC/)[CVE-2024-37843](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-37843)

The underlined SLEEP(10) being executed causing the response to be be delayed >10 seconds (bottom right)

![](https://blog.smithsecurity.biz/~gitbook/image?url=https%3A%2F%2F1987229882-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FuSROL4SI6SkTn8EwsIii%252Fuploads%252FU6rML4vQJq0WdHS3q3e8%252FcraftCMS-sqli%281%29.PNG%3Falt%3Dmedia%26token%3Db2f1b394-1fc5-4ff7-8d11-60c82b121a59&width=768&dpr=4&quality=100&sign=9da638ba&sv=2)
