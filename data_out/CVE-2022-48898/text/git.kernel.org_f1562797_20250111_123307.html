

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=984ad875db804948c86ca9e1c2e784ae8252715a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=984ad875db804948c86ca9e1c2e784ae8252715a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=984ad875db804948c86ca9e1c2e784ae8252715a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=984ad875db804948c86ca9e1c2e784ae8252715a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kuogee Hsieh <quic\_khsieh@quicinc.com> | 2022-12-27 18:16:24 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-01-18 11:48:51 +0100 |
| commit | [984ad875db804948c86ca9e1c2e784ae8252715a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=984ad875db804948c86ca9e1c2e784ae8252715a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=984ad875db804948c86ca9e1c2e784ae8252715a)) | |
| tree | [0ff16aab334b9c93c6d814bca58d54f220adfede](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=984ad875db804948c86ca9e1c2e784ae8252715a) | |
| parent | [92ae83665e9e24d44e57d897b91e72144ce1de8e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=92ae83665e9e24d44e57d897b91e72144ce1de8e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=984ad875db804948c86ca9e1c2e784ae8252715a&id2=92ae83665e9e24d44e57d897b91e72144ce1de8e)) | |
| download | [linux-984ad875db804948c86ca9e1c2e784ae8252715a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-984ad875db804948c86ca9e1c2e784ae8252715a.tar.gz) | |

drm/msm/dp: do not complete dp\_aux\_cmd\_fifo\_tx() if irq is not for aux transfercommit 1cba0d150fa102439114a91b3e215909efc9f169 upstream.
There are 3 possible interrupt sources are handled by DP controller,
HPDstatus, Controller state changes and Aux read/write transaction.
At every irq, DP controller have to check isr status of every interrupt
sources and service the interrupt if its isr status bits shows interrupts
are pending. There is potential race condition may happen at current aux
isr handler implementation since it is always complete dp\_aux\_cmd\_fifo\_tx()
even irq is not for aux read or write transaction. This may cause aux read
transaction return premature if host aux data read is in the middle of
waiting for sink to complete transferring data to host while irq happen.
This will cause host's receiving buffer contains unexpected data. This
patch fixes this problem by checking aux isr and return immediately at
aux isr handler if there are no any isr status bits set.
Current there is a bug report regrading eDP edid corruption happen during
system booting up. After lengthy debugging to found that VIDEO\_READY
interrupt was continuously firing during system booting up which cause
dp\_aux\_isr() to complete dp\_aux\_cmd\_fifo\_tx() prematurely to retrieve data
from aux hardware buffer which is not yet contains complete data transfer
from sink. This cause edid corruption.
Follows are the signature at kernel logs when problem happen,
EDID has corrupt header
panel-simple-dp-aux aux-aea0000.edp: Couldn't identify panel via EDID
Changes in v2:
-- do complete if (ret == IRQ\_HANDLED) ay dp-aux\_isr()
-- add more commit text
Changes in v3:
-- add Stephen suggested
-- dp\_aux\_isr() return IRQ\_XXX back to caller
-- dp\_ctrl\_isr() return IRQ\_XXX back to caller
Changes in v4:
-- split into two patches
Changes in v5:
-- delete empty line between tags
Changes in v6:
-- remove extra "that" and fixed line more than 75 char at commit text
Fixes: c943b4948b58 ("drm/msm/dp: add displayPort driver support")
Signed-off-by: Kuogee Hsieh <quic\_khsieh@quicinc.com>
Tested-by: Douglas Anderson <dianders@chromium.org>
Reviewed-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Reviewed-by: Dmitry Baryshkov <dmitry.baryshkov@linaro.org>
Patchwork: https://patchwork.freedesktop.org/patch/516121/
Link: [https://lore.kernel.org/r/1672193785-11003-2-git-send-email-quic\_khsieh@quicinc.com](https://lore.kernel.org/r/1672193785-11003-2-git-send-email-quic_khsieh%40quicinc.com)
Signed-off-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=984ad875db804948c86ca9e1c2e784ae8252715a)

| -rw-r--r-- | [drivers/gpu/drm/msm/dp/dp\_aux.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/msm/dp/dp_aux.c?id=984ad875db804948c86ca9e1c2e784ae8252715a) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/msm/dp/dp\_aux.c b/drivers/gpu/drm/msm/dp/dp\_aux.cindex 6d36f63c333881..7b8d4ba868eb76 100644--- a/[drivers/gpu/drm/msm/dp/dp\_aux.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/dp/dp_aux.c?id=92ae83665e9e24d44e57d897b91e72144ce1de8e)+++ b/[drivers/gpu/drm/msm/dp/dp\_aux.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/dp/dp_aux.c?id=984ad875db804948c86ca9e1c2e784ae8252715a)@@ -406,6 +406,10 @@ void dp\_aux\_isr(struct drm\_dp\_aux \*dp\_aux)  isr = dp\_catalog\_aux\_get\_irq(aux->catalog); + /\* no interrupts pending, return immediately \*/+ if (!isr)+ return;+ if (!aux->cmd\_busy) return; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:31:44 +0000

