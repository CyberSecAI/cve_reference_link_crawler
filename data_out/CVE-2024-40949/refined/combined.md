=== Content from git.kernel.org_4290f1ca_20250111_090201.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Baolin Wang <baolin.wang@linux.alibaba.com> | 2024-06-13 16:21:19 +0800 |
| --- | --- | --- |
| committer | Andrew Morton <akpm@linux-foundation.org> | 2024-06-15 10:43:08 -0700 |
| commit | [9094b4a1c76cfe84b906cc152bab34d4ba26fa5c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c)) | |
| tree | [5895863879a6bb62f95d7aac78ecbc10f165414c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c) | |
| parent | [0b1ef4fde7a24909ff2afacffd0d6afa28b73652](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0b1ef4fde7a24909ff2afacffd0d6afa28b73652) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c&id2=0b1ef4fde7a24909ff2afacffd0d6afa28b73652)) | |
| download | [linux-9094b4a1c76cfe84b906cc152bab34d4ba26fa5c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9094b4a1c76cfe84b906cc152bab34d4ba26fa5c.tar.gz) | |

mm: shmem: fix getting incorrect lruvec when replacing a shmem folioWhen testing shmem swapin, I encountered the warning below on my machine.
The reason is that replacing an old shmem folio with a new one causes
mem\_cgroup\_migrate() to clear the old folio's memcg data. As a result,
the old folio cannot get the correct memcg's lruvec needed to remove
itself from the LRU list when it is being freed. This could lead to
possible serious problems, such as LRU list crashes due to holding the
wrong LRU lock, and incorrect LRU statistics.
To fix this issue, we can fallback to use the mem\_cgroup\_replace\_folio()
to replace the old shmem folio.
[ 5241.100311] page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x5d9960
[ 5241.100317] head: order:4 mapcount:0 entire\_mapcount:0 nr\_pages\_mapped:0 pincount:0
[ 5241.100319] flags: 0x17fffe0000040068(uptodate|lru|head|swapbacked|node=0|zone=2|lastcpupid=0x3ffff)
[ 5241.100323] raw: 17fffe0000040068 fffffdffd6687948 fffffdffd69ae008 0000000000000000
[ 5241.100325] raw: 0000000000000000 0000000000000000 00000000ffffffff 0000000000000000
[ 5241.100326] head: 17fffe0000040068 fffffdffd6687948 fffffdffd69ae008 0000000000000000
[ 5241.100327] head: 0000000000000000 0000000000000000 00000000ffffffff 0000000000000000
[ 5241.100328] head: 17fffe0000000204 fffffdffd6665801 ffffffffffffffff 0000000000000000
[ 5241.100329] head: 0000000a00000010 0000000000000000 00000000ffffffff 0000000000000000
[ 5241.100330] page dumped because: VM\_WARN\_ON\_ONCE\_FOLIO(!memcg && !mem\_cgroup\_disabled())
[ 5241.100338] ------------[ cut here ]------------
[ 5241.100339] WARNING: CPU: 19 PID: 78402 at include/linux/memcontrol.h:775 folio\_lruvec\_lock\_irqsave+0x140/0x150
[...]
[ 5241.100374] pc : folio\_lruvec\_lock\_irqsave+0x140/0x150
[ 5241.100375] lr : folio\_lruvec\_lock\_irqsave+0x138/0x150
[ 5241.100376] sp : ffff80008b38b930
[...]
[ 5241.100398] Call trace:
[ 5241.100399] folio\_lruvec\_lock\_irqsave+0x140/0x150
[ 5241.100401] \_\_page\_cache\_release+0x90/0x300
[ 5241.100404] \_\_folio\_put+0x50/0x108
[ 5241.100406] shmem\_replace\_folio+0x1b4/0x240
[ 5241.100409] shmem\_swapin\_folio+0x314/0x528
[ 5241.100411] shmem\_get\_folio\_gfp+0x3b4/0x930
[ 5241.100412] shmem\_fault+0x74/0x160
[ 5241.100414] \_\_do\_fault+0x40/0x218
[ 5241.100417] do\_shared\_fault+0x34/0x1b0
[ 5241.100419] do\_fault+0x40/0x168
[ 5241.100420] handle\_pte\_fault+0x80/0x228
[ 5241.100422] \_\_handle\_mm\_fault+0x1c4/0x440
[ 5241.100424] handle\_mm\_fault+0x60/0x1f0
[ 5241.100426] do\_page\_fault+0x120/0x488
[ 5241.100429] do\_translation\_fault+0x4c/0x68
[ 5241.100431] do\_mem\_abort+0x48/0xa0
[ 5241.100434] el0\_da+0x38/0xc0
[ 5241.100436] el0t\_64\_sync\_handler+0x68/0xc0
[ 5241.100437] el0t\_64\_sync+0x14c/0x150
[ 5241.100439] ---[ end trace 0000000000000000 ]---
[baolin.wang@linux.alibaba.com: remove less helpful comments, per Matthew]
Link: https://lkml.kernel.org/r/ccad3fe1375b468ebca3227b6b729f3eaf9d8046.1718423197.git.baolin.wang@linux.alibaba.com
Link: [https://lkml.kernel.org/r/3c11000dd6c1df83015a8321a859e9775ebbc23e.1718266112.git.baolin.wang@linux.alibaba.com](https://lkml.kernel.org/r/3c11000dd6c1df83015a8321a859e9775ebbc23e.1718266112.git.baolin.wang%40linux.alibaba.com)
Fixes: 85ce2c517ade ("memcontrol: only transfer the memcg data for migration")
Signed-off-by: Baolin Wang <baolin.wang@linux.alibaba.com>
Reviewed-by: Shakeel Butt <shakeel.butt@linux.dev>
Cc: Matthew Wilcox (Oracle) <willy@infradead.org>
Cc: Hugh Dickins <hughd@google.com>
Cc: Johannes Weiner <hannes@cmpxchg.org>
Cc: Nhat Pham <nphamcs@gmail.com>
Cc: Michal Hocko <mhocko@suse.com>
Cc: Roman Gushchin <roman.gushchin@linux.dev>
Cc: Muchun Song <songmuchun@bytedance.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c)

| -rw-r--r-- | [mm/memcontrol.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/memcontrol.c?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [mm/shmem.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/shmem.c?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/mm/memcontrol.c b/mm/memcontrol.cindex 36793e509f4708..71fe2a95b8bd33 100644--- a/[mm/memcontrol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/memcontrol.c?id=0b1ef4fde7a24909ff2afacffd0d6afa28b73652)+++ b/[mm/memcontrol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/memcontrol.c?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c)@@ -7745,8 +7745,7 @@ void \_\_mem\_cgroup\_uncharge\_folios(struct folio\_batch \*folios) \* @new: Replacement folio. \* \* Charge @new as a replacement folio for @old. @old will- \* be uncharged upon free. This is only used by the page cache- \* (in replace\_page\_cache\_folio()).+ \* be uncharged upon free. \* \* Both folios must be locked, @new->mapping must be set up. \*/diff --git a/mm/shmem.c b/mm/shmem.cindex f5d60436b604af..a8b181a6340296 100644--- a/[mm/shmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/shmem.c?id=0b1ef4fde7a24909ff2afacffd0d6afa28b73652)+++ b/[mm/shmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/shmem.c?id=9094b4a1c76cfe84b906cc152bab34d4ba26fa5c)@@ -1786,7 +1786,7 @@ static int shmem\_replace\_folio(struct folio \*\*foliop, gfp\_t gfp, xa\_lock\_irq(&swap\_mapping->i\_pages); error = shmem\_replace\_entry(swap\_mapping, swap\_index, old, new); if (!error) {- mem\_cgroup\_migrate(old, new);+ mem\_cgroup\_replace\_folio(old, new); \_\_lruvec\_stat\_mod\_folio(new, NR\_FILE\_PAGES, 1); \_\_lruvec\_stat\_mod\_folio(new, NR\_SHMEM, 1); \_\_lruvec\_stat\_mod\_folio(old, NR\_FILE\_PAGES, -1); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:00:38 +0000



=== Content from git.kernel.org_9518946e_20250111_090200.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Baolin Wang <baolin.wang@linux.alibaba.com> | 2024-06-13 16:21:19 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-27 13:52:30 +0200 |
| commit | [8c6c3719ebb7913f8a665d11816d2e38b0eadbab](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab)) | |
| tree | [7eaf7c61c0d1c69d27e9194ad6edf73c46088a70](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab) | |
| parent | [5df493a99fcf887133cf01d23cd4bebb6d385d3c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5df493a99fcf887133cf01d23cd4bebb6d385d3c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab&id2=5df493a99fcf887133cf01d23cd4bebb6d385d3c)) | |
| download | [linux-8c6c3719ebb7913f8a665d11816d2e38b0eadbab.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8c6c3719ebb7913f8a665d11816d2e38b0eadbab.tar.gz) | |

mm: shmem: fix getting incorrect lruvec when replacing a shmem foliocommit 9094b4a1c76cfe84b906cc152bab34d4ba26fa5c upstream.
When testing shmem swapin, I encountered the warning below on my machine.
The reason is that replacing an old shmem folio with a new one causes
mem\_cgroup\_migrate() to clear the old folio's memcg data. As a result,
the old folio cannot get the correct memcg's lruvec needed to remove
itself from the LRU list when it is being freed. This could lead to
possible serious problems, such as LRU list crashes due to holding the
wrong LRU lock, and incorrect LRU statistics.
To fix this issue, we can fallback to use the mem\_cgroup\_replace\_folio()
to replace the old shmem folio.
[ 5241.100311] page: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x5d9960
[ 5241.100317] head: order:4 mapcount:0 entire\_mapcount:0 nr\_pages\_mapped:0 pincount:0
[ 5241.100319] flags: 0x17fffe0000040068(uptodate|lru|head|swapbacked|node=0|zone=2|lastcpupid=0x3ffff)
[ 5241.100323] raw: 17fffe0000040068 fffffdffd6687948 fffffdffd69ae008 0000000000000000
[ 5241.100325] raw: 0000000000000000 0000000000000000 00000000ffffffff 0000000000000000
[ 5241.100326] head: 17fffe0000040068 fffffdffd6687948 fffffdffd69ae008 0000000000000000
[ 5241.100327] head: 0000000000000000 0000000000000000 00000000ffffffff 0000000000000000
[ 5241.100328] head: 17fffe0000000204 fffffdffd6665801 ffffffffffffffff 0000000000000000
[ 5241.100329] head: 0000000a00000010 0000000000000000 00000000ffffffff 0000000000000000
[ 5241.100330] page dumped because: VM\_WARN\_ON\_ONCE\_FOLIO(!memcg && !mem\_cgroup\_disabled())
[ 5241.100338] ------------[ cut here ]------------
[ 5241.100339] WARNING: CPU: 19 PID: 78402 at include/linux/memcontrol.h:775 folio\_lruvec\_lock\_irqsave+0x140/0x150
[...]
[ 5241.100374] pc : folio\_lruvec\_lock\_irqsave+0x140/0x150
[ 5241.100375] lr : folio\_lruvec\_lock\_irqsave+0x138/0x150
[ 5241.100376] sp : ffff80008b38b930
[...]
[ 5241.100398] Call trace:
[ 5241.100399] folio\_lruvec\_lock\_irqsave+0x140/0x150
[ 5241.100401] \_\_page\_cache\_release+0x90/0x300
[ 5241.100404] \_\_folio\_put+0x50/0x108
[ 5241.100406] shmem\_replace\_folio+0x1b4/0x240
[ 5241.100409] shmem\_swapin\_folio+0x314/0x528
[ 5241.100411] shmem\_get\_folio\_gfp+0x3b4/0x930
[ 5241.100412] shmem\_fault+0x74/0x160
[ 5241.100414] \_\_do\_fault+0x40/0x218
[ 5241.100417] do\_shared\_fault+0x34/0x1b0
[ 5241.100419] do\_fault+0x40/0x168
[ 5241.100420] handle\_pte\_fault+0x80/0x228
[ 5241.100422] \_\_handle\_mm\_fault+0x1c4/0x440
[ 5241.100424] handle\_mm\_fault+0x60/0x1f0
[ 5241.100426] do\_page\_fault+0x120/0x488
[ 5241.100429] do\_translation\_fault+0x4c/0x68
[ 5241.100431] do\_mem\_abort+0x48/0xa0
[ 5241.100434] el0\_da+0x38/0xc0
[ 5241.100436] el0t\_64\_sync\_handler+0x68/0xc0
[ 5241.100437] el0t\_64\_sync+0x14c/0x150
[ 5241.100439] ---[ end trace 0000000000000000 ]---
[baolin.wang@linux.alibaba.com: remove less helpful comments, per Matthew]
Link: https://lkml.kernel.org/r/ccad3fe1375b468ebca3227b6b729f3eaf9d8046.1718423197.git.baolin.wang@linux.alibaba.com
Link: [https://lkml.kernel.org/r/3c11000dd6c1df83015a8321a859e9775ebbc23e.1718266112.git.baolin.wang@linux.alibaba.com](https://lkml.kernel.org/r/3c11000dd6c1df83015a8321a859e9775ebbc23e.1718266112.git.baolin.wang%40linux.alibaba.com)
Fixes: 85ce2c517ade ("memcontrol: only transfer the memcg data for migration")
Signed-off-by: Baolin Wang <baolin.wang@linux.alibaba.com>
Reviewed-by: Shakeel Butt <shakeel.butt@linux.dev>
Cc: Matthew Wilcox (Oracle) <willy@infradead.org>
Cc: Hugh Dickins <hughd@google.com>
Cc: Johannes Weiner <hannes@cmpxchg.org>
Cc: Nhat Pham <nphamcs@gmail.com>
Cc: Michal Hocko <mhocko@suse.com>
Cc: Roman Gushchin <roman.gushchin@linux.dev>
Cc: Muchun Song <songmuchun@bytedance.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab)

| -rw-r--r-- | [mm/memcontrol.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/memcontrol.c?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [mm/shmem.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/shmem.c?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/mm/memcontrol.c b/mm/memcontrol.cindex fabce2b50c6955..612558f306f4a7 100644--- a/[mm/memcontrol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/memcontrol.c?id=5df493a99fcf887133cf01d23cd4bebb6d385d3c)+++ b/[mm/memcontrol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/memcontrol.c?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab)@@ -7531,8 +7531,7 @@ void \_\_mem\_cgroup\_uncharge\_folios(struct folio\_batch \*folios) \* @new: Replacement folio. \* \* Charge @new as a replacement folio for @old. @old will- \* be uncharged upon free. This is only used by the page cache- \* (in replace\_page\_cache\_folio()).+ \* be uncharged upon free. \* \* Both folios must be locked, @new->mapping must be set up. \*/diff --git a/mm/shmem.c b/mm/shmem.cindex 1f84a41aeb850e..b66e99e2c70f37 100644--- a/[mm/shmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/shmem.c?id=5df493a99fcf887133cf01d23cd4bebb6d385d3c)+++ b/[mm/shmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/shmem.c?id=8c6c3719ebb7913f8a665d11816d2e38b0eadbab)@@ -1786,7 +1786,7 @@ static int shmem\_replace\_folio(struct folio \*\*foliop, gfp\_t gfp, xa\_lock\_irq(&swap\_mapping->i\_pages); error = shmem\_replace\_entry(swap\_mapping, swap\_index, old, new); if (!error) {- mem\_cgroup\_migrate(old, new);+ mem\_cgroup\_replace\_folio(old, new); \_\_lruvec\_stat\_mod\_folio(new, NR\_FILE\_PAGES, 1); \_\_lruvec\_stat\_mod\_folio(new, NR\_SHMEM, 1); \_\_lruvec\_stat\_mod\_folio(old, NR\_FILE\_PAGES, -1); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:00:37 +0000


