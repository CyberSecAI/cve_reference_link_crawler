<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head> <title>curl - cookie injection with none file - CVE-2023-38546</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="stylesheet" type="text/css" href="/curl.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/logo/curl-symbol.svg" type="image/svg+xml">
<link rel="alternate" type="application/rss+xml" title="cURL Releases" href="https://github.com/curl/curl/releases.atom">
<link rel="stylesheet" type="text/css" href="/manpage.css">
<style>
code {
    padding: 0px 4px 0px 4px;
    background-color: #f0f0f0;
}
 (prefers-color-scheme: dark) {
    code {
        padding: 0px 4px 0px 4px;
        background-color: #101010;
    }
}
</style>
</head>
<body>
<div class="main">
<div class="menu">
<a href="/docs/" class="menuitem" title="Documentation Overview">Docs Overview</a>
<div class="dropdown">
  <a class="dropbtn" href="/docs/projdocs.html">Project</a>
  <div class="dropdown-content">
    <a href="/docs/bugbounty.html">Bug Bounty</a>
    <a href="/docs/bugs.html">Bug Report</a>
    <a href="/docs/code-of-conduct.html">Code of conduct</a>
    <a href="/docs/libs.html">Dependencies</a>
    <a href="/donation.html">Donate</a>
    <a href="/docs/faq.html">FAQ</a>
    <a href="/docs/features.html">Features</a>
    <a href="/docs/governance.html">Governance</a>
    <a href="/docs/history.html">History</a>
    <a href="/docs/install.html">Install</a>
    <a href="/docs/knownbugs.html">Known Bugs</a>
    <a href="/logo/">Logo</a>
    <a href="/docs/todo.html">TODO</a>
    <a href="/about.html">website Info</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/protdocs.html">Protocols</a>
  <div class="dropdown-content">
    <a href="/docs/caextract.html">CA Extract</a>
    <a href="/docs/http-cookies.html">HTTP cookies</a>
    <a href="/docs/http3.html">HTTP/3</a>
    <a href="/docs/mqtt.html">MQTT</a>
    <a href="/docs/sslcerts.html">SSL certs</a>
    <a href="/docs/ssl-compared.html">SSL libs compared</a>
    <a href="/docs/url-syntax.html">URL syntax</a>
    <a href="/docs/websocket.html">WebSocket</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/reldocs.html">Releases</a>
  <div class="dropdown-content">
    <a href="/ch/">Changelog</a>
    <a href="/docs/security.html">curl CVEs</a>
    <a href="/docs/releases.html">Release Table</a>
    <a href="/docs/versions.html">Version Numbering</a>
    <a href="/docs/vulnerabilities.html">Vulnerabilities</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/tooldocs.html">Tool</a>
  <div class="dropdown-content">
    <a href="/docs/comparison-table.html">Comparison Table</a>
    <a href="/docs/manpage.html">curl man page</a>
    <a href="/docs/httpscripting.html">HTTP Scripting</a>
    <a href="/docs/mk-ca-bundle.html">mk-ca-bundle</a>
    <a href="/docs/tutorial.html">Tutorial</a>
    <a href="optionswhen.html">When options were added</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/whodocs.html">Who and Why</a>
  <div class="dropdown-content">
    <a href="/docs/companies.html">Companies</a>
    <a href="/docs/copyright.html">Copyright</a>
    <a href="/sponsors.html">Sponsors</a>
    <a href="/docs/thanks.html">Thanks</a>
    <a href="/docs/thename.html">The name</a>
  </div>
</div>
</div>
<div class="contents">
<div class="where"><a href="/">curl</a> / <a href="/docs/">Docs</a> / <a href="/docs/security.html">curl CVEs</a> / <b>cookie injection with none file</b></div>
<div class="relatedbox">
<b>Related:</b>
<br><a href="audits.html">Audits</a>
<br><a href="/docs/bugbounty.html">Bug Bounty</a>
<br><a href="/ch/">Changelog</a>
<br><a href="security.html">curl CVEs</a>
<br><a href="CVE-2023-38546.json">JSON metadata</a>
<br><a href="https://hackerone.com/reports/2148242">Original report</a>
<br><a href="/dev/vuln-disclosure.html">Vulnerability Disclosure</a>
<br><a href="vulnerabilities.html">Vulnerabilities Table</a>
</div>
<div class="relatedbox">
Awarded 540 USD<br>
</div>
<h2>CVE-2023-38546</h2>
<h1 id="cookie-injection-with-none-file">cookie injection with none
file</h1>
<p>Project curl Security Advisory, October 11 2023 - <a
href="https://curl.se/docs/CVE-2023-38546.html">Permalink</a></p>
<h2 id="vulnerability">VULNERABILITY</h2>
<p>This flaw allows an attacker to intentionally inject cookies into a
running program using libcurl, if the specific series of conditions are
met.</p>
<p>libcurl performs transfers. In its API, an application creates "easy
handles" that are the individual handles for single transfers.</p>
<p>libcurl provides a function call that duplicates an easy handle
called <a
href="https://curl.se/libcurl/c/curl_easy_duphandle.html">curl_easy_duphandle</a>.</p>
<p>If a transfer has cookies enabled when the handle is duplicated, the
cookie-enable state is also cloned - but without cloning the actual
cookies. If the source handle did not read any cookies from a specific
file on disk, the cloned version of the handle would instead store the
filename as <code>none</code> (using the four ASCII letters, no
quotes).</p>
<p>Subsequent use of the cloned handle that does not explicitly set a
source to load cookies from would then inadvertently load cookies from a
file named <code>none</code> - if such a file exists and is readable in
the current directory of the program using libcurl, when using the
correct file format of course.</p>
<h2 id="info">INFO</h2>
<p>The Common Vulnerabilities and Exposures (CVE) project has assigned
the name CVE-2023-38546 to this issue.</p>
<p>CWE-73: External Control of filename or Path</p>
<p>Severity: Low</p>
<p>We set it to low because the flaw requires a series of conditions to
be met and the likeliness that they shall allow an attacker to take
advantage of it is low. Even if the bug could be made to trigger, the
risk that a cookie injection can be done to cause harm is additionally
also low.</p>
<h2 id="affected-versions">AFFECTED VERSIONS</h2>
<ul>
<li>Affected versions: libcurl <a href="vuln-7.9.1.html">7.9.1</a> to and including <a href="vuln-8.3.0.html">8.3.0</a></li>
<li>Not affected versions: libcurl &lt; <a href="vuln-7.9.1.html">7.9.1</a> and &gt;= <a href="vuln-8.4.0.html">8.4.0</a></li>
<li>Introduced-in: <a
href="https://github.com/curl/curl/commit/74d5a6fb3b9a96d9f">https://github.com/curl/curl/commit/74d5a6fb3b9a96d9f</a></li>
</ul>
<p>libcurl is used by many applications, but not always advertised as
such!</p>
<p>The (flawed) logic that created this bug existed even before the
<code>curl_easy_duphandle()</code> function was added, but it did not
become this problem until this API was introduced.</p>
<p>This flaw is not accessible using the curl command line tool.</p>
<h2 id="solution">SOLUTION</h2>
<p>Starting in curl <a href="vuln-8.4.0.html">8.4.0</a>, curl not longer stores the filename in the
cookie struct.</p>
<ul>
<li>Fixed-in: <a
href="https://github.com/curl/curl/commit/61275672b46d9abb32857404">https://github.com/curl/curl/commit/61275672b46d9abb32857404</a></li>
</ul>
<h2 id="recommendations">RECOMMENDATIONS</h2>
<p>A - Upgrade curl to version <a href="vuln-8.4.0.html">8.4.0</a></p>
<p>B - Apply the patch to your local version</p>
<p>C - Call
<code>curl_easy_setopt(cloned_curl, <a href="https://curl.se/libcurl/c/CURLOPT_COOKIELIST.html">CURLOPT_COOKIELIST</a>, "ALL");</code>
right after every <code>curl_easy_duphandle();</code> call.</p>
<h2 id="timeline">TIMELINE</h2>
<p>This issue was reported to the curl project on September 14, 2023. We
contacted distros@openwall on October 3, 2023.</p>
<p>libcurl <a href="vuln-8.4.0.html">8.4.0</a> was released on October 11 2023, coordinated with the
publication of this advisory.</p>
<h2 id="credits">CREDITS</h2>
<ul>
<li>Reported-by: w0x42 on hackerone</li>
<li>Patched-by: Daniel Stenberg</li>
</ul>
<p>Thanks a lot!</p>
</div>
</div>
</body> </html>
