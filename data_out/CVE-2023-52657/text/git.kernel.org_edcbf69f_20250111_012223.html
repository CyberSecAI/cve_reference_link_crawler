

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c51468ac328d3922747be55507c117e47da813e6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c51468ac328d3922747be55507c117e47da813e6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c51468ac328d3922747be55507c117e47da813e6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c51468ac328d3922747be55507c117e47da813e6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alex Deucher <alexander.deucher@amd.com> | 2023-08-09 15:06:00 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-03-06 14:53:55 +0000 |
| commit | [c51468ac328d3922747be55507c117e47da813e6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c51468ac328d3922747be55507c117e47da813e6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c51468ac328d3922747be55507c117e47da813e6)) | |
| tree | [b0fc34e28a9bf45e3eabfae567c5466092ca73ba](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c51468ac328d3922747be55507c117e47da813e6) | |
| parent | [2261f926954f83344b79b9b5f21def6b7cfc7d29](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2261f926954f83344b79b9b5f21def6b7cfc7d29) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c51468ac328d3922747be55507c117e47da813e6&id2=2261f926954f83344b79b9b5f21def6b7cfc7d29)) | |
| download | [linux-c51468ac328d3922747be55507c117e47da813e6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c51468ac328d3922747be55507c117e47da813e6.tar.gz) | |

Revert "drm/amd/pm: resolve reboot exception for si oland"commit 955558030954b9637b41c97b730f9b38c92ac488 upstream.
This reverts commit e490d60a2f76bff636c68ce4fe34c1b6c34bbd86.
This causes hangs on SI when DC is enabled and errors on driver
reboot and power off cycles.
Closes: https://gitlab.freedesktop.org/drm/amd/-/issues/3216
Closes: https://gitlab.freedesktop.org/drm/amd/-/issues/2755
Reviewed-by: Yang Wang <kevinyang.wang@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c51468ac328d3922747be55507c117e47da813e6)

| -rw-r--r-- | [drivers/gpu/drm/amd/pm/legacy-dpm/si\_dpm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/pm/legacy-dpm/si_dpm.c?id=c51468ac328d3922747be55507c117e47da813e6) | 29 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 29 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/amd/pm/legacy-dpm/si\_dpm.c b/drivers/gpu/drm/amd/pm/legacy-dpm/si\_dpm.cindex df4f20293c16a3..eb4da3666e05d6 100644--- a/[drivers/gpu/drm/amd/pm/legacy-dpm/si\_dpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/pm/legacy-dpm/si_dpm.c?id=2261f926954f83344b79b9b5f21def6b7cfc7d29)+++ b/[drivers/gpu/drm/amd/pm/legacy-dpm/si\_dpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/pm/legacy-dpm/si_dpm.c?id=c51468ac328d3922747be55507c117e47da813e6)@@ -6925,6 +6925,23 @@ static int si\_dpm\_enable(struct amdgpu\_device \*adev) return 0; } +static int si\_set\_temperature\_range(struct amdgpu\_device \*adev)+{+ int ret;++ ret = si\_thermal\_enable\_alert(adev, false);+ if (ret)+ return ret;+ ret = si\_thermal\_set\_temperature\_range(adev, R600\_TEMP\_RANGE\_MIN, R600\_TEMP\_RANGE\_MAX);+ if (ret)+ return ret;+ ret = si\_thermal\_enable\_alert(adev, true);+ if (ret)+ return ret;++ return ret;+}+ static void si\_dpm\_disable(struct amdgpu\_device \*adev) { struct rv7xx\_power\_info \*pi = rv770\_get\_pi(adev);@@ -7608,6 +7625,18 @@ static int si\_dpm\_process\_interrupt(struct amdgpu\_device \*adev,  static int si\_dpm\_late\_init(void \*handle) {+ int ret;+ struct amdgpu\_device \*adev = (struct amdgpu\_device \*)handle;++ if (!adev->pm.dpm\_enabled)+ return 0;++ ret = si\_set\_temperature\_range(adev);+ if (ret)+ return ret;+#if 0 //TODO ?+ si\_dpm\_powergate\_uvd(adev, true);+#endif return 0; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:21:00 +0000

