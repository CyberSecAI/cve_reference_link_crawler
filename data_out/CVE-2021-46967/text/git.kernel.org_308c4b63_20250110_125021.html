

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jason Wang <jasowang@redhat.com> | 2021-04-13 17:15:57 +0800 |
| --- | --- | --- |
| committer | Michael S. Tsirkin <mst@redhat.com> | 2021-05-03 04:55:52 -0400 |
| commit | [3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44)) | |
| tree | [8b83161de05cb4baee183657ea0c5dbf0f051d1b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44) | |
| parent | [526cb8580bc6b9e5bc14cc5d24ecf4633a84cfa1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=526cb8580bc6b9e5bc14cc5d24ecf4633a84cfa1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44&id2=526cb8580bc6b9e5bc14cc5d24ecf4633a84cfa1)) | |
| download | [linux-3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44.tar.gz) | |

vhost-vdpa: fix vm\_flags for virtqueue doorbell mappingThe virtqueue doorbell is usually implemented via registeres but we
don't provide the necessary vma->flags like VM\_PFNMAP. This may cause
several issues e.g when userspace tries to map the doorbell via vhost
IOTLB, kernel may panic due to the page is not backed by page
structure. This patch fixes this by setting the necessary
vm\_flags. With this patch, try to map doorbell via IOTLB will fail
with bad address.
Cc: stable@vger.kernel.org
Fixes: ddd89d0a059d ("vhost\_vdpa: support doorbell mapping via mmap")
Signed-off-by: Jason Wang <jasowang@redhat.com>
Link: [https://lore.kernel.org/r/20210413091557.29008-1-jasowang@redhat.com](https://lore.kernel.org/r/20210413091557.29008-1-jasowang%40redhat.com)
Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44)

| -rw-r--r-- | [drivers/vhost/vdpa.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/vhost/vdpa.c?id=3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/vhost/vdpa.c b/drivers/vhost/vdpa.cindex bfa4c6ef554e58..c79d2f2387aaa2 100644--- a/[drivers/vhost/vdpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/vhost/vdpa.c?id=526cb8580bc6b9e5bc14cc5d24ecf4633a84cfa1)+++ b/[drivers/vhost/vdpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/vhost/vdpa.c?id=3a3e0fad16d40a2aa68ddf7eea4acdf48b22dd44)@@ -993,6 +993,7 @@ static int vhost\_vdpa\_mmap(struct file \*file, struct vm\_area\_struct \*vma) if (vma->vm\_end - vma->vm\_start != notify.size) return -ENOTSUPP; + vma->vm\_flags |= VM\_IO | VM\_PFNMAP | VM\_DONTEXPAND | VM\_DONTDUMP; vma->vm\_ops = &vhost\_vdpa\_vm\_ops; return 0; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 12:48:59 +0000

