=== Content from github.com_2841b997_20250111_192044.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flouislam%2Fuptime-kuma%2Fsecurity%2Fadvisories%2FGHSA-88j4-pcx8-q4q3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flouislam%2Fuptime-kuma%2Fsecurity%2Fadvisories%2FGHSA-88j4-pcx8-q4q3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=louislam%2Fuptime-kuma)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[louislam](/louislam)
/
**[uptime-kuma](/louislam/uptime-kuma)**
Public

* [Notifications](/login?return_to=%2Flouislam%2Fuptime-kuma) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Flouislam%2Fuptime-kuma)
* [Star
   62.4k](/login?return_to=%2Flouislam%2Fuptime-kuma)

* [Code](/louislam/uptime-kuma)
* [Issues
  667](/louislam/uptime-kuma/issues)
* [Pull requests
  100](/louislam/uptime-kuma/pulls)
* [Actions](/louislam/uptime-kuma/actions)
* [Wiki](/louislam/uptime-kuma/wiki)
* [Security](/louislam/uptime-kuma/security)
* [Insights](/louislam/uptime-kuma/pulse)

Additional navigation options

* [Code](/louislam/uptime-kuma)
* [Issues](/louislam/uptime-kuma/issues)
* [Pull requests](/louislam/uptime-kuma/pulls)
* [Actions](/louislam/uptime-kuma/actions)
* [Wiki](/louislam/uptime-kuma/wiki)
* [Security](/louislam/uptime-kuma/security)
* [Insights](/louislam/uptime-kuma/pulse)

# Changing Password does not close all logged in socket connections immediately

Moderate

[louislam](/louislam)
published
GHSA-88j4-pcx8-q4q3
Dec 10, 2023

## Package

docker

louislam/dockge
([Docker](/advisories?query=ecosystem%3Adocker))

## Affected versions

<= 1.3.2

## Patched versions

1.3.3

docker

louislam/uptime-kuma
([Docker](/advisories?query=ecosystem%3Adocker))

<= 1.23.8

1.23.9

npm

louislam/uptime-kuma
([npm](/advisories?query=ecosystem%3Anpm))

<= 1.23.8

1.23.9

## Description

Warning

As is written in our [**security policy**](https://github.com/louislam/uptime-kuma/security/policy), please **DON'T REPORT SECURITY ISSUES TO OUR PUBLIC ISSUE TRACKER**

Posting as [an advisory](https://github.com/louislam/uptime-kuma/security/advisories/new) and then create a [`security`-issue without details](https://github.com/louislam/uptime-kuma/issues/new?assignees=&labels=help&template=security.md) allows us to privately come up with a securty fix without having to scramble and potentialy miss/break something.

These steps were violated in this case, as the issue was first raised as a `bug`-report in issue #4188 [1](#user-content-fn-1-4feab2c4c6a1cd85a55c29cda1c54a2d)

## Overview:

A moderate security vulnerability has been identified in Uptime Kuma platform that poses a significant threat to the confidentiality and integrity of user accounts.

When a user changes their login password in Uptime Kuma, a previously logged-in user retains access without being logged out.

This behaviour persists consistently, even after system restarts or browser restarts.

This vulnerability allows unauthorized access to user accounts, compromising the security of sensitive information.

The same vulnerability was partially fixed in [GHSA-g9v2-wqcj-j99g](https://github.com/louislam/uptime-kuma/security/advisories/GHSA-g9v2-wqcj-j99g "GHSA-g9v2-wqcj-j99g") but logging existing users out of their accounts was forgotten.

## Impact:

The impact of this vulnerability is moderate, as it enables attackers or unauthorized individuals to maintain access to user accounts even after the account password has been changed. This can lead to unauthorized data access, manipulation, or compromise of user accounts, posing a threat to the integrity and confidentiality of Uptime Kuma.

A better impact-analysis is included in [GHSA-g9v2-wqcj-j99g](https://github.com/louislam/uptime-kuma/security/advisories/GHSA-g9v2-wqcj-j99g "GHSA-g9v2-wqcj-j99g")

## PoC

* Change the password for a user account
* Access the platform using the previously logged-in account without logging out
* Note that access (read-write) remains despite the password change
* Expected behaviour:

  After changing the password for a user account, all previously logged-in sessions should be invalidated, requiring users to log in again with the updated credentials.
* Actual behaviour:

  The system retains sessions and never logs out users unless explicitly done by clicking logout.

## Remediation:

To mitigate the risks associated with this vulnerability, we made the server emit a `refresh` event (clients handle this by reloading) and then disconnecting all clients except the one initiating the password change.

It is recommended to Update Uptime Kuma to `>= 1.23.9`.

## Timeline:

| Date | Event |
| --- | --- |
| 2023-12-07 14:35 UTC | [@manoonabbasi](https://github.com/manoonabbasi) discovered and posts this information as a `bug`-report in issue #4188 [1](#user-content-fn-1-4feab2c4c6a1cd85a55c29cda1c54a2d) into our **public issue tracker**, which is [**against our security policy**](https://github.com/louislam/uptime-kuma/security/policy) |
| 2023-12-07 16:50 UTC | The Uptime Kuma team deleted the post in our issue tracker |
| 2023-12-10 18:10 UTC | Uptime Kuma team released patch and this Advisory |

## Footnotes

1. deleted to prevent the spread of this vulnerability without there being a fix available [↩](#user-content-fnref-1-4feab2c4c6a1cd85a55c29cda1c54a2d) [↩2](#user-content-fnref-1-2-4feab2c4c6a1cd85a55c29cda1c54a2d)

### Severity

Moderate

6.7

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
High

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H

### CVE ID

CVE-2023-49804

### Weaknesses

No CWEs

### Credits

* [![@manoonabbasi](https://avatars.githubusercontent.com/u/24836507?s=40&v=4)](/manoonabbasi)
  [manoonabbasi](/manoonabbasi)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ad12d742_20250111_192043.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flouislam%2Fuptime-kuma%2Fcommit%2F482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flouislam%2Fuptime-kuma%2Fcommit%2F482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=louislam%2Fuptime-kuma)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[louislam](/louislam)
/
**[uptime-kuma](/louislam/uptime-kuma)**
Public

* [Notifications](/login?return_to=%2Flouislam%2Fuptime-kuma) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Flouislam%2Fuptime-kuma)
* [Star
   62.4k](/login?return_to=%2Flouislam%2Fuptime-kuma)

* [Code](/louislam/uptime-kuma)
* [Issues
  667](/louislam/uptime-kuma/issues)
* [Pull requests
  100](/louislam/uptime-kuma/pulls)
* [Actions](/louislam/uptime-kuma/actions)
* [Wiki](/louislam/uptime-kuma/wiki)
* [Security](/louislam/uptime-kuma/security)
* [Insights](/louislam/uptime-kuma/pulse)

Additional navigation options

* [Code](/louislam/uptime-kuma)
* [Issues](/louislam/uptime-kuma/issues)
* [Pull requests](/louislam/uptime-kuma/pulls)
* [Actions](/louislam/uptime-kuma/actions)
* [Wiki](/louislam/uptime-kuma/wiki)
* [Security](/louislam/uptime-kuma/security)
* [Insights](/louislam/uptime-kuma/pulse)

## Commit

[Permalink](/louislam/uptime-kuma/commit/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-88j4-pcx8-q4q3](https://github.com/advisories/GHSA-88j4-pcx8-q4q3 "GHSA-88j4-pcx8-q4q3")

[Browse files](/louislam/uptime-kuma/tree/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0)
Browse the repository at this point in the history

```
* WIP, still need to handle npm run reset-password

* Implement it for "npm run reset-password"

Bug fixes and change along with this commit
- Move `ssl`, `hostname`, `port` to ./server/config.js, so `reset-password` is able to read it
- Fix: FBSD is missing, no idea who dropped it.
- Fix: Frontend code should not require any backend code (./server/config.js), moved "badgeConstants" to the common util (./src/util.ts) and drop vite-common.js

* Minor
```

* Loading branch information

[![@louislam](https://avatars.githubusercontent.com/u/1336778?s=40&v=4)](/louislam)

[louislam](/louislam/uptime-kuma/commits?author=louislam "View all commits by louislam")
authored
Dec 10, 2023

1 parent
[2815cc7](/louislam/uptime-kuma/commit/2815cc73cfd9d8ced889e00e72899708220d184f)

commit 482049c

 Show file tree

 Hide file tree

Showing
**16 changed files**
with
**170 additions**
and
**54 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* config

  + config/vite.config.js
    [vite.config.js](#diff-b671f7776a42ef364c71a285b4b2b48735193d29a4f9d98a1e798b7fa96617ac)
* extra

  + extra/healthcheck.js
    [healthcheck.js](#diff-ee9923109e2377a6084a61753be03a75dd172a53849b6bc8d83a8a55ae76d948)
  + extra/reset-password.js
    [reset-password.js](#diff-c9bd4b77275a2a44ea5c6b0aada98597de148152d1e33ff29d93742498ad5c82)
* package.json
  [package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519)
* server

  + server/config.js
    [config.js](#diff-0880dd31651ac76081598388795f229d9c8a319c956ba8c56f3222e389efce13)
  + routers

    - server/routers/api-router.js
      [api-router.js](#diff-849278ac348493d58951cf06748938da32a2bb27da9348d1ee75275eab35fc23)
    - server/routers/status-page-router.js
      [status-page-router.js](#diff-39ce41ced8817f0ca1c67ed3a22420db3474f8ecc8f1edf12e0693b3a6bafad9)
  + server/server.js
    [server.js](#diff-8cf1ffe3788af127768748703e2f15dcfb3a05ffd20b4c2375223637e3260938)
  + socket-handlers

    - server/socket-handlers/general-socket-handler.js
      [general-socket-handler.js](#diff-29c6257e7ece4b1aac2fc54ba12784cd6ad31743e60857154c56bbcec9964697)
  + server/uptime-kuma-server.js
    [uptime-kuma-server.js](#diff-f9e636311cf89101ae5cf3ff3d804ec6b854dd26898f9cd977c558ac73a700ea)
  + server/util-server.js
    [util-server.js](#diff-db80ca2d8e4a84ebee2feeba79ca6283af832cada516abcf1c48772865e15b3f)
* src

  + components

    - src/components/BadgeGeneratorDialog.vue
      [BadgeGeneratorDialog.vue](#diff-1668cb8f5ba9bb915c0cbe3d08ecfae568336c5fd1f2d0b031662d325c9cc7b1)
  + mixins

    - src/mixins/socket.js
      [socket.js](#diff-3c13ec3878646666715d9d93affcdb2959c8fe564eda6cdbe86558e173ed0640)
  + pages

    - src/pages/EditMonitor.vue
      [EditMonitor.vue](#diff-f672603317047f3e6f27b0d7a44f6f244b7dbb5d0d0a85f1059a6b0bc2cb9aa0)
  + src/util.js
    [util.js](#diff-9c0ec1b0a889e599f3ff81590864dd9dc65684a86b41f1da75acc53fafed12e3)
  + src/util.ts
    [util.ts](#diff-3294a832ea2276e554177e0b3007cc2d401c082912c7fbde49fa09141bf1aed1)

## There are no files selected for viewing

2 changes: 0 additions & 2 deletions

2
[config/vite.config.js](#diff-b671f7776a42ef364c71a285b4b2b48735193d29a4f9d98a1e798b7fa96617ac "config/vite.config.js")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/config/vite.config.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,7 +3,6 @@ import vue from "@vitejs/plugin-vue"; |
|  |  | import { defineConfig } from "vite"; |
|  |  | import visualizer from "rollup-plugin-visualizer"; |
|  |  | import viteCompression from "vite-plugin-compression"; |
|  |  | import commonjs from "vite-plugin-commonjs"; |
|  |  |  |
|  |  | const postCssScss = require("postcss-scss"); |
|  |  | const postcssRTLCSS = require("postcss-rtlcss"); |
| Expand All | | @@ -22,7 +21,6 @@ export default defineConfig({ |
|  |  | "CODESPACE\_NAME": JSON.stringify(process.env.CODESPACE\_NAME), |
|  |  | }, |
|  |  | plugins: [ |
|  |  | commonjs(), |
|  |  | vue(), |
|  |  | legacy({ |
|  |  | targets: [ "since 2015" ], |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[extra/healthcheck.js](#diff-ee9923109e2377a6084a61753be03a75dd172a53849b6bc8d83a8a55ae76d948 "extra/healthcheck.js")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/extra/healthcheck.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,7 +6,7 @@ |
|  |  | \* ⚠️ Deprecated: Changed to healthcheck.go, it will be deleted in the future. |
|  |  | \* This script should be run after a period of time (180s), because the server may need some time to prepare. |
|  |  | \*/ |
|  |  | const { FBSD } = require("../server/util-server"); |
|  |  | const FBSD = /^freebsd/.test(process.platform); |
|  |  |  |
|  |  | process.env.NODE\_TLS\_REJECT\_UNAUTHORIZED = "0"; |
|  |  |  |
| Expand Down | |  |

45 changes: 45 additions & 0 deletions

45
[extra/reset-password.js](#diff-c9bd4b77275a2a44ea5c6b0aada98597de148152d1e33ff29d93742498ad5c82 "extra/reset-password.js")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/extra/reset-password.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,6 +5,8 @@ const { R } = require("redbean-node"); |
|  |  | const readline = require("readline"); |
|  |  | const { initJWTSecret } = require("../server/util-server"); |
|  |  | const User = require("../server/model/user"); |
|  |  | const { io } = require("socket.io-client"); |
|  |  | const { localWebSocketURL } = require("../server/config"); |
|  |  | const args = require("args-parser")(process.argv); |
|  |  | const rl = readline.createInterface({ |
|  |  | input: process.stdin, |
| Expand Down  Expand Up | | @@ -36,12 +38,16 @@ const main = async () => { |
|  |  | // Reset all sessions by reset jwt secret |
|  |  | await initJWTSecret(); |
|  |  |  |
|  |  | // Disconnect all other socket clients of the user |
|  |  | await disconnectAllSocketClients(user.username, password); |
|  |  |  |
|  |  | break; |
|  |  | } else { |
|  |  | console.log("Passwords do not match, please try again."); |
|  |  | } |
|  |  | } |
|  |  | console.log("Password reset successfully."); |
|  |  |  |
|  |  | } |
|  |  | } catch (e) { |
|  |  | console.error("Error: " + e.message); |
| Expand All | | @@ -66,6 +72,45 @@ function question(question) { |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | function disconnectAllSocketClients(username, password) { |
|  |  | return new Promise((resolve) => { |
|  |  | console.log("Connecting to " + localWebSocketURL + " to disconnect all other socket clients"); |
|  |  |  |
|  |  | // Disconnect all socket connections |
|  |  | const socket = io(localWebSocketURL, { |
|  |  | transports: [ "websocket" ], |
|  |  | reconnection: false, |
|  |  | timeout: 5000, |
|  |  | }); |
|  |  | socket.on("connect", () => { |
|  |  | socket.emit("login", { |
|  |  | username, |
|  |  | password, |
|  |  | }, (res) => { |
|  |  | if (res.ok) { |
|  |  | console.log("Logged in."); |
|  |  | socket.emit("disconnectOtherSocketClients"); |
|  |  | } else { |
|  |  | console.warn("Login failed."); |
|  |  | console.warn("Please restart the server to disconnect all sessions."); |
|  |  | } |
|  |  | socket.close(); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | socket.on("connect\_error", function () { |
|  |  | // The localWebSocketURL is not guaranteed to be working for some complicated Uptime Kuma setup |
|  |  | // Ask the user to restart the server manually |
|  |  | console.warn("Failed to connect to " + localWebSocketURL); |
|  |  | console.warn("Please restart the server to disconnect all sessions manually."); |
|  |  | resolve(); |
|  |  | }); |
|  |  | socket.on("disconnect", () => { |
|  |  | resolve(); |
|  |  | }); |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | if (!process.env.TEST\_BACKEND) { |
|  |  | main(); |
|  |  | } |
| Expand Down | |  |

1 change: 0 additions & 1 deletion

1
[package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519 "package.json")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/package.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -192,7 +192,6 @@ |
|  |  | "typescript": "~4.4.4", |
|  |  | "v-pagination-3": "~0.1.7", |
|  |  | "vite": "~4.4.1", |
|  |  | "vite-plugin-commonjs": "^0.8.0", |
|  |  | "vite-plugin-compression": "^0.5.1", |
|  |  | "vue": "~3.3.4", |
|  |  | "vue-chartjs": "~5.2.0", |
| Expand Down | |  |

55 changes: 34 additions & 21 deletions

55
[server/config.js](#diff-0880dd31651ac76081598388795f229d9c8a319c956ba8c56f3222e389efce13 "server/config.js")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/server/config.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,29 +1,42 @@ |
|  |  | const isFreeBSD = /^freebsd/.test(process.platform); |
|  |  |  |
|  |  | // Interop with browser |
|  |  | const args = (typeof process !== "undefined") ? require("args-parser")(process.argv) : {}; |
|  |  | const demoMode = args["demo"] || false; |
|  |  |  |
|  |  | const badgeConstants = { |
|  |  | naColor: "#999", |
|  |  | defaultUpColor: "#66c20a", |
|  |  | defaultWarnColor: "#eed202", |
|  |  | defaultDownColor: "#c2290a", |
|  |  | defaultPendingColor: "#f8a306", |
|  |  | defaultMaintenanceColor: "#1747f5", |
|  |  | defaultPingColor: "blue", // as defined by badge-maker / shields.io |
|  |  | defaultStyle: "flat", |
|  |  | defaultPingValueSuffix: "ms", |
|  |  | defaultPingLabelSuffix: "h", |
|  |  | defaultUptimeValueSuffix: "%", |
|  |  | defaultUptimeLabelSuffix: "h", |
|  |  | defaultCertExpValueSuffix: " days", |
|  |  | defaultCertExpLabelSuffix: "h", |
|  |  | // Values Come From Default Notification Times |
|  |  | defaultCertExpireWarnDays: "14", |
|  |  | defaultCertExpireDownDays: "7" |
|  |  | }; |
|  |  | // If host is omitted, the server will accept connections on the unspecified IPv6 address (::) when IPv6 is available and the unspecified IPv4 address (0.0.0.0) otherwise. |
|  |  | // Dual-stack support for (::) |
|  |  | // Also read HOST if not FreeBSD, as HOST is a system environment variable in FreeBSD |
|  |  | let hostEnv = isFreeBSD ? null : process.env.HOST; |
|  |  | const hostname = args.host || process.env.UPTIME\_KUMA\_HOST || hostEnv; |
|  |  |  |
|  |  | const port = [ args.port, process.env.UPTIME\_KUMA\_PORT, process.env.PORT, 3001 ] |
|  |  | .map(portValue => parseInt(portValue)) |
|  |  | .find(portValue => !isNaN(portValue)); |
|  |  |  |
|  |  | const sslKey = args["ssl-key"] || process.env.UPTIME\_KUMA\_SSL\_KEY || process.env.SSL\_KEY || undefined; |
|  |  | const sslCert = args["ssl-cert"] || process.env.UPTIME\_KUMA\_SSL\_CERT || process.env.SSL\_CERT || undefined; |
|  |  | const sslKeyPassphrase = args["ssl-key-passphrase"] || process.env.UPTIME\_KUMA\_SSL\_KEY\_PASSPHRASE || process.env.SSL\_KEY\_PASSPHRASE || undefined; |
|  |  |  |
|  |  | const isSSL = sslKey && sslCert; |
|  |  |  |
|  |  | function getLocalWebSocketURL() { |
|  |  | const protocol = isSSL ? "wss" : "ws"; |
|  |  | const host = hostname || "localhost"; |
|  |  | return `${protocol}://${host}:${port}`; |
|  |  | } |
|  |  |  |
|  |  | const localWebSocketURL = getLocalWebSocketURL(); |
|  |  |  |
|  |  | const demoMode = args["demo"] || false; |
|  |  |  |
|  |  | module.exports = { |
|  |  | args, |
|  |  | hostname, |
|  |  | port, |
|  |  | sslKey, |
|  |  | sslCert, |
|  |  | sslKeyPassphrase, |
|  |  | isSSL, |
|  |  | localWebSocketURL, |
|  |  | demoMode, |
|  |  | badgeConstants, |
|  |  | }; |

3 changes: 1 addition & 2 deletions

3
[server/routers/api-router.js](#diff-849278ac348493d58951cf06748938da32a2bb27da9348d1ee75275eab35fc23 "server/routers/api-router.js")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/server/routers/api-router.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,12 +11,11 @@ const { R } = require("redbean-node"); |
|  |  | const apicache = require("../modules/apicache"); |
|  |  | const Monitor = require("../model/monitor"); |
|  |  | const dayjs = require("dayjs"); |
|  |  | const { UP, MAINTENANCE, DOWN, PENDING, flipStatus, log } = require("../../src/util"); |
|  |  | const { UP, MAINTENANCE, DOWN, PENDING, flipStatus, log, badgeConstants } = require("../../src/util"); |
|  |  | const StatusPage = require("../model/status\_page"); |
|  |  | const { UptimeKumaServer } = require("../uptime-kuma-server"); |
|  |  | const { UptimeCacheList } = require("../uptime-cache-list"); |
|  |  | const { makeBadge } = require("badge-maker"); |
|  |  | const { badgeConstants } = require("../config"); |
|  |  | const { Prometheus } = require("../prometheus"); |
|  |  |  |
|  |  | let router = express.Router(); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[server/routers/status-page-router.js](#diff-39ce41ced8817f0ca1c67ed3a22420db3474f8ecc8f1edf12e0693b3a6bafad9 "server/routers/status-page-router.js")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/server/routers/status-page-router.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,7 +5,7 @@ const StatusPage = require("../model/status\_page"); |
|  |  | const { allowDevAllOrigin, sendHttpError } = require("../util-server"); |
|  |  | const { R } = require("redbean-node"); |
|  |  | const Monitor = require("../model/monitor"); |
|  |  | const { badgeConstants } = require("../config"); |
|  |  | const { badgeConstants } = require("../../src/util"); |
|  |  | const { makeBadge } = require("badge-maker"); |
|  |  |  |
|  |  | let router = express.Router(); |
| Expand Down | |  |

16 changes: 6 additions & 10 deletions

16
[server/server.js](#diff-8cf1ffe3788af127768748703e2f15dcfb3a05ffd20b4c2375223637e3260938 "server/server.js")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/server/server.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -81,7 +81,7 @@ const notp = require("notp"); |
|  |  | const base32 = require("thirty-two"); |
|  |  |  |
|  |  | const { UptimeKumaServer } = require("./uptime-kuma-server"); |
|  |  | const server = UptimeKumaServer.getInstance(args); |
|  |  | const server = UptimeKumaServer.getInstance(); |
|  |  | const io = module.exports.io = server.io; |
|  |  | const app = server.app; |
|  |  |  |
| Expand All | | @@ -91,7 +91,7 @@ const Monitor = require("./model/monitor"); |
|  |  | const User = require("./model/user"); |
|  |  |  |
|  |  | log.debug("server", "Importing Settings"); |
|  |  | const { getSettings, setSettings, setting, initJWTSecret, checkLogin, startUnitTest, FBSD, doubleCheckPassword, startE2eTests, shake256, SHAKE256\_LENGTH |
|  |  | const { getSettings, setSettings, setting, initJWTSecret, checkLogin, startUnitTest, doubleCheckPassword, startE2eTests, shake256, SHAKE256\_LENGTH |
|  |  | } = require("./util-server"); |
|  |  |  |
|  |  | log.debug("server", "Importing Notification"); |
| Expand All | | @@ -115,19 +115,13 @@ const passwordHash = require("./password-hash"); |
|  |  | const checkVersion = require("./check-version"); |
|  |  | log.info("server", "Version: " + checkVersion.version); |
|  |  |  |
|  |  | // If host is omitted, the server will accept connections on the unspecified IPv6 address (::) when IPv6 is available and the unspecified IPv4 address (0.0.0.0) otherwise. |
|  |  | // Dual-stack support for (::) |
|  |  | // Also read HOST if not FreeBSD, as HOST is a system environment variable in FreeBSD |
|  |  | let hostEnv = FBSD ? null : process.env.HOST; |
|  |  | let hostname = args.host || process.env.UPTIME\_KUMA\_HOST || hostEnv; |
|  |  | const hostname = config.hostname; |
|  |  |  |
|  |  | if (hostname) { |
|  |  | log.info("server", "Custom hostname: " + hostname); |
|  |  | } |
|  |  |  |
|  |  | const port = [ args.port, process.env.UPTIME\_KUMA\_PORT, process.env.PORT, 3001 ] |
|  |  | .map(portValue => parseInt(portValue)) |
|  |  | .find(portValue => !isNaN(portValue)); |
|  |  | const port = config.port; |
|  |  |  |
|  |  | const disableFrameSameOrigin = !!process.env.UPTIME\_KUMA\_DISABLE\_FRAME\_SAMEORIGIN || args["disable-frame-sameorigin"] || false; |
|  |  | const cloudflaredToken = args["cloudflared-token"] || process.env.UPTIME\_KUMA\_CLOUDFLARED\_TOKEN || undefined; |
| Expand Down  Expand Up | | @@ -1157,6 +1151,8 @@ let needSetup = false; |
|  |  | let user = await doubleCheckPassword(socket, password.currentPassword); |
|  |  | await user.resetPassword(password.newPassword); |
|  |  |  |
|  |  | server.disconnectAllSocketClient(user.id, socket.id); |
|  |  |  |
|  |  | callback({ |
|  |  | ok: true, |
|  |  | msg: "Password has been updated successfully.", |
| Expand Down | |  |

10 changes: 10 additions & 0 deletions

10
[server/socket-handlers/general-socket-handler.js](#diff-29c6257e7ece4b1aac2fc54ba12784cd6ad31743e60857154c56bbcec9964697 "server/socket-handlers/general-socket-handler.js")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/server/socket-handlers/general-socket-handler.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -78,4 +78,14 @@ module.exports.generalSocketHandler = (socket, server) => { |
|  |  | }); |
|  |  | } |
|  |  | }); |
|  |  |  |
|  |  | // Disconnect all other socket clients of the user |
|  |  | socket.on("disconnectOtherSocketClients", async () => { |
|  |  | try { |
|  |  | checkLogin(socket); |
|  |  | server.disconnectAllSocketClients(socket.userID, socket.id); |
|  |  | } catch (e) { |
|  |  | log.warn("disconnectAllSocketClients", e.message); |
|  |  | } |
|  |  | }); |
|  |  | }; |

33 changes: 24 additions & 9 deletions

33
[server/uptime-kuma-server.js](#diff-f9e636311cf89101ae5cf3ff3d804ec6b854dd26898f9cd977c558ac73a700ea "server/uptime-kuma-server.js")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/server/uptime-kuma-server.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,6 +12,7 @@ const { Settings } = require("./settings"); |
|  |  | const dayjs = require("dayjs"); |
|  |  | const childProcessAsync = require("promisify-child-process"); |
|  |  | const path = require("path"); |
|  |  | const { isSSL, sslKey, sslCert, sslKeyPassphrase } = require("./config"); |
|  |  | // DO NOT IMPORT HERE IF THE MODULES USED `UptimeKumaServer.getInstance()`, put at the bottom of this file instead. |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -62,22 +63,17 @@ class UptimeKumaServer { |
|  |  | \*/ |
|  |  | jwtSecret = null; |
|  |  |  |
|  |  | static getInstance(args) { |
|  |  | static getInstance() { |
|  |  | if (UptimeKumaServer.instance == null) { |
|  |  | UptimeKumaServer.instance = new UptimeKumaServer(args); |
|  |  | UptimeKumaServer.instance = new UptimeKumaServer(); |
|  |  | } |
|  |  | return UptimeKumaServer.instance; |
|  |  | } |
|  |  |  |
|  |  | constructor(args) { |
|  |  | // SSL |
|  |  | const sslKey = args["ssl-key"] || process.env.UPTIME\_KUMA\_SSL\_KEY || process.env.SSL\_KEY || undefined; |
|  |  | const sslCert = args["ssl-cert"] || process.env.UPTIME\_KUMA\_SSL\_CERT || process.env.SSL\_CERT || undefined; |
|  |  | const sslKeyPassphrase = args["ssl-key-passphrase"] || process.env.UPTIME\_KUMA\_SSL\_KEY\_PASSPHRASE || process.env.SSL\_KEY\_PASSPHRASE || undefined; |
|  |  |  |
|  |  | constructor() { |
|  |  | log.info("server", "Creating express and socket.io instance"); |
|  |  | this.app = express(); |
|  |  | if (sslKey && sslCert) { |
|  |  | if (isSSL) { |
|  |  | log.info("server", "Server Type: HTTPS"); |
|  |  | this.httpServer = https.createServer({ |
|  |  | key: fs.readFileSync(sslKey), |
| Expand Down  Expand Up | | @@ -422,6 +418,25 @@ class UptimeKumaServer { |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Force connected sockets of a user to refresh and disconnect. |
|  |  | \* Used for resetting password. |
|  |  | \* @param {string} userID |
|  |  | \* @param {string?} currentSocketID |
|  |  | \*/ |
|  |  | disconnectAllSocketClients(userID, currentSocketID = undefined) { |
|  |  | for (const socket of this.io.sockets.sockets.values()) { |
|  |  | if (socket.userID === userID && socket.id !== currentSocketID) { |
|  |  | try { |
|  |  | socket.emit("refresh"); |
|  |  | socket.disconnect(); |
|  |  | } catch (e) { |
|  |  |  |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | module.exports = { |
| Expand Down | |  |

3 changes: 1 addition & 2 deletions

3
[server/util-server.js](#diff-db80ca2d8e4a84ebee2feeba79ca6283af832cada516abcf1c48772865e15b3f "server/util-server.js")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/server/util-server.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,15 +1,14 @@ |
|  |  | const tcpp = require("tcp-ping"); |
|  |  | const ping = require("@louislam/ping"); |
|  |  | const { R } = require("redbean-node"); |
|  |  | const { log, genSecret } = require("../src/util"); |
|  |  | const { log, genSecret, badgeConstants } = require("../src/util"); |
|  |  | const passwordHash = require("./password-hash"); |
|  |  | const { Resolver } = require("dns"); |
|  |  | const childProcess = require("child\_process"); |
|  |  | const iconv = require("iconv-lite"); |
|  |  | const chardet = require("chardet"); |
|  |  | const mqtt = require("mqtt"); |
|  |  | const chroma = require("chroma-js"); |
|  |  | const { badgeConstants } = require("./config"); |
|  |  | const mssql = require("mssql"); |
|  |  | const { Client } = require("pg"); |
|  |  | const postgresConParse = require("pg-connection-string").parse; |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[src/components/BadgeGeneratorDialog.vue](#diff-1668cb8f5ba9bb915c0cbe3d08ecfae568336c5fd1f2d0b031662d325c9cc7b1 "src/components/BadgeGeneratorDialog.vue")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/src/components/BadgeGeneratorDialog.vue)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -135,7 +135,7 @@ |
|  |  | <script lang="ts"> |
|  |  | import { Modal } from "bootstrap"; |
|  |  | import CopyableInput from "./CopyableInput.vue"; |
|  |  | import { default as serverConfig } from "../../server/config.js"; |
|  |  | import { badgeConstants } from "../util.ts"; |
|  |  |  |
|  |  | export default { |
|  |  | components: { |
| Expand Down  Expand Up | | @@ -230,7 +230,7 @@ export default { |
|  |  | "labelColor", |
|  |  | ], |
|  |  | }, |
|  |  | badgeConstants: serverConfig.badgeConstants, |
|  |  | badgeConstants, |
|  |  | }; |
|  |  | }, |
|  |  |  |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[src/mixins/socket.js](#diff-3c13ec3878646666715d9d93affcdb2959c8fe564eda6cdbe86558e173ed0640 "src/mixins/socket.js")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/src/mixins/socket.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -288,6 +288,10 @@ export default { |
|  |  | socket.on("initServerTimezone", () => { |
|  |  | socket.emit("initServerTimezone", dayjs.tz.guess()); |
|  |  | }); |
|  |  |  |
|  |  | socket.on("refresh", () => { |
|  |  | location.reload(); |
|  |  | }); |
|  |  | }, |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

3 changes: 1 addition & 2 deletions

3
[src/pages/EditMonitor.vue](#diff-f672603317047f3e6f27b0d7a44f6f244b7dbb5d0d0a85f1059a6b0bc2cb9aa0 "src/pages/EditMonitor.vue")

Show comments

[View file](/louislam/uptime-kuma/blob/482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0/src/pages/EditMonitor.vue)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -848,9 +848,8 @@ import NotificationDialog from "../components/NotificationDialog.vue"; |
|  |  | import DockerHostDialog from "../components/DockerHostDialog.vue"; |
|  |  | import ProxyDialog from "../components/ProxyDialog.vue"; |
|  |  | import TagsManager from "../components/TagsManager.vue"; |
|  |  | import { genSecret, isDev, MAX\_INTERVAL\_SECOND, MIN\_INTERVAL\_SECOND } from "../util.ts"; |
|  |  | import { genSecret, isDev, MAX\_INTERVAL\_SECOND, MIN\_INTERVAL\_SECOND, sleep } from "../util.ts"; |
|  |  | import { hostNameRegexPattern } from "../util-frontend"; |
|  |  | import { sleep } from "../util"; |
|  |  | import HiddenInput from "../components/HiddenInput.vue"; |
|  |  |  |
|  |  | const toast = useToast(); |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `482049c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flouislam%2Fuptime-kuma%2Fcommit%2F482049c72b3a650c7bc5c26c2f4d57a21c0e0aa0) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3df26b7c_20250111_192044.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flouislam%2Fuptime-kuma%2Fsecurity%2Fadvisories%2FGHSA-g9v2-wqcj-j99g)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flouislam%2Fuptime-kuma%2Fsecurity%2Fadvisories%2FGHSA-g9v2-wqcj-j99g)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=louislam%2Fuptime-kuma)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[louislam](/louislam)
/
**[uptime-kuma](/louislam/uptime-kuma)**
Public

* [Notifications](/login?return_to=%2Flouislam%2Fuptime-kuma) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Flouislam%2Fuptime-kuma)
* [Star
   62.4k](/login?return_to=%2Flouislam%2Fuptime-kuma)

* [Code](/louislam/uptime-kuma)
* [Issues
  667](/louislam/uptime-kuma/issues)
* [Pull requests
  100](/louislam/uptime-kuma/pulls)
* [Actions](/louislam/uptime-kuma/actions)
* [Wiki](/louislam/uptime-kuma/wiki)
* [Security](/louislam/uptime-kuma/security)
* [Insights](/louislam/uptime-kuma/pulse)

Additional navigation options

* [Code](/louislam/uptime-kuma)
* [Issues](/louislam/uptime-kuma/issues)
* [Pull requests](/louislam/uptime-kuma/pulls)
* [Actions](/louislam/uptime-kuma/actions)
* [Wiki](/louislam/uptime-kuma/wiki)
* [Security](/louislam/uptime-kuma/security)
* [Insights](/louislam/uptime-kuma/pulse)

# Persistentent User Sessions

Moderate

[louislam](/louislam)
published
GHSA-g9v2-wqcj-j99g
Oct 9, 2023

## Package

docker

louislam/uptime-kuma
([Docker](/advisories?query=ecosystem%3Adocker))

## Affected versions

<= v1.23.2

## Patched versions

v1.23.3

louislam/uptime-kuma
(Node.js)

<= v1.23.2

v1.23.3

## Description

# Summary

Attackers with access to a users' device can gain persistent account access.

This is caused by missing verification of Session Tokens after password changes and/or elapsed inactivity-periods.

# Details

`uptime-kuma` sets JWT tokens for users after successful authentication.

These tokens have the following design flaws:

* After successful login, a JWT token and it is stored in `sessionStorage` or `localStorage`.

  Which of the two is decided based on the `Remember Me` button.

  The users' token is valid without any time limitation, even after long periods of inactivity.

  This increases the risk of session hijacking if, for example, a user forgets to log off and leaves the PC.
* sessions are only deleted on the client side after a user loggs out, meaning a local attacker could reuse said token with deep system access over the browser
* If a user changes a password
  + any previously logged in clients are not logged out
  + previously issued tokens remained valid forever

These flaws allow user cookies to remain valid even after changing passwords or being inactive, posing a high security risk.

# POC

### Password resets not deactivating cookies

* Log in.
* Note the user cookie.
* Change your password.
* Attempt to log in again with the same cookie.
* The cookie remains valid despite the password change.

### Inactivity not deactivating sessions

In testing, even after a period of over a day of inactivity, the session was still valid

# Impact

Another person with local access to the device could take over the session permanently, even after hours of previous inactivity or a password change.

Such activity would not be obvious to the user (see [#3481](https://github.com/louislam/uptime-kuma/issues/3481) if you want to help with this).

With this gained account access, an attacker can cause:

## confidentially loss

* monitors (including private ones not shared on public status pages)
* notification providers
* settings like `api-keys` (only used for accessing `/metrics`)
* settings like secrets like the `Steam API Key`
* maintenance periods

## availability loss

* by creating a lot of monitors and setting the retention policy very high leading to degraded database performance or out of storage
* by creating a lot of `HTTP(s) - Browser Engine (Chrome/Chromium) (Beta)` leading to RAM exhaustion

## integrity loss

* by the attacker deleting a monitor
* by the attacker deleting a monitor's history
* by the atacker changing the meaning of a monitor (changing where it points)

## scope creep

If operated in some restricted network, access to monitors may provide the ability to change the scope of the attack to a different piece of infrastructure, for example via SQL commands to a database server.

We have not classified this as `changed scope` because credentials stored in the application for accessing other systems are existing valid paths across the trust boundary, and the user should be aware of that.

### Severity

Moderate

6.7

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
High

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H

### CVE ID

CVE-2023-44400

### Weaknesses

[CWE-565](/advisories?query=cwe%3A565) [CWE-602](/advisories?query=cwe%3A602) [CWE-784](/advisories?query=cwe%3A784)

### Credits

* [![@Nansess](https://avatars.githubusercontent.com/u/75940580?s=40&v=4)](/Nansess)
  [Nansess](/Nansess)
  Reporter
* [![@dj4oC](https://avatars.githubusercontent.com/u/115982880?s=40&v=4)](/dj4oC)
  [dj4oC](/dj4oC)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


