=== Content from github.com_68fb582b_20250111_024735.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fcosign%2Fblob%2F9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc%2Fpkg%2Foci%2Fremote%2Fremote.go)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fcosign%2Fblob%2F9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc%2Fpkg%2Foci%2Fremote%2Fremote.go)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=sigstore%2Fcosign)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sigstore](/sigstore)
/
**[cosign](/sigstore/cosign)**
Public

* [Notifications](/login?return_to=%2Fsigstore%2Fcosign) You must be signed in to change notification settings
* [Fork
  552](/login?return_to=%2Fsigstore%2Fcosign)
* [Star
   4.6k](/login?return_to=%2Fsigstore%2Fcosign)

* [Code](/sigstore/cosign)
* [Issues
  233](/sigstore/cosign/issues)
* [Pull requests
  16](/sigstore/cosign/pulls)
* [Discussions](/sigstore/cosign/discussions)
* [Actions](/sigstore/cosign/actions)
* [Projects
  0](/sigstore/cosign/projects)
* [Security](/sigstore/cosign/security)
* [Insights](/sigstore/cosign/pulse)

Additional navigation options

* [Code](/sigstore/cosign)
* [Issues](/sigstore/cosign/issues)
* [Pull requests](/sigstore/cosign/pulls)
* [Discussions](/sigstore/cosign/discussions)
* [Actions](/sigstore/cosign/actions)
* [Projects](/sigstore/cosign/projects)
* [Security](/sigstore/cosign/security)
* [Insights](/sigstore/cosign/pulse)

## Files

 9bc3ee3
## Breadcrumbs

1. [cosign](/sigstore/cosign/tree/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc)
2. /[pkg](/sigstore/cosign/tree/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc/pkg)
3. /[oci](/sigstore/cosign/tree/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc/pkg/oci)
4. /[remote](/sigstore/cosign/tree/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc/pkg/oci/remote)
/
# remote.go

Copy path Blame  Blame
## Latest commit

## History

[History](/sigstore/cosign/commits/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc/pkg/oci/remote/remote.go)282 lines (249 loc) · 8.71 KB 9bc3ee3
## Breadcrumbs

1. [cosign](/sigstore/cosign/tree/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc)
2. /[pkg](/sigstore/cosign/tree/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc/pkg)
3. /[oci](/sigstore/cosign/tree/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc/pkg/oci)
4. /[remote](/sigstore/cosign/tree/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc/pkg/oci/remote)
/
# remote.go

Top
## File metadata and controls

* Code
* Blame

282 lines (249 loc) · 8.71 KB[Raw](https://github.com/sigstore/cosign/raw/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc/pkg/oci/remote/remote.go)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282//// Copyright 2021 The Sigstore Authors.//// Licensed under the Apache License, Version 2.0 (the "License");// you may not use this file except in compliance with the License.// You may obtain a copy of the License at//// http://www.apache.org/licenses/LICENSE-2.0//// Unless required by applicable law or agreed to in writing, software// distributed under the License is distributed on an "AS IS" BASIS,// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.// See the License for the specific language governing permissions and// limitations under the License.
package remote
import ( "errors" "fmt" "io" "net/http"
 "github.com/google/go-containerregistry/pkg/name" v1 "github.com/google/go-containerregistry/pkg/v1" "github.com/google/go-containerregistry/pkg/v1/remote" "github.com/google/go-containerregistry/pkg/v1/remote/transport" "github.com/google/go-containerregistry/pkg/v1/types" ociexperimental "github.com/sigstore/cosign/v2/internal/pkg/oci/remote" "github.com/sigstore/cosign/v2/pkg/oci")
// These enable mocking for unit testing without faking an entire registry.var ( remoteImage = remote.Image remoteIndex = remote.Index remoteGet = remote.Get remoteWrite = remote.Write)
// EntityNotFoundError is the error that SignedEntity returns when the// provided ref does not exist.type EntityNotFoundError struct { baseErr error}
func (e \*EntityNotFoundError) Error() string { return fmt.Sprintf("entity not found in registry, error: %v", e.baseErr)}
func NewEntityNotFoundError(err error) error { return &EntityNotFoundError{ baseErr: err, }}
// SignedEntity provides access to a remote reference, and its signatures.// The SignedEntity will be one of SignedImage or SignedImageIndex.func SignedEntity(ref name.Reference, options ...Option) (oci.SignedEntity, error) { o := makeOptions(ref.Context(), options...)
 got, err := remoteGet(ref, o.ROpt...) var te \*transport.Error if errors.As(err, &te) && te.StatusCode == http.StatusNotFound { return nil, NewEntityNotFoundError(err) } else if err != nil { return nil, err }
 switch got.MediaType { case types.OCIImageIndex, types.DockerManifestList: ii, err := got.ImageIndex() if err != nil { return nil, err } return &index{ v1Index: ii, ref: ref.Context().Digest(got.Digest.String()), opt: o, }, nil
 case types.OCIManifestSchema1, types.DockerManifestSchema2: i, err := got.Image() if err != nil { return nil, err } return &image{ Image: i, opt: o, }, nil
 default: return nil, fmt.Errorf("unknown mime type: %v", got.MediaType) }}
// normalize turns image digests into tags with optional prefix & suffix:// sha256:d34db33f -> [prefix]sha256-d34db33f[.suffix]func normalize(h v1.Hash, prefix string, suffix string) string { return normalizeWithSeparator(h, prefix, suffix, "-")}
// normalizeWithSeparator turns image digests into tags with optional prefix & suffix:// sha256:d34db33f -> [prefix]sha256[algorithmSeparator]d34db33f[.suffix]func normalizeWithSeparator(h v1.Hash, prefix string, suffix string, algorithmSeparator string) string { if suffix == "" { return fmt.Sprint(prefix, h.Algorithm, algorithmSeparator, h.Hex) } return fmt.Sprint(prefix, h.Algorithm, algorithmSeparator, h.Hex, ".", suffix)}
// SignatureTag returns the name.Tag that associated signatures with a particular digest.func SignatureTag(ref name.Reference, opts ...Option) (name.Tag, error) { o := makeOptions(ref.Context(), opts...) return suffixTag(ref, o.SignatureSuffix, "-", o)}
// AttestationTag returns the name.Tag that associated attestations with a particular digest.func AttestationTag(ref name.Reference, opts ...Option) (name.Tag, error) { o := makeOptions(ref.Context(), opts...) return suffixTag(ref, o.AttestationSuffix, "-", o)}
// SBOMTag returns the name.Tag that associated SBOMs with a particular digest.func SBOMTag(ref name.Reference, opts ...Option) (name.Tag, error) { o := makeOptions(ref.Context(), opts...) return suffixTag(ref, o.SBOMSuffix, "-", o)}
// DigestTag returns the name.Tag that associated SBOMs with a particular digest.func DigestTag(ref name.Reference, opts ...Option) (name.Tag, error) { o := makeOptions(ref.Context(), opts...) return suffixTag(ref, "", ":", o)}
// DockerContentDigest fetches the Docker-Content-Digest header for the referenced tag,// which is required to delete the object in registry API v2.3 and greater.// See https://github.com/distribution/distribution/blob/main/docs/content/spec/api.md#deleting-an-image// and https://github.com/distribution/distribution/issues/1579func DockerContentDigest(ref name.Tag, opts ...Option) (name.Tag, error) { o := makeOptions(ref.Context(), opts...) desc, err := remoteGet(ref, o.ROpt...) if err != nil { return name.Tag{}, err } h := desc.Digest return o.TargetRepository.Tag(normalizeWithSeparator(h, o.TagPrefix, "", ":")), nil}
func suffixTag(ref name.Reference, suffix string, algorithmSeparator string, o \*options) (name.Tag, error) { var h v1.Hash if digest, ok := ref.(name.Digest); ok { var err error h, err = v1.NewHash(digest.DigestStr()) if err != nil { // This is effectively impossible. return name.Tag{}, err } } else { desc, err := remoteGet(ref, o.ROpt...) if err != nil { return name.Tag{}, err } h = desc.Digest } return o.TargetRepository.Tag(normalizeWithSeparator(h, o.TagPrefix, suffix, algorithmSeparator)), nil}
// signatures is a shared implementation of the oci.Signed\* Signatures method.func signatures(digestable oci.SignedEntity, o \*options) (oci.Signatures, error) { h, err := digestable.Digest() if err != nil { return nil, err } return Signatures(o.TargetRepository.Tag(normalize(h, o.TagPrefix, o.SignatureSuffix)), o.OriginalOptions...)}
// attestations is a shared implementation of the oci.Signed\* Attestations method.func attestations(digestable oci.SignedEntity, o \*options) (oci.Signatures, error) { h, err := digestable.Digest() if err != nil { return nil, err } return Signatures(o.TargetRepository.Tag(normalize(h, o.TagPrefix, o.AttestationSuffix)), o.OriginalOptions...)}
// attachment is a shared implementation of the oci.Signed\* Attachment method.func attachment(digestable oci.SignedEntity, attName string, o \*options) (oci.File, error) { // Try using OCI 1.1 behavior if file, err := attachmentExperimentalOCI(digestable, attName, o); err == nil { return file, nil }
 h, err := digestable.Digest() if err != nil { return nil, err } img, err := SignedImage(o.TargetRepository.Tag(normalize(h, o.TagPrefix, attName)), o.OriginalOptions...) if err != nil { return nil, err } ls, err := img.Layers() if err != nil { return nil, err } if len(ls) != 1 { return nil, fmt.Errorf("expected exactly one layer in attachment, got %d", len(ls)) }
 return &attached{ SignedImage: img, layer: ls[0], }, nil}
type attached struct { oci.SignedImage layer v1.Layer}
var \_ oci.File = (\*attached)(nil)
// FileMediaType implements oci.Filefunc (f \*attached) FileMediaType() (types.MediaType, error) { return f.layer.MediaType()}
// Payload implements oci.Filefunc (f \*attached) Payload() ([]byte, error) { // remote layers are believed to be stored // compressed, but we don't compress attachments // so use "Compressed" to access the raw byte // stream. rc, err := f.layer.Compressed() if err != nil { return nil, err } defer rc.Close() return io.ReadAll(rc)}
// attachmentExperimentalOCI is a shared implementation of the oci.Signed\* Attachment method (for OCI 1.1+ behavior).func attachmentExperimentalOCI(digestable oci.SignedEntity, attName string, o \*options) (oci.File, error) { h, err := digestable.Digest() if err != nil { return nil, err } d := o.TargetRepository.Digest(h.String())
 artifactType := ociexperimental.ArtifactType(attName) index, err := Referrers(d, artifactType, o.OriginalOptions...) if err != nil { return nil, err } results := index.Manifests
 numResults := len(results) if numResults == 0 { return nil, fmt.Errorf("unable to locate reference with artifactType %s", artifactType) } else if numResults > 1 { // TODO: if there is more than 1 result.. what does that even mean? // TODO: use ui.Warn fmt.Printf("WARNING: there were a total of %d references with artifactType %s\n", numResults, artifactType) } // TODO: do this smarter using "created" annotations lastResult := results[numResults-1]
 img, err := SignedImage(o.TargetRepository.Digest(lastResult.Digest.String()), o.OriginalOptions...) if err != nil { return nil, err } ls, err := img.Layers() if err != nil { return nil, err } if len(ls) != 1 { return nil, fmt.Errorf("expected exactly one layer in attachment, got %d", len(ls)) } return &attached{ SignedImage: img, layer: ls[0], }, nil}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_dd5be2c5_20250111_024736.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fcosign%2Fcommit%2F629f5f8fa672973503edde75f84dcd984637629e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fcosign%2Fcommit%2F629f5f8fa672973503edde75f84dcd984637629e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sigstore%2Fcosign)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sigstore](/sigstore)
/
**[cosign](/sigstore/cosign)**
Public

* [Notifications](/login?return_to=%2Fsigstore%2Fcosign) You must be signed in to change notification settings
* [Fork
  552](/login?return_to=%2Fsigstore%2Fcosign)
* [Star
   4.6k](/login?return_to=%2Fsigstore%2Fcosign)

* [Code](/sigstore/cosign)
* [Issues
  233](/sigstore/cosign/issues)
* [Pull requests
  16](/sigstore/cosign/pulls)
* [Discussions](/sigstore/cosign/discussions)
* [Actions](/sigstore/cosign/actions)
* [Projects
  0](/sigstore/cosign/projects)
* [Security](/sigstore/cosign/security)
* [Insights](/sigstore/cosign/pulse)

Additional navigation options

* [Code](/sigstore/cosign)
* [Issues](/sigstore/cosign/issues)
* [Pull requests](/sigstore/cosign/pulls)
* [Discussions](/sigstore/cosign/discussions)
* [Actions](/sigstore/cosign/actions)
* [Projects](/sigstore/cosign/projects)
* [Security](/sigstore/cosign/security)
* [Insights](/sigstore/cosign/pulse)

## Commit

[Permalink](/sigstore/cosign/commit/629f5f8fa672973503edde75f84dcd984637629e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fixes for [GHSA-88jx-383q-w4qc](https://github.com/advisories/GHSA-88jx-383q-w4qc "GHSA-88jx-383q-w4qc") and [GHSA-95pr-fxf5-86gv](https://github.com/advisories/GHSA-95pr-fxf5-86gv "GHSA-95pr-fxf5-86gv") ([#3661](https://github.com/sigstore/cosign/pull/3661))

[Browse files](/sigstore/cosign/tree/629f5f8fa672973503edde75f84dcd984637629e)
Browse the repository at this point in the history

```
* Merge pull request from [GHSA-95pr-fxf5-86gv](https://github.com/advisories/GHSA-95pr-fxf5-86gv "GHSA-95pr-fxf5-86gv")

An Image may come from an untrusted source and contain an unknown number
of signatures in the .sig manifest. A common pattern in cosign is to use
the number of signatures as the capacity for a new slice. But this means
the size of the slice is based on an unvalidated external input and
could result in cosign running out of memory.

This change adds validation for certain implementations of the
oci.Signatures Get() method to limit the number of image descriptors
returned. This way, callers can rely on the returned slice of signatures
being a reasonable size to process safely.

The limit is set to 1000, which is a generous size based on the
practical restrictions that container registries set for image manifest
size and approximations of memory allocations for signature layers.

Signed-off-by: Colleen Murphy <colleenmurphy@google.com>

* Merge pull request from [GHSA-88jx-383q-w4qc](https://github.com/advisories/GHSA-88jx-383q-w4qc "GHSA-88jx-383q-w4qc")

When downloading an attestation or SBOM from an external source, check
its size before reading it into memory. This protects the host from
potentially reading a maliciously large attachment into memory and
exhausting the system.

SBOMs can vary widely in size, and there could be legitimate SBOMs of up
to 700MB. However, reading a 700MB SBOM into memory would easily bring
down a small cloud VM. Moreover, most SBOMs are not going to be that
large. This change sets a reasonable default of 128MiB, and allows
overriding the default by setting the environment variable
`COSIGN_MAX_ATTACHMENT_SIZE`.

Signed-off-by: Colleen Murphy <colleenmurphy@google.com>

---------

Signed-off-by: Colleen Murphy <colleenmurphy@google.com>
```

* Loading branch information

[![@haydentherapper](https://avatars.githubusercontent.com/u/8418760?s=40&v=4)](/haydentherapper)

[haydentherapper](/sigstore/cosign/commits?author=haydentherapper "View all commits by haydentherapper")
authored
Apr 10, 2024

1 parent
[302aee6](/sigstore/cosign/commit/302aee6c1648e5a85f77f785ca351f62d573a5e7)

commit 629f5f8

 Show file tree

 Hide file tree

Showing
**22 changed files**
with
**657 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* cmd/cosign/cli/verify

  + cmd/cosign/cli/verify/verify\_blob\_attestation.go
    [verify\_blob\_attestation.go](#diff-34a813630ab05d623a604d4d83742a12ec4ca9f418ffcf34b300435e18b87263)
  + cmd/cosign/cli/verify/verify\_blob\_attestation\_test.go
    [verify\_blob\_attestation\_test.go](#diff-eac0d07b4bd8815024352f9fdac4510f39b1170a8db11cda5b4ea0d2fe73240d)
* go.mod
  [go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6)
* internal/pkg/cosign/payload/size

  + internal/pkg/cosign/payload/size/errors.go
    [errors.go](#diff-3bc5b171fc65bdf263339de80002ca2cb2525836d961c4d984739302686a6358)
  + internal/pkg/cosign/payload/size/size.go
    [size.go](#diff-850026ce125497590c5f3b4fe4b15d30943991eef5c29701e19c7e7c8f2c0ddc)
  + internal/pkg/cosign/payload/size/size\_test.go
    [size\_test.go](#diff-57f39a5312b30e2dcedfac4bd22e5e3cbd6b89a82b6c40c1ecef05a3aced80b8)
* pkg

  + cosign/env

    - pkg/cosign/env/env.go
      [env.go](#diff-eeb5d2e90452ae0b3d8a1e667f13caacac1f60d45c7420af17685cc7f1bf03db)
  + oci

    - pkg/oci/errors.go
      [errors.go](#diff-d6c4f6a89b8bf83fbaf43ce2edec6e7a0d28da48542eeef0603e5167f62ffae6)
    - internal/signature

      * pkg/oci/internal/signature/layer.go
        [layer.go](#diff-c4ed66d915a95e61e64f350a1efbf07a73933d5b5e81e1d2398cc16c81db434c)
      * pkg/oci/internal/signature/layer\_test.go
        [layer\_test.go](#diff-786a9c1f0b154b21b51ea5609aba11f6213bfe89d5e534e3940708a39114590e)
    - layout

      * pkg/oci/layout/signatures.go
        [signatures.go](#diff-2a9107b0b6c82d21cbc1c5562923c82727edde4c61ad002e1ff9227481697998)
      * pkg/oci/layout/signatures\_test.go
        [signatures\_test.go](#diff-b6c77480476533f0674826315c3c490a63af0c11ffeaf2e3ef38a647db4a0864)
    - mutate

      * pkg/oci/mutate/signatures.go
        [signatures.go](#diff-945ed6c5251d0570ac43fb9b7dd8ae548424fb2813abbb9717ed8ac2e7fd84c9)
      * pkg/oci/mutate/signatures\_test.go
        [signatures\_test.go](#diff-04f4ed5687b75c62ecf922d26c45dc70bbf6519c22b959119d870248d34fdfde)
    - remote

      * pkg/oci/remote/remote.go
        [remote.go](#diff-1060b0e381c5bcd0ba9c4271f554510c370fe4c623e6942b880b9c094f7f1627)
      * pkg/oci/remote/remote\_test.go
        [remote\_test.go](#diff-c943daed1509ddbe783647bb5b2ea5d6f265758233dd5d8ca7297cfc159ac91d)
      * pkg/oci/remote/signatures.go
        [signatures.go](#diff-f03a636c661f4381b2d1e7ec6647dfc24c03b5c1e11d09ff8891f60d41b60cb6)
      * pkg/oci/remote/signatures\_test.go
        [signatures\_test.go](#diff-5c27eebddd5bd5b1ea1aa365293fa9e5360382e76bfbbad523168b79b028c450)
    - signature

      * pkg/oci/signature/layer.go
        [layer.go](#diff-a4859b65c42ca40ac004766c29a8b1279097c2d7909552f77885af38876729c8)
      * pkg/oci/signature/layer\_test.go
        [layer\_test.go](#diff-952b649fb22ef381f26f9261a61c9fb4e0d354f6583b806c253a422e39cabb49)
    - static

      * pkg/oci/static/file.go
        [file.go](#diff-a756c1f58bfc69ade8e6ff1f74f29ffaaf4a817c27e081615691ea04e8804f40)
      * pkg/oci/static/file\_test.go
        [file\_test.go](#diff-ce08d81321e179242fb971a228ea855902c65880818703b64bee4e5487051360)

## There are no files selected for viewing

9 changes: 9 additions & 0 deletions

9
[cmd/cosign/cli/verify/verify\_blob\_attestation.go](#diff-34a813630ab05d623a604d4d83742a12ec4ca9f418ffcf34b300435e18b87263 "cmd/cosign/cli/verify/verify_blob_attestation.go")

Show comments

[View file](/sigstore/cosign/blob/629f5f8fa672973503edde75f84dcd984637629e/cmd/cosign/cli/verify/verify_blob_attestation.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -34,6 +34,7 @@ import ( |
|  |  | "github.com/sigstore/cosign/v2/cmd/cosign/cli/options" |
|  |  | "github.com/sigstore/cosign/v2/cmd/cosign/cli/rekor" |
|  |  | internal "github.com/sigstore/cosign/v2/internal/pkg/cosign" |
|  |  | payloadsize "github.com/sigstore/cosign/v2/internal/pkg/cosign/payload/size" |
|  |  | "github.com/sigstore/cosign/v2/internal/pkg/cosign/tsa" |
|  |  | "github.com/sigstore/cosign/v2/pkg/blob" |
|  |  | "github.com/sigstore/cosign/v2/pkg/cosign" |
| Expand Down  Expand Up | | @@ -117,6 +118,14 @@ func (c \*VerifyBlobAttestationCommand) Exec(ctx context.Context, artifactPath st |
|  |  | return err |
|  |  | } |
|  |  | defer f.Close() |
|  |  | fileInfo, err := f.Stat() |
|  |  | if err != nil { |
|  |  | return err |
|  |  | } |
|  |  | err = payloadsize.CheckSize(uint64(fileInfo.Size())) |
|  |  | if err != nil { |
|  |  | return err |
|  |  | } |
|  |  |  |
|  |  | payload = internal.NewHashReader(f, sha256.New()) |
|  |  | if \_, err := io.ReadAll(&payload); err != nil { |
| Expand Down | |  |

12 changes: 12 additions & 0 deletions

12
[cmd/cosign/cli/verify/verify\_blob\_attestation\_test.go](#diff-eac0d07b4bd8815024352f9fdac4510f39b1170a8db11cda5b4ea0d2fe73240d "cmd/cosign/cli/verify/verify_blob_attestation_test.go")

Show comments

[View file](/sigstore/cosign/blob/629f5f8fa672973503edde75f84dcd984637629e/cmd/cosign/cli/verify/verify_blob_attestation_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,7 @@ gZPFIp557+TOoDxf14FODWc+sIPETk0OgCplAk60doVXbCv33IU4rXZHrg== |
|  |  | const ( |
|  |  | blobContents = "some-payload" |
|  |  | anotherBlobContents = "another-blob" |
|  |  | hugeBlobContents = "hugepayloadhugepayloadhugepayloadhugepayloadhugepayloadhugepayloadhugepayloadhugepayloadhugepayloadhugepayloadhugepayloadhugepayloadhugepayload" |
|  |  | blobSLSAProvenanceSignature = "eyJwYXlsb2FkVHlwZSI6ImFwcGxpY2F0aW9uL3ZuZC5pbi10b3RvK2pzb24iLCJwYXlsb2FkIjoiZXlKZmRIbHdaU0k2SW1oMGRIQnpPaTh2YVc0dGRHOTBieTVwYnk5VGRHRjBaVzFsYm5RdmRqQXVNU0lzSW5CeVpXUnBZMkYwWlZSNWNHVWlPaUpvZEhSd2N6b3ZMM05zYzJFdVpHVjJMM0J5YjNabGJtRnVZMlV2ZGpBdU1pSXNJbk4xWW1wbFkzUWlPbHQ3SW01aGJXVWlPaUppYkc5aUlpd2laR2xuWlhOMElqcDdJbk5vWVRJMU5pSTZJalkxT0RjNE1XTmtOR1ZrT1dKallUWXdaR0ZqWkRBNVpqZGlZamt4TkdKaU5URTFNREpsT0dJMVpEWXhPV1kxTjJZek9XRXhaRFkxTWpVNU5tTmpNalFpZlgxZExDSndjbVZrYVdOaGRHVWlPbnNpWW5WcGJHUmxjaUk2ZXlKcFpDSTZJaklpZlN3aVluVnBiR1JVZVhCbElqb2llQ0lzSW1sdWRtOWpZWFJwYjI0aU9uc2lZMjl1Wm1sblUyOTFjbU5sSWpwN2ZYMTlmUT09Iiwic2lnbmF0dXJlcyI6W3sia2V5aWQiOiIiLCJzaWciOiJNRVVDSUE4S2pacWtydDkwZnpCb2pTd3d0ajNCcWI0MUU2cnV4UWs5N1RMbnB6ZFlBaUVBek9Bak9Uenl2VEhxYnBGREFuNnpocmc2RVp2N2t4SzVmYVJvVkdZTWgyYz0ifV19" |
|  |  | dssePredicateEmptySubject = "eyJwYXlsb2FkVHlwZSI6ImFwcGxpY2F0aW9uL3ZuZC5pbi10b3RvK2pzb24iLCJwYXlsb2FkIjoiZXlKZmRIbHdaU0k2SW1oMGRIQnpPaTh2YVc0dGRHOTBieTVwYnk5VGRHRjBaVzFsYm5RdmRqQXVNU0lzSW5CeVpXUnBZMkYwWlZSNWNHVWlPaUpvZEhSd2N6b3ZMM05zYzJFdVpHVjJMM0J5YjNabGJtRnVZMlV2ZGpBdU1pSXNJbk4xWW1wbFkzUWlPbHRkTENKd2NtVmthV05oZEdVaU9uc2lZblZwYkdSbGNpSTZleUpwWkNJNklqSWlmU3dpWW5WcGJHUlVlWEJsSWpvaWVDSXNJbWx1ZG05allYUnBiMjRpT25zaVkyOXVabWxuVTI5MWNtTmxJanA3ZlgxOWZRPT0iLCJzaWduYXR1cmVzIjpbeyJrZXlpZCI6IiIsInNpZyI6Ik1FWUNJUUNrTEV2NkhZZ0svZDdUK0N3NTdXbkZGaHFUTC9WalAyVDA5Q2t1dk1nbDRnSWhBT1hBM0lhWWg1M1FscVk1eVU4cWZxRXJma2tGajlEakZnaWovUTQ2NnJSViJ9XX0=" |
|  |  | dssePredicateMissingSha256 = "eyJwYXlsb2FkVHlwZSI6ImFwcGxpY2F0aW9uL3ZuZC5pbi10b3RvK2pzb24iLCJwYXlsb2FkIjoiZXlKZmRIbHdaU0k2SW1oMGRIQnpPaTh2YVc0dGRHOTBieTVwYnk5VGRHRjBaVzFsYm5RdmRqQXVNU0lzSW5CeVpXUnBZMkYwWlZSNWNHVWlPaUpvZEhSd2N6b3ZMM05zYzJFdVpHVjJMM0J5YjNabGJtRnVZMlV2ZGpBdU1pSXNJbk4xWW1wbFkzUWlPbHQ3SW01aGJXVWlPaUppYkc5aUlpd2laR2xuWlhOMElqcDdmWDFkTENKd2NtVmthV05oZEdVaU9uc2lZblZwYkdSbGNpSTZleUpwWkNJNklqSWlmU3dpWW5WcGJHUlVlWEJsSWpvaWVDSXNJbWx1ZG05allYUnBiMjRpT25zaVkyOXVabWxuVTI5MWNtTmxJanA3ZlgxOWZRPT0iLCJzaWduYXR1cmVzIjpbeyJrZXlpZCI6IiIsInNpZyI6Ik1FVUNJQysvM2M4RFo1TGFZTEx6SFZGejE3ZmxHUENlZXVNZ2tIKy8wa2s1cFFLUEFpRUFqTStyYnBBRlJybDdpV0I2Vm9BYVZPZ3U3NjRRM0JKdHI1bHk4VEFHczNrPSJ9XX0=" |
| Expand All | | @@ -46,13 +47,15 @@ func TestVerifyBlobAttestation(t \*testing.T) { |
|  |  |  |
|  |  | blobPath := writeBlobFile(t, td, blobContents, "blob") |
|  |  | anotherBlobPath := writeBlobFile(t, td, anotherBlobContents, "other-blob") |
|  |  | hugeBlobPath := writeBlobFile(t, td, hugeBlobContents, "huge-blob") |
|  |  | keyRef := writeBlobFile(t, td, pubkey, "cosign.pub") |
|  |  |  |
|  |  | tests := []struct { |
|  |  | description string |
|  |  | blobPath string |
|  |  | signature string |
|  |  | predicateType string |
|  |  | env map[string]string |
|  |  | shouldErr bool |
|  |  | }{ |
|  |  | { |
| Expand Down  Expand Up | | @@ -98,11 +101,20 @@ func TestVerifyBlobAttestation(t \*testing.T) { |
|  |  | signature: dssePredicateMultipleSubjectsInvalid, |
|  |  | blobPath: blobPath, |
|  |  | shouldErr: true, |
|  |  | }, { |
|  |  | description: "override file size limit", |
|  |  | signature: blobSLSAProvenanceSignature, |
|  |  | blobPath: hugeBlobPath, |
|  |  | env: map[string]string{"COSIGN\_MAX\_ATTACHMENT\_SIZE": "128"}, |
|  |  | shouldErr: true, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | for \_, test := range tests { |
|  |  | t.Run(test.description, func(t \*testing.T) { |
|  |  | for k, v := range test.env { |
|  |  | t.Setenv(k, v) |
|  |  | } |
|  |  | decodedSig, err := base64.StdEncoding.DecodeString(test.signature) |
|  |  | if err != nil { |
|  |  | t.Fatal(err) |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6 "go.mod")

Show comments

[View file](/sigstore/cosign/blob/629f5f8fa672973503edde75f84dcd984637629e/go.mod)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ require ( |
|  |  | github.com/cyberphone/json-canonicalization v0.0.0-20231011164504-785e29786b46 |
|  |  | github.com/depcheck-test/depcheck-test v0.0.0-20220607135614-199033aaa936 |
|  |  | github.com/digitorus/timestamp v0.0.0-20231217203849-220c5c2851b7 |
|  |  | github.com/dustin/go-humanize v1.0.1 |
|  |  | github.com/go-openapi/runtime v0.28.0 |
|  |  | github.com/go-openapi/strfmt v0.23.0 |
|  |  | github.com/go-openapi/swag v0.23.0 |
| Expand Down | |  |

31 changes: 31 additions & 0 deletions

31
[internal/pkg/cosign/payload/size/errors.go](#diff-3bc5b171fc65bdf263339de80002ca2cb2525836d961c4d984739302686a6358 "internal/pkg/cosign/payload/size/errors.go")

Show comments

[View file](/sigstore/cosign/blob/629f5f8fa672973503edde75f84dcd984637629e/internal/pkg/cosign/payload/size/errors.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,31 @@ |
|  |  | // Copyright 2024 The Sigstore Authors. |
|  |  | // |
|  |  | // Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | // you may not use this file except in compliance with the License. |
|  |  | // You may obtain a copy of the License at |
|  |  | // |
|  |  | // http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | // |
|  |  | // Unless required by applicable law or agreed to in writing, software |
|  |  | // distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | // See the License for the specific language governing permissions and |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | package payload |
|  |  |  |
|  |  | import "fmt" |
|  |  |  |
|  |  | // MaxLayerSizeExceeded is an error indicating that the layer is too big to read into memory and cosign should abort processing it. |
|  |  | type MaxLayerSizeExceeded struct { |
|  |  | value uint64 |
|  |  | maximum uint64 |
|  |  | } |
|  |  |  |
|  |  | func NewMaxLayerSizeExceeded(value, maximum uint64) \*MaxLayerSizeExceeded { |
|  |  | return &MaxLayerSizeExceeded{value, maximum} |
|  |  | } |
|  |  |  |
|  |  | func (e \*MaxLayerSizeExceeded) Error() string { |
|  |  | return fmt.Sprintf("size of layer (%d) exceeded the limit (%d)", e.value, e.maximum) |
|  |  | } |

38 changes: 38 additions & 0 deletions

38
[internal/pkg/cosign/payload/size/size.go](#diff-850026ce125497590c5f3b4fe4b15d30943991eef5c29701e19c7e7c8f2c0ddc "internal/pkg/cosign/payload/size/size.go")

Show comments

[View file](/sigstore/cosign/blob/629f5f8fa672973503edde75f84dcd984637629e/internal/pkg/cosign/payload/size/size.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,38 @@ |
|  |  | // Copyright 2024 The Sigstore Authors. |
|  |  | // |
|  |  | // Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | // you may not use this file except in compliance with the License. |
|  |  | // You may obtain a copy of the License at |
|  |  | // |
|  |  | // http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | // |
|  |  | // Unless required by applicable law or agreed to in writing, software |
|  |  | // distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | // See the License for the specific language governing permissions and |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | package payload |
|  |  |  |
|  |  | import ( |
|  |  | "github.com/dustin/go-humanize" |
|  |  | "github.com/sigstore/cosign/v2/pkg/cosign/env" |
|  |  | ) |
|  |  |  |
|  |  | const defaultMaxSize = uint64(134217728) // 128MiB |
|  |  |  |
|  |  | func CheckSize(size uint64) error { |
|  |  | maxSize := defaultMaxSize |
|  |  | maxSizeOverride, exists := env.LookupEnv(env.VariableMaxAttachmentSize) |
|  |  | if exists { |
|  |  | var err error |
|  |  | maxSize, err = humanize.ParseBytes(maxSizeOverride) |
|  |  | if err != nil { |
|  |  | maxSize = defaultMaxSize |
|  |  | } |
|  |  | } |
|  |  | if size > maxSize { |
|  |  | return NewMaxLayerSizeExceeded(size, maxSize) |
|  |  | } |
|  |  | return nil |
|  |  | } |

110 changes: 110 additions & 0 deletions

110
[internal/pkg/cosign/payload/size/size\_test.go](#diff-57f39a5312b30e2dcedfac4bd22e5e3cbd6b89a82b6c40c1ecef05a3aced80b8 "internal/pkg/cosign/payload/size/size_test.go")

Show comments

[View file](/sigstore/cosign/blob/629f5f8fa672973503edde75f84dcd984637629e/internal/pkg/cosign/payload/size/size_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,110 @@ |
|  |  | // Copyright 2024 The Sigstore Authors. |
|  |  | // |
|  |  | // Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | // you may not use this file except in compliance with the License. |
|  |  | // You may obtain a copy of the License at |
|  |  | // |
|  |  | // http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | // |
|  |  | // Unless required by applicable law or agreed to in writing, software |
|  |  | // distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | // See the License for the specific language governing permissions and |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | package payload |
|  |  |  |
|  |  | import ( |
|  |  | "testing" |
|  |  | ) |
|  |  |  |
|  |  | func TestCheckSize(t \*testing.T) { |
|  |  | tests := []struct { |
|  |  | name string |
|  |  | input uint64 |
|  |  | setting string |
|  |  | wantErr bool |
|  |  | }{ |
|  |  | { |
|  |  | name: "size is within default limit", |
|  |  | input: 1000, |
|  |  | wantErr: false, |
|  |  | }, |
|  |  | { |
|  |  | name: "size exceeds default limit", |
|  |  | input: 200000000, |
|  |  | wantErr: true, |
|  |  | }, |
|  |  | { |
|  |  | name: "size is within overridden limit (bytes)", |
|  |  | input: 1000, |
|  |  | setting: "1024", |
|  |  | wantErr: false, |
|  |  | }, |
|  |  | { |
|  |  | name: "size is exceeds overridden limit (bytes)", |
|  |  | input: 2000, |
|  |  | setting: "1024", |
|  |  | wantErr: true, |
|  |  | }, |
|  |  | { |
|  |  | name: "size is within overridden limit (megabytes, short form)", |
|  |  | input: 1999999, |
|  |  | setting: "2M", |
|  |  | wantErr: false, |
|  |  | }, |
|  |  | { |
|  |  | name: "size exceeds overridden limit (megabytes, short form)", |
|  |  | input: 2000001, |
|  |  | setting: "2M", |
|  |  | wantErr: true, |
|  |  | }, |
|  |  | { |
|  |  | name: "size is within overridden limit (megabytes, long form)", |
|  |  | input: 1999999, |
|  |  | setting: "2MB", |
|  |  | wantErr: false, |
|  |  | }, |
|  |  | { |
|  |  | name: "size exceeds overridden limit (megabytes, long form)", |
|  |  | input: 2000001, |
|  |  | setting: "2MB", |
|  |  | wantErr: true, |
|  |  | }, |
|  |  | { |
|  |  | name: "size is within overridden limit (mebibytes)", |
|  |  | input: 2097151, |
|  |  | setting: "2MiB", |
|  |  | wantErr: false, |
|  |  | }, |
|  |  | { |
|  |  | name: "size exceeds overridden limit (mebibytes)", |
|  |  | input: 2097153, |
|  |  | setting: "2MiB", |
|  |  | wantErr: true, |
|  |  | }, |
|  |  | { |
|  |  | name: "size is negative results in default", |
|  |  | input: 5121, |
|  |  | setting: "-5KiB", |
|  |  | wantErr: false, |
|  |  | }, |
|  |  | { |
|  |  | name: "invalid setting results in default", |
|  |  | input: 5121, |
|  |  | setting: "five kilobytes", |
|  |  | wantErr: false, |
|  |  | }, |
|  |  | } |
|  |  | for \_, test := range tests { |
|  |  | t.Run(test.name, func(t \*testing.T) { |
|  |  | if test.setting != "" { |
|  |  | t.Setenv("COSIGN\_MAX\_ATTACHMENT\_SIZE", test.setting) |
|  |  | } |
|  |  | got := CheckSize(test.input) |
|  |  | if (got != nil) != (test.wantErr) { |
|  |  | t.Errorf("CheckSize() = %v, expected %v", got, test.wantErr) |
|  |  | } |
|  |  | }) |
|  |  | } |
|  |  | } |

6 changes: 6 additions & 0 deletions

6
[pkg/cosign/env/env.go](#diff-eeb5d2e90452ae0b3d8a1e667f13caacac1f60d45c7420af17685cc7f1bf03db "pkg/cosign/env/env.go")

Show comments

[View file](/sigstore/cosign/blob/629f5f8fa672973503edde75f84dcd984637629e/pkg/cosign/env/env.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,6 +51,7 @@ const ( |
|  |  | VariablePKCS11ModulePath Variable = "COSIGN\_PKCS11\_MODULE\_PATH" |
|  |  | VariablePKCS11IgnoreCertificate Variable = "COSIGN\_PKCS11\_IGNORE\_CERTIFICATE" |
|  |  | VariableRepository Variable = "COSIGN\_REPOSITORY" |
|  |  | VariableMaxAttachmentSize Variable = "COSIGN\_MAX\_ATTACHMENT\_SIZE" |
|  |  |  |
|  |  | // Sigstore environment variables |
|  |  | VariableSigstoreCTLogPublicKeyFile Variable = "SIGSTORE\_CT\_LOG\_PUBLIC\_KEY\_FILE" |
| Expand Down  Expand Up | | @@ -113,6 +114,11 @@ var ( |
|  |  | Expects: "string with a repository", |
|  |  | Sensitive: false, |
|  |  | }, |
|  |  | VariableMaxAttachmentSize: { |
|  |  | Description: "maximum attachment size to download (default 128MiB)", |
|  |  | Expects: "human-readable unit of memory, e.g. 5120, 20K, 3M, 45MiB, 1GB", |
|  |  | Sensitive: false, |
|  |  | }, |
|  |  |  |
|  |  | VariableSigstoreCTLogPublicKeyFile: { |
|  |  | Description: "overrides what is used to validate the SCT coming back from Fulcio", |
| Expand Down | |  |

31 changes: 31 additions & 0 deletions

31
[pkg/oci/errors.go](#diff-d6c4f6a89b8bf83fbaf43ce2edec6e7a0d28da48542eeef0603e5167f62ffae6 "pkg/oci/errors.go")

Show comments

[View file](/sigstore/cosign/blob/629f5f8fa672973503edde75f84dcd984637629e/pkg/oci/errors.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,31 @@ |
|  |  | // Copyright 2024 The Sigstore Authors. |
|  |  | // |
|  |  | // Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | // you may not use this file except in compliance with the License. |
|  |  | // You may obtain a copy of the License at |
|  |  | // |
|  |  | // http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | // |
|  |  | // Unless required by applicable law or agreed to in writing, software |
|  |  | // distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | // See the License for the specific language governing permissions and |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | package oci |
|  |  |  |
|  |  | import "fmt" |
|  |  |  |
|  |  | // MaxLayersExceeded is an error indicating that the artifact has too many layers and cosign should abort processing it. |
|  |  | type MaxLayersExceeded struct { |
|  |  | value int64 |
|  |  | maximum int64 |
|  |  | } |
|  |  |  |
|  |  | func NewMaxLayersExceeded(value, maximum int64) \*MaxLayersExceeded { |
|  |  | return &MaxLayersExceeded{value, maximum} |
|  |  | } |
|  |  |  |
|  |  | func (e \*MaxLayersExceeded) Error() string { |
|  |  | return fmt.Sprintf("number of layers (%d) exceeded the limit (%d)", e.value, e.maximum) |
|  |  | } |

9 changes: 9 additions & 0 deletions

9
[pkg/oci/internal/signature/layer.go](#diff-c4ed66d915a95e61e64f350a1efbf07a73933d5b5e81e1d2398cc16c81db434c "pkg/oci/internal/signature/layer.go")

Show comments

[View file](/sigstore/cosign/blob/629f5f8fa672973503edde75f84dcd984637629e/pkg/oci/internal/signature/layer.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -24,6 +24,7 @@ import ( |
|  |  | "strings" |
|  |  |  |
|  |  | v1 "github.com/google/go-containerregistry/pkg/v1" |
|  |  | payloadsize "github.com/sigstore/cosign/v2/internal/pkg/cosign/payload/size" |
|  |  | "github.com/sigstore/cosign/v2/pkg/cosign/bundle" |
|  |  | "github.com/sigstore/cosign/v2/pkg/oci" |
|  |  | "github.com/sigstore/sigstore/pkg/cryptoutils" |
| Expand Down  Expand Up | | @@ -58,6 +59,14 @@ func (s \*sigLayer) Annotations() (map[string]string, error) { |
|  |  |  |
|  |  | // Payload implements oci.Signature |
|  |  | func (s \*sigLayer) Payload() ([]byte, error) { |
|  |  | size, err := s.Layer.Size() |
|  |  | if err != nil { |
|  |  | return nil, err |
|  |  | } |
|  |  | err = payloadsize.CheckSize(uint64(size)) |
|  |  | if err != nil { |
|  |  | return nil, err |
|  |  | } |
|  |  | // Compressed is a misnomer here, we just want the raw bytes from the registry. |
|  |  | r, err := s.Layer.Compressed() |
|  |  | if err != nil { |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `629f5f8`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fcosign%2Fcommit%2F629f5f8fa672973503edde75f84dcd984637629e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_edff196c_20250111_024737.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fcosign%2Freleases%2Ftag%2Fv2.2.4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fcosign%2Freleases%2Ftag%2Fv2.2.4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=sigstore%2Fcosign)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sigstore](/sigstore)
/
**[cosign](/sigstore/cosign)**
Public

* [Notifications](/login?return_to=%2Fsigstore%2Fcosign) You must be signed in to change notification settings
* [Fork
  552](/login?return_to=%2Fsigstore%2Fcosign)
* [Star
   4.6k](/login?return_to=%2Fsigstore%2Fcosign)

* [Code](/sigstore/cosign/tree/v2.2.4)
* [Issues
  233](/sigstore/cosign/issues)
* [Pull requests
  16](/sigstore/cosign/pulls)
* [Discussions](/sigstore/cosign/discussions)
* [Actions](/sigstore/cosign/actions)
* [Projects
  0](/sigstore/cosign/projects)
* [Security](/sigstore/cosign/security)
* [Insights](/sigstore/cosign/pulse)

Additional navigation options

* [Code](/sigstore/cosign/tree/v2.2.4)
* [Issues](/sigstore/cosign/issues)
* [Pull requests](/sigstore/cosign/pulls)
* [Discussions](/sigstore/cosign/discussions)
* [Actions](/sigstore/cosign/actions)
* [Projects](/sigstore/cosign/projects)
* [Security](/sigstore/cosign/security)
* [Insights](/sigstore/cosign/pulse)

1. [Releases](/sigstore/cosign/releases)
2. [v2.2.4](/sigstore/cosign/releases/tag/v2.2.4)

# v2.2.4

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/sigstore/cosign/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.2.4)

 Loading

[View all tags](/sigstore/cosign/tags)

![@sigstore-bot](https://avatars.githubusercontent.com/u/86837369?s=40&v=4)
[sigstore-bot](/sigstore-bot)
released this
10 Apr 22:12

·
[194 commits](/sigstore/cosign/compare/v2.2.4...main)
to main
since this release

[v2.2.4](/sigstore/cosign/tree/v2.2.4)

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/8418760?s=64&v=4)](/haydentherapper)
[haydentherapper](/haydentherapper)
Hayden B

SSH Key Fingerprint: 6/0oHTP4fxv/vPNr+1uBw4QqCd+1xm9QTOEUXtpKGvs
[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`fb651b4`](/sigstore/cosign/commit/fb651b4ddd8176bd81756fca2d988dd8611f514d)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.

GPG key ID: B5690EEEBB952194

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

# v2.2.4

## Bug Fixes

* Fixes for [GHSA-88jx-383q-w4qc](https://github.com/advisories/GHSA-88jx-383q-w4qc "GHSA-88jx-383q-w4qc") and [GHSA-95pr-fxf5-86gv](https://github.com/advisories/GHSA-95pr-fxf5-86gv "GHSA-95pr-fxf5-86gv") ([#3661](https://github.com/sigstore/cosign/pull/3661))
* ErrNoSignaturesFound should be used when there is no signature attached to an image. ([#3526](https://github.com/sigstore/cosign/pull/3526))
* fix semgrep issues for dgryski.semgrep-go ruleset ([#3541](https://github.com/sigstore/cosign/pull/3541))
* Honor creation timestamp for signatures again ([#3549](https://github.com/sigstore/cosign/pull/3549))

## Features

* Adds Support for Fulcio Client Credentials Flow, and Argument to Set Flow Explicitly ([#3578](https://github.com/sigstore/cosign/pull/3578))

## Documentation

* add oci bundle spec ([#3622](https://github.com/sigstore/cosign/pull/3622))
* Correct help text of triangulate cmd ([#3551](https://github.com/sigstore/cosign/pull/3551))
* Correct help text of verify-attestation policy argument ([#3527](https://github.com/sigstore/cosign/pull/3527))
* feat: add OVHcloud MPR registry tested with cosign ([#3639](https://github.com/sigstore/cosign/pull/3639))

## Testing

* Refactor e2e-tests.yml workflow ([#3627](https://github.com/sigstore/cosign/pull/3627))
* Clean up and clarify e2e scripts ([#3628](https://github.com/sigstore/cosign/pull/3628))
* Don't ignore transparency log in tests if possible ([#3528](https://github.com/sigstore/cosign/pull/3528))
* Make E2E tests hermetic ([#3499](https://github.com/sigstore/cosign/pull/3499))
* add e2e test for pkcs11 token signing ([#3495](https://github.com/sigstore/cosign/pull/3495))

**Full Changelog**: [v2.2.3...v2.2.4](https://github.com/sigstore/cosign/compare/v2.2.3...v2.2.4)

 Assets
115

 Loading

 👍
2
 stevleibelt and agners reacted with thumbs up emoji
 🚀
1
 agners reacted with rocket emoji

All reactions

* 👍
  2 reactions
* 🚀
  1 reaction

 2 people reacted

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5b48f4f1_20250111_024734.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fgo-containerregistry%2Fblob%2Fa0658aa1d0cc7a7f1bcc4a3af9155335b6943f40%2Fpkg%2Fv1%2Fremote%2Flayer.go)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fgo-containerregistry%2Fblob%2Fa0658aa1d0cc7a7f1bcc4a3af9155335b6943f40%2Fpkg%2Fv1%2Fremote%2Flayer.go)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=google%2Fgo-containerregistry)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[google](/google)
/
**[go-containerregistry](/google/go-containerregistry)**
Public

* [Notifications](/login?return_to=%2Fgoogle%2Fgo-containerregistry) You must be signed in to change notification settings
* [Fork
  546](/login?return_to=%2Fgoogle%2Fgo-containerregistry)
* [Star
   3.2k](/login?return_to=%2Fgoogle%2Fgo-containerregistry)

* [Code](/google/go-containerregistry)
* [Issues
  72](/google/go-containerregistry/issues)
* [Pull requests
  38](/google/go-containerregistry/pulls)
* [Actions](/google/go-containerregistry/actions)
* [Projects
  0](/google/go-containerregistry/projects)
* [Security](/google/go-containerregistry/security)
* [Insights](/google/go-containerregistry/pulse)

Additional navigation options

* [Code](/google/go-containerregistry)
* [Issues](/google/go-containerregistry/issues)
* [Pull requests](/google/go-containerregistry/pulls)
* [Actions](/google/go-containerregistry/actions)
* [Projects](/google/go-containerregistry/projects)
* [Security](/google/go-containerregistry/security)
* [Insights](/google/go-containerregistry/pulse)

## Files

 a0658aa
## Breadcrumbs

1. [go-containerregistry](/google/go-containerregistry/tree/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40)
2. /[pkg](/google/go-containerregistry/tree/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40/pkg)
3. /[v1](/google/go-containerregistry/tree/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40/pkg/v1)
4. /[remote](/google/go-containerregistry/tree/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40/pkg/v1/remote)
/
# layer.go

Copy path Blame  Blame
## Latest commit

## History

[History](/google/go-containerregistry/commits/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40/pkg/v1/remote/layer.go)77 lines (67 loc) · 2.39 KB a0658aa
## Breadcrumbs

1. [go-containerregistry](/google/go-containerregistry/tree/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40)
2. /[pkg](/google/go-containerregistry/tree/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40/pkg)
3. /[v1](/google/go-containerregistry/tree/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40/pkg/v1)
4. /[remote](/google/go-containerregistry/tree/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40/pkg/v1/remote)
/
# layer.go

Top
## File metadata and controls

* Code
* Blame

77 lines (67 loc) · 2.39 KB[Raw](https://github.com/google/go-containerregistry/raw/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40/pkg/v1/remote/layer.go)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677// Copyright 2019 Google LLC All Rights Reserved.//// Licensed under the Apache License, Version 2.0 (the "License");// you may not use this file except in compliance with the License.// You may obtain a copy of the License at//// http://www.apache.org/licenses/LICENSE-2.0//// Unless required by applicable law or agreed to in writing, software// distributed under the License is distributed on an "AS IS" BASIS,// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.// See the License for the specific language governing permissions and// limitations under the License.
package remote
import ( "context" "io"
 "github.com/google/go-containerregistry/internal/redact" "github.com/google/go-containerregistry/internal/verify" "github.com/google/go-containerregistry/pkg/name" v1 "github.com/google/go-containerregistry/pkg/v1" "github.com/google/go-containerregistry/pkg/v1/types")
// remoteImagelayer implements partial.CompressedLayertype remoteLayer struct { ctx context.Context fetcher fetcher digest v1.Hash}
// Compressed implements partial.CompressedLayerfunc (rl \*remoteLayer) Compressed() (io.ReadCloser, error) { // We don't want to log binary layers -- this can break terminals. ctx := redact.NewContext(rl.ctx, "omitting binary blobs from logs") return rl.fetcher.fetchBlob(ctx, verify.SizeUnknown, rl.digest)}
// Compressed implements partial.CompressedLayerfunc (rl \*remoteLayer) Size() (int64, error) { resp, err := rl.fetcher.headBlob(rl.ctx, rl.digest) if err != nil { return -1, err } defer resp.Body.Close() return resp.ContentLength, nil}
// Digest implements partial.CompressedLayerfunc (rl \*remoteLayer) Digest() (v1.Hash, error) { return rl.digest, nil}
// MediaType implements v1.Layerfunc (rl \*remoteLayer) MediaType() (types.MediaType, error) { return types.DockerLayer, nil}
// See partial.Exists.func (rl \*remoteLayer) Exists() (bool, error) { return rl.fetcher.blobExists(rl.ctx, rl.digest)}
// Layer reads the given blob reference from a registry as a Layer. A blob// reference here is just a punned name.Digest where the digest portion is the// digest of the blob to be read and the repository portion is the repo where// that blob lives.func Layer(ref name.Digest, options ...Option) (v1.Layer, error) { o, err := makeOptions(options...) if err != nil { return nil, err } return newPuller(o).Layer(o.context, ref)}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2ccabf21_20250111_024737.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fcosign%2Fsecurity%2Fadvisories%2FGHSA-88jx-383q-w4qc)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fcosign%2Fsecurity%2Fadvisories%2FGHSA-88jx-383q-w4qc)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=sigstore%2Fcosign)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sigstore](/sigstore)
/
**[cosign](/sigstore/cosign)**
Public

* [Notifications](/login?return_to=%2Fsigstore%2Fcosign) You must be signed in to change notification settings
* [Fork
  552](/login?return_to=%2Fsigstore%2Fcosign)
* [Star
   4.6k](/login?return_to=%2Fsigstore%2Fcosign)

* [Code](/sigstore/cosign)
* [Issues
  233](/sigstore/cosign/issues)
* [Pull requests
  16](/sigstore/cosign/pulls)
* [Discussions](/sigstore/cosign/discussions)
* [Actions](/sigstore/cosign/actions)
* [Projects
  0](/sigstore/cosign/projects)
* [Security](/sigstore/cosign/security)
* [Insights](/sigstore/cosign/pulse)

Additional navigation options

* [Code](/sigstore/cosign)
* [Issues](/sigstore/cosign/issues)
* [Pull requests](/sigstore/cosign/pulls)
* [Discussions](/sigstore/cosign/discussions)
* [Actions](/sigstore/cosign/actions)
* [Projects](/sigstore/cosign/projects)
* [Security](/sigstore/cosign/security)
* [Insights](/sigstore/cosign/pulse)

# Malicious attachments can cause system-wide denial of service

Moderate

[bobcallaway](/bobcallaway)
published
GHSA-88jx-383q-w4qc
Apr 10, 2024

## Package

gomod

github.com/sigstore/cosign
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

<= 2.2.3

## Patched versions

2.2.4

## Description

### Summary

A remote image with a malicious attachment can cause denial of service of the host machine running Cosign. This can impact other services on the machine that rely on having memory available such as a Redis database which can result in data loss. It can also impact the availability of other services on the machine that will not be available for the duration of the machine denial.

### Details

The root cause of this issue is that Cosign reads the attachment from a remote image entirely into memory without checking the size of the attachment first. As such, a large attachment can make Cosign read a large attachment into memory; If the attachments size is larger than the machine has memory available, the machine will be denied of service. The Go runtime will make a SigKill after a few seconds of system-wide denial.

The root cause is that Cosign reads the contents of the attachments entirely into memory on line 238 below:

[cosign/pkg/oci/remote/remote.go](https://github.com/sigstore/cosign/blob/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc/pkg/oci/remote/remote.go#L228-L239)

Lines 228 to 239
in
[9bc3ee3](/sigstore/cosign/commit/9bc3ee309bf35d2f6e17f5d23f231a3d8bf580bc)

|  | func (f \*attached) Payload() ([]byte, error) { |
| --- | --- |
|  | // remote layers are believed to be stored |
|  | // compressed, but we don't compress attachments |
|  | // so use "Compressed" to access the raw byte |
|  | // stream. |
|  | rc, err := f.layer.Compressed() |
|  | if err != nil { |
|  | return nil, err |
|  | } |
|  | defer rc.Close() |
|  | return io.ReadAll(rc) |
|  | } |

...and prior to that, neither Cosign nor go-containerregistry checks the size of the attachment and enforces a max cap. In the case of a remote layer of `f *attached`, go-containerregistry will invoke this API:

<https://github.com/google/go-containerregistry/blob/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40/pkg/v1/remote/layer.go#L36-L40>

```
func (rl *remoteLayer) Compressed() (io.ReadCloser, error) {
	// We don't want to log binary layers -- this can break terminals.
	ctx := redact.NewContext(rl.ctx, "omitting binary blobs from logs")
	return rl.fetcher.fetchBlob(ctx, verify.SizeUnknown, rl.digest)
}
```

Notice that the second argument to `rl.fetcher.fetchBlob` is `verify.SizeUnknown` which results in not using the `io.LimitReader` in `verify.ReadCloser`:

<https://github.com/google/go-containerregistry/blob/a0658aa1d0cc7a7f1bcc4a3af9155335b6943f40/internal/verify/verify.go#L82-L100>

```
func ReadCloser(r io.ReadCloser, size int64, h v1.Hash) (io.ReadCloser, error) {
	w, err := v1.Hasher(h.Algorithm)
	if err != nil {
		return nil, err
	}
	r2 := io.TeeReader(r, w) // pass all writes to the hasher.
	if size != SizeUnknown {
		r2 = io.LimitReader(r2, size) // if we know the size, limit to that size.
	}
	return &and.ReadCloser{
		Reader: &verifyReader{
			inner:    r2,
			hasher:   w,
			expected: h,
			wantSize: size,
		},
		CloseFunc: r.Close,
	}, nil
}
```
### Impact

This issue can allow a supply-chain escalation from a compromised registry to the Cosign user: If an attacher has compromised a registry or the account of an image vendor, they can include a malicious attachment and hurt the image consumer.

### Remediation

Update to the latest version of Cosign, which limits the number of attachments. An environment variable can override this value.

### Severity

Moderate

4.2

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
High

User interaction
Required

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:H/UI:R/S:U/C:N/I:N/A:H

### CVE ID

CVE-2024-29902

### Weaknesses

No CWEs

### Credits

* [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&v=4)](/AdamKorcz)
  [AdamKorcz](/AdamKorcz)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


