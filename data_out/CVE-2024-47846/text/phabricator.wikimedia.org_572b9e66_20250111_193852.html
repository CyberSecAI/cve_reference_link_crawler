Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT372209)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T372209
# CVE-2024-47846: Special:DeleteCargoTable and Special:SwitchCargoTable have no CSRF protectionClosed, Resolved[Public](/policy/explain/PHID-TASK-xwyoxetknajqeyorhdbe/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/372209/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/372209/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-xwyoxetknajqeyorhdbe/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-xwyoxetknajqeyorhdbe/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-xwyoxetknajqeyorhdbe/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-xwyoxetknajqeyorhdbe/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-xwyoxetknajqeyorhdbe/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-xwyoxetknajqeyorhdbe/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-xwyoxetknajqeyorhdbe/)
* [Protect as security issue](/wmf/escalate-task/372209/)
* [Award Token](/token/give/PHID-TASK-xwyoxetknajqeyorhdbe/)
* [Flag For Later](/flag/edit/PHID-TASK-xwyoxetknajqeyorhdbe/)

Assigned To

|  | [BlankEclair](/p/BlankEclair/) |
| --- | --- |

Authored By

|  | [BlankEclair](/p/BlankEclair/) |
| --- | --- |
| Aug 11 2024, 1:32 AM2024-08-11 01:32:32 (UTC+0) |

Tags

* [Security-Team](/tag/security-team/) [(Watching)](/project/board/1179/)
* [Security](/tag/security/)
* [MediaWiki-extensions-Cargo](/tag/mediawiki-extensions-cargo/) [(Backlog)](/project/board/1029/)
* [Vuln-CSRF](/tag/vuln-csrf/) [(Tracked)](/project/board/907/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
Referenced Files

|  | [F57573802: 2024-10-01\_08-59.png](/F57573802) |
| --- | --- |
| Sep 30 2024, 11:00 PM2024-09-30 23:00:24 (UTC+0) |

|  | [F57573803: 2024-10-01\_08-59\_1.png](/F57573803) |
| --- | --- |
| Sep 30 2024, 11:00 PM2024-09-30 23:00:24 (UTC+0) |

|  | [F57269667: cargo-no-csrf-poc.mp4](/F57269667) |
| --- | --- |
| Aug 12 2024, 4:14 PM2024-08-12 16:14:44 (UTC+0) |

|  | [F57269665: T372209-poc.html](/F57269665) |
| --- | --- |
| Aug 12 2024, 4:14 PM2024-08-12 16:14:44 (UTC+0) |

|  | [F57267189: T372209.patch](/F57267189) |
| --- | --- |
| Aug 11 2024, 11:01 AM2024-08-11 11:01:20 (UTC+0) |

|  | [F57261316: cargo-delete-csrf.mp4](/F57261316) |
| --- | --- |
| Aug 11 2024, 1:32 AM2024-08-11 01:32:32 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [BlankEclair](/p/BlankEclair/) |
| --- | --- |

|  | [sbassett](/p/sbassett/) |
| --- | --- |

|  | [Yaron\_Koren](/p/Yaron_Koren/) |
| --- | --- |

# Description

**Steps to replicate the issue** (include links if applicable):

* Install MediaWiki and Cargo
* Login as an account with (recreatecargodata) and (deletecargodata)
* Save the following into Template:Cargo/deletetest: <noinclude>{{#cargo\_declare: \_table = cargodeletetest}}</noinclude>
* Go to Template:Cargo/deletetest?action=recreatedata and create the table
* CSRF for Special:DeleteCargoTable:
  + Lure the victim to go to Special:DeleteCargoTable/cargodeletetest?delete
* CSRF for Special:SwitchCargoTable:
  + Go to Template:Cargo/deletetest?action=recreatedata again and create the replacement table
  + Lure the victim to go to Special:SwitchCargoTable/cargodeletetest?switch

**What happens?**

The deletion or switch is prevented

**What should have happened instead?**

The deletion or switch happens

**Software version** (on Special:Version page; skip for WMF-hosted wikis like Wikipedia):

* MediaWiki: 1.42.1 ([523b312](/rMW523b3125403801b4db15e7de3d9b55a21d9d03a7)) 15:03, 1 August 2024
* PHP: 8.1.20 (fpm-fcgi)
* MariaDB: 11.4.2-MariaDB
* Cargo: 3.6.1 ([903c36c](/rECRG903c36c0ff7041595088c209359a769fb96884b2)) 19:36, 6 August 2024

**Other information** (browser name/version, screenshots, etc.):

See also: [https://www.mediawiki.org/wiki/Special:MyLanguage/Cross-site\_request\_forgery](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Cross-site_request_forgery)

Screen recording for Special:DeleteCargoTable:

cargo-delete-csrf.mp4485 KB[Download](https://phab.wmfusercontent.org/file/download/fbn4oyi47bte55xm7edm/PHID-FILE-dqyzni4ye3aqgoozyqqo/cargo-delete-csrf.mp4)

# Details

Risk Rating Medium Author Affiliation Wikimedia Communities
# Related Objects

* Mentions

Mentioned In [T368628: Write and send supplementary release announcement for extensions and skins with security patches (1.39.9/1.41.3/1.42.2)](/T368628) Mentioned Here [rMW523b31254038: Update git submodules](/rMW523b3125403801b4db15e7de3d9b55a21d9d03a7)
[rECRG903c36c0ff70: Fix handling of negative numbers in drilldown](/rECRG903c36c0ff7041595088c209359a769fb96884b2)
### Event Timeline

[BlankEclair](/p/BlankEclair/) created this task.[Aug 11 2024, 1:32 AM2024-08-11 01:32:32 (UTC+0)](#10055875)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/6086562/)[Aug 11 2024, 1:32 AM2024-08-11 01:32:36 (UTC+0)](#10055887)[BlankEclair](/p/BlankEclair/) added a project: [MediaWiki-extensions-Cargo](/tag/mediawiki-extensions-cargo/).[Aug 11 2024, 1:32 AM2024-08-11 01:32:51 (UTC+0)](#10055888)[BlankEclair](/p/BlankEclair/) added a subscriber: [Yaron\_Koren](/p/Yaron_Koren/).[BlankEclair](/p/BlankEclair/) renamed this task from Special:DeleteCargoTable has no CSRF protection to Special:DeleteCargoTable and Special:SwitchCargoTable have no CSRF protection.[Aug 11 2024, 1:44 AM2024-08-11 01:44:24 (UTC+0)](#10055890)[BlankEclair](/p/BlankEclair/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-tymnb4dcjj5lpcw/)[JJMC89](/p/JJMC89/) added a project: [Vuln-CSRF](/tag/vuln-csrf/).[Aug 11 2024, 5:49 AM2024-08-11 05:49:27 (UTC+0)](#10055931)[BlankEclair](/p/BlankEclair/) claimed this task.[Aug 11 2024, 10:53 AM2024-08-11 10:53:12 (UTC+0)](#10056075)[BlankEclair](/p/BlankEclair/) added a comment.[Aug 11 2024, 11:01 AM2024-08-11 11:01:20 (UTC+0)](#10056078)Comment Actions

T372209.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/tqp2tuvfdl5nr2jdtzxk/PHID-FILE-qgjskvcgb4x7jgxxlwwu/T372209.patch)

[Yaron\_Koren](/p/Yaron_Koren/) added a comment.[Aug 12 2024, 3:04 PM2024-08-12 15:04:02 (UTC+0)](#10058088)Comment Actions

[@BlankEclair](/p/BlankEclair/) - thank you for this patch. Any security leak is bad, so I plan to check this fix in, but I just want to make sure I understand this problem, because it seems surprisingly minor. A malicious user can convince an administrator that the admin deleted or switched a Cargo table, where in actuality nothing was done?

[BlankEclair](/p/BlankEclair/) added a comment.[Aug 12 2024, 3:21 PM2024-08-12 15:21:34 (UTC+0)](#10058156)Comment Actions

No, the issue is that a malicious user can cause an administrator to delete or switch a table by simply letting them visit a link. (I've tried to use <iframe>s and <img>s to covertly trigger this bug as a PoC, but they refused to load or didn't send cookies for some reason).

[BlankEclair](/p/BlankEclair/) added a comment.[Aug 12 2024, 4:14 PM2024-08-12 16:14:44 (UTC+0)](#10058385)Comment Actions

I've made an example POC here: T372209-poc.html1 KB[Download](https://phab.wmfusercontent.org/file/download/l33mr6mbkghp7qdnmtlf/PHID-FILE-jujtqt45zlzvxntikwmz/T372209-poc.html)

Screen recording:

cargo-no-csrf-poc.mp42 MB[Download](https://phab.wmfusercontent.org/file/download/m5incwblw45afagbebfh/PHID-FILE-vtrzrcw5vjdlltm3jh3v/cargo-no-csrf-poc.mp4)

(I also accidentally said "We have not deleted your replacement table" when I meant just "table", oops)

[Yaron\_Koren](/p/Yaron_Koren/) closed this task as Resolved.[Aug 14 2024, 3:56 PM2024-08-14 15:56:40 (UTC+0)](#10064509)Comment Actions

[@BlankEclair](/p/BlankEclair/) - thank you for the patch, the explanation, and that very illustrative example! I just checked in your fix, here:

[https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/+/1062723](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/%2B/1062723)

[sbassett](/p/sbassett/) moved this task from [Incoming](/project/board/1179/) to [Watching](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Aug 15 2024, 3:05 PM2024-08-15 15:05:19 (UTC+0)](#10067170)[sbassett](/p/sbassett/) added a project: [SecTeam-Processed](/tag/secteam-processed/).[sbassett](/p/sbassett/) mentioned this in [T368628: Write and send supplementary release announcement for extensions and skins with security patches (1.39.9/1.41.3/1.42.2)](/T368628).[BlankEclair](/p/BlankEclair/) added a comment.[Sep 29 2024, 1:14 PM2024-09-29 13:14:15 (UTC+0)](#10186054)Comment Actions

Can this task be public now?

[sbassett](/p/sbassett/) subscribed.[Sep 30 2024, 4:08 PM2024-09-30 16:08:11 (UTC+0)](#10188336)Comment Actions
> In [T372209#10186054](/T372209#10186054), [@BlankEclair](/p/BlankEclair/) wrote:
>
> Can this task be public now?

Can an ext:Cargo maintainer or user confirm that the CSRF issues have been fully-resolved via [https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/+/1062723](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/%2B/1062723)?

[BlankEclair](/p/BlankEclair/) added a comment.[Sep 30 2024, 11:00 PM2024-09-30 23:00:24 (UTC+0)](#10189913)Comment Actions

Yes

[![2024-10-01_08-59_1.png (531×1 px, 129 KB)](https://phab.wmfusercontent.org/file/data/xjxxkadp7cezsufpf7tz/PHID-FILE-bw3pup6debnbbu25cji6/preview-2024-10-01_08-59_1.png)](https://phab.wmfusercontent.org/file/data/fwok5a32zdzetbyelvor/PHID-FILE-yph3c2rydlnys4lvbdyj/2024-10-01_08-59_1.png)

[![2024-10-01_08-59.png (528×1 px, 118 KB)](https://phab.wmfusercontent.org/file/data/gvf56okypgttsnvywm6q/PHID-FILE-qilkbvamsm5m7zkamomx/preview-2024-10-01_08-59.png)](https://phab.wmfusercontent.org/file/data/hijxlj7z5miprxar32yp/PHID-FILE-akkdt5tyl2bjnqsqpxm3/2024-10-01_08-59.png)

[sbassett](/p/sbassett/) triaged this task as Medium priority.[Oct 1 2024, 3:29 PM2024-10-01 15:29:48 (UTC+0)](#10192288)[sbassett](/p/sbassett/) changed Author Affiliation from N/A to Wikimedia Communities.[sbassett](/p/sbassett/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-ticflqtkp4wc5qw/)" to "Public (No Login Required)".[sbassett](/p/sbassett/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-zzczobjfq5gmml6/)" to "All Users".[sbassett](/p/sbassett/) changed Risk Rating from N/A to Medium.[Mstyles](/p/Mstyles/) renamed this task from Special:DeleteCargoTable and Special:SwitchCargoTable have no CSRF protection to CVE-2024-47846: Special:DeleteCargoTable and Special:SwitchCargoTable have no CSRF protection.[Oct 5 2024, 12:40 AM2024-10-05 00:40:39 (UTC+0)](#10204308)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)