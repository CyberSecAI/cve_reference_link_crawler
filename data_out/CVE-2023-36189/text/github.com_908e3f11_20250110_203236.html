
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain%2Fissues%2F5923)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain%2Fissues%2F5923)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=langchain-ai%2Flangchain)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[langchain-ai](/langchain-ai)
/
**[langchain](/langchain-ai/langchain)**
Public

* [Notifications](/login?return_to=%2Flangchain-ai%2Flangchain) You must be signed in to change notification settings
* [Fork
  15.9k](/login?return_to=%2Flangchain-ai%2Flangchain)
* [Star
   98k](/login?return_to=%2Flangchain-ai%2Flangchain)

* [Code](/langchain-ai/langchain)
* [Issues
  381](/langchain-ai/langchain/issues)
* [Pull requests
  44](/langchain-ai/langchain/pulls)
* [Discussions](/langchain-ai/langchain/discussions)
* [Actions](/langchain-ai/langchain/actions)
* [Projects
  2](/langchain-ai/langchain/projects)
* [Security](/langchain-ai/langchain/security)
* [Insights](/langchain-ai/langchain/pulse)

Additional navigation options

* [Code](/langchain-ai/langchain)
* [Issues](/langchain-ai/langchain/issues)
* [Pull requests](/langchain-ai/langchain/pulls)
* [Discussions](/langchain-ai/langchain/discussions)
* [Actions](/langchain-ai/langchain/actions)
* [Projects](/langchain-ai/langchain/projects)
* [Security](/langchain-ai/langchain/security)
* [Insights](/langchain-ai/langchain/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flangchain-ai%2Flangchain%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flangchain-ai%2Flangchain%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# SQLDatabaseChain has SQL injection issue #5923

Closed

14 tasks

[asimjalis](/asimjalis) opened this issue
Jun 9, 2023
¬∑ 7 comments

Closed

14 tasks

# [SQLDatabaseChain has SQL injection issue](#top) #5923

[asimjalis](/asimjalis) opened this issue
Jun 9, 2023
¬∑ 7 comments

Labels
[ü§ñ:security](/langchain-ai/langchain/labels/%F0%9F%A4%96%3Asecurity)
Related to security issues, CVEs

## Comments

[![@asimjalis](https://avatars.githubusercontent.com/u/227187?s=80&u=58e146c550e0bdf118873111cb462017f0a2188c&v=4)](/asimjalis)

Copy link

### **[asimjalis](/asimjalis)** commented [Jun 9, 2023](#issue-1749279355) ‚Ä¢ edited Loading

| System Info There is no safeguard in SQLDatabaseChain to prevent a malicious user from sending a prompt such as "Drop Employee table".  SQLDatabaseChain should have a facility to intercept and review the SQL before sending it to the database.  Creating this separately from [#1026](https://github.com/langchain-ai/langchain/issues/1026) because the SQL injection issue and the Python exec issues are separate. For example SQL injection cannot be solved with running inside an isolated container.  [LangChain version: 0.0.194. Python version 3.11.1] [image](https://private-user-images.githubusercontent.com/227187/244791704-3ced0139-490f-4e41-a880-71dc864ee12c.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NDE0NTYsIm5iZiI6MTczNjU0MTE1NiwicGF0aCI6Ii8yMjcxODcvMjQ0NzkxNzA0LTNjZWQwMTM5LTQ5MGYtNGU0MS1hODgwLTcxZGM4NjRlZTEyYy5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTEwJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExMFQyMDMyMzZaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1hY2IxNmFhZjNhZTgxMTg4ZmM4ODMyNDU5NDA0ZTM5NjVhZGM3MTc2YjlmY2Y1N2NhNThjODY0ODM1MmFiOGEyJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.6VtDp3xd2ZA36LmUdEgZB3VHkxIyboKTYuW14-g6wvs)Who can help? *No response* Information  * The official example notebooks/scripts * My own modified scripts  Related Components  * LLMs/Chat Models * Embedding Models * Prompts / Prompt Templates / Prompt Selectors * Output Parsers * Document Loaders * Vector Stores / Retrievers * Memory * Agents / Agent Executors * Tools / Toolkits * Chains * Callbacks/Tracing * Async  Reproduction Here is a repro using the Chinook sqlite database used in the example ipynb. Running this will drop the Employee table from the SQLite database.  ``` chinook_sqlite_uri = "sqlite:///Chinook_Sqlite_Tmp.sqlite" from langchain import OpenAI, SQLDatabase, SQLDatabaseChain llm = OpenAI(temperature=0) db = SQLDatabase.from_uri(chinook_sqlite_uri) db.get_usable_table_names() db_chain = SQLDatabaseChain.from_llm(llm=llm, db=db, verbose=True) db_chain.run("How many employees are there?") db_chain.run("Drop the employee table") ``` Expected behavior LangChain should provide a mechanism to intercept SQL before sending it to the database. During this interception the SQL can be examined and rejected if it performs unsafe operations. |
| --- |
| The text was updated successfully, but these errors were encountered: |

 üëç
3
 captainjackrana, boazwasserman, and Uranium2 reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

[![@boazwasserman](https://avatars.githubusercontent.com/u/49598618?s=80&u=2d8024560f2f936312e819348cc18db338961fb7&v=4)](/boazwasserman)

Copy link

Contributor

### **[boazwasserman](/boazwasserman)** commented [Jun 12, 2023](#issuecomment-1586817030)

| Yeah, it can end up pretty badly if someone puts this into their app without additional validations. I'll try to find some time to add a few validations |
| --- |

All reactions

Sorry, something went wrong.

[![@boazwasserman](https://avatars.githubusercontent.com/u/49598618?s=40&u=2d8024560f2f936312e819348cc18db338961fb7&v=4)](/boazwasserman)
[boazwasserman](/boazwasserman)
mentioned this issue
[Jun 12, 2023](#ref-pullrequest-1752952281)

[Mitigate issue #5923 (Prompt injection -> SQL injection in SQLChain)
#6051](/langchain-ai/langchain/pull/6051)
 Closed

[![@asimjalis](https://avatars.githubusercontent.com/u/227187?s=80&u=58e146c550e0bdf118873111cb462017f0a2188c&v=4)](/asimjalis)

Copy link

Author

### **[asimjalis](/asimjalis)** commented [Jun 12, 2023](#issuecomment-1587563956)

| Ideally there would be a way to add custom validations. For example, it is possible I don‚Äôt want to allow certain types of select operations. Like selects on system tables. |
| --- |

All reactions

Sorry, something went wrong.

[![@boazwasserman](https://avatars.githubusercontent.com/u/49598618?s=80&u=2d8024560f2f936312e819348cc18db338961fb7&v=4)](/boazwasserman)

Copy link

Contributor

### **[boazwasserman](/boazwasserman)** commented [Jun 12, 2023](#issuecomment-1587681093)

| Great idea! I'll look at adding it to this PR / a following one |
| --- |

All reactions

Sorry, something went wrong.

[![@Amejonah1200](https://avatars.githubusercontent.com/u/50181314?s=80&u=1c01be07153f32a97fdc6ecf11a46aea00befadf&v=4)](/Amejonah1200)

Copy link

### **[Amejonah1200](/Amejonah1200)** commented [Jun 27, 2023](#issuecomment-1609094632) ‚Ä¢ edited Loading

| a mechanism to intercept SQL before sending it to the database.  That is called "create a user in your database, give the least amount of privileges, do not execute queries with root". Aka. "User Management" or "Role Based Access Control" like you should do anyway... |
| --- |

 üëç
4
 ApoorvRChincholkar, glorinli, neverho0d, and khanhngt reacted with thumbs up emoji
 üëÄ
2
 Uranium2 and khanhngt reacted with eyes emoji

All reactions

* üëç
  4 reactions
* üëÄ
  2 reactions

Sorry, something went wrong.

[![@Uranium2](https://avatars.githubusercontent.com/u/6902440?s=80&v=4)](/Uranium2)

Copy link

### **[Uranium2](/Uranium2)** commented [Aug 1, 2023](#issuecomment-1660029502)

| It's true that user must be set according to the user.  But I still think that at least pattern matching must be used to catch delet/alter/drop/insert or any keywords that may change the database/table.  I was thinking if it was possible to add a callback that will, before running blindly the SQL, will check if the SQL contains actions unwanted by the developper.  Something like this:  ``` db = SQLDatabase.from_databricks(         catalog=catalog,         schema=db_name         host=host,         api_token=api_token,         warehouse_id=warehouse_id,         exclude_actions=["DELETE", "ALTER"],     ) ```  exclude\_actions=["DELETE", "ALTER"],  This could be added and stops the run if "delete" "alter" are found in the generated code of the LLM. |
| --- |

 üëç
1
 AnotherMadScientist reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@Uranium2](https://avatars.githubusercontent.com/u/6902440?s=80&v=4)](/Uranium2)

Copy link

### **[Uranium2](/Uranium2)** commented [Aug 2, 2023](#issuecomment-1661701899) ‚Ä¢ edited Loading

| Made a PR if it can helps, don't hesitate to comment to add feedbacks [#8583](https://github.com/langchain-ai/langchain/pull/8583) Not sure it will correct the ([CVE-2023-36189](https://github.com/advisories/GHSA-7q94-qpjr-xpgm "CVE-2023-36189")) <https://security.snyk.io/vuln/SNYK-PYTHON-LANGCHAIN-5759268> |
| --- |

All reactions

Sorry, something went wrong.

[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=80&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)

Copy link

Collaborator

### **[obi1kenobi](/obi1kenobi)** commented [Aug 28, 2023](#issuecomment-1696053841) ‚Ä¢ edited Loading

| This issue has been resolved in [#8425](https://github.com/langchain-ai/langchain/pull/8425), and the fix was first published in `langchain v0.0.247`:   * PR [remove code¬†#8425](https://github.com/langchain-ai/langchain/pull/8425) is in the release notes for that version: <https://github.com/langchain-ai/langchain/releases/tag/v0.0.247> * [Here's the merged commit](https://github.com/langchain-ai/langchain/commit/fab24457bcf8ede882abd11419769c92bc4e7751) that removed the problematic code from `langchain`, and as you can see the GitHub UI shows that commit as being part of all releases since 0.0.247.   `langchain` versions 0.0.247+ are not vulnerable in this way.  The affected code has been moved to `langchain-experimental`, which is a separate package intended for testing out new ideas before all the edge cases are worked out. We felt this was the best solution for the time being, and may reconsider moving the code back to `langchain` itself once we're satisfied with the interface and security profile it offers.  As the discussion here and in [#6051](https://github.com/langchain-ai/langchain/pull/6051) pointed out, the most thorough and most universally-compatible way to prevent undesirable SQL commands from being executed is to limit the database permissions granted to the chain. That way, the database itself prevents dangerous commands like `DROP TABLE` from being able to be executed. As a result, we're marking that `langchain-experimental` code with prominent security warnings advising users about the security risk and reminding them to limit the database permissions they grant the chain: [#9867](https://github.com/langchain-ai/langchain/pull/9867)  Thanks for the report and the productive discussion here! |
| --- |

All reactions

Sorry, something went wrong.

[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=40&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)
[obi1kenobi](/obi1kenobi)
closed this as [completed](/langchain-ai/langchain/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Aug 28, 2023](#event-10211646676)

[obi1kenobi](/obi1kenobi)
added a commit
to obi1kenobi/advisory-database
that referenced
this issue
[Aug 28, 2023](#ref-commit-b2a9303)
[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=40&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)

`[Update PYSEC-2023-110 to include fix information](/obi1kenobi/advisory-database/commit/b2a93038253d36e0f82b39152deab73f7302939a "Update PYSEC-2023-110 to include fix information

The fix for this issue was published in langchain v0.0.247 so that one and all subsequent versions are safe.

I've also updated the URLs to point to the merged PR containing the fix, and to account for the fact that the project repo moved from a personal to an organization GitHub account.

The full details on the vulnerability and remediation can be found here:
https://github.com/langchain-ai/langchain/issues/5923#issuecomment-1696053841")`
‚Ä¶

`[b2a9303](/obi1kenobi/advisory-database/commit/b2a93038253d36e0f82b39152deab73f7302939a)`

```
The fix for this issue was published in langchain v0.0.247 so that one and all subsequent versions are safe.

I've also updated the URLs to point to the merged PR containing the fix, and to account for the fact that the project repo moved from a personal to an organization GitHub account.

The full details on the vulnerability and remediation can be found here:
[langchain-ai/langchain#5923 (comment)](https://github.com/langchain-ai/langchain/issues/5923#issuecomment-1696053841)
```

[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=40&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)
[obi1kenobi](/obi1kenobi)
mentioned this issue
[Aug 28, 2023](#ref-pullrequest-1870295749)

[Update PYSEC-2023-110 to include fix information
pypa/advisory-database#150](/pypa/advisory-database/pull/150)
 Merged

[sethmlarson](/sethmlarson)
pushed a commit
to pypa/advisory-database
that referenced
this issue
[Aug 28, 2023](#ref-commit-e41332e)
[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=40&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)

`[Update PYSEC-2023-110 to include fix information](/pypa/advisory-database/commit/e41332e7b7b676b424ba36160a350c05b4865886 "Update PYSEC-2023-110 to include fix information

The fix for this issue was published in langchain v0.0.247 so that one and all subsequent versions are safe.

I've also updated the URLs to point to the merged PR containing the fix, and to account for the fact that the project repo moved from a personal to an organization GitHub account.

The full details on the vulnerability and remediation can be found here:
https://github.com/langchain-ai/langchain/issues/5923#issuecomment-1696053841")`
‚Ä¶

`[e41332e](/pypa/advisory-database/commit/e41332e7b7b676b424ba36160a350c05b4865886)`

```
The fix for this issue was published in langchain v0.0.247 so that one and all subsequent versions are safe.

I've also updated the URLs to point to the merged PR containing the fix, and to account for the fact that the project repo moved from a personal to an organization GitHub account.

The full details on the vulnerability and remediation can be found here:
[langchain-ai/langchain#5923 (comment)](https://github.com/langchain-ai/langchain/issues/5923#issuecomment-1696053841)
```

[![@eyurtsev](https://avatars.githubusercontent.com/u/3205522?s=40&v=4)](/eyurtsev)
[eyurtsev](/eyurtsev)
added
the
[ü§ñ:security](/langchain-ai/langchain/labels/%F0%9F%A4%96%3Asecurity)
Related to security issues, CVEs
label
[Mar 13, 2024](#event-12105987472)

[![@bertuxdeveloper](https://avatars.githubusercontent.com/u/33967419?s=40&v=4)](/bertuxdeveloper)
[bertuxdeveloper](/bertuxdeveloper)
mentioned this issue
[Nov 7, 2024](#ref-pullrequest-2641172725)

[[GHSA-8h5w-f6q9-wg35] Langchain SQL Injection vulnerability
github/advisory-database#4992](/github/advisory-database/pull/4992)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain%2Fissues%2F5923)

Assignees

No one assigned

Labels

[ü§ñ:security](/langchain-ai/langchain/labels/%F0%9F%A4%96%3Asecurity)
Related to security issues, CVEs

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [Mitigate issue #5923 (Prompt injection -> SQL injection in SQLChain)](/langchain-ai/langchain/pull/6051)
 [boazwasserman/langchain](/boazwasserman/langchain)

6 participants

[![@asimjalis](https://avatars.githubusercontent.com/u/227187?s=52&v=4)](/asimjalis) [![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=52&v=4)](/obi1kenobi) [![@eyurtsev](https://avatars.githubusercontent.com/u/3205522?s=52&v=4)](/eyurtsev) [![@Uranium2](https://avatars.githubusercontent.com/u/6902440?s=52&v=4)](/Uranium2) [![@boazwasserman](https://avatars.githubusercontent.com/u/49598618?s=52&v=4)](/boazwasserman) [![@Amejonah1200](https://avatars.githubusercontent.com/u/50181314?s=52&v=4)](/Amejonah1200)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

