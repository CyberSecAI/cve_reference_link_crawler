
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fevmos%2Fevmos%2Fcommit%2F08982b5ee726b97bc50eaf58d1914829648b6a5f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fevmos%2Fevmos%2Fcommit%2F08982b5ee726b97bc50eaf58d1914829648b6a5f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=evmos%2Fevmos)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[evmos](/evmos)
/
**[evmos](/evmos/evmos)**
Public

* [Notifications](/login?return_to=%2Fevmos%2Fevmos) You must be signed in to change notification settings
* [Fork
  876](/login?return_to=%2Fevmos%2Fevmos)
* [Star
   1.7k](/login?return_to=%2Fevmos%2Fevmos)

* [Code](/evmos/evmos)
* [Issues
  13](/evmos/evmos/issues)
* [Pull requests
  12](/evmos/evmos/pulls)
* [Discussions](/evmos/evmos/discussions)
* [Actions](/evmos/evmos/actions)
* [Security](/evmos/evmos/security)
* [Insights](/evmos/evmos/pulse)

Additional navigation options

* [Code](/evmos/evmos)
* [Issues](/evmos/evmos/issues)
* [Pull requests](/evmos/evmos/pulls)
* [Discussions](/evmos/evmos/discussions)
* [Actions](/evmos/evmos/actions)
* [Security](/evmos/evmos/security)
* [Insights](/evmos/evmos/pulse)

## Commit

[Permalink](/evmos/evmos/commit/08982b5ee726b97bc50eaf58d1914829648b6a5f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-3fp5-2xwh-fxm6](https://github.com/advisories/GHSA-3fp5-2xwh-fxm6 "GHSA-3fp5-2xwh-fxm6")

[Browse files](/evmos/evmos/tree/08982b5ee726b97bc50eaf58d1914829648b6a5f)
Browse the repository at this point in the history

```
* imp(evm): Improve statedb commit efficiency

* gomod2nix generate

---------

Co-authored-by: tom <tomasguerraalda@hotmail.com>
```

* Loading branch information

[![@facs95](https://avatars.githubusercontent.com/u/27392642?s=40&v=4)](/facs95) [![@GAtom22](https://avatars.githubusercontent.com/u/54514587?s=40&v=4)](/GAtom22)

[facs95](/evmos/evmos/commits?author=facs95 "View all commits by facs95")
and
[GAtom22](/evmos/evmos/commits?author=GAtom22 "View all commits by GAtom22")
authored
Apr 8, 2024

1 parent
[06978b0](/evmos/evmos/commit/06978b05c88689452b51eae8adda488165eb98de)

commit 08982b5

 Show file tree

 Hide file tree

Showing
**10 changed files**
with
**192 additions**
and
**137 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* go.mod
  [go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6)
* go.sum
  [go.sum](#diff-3295df7234525439d778f1b282d146a4f1ff6b415248aaac074e8042d9f42d63)
* gomod2nix.toml
  [gomod2nix.toml](#diff-6a5567abee992c210e5cb96abc84014e04fc10cc42eb0e9b27c342cee58ec002)
* precompiles

  + bank

    - precompiles/bank/bank.go
      [bank.go](#diff-5718f02b949441fdeb8529d129a8af2cbac1065f75a1abb8bed47d1aeb278e65)
  + distribution

    - precompiles/distribution/distribution.go
      [distribution.go](#diff-705eca6916a35e5f46555d95d8d7bd2976773e5f45e8cbc82cea506e511d1e44)
  + ics20

    - precompiles/ics20/ics20.go
      [ics20.go](#diff-13d1cdec8e440f936e736ad7381a89471dc640f09be693573ffc90f1e4e45db7)
  + outposts

    - osmosis

      * precompiles/outposts/osmosis/osmosis.go
        [osmosis.go](#diff-2e6ff2b183416376ddb2d9c6b5e36cd36cecd8d7be13b73fd27953d6c77a2a4d)
    - stride

      * precompiles/outposts/stride/stride.go
        [stride.go](#diff-8a2538c99ac15a8478f652ccd6a04f8c89a40af5389eaf45934d0c1fa98019d6)
* x/evm/statedb

  + x/evm/statedb/state\_object.go
    [state\_object.go](#diff-e8fd753994c42eb5a9b6b3837e48455826829560a120828cb2de9d35ad7dc10a)
  + x/evm/statedb/statedb.go
    [statedb.go](#diff-25e1796967b0568bbd409ff7f0d6532947d60044d3cb99f33d93ab4eb0def08f)

## There are no files selected for viewing

55 changes: 29 additions & 26 deletions

55
[go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6 "go.mod")

Show comments

[View file](/evmos/evmos/blob/08982b5ee726b97bc50eaf58d1914829648b6a5f/go.mod)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,20 +4,20 @@ go 1.20 |
|  |  |  |
|  |  | require ( |
|  |  | cosmossdk.io/api v0.3.1 |
|  |  | cosmossdk.io/errors v1.0.0 |
|  |  | cosmossdk.io/errors v1.0.1 |
|  |  | cosmossdk.io/math v1.2.0 |
|  |  | cosmossdk.io/simapp v0.0.0-20230608160436-666c345ad23d |
|  |  | cosmossdk.io/tools/rosetta v0.2.1 |
|  |  | github.com/armon/go-metrics v0.4.1 |
|  |  | github.com/btcsuite/btcd v0.23.3 |
|  |  | github.com/btcsuite/btcd/btcutil v1.1.3 |
|  |  | github.com/cometbft/cometbft v0.37.3-0.20230920093934-46df7b597e3c |
|  |  | github.com/cometbft/cometbft v0.37.4 |
|  |  | github.com/cometbft/cometbft-db v0.8.0 |
|  |  | github.com/cosmos/cosmos-proto v1.0.0-beta.3 |
|  |  | github.com/cosmos/cosmos-sdk v0.47.5 |
|  |  | github.com/cosmos/cosmos-sdk v0.47.8 |
|  |  | github.com/cosmos/go-bip39 v1.0.0 |
|  |  | github.com/cosmos/gogoproto v1.4.10 |
|  |  | github.com/cosmos/ibc-go/v7 v7.3.1 |
|  |  | github.com/cosmos/ibc-go/v7 v7.4.0 |
|  |  | github.com/crypto-org-chain/cronos/memiavl v0.0.5-0.20231027074119-c05c9c61c90e |
|  |  | github.com/crypto-org-chain/cronos/store v0.0.5-0.20231027074119-c05c9c61c90e |
|  |  | github.com/crypto-org-chain/cronos/versiondb v0.0.0-20231027074119-c05c9c61c90e |
| Expand Down  Expand Up | | @@ -49,21 +49,21 @@ require ( |
|  |  | golang.org/x/exp v0.0.0-20230711153332-06a737ee72cb |
|  |  | golang.org/x/net v0.19.0 |
|  |  | golang.org/x/text v0.14.0 |
|  |  | google.golang.org/genproto/googleapis/api v0.0.0-20230822172742-b8732ec3820d |
|  |  | google.golang.org/grpc v1.59.0 |
|  |  | google.golang.org/protobuf v1.31.0 |
|  |  | google.golang.org/genproto/googleapis/api v0.0.0-20231212172506-995d672761c0 |
|  |  | google.golang.org/grpc v1.60.1 |
|  |  | google.golang.org/protobuf v1.32.0 |
|  |  | sigs.k8s.io/yaml v1.4.0 |
|  |  | ) |
|  |  |  |
|  |  | require ( |
|  |  | cloud.google.com/go v0.110.7 // indirect |
|  |  | cloud.google.com/go/compute v1.23.0 // indirect |
|  |  | cloud.google.com/go v0.111.0 // indirect |
|  |  | cloud.google.com/go/compute v1.23.3 // indirect |
|  |  | cloud.google.com/go/compute/metadata v0.2.3 // indirect |
|  |  | cloud.google.com/go/iam v1.1.1 // indirect |
|  |  | cloud.google.com/go/iam v1.1.5 // indirect |
|  |  | cloud.google.com/go/storage v1.30.1 // indirect |
|  |  | cosmossdk.io/core v0.6.1 // indirect |
|  |  | cosmossdk.io/depinject v1.0.0-alpha.4 // indirect |
|  |  | cosmossdk.io/log v1.2.1 // indirect |
|  |  | cosmossdk.io/log v1.3.0 // indirect |
|  |  | filippo.io/edwards25519 v1.0.0 // indirect |
|  |  | github.com/99designs/go-keychain v0.0.0-20191008050251-8e49817e8af4 // indirect |
|  |  | github.com/99designs/keyring v1.2.1 // indirect |
| Expand Down  Expand Up | | @@ -95,7 +95,7 @@ require ( |
|  |  | github.com/cosmos/gogogateway v1.2.0 // indirect |
|  |  | github.com/cosmos/iavl v0.21.0-alpha.1.0.20230904092046-df3db2d96583 // indirect |
|  |  | github.com/cosmos/ics23/go v0.10.0 // indirect |
|  |  | github.com/cosmos/ledger-cosmos-go v0.12.2 // indirect |
|  |  | github.com/cosmos/ledger-cosmos-go v0.12.4 // indirect |
|  |  | github.com/cosmos/rosetta-sdk-go v0.10.0 // indirect |
|  |  | github.com/creachadair/taskgroup v0.4.2 // indirect |
|  |  | github.com/danieljoos/wincred v1.1.2 // indirect |
| Expand Down  Expand Up | | @@ -123,6 +123,7 @@ require ( |
|  |  | github.com/go-kit/log v0.2.1 // indirect |
|  |  | github.com/go-logfmt/logfmt v0.6.0 // indirect |
|  |  | github.com/go-logr/logr v1.3.0 // indirect |
|  |  | github.com/go-logr/stdr v1.2.2 // indirect |
|  |  | github.com/go-ole/go-ole v1.2.6 // indirect |
|  |  | github.com/go-sourcemap/sourcemap v2.1.3+incompatible // indirect |
|  |  | github.com/go-stack/stack v1.8.1 // indirect |
| Expand All | | @@ -138,11 +139,11 @@ require ( |
|  |  | github.com/google/go-cmp v0.6.0 // indirect |
|  |  | github.com/google/orderedcode v0.0.1 // indirect |
|  |  | github.com/google/pprof v0.0.0-20230228050547-1710fef4ab10 // indirect |
|  |  | github.com/google/s2a-go v0.1.4 // indirect |
|  |  | github.com/google/s2a-go v0.1.7 // indirect |
|  |  | github.com/google/shlex v0.0.0-20191202100458-e7afc7fbc510 // indirect |
|  |  | github.com/google/uuid v1.3.1 // indirect |
|  |  | github.com/googleapis/enterprise-certificate-proxy v0.2.3 // indirect |
|  |  | github.com/googleapis/gax-go/v2 v2.11.0 // indirect |
|  |  | github.com/google/uuid v1.4.0 // indirect |
|  |  | github.com/googleapis/enterprise-certificate-proxy v0.3.2 // indirect |
|  |  | github.com/googleapis/gax-go/v2 v2.12.0 // indirect |
|  |  | github.com/gorilla/handlers v1.5.1 // indirect |
|  |  | github.com/grpc-ecosystem/go-grpc-middleware v1.4.0 // indirect |
|  |  | github.com/gsterjov/go-libsecret v0.0.0-20161001094733-a6f4afe4910c // indirect |
| Expand Down  Expand Up | | @@ -173,7 +174,7 @@ require ( |
|  |  | github.com/magiconair/properties v1.8.7 // indirect |
|  |  | github.com/manifoldco/promptui v0.9.0 // indirect |
|  |  | github.com/mattn/go-colorable v0.1.13 // indirect |
|  |  | github.com/mattn/go-isatty v0.0.19 // indirect |
|  |  | github.com/mattn/go-isatty v0.0.20 // indirect |
|  |  | github.com/mattn/go-runewidth v0.0.9 // indirect |
|  |  | github.com/matttproud/golang\_protobuf\_extensions v1.0.4 // indirect |
|  |  | github.com/mimoo/StrobeGo v0.0.0-20210601165009-122bf33a46e0 // indirect |
| Expand All | | @@ -198,7 +199,7 @@ require ( |
|  |  | github.com/rcrowley/go-metrics v0.0.0-20201227073835-cf1acfcdf475 // indirect |
|  |  | github.com/rjeczalik/notify v0.9.3 // indirect |
|  |  | github.com/rogpeppe/go-internal v1.11.0 // indirect |
|  |  | github.com/rs/zerolog v1.30.0 // indirect |
|  |  | github.com/rs/zerolog v1.31.0 // indirect |
|  |  | github.com/sasha-s/go-deadlock v0.3.1 // indirect |
|  |  | github.com/shirou/gopsutil v3.21.4-0.20210419000835-c7a38de76ee5+incompatible // indirect |
|  |  | github.com/sirupsen/logrus v1.9.0 // indirect |
| Expand All | | @@ -222,19 +223,21 @@ require ( |
|  |  | github.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415 // indirect |
|  |  | github.com/xeipuuv/gojsonschema v1.2.0 // indirect |
|  |  | github.com/zbiljic/go-filelock v0.0.0-20170914061330-1dbf7103ab7d // indirect |
|  |  | github.com/zondax/ledger-go v0.14.1 // indirect |
|  |  | github.com/zondax/ledger-go v0.14.3 // indirect |
|  |  | go.etcd.io/bbolt v1.3.7 // indirect |
|  |  | go.opentelemetry.io/otel v1.19.0 // indirect |
|  |  | go.opentelemetry.io/otel/metric v1.19.0 // indirect |
|  |  | go.opentelemetry.io/otel/trace v1.19.0 // indirect |
|  |  | golang.org/x/mod v0.13.0 // indirect |
|  |  | golang.org/x/oauth2 v0.11.0 // indirect |
|  |  | golang.org/x/oauth2 v0.13.0 // indirect |
|  |  | golang.org/x/sync v0.4.0 // indirect |
|  |  | golang.org/x/sys v0.15.0 // indirect |
|  |  | golang.org/x/sys v0.16.0 // indirect |
|  |  | golang.org/x/term v0.15.0 // indirect |
|  |  | golang.org/x/tools v0.14.0 // indirect |
|  |  | golang.org/x/xerrors v0.0.0-20220907171357-04be3eba64a2 // indirect |
|  |  | google.golang.org/api v0.126.0 // indirect |
|  |  | google.golang.org/appengine v1.6.7 // indirect |
|  |  | google.golang.org/genproto v0.0.0-20230822172742-b8732ec3820d // indirect |
|  |  | google.golang.org/genproto/googleapis/rpc v0.0.0-20230822172742-b8732ec3820d // indirect |
|  |  | google.golang.org/api v0.149.0 // indirect |
|  |  | google.golang.org/appengine v1.6.8 // indirect |
|  |  | google.golang.org/genproto v0.0.0-20240102182953-50ed04b92917 // indirect |
|  |  | google.golang.org/genproto/googleapis/rpc v0.0.0-20240108191215-35c7eff3a6b1 // indirect |
|  |  | gopkg.in/ini.v1 v1.67.0 // indirect |
|  |  | gopkg.in/natefinch/npipe.v2 v2.0.0-20160621034901-c1b8fa8bdcce // indirect |
|  |  | gopkg.in/yaml.v2 v2.4.0 // indirect |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 2 comments on commit `08982b5`

[![@luchenqun](https://avatars.githubusercontent.com/u/9688029?s=80&v=4)](/luchenqun)

Copy link

Contributor

### @luchenqun **[luchenqun](/luchenqun)** commented on `[08982b5](/evmos/evmos/commit/08982b5ee726b97bc50eaf58d1914829648b6a5f)` [May 8, 2024](#commitcomment-141793854)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@facs95](https://github.com/facs95) [@GAtom22](https://github.com/GAtom22)

I'd like to check your code commit history through [GHSA-3fp5-2xwh-fxm6](https://github.com/evmos/evmos/security/advisories/GHSA-3fp5-2xwh-fxm6 "GHSA-3fp5-2xwh-fxm6").

Regarding your fix, I have a question: why is it necessary to call `stateDB.Commit()` in the `Run` function of the `Precompile`?

As far as I understand, in the `ApplyMessageWithConfig` function of the evm module, `stateDB.Commit()` will definitely be called after the transaction execution. So, would simply removing the `stateDB.Commit()` logic from the `Run` function of the precompiled contract be enough to fix this vulnerability?

Sorry, something went wrong.

All reactions

[![@facs95](https://avatars.githubusercontent.com/u/27392642?s=80&v=4)](/facs95)

Copy link

Contributor

Author

### @facs95 **[facs95](/facs95)** commented on `[08982b5](/evmos/evmos/commit/08982b5ee726b97bc50eaf58d1914829648b6a5f)` [May 29, 2024](#commitcomment-142503616)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Hi [@luchenqun](https://github.com/luchenqun) ! Sorry I had missed your question. The `Commit()` is necessary prior to a precompile execution because the keepers need to have access to the updated state for anything that could have happened in the current EVM execution prior to the precompile call. That state is not sync until the Commit function is called.

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fevmos%2Fevmos%2Fcommit%2F08982b5ee726b97bc50eaf58d1914829648b6a5f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

