

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=75ddbf776dd04a09fb9e5267ead5d0c989f84506)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=75ddbf776dd04a09fb9e5267ead5d0c989f84506)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=75ddbf776dd04a09fb9e5267ead5d0c989f84506)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=75ddbf776dd04a09fb9e5267ead5d0c989f84506)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikita Zhandarovich <n.zhandarovich@fintech.ru> | 2024-06-09 06:15:46 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:12:53 +0200 |
| commit | [75ddbf776dd04a09fb9e5267ead5d0c989f84506](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=75ddbf776dd04a09fb9e5267ead5d0c989f84506) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=75ddbf776dd04a09fb9e5267ead5d0c989f84506)) | |
| tree | [6350a0f9bbc6da13ab6bf56b10a29e2818b969c0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=75ddbf776dd04a09fb9e5267ead5d0c989f84506) | |
| parent | [621e90201c84b8fc427c433738a11495d05422d0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=621e90201c84b8fc427c433738a11495d05422d0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=75ddbf776dd04a09fb9e5267ead5d0c989f84506&id2=621e90201c84b8fc427c433738a11495d05422d0)) | |
| download | [linux-75ddbf776dd04a09fb9e5267ead5d0c989f84506.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-75ddbf776dd04a09fb9e5267ead5d0c989f84506.tar.gz) | |

usb: atm: cxacru: fix endpoint checking in cxacru\_bind()commit 2eabb655a968b862bc0c31629a09f0fbf3c80d51 upstream.
Syzbot is still reporting quite an old issue [1] that occurs due to
incomplete checking of present usb endpoints. As such, wrong
endpoints types may be used at urb sumbitting stage which in turn
triggers a warning in usb\_submit\_urb().
Fix the issue by verifying that required endpoint types are present
for both in and out endpoints, taking into account cmd endpoint type.
Unfortunately, this patch has not been tested on real hardware.
[1] Syzbot report:
usb 1-1: BOGUS urb xfer, pipe 1 != type 3
WARNING: CPU: 0 PID: 8667 at drivers/usb/core/urb.c:502 usb\_submit\_urb+0xed2/0x18a0 drivers/usb/core/urb.c:502
Modules linked in:
CPU: 0 PID: 8667 Comm: kworker/0:4 Not tainted 5.14.0-rc4-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Workqueue: usb\_hub\_wq hub\_event
RIP: 0010:usb\_submit\_urb+0xed2/0x18a0 drivers/usb/core/urb.c:502
...
Call Trace:
cxacru\_cm+0x3c0/0x8e0 drivers/usb/atm/cxacru.c:649
cxacru\_card\_status+0x22/0xd0 drivers/usb/atm/cxacru.c:760
cxacru\_bind+0x7ac/0x11a0 drivers/usb/atm/cxacru.c:1209
usbatm\_usb\_probe+0x321/0x1ae0 drivers/usb/atm/usbatm.c:1055
cxacru\_usb\_probe+0xdf/0x1e0 drivers/usb/atm/cxacru.c:1363
usb\_probe\_interface+0x315/0x7f0 drivers/usb/core/driver.c:396
call\_driver\_probe drivers/base/dd.c:517 [inline]
really\_probe+0x23c/0xcd0 drivers/base/dd.c:595
\_\_driver\_probe\_device+0x338/0x4d0 drivers/base/dd.c:747
driver\_probe\_device+0x4c/0x1a0 drivers/base/dd.c:777
\_\_device\_attach\_driver+0x20b/0x2f0 drivers/base/dd.c:894
bus\_for\_each\_drv+0x15f/0x1e0 drivers/base/bus.c:427
\_\_device\_attach+0x228/0x4a0 drivers/base/dd.c:965
bus\_probe\_device+0x1e4/0x290 drivers/base/bus.c:487
device\_add+0xc2f/0x2180 drivers/base/core.c:3354
usb\_set\_configuration+0x113a/0x1910 drivers/usb/core/message.c:2170
usb\_generic\_driver\_probe+0xba/0x100 drivers/usb/core/generic.c:238
usb\_probe\_device+0xd9/0x2c0 drivers/usb/core/driver.c:293
Reported-and-tested-by: syzbot+00c18ee8497dd3be6ade@syzkaller.appspotmail.com
Fixes: 902ffc3c707c ("USB: cxacru: Use a bulk/int URB to access the command endpoint")
Cc: stable <stable@kernel.org>
Signed-off-by: Nikita Zhandarovich <n.zhandarovich@fintech.ru>
Link: [https://lore.kernel.org/r/20240609131546.3932-1-n.zhandarovich@fintech.ru](https://lore.kernel.org/r/20240609131546.3932-1-n.zhandarovich%40fintech.ru)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=75ddbf776dd04a09fb9e5267ead5d0c989f84506)

| -rw-r--r-- | [drivers/usb/atm/cxacru.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/atm/cxacru.c?id=75ddbf776dd04a09fb9e5267ead5d0c989f84506) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 0 deletions

| diff --git a/drivers/usb/atm/cxacru.c b/drivers/usb/atm/cxacru.cindex e62a770a5d3bf6..1d2c736dbf6ae6 100644--- a/[drivers/usb/atm/cxacru.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/atm/cxacru.c?id=621e90201c84b8fc427c433738a11495d05422d0)+++ b/[drivers/usb/atm/cxacru.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/atm/cxacru.c?id=75ddbf776dd04a09fb9e5267ead5d0c989f84506)@@ -1134,6 +1134,7 @@ static int cxacru\_bind(struct usbatm\_data \*usbatm\_instance, struct cxacru\_data \*instance; struct usb\_device \*usb\_dev = interface\_to\_usbdev(intf); struct usb\_host\_endpoint \*cmd\_ep = usb\_dev->ep\_in[CXACRU\_EP\_CMD];+ struct usb\_endpoint\_descriptor \*in, \*out; int ret;  /\* instance init \*/@@ -1180,6 +1181,19 @@ static int cxacru\_bind(struct usbatm\_data \*usbatm\_instance, goto fail; } + if (usb\_endpoint\_xfer\_int(&cmd\_ep->desc))+ ret = usb\_find\_common\_endpoints(intf->cur\_altsetting,+ NULL, NULL, &in, &out);+ else+ ret = usb\_find\_common\_endpoints(intf->cur\_altsetting,+ &in, &out, NULL, NULL);++ if (ret) {+ usb\_err(usbatm\_instance, "cxacru\_bind: interface has incorrect endpoints\n");+ ret = -ENODEV;+ goto fail;+ }+ if ((cmd\_ep->desc.bmAttributes & USB\_ENDPOINT\_XFERTYPE\_MASK) == USB\_ENDPOINT\_XFER\_INT) { usb\_fill\_int\_urb(instance->rcv\_urb, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:35:21 +0000

