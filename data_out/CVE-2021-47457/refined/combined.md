=== Content from git.kernel.org_697396f3_20250111_041705.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9acf636215a6ce9362fe618e7da4913b8bfe84c8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9acf636215a6ce9362fe618e7da4913b8bfe84c8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9acf636215a6ce9362fe618e7da4913b8bfe84c8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9acf636215a6ce9362fe618e7da4913b8bfe84c8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ziyang Xuan <william.xuanziyang@huawei.com> | 2021-10-09 15:40:18 +0800 |
| --- | --- | --- |
| committer | Marc Kleine-Budde <mkl@pengutronix.de> | 2021-10-17 14:17:55 +0200 |
| commit | [9acf636215a6ce9362fe618e7da4913b8bfe84c8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9acf636215a6ce9362fe618e7da4913b8bfe84c8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9acf636215a6ce9362fe618e7da4913b8bfe84c8)) | |
| tree | [8582881730d5420495a73df051433c071acbc21c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9acf636215a6ce9362fe618e7da4913b8bfe84c8) | |
| parent | [a4fbe70c5cb746441d56b28cf88161d9e0e25378](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a4fbe70c5cb746441d56b28cf88161d9e0e25378) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9acf636215a6ce9362fe618e7da4913b8bfe84c8&id2=a4fbe70c5cb746441d56b28cf88161d9e0e25378)) | |
| download | [linux-9acf636215a6ce9362fe618e7da4913b8bfe84c8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9acf636215a6ce9362fe618e7da4913b8bfe84c8.tar.gz) | |

can: isotp: isotp\_sendmsg(): add result check for wait\_event\_interruptible()Using wait\_event\_interruptible() to wait for complete transmission,
but do not check the result of wait\_event\_interruptible() which can be
interrupted. It will result in TX buffer has multiple accessors and
the later process interferes with the previous process.
Following is one of the problems reported by syzbot.
=============================================================
WARNING: CPU: 0 PID: 0 at net/can/isotp.c:840 isotp\_tx\_timer\_handler+0x2e0/0x4c0
CPU: 0 PID: 0 Comm: swapper/0 Not tainted 5.13.0-rc7+ #68
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.13.0-1ubuntu1 04/01/2014
RIP: 0010:isotp\_tx\_timer\_handler+0x2e0/0x4c0
Call Trace:
<IRQ>
? isotp\_setsockopt+0x390/0x390
\_\_hrtimer\_run\_queues+0xb8/0x610
hrtimer\_run\_softirq+0x91/0xd0
? rcu\_read\_lock\_sched\_held+0x4d/0x80
\_\_do\_softirq+0xe8/0x553
irq\_exit\_rcu+0xf8/0x100
sysvec\_apic\_timer\_interrupt+0x9e/0xc0
</IRQ>
asm\_sysvec\_apic\_timer\_interrupt+0x12/0x20
Add result check for wait\_event\_interruptible() in isotp\_sendmsg()
to avoid multiple accessers for tx buffer.
Fixes: e057dd3fc20f ("can: add ISO 15765-2:2016 transport protocol")
Link: [https://lore.kernel.org/all/10ca695732c9dd267c76a3c30f37aefe1ff7e32f.1633764159.git.william.xuanziyang@huawei.com](https://lore.kernel.org/all/10ca695732c9dd267c76a3c30f37aefe1ff7e32f.1633764159.git.william.xuanziyang%40huawei.com)
Cc: stable@vger.kernel.org
Reported-by: syzbot+78bab6958a614b0c80b9@syzkaller.appspotmail.com
Signed-off-by: Ziyang Xuan <william.xuanziyang@huawei.com>
Acked-by: Oliver Hartkopp <socketcan@hartkopp.net>
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9acf636215a6ce9362fe618e7da4913b8bfe84c8)

| -rw-r--r-- | [net/can/isotp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/can/isotp.c?id=9acf636215a6ce9362fe618e7da4913b8bfe84c8) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/net/can/isotp.c b/net/can/isotp.cindex caaa532ece9492..2ac29c2b2ca6d2 100644--- a/[net/can/isotp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/isotp.c?id=a4fbe70c5cb746441d56b28cf88161d9e0e25378)+++ b/[net/can/isotp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/isotp.c?id=9acf636215a6ce9362fe618e7da4913b8bfe84c8)@@ -865,7 +865,9 @@ static int isotp\_sendmsg(struct socket \*sock, struct msghdr \*msg, size\_t size) return -EAGAIN;  /\* wait for complete transmission of current pdu \*/- wait\_event\_interruptible(so->wait, so->tx.state == ISOTP\_IDLE);+ err = wait\_event\_interruptible(so->wait, so->tx.state == ISOTP\_IDLE);+ if (err)+ return err; }  if (!size || size > MAX\_MSG\_LENGTH) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:15:43 +0000



=== Content from git.kernel.org_3e496b83_20250111_041705.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=053bc12df0d6097c1126d0e14fa778a0a8faeb64)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=053bc12df0d6097c1126d0e14fa778a0a8faeb64)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=053bc12df0d6097c1126d0e14fa778a0a8faeb64)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=053bc12df0d6097c1126d0e14fa778a0a8faeb64)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ziyang Xuan <william.xuanziyang@huawei.com> | 2021-10-09 15:40:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-27 09:56:50 +0200 |
| commit | [053bc12df0d6097c1126d0e14fa778a0a8faeb64](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=053bc12df0d6097c1126d0e14fa778a0a8faeb64) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=053bc12df0d6097c1126d0e14fa778a0a8faeb64)) | |
| tree | [7dee95ec90adf41b30d988c4b43094b9ff1534f7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=053bc12df0d6097c1126d0e14fa778a0a8faeb64) | |
| parent | [0917fb04069a51c5458a5ca95b7859de88cb61b8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0917fb04069a51c5458a5ca95b7859de88cb61b8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=053bc12df0d6097c1126d0e14fa778a0a8faeb64&id2=0917fb04069a51c5458a5ca95b7859de88cb61b8)) | |
| download | [linux-053bc12df0d6097c1126d0e14fa778a0a8faeb64.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-053bc12df0d6097c1126d0e14fa778a0a8faeb64.tar.gz) | |

can: isotp: isotp\_sendmsg(): add result check for wait\_event\_interruptible()commit 9acf636215a6ce9362fe618e7da4913b8bfe84c8 upstream.
Using wait\_event\_interruptible() to wait for complete transmission,
but do not check the result of wait\_event\_interruptible() which can be
interrupted. It will result in TX buffer has multiple accessors and
the later process interferes with the previous process.
Following is one of the problems reported by syzbot.
=============================================================
WARNING: CPU: 0 PID: 0 at net/can/isotp.c:840 isotp\_tx\_timer\_handler+0x2e0/0x4c0
CPU: 0 PID: 0 Comm: swapper/0 Not tainted 5.13.0-rc7+ #68
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.13.0-1ubuntu1 04/01/2014
RIP: 0010:isotp\_tx\_timer\_handler+0x2e0/0x4c0
Call Trace:
<IRQ>
? isotp\_setsockopt+0x390/0x390
\_\_hrtimer\_run\_queues+0xb8/0x610
hrtimer\_run\_softirq+0x91/0xd0
? rcu\_read\_lock\_sched\_held+0x4d/0x80
\_\_do\_softirq+0xe8/0x553
irq\_exit\_rcu+0xf8/0x100
sysvec\_apic\_timer\_interrupt+0x9e/0xc0
</IRQ>
asm\_sysvec\_apic\_timer\_interrupt+0x12/0x20
Add result check for wait\_event\_interruptible() in isotp\_sendmsg()
to avoid multiple accessers for tx buffer.
Fixes: e057dd3fc20f ("can: add ISO 15765-2:2016 transport protocol")
Link: [https://lore.kernel.org/all/10ca695732c9dd267c76a3c30f37aefe1ff7e32f.1633764159.git.william.xuanziyang@huawei.com](https://lore.kernel.org/all/10ca695732c9dd267c76a3c30f37aefe1ff7e32f.1633764159.git.william.xuanziyang%40huawei.com)
Cc: stable@vger.kernel.org
Reported-by: syzbot+78bab6958a614b0c80b9@syzkaller.appspotmail.com
Signed-off-by: Ziyang Xuan <william.xuanziyang@huawei.com>
Acked-by: Oliver Hartkopp <socketcan@hartkopp.net>
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=053bc12df0d6097c1126d0e14fa778a0a8faeb64)

| -rw-r--r-- | [net/can/isotp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/can/isotp.c?id=053bc12df0d6097c1126d0e14fa778a0a8faeb64) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/net/can/isotp.c b/net/can/isotp.cindex c3bbbf4bb84771..9492009bc4ae23 100644--- a/[net/can/isotp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/isotp.c?id=0917fb04069a51c5458a5ca95b7859de88cb61b8)+++ b/[net/can/isotp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/isotp.c?id=053bc12df0d6097c1126d0e14fa778a0a8faeb64)@@ -863,7 +863,9 @@ static int isotp\_sendmsg(struct socket \*sock, struct msghdr \*msg, size\_t size) return -EAGAIN;  /\* wait for complete transmission of current pdu \*/- wait\_event\_interruptible(so->wait, so->tx.state == ISOTP\_IDLE);+ err = wait\_event\_interruptible(so->wait, so->tx.state == ISOTP\_IDLE);+ if (err)+ return err; }  if (!size || size > MAX\_MSG\_LENGTH) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:15:42 +0000



=== Content from git.kernel.org_09fc8b13_20250111_041707.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a76abedd2be3926d6deba236a935c7f98abf9110)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a76abedd2be3926d6deba236a935c7f98abf9110)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a76abedd2be3926d6deba236a935c7f98abf9110)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a76abedd2be3926d6deba236a935c7f98abf9110)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ziyang Xuan <william.xuanziyang@huawei.com> | 2021-10-09 15:40:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-27 09:59:41 +0200 |
| commit | [a76abedd2be3926d6deba236a935c7f98abf9110](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a76abedd2be3926d6deba236a935c7f98abf9110) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a76abedd2be3926d6deba236a935c7f98abf9110)) | |
| tree | [e8f6bd12a1c30a3d560232262bca402f1f2ee5fb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a76abedd2be3926d6deba236a935c7f98abf9110) | |
| parent | [1d12d110a820de91c3357f02333539d05c225e88](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1d12d110a820de91c3357f02333539d05c225e88) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a76abedd2be3926d6deba236a935c7f98abf9110&id2=1d12d110a820de91c3357f02333539d05c225e88)) | |
| download | [linux-a76abedd2be3926d6deba236a935c7f98abf9110.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a76abedd2be3926d6deba236a935c7f98abf9110.tar.gz) | |

can: isotp: isotp\_sendmsg(): add result check for wait\_event\_interruptible()commit 9acf636215a6ce9362fe618e7da4913b8bfe84c8 upstream.
Using wait\_event\_interruptible() to wait for complete transmission,
but do not check the result of wait\_event\_interruptible() which can be
interrupted. It will result in TX buffer has multiple accessors and
the later process interferes with the previous process.
Following is one of the problems reported by syzbot.
=============================================================
WARNING: CPU: 0 PID: 0 at net/can/isotp.c:840 isotp\_tx\_timer\_handler+0x2e0/0x4c0
CPU: 0 PID: 0 Comm: swapper/0 Not tainted 5.13.0-rc7+ #68
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.13.0-1ubuntu1 04/01/2014
RIP: 0010:isotp\_tx\_timer\_handler+0x2e0/0x4c0
Call Trace:
<IRQ>
? isotp\_setsockopt+0x390/0x390
\_\_hrtimer\_run\_queues+0xb8/0x610
hrtimer\_run\_softirq+0x91/0xd0
? rcu\_read\_lock\_sched\_held+0x4d/0x80
\_\_do\_softirq+0xe8/0x553
irq\_exit\_rcu+0xf8/0x100
sysvec\_apic\_timer\_interrupt+0x9e/0xc0
</IRQ>
asm\_sysvec\_apic\_timer\_interrupt+0x12/0x20
Add result check for wait\_event\_interruptible() in isotp\_sendmsg()
to avoid multiple accessers for tx buffer.
Fixes: e057dd3fc20f ("can: add ISO 15765-2:2016 transport protocol")
Link: [https://lore.kernel.org/all/10ca695732c9dd267c76a3c30f37aefe1ff7e32f.1633764159.git.william.xuanziyang@huawei.com](https://lore.kernel.org/all/10ca695732c9dd267c76a3c30f37aefe1ff7e32f.1633764159.git.william.xuanziyang%40huawei.com)
Cc: stable@vger.kernel.org
Reported-by: syzbot+78bab6958a614b0c80b9@syzkaller.appspotmail.com
Signed-off-by: Ziyang Xuan <william.xuanziyang@huawei.com>
Acked-by: Oliver Hartkopp <socketcan@hartkopp.net>
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a76abedd2be3926d6deba236a935c7f98abf9110)

| -rw-r--r-- | [net/can/isotp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/can/isotp.c?id=a76abedd2be3926d6deba236a935c7f98abf9110) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/net/can/isotp.c b/net/can/isotp.cindex 4b8d2ee6e2a492..7b19dedd7aa2f0 100644--- a/[net/can/isotp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/isotp.c?id=1d12d110a820de91c3357f02333539d05c225e88)+++ b/[net/can/isotp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/isotp.c?id=a76abedd2be3926d6deba236a935c7f98abf9110)@@ -865,7 +865,9 @@ static int isotp\_sendmsg(struct socket \*sock, struct msghdr \*msg, size\_t size) return -EAGAIN;  /\* wait for complete transmission of current pdu \*/- wait\_event\_interruptible(so->wait, so->tx.state == ISOTP\_IDLE);+ err = wait\_event\_interruptible(so->wait, so->tx.state == ISOTP\_IDLE);+ if (err)+ return err; }  if (!size || size > MAX\_MSG\_LENGTH) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:15:44 +0000


