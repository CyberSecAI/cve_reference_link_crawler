Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT344359)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T344359
# CVE-2023-45369: pagetriagelist API leaks suppressed usernamesClosed, Resolved[Public](/policy/explain/PHID-TASK-winff42pmisowqq7py7p/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/344359/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/344359/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-winff42pmisowqq7py7p/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-winff42pmisowqq7py7p/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-winff42pmisowqq7py7p/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-winff42pmisowqq7py7p/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-winff42pmisowqq7py7p/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-winff42pmisowqq7py7p/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-winff42pmisowqq7py7p/)
* [Protect as security issue](/wmf/escalate-task/344359/)
* [Award Token](/token/give/PHID-TASK-winff42pmisowqq7py7p/)
* [Flag For Later](/flag/edit/PHID-TASK-winff42pmisowqq7py7p/)

Assigned To

|  | [Soda](/p/Soda/) |
| --- | --- |

Authored By

|  | [Soda](/p/Soda/) |
| --- | --- |
| Aug 16 2023, 2:59 PM2023-08-16 14:59:53 (UTC+0) |

Tags

* [Security-Team](/tag/security-team/) [(Watching)](/project/board/1179/)
* [Security](/tag/security/)
* [PageTriage](/tag/pagetriage/) [(Done)](/project/board/541/)
* [Vuln-Infoleak](/tag/vuln-infoleak/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
* [Moderator-Tools-Team (Kanban)](/project/view/5880/) [(Done)](/project/board/5880/)
Referenced Files

|  | [F37767319: 01-T344359-rev2.patch](/F37767319) |
| --- | --- |
| Sep 25 2023, 7:59 PM2023-09-25 19:59:19 (UTC+0) |

|  | [F37720845: 0001-Don-t-expose-usernames-if-user-is-hidden.patch](/F37720845) |
| --- | --- |
| Sep 14 2023, 11:17 AM2023-09-14 11:17:49 (UTC+0) |

|  | [F37718734: Screenshot from 2023-09-14 01-41-52.png](/F37718734) |
| --- | --- |
| Sep 13 2023, 8:12 PM2023-09-13 20:12:53 (UTC+0) |

|  | [F37718732: 0001-Don-t-expose-usernames-if-user-is-hidden.patch](/F37718732) |
| --- | --- |
| Sep 13 2023, 8:12 PM2023-09-13 20:12:53 (UTC+0) |

|  | [F37718562: 0001-Don-t-expose-usernames-if-user-is-hidden.patch](/F37718562) |
| --- | --- |
| Sep 13 2023, 7:23 PM2023-09-13 19:23:09 (UTC+0) |

|  | [F37718444: T344359-use-same-presentation-as-core-changelists.patch](/F37718444) |
| --- | --- |
| Sep 13 2023, 5:57 PM2023-09-13 17:57:20 (UTC+0) |

|  | [F37718385: image.png](/F37718385) |
| --- | --- |
| Sep 13 2023, 4:08 PM2023-09-13 16:08:22 (UTC+0) |

|  | [F37713251: 0001-Don-t-expose-usernames-if-user-is-hidden.patch](/F37713251) |
| --- | --- |
| Sep 12 2023, 8:40 PM2023-09-12 20:40:09 (UTC+0) |

[View All 16 Files](/file/ui/curtain/list/PHID-TASK-winff42pmisowqq7py7p/)Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [gerritbot](/p/gerritbot/) |
| --- | --- |

|  | [• jnuche](/p/jnuche/) |
| --- | --- |

|  | [jsn.sherman](/p/jsn.sherman/) |
| --- | --- |

|  | [Mstyles](/p/Mstyles/) |
| --- | --- |

|  | [Novem\_Linguae](/p/Novem_Linguae/) |
| --- | --- |

|  | [Samwalton9-WMF](/p/Samwalton9-WMF/) |
| --- | --- |

[View All 11 Subscribers](/subscriptions/list/PHID-TASK-winff42pmisowqq7py7p/)
# Description

### Reproduction steps

* Create three users, "Admin" a user with oversighter privileges, "Person1" a user with normal user privileges, "Person2" a user with administrator privileges
* Create a page using the "Person1" account (say "New Page")
* Using the "Admin" account, block "Person1" with the the "Hide username from edits and lists" option checked.
* Use the "Person2" account to review New Page and click on the information icon on the PageTriage toolbar.

### Expected behaviour

Person1's name should not appear in the interface

### Behaviour seen

Person2 is able to see the following text in the toolbar: "This page was created on 16 August 2023 by Person1 (talk | contribs)"

# Details

Author Affiliation Wikimedia Communities

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [SECURITY: Don't expose usernames if user is hidden](https://gerrit.wikimedia.org/r/c/960676) | [mediawiki/extensions/PageTriage](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/PageTriage) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/PageTriage/%2B/master) | +90 -31 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T344359)
# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  | Resolved |  | [Samwalton9-WMF](/p/Samwalton9-WMF/) | T349553 [[EPIC] Moderator Tools Maintenance Work](/T349553) |
|  |  | Resolved |  | [Samwalton9-WMF](/p/Samwalton9-WMF/) | T338040 [[Epic] Q1 FY 2023-24 Moderator Tools Maintenance Work](/T338040) |
|  |  | Resolved | Security | [Soda](/p/Soda/) | T344359 [CVE-2023-45369: pagetriagelist API leaks suppressed usernames](/T344359) |

Mentioned In [T345889: 1.41.0-wmf.28 deployment blockers](/T345889)
[T340874: Write and send supplementary release announcement for extensions and skins with security patches (1.35.12/1.39.5/1.40.1)](/T340874)
### Event Timeline

There are a very large number of changes, so older changes are hidden. [Show Older Changes](/transactions/showolder/PHID-TASK-winff42pmisowqq7py7p/?after=9098063&quoteTargetID=UQ0_1&quoteRef=T344359)[Novem\_Linguae](/p/Novem_Linguae/) moved this task from [Backlog](/project/board/541/) to [Priority security](/project/board/541/) on the [PageTriage](/tag/pagetriage/) board.[Aug 17 2023, 4:33 AM2023-08-17 04:33:57 (UTC+0)](#9098064)[Novem\_Linguae](/p/Novem_Linguae/) added a comment.Edited · [Aug 18 2023, 9:06 AM2023-08-18 09:06:35 (UTC+0)](#9101261)Comment Actions

Suggested fix after chatting with Soda:

* change the code that writes the metadata to write blank / "(hidden)" / "(suppressed)" to the username if the username of that revision is suppressed. oversighters can use normal tools such as page history if they need that information.
* to capture suppressions after the initial article creation, add onSuppress() style hooks that do the same as above

I would not recommend going in the direction of adding a usernameIsSuppressed metadata field to pagetriage\_page\_tags SQL to track this. That would add a lot of complexity.

I would not recommend going in the direction of trying to decide if the user is a suppressor and then showing them the data if they are. It adds a lot of complexity.

[Samwalton9-WMF](/p/Samwalton9-WMF/) added a parent task: [T338040: [Epic] Q1 FY 2023-24 Moderator Tools Maintenance Work](/T338040).[Aug 18 2023, 9:28 AM2023-08-18 09:28:57 (UTC+0)](#9101309)[Novem\_Linguae](/p/Novem_Linguae/) renamed this task from PageTriage shows oversighted usernames to pagetriagelist API leaks suppressed usernames.[Aug 18 2023, 9:34 AM2023-08-18 09:34:52 (UTC+0)](#9101322)[Novem\_Linguae](/p/Novem_Linguae/) added a comment.[Aug 18 2023, 9:41 AM2023-08-18 09:41:44 (UTC+0)](#9101340)Comment Actions

Related: {T234584}

This is probably very rare, but don't stewards have a hide username option too? We may need a similar ticket for that.

[MediaWiki-extensions-CentralAuth](/tag/mediawiki-extensions-centralauth/)

centralauth-suppress

[sbassett](/p/sbassett/) subscribed.[Aug 23 2023, 7:39 PM2023-08-23 19:39:10 (UTC+0)](#9114830)Comment Actions
> In [T344359#9101340](/T344359#9101340), [@Novem\_Linguae](/p/Novem_Linguae/) wrote:
>
> Related: {T234584}

This appears to be the same issue, so this task should likely be merged into that existing task. Unless there's some subtle difference between the two that isn't immediately obvious.

[Novem\_Linguae](/p/Novem_Linguae/) added a comment.[Aug 23 2023, 11:43 PM2023-08-23 23:43:51 (UTC+0)](#9115382)Comment Actions

[@sbassett](/p/sbassett/) Revision deletion and suppression are different. Looks like both functionalities are in core now, so the main difference (I think) is the permissions deleterevision versus suppressrevision. But you're right, the fix for each will probably be similar.

Up to you. With that said, think we should merge or keep separate?

[Soda](/p/Soda/) added a comment.[Aug 24 2023, 5:50 AM2023-08-24 05:50:20 (UTC+0)](#9115702)Comment Actions

I spent some time yesterday coming up with a patch for this specific case (using User->isHidden()) lmk if there is anything I missed (which is probable since I'm not super familiar with the codebase).

0001-Don-t-expose-usernames-if-user-is-hidden.patch13 KB[Download](https://phab.wmfusercontent.org/file/download/2erkgtafskxibtrwyr3o/PHID-FILE-uszhl7yl3bsbeyexvhsc/0001-Don-t-expose-usernames-if-user-is-hidden.patch)

> In [T344359#9115382](/T344359#9115382), [@Novem\_Linguae](/p/Novem_Linguae/) wrote:
>
> [@sbassett](/p/sbassett/) Revision deletion and suppression are different. Looks like both functionalities are in core now, so the main difference (I think) is the permissions deleterevision versus suppressrevision. But you're right, the fix for each will probably be similar.
>
> Up to you. With that said, think we should merge or keep separate?

This should be about the (hideuser) permission imo.

[Soda](/p/Soda/) added a comment.[Aug 24 2023, 2:01 PM2023-08-24 14:01:11 (UTC+0)](#9117172)Comment Actions

Actually it appears there were a few linting errors with the previous patch, this should be the updated one:

0001-Don-t-expose-usernames-if-user-is-hidden.patch13 KB[Download](https://phab.wmfusercontent.org/file/download/wmdekbjn5kmfa4eg7nck/PHID-FILE-bw6iou4suy7k4v7ipdmp/0001-Don-t-expose-usernames-if-user-is-hidden.patch)

[taavi](/p/taavi/) subscribed.[Aug 25 2023, 6:42 AM2023-08-25 06:42:47 (UTC+0)](#9119338)Comment Actions

Untested, but CR-1 based on reading the code:

```
diff --git a/i18n/en.json b/i18n/en.json
index edfd73f8..0c0e44d3 100644
--- a/i18n/en.json
+++ b/i18n/en.json
@@ -34,9 +34,11 @@
 	"pagetriage-no-author": "No author information present",
 	"pagetriage-byline": "Created by $1 ($2$3$4)",
 	"pagetriage-byline-heading": "Created by {{GENDER:$1}}",
+	"pagetriage-byline-hidden-username": "Created by ",
 	"pagetriage-byline-new-editor": "Created by new editor $1 ($2$3$4)",
 	"pagetriage-byline-new-editor-heading": "Created by a {{GENDER:$1|new editor}}",
 	"pagetriage-articleinfo-byline": "This page was created on $1 by $2 ($3$4$5)",
+	"pagetriage-articleinfo-byline-hidden-username": "This page was created on $1 by ",
 	"pagetriage-articleinfo-byline-new-editor": "This page was created on $1 by new editor $2 ($3$4$5)",
 	"pagetriage-editcount": "$1 {{PLURAL:$1|edit|edits}} since $2",
 	"pagetriage-author-not-autoconfirmed": "New editor",
```

Username should be a parameter to both messages, as not all languages use the same order of words as English does.

```
diff --git a/i18n/qqq.json b/i18n/qqq.json
index f8902fec..f64e32d3 100644
--- a/includes/Api/ApiPageTriageList.php
+++ b/includes/Api/ApiPageTriageList.php
@@ -27,6 +28,8 @@ class ApiPageTriageList extends ApiBase {
 		$opts = $this->extractRequestParams();
 		$pages = null;

+		$userFactory = MediaWikiServices::getInstance()->getUserFactory();
```

Please inject.

```
diff --git a/modules/ext.pageTriage.list/components/ListItem.vue b/modules/ext.pageTriage.list/components/ListItem.vue
index 50e317e1..048f61ce 100644
--- a/modules/ext.pageTriage.list/components/ListItem.vue
+++ b/modules/ext.pageTriage.list/components/ListItem.vue
@@ -185,6 +193,7 @@ module.exports = {
          */
 		// Creator information tags
 		creatorUserId: { type: Number, required: true },
+		creatorHidden: { type: Boolean, required: true },
```

This is marked as required: true, but not set in ApiPageTriageList::createUserInfo().

[Soda](/p/Soda/) added a comment.Edited · [Aug 25 2023, 8:56 AM2023-08-25 08:56:26 (UTC+0)](#9119611)Comment Actions

I made the changes requested as well as fixed some other related issues with the patch that came up while I was testing it (interop with wikilove/tagging etc).

0001-Don-t-expose-usernames-if-user-is-hidden.patch19 KB[Download](https://phab.wmfusercontent.org/file/download/wex3nvjp2wfieiiwyczl/PHID-FILE-c5r7khtoxuhnumfy3y4a/0001-Don-t-expose-usernames-if-user-is-hidden.patch)

> In [T344359#9119338](/T344359#9119338), [@taavi](/p/taavi/) wrote:
>
> Untested, but CR-1 based on reading the code:
>
> ```
> diff --git a/i18n/en.json b/i18n/en.json
> index edfd73f8..0c0e44d3 100644
> --- a/i18n/en.json
> +++ b/i18n/en.json
> @@ -34,9 +34,11 @@
>  	"pagetriage-no-author": "No author information present",
>  	"pagetriage-byline": "Created by $1 ($2$3$4)",
>  	"pagetriage-byline-heading": "Created by {{GENDER:$1}}",
> +	"pagetriage-byline-hidden-username": "Created by ",
>  	"pagetriage-byline-new-editor": "Created by new editor $1 ($2$3$4)",
>  	"pagetriage-byline-new-editor-heading": "Created by a {{GENDER:$1|new editor}}",
>  	"pagetriage-articleinfo-byline": "This page was created on $1 by $2 ($3$4$5)",
> +	"pagetriage-articleinfo-byline-hidden-username": "This page was created on $1 by ",
>  	"pagetriage-articleinfo-byline-new-editor": "This page was created on $1 by new editor $2 ($3$4$5)",
>  	"pagetriage-editcount": "$1 {{PLURAL:$1|edit|edits}} since $2",
>  	"pagetriage-author-not-autoconfirmed": "New editor",
> ```
>
> Username should be a parameter to both messages, as not all languages use the same order of words as English does.

Yeah good point, hadn't thought about that.

> ```
> diff --git a/i18n/qqq.json b/i18n/qqq.json
> index f8902fec..f64e32d3 100644
> --- a/includes/Api/ApiPageTriageList.php
> +++ b/includes/Api/ApiPageTriageList.php
> @@ -27,6 +28,8 @@ class ApiPageTriageList extends ApiBase {
>  		$opts = $this->extractRequestParams();
>  		$pages = null;
>
> +		$userFactory = MediaWikiServices::getInstance()->getUserFactory();
> ```
>
> Please inject.

Done

> ```
> diff --git a/modules/ext.pageTriage.list/components/ListItem.vue b/modules/ext.pageTriage.list/components/ListItem.vue
> index 50e317e1..048f61ce 100644
> --- a/modules/ext.pageTriage.list/components/ListItem.vue
> +++ b/modules/ext.pageTriage.list/components/ListItem.vue
> @@ -185,6 +193,7 @@ module.exports = {
>           */
>  		// Creator information tags
>  		creatorUserId: { type: Number, required: true },
> +		creatorHidden: { type: Boolean, required: true },
> ```
>
> This is marked as required: true, but not set in ApiPageTriageList::createUserInfo().

Changed this to creator\_hidden and made sure to define it in ApiPageTriageList::createUserInfo()

Edit: Liniting errors

[sbassett](/p/sbassett/) moved this task from [Incoming](/project/board/1179/) to [Security Patch To Deploy](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Aug 25 2023, 4:51 PM2023-08-25 16:51:09 (UTC+0)](#9120631)[sbassett](/p/sbassett/) added a project: [SecTeam-Processed](/tag/secteam-processed/).Comment Actions

If the above changes look good, we can get this patch deployed during this Monday's (2023-08-28) security deployment window.

[taavi](/p/taavi/) added a comment.[Aug 25 2023, 4:52 PM2023-08-25 16:52:15 (UTC+0)](#9120636)Comment Actions
> In [T344359#9119611](/T344359#9119611), [@Soda](/p/Soda/) wrote:
>
> 0001-Don-t-expose-usernames-if-user-is-hidden.patch19 KB[Download](https://phab.wmfusercontent.org/file/download/wex3nvjp2wfieiiwyczl/PHID-FILE-c5r7khtoxuhnumfy3y4a/0001-Don-t-expose-usernames-if-user-is-hidden.patch)

That patch isn't attached to this task so I can't see it.

[Soda](/p/Soda/) added a comment.Edited · [Aug 25 2023, 6:58 PM2023-08-25 18:58:53 (UTC+0)](#9121047)Comment Actions
> In [T344359#9120636](/T344359#9120636), [@taavi](/p/taavi/) wrote:
> > In [T344359#9119611](/T344359#9119611), [@Soda](/p/Soda/) wrote:
> >
> > 0001-Don-t-expose-usernames-if-user-is-hidden.patch19 KB[Download](https://phab.wmfusercontent.org/file/download/wex3nvjp2wfieiiwyczl/PHID-FILE-c5r7khtoxuhnumfy3y4a/0001-Don-t-expose-usernames-if-user-is-hidden.patch)
>
> That patch isn't attached to this task so I can't see it.

0001-Don-t-expose-usernames-if-user-is-hidden.patch19 KB[Download](https://phab.wmfusercontent.org/file/download/5bqf7bj4a32hdgte6sq5/PHID-FILE-hgntko737fgdpuv2ezv5/0001-Don-t-expose-usernames-if-user-is-hidden.patch)

Attached patch, not sure what happened with phabricator there :(

[Soda](/p/Soda/) attached a referenced file: [F37629487: 0001-Don-t-expose-usernames-if-user-is-hidden.patch](/F37629487). [(Show Details)](/transactions/detail/PHID-XACT-TASK-twxfl6swr75ujba/)[Aug 26 2023, 9:05 AM2023-08-26 09:05:25 (UTC+0)](#9121452)[Novem\_Linguae](/p/Novem_Linguae/) changed the task status from Open to In Progress.[Aug 27 2023, 5:41 PM2023-08-27 17:41:08 (UTC+0)](#9122080)[Novem\_Linguae](/p/Novem_Linguae/) assigned this task to [Soda](/p/Soda/).[Novem\_Linguae](/p/Novem_Linguae/) moved this task from [Priority security](/project/board/541/) to [Code Review](/project/board/541/) on the [PageTriage](/tag/pagetriage/) board.[Mstyles](/p/Mstyles/) subscribed.[Aug 28 2023, 4:31 PM2023-08-28 16:31:42 (UTC+0)](#9124284)Comment Actions

[@taavi](/p/taavi/) if you could get a chance to review this patch that would be great

[Samwalton9-WMF](/p/Samwalton9-WMF/) added subscribers: [jsn.sherman](/p/jsn.sherman/), [Scardenasmolinar](/p/Scardenasmolinar/).[Aug 29 2023, 3:27 PM2023-08-29 15:27:05 (UTC+0)](#9127608)Comment Actions

[@jsn.sherman](/p/jsn.sherman/) [@Scardenasmolinar](/p/Scardenasmolinar/) If one of you has time, this security patch is awaiting review.

[Scardenasmolinar](/p/Scardenasmolinar/) added a comment.Edited · [Aug 29 2023, 11:35 PM2023-08-29 23:35:12 (UTC+0)](#9129178)Comment Actions

I can't see the patch either when I click on the link or perform a Gerrit search of the patch.

[Soda](/p/Soda/) added a comment.[Aug 30 2023, 3:57 AM2023-08-30 03:57:10 (UTC+0)](#9129399)Comment Actions
> In [T344359#9129178](/T344359#9129178), [@Scardenasmolinar](/p/Scardenasmolinar/) wrote:
>
> I can't see the patch either when I click on the link or perform a Gerrit search of the patch.

You will need to download the patch from the link, we are [explicitly not using Gerrit since it is a security bug](https://m.mediawiki.org/wiki/Developing_security_patches)

[sbassett](/p/sbassett/) added a comment.[Aug 30 2023, 8:27 PM2023-08-30 20:27:33 (UTC+0)](#9132180)Comment Actions

I verified that the new patch from [T344359#9121047](/T344359#9121047) applies cleanly to ext:PageTriage@master and @wmf/1.41.0-wmf.24. phpcs and phan seem to run fine on both branches with the patch applied, save for a few (likely unrelated) PhanRedefinedClassReference for \Psr\Log\LoggerInterface with Echo (as PageTriage wants Echo installed since all hooks are under a single Hooks key within extension.json). The logic seems sound within ApiPageTriageList.php and the vue/js files, but I haven't tested it locally.

[sbassett](/p/sbassett/) added a comment.[Sep 11 2023, 9:28 PM2023-09-11 21:28:51 (UTC+0)](#9158550)Comment Actions

[@Samwalton9-WMF](/p/Samwalton9-WMF/) [@Scardenasmolinar](/p/Scardenasmolinar/) [@Soda](/p/Soda/) - In attempt to make this easier, I hope, here is the full text of the patch from [T344359#9121047](/T344359#9121047). We could definitely use a bit more CR from subject matter experts on this before we security-deploy it. Thanks.

01-T344359.patch
```
From 644c70e74afa0a2a4a40e9957c71cd5768df8f75 Mon Sep 17 00:00:00 2001
From: Sohom <sohomdatta1+git@gmail.com>
Date: Wed, 23 Aug 2023 22:18:50 +0530
Subject: [PATCH] Don't expose usernames if user is hidden

- Remove user_name and user info from 'pagetriagelist' API
- Add user_hidden field to 'pagetriagelist' API
- Modify pagetriage toolbar to handle cases where no username
is provided
- Modify Special:NewPagesFeed to gracefully handle cases where
the username is hidden
- Add a special case in the Special:NewPagesFeed vue version
for hidden usernames (where other information is availiable)

Bug: T344359
Change-Id: I5714f69a70909e3c3e7322e5f3be62d837e4d1cc
---
 extension.json                                | 14 ++++++-
 i18n/en.json                                  |  2 +
 i18n/qqq.json                                 |  2 +
 includes/Api/ApiPageTriageList.php            | 37 +++++++++++++++----
 .../components/ListContent.vue                |  1 +
 .../components/ListItem.vue                   | 14 ++++++-
 .../models/ext.pageTriage.article.js          |  7 +++-
 .../ext.pageTriage.listItem.css               |  5 +++
 .../ext.pageTriage.listItem.underscore        |  8 +++-
 .../ext.pageTriage.views.toolbar/ToolView.js  |  1 +
 .../articleInfo.js                            | 10 ++++-
 .../articleInfo.underscore                    |  8 +++-
 modules/ext.pageTriage.views.toolbar/mark.js  |  3 +-
 modules/ext.pageTriage.views.toolbar/tags.js  |  2 +-
 .../ext.pageTriage.views.toolbar/wikiLove.js  |  7 +++-
 15 files changed, 104 insertions(+), 17 deletions(-)

diff --git a/extension.json b/extension.json
index 477d637a..648c7bdf 100644
--- a/extension.json
+++ b/extension.json
@@ -15,7 +15,12 @@
 		"MediaWiki": ">= 1.41"
 	},
 	"APIModules": {
-		"pagetriagelist": "MediaWiki\\Extension\\PageTriage\\Api\\ApiPageTriageList",
+		"pagetriagelist": {
+			"class": "MediaWiki\\Extension\\PageTriage\\Api\\ApiPageTriageList",
+			"services": [
+				"UserFactory"
+			]
+		},
 		"pagetriagestats": "MediaWiki\\Extension\\PageTriage\\Api\\ApiPageTriageStats",
 		"pagetriageaction": {
 			"class": "MediaWiki\\Extension\\PageTriage\\Api\\ApiPageTriageAction",
@@ -240,8 +245,11 @@
 				"pagetriage-mark-as-unreviewed",
 				"pagetriage-info-title",
 				"pagetriage-byline",
+				"rev-deleted-user",
+				"pagetriage-byline-hidden-username",
 				"pagetriage-byline-new-editor",
 				"pagetriage-articleinfo-byline",
+				"pagetriage-articleinfo-byline-hidden-username",
 				"pagetriage-articleinfo-byline-new-editor",
 				"pipe-separator",
 				"pagetriage-edits",
@@ -391,6 +399,8 @@
 				"pagetriage-recreated",
 				"pagetriage-no-author",
 				"pagetriage-byline",
+				"pagetriage-byline-hidden-username",
+				"rev-deleted-user",
 				"pagetriage-byline-new-editor",
 				"pagetriage-editcount",
 				"pagetriage-author-not-autoconfirmed",
@@ -587,6 +597,7 @@
 				"pagetriage-no-author",
 				"pagetriage-no-pages",
 				"pagetriage-byline",
+				"pagetriage-byline-hidden-username",
 				"pagetriage-byline-heading",
 				"pagetriage-byline-new-editor",
 				"pagetriage-byline-new-editor-heading",
@@ -602,6 +613,7 @@
 				"pagetriage-unreviewed-article-count",
 				"pagetriage-reviewed-article-count-past-week",
 				"pagetriage-unreviewed-draft-count",
+				"rev-deleted-user",
 				"pagetriage-sort-by",
 				"pagetriage-newest",
 				"pagetriage-oldest",
diff --git a/i18n/en.json b/i18n/en.json
index edfd73f8..552f7e4d 100644
--- a/i18n/en.json
+++ b/i18n/en.json
@@ -34,9 +34,11 @@
 	"pagetriage-no-author": "No author information present",
 	"pagetriage-byline": "Created by $1 ($2$3$4)",
 	"pagetriage-byline-heading": "Created by {{GENDER:$1}}",
+	"pagetriage-byline-hidden-username": "Created by $1",
 	"pagetriage-byline-new-editor": "Created by new editor $1 ($2$3$4)",
 	"pagetriage-byline-new-editor-heading": "Created by a {{GENDER:$1|new editor}}",
 	"pagetriage-articleinfo-byline": "This page was created on $1 by $2 ($3$4$5)",
+	"pagetriage-articleinfo-byline-hidden-username": "This page was created on $1 by $2",
 	"pagetriage-articleinfo-byline-new-editor": "This page was created on $1 by new editor $2 ($3$4$5)",
 	"pagetriage-editcount": "$1 {{PLURAL:$1|edit|edits}} since $2",
 	"pagetriage-author-not-autoconfirmed": "New editor",
diff --git a/i18n/qqq.json b/i18n/qqq.json
index f8902fec..f64e32d3 100644
--- a/i18n/qqq.json
+++ b/i18n/qqq.json
@@ -53,10 +53,12 @@
 	"pagetriage-recreated": "Label indicating a page was previously deleted.",
 	"pagetriage-no-author": "Error message for missing page author information",
 	"pagetriage-byline": "Text indicating the page author.\n*$1 is a link to the author's user page.\n*$2 is a link to the author's talk page.\n*$3 is a separator character.\n*$4 is a link to the author's contributions.",
+	"pagetriage-byline-hidden-username": "Text indicating that a article was created by a author whoes name has been removed. This message is immediately followed by rev-deleted-user.",
 	"pagetriage-byline-heading": "Text indicating the page author. Parameters:\n* $1 - the author's username, used for GENDER support.",
 	"pagetriage-byline-new-editor": "Text indicating the page author (for when the author is a new editor). $1 is a link to the author's user page, $2 is a link to the author's talk page, $3 is a separator character, $4 is a link to the author's contributions.",
 	"pagetriage-byline-new-editor-heading": "Text indicating the page author (for when the author is a new editor). Parameters:\n* $1 - the 'author's username, used for GENDER support.",
 	"pagetriage-articleinfo-byline": "Text indicating the page author. $1 is the article creation date, $2 is a link to the author's user page, $3 is a link to the author's talk page, $4 is a separator character. $5 is a link to the author's contributions.",
+	"pagetriage-articleinfo-byline-hidden-username": "Text indicating that a article was created by a author whoes name has been removed in the article info section of the pagetriage toolbar. This message is immediately followed by rev-deleted-user.",
 	"pagetriage-articleinfo-byline-new-editor": "Text indicating the page author (for when the author is a new editor). Parameters:\n* $1 is the article creation date.\n* $2 is a link to the author's user page.\n* $3 is a link to the author's talk page.\n* $4 is a separator character\n* $5 is a link to the author's contributions.",
 	"pagetriage-editcount": "Display of page author's editing experience. $1 is total edit count, $2 is author's join date",
 	"pagetriage-author-not-autoconfirmed": "String indicating that the author was not yet autoconfirmed when the page was last edited",
diff --git a/includes/Api/ApiPageTriageList.php b/includes/Api/ApiPageTriageList.php
index a1e25ada..8b744631 100644
--- a/includes/Api/ApiPageTriageList.php
+++ b/includes/Api/ApiPageTriageList.php
@@ -3,12 +3,14 @@
 namespace MediaWiki\Extension\PageTriage\Api;

 use ApiBase;
+use ApiMain;
 use ApiResult;
 use MediaWiki\Extension\PageTriage\ArticleMetadata;
 use MediaWiki\Extension\PageTriage\OresMetadata;
 use MediaWiki\Extension\PageTriage\PageTriageUtil;
 use MediaWiki\Logger\LoggerFactory;
 use MediaWiki\Title\Title;
+use MediaWiki\User\UserFactory;
 use ORES\Services\ORESServices;
 use SpecialPage;
 use Wikimedia\ParamValidator\ParamValidator;
@@ -22,6 +24,18 @@ use Wikimedia\ParamValidator\TypeDef\IntegerDef;
  */
 class ApiPageTriageList extends ApiBase {

+	/** @var UserFactory */
+	private UserFactory $userFactory;
+
+	/**
+	 * @param ApiMain $query
+	 * @param string $moduleName
+	 */
+	public function __construct( ApiMain $query, string $moduleName, UserFactory $userFactory ) {
+		$this->userFactory = $userFactory;
+		parent::__construct( $query, $moduleName );
+	}
+
 	public function execute() {
 		// Get the API parameters and store them
 		$opts = $this->extractRequestParams();
@@ -72,12 +86,20 @@ class ApiPageTriageList extends ApiBase {
 					$metaData[$page]['creation_date']
 				);

-				// Page creator
-				$metaData[$page] += $this->createUserInfo(
-					$metaData[$page]['user_name'],
-					$userPageStatus,
-					'creator'
-				);
+				if ( $metaData[$page]['user_name'] ) {
+					// Page creator
+					$user = $this->userFactory->newFromName( $metaData[$page]['user_name'] );
+					if ( $user && !$user->isHidden() ) {
+						$metaData[$page] += $this->createUserInfo(
+							$metaData[$page]['user_name'],
+							$userPageStatus,
+							'creator'
+						);
+					} else {
+						$metaData[$page]['user_name'] = null;
+						$metaData[$page]['creator_hidden'] = true;
+					}
+				}

 				// Page reviewer
 				if ( $metaData[$page]['reviewer'] ) {
@@ -103,7 +125,7 @@ class ApiPageTriageList extends ApiBase {
 				}

 				$metaData[$page][ApiResult::META_BC_BOOLS] = [
-					'creator_user_page_exist', 'creator_user_talk_page_exist',
+					'creator_hidden', 'creator_user_page_exist', 'creator_user_talk_page_exist',
 					'reviewer_user_page_exist', 'reviewer_user_talk_page_exist',
 				];

@@ -219,6 +241,7 @@ class ApiPageTriageList extends ApiBase {
 			$prefix . '_user_talk_page_exist' => isset( $userPageStatus[$userTalkPage->getPrefixedDBkey()] ),
 			$prefix . '_contribution_page' => $userContribsPage->getPrefixedText(),
 			$prefix . '_contribution_page_url' => $userContribsPage->getFullURL(),
+			$prefix . '_hidden' => false,
 		];
 	}

diff --git a/modules/ext.pageTriage.list/components/ListContent.vue b/modules/ext.pageTriage.list/components/ListContent.vue
index c20b7f13..fff2148a 100644
--- a/modules/ext.pageTriage.list/components/ListContent.vue
+++ b/modules/ext.pageTriage.list/components/ListContent.vue
@@ -58,6 +58,7 @@ const listItemPropFormatter = ( pageInfo ) => {
 	listItemProps.revCount = parseInt( pageInfo.rev_count );
 	listItemProps.creationDateUTC = pageInfo.creation_date_utc;
 	listItemProps.creatorName = pageInfo.user_name;
+	listItemProps.creatorHidden = pageInfo.creator_hidden;
 	listItemProps.creatorAutoConfirmed = pageInfo.user_autoconfirmed === '1';
 	listItemProps.creatorRegistrationUTC = pageInfo.user_creation_date;
 	listItemProps.creatorUserId = parseInt( pageInfo.user_id );
diff --git a/modules/ext.pageTriage.list/components/ListItem.vue b/modules/ext.pageTriage.list/components/ListItem.vue
index 50e317e1..278444ec 100644
--- a/modules/ext.pageTriage.list/components/ListItem.vue
+++ b/modules/ext.pageTriage.list/components/ListItem.vue
@@ -58,14 +58,21 @@
 			</div>
 			<div class="mwe-vue-pt-info-row">
 				<div>
-					<span v-if="creatorName">
+					<span v-if="creatorName || creatorHidden">
 						<creator-byline
+							v-if="creatorName"
 							:creator-name="creatorName"
+							:creator-hidden="creatorHidden"
 							:creator-user-id="creatorUserId"
 							:creator-auto-confirmed="creatorAutoConfirmed"
 							:creator-user-page-exists="creatorUserPageExists"
 							:creator-talk-page-exists="creatorTalkPageExists"
 						></creator-byline>
+						<template v-else>
+							<span class="mwe-pt-history-suppressed">
+								{{ $i18n( 'pagetriage-byline-hidden-username', $i18n( 'rev-deleted-user' ) ) }}
+							</span>
+						</template>
 						<span v-if="creatorUserId > 0">
 							{{ $i18n( 'pagetriage-dot-separator' ).text() }}
 							{{ $i18n( 'pagetriage-editcount', creatorEditCount, creatorRegistrationPretty ).text() }}
@@ -185,6 +192,7 @@ module.exports = {
          */
 		// Creator information tags
 		creatorUserId: { type: Number, required: true },
+		creatorHidden: { type: Boolean, required: true },
 		creatorName: { type: String, required: true },
 		creatorEditCount: { type: Number, required: true },
 		creatorRegistrationUTC: {
@@ -433,4 +441,8 @@ module.exports = {
 .ores-pt-issues {
 	height: 0.55em;
 }
+.mwe-pt-history-suppressed {
+	text-decoration-line: line-through;
+	text-decoration-style: double;
+}
 </style>
diff --git a/modules/ext.pageTriage.util/models/ext.pageTriage.article.js b/modules/ext.pageTriage.util/models/ext.pageTriage.article.js
index 4bb28dfc..048e7c57 100644
--- a/modules/ext.pageTriage.util/models/ext.pageTriage.article.js
+++ b/modules/ext.pageTriage.util/models/ext.pageTriage.article.js
@@ -106,7 +106,12 @@ const Article = Backbone.Model.extend( {
 					article.get( 'creator_user_page_exist' )
 				)
 			);
-			article.set( 'user_contribs_title', article.get( 'creator_contribution_page' ) );
+		} else if ( article.get( 'creator_hidden' ) ) {
+			article.set( 'author_byline_html', mw.msg( 'pagetriage-byline-hidden-username', mw.msg( 'rev-deleted-user' ) ) );
+			article.set(
+				'user_title_url',
+				mw.msg( 'rev-deleted-user' )
+			);
 		}

 		// Are there any PageTriage messages on the talk page?
diff --git a/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.css b/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.css
index 4d8f89e5..5016727f 100644
--- a/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.css
+++ b/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.css
@@ -123,6 +123,11 @@
 	display: table-cell;
 }

+.mwe-pt-history-suppressed {
+	text-decoration-line: line-through;
+	text-decoration-style: double;
+}
+
 .mwe-pt-potential-issues {
 	display: table-cell;
 	text-align: right;
diff --git a/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.underscore b/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.underscore
index 887c9e05..a8a5b924 100644
--- a/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.underscore
+++ b/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.underscore
@@ -105,7 +105,13 @@
 				<div class="mwe-pt-info-row">
 					<div class="mwe-pt-author">
 					<% if ( typeof( user_name ) !== "undefined" ) { %>
-						<%= author_byline_html %>
+						<% if ( !creator_hidden ) { %>
+							<%= author_byline_html %>
+						<% } else { %>
+							<span class="mwe-pt-history-suppressed">
+								<%= author_byline_html %>
+							</span>
+						<% } %>
 						<!-- user_id is undefined or '0' for IP users -->
 						<% if ( typeof ( user_id ) != 'undefined' && Number( user_id ) !== 0 ) { %>
 							&#xb7;
diff --git a/modules/ext.pageTriage.views.toolbar/ToolView.js b/modules/ext.pageTriage.views.toolbar/ToolView.js
index 74a96746..f2544fec 100644
--- a/modules/ext.pageTriage.views.toolbar/ToolView.js
+++ b/modules/ext.pageTriage.views.toolbar/ToolView.js
@@ -267,6 +267,7 @@ module.exports = Backbone.View.extend( {
 			pageid: mw.config.get( 'wgArticleId' ),
 			title: mw.config.get( 'wgPageName' ),
 			creator: this.model.get( 'user_name' ),
+			creatorHidden: this.model.get( 'creator_hidden' ),
 			reviewed: reviewed
 		}, data );
 	},
diff --git a/modules/ext.pageTriage.views.toolbar/articleInfo.js b/modules/ext.pageTriage.views.toolbar/articleInfo.js
index bc1c2c7a..a6c52484 100644
--- a/modules/ext.pageTriage.views.toolbar/articleInfo.js
+++ b/modules/ext.pageTriage.views.toolbar/articleInfo.js
@@ -109,6 +109,8 @@ module.exports = ToolView.extend( {
 			url.toString()
 		);

+		const offset = parseInt( mw.user.options.get( 'timecorrection' ).split( '|' )[ 1 ] );
+
 		// creator information
 		if ( this.model.get( 'user_name' ) ) {
 			// show new editor message only if the user is not anonymous and not autoconfirmed
@@ -119,7 +121,6 @@ module.exports = ToolView.extend( {
 				bylineMessage = 'pagetriage-articleinfo-byline';
 			}

-			const offset = parseInt( mw.user.options.get( 'timecorrection' ).split( '|' )[ 1 ] );
 			// put it all together in the byline
 			// The following messages are used here:
 			// * pagetriage-articleinfo-byline-new-editor
@@ -150,6 +151,13 @@ module.exports = ToolView.extend( {
 				)
 			).parse();
 			this.model.set( 'articleByline_html', articleByline );
+		} else if ( this.model.get( 'creator_hidden' ) ) {
+			this.model.set( 'articleByline_html', mw.msg( 'pagetriage-articleinfo-byline-hidden-username', moment.utc(
+				this.model.get( 'creation_date_utc' ),
+				'YYYYMMDDHHmmss'
+			).utcOffset( offset ).format(
+				mw.msg( 'pagetriage-info-timestamp-date-format' )
+			), mw.msg( 'rev-deleted-user' ) ) );
 		}

 		const stats = [
diff --git a/modules/ext.pageTriage.views.toolbar/articleInfo.underscore b/modules/ext.pageTriage.views.toolbar/articleInfo.underscore
index 9a7ce587..9760e289 100644
--- a/modules/ext.pageTriage.views.toolbar/articleInfo.underscore
+++ b/modules/ext.pageTriage.views.toolbar/articleInfo.underscore
@@ -23,7 +23,13 @@
 	<!-- author info -->
 	<span class="mwe-pt-author">
 		<% if( typeof( user_name ) != 'undefined' ) { %>
-			<%= articleByline_html %>
+			<% if ( !creator_hidden ) { %>
+				<%= articleByline_html %>
+			<% } else { %>
+				<span class="mwe-pt-history-suppressed">
+					<%= articleByline_html %>
+				</span>
+			<% } %>
 			<div>
 				<!-- if user is registered (user_id is 0 for IP users) -->
 				<% if( typeof user_id != 'undefined' && Number( user_id ) !== 0 ) { %>
diff --git a/modules/ext.pageTriage.views.toolbar/mark.js b/modules/ext.pageTriage.views.toolbar/mark.js
index 4d347924..ea221f07 100644
--- a/modules/ext.pageTriage.views.toolbar/mark.js
+++ b/modules/ext.pageTriage.views.toolbar/mark.js
@@ -221,6 +221,7 @@ module.exports = ToolView.extend( {
 			status = this.model.get( 'patrol_status' ) === '0' ? 'reviewed' : 'unreviewed',
 			hasPreviousReviewer = this.model.get( 'ptrp_last_reviewed_by' ) > 0,
 			articleCreator = this.model.get( 'user_name' ),
+			articleCreatorHidden = this.model.get( 'creator_hidden' ),
 			previousReviewer = hasPreviousReviewer ? this.model.get( 'reviewer' ) : '';
 		let noteTarget = articleCreator,
 			notePlaceholder = 'pagetriage-message-for-creator-default-note',
@@ -239,7 +240,7 @@ module.exports = ToolView.extend( {
 			notePlaceholder = 'pagetriage-message-for-creator-default-note';
 		}

-		if ( mw.config.get( 'wgUserName' ) === articleCreator ) {
+		if ( mw.config.get( 'wgUserName' ) === articleCreator || articleCreatorHidden ) {
 			numRecipients--;
 			noteTarget = previousReviewer;
 			noteRecipientRole = 'reviewer';
diff --git a/modules/ext.pageTriage.views.toolbar/tags.js b/modules/ext.pageTriage.views.toolbar/tags.js
index 45ebfc61..b1d9a896 100644
--- a/modules/ext.pageTriage.views.toolbar/tags.js
+++ b/modules/ext.pageTriage.views.toolbar/tags.js
@@ -308,7 +308,7 @@ module.exports = ToolView.extend( {
 		if ( this.selectedTagCount > 0 ) {
 			$( '#mwe-pt-tag-submit-button' ).button( 'enable' );
 			$( '#mwe-pt-checkbox-mark-reviewed-wrapper' ).show();
-			if ( mw.config.get( 'wgUserName' ) !== this.model.get( 'user_name' ) ) {
+			if ( mw.config.get( 'wgUserName' ) !== this.model.get( 'user_name' ) && !this.model.get( 'creator_hidden' ) ) {
 				$( '#mwe-pt-tag-note' ).show();
 			}
 		} else {
diff --git a/modules/ext.pageTriage.views.toolbar/wikiLove.js b/modules/ext.pageTriage.views.toolbar/wikiLove.js
index f493b069..22fe7d0a 100644
--- a/modules/ext.pageTriage.views.toolbar/wikiLove.js
+++ b/modules/ext.pageTriage.views.toolbar/wikiLove.js
@@ -26,11 +26,14 @@ module.exports = ToolView.extend( {
 	render: function () {
 		// get the article's creator
 		const creator = this.model.get( 'user_name' );
+		const creatorHidden = this.model.get( 'creator_hidden' );

 		// get the last 20 editors of the article
 		const contributorArray = [];
 		this.model.revisions.each( function ( revision ) {
-			contributorArray.push( revision.get( 'user' ) );
+			if ( typeof ( revision.get( 'userhidden' ) ) === 'undefined' ) {
+				contributorArray.push( revision.get( 'user' ) );
+			}
 		} );

 		// count how many times each editor edited the article
@@ -54,7 +57,7 @@ module.exports = ToolView.extend( {
 		// set the Learn More link URL
 		$( '#mwe-pt-wikilove .mwe-pt-flyout-help-link' ).attr( 'href', this.moduleConfig.helplink );

-		if ( mw.user.getName() !== creator ) {
+		if ( mw.user.getName() !== creator && !creatorHidden ) {
 			// add the creator info to the top of the list
 			$( '#mwe-pt-article-contributor-list' ).append(
 				'<input type="checkbox" class="mwe-pt-recipient-checkbox" value="' + _.escape( creator ) + '"/>' +
--
2.41.0
```

[jsn.sherman](/p/jsn.sherman/) added a comment.[Sep 11 2023, 9:49 PM2023-09-11 21:49:06 (UTC+0)](#9158631)Comment Actions

Apologies for the slow response; we'll get this reviewed tomorrow.

[Scardenasmolinar](/p/Scardenasmolinar/) added a comment.[Sep 12 2023, 6:56 PM2023-09-12 18:56:58 (UTC+0)](#9161431)Comment Actions

We have taken a look at this patch and we have some comments and questions:

* Does this patch purposefully hide anonymous users? I have tested this in my local environment and created an article with an anonymous user and it appears hidden, even if the IP isn't blocked.

Furthermore, there are a couple of observations in the UI.

In the curation toolbar, the date is struck out, which I don't think it should be.

[![Screenshot 2023-09-12 at 12.50.38.png (94×379 px, 11 KB)](https://phab.wmfusercontent.org/file/data/gwurzrrv4taqoxonl6cq/PHID-FILE-d6vaekheh36mxz5nriw7/preview-Screenshot_2023-09-12_at_12.50.38.png)](https://phab.wmfusercontent.org/file/data/rtt27eknfjcpnclyuwzj/PHID-FILE-mgs2zknw6nflt4tprwt3/Screenshot_2023-09-12_at_12.50.38.png)

The Created by label on the NewPagesFeed is also struck out when a user name is hidden. Only the (username removed) part of the string should be struck out.

[![Screenshot 2023-09-12 at 12.51.06.png (30×228 px, 3 KB)](https://phab.wmfusercontent.org/file/data/5e6fpgfp3uil3zqxcsks/PHID-FILE-dioskwmqobmhlgt4jfk4/preview-Screenshot_2023-09-12_at_12.51.06.png)](https://phab.wmfusercontent.org/file/data/fgdatws2yyvsssw2n5jh/PHID-FILE-3zbm7iswodlx2ixs3xov/Screenshot_2023-09-12_at_12.51.06.png)

[Scardenasmolinar](/p/Scardenasmolinar/) added a project: [Moderator-Tools-Team (Kanban)](/project/view/5880/).[Sep 12 2023, 7:00 PM2023-09-12 19:00:16 (UTC+0)](#9161443)[Scardenasmolinar](/p/Scardenasmolinar/) moved this task from [Ready](/project/board/5880/) to [Eng review](/project/board/5880/) on the [Moderator-Tools-Team (Kanban)](/project/view/5880/) board.

[jsn.sherman](/p/jsn.sherman/) added a comment.[Sep 12 2023, 7:01 PM2023-09-12 19:01:37 (UTC+0)](#9161454)Comment Actions

We don't have the "Hide username from edits and lists" option in our local block pages; so we can't reproduce the issue until we have that sorted.

I think the issue with ip users is the way the check is handled in ApiPageTriageList.php

Here's a proposed patch to your patch that I think still does what you want.

T344359-followup-allow-ip-users.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/bgupqfwaqwculmwuvu4k/PHID-FILE-ot7vxx2sfcly52njxsld/T344359-followup-allow-ip-users.patch)

[Scardenasmolinar](/p/Scardenasmolinar/) moved this task from [Eng review](/project/board/5880/) to [Reviewed (waiting for changes)](/project/board/5880/) on the [Moderator-Tools-Team (Kanban)](/project/view/5880/) board.[Sep 12 2023, 7:07 PM2023-09-12 19:07:04 (UTC+0)](#9161469)[sbassett](/p/sbassett/) added a comment.Edited · [Sep 12 2023, 7:44 PM2023-09-12 19:44:37 (UTC+0)](#9161554)Comment Actions
> In [T344359#9161454](/T344359#9161454), [@jsn.sherman](/p/jsn.sherman/) wrote:
>
> We don't have the "Hide username from edits and lists" option in our local block pages; so we can't reproduce the issue until we have that sorted.

Are you testing in MediaWiki-Docker? Or MediaWiki-Vagrant? Suppress/delete functionality should be within MediaWiki core by default. You'd probably just want to create a suppress group and add a test user to it or just add various rights to the sysop group within LocalSettings.php. Here's an example of enwiki's suppress group config via shell.php:

```
> print_r( $wgGroupPermissions['suppress'] );
Array
(
    [browsearchive] => 1
    [deletedhistory] => 1
    [deletedtext] => 1
    [abusefilter-view-private] => 1
    [deleterevision] => 1
    [deletelogentry] => 1
    [hideuser] => 1
    [suppressrevision] => 1
    [suppressionlog] => 1
    [abusefilter-hide-log] => 1
    [abusefilter-hidden-log] => 1
    [viewsuppressed] => 1
    [oathauth-enable] => 1
)
```

You'd likely really only need to add hideuser to get the various controls to which I think you're referring.

[Soda](/p/Soda/) added a comment.[Sep 12 2023, 8:40 PM2023-09-12 20:40:09 (UTC+0)](#9161710)Comment Actions
> In [T344359#9161431](/T344359#9161431), [@Scardenasmolinar](/p/Scardenasmolinar/) wrote:
>
> We have taken a look at this patch and we have some comments and questions:
>
> * Does this patch purposefully hide anonymous users? I have tested this in my local environment and created an article with an anonymous user and it appears hidden, even if the IP isn't blocked.

Yes, that is unintended, I have attached a fixed patch below

> Furthermore, there are a couple of observations in the UI.
>
> In the curation toolbar, the date is struck out, which I don't think it should be.
>
> [![Screenshot 2023-09-12 at 12.50.38.png (94×379 px, 11 KB)](https://phab.wmfusercontent.org/file/data/gwurzrrv4taqoxonl6cq/PHID-FILE-d6vaekheh36mxz5nriw7/preview-Screenshot_2023-09-12_at_12.50.38.png)](https://phab.wmfusercontent.org/file/data/rtt27eknfjcpnclyuwzj/PHID-FILE-mgs2zknw6nflt4tprwt3/Screenshot_2023-09-12_at_12.50.38.png)
>
> The Created by label on the NewPagesFeed is also struck out when a user name is hidden. Only the (username removed) part of the string should be struck out.
>
> [![Screenshot 2023-09-12 at 12.51.06.png (30×228 px, 3 KB)](https://phab.wmfusercontent.org/file/data/5e6fpgfp3uil3zqxcsks/PHID-FILE-dioskwmqobmhlgt4jfk4/preview-Screenshot_2023-09-12_at_12.51.06.png)](https://phab.wmfusercontent.org/file/data/fgdatws2yyvsssw2n5jh/PHID-FILE-3zbm7iswodlx2ixs3xov/Screenshot_2023-09-12_at_12.51.06.png)

I did look into doing this, but that would require having the unescaped HTML be a part of the message, which isn't considered a best-practice (AFAIK, since it could lead to XSS attack vectors) or spliting up the message in such a way that it wasn't translatable (which [@taavi](/p/taavi/) mentioned).

That being said, if there is another way to implement this, it might be worth doing it :)

> In [T344359#9161454](/T344359#9161454), [@jsn.sherman](/p/jsn.sherman/) wrote:
>
> We don't have the "Hide username from edits and lists" option in our local block pages; so we can't reproduce the issue until we have that sorted.

You should be able to add the admin user to the supressor group to gain those rights (on both Vagrant and MediaWiki-Docker)

> I think the issue with ip users is the way the check is handled in ApiPageTriageList.php
>
> Here's a proposed patch to your patch that I think still does what you want.
>
> T344359-followup-allow-ip-users.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/bgupqfwaqwculmwuvu4k/PHID-FILE-ot7vxx2sfcly52njxsld/T344359-followup-allow-ip-users.patch)

Yeah that's a good catch, I hadn't thought of testing with IP addresses, fixed in the patch below:

0001-Don-t-expose-usernames-if-user-is-hidden.patch19 KB[Download](https://phab.wmfusercontent.org/file/download/nm7aeutja6zympgpvzn7/PHID-FILE-zyfuopwj4fv6trptgosi/0001-Don-t-expose-usernames-if-user-is-hidden.patch)

T344359.patch
```
From e23634cac9f4313435dfdf6210e811f422b8ef07 Mon Sep 17 00:00:00 2001
From: Sohom <sohomdatta1+git@gmail.com>
Date: Wed, 23 Aug 2023 22:18:50 +0530
Subject: [PATCH] Don't expose usernames if user is hidden

- Remove user_name and user info from 'pagetriagelist' API
- Add user_hidden field to 'pagetriagelist' API
- Modify pagetriage toolbar to handle cases where no username
is provided
- Modify Special:NewPagesFeed to gracefully handle cases where
the username is hidden
- Add a special case in the Special:NewPagesFeed vue version
for hidden usernames (where other information is availiable)

Bug: T344359
Change-Id: I5714f69a70909e3c3e7322e5f3be62d837e4d1cc
---
 extension.json                                | 14 ++++++-
 i18n/en.json                                  |  2 +
 i18n/qqq.json                                 |  2 +
 includes/Api/ApiPageTriageList.php            | 37 +++++++++++++++----
 .../components/ListContent.vue                |  1 +
 .../components/ListItem.vue                   | 14 ++++++-
 .../models/ext.pageTriage.article.js          |  7 +++-
 .../ext.pageTriage.listItem.css               |  5 +++
 .../ext.pageTriage.listItem.underscore        |  8 +++-
 .../ext.pageTriage.views.toolbar/ToolView.js  |  1 +
 .../articleInfo.js                            | 10 ++++-
 .../articleInfo.underscore                    |  8 +++-
 modules/ext.pageTriage.views.toolbar/mark.js  |  3 +-
 modules/ext.pageTriage.views.toolbar/tags.js  |  2 +-
 .../ext.pageTriage.views.toolbar/wikiLove.js  |  7 +++-
 15 files changed, 104 insertions(+), 17 deletions(-)

diff --git a/extension.json b/extension.json
index 3895ce32..7a0dd9f0 100644
--- a/extension.json
+++ b/extension.json
@@ -15,7 +15,12 @@
 		"MediaWiki": ">= 1.41"
 	},
 	"APIModules": {
-		"pagetriagelist": "MediaWiki\\Extension\\PageTriage\\Api\\ApiPageTriageList",
+		"pagetriagelist": {
+			"class": "MediaWiki\\Extension\\PageTriage\\Api\\ApiPageTriageList",
+			"services": [
+				"UserFactory"
+			]
+		},
 		"pagetriagestats": "MediaWiki\\Extension\\PageTriage\\Api\\ApiPageTriageStats",
 		"pagetriageaction": {
 			"class": "MediaWiki\\Extension\\PageTriage\\Api\\ApiPageTriageAction",
@@ -239,8 +244,11 @@
 				"pagetriage-mark-as-unreviewed",
 				"pagetriage-info-title",
 				"pagetriage-byline",
+				"rev-deleted-user",
+				"pagetriage-byline-hidden-username",
 				"pagetriage-byline-new-editor",
 				"pagetriage-articleinfo-byline",
+				"pagetriage-articleinfo-byline-hidden-username",
 				"pagetriage-articleinfo-byline-new-editor",
 				"pipe-separator",
 				"pagetriage-edits",
@@ -390,6 +398,8 @@
 				"pagetriage-recreated",
 				"pagetriage-no-author",
 				"pagetriage-byline",
+				"pagetriage-byline-hidden-username",
+				"rev-deleted-user",
 				"pagetriage-byline-new-editor",
 				"pagetriage-editcount",
 				"pagetriage-author-not-autoconfirmed",
@@ -587,6 +597,7 @@
 				"pagetriage-no-author",
 				"pagetriage-no-pages",
 				"pagetriage-byline",
+				"pagetriage-byline-hidden-username",
 				"pagetriage-byline-heading",
 				"pagetriage-byline-new-editor",
 				"pagetriage-byline-new-editor-heading",
@@ -602,6 +613,7 @@
 				"pagetriage-unreviewed-article-count",
 				"pagetriage-reviewed-article-count-past-week",
 				"pagetriage-unreviewed-draft-count",
+				"rev-deleted-user",
 				"pagetriage-sort-by",
 				"pagetriage-newest",
 				"pagetriage-oldest",
diff --git a/i18n/en.json b/i18n/en.json
index edfd73f8..552f7e4d 100644
--- a/i18n/en.json
+++ b/i18n/en.json
@@ -34,9 +34,11 @@
 	"pagetriage-no-author": "No author information present",
 	"pagetriage-byline": "Created by $1 ($2$3$4)",
 	"pagetriage-byline-heading": "Created by {{GENDER:$1}}",
+	"pagetriage-byline-hidden-username": "Created by $1",
 	"pagetriage-byline-new-editor": "Created by new editor $1 ($2$3$4)",
 	"pagetriage-byline-new-editor-heading": "Created by a {{GENDER:$1|new editor}}",
 	"pagetriage-articleinfo-byline": "This page was created on $1 by $2 ($3$4$5)",
+	"pagetriage-articleinfo-byline-hidden-username": "This page was created on $1 by $2",
 	"pagetriage-articleinfo-byline-new-editor": "This page was created on $1 by new editor $2 ($3$4$5)",
 	"pagetriage-editcount": "$1 {{PLURAL:$1|edit|edits}} since $2",
 	"pagetriage-author-not-autoconfirmed": "New editor",
diff --git a/i18n/qqq.json b/i18n/qqq.json
index 7e4b3415..66e0e54d 100644
--- a/i18n/qqq.json
+++ b/i18n/qqq.json
@@ -53,10 +53,12 @@
 	"pagetriage-recreated": "Label indicating a page was previously deleted.",
 	"pagetriage-no-author": "Error message for missing page author information",
 	"pagetriage-byline": "Text indicating the page author.\n*$1 is a link to the author's user page.\n*$2 is a link to the author's talk page.\n*$3 is a separator character.\n*$4 is a link to the author's contributions.",
+	"pagetriage-byline-hidden-username": "Text indicating that a article was created by a author whoes name has been removed. This message is immediately followed by rev-deleted-user.",
 	"pagetriage-byline-heading": "Text indicating the page author. Parameters:\n* $1 - the author's username, used for GENDER support.",
 	"pagetriage-byline-new-editor": "Text indicating the page author (for when the author is a new editor). $1 is a link to the author's user page, $2 is a link to the author's talk page, $3 is a separator character, $4 is a link to the author's contributions.",
 	"pagetriage-byline-new-editor-heading": "Text indicating the page author (for when the author is a new editor). Parameters:\n* $1 - the 'author's username, used for GENDER support.",
 	"pagetriage-articleinfo-byline": "Text indicating the page author. $1 is the article creation date, $2 is a link to the author's user page, $3 is a link to the author's talk page, $4 is a separator character. $5 is a link to the author's contributions.",
+	"pagetriage-articleinfo-byline-hidden-username": "Text indicating that a article was created by a author whoes name has been removed in the article info section of the pagetriage toolbar. This message is immediately followed by rev-deleted-user.",
 	"pagetriage-articleinfo-byline-new-editor": "Text indicating the page author (for when the author is a new editor). Parameters:\n* $1 is the article creation date.\n* $2 is a link to the author's user page.\n* $3 is a link to the author's talk page.\n* $4 is a separator character\n* $5 is a link to the author's contributions.",
 	"pagetriage-editcount": "Display of page author's editing experience. $1 is total edit count, $2 is author's join date",
 	"pagetriage-author-not-autoconfirmed": "String indicating that the author was not yet autoconfirmed when the page was last edited",
diff --git a/includes/Api/ApiPageTriageList.php b/includes/Api/ApiPageTriageList.php
index a1e25ada..f6382cd1 100644
--- a/includes/Api/ApiPageTriageList.php
+++ b/includes/Api/ApiPageTriageList.php
@@ -3,12 +3,14 @@
 namespace MediaWiki\Extension\PageTriage\Api;

 use ApiBase;
+use ApiMain;
 use ApiResult;
 use MediaWiki\Extension\PageTriage\ArticleMetadata;
 use MediaWiki\Extension\PageTriage\OresMetadata;
 use MediaWiki\Extension\PageTriage\PageTriageUtil;
 use MediaWiki\Logger\LoggerFactory;
 use MediaWiki\Title\Title;
+use MediaWiki\User\UserFactory;
 use ORES\Services\ORESServices;
 use SpecialPage;
 use Wikimedia\ParamValidator\ParamValidator;
@@ -22,6 +24,18 @@ use Wikimedia\ParamValidator\TypeDef\IntegerDef;
  */
 class ApiPageTriageList extends ApiBase {

+	/** @var UserFactory */
+	private UserFactory $userFactory;
+
+	/**
+	 * @param ApiMain $query
+	 * @param string $moduleName
+	 */
+	public function __construct( ApiMain $query, string $moduleName, UserFactory $userFactory ) {
+		$this->userFactory = $userFactory;
+		parent::__construct( $query, $moduleName );
+	}
+
 	public function execute() {
 		// Get the API parameters and store them
 		$opts = $this->extractRequestParams();
@@ -72,12 +86,20 @@ class ApiPageTriageList extends ApiBase {
 					$metaData[$page]['creation_date']
 				);

-				// Page creator
-				$metaData[$page] += $this->createUserInfo(
-					$metaData[$page]['user_name'],
-					$userPageStatus,
-					'creator'
-				);
+				if ( $metaData[$page]['user_name'] ) {
+					// Page creator
+					$user = $this->userFactory->newFromName( $metaData[$page]['user_name'] );
+					if ( $user && $user->isHidden() ) {
+						$metaData[$page]['user_name'] = null;
+						$metaData[$page]['creator_hidden'] = true;
+					} else {
+						$metaData[$page] += $this->createUserInfo(
+							$metaData[$page]['user_name'],
+							$userPageStatus,
+							'creator'
+						);
+					}
+				}

 				// Page reviewer
 				if ( $metaData[$page]['reviewer'] ) {
@@ -103,7 +125,7 @@ class ApiPageTriageList extends ApiBase {
 				}

 				$metaData[$page][ApiResult::META_BC_BOOLS] = [
-					'creator_user_page_exist', 'creator_user_talk_page_exist',
+					'creator_hidden', 'creator_user_page_exist', 'creator_user_talk_page_exist',
 					'reviewer_user_page_exist', 'reviewer_user_talk_page_exist',
 				];

@@ -219,6 +241,7 @@ class ApiPageTriageList extends ApiBase {
 			$prefix . '_user_talk_page_exist' => isset( $userPageStatus[$userTalkPage->getPrefixedDBkey()] ),
 			$prefix . '_contribution_page' => $userContribsPage->getPrefixedText(),
 			$prefix . '_contribution_page_url' => $userContribsPage->getFullURL(),
+			$prefix . '_hidden' => false,
 		];
 	}

diff --git a/modules/ext.pageTriage.list/components/ListContent.vue b/modules/ext.pageTriage.list/components/ListContent.vue
index 7385fff3..d79d2ae7 100644
--- a/modules/ext.pageTriage.list/components/ListContent.vue
+++ b/modules/ext.pageTriage.list/components/ListContent.vue
@@ -58,6 +58,7 @@ const listItemPropFormatter = ( pageInfo ) => {
 	listItemProps.revCount = parseInt( pageInfo.rev_count );
 	listItemProps.creationDateUTC = pageInfo.creation_date_utc;
 	listItemProps.creatorName = pageInfo.user_name;
+	listItemProps.creatorHidden = pageInfo.creator_hidden;
 	listItemProps.creatorAutoConfirmed = pageInfo.user_autoconfirmed === '1';
 	listItemProps.creatorRegistrationUTC = pageInfo.user_creation_date;
 	listItemProps.creatorUserId = parseInt( pageInfo.user_id );
diff --git a/modules/ext.pageTriage.list/components/ListItem.vue b/modules/ext.pageTriage.list/components/ListItem.vue
index 2a42cd54..45edb46a 100644
--- a/modules/ext.pageTriage.list/components/ListItem.vue
+++ b/modules/ext.pageTriage.list/components/ListItem.vue
@@ -58,14 +58,21 @@
 			</div>
 			<div class="mwe-vue-pt-info-row">
 				<div>
-					<span v-if="creatorName">
+					<span v-if="creatorName || creatorHidden">
 						<creator-byline
+							v-if="creatorName"
 							:creator-name="creatorName"
+							:creator-hidden="creatorHidden"
 							:creator-user-id="creatorUserId"
 							:creator-auto-confirmed="creatorAutoConfirmed"
 							:creator-user-page-exists="creatorUserPageExists"
 							:creator-talk-page-exists="creatorTalkPageExists"
 						></creator-byline>
+						<template v-else>
+							<span class="mwe-pt-history-suppressed">
+								{{ $i18n( 'pagetriage-byline-hidden-username', $i18n( 'rev-deleted-user' ) ) }}
+							</span>
+						</template>
 						<span v-if="creatorUserId > 0">
 							{{ $i18n( 'pagetriage-dot-separator' ).text() }}
 							{{ $i18n( 'pagetriage-editcount', creatorEditCount, creatorRegistrationPretty ).text() }}
@@ -185,6 +192,7 @@ module.exports = {
          */
 		// Creator information tags
 		creatorUserId: { type: Number, required: true },
+		creatorHidden: { type: Boolean, required: true },
 		creatorName: { type: String, required: true },
 		creatorEditCount: { type: Number, required: true },
 		creatorRegistrationUTC: {
@@ -436,4 +444,8 @@ module.exports = {
 .cdx-icon.cdx-info-chip__icon--warning {
 	color: @color-warning;
 }
+.mwe-pt-history-suppressed {
+	text-decoration-line: line-through;
+	text-decoration-style: double;
+}
 </style>
diff --git a/modules/ext.pageTriage.util/models/ext.pageTriage.article.js b/modules/ext.pageTriage.util/models/ext.pageTriage.article.js
index 0c61a0f1..01f0b1b6 100644
--- a/modules/ext.pageTriage.util/models/ext.pageTriage.article.js
+++ b/modules/ext.pageTriage.util/models/ext.pageTriage.article.js
@@ -106,7 +106,12 @@ const Article = Backbone.Model.extend( {
 					article.get( 'creator_user_page_exist' )
 				)
 			);
-			article.set( 'user_contribs_title', article.get( 'creator_contribution_page' ) );
+		} else if ( article.get( 'creator_hidden' ) ) {
+			article.set( 'author_byline_html', mw.msg( 'pagetriage-byline-hidden-username', mw.msg( 'rev-deleted-user' ) ) );
+			article.set(
+				'user_title_url',
+				mw.msg( 'rev-deleted-user' )
+			);
 		}

 		// Are there any PageTriage messages on the talk page?
diff --git a/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.css b/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.css
index 4d8f89e5..5016727f 100644
--- a/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.css
+++ b/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.css
@@ -123,6 +123,11 @@
 	display: table-cell;
 }

+.mwe-pt-history-suppressed {
+	text-decoration-line: line-through;
+	text-decoration-style: double;
+}
+
 .mwe-pt-potential-issues {
 	display: table-cell;
 	text-align: right;
diff --git a/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.underscore b/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.underscore
index 34cd4944..aa2c3446 100644
--- a/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.underscore
+++ b/modules/ext.pageTriage.views.list/ext.pageTriage.listItem.underscore
@@ -105,7 +105,13 @@
 				<div class="mwe-pt-info-row">
 					<div class="mwe-pt-author">
 					<% if ( typeof( user_name ) !== "undefined" ) { %>
-						<%= author_byline_html %>
+						<% if ( !creator_hidden ) { %>
+							<%= author_byline_html %>
+						<% } else { %>
+							<span class="mwe-pt-history-suppressed">
+								<%= author_byline_html %>
+							</span>
+						<% } %>
 						<!-- user_id is undefined or '0' for IP users -->
 						<% if ( typeof ( user_id ) != 'undefined' && Number( user_id ) !== 0 ) { %>
 							&#xb7;
diff --git a/modules/ext.pageTriage.views.toolbar/ToolView.js b/modules/ext.pageTriage.views.toolbar/ToolView.js
index 74a96746..f2544fec 100644
--- a/modules/ext.pageTriage.views.toolbar/ToolView.js
+++ b/modules/ext.pageTriage.views.toolbar/ToolView.js
@@ -267,6 +267,7 @@ module.exports = Backbone.View.extend( {
 			pageid: mw.config.get( 'wgArticleId' ),
 			title: mw.config.get( 'wgPageName' ),
 			creator: this.model.get( 'user_name' ),
+			creatorHidden: this.model.get( 'creator_hidden' ),
 			reviewed: reviewed
 		}, data );
 	},
diff --git a/modules/ext.pageTriage.views.toolbar/articleInfo.js b/modules/ext.pageTriage.views.toolbar/articleInfo.js
index 9b9ef2af..28eef292 100644
--- a/modules/ext.pageTriage.views.toolbar/articleInfo.js
+++ b/modules/ext.pageTriage.views.toolbar/articleInfo.js
@@ -109,6 +109,8 @@ module.exports = ToolView.extend( {
 			url.toString()
 		);

+		const offset = parseInt( mw.user.options.get( 'timecorrection' ).split( '|' )[ 1 ] );
+
 		// creator information
 		if ( this.model.get( 'user_name' ) ) {
 			// show new editor message only if the user is not anonymous and not autoconfirmed
@@ -119,7 +121,6 @@ module.exports = ToolView.extend( {
 				bylineMessage = 'pagetriage-articleinfo-byline';
 			}

-			const offset = parseInt( mw.user.options.get( 'timecorrection' ).split( '|' )[ 1 ] );
 			// put it all together in the byline
 			// The following messages are used here:
 			// * pagetriage-articleinfo-byline-new-editor
@@ -150,6 +151,13 @@ module.exports = ToolView.extend( {
 				)
 			).parse();
 			this.model.set( 'articleByline_html', articleByline );
+		} else if ( this.model.get( 'creator_hidden' ) ) {
+			this.model.set( 'articleByline_html', mw.msg( 'pagetriage-articleinfo-byline-hidden-username', moment.utc(
+				this.model.get( 'creation_date_utc' ),
+				'YYYYMMDDHHmmss'
+			).utcOffset( offset ).format(
+				mw.msg( 'pagetriage-info-timestamp-date-format' )
+			), mw.msg( 'rev-deleted-user' ) ) );
 		}

 		const stats = [
diff --git a/modules/ext.pageTriage.views.toolbar/articleInfo.underscore b/modules/ext.pageTriage.views.toolbar/articleInfo.underscore
index 9a7ce587..9760e289 100644
--- a/modules/ext.pageTriage.views.toolbar/articleInfo.underscore
+++ b/modules/ext.pageTriage.views.toolbar/articleInfo.underscore
@@ -23,7 +23,13 @@
 	<!-- author info -->
 	<span class="mwe-pt-author">
 		<% if( typeof( user_name ) != 'undefined' ) { %>
-			<%= articleByline_html %>
+			<% if ( !creator_hidden ) { %>
+				<%= articleByline_html %>
+			<% } else { %>
+				<span class="mwe-pt-history-suppressed">
+					<%= articleByline_html %>
+				</span>
+			<% } %>
 			<div>
 				<!-- if user is registered (user_id is 0 for IP users) -->
 				<% if( typeof user_id != 'undefined' && Number( user_id ) !== 0 ) { %>
diff --git a/modules/ext.pageTriage.views.toolbar/mark.js b/modules/ext.pageTriage.views.toolbar/mark.js
index 4d347924..ea221f07 100644
--- a/modules/ext.pageTriage.views.toolbar/mark.js
+++ b/modules/ext.pageTriage.views.toolbar/mark.js
@@ -221,6 +221,7 @@ module.exports = ToolView.extend( {
 			status = this.model.get( 'patrol_status' ) === '0' ? 'reviewed' : 'unreviewed',
 			hasPreviousReviewer = this.model.get( 'ptrp_last_reviewed_by' ) > 0,
 			articleCreator = this.model.get( 'user_name' ),
+			articleCreatorHidden = this.model.get( 'creator_hidden' ),
 			previousReviewer = hasPreviousReviewer ? this.model.get( 'reviewer' ) : '';
 		let noteTarget = articleCreator,
 			notePlaceholder = 'pagetriage-message-for-creator-default-note',
@@ -239,7 +240,7 @@ module.exports = ToolView.extend( {
 			notePlaceholder = 'pagetriage-message-for-creator-default-note';
 		}

-		if ( mw.config.get( 'wgUserName' ) === articleCreator ) {
+		if ( mw.config.get( 'wgUserName' ) === articleCreator || articleCreatorHidden ) {
 			numRecipients--;
 			noteTarget = previousReviewer;
 			noteRecipientRole = 'reviewer';
diff --git a/modules/ext.pageTriage.views.toolbar/tags.js b/modules/ext.pageTriage.views.toolbar/tags.js
index 45ebfc61..b1d9a896 100644
--- a/modules/ext.pageTriage.views.toolbar/tags.js
+++ b/modules/ext.pageTriage.views.toolbar/tags.js
@@ -308,7 +308,7 @@ module.exports = ToolView.extend( {
 		if ( this.selectedTagCount > 0 ) {
 			$( '#mwe-pt-tag-submit-button' ).button( 'enable' );
 			$( '#mwe-pt-checkbox-mark-reviewed-wrapper' ).show();
-			if ( mw.config.get( 'wgUserName' ) !== this.model.get( 'user_name' ) ) {
+			if ( mw.config.get( 'wgUserName' ) !== this.model.get( 'user_name' ) && !this.model.get( 'creator_hidden' ) ) {
 				$( '#mwe-pt-tag-note' ).show();
 			}
 		} else {
diff --git a/modules/ext.pageTriage.views.toolbar/wikiLove.js b/modules/ext.pageTriage.views.toolbar/wikiLove.js
index f493b069..22fe7d0a 100644
--- a/modules/ext.pageTriage.views.toolbar/wikiLove.js
+++ b/modules/ext.pageTriage.views.toolbar/wikiLove.js
@@ -26,11 +26,14 @@ module.exports = ToolView.extend( {
 	render: function () {
 		// get the article's creator
 		const creator = this.model.get( 'user_name' );
+		const creatorHidden = this.model.get( 'creator_hidden' );

 		// get the last 20 editors of the article
 		const contributorArray = [];
 		this.model.revisions.each( function ( revision ) {
-			contributorArray.push( revision.get( 'user' ) );
+			if ( typeof ( revision.get( 'userhidden' ) ) === 'undefined' ) {
+				contributorArray.push( revision.get( 'user' ) );
+			}
 		} );

 		// count how many times each editor edited the article
@@ -54,7 +57,7 @@ module.exports = ToolView.extend( {
 		// set the Learn More link URL
 		$( '#mwe-pt-wikilove .mwe-pt-flyout-help-link' ).attr( 'href', this.moduleConfig.helplink );

-		if ( mw.user.getName() !== creator ) {
+		if ( mw.user.getName() !== creator && !creatorHidden ) {
 			// add the creator info to the top of the list
 			$( '#mwe-pt-article-contributor-list' ).append(
 				'<input type="checkbox" class="mwe-pt-recipient-checkbox" value="' + _.escape( creator ) + '"/>' +
--
2.42.0
```
[Scardenasmolinar](/p/Scardenasmolinar/) added a comment.[Sep 12 2023, 11:00 PM2023-09-12 23:00:47 (UTC+0)](#9162044)Comment Actions
> In [T344359#9161554](/T344359#9161554), [@sbassett](/p/sbassett/) wrote:
> > In [T344359#9161454](/T344359#9161454), [@jsn.sherman](/p/jsn.sherman/) wrote:
> >
> > We don't have the "Hide username from edits and lists" option in our local block pages; so we can't reproduce the issue until we have that sorted.
>
> Are you testing in MediaWiki-Docker? Or MediaWiki-Vagrant? Suppress/delete functionality should be within MediaWiki core by default. You'd probably just want to create a suppress group and add a test user to it or just add various rights to the sysop group within LocalSettings.php. Here's an example of enwiki's suppress group config via shell.php:
>
> ```
> > print_r( $wgGroupPermissions['suppress'] );
> Array
> (
>     [browsearchive] => 1
>     [deletedhistory] => 1
>     [deletedtext] => 1
>     [abusefilter-view-private] => 1
>     [deleterevision] => 1
>     [deletelogentry] => 1
>     [hideuser] => 1
>     [suppressrevision] => 1
>     [suppressionlog] => 1
>     [abusefilter-hide-log] => 1
>     [abusefilter-hidden-log] => 1
>     [viewsuppressed] => 1
>     [oathauth-enable] => 1
> )
> ```
>
> You'd likely really only need to add hideuser to get the various controls to which I think you're referring.

We're using MediaWiki Docker. Let me try adding the suppress group to see if I can make that configuration to show up.

[Scardenasmolinar](/p/Scardenasmolinar/) added a comment.[Sep 13 2023, 1:00 AM2023-09-13 01:00:30 (UTC+0)](#9162146)Comment Actions
> I did look into doing this, but that would require having the unescaped HTML be a part of the message, which isn't considered a best practice (AFAIK, since it could lead to XSS attack vectors) or splitting up the message in such a way that it wasn't translatable (which [@taavi](/p/taavi/) mentioned).

I don't see many uses of line-through in the code base, and where there are instances, it is to show something is deprecated. You can also see the functionality in Special:UnwatchedPages, but I don't think unwatching a page (with the capability to undo it) is the same as showing a removed user. In conclusion, I think you should remove the line-though CSS.

Can you also rebase this patch with the latest changes in the master branch?

[Soda](/p/Soda/) added a comment.Edited · [Sep 13 2023, 12:00 PM2023-09-13 12:00:08 (UTC+0)](#9163322)Comment Actions
> In [T344359#9162146](/T344359#9162146), [@Scardenasmolinar](/p/Scardenasmolinar/) wrote:
> > I did look into doing this, but that would require having the unescaped HTML be a part of the message, which isn't considered a best practice (AFAIK, since it could lead to XSS attack vectors) or splitting up the message in such a way that it wasn't translatable (which [@taavi](/p/taavi/) mentioned).
>
> I don't see many uses of line-through in the code base, and where there are instances, it is to show something is deprecated. You can also see the functionality in Special:UnwatchedPages, but I don't think unwatching a page (with the capability to undo it) is the same as showing a removed user. In conclusion, I think you should remove the line-though CSS.

So, I'm unsure about this, my understanding was that line-through was the way that redacted information was shown to the user in MediaWiki?

> Can you also rebase this patch with the latest changes in the master branch?

The latest one should be rebased on top of master

[jsn.sherman](/p/jsn.sherman/) added a comment.[Sep 13 2023, 4:08 PM2023-09-13 16:08:22 (UTC+0)](#9164357)Comment Actions
> In [T344359#9163322](/T344359#9163322), [@Soda](/p/Soda/) wrote:
> > In [T344359#9162146](/T344359#9162146), [@Scardenasmolinar](/p/Scardenasmolinar/) wrote:
> > > I did look into doing this, but that would require having the unescaped HTML be a part of the message, which isn't considered a best practice (AFAIK, since it could lead to XSS attack vectors) or splitting up the message in such a way that it wasn't translatable (which [@taavi](/p/taavi/) mentioned).

We have prior art to look at with the other logs in core; eg. revision history:

[![image.png (703×1 px, 118 KB)](https://phab.wmfusercontent.org/file/data/srx4mexl5efn2itzynrb/PHID-FILE-ix7jizvdbe7lqytqcvbx/preview-image.png)](https://phab.wmfusercontent.org/file/data/6buz5k4xyeczuhcib76h/PHID-FILE-5t72wt7le3st7lfdlkwz/image.png)

the message key is rev-deleted-user; I don't think you need to create a new message or rework the markup. I think you can simply use that message from core instead of the username in the byline.

> > I don't see many uses of line-through in the code base, and where there are instances, it is to show something is deprecated. You can also see the functionality in Special:UnwatchedPages, but I don't think unwatching a page (with the capability to undo it) is the same as showing a removed user. In conclusion, I think you should remove the line-though CSS.
>
> So, I'm unsure about this, my understanding was that line-through was the way that redacted information was shown to the user in MediaWiki?
>
> > Can you also rebase this patch with the latest changes in the master branch?
>
> The latest one should be rebased on top of master

Yep, the parent of your commit is now from yesterday; thanks!

[jsn.sherman](/p/jsn.sherman/) added a comment.[Sep 13 2023, 4:10 PM2023-09-13 16:10:00 (UTC+0)](#9164360)Comment Actions
> In [T344359#9161554](/T344359#9161554), [@sbassett](/p/sbassett/) wrote:
> > In [T344359#9161454](/T344359#9161454), [@jsn.sherman](/p/jsn.sherman/) wrote:
> >
> > We don't have the "Hide username from edits and lists" option in our local block pages; so we can't reproduce the issue until we have that sorted.
>
> Are you testing in MediaWiki-Docker? Or MediaWiki-Vagrant? Suppress/delete functionality should be within MediaWiki core by default. You'd probably just want to create a suppress group and add a test user to it or just add various rights to the sysop group within LocalSettings.php. Here's an example of enwiki's suppress group config via shell.php:
>
> ```
> > print_r( $wgGroupPermissions['suppress'] );
> Array
> (
>     [browsearchive] => 1
>     [deletedhistory] => 1
>     [deletedtext] => 1
>     [abusefilter-view-private] => 1
>     [deleterevision] => 1
>     [deletelogentry] => 1
>     [hideuser] => 1
>     [suppressrevision] => 1
>     [suppressionlog] => 1
>     [abusefilter-hide-log] => 1
>     [abusefilter-hidden-log] => 1
>     [viewsuppressed] => 1
>     [oathauth-enable] => 1
> )
> ```
>
> You'd likely really only need to add hideuser to get the various controls to which I think you're referring.

Thanks for this; that did the trick and saved me time trying to grok the docs. :-)

[jsn.sherman](/p/jsn.sherman/) added a comment.[Sep 13 2023, 4:24 PM2023-09-13 16:24:22 (UTC+0)](#9164414)Comment Actions

[@Soda](/p/Soda/), Because this change touches things in multiple places. I'm really struggling to give actionable feedback without commenting on a diff. I'm going to make an annotated patch that has the same parent commit as this patch and contains my proposed changes. If you apply the commit to a new branch locally, you should be able to diff it against your local branch to make sense of it.

[jsn.sherman](/p/jsn.sherman/) added a comment.Edited · [Sep 13 2023, 5:57 PM2023-09-13 17:57:20 (UTC+0)](#9164606)Comment Actions

Okay, here's my patch that addresess the vue interface as an example. I haven't touched the backbone side.

Note that we're no longer showing information about edit history. In core changelists, when a user is suppressed, references to their contributions are removed as well, so I think we should not show contribution information on this public page either. I think this is a simpler approach and more appropriate for a security fix.

T344359-use-same-presentation-as-core-changelists.patch0 B[Download](https://phab.wmfusercontent.org/file/download/yejd4cwpwyxf5i3gvkqh/PHID-FILE-gmu6aqo5toqd6c3gvnla/T344359-use-same-presentation-as-core-changelists.patch)

[Soda](/p/Soda/) added a comment.[Sep 13 2023, 6:33 PM2023-09-13 18:33:11 (UTC+0)](#9164709)Comment Actions
> In [T344359#9164414](/T344359#9164414), [@jsn.sherman](/p/jsn.sherman/) wrote:
>
> [@Soda](/p/Soda/), Because this change touches things in multiple places. I'm really struggling to give actionable feedback without commenting on a diff. I'm going to make an annotated patch that has the same parent commit as this patch and contains my proposed changes. If you apply the commit to a new branch locally, you should be able to diff it against your local branch to make sense of it.

Sure

> In [T344359#9164606](/T344359#9164606), [@jsn.sherman](/p/jsn.sherman/) wrote:
>
> Okay, here's my patch that addresess the vue interface as an example. I haven't touched the backbone side.
>
> Note that we're no longer showing information about edit history. In core changelists, when a user is suppressed, references to their contributions are removed as well, so I think we should not show contribution information on this public page either. I think this is a simpler approach and more appropriate for a security fix.
>
> T344359-use-same-presentation-as-core-changelists.patch0 B[Download](https://phab.wmfusercontent.org/file/download/yejd4cwpwyxf5i3gvkqh/PHID-FILE-gmu6aqo5toqd6c3gvnla/T344359-use-same-presentation-as-core-changelists.patch)

The patch you uploaded seems empty, but I think that approach would also work imo

[jsn.sherman](/p/jsn.sherman/) added a comment.[Sep 13 2023, 7:23 PM2023-09-13 19:23:09 (UTC+0)](#9164853)Comment Actions

Oops. I diffed against my own commit instead of the parent. Let's try this again:0001-Don-t-expose-usernames-if-user-is-hidden.patch15 KB[Download](https://phab.wmfusercontent.org/file/download/x5qkwog2siwkrsdgbwut/PHID-FILE-sfofbgnsdjud5hkn5k6q/0001-Don-t-expose-usernames-if-user-is-hidden.patch)

[Soda](/p/Soda/) added a comment.[Sep 13 2023, 8:12 PM2023-09-13 20:12:53 (UTC+0)](#9164991)Comment Actions

I've updated the patch based on your comments, to have the backbone.js version reflect the same behaviour.

0001-Don-t-expose-usernames-if-user-is-hidden.patch18 KB[Download](https://phab.wmfusercontent.org/file/download/y7nvcx4ijmak2de7lodr/PHID-FILE-d4fxhqx5jxdwvs6kn5uc/0001-Don-t-expose-usernames-if-user-is-hidden.patch)

Wrt to the articleInfo section in the toolbar, I elected to remove the rev-deleted-user message completely and just have the message display the date of creation. (Since we already display the context of a redacted edit in the history below)

[![Screenshot from 2023-09-14 01-41-52.png (337×523 px, 38 KB)](https://phab.wmfusercontent.org/file/data/hydoheib6b6zhq6zven6/PHID-FILE-vvwlfpnj3ysp7gd7iqv3/preview-Screenshot_from_2023-09-14_01-41-52.png)](https://phab.wmfusercontent.org/file/data/pw2abk2f5g2yvpms6gwb/PHID-FILE-ywchj7qxw7xbne4c6ptx/Screenshot_from_2023-09-14_01-41-52.png)

That being said, I'm open to other ways of implementing this.

[jsn.sherman](/p/jsn.sherman/) added a comment.[Sep 13 2023, 10:16 PM2023-09-13 22:16:22 (UTC+0)](#9165270)Comment Actions

Thank you for all of your work on this so far. This is looking pretty good. I see two issues left:

* in modules/ext.pageTriage.views.toolbar/articleInfo.underscore, your changes look like they are no longer needed. eg.:

```
			<% if ( !creator_hidden ) { %>
				<%= articleByline_html %>
			<% } else { %>
				<%= articleByline_html %>
			<% } %>
```

could be simplified back to:

```
			<%= articleByline_html %>
```

* You're still defining and using mwe-pt-history-suppressed; I think this could be handled with the built in classes which some markup changes in the articleInfoHistory template

I don't think either of these is blocking; if you don't want to get into reworking the template especially, please add a \@TODO or \@FIXME comment and I'll take a pass at it after this is deployed and we can use the normal workflow again.

[Soda](/p/Soda/) added a comment.[Sep 14 2023, 11:17 AM2023-09-14 11:17:49 (UTC+0)](#9166228)Comment Actions
> In [T344359#9165270](/T344359#9165270), [@jsn.sherman](/p/jsn.sherman/) wrote:
>
> Thank you for all of your work on this so far. This is looking pretty good. I see two issues left:
>
> * in modules/ext.pageTriage.views.toolbar/articleInfo.underscore, your changes look like they are no longer needed. eg.:
>
> ```
> 			<% if ( !creator_hidden ) { %>
> 				<%= articleByline_html %>
> 			<% } else { %>
> 				<%= articleByline_html %>
> 			<% } %>
> ```
>
> could be simplified back to:
>
> ```
> 			<%= articleByline_html %>
> ```

Fixed :)

> * You're still defining and using mwe-pt-history-suppressed; I think this could be handled with the built in classes which some markup changes in the articleInfoHistory template
>
> I don't think either of these is blocking; if you don't want to get into reworking the template especially, please add a \@TODO or \@FIXME comment and I'll take a pass at it after this is deployed and we can use the normal workflow again.

I did clean this up a fair bit, but it seems like we still need to do some work, since there seems to be some issues issues with suppressed being triggered over userhidden and the history-deleted styles not showing up. I've added a todo for this :)

0001-Don-t-expose-usernames-if-user-is-hidden.patch20 KB[Download](https://phab.wmfusercontent.org/file/download/aluuic7aqaiheylcxvuj/PHID-FILE-rahtfgc46gd2k3fmi4xy/0001-Don-t-expose-usernames-if-user-is-hidden.patch)

[jsn.sherman](/p/jsn.sherman/) added a comment.[Sep 14 2023, 2:31 PM2023-09-14 14:31:54 (UTC+0)](#9166712)Comment Actions
> In [T344359#9166228](/T344359#9166228), [@Soda](/p/Soda/) wrote:
> > In [T344359#9165270](/T344359#9165270), [@jsn.sherman](/p/jsn.sherman/) wrote:
> >
> > Thank you for all of your work on this so far. This is looking pretty good. I see two issues left:
> >
> > * in modules/ext.pageTriage.views.toolbar/articleInfo.underscore, your changes look like they are no longer needed. eg.:
> >
> > ```
> > 			<% if ( !creator_hidden ) { %>
> > 				<%= articleByline_html %>
> > 			<% } else { %>
> > 				<%= articleByline_html %>
> > 			<% } %>
> > ```
> >
> > could be simplified back to:
> >
> > ```
> > 			<%= articleByline_html %>
> > ```
>
> Fixed :)
>
> > * You're still defining and using mwe-pt-history-suppressed; I think this could be handled with the built in classes which some markup changes in the articleInfoHistory template
> >
> > I don't think either of these is blocking; if you don't want to get into reworking the template especially, please add a \@TODO or \@FIXME comment and I'll take a pass at it after this is deployed and we can use the normal workflow again.
>
> I did clean this up a fair bit, but it seems like we still need to do some work, since there seems to be some issues issues with suppressed being triggered over userhidden and the history-deleted styles not showing up. I've added a todo for this :)
>
> 0001-Don-t-expose-usernames-if-user-is-hidden.patch20 KB[Download](https://phab.wmfusercontent.org/file/download/aluuic7aqaiheylcxvuj/PHID-FILE-rahtfgc46gd2k3fmi4xy/0001-Don-t-expose-usernames-if-user-is-hidden.patch)

CR + 2

Thank you for both identifying this and patching it! Your contributions are very much appreciated!

[jsn.sherman](/p/jsn.sherman/) moved this task from [Reviewed (waiting for changes)](/project/board/5880/) to [Done](/project/board/5880/) on the [Moderator-Tools-Team (Kanban)](/project/view/5880/) board.[Sep 14 2023, 2:35 PM2023-09-14 14:35:19 (UTC+0)](#9166719)[sbassett](/p/sbassett/) added a comment.[Sep 14 2023, 2:35 PM2023-09-14 14:35:47 (UTC+0)](#9166722)Comment Actions
> In [T344359#9166712](/T344359#9166712), [@jsn.sherman](/p/jsn.sherman/) wrote:
>
> CR + 2
>
> Thank you for both identifying this and patching it! Your contributions are very much appreciated!

Great. The [Security-Team](/tag/security-team/) can get this deployed during [next Monday's (2023-09-18) security deployment window](https://wikitech.wikimedia.org/wiki/Deployments#deploycal-item-20230918T2100).

[jsn.sherman](/p/jsn.sherman/) added a comment.[Sep 14 2023, 3:21 PM2023-09-14 15:21:21 (UTC+0)](#9167039)Comment Actions
> In [T344359#9166722](/T344359#9166722), [@sbassett](/p/sbassett/) wrote:
> > In [T344359#9166712](/T344359#9166712), [@jsn.sherman](/p/jsn.sherman/) wrote:
> >
> > CR + 2
> >
> > Thank you for both identifying this and patching it! Your contributions are very much appreciated!
>
> Great. The [Security-Team](/tag/security-team/) can get this deployed during [next Monday's (2023-09-18) security deployment window](https://wikitech.wikimedia.org/wiki/Deployments#deploycal-item-20230918T2100).

I'm happy to make make self available for testing the deployment if that would be helpful.

[Soda](/p/Soda/) moved this task from [Code Review](/project/board/541/) to [Waiting for enwiki deploy](/project/board/541/) on the [PageTriage](/tag/pagetriage/) board.[Sep 14 2023, 3:28 PM2023-09-14 15:28:43 (UTC+0)](#9167127)[sbassett](/p/sbassett/) added a comment.[Sep 14 2023, 5:23 PM2023-09-14 17:23:49 (UTC+0)](#9167740)Comment Actions
> In [T344359#9167039](/T344359#9167039), [@jsn.sherman](/p/jsn.sherman/) wrote:
>
> I'm happy to make make self available for testing the deployment if that would be helpful.

That'd be great. IRC or Slack?

[jsn.sherman](/p/jsn.sherman/) added a comment.[Sep 14 2023, 5:25 PM2023-09-14 17:25:37 (UTC+0)](#9167750)Comment Actions
> In [T344359#9167740](/T344359#9167740), [@sbassett](/p/sbassett/) wrote:
> > In [T344359#9167039](/T344359#9167039), [@jsn.sherman](/p/jsn.sherman/) wrote:
> >
> > I'm happy to make make self available for testing the deployment if that would be helpful.
>
> That'd be great. IRC or Slack?

Slack, please!

[Mstyles](/p/Mstyles/) moved this task from [Security Patch To Deploy](/project/board/1179/) to [Watching](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Sep 18 2023, 9:24 PM2023-09-18 21:24:52 (UTC+0)](#9176676)Comment Actions
> In [T344359#9166228](/T344359#9166228), [@Soda](/p/Soda/) wrote:
> > In [T344359#9165270](/T344359#9165270), [@jsn.sherman](/p/jsn.sherman/) wrote:
> >
> > Thank you for all of your work on this so far. This is looking pretty good. I see two issues left:
> >
> > * in modules/ext.pageTriage.views.toolbar/articleInfo.underscore, your changes look like they are no longer needed. eg.:
> >
> > ```
> > 			<% if ( !creator_hidden ) { %>
> > 				<%= articleByline_html %>
> > 			<% } else { %>
> > 				<%= articleByline_html %>
> > 			<% } %>
> > ```
> >
> > could be simplified back to:
> >
> > ```
> > 			<%= articleByline_html %>
> > ```
>
> Fixed :)
>
> > * You're still defining and using mwe-pt-history-suppressed; I think this could be handled with the built in classes which some markup changes in the articleInfoHistory template
> >
> > I don't think either of these is blocking; if you don't want to get into reworking the template especially, please add a \@TODO or \@FIXME comment and I'll take a pass at it after this is deployed and we can use the normal workflow again.
>
> I did clean this up a fair bit, but it seems like we still need to do some work, since there seems to be some issues issues with suppressed being triggered over userhidden and the history-deleted styles not showing up. I've added a todo for this :)
>
> 0001-Don-t-expose-usernames-if-user-is-hidden.patch20 KB[Download](https://phab.wmfusercontent.org/file/download/aluuic7aqaiheylcxvuj/PHID-FILE-rahtfgc46gd2k3fmi4xy/0001-Don-t-expose-usernames-if-user-is-hidden.patch)

[Deployed](https://sal.toolforge.org/log/eaMpqooBGiVuUzOd9x5A) and then tested by [@jsn.sherman](/p/jsn.sherman/) and everything looks good. Look out for this in the supplemental release coming out at the end of the month

[Mstyles](/p/Mstyles/) mentioned this in [T340874: Write and send supplementary release announcement for extensions and skins with security patches (1.35.12/1.39.5/1.40.1)](/T340874).[Sep 18 2023, 9:29 PM2023-09-18 21:29:32 (UTC+0)](#9176686)[jsn.sherman](/p/jsn.sherman/) moved this task from [Waiting for enwiki deploy](/project/board/541/) to [Done](/project/board/541/) on the [PageTriage](/tag/pagetriage/) board.[Sep 19 2023, 4:03 PM2023-09-19 16:03:44 (UTC+0)](#9179554)[Samwalton9-WMF](/p/Samwalton9-WMF/) closed this task as Resolved.[Sep 19 2023, 4:07 PM2023-09-19 16:07:01 (UTC+0)](#9179568)

[• jnuche](/p/jnuche/) subscribed.[Sep 25 2023, 8:40 AM2023-09-25 08:40:32 (UTC+0)](#9194294)Comment Actions

Hi, this patch currently has a merge conflict with the latest extension code in master: <https://releases-jenkins.wikimedia.org/job/Branch%20cut%20pretest%20patches/68/console>

We're going to need a rebase/fix in order to be able to roll out this week's train. I've created a directory on the deployment server for the new version at /srv/patches/1.41.0-wmf.28

[• jnuche](/p/jnuche/) added a parent task: [T345889: 1.41.0-wmf.28 deployment blockers](/T345889).[Sep 25 2023, 8:41 AM2023-09-25 08:41:25 (UTC+0)](#9194295)[sbassett](/p/sbassett/) added a comment.Edited · [Sep 25 2023, 7:59 PM2023-09-25 19:59:19 (UTC+0)](#9197188)Comment Actions
> In [T344359#9194294](/T344359#9194294), [@jnuche](/p/jnuche/) wrote:
>
> We're going to need a rebase/fix in order to be able to roll out this week's train. I've created a directory on the deployment server for the new version at /srv/patches/1.41.0-wmf.28

Rebased patch:

01-T344359-rev2.patch20 KB[Download](https://phab.wmfusercontent.org/file/download/4xmwgoiy4rre7b7ntfpf/PHID-FILE-wnn7gigr6w6mfthkfssq/01-T344359-rev2.patch)

There was a minor, one-line conflict in includes/SpecialNewPagesFeed.php from [c960120](https://gerrit.wikimedia.org/r/960120).

[sbassett](/p/sbassett/) mentioned this in [T345889: 1.41.0-wmf.28 deployment blockers](/T345889).[Sep 25 2023, 8:02 PM2023-09-25 20:02:58 (UTC+0)](#9197202)

[• jnuche](/p/jnuche/) added a comment.[Sep 26 2023, 8:25 AM2023-09-26 08:25:17 (UTC+0)](#9198277)Comment Actions

Thank you [@sbassett](/p/sbassett/)

[Mstyles](/p/Mstyles/) added a subscriber: [gerritbot](/p/gerritbot/).[Sep 26 2023, 9:41 PM2023-09-26 21:41:55 (UTC+0)](#9201408)[gerritbot](/p/gerritbot/) added a comment.[Sep 27 2023, 12:38 AM2023-09-27 00:38:12 (UTC+0)](#9201734)Comment Actions

Change 960676 had a related patch set uploaded (by Mstyles; author: Sohom Datta):

[mediawiki/extensions/PageTriage@master] SECURITY: Don't expose usernames if user is hidden

<https://gerrit.wikimedia.org/r/960676>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Sep 27 2023, 12:38 AM2023-09-27 00:38:16 (UTC+0)](#9201735)[Reedy](/p/Reedy/) reopened this task as Open.[Sep 27 2023, 4:11 PM2023-09-27 16:11:41 (UTC+0)](#9204066)[gerritbot](/p/gerritbot/) added a comment.[Sep 27 2023, 11:10 PM2023-09-27 23:10:06 (UTC+0)](#9205159)Comment Actions

Change 960676 **merged** by jenkins-bot:

[mediawiki/extensions/PageTriage@master] SECURITY: Don't expose usernames if user is hidden

<https://gerrit.wikimedia.org/r/960676>

[dduvall](/p/dduvall/) removed a parent task: [T345889: 1.41.0-wmf.28 deployment blockers](/T345889).[Sep 28 2023, 6:24 PM2023-09-28 18:24:51 (UTC+0)](#9208230)[jsn.sherman](/p/jsn.sherman/) edited parent tasks, added: [T348541: [Epic] Q2 FY 2023-24 Moderator Tools Maintenance Work](/T348541); removed: [T338040: [Epic] Q1 FY 2023-24 Moderator Tools Maintenance Work](/T338040).[Oct 10 2023, 2:26 PM2023-10-10 14:26:09 (UTC+0)](#9239067)[jsn.sherman](/p/jsn.sherman/) closed this task as Resolved.[Oct 10 2023, 2:30 PM2023-10-10 14:30:16 (UTC+0)](#9239089)[jsn.sherman](/p/jsn.sherman/) edited parent tasks, added: [T338040: [Epic] Q1 FY 2023-24 Moderator Tools Maintenance Work](/T338040); removed: [T348541: [Epic] Q2 FY 2023-24 Moderator Tools Maintenance Work](/T348541).[Mstyles](/p/Mstyles/) renamed this task from pagetriagelist API leaks suppressed usernames to CVE-2023-45369: pagetriagelist API leaks suppressed usernames.[Oct 10 2023, 3:59 PM2023-10-10 15:59:25 (UTC+0)](#9239456)[Mstyles](/p/Mstyles/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-klz6uqqya7foi47/)" to "Public (No Login Required)".[Oct 10 2023, 5:07 PM2023-10-10 17:07:05 (UTC+0)](#9239829)[Mstyles](/p/Mstyles/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-kll5dwp7r6cfmzo/)" to "All Users".[Maintenance\_bot](/p/Maintenance_bot/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Oct 10 2023, 5:11 PM2023-10-10 17:11:17 (UTC+0)](#9239845)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)