=== Content from www.wordfence.com_ffb622e6_20250111_043342.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Folders – Unlimited Folders to Organize Media Library Folder, Pages, Posts, File Manager <= 3.0.3 - Authenticated (Contributor+) Stored Cross-Site Scripting via SVG File Upload

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Folders – Unlimited Folders to Organize Media Library Folder, Pages, Posts, File Manager <= 3.0.3 - Authenticated (Contributor+) Stored Cross-Site Scripting via SVG File Upload

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-7317](https://www.cve.org/CVERecord?id=CVE-2024-7317) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | August 5, 2024 |
| Last Updated | August 6, 2024 |
| Researcher | [wesley (wcraft)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/wesley-jhon) |

### Description

The Folders – Unlimited Folders to Organize Media Library Folder, Pages, Posts, File Manager plugin for WordPress is vulnerable to Stored Cross-Site Scripting via SVG File uploads in all versions up to, and including, 3.0.3 due to insufficient input sanitization and output escaping. This makes it possible for authenticated attackers, with Contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses the SVG file.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/folders/tags/3.0.3/includes/media.replace.php#L1296)
* [wordpress.org](https://wordpress.org/plugins/folders/#developers)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3130880/#file25)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3130880/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ffolders%2Ffolders-unlimited-folders-to-organize-media-library-folder-pages-posts-file-manager-303-authenticated-contributor-stored-cross-site-scripting-via-svg-file-upload&t=Folders%20%E2%80%93%20Unlimited%20Folders%20to%20Organize%20Media%20Library%20Folder%2C%20Pages%2C%20Posts%2C%20File%20Manager%20%3C%3D%203.0.3%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20SVG%20File%20Upload "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ffolders%2Ffolders-unlimited-folders-to-organize-media-library-folder-pages-posts-file-manager-303-authenticated-contributor-stored-cross-site-scripting-via-svg-file-upload&text=Folders%20%E2%80%93%20Unlimited%20Folders%20to%20Organize%20Media%20Library%20Folder%2C%20Pages%2C%20Posts%2C%20File%20Manager%20%3C%3D%203.0.3%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20SVG%20File%20Upload "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ffolders%2Ffolders-unlimited-folders-to-organize-media-library-folder-pages-posts-file-manager-303-authenticated-contributor-stored-cross-site-scripting-via-svg-file-upload "LinkedIn")
Email

## Vulnerability Details for Folders – Unlimited Folders to Organize Media Library Folder, Pages, Posts, File Manager

#### [Folders – Unlimited Folders to Organize Media Library Folder, Pages, Posts, File Manager](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/folders)

| Software Type | Plugin |
| --- | --- |
| Software Slug | folders [(view on wordpress.org)](https://wordpress.org/plugins/folders) |
| Patched? | Yes |
| Remediation | Update to version 3.0.4, or a newer patched version |
| Affected Version | * <= 3.0.3 |
| Patched Version | * 3.0.4 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_c454de0d_20250111_043340.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3130880)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3130879 "Changeset 3130879")
* [Next Changeset](/changeset/3130881 "Changeset 3130881") →

---

# Changeset 3130880

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
08/05/2024 08:09:40 AM
([5 months](/timeline?from=2024-08-05T08%3A09%3A40Z&precision=second "See timeline at 08/05/2024 08:09:40 AM") ago)

Author:
premiocommit
Message:

Update to version 3.0.4 from GitHub

Location:
[folders](/browser/folders?rev=3130880)
Files:

36 added
8 edited
1 copied

* [tags/3.0.4](/browser/folders/tags/3.0.4?rev=3130880 "Show entry in browser")
  (copied)
  *(copied from [folders/trunk](/browser/folders/trunk?rev=3114209 "Show original file (revision 3130879)"))*
* [tags/3.0.4/folders.php](/browser/folders/tags/3.0.4/folders.php?rev=3130880 "Show entry in browser")
  (modified)
  ([4 diffs](#file1 "Show differences"))
* [tags/3.0.4/includes/folders.class.php](/browser/folders/tags/3.0.4/includes/folders.class.php?rev=3130880 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [tags/3.0.4/includes/media.replace.php](/browser/folders/tags/3.0.4/includes/media.replace.php?rev=3130880 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [tags/3.0.4/includes/svg.class.php](/browser/folders/tags/3.0.4/includes/svg.class.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries](/browser/folders/tags/3.0.4/libraries?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer](/browser/folders/tags/3.0.4/libraries/svg-sanitizer?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/ElementReference](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/ElementReference?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Resolver.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Resolver.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Subject.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Subject.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Usage.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Usage.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/Exceptions](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/Exceptions?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/Exceptions/NestingException.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/Exceptions/NestingException.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/Helper.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/Helper.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/Sanitizer.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/Sanitizer.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data/AllowedAttributes.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data/AllowedAttributes.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data/AllowedTags.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data/AllowedTags.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data/AttributeInterface.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data/AttributeInterface.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data/TagInterface.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data/TagInterface.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data/XPath.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data/XPath.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/readme.txt](/browser/folders/tags/3.0.4/readme.txt?rev=3130880 "Show entry in browser")
  (modified)
  ([2 diffs](#file22 "Show differences"))
* [trunk/folders.php](/browser/folders/trunk/folders.php?rev=3130880 "Show entry in browser")
  (modified)
  ([4 diffs](#file23 "Show differences"))
* [trunk/includes/folders.class.php](/browser/folders/trunk/includes/folders.class.php?rev=3130880 "Show entry in browser")
  (modified)
  ([1 diff](#file24 "Show differences"))
* [trunk/includes/media.replace.php](/browser/folders/trunk/includes/media.replace.php?rev=3130880 "Show entry in browser")
  (modified)
  ([1 diff](#file25 "Show differences"))
* [trunk/includes/svg.class.php](/browser/folders/trunk/includes/svg.class.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries](/browser/folders/trunk/libraries?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer](/browser/folders/trunk/libraries/svg-sanitizer?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src](/browser/folders/trunk/libraries/svg-sanitizer/src?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/ElementReference](/browser/folders/trunk/libraries/svg-sanitizer/src/ElementReference?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/ElementReference/Resolver.php](/browser/folders/trunk/libraries/svg-sanitizer/src/ElementReference/Resolver.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/ElementReference/Subject.php](/browser/folders/trunk/libraries/svg-sanitizer/src/ElementReference/Subject.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/ElementReference/Usage.php](/browser/folders/trunk/libraries/svg-sanitizer/src/ElementReference/Usage.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/Exceptions](/browser/folders/trunk/libraries/svg-sanitizer/src/Exceptions?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/Exceptions/NestingException.php](/browser/folders/trunk/libraries/svg-sanitizer/src/Exceptions/NestingException.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/Helper.php](/browser/folders/trunk/libraries/svg-sanitizer/src/Helper.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/Sanitizer.php](/browser/folders/trunk/libraries/svg-sanitizer/src/Sanitizer.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data](/browser/folders/trunk/libraries/svg-sanitizer/src/data?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data/AllowedAttributes.php](/browser/folders/trunk/libraries/svg-sanitizer/src/data/AllowedAttributes.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data/AllowedTags.php](/browser/folders/trunk/libraries/svg-sanitizer/src/data/AllowedTags.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data/AttributeInterface.php](/browser/folders/trunk/libraries/svg-sanitizer/src/data/AttributeInterface.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data/TagInterface.php](/browser/folders/trunk/libraries/svg-sanitizer/src/data/TagInterface.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data/XPath.php](/browser/folders/trunk/libraries/svg-sanitizer/src/data/XPath.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/readme.txt](/browser/folders/trunk/readme.txt?rev=3130880 "Show entry in browser")
  (modified)
  ([2 diffs](#file44 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [folders/tags/3.0.4/folders.php](/changeset/3130880/folders/tags/3.0.4/folders.php "Show the changeset 3130880 restricted to folders/tags/3.0.4/folders.php")

  | [r3082245](/browser/folders/trunk/folders.php?rev=3082245#L3 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/tags/3.0.4/folders.php?rev=3130880#L3 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* Plugin Name: Folders |
  | 4 | 4 | \* Description: Organize your Media library, Pages, and Posts into folders. You can easily drag and drop items into directories and change the folders tree view. |
  | 5 |  | \* Version: 3.0.~~3~~ |
  |  | 5 | \* Version: 3.0.4 |
  | 6 | 6 | \* Author: Premio |
  | 7 | 7 | \* Author URI: https://premio.io/downloads/folders/ |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L15) | […](/browser/folders/tags/3.0.4/folders.php?rev=3130880#L15) |  |
  | 15 | 15 | define('WCP\_FOLDERS\_PLUGIN\_FILE', \_\_FILE\_\_); |
  | 16 | 16 | } |
  |  | 17 | if(!defined("WCP\_FOLDERS\_PLUGIN\_PATH")) { |
  |  | 18 | define('WCP\_FOLDERS\_PLUGIN\_PATH', plugin\_dir\_path(\_\_FILE\_\_) ); |
  |  | 19 | } |
  | 17 | 20 | if(!defined("WCP\_FOLDERS\_PLUGIN\_BASE")) { |
  | 18 | 21 | define('WCP\_FOLDERS\_PLUGIN\_BASE', plugin\_basename(WCP\_FOLDERS\_PLUGIN\_FILE)); |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L25) | […](/browser/folders/tags/3.0.4/folders.php?rev=3130880#L28) |  |
  | 25 | 28 | } |
  | 26 | 29 | if(!defined("WCP\_FOLDER\_VERSION")) { |
  | 27 |  | define('WCP\_FOLDER\_VERSION', "3.0.~~3~~"); |
  |  | 30 | define('WCP\_FOLDER\_VERSION', "3.0.4"); |
  | 28 | 31 | } |
  | 29 | 32 |  |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L99) | […](/browser/folders/tags/3.0.4/folders.php?rev=3130880#L102) |  |
  | 99 | 102 | } |
  | 100 | 103 |  |
  | 101 |  |  |
  | 102 | 104 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/plugins.class.php"; |
  | 103 | 105 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/media.replace.php"; |
  | 104 | 106 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/folders.class.php"; |
  |  | 107 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/svg.class.php"; |
  | 105 | 108 | register\_activation\_hook( \_\_FILE\_\_, array( 'WCP\_Folders', 'activate' ) ); |
  | 106 | 109 | register\_deactivation\_hook( \_\_FILE\_\_, array( 'WCP\_Folders', 'deactivate' ) ); |
* ## [folders/tags/3.0.4/includes/folders.class.php](/changeset/3130880/folders/tags/3.0.4/includes/folders.class.php "Show the changeset 3130880 restricted to folders/tags/3.0.4/includes/folders.class.php")

  | [r3082245](/browser/folders/trunk/includes/folders.class.php?rev=3082245#L2187 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/tags/3.0.4/includes/folders.class.php?rev=3130880#L2187 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 2187 | 2187 | $css\_text = ""; |
  | 2188 | 2188 | $customize\_folders = get\_option('customize\_folders'); |
  |  | 2189 | $customize\_folders = is\_array($customize\_folders)?$customize\_folders:[]; |
  | 2189 | 2190 | if (!isset($customize\_folders['new\_folder\_color']) || empty($customize\_folders['new\_folder\_color'])) { |
  | 2190 | 2191 | $customize\_folders['new\_folder\_color'] = "#FA166B"; |
* ## [folders/tags/3.0.4/includes/media.replace.php](/changeset/3130880/folders/tags/3.0.4/includes/media.replace.php "Show the changeset 3130880 restricted to folders/tags/3.0.4/includes/media.replace.php")

  | [r3082245](/browser/folders/trunk/includes/media.replace.php?rev=3082245#L1221 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/tags/3.0.4/includes/media.replace.php?rev=3130880#L1221 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 1221 | 1221 | if(!in\_array($file['type'], ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml'])) { |
  | 1222 | 1222 | wp\_die(esc\_html\_\_("Sorry, this file type is not permitted for security reasons", "folders")); |
  |  | 1223 | } |
  |  | 1224 |  |
  |  | 1225 | if($file\_ext == "svg" || $file['type'] == 'image/svg+xml') { |
  |  | 1226 | $status = sanitizeSvgFileContent($file['tmp\_name']); |
  |  | 1227 | if(!$status) { |
  |  | 1228 | wp\_die(esc\_html\_\_("Sorry, this file type is not permitted for security reasons", "folders")); |
  |  | 1229 | } |
  | 1223 | 1230 | } |
  | 1224 | 1231 |  |
* ## [folders/tags/3.0.4/readme.txt](/changeset/3130880/folders/tags/3.0.4/readme.txt "Show the changeset 3130880 restricted to folders/tags/3.0.4/readme.txt")

  | [r3114209](/browser/folders/trunk/readme.txt?rev=3114209#L4 "Show revision 3114209 of this file in browser") | [r3130880](/browser/folders/tags/3.0.4/readme.txt?rev=3130880#L4 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 3.0.0 |
  | 5 | 5 | Tested up to: 6.6 |
  | 6 |  | Stable tag: 3.0.~~3~~ |
  |  | 6 | Stable tag: 3.0.4 |
  | 7 | 7 | Plugin URI: https://premio.io/downloads/folders/ |
  | 8 | 8 |  |
  | […](/browser/folders/trunk/readme.txt?rev=3114209#L224) | […](/browser/folders/tags/3.0.4/readme.txt?rev=3130880#L224) |  |
  | 224 | 224 | == Changelog == |
  | 225 | 225 |  |
  |  | 226 | = 3.0.4 = |
  |  | 227 | SVG validation bug fixed |
  |  | 228 |  |
  | 226 | 229 | = 3.0.3 = |
  | 227 | 230 | Brisk editor conflict fixed |
* ## [folders/trunk/folders.php](/changeset/3130880/folders/trunk/folders.php "Show the changeset 3130880 restricted to folders/trunk/folders.php")

  | [r3082245](/browser/folders/trunk/folders.php?rev=3082245#L3 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/trunk/folders.php?rev=3130880#L3 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* Plugin Name: Folders |
  | 4 | 4 | \* Description: Organize your Media library, Pages, and Posts into folders. You can easily drag and drop items into directories and change the folders tree view. |
  | 5 |  | \* Version: 3.0.~~3~~ |
  |  | 5 | \* Version: 3.0.4 |
  | 6 | 6 | \* Author: Premio |
  | 7 | 7 | \* Author URI: https://premio.io/downloads/folders/ |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L15) | […](/browser/folders/trunk/folders.php?rev=3130880#L15) |  |
  | 15 | 15 | define('WCP\_FOLDERS\_PLUGIN\_FILE', \_\_FILE\_\_); |
  | 16 | 16 | } |
  |  | 17 | if(!defined("WCP\_FOLDERS\_PLUGIN\_PATH")) { |
  |  | 18 | define('WCP\_FOLDERS\_PLUGIN\_PATH', plugin\_dir\_path(\_\_FILE\_\_) ); |
  |  | 19 | } |
  | 17 | 20 | if(!defined("WCP\_FOLDERS\_PLUGIN\_BASE")) { |
  | 18 | 21 | define('WCP\_FOLDERS\_PLUGIN\_BASE', plugin\_basename(WCP\_FOLDERS\_PLUGIN\_FILE)); |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L25) | […](/browser/folders/trunk/folders.php?rev=3130880#L28) |  |
  | 25 | 28 | } |
  | 26 | 29 | if(!defined("WCP\_FOLDER\_VERSION")) { |
  | 27 |  | define('WCP\_FOLDER\_VERSION', "3.0.~~3~~"); |
  |  | 30 | define('WCP\_FOLDER\_VERSION', "3.0.4"); |
  | 28 | 31 | } |
  | 29 | 32 |  |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L99) | […](/browser/folders/trunk/folders.php?rev=3130880#L102) |  |
  | 99 | 102 | } |
  | 100 | 103 |  |
  | 101 |  |  |
  | 102 | 104 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/plugins.class.php"; |
  | 103 | 105 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/media.replace.php"; |
  | 104 | 106 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/folders.class.php"; |
  |  | 107 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/svg.class.php"; |
  | 105 | 108 | register\_activation\_hook( \_\_FILE\_\_, array( 'WCP\_Folders', 'activate' ) ); |
  | 106 | 109 | register\_deactivation\_hook( \_\_FILE\_\_, array( 'WCP\_Folders', 'deactivate' ) ); |
* ## [folders/trunk/includes/folders.class.php](/changeset/3130880/folders/trunk/includes/folders.class.php "Show the changeset 3130880 restricted to folders/trunk/includes/folders.class.php")

  | [r3082245](/browser/folders/trunk/includes/folders.class.php?rev=3082245#L2187 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/trunk/includes/folders.class.php?rev=3130880#L2187 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 2187 | 2187 | $css\_text = ""; |
  | 2188 | 2188 | $customize\_folders = get\_option('customize\_folders'); |
  |  | 2189 | $customize\_folders = is\_array($customize\_folders)?$customize\_folders:[]; |
  | 2189 | 2190 | if (!isset($customize\_folders['new\_folder\_color']) || empty($customize\_folders['new\_folder\_color'])) { |
  | 2190 | 2191 | $customize\_folders['new\_folder\_color'] = "#FA166B"; |
* ## [folders/trunk/includes/media.replace.php](/changeset/3130880/folders/trunk/includes/media.replace.php "Show the changeset 3130880 restricted to folders/trunk/includes/media.replace.php")

  | [r3082245](/browser/folders/trunk/includes/media.replace.php?rev=3082245#L1221 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/trunk/includes/media.replace.php?rev=3130880#L1221 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 1221 | 1221 | if(!in\_array($file['type'], ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml'])) { |
  | 1222 | 1222 | wp\_die(esc\_html\_\_("Sorry, this file type is not permitted for security reasons", "folders")); |
  |  | 1223 | } |
  |  | 1224 |  |
  |  | 1225 | if($file\_ext == "svg" || $file['type'] == 'image/svg+xml') { |
  |  | 1226 | $status = sanitizeSvgFileContent($file['tmp\_name']); |
  |  | 1227 | if(!$status) { |
  |  | 1228 | wp\_die(esc\_html\_\_("Sorry, this file type is not permitted for security reasons", "folders")); |
  |  | 1229 | } |
  | 1223 | 1230 | } |
  | 1224 | 1231 |  |
* ## [folders/trunk/readme.txt](/changeset/3130880/folders/trunk/readme.txt "Show the changeset 3130880 restricted to folders/trunk/readme.txt")

  | [r3114209](/browser/folders/trunk/readme.txt?rev=3114209#L4 "Show revision 3114209 of this file in browser") | [r3130880](/browser/folders/trunk/readme.txt?rev=3130880#L4 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 3.0.0 |
  | 5 | 5 | Tested up to: 6.6 |
  | 6 |  | Stable tag: 3.0.~~3~~ |
  |  | 6 | Stable tag: 3.0.4 |
  | 7 | 7 | Plugin URI: https://premio.io/downloads/folders/ |
  | 8 | 8 |  |
  | […](/browser/folders/trunk/readme.txt?rev=3114209#L224) | […](/browser/folders/trunk/readme.txt?rev=3130880#L224) |  |
  | 224 | 224 | == Changelog == |
  | 225 | 225 |  |
  |  | 226 | = 3.0.4 = |
  |  | 227 | SVG validation bug fixed |
  |  | 228 |  |
  | 226 | 229 | = 3.0.3 = |
  | 227 | 230 | Brisk editor conflict fixed |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3130880)
* [Zip Archive](?format=zip&new=3130880)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_c9af4974_20250111_043339.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3130880)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3130879 "Changeset 3130879")
* [Next Changeset](/changeset/3130881 "Changeset 3130881") →

---

# Changeset 3130880

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
08/05/2024 08:09:40 AM
([5 months](/timeline?from=2024-08-05T08%3A09%3A40Z&precision=second "See timeline at 08/05/2024 08:09:40 AM") ago)

Author:
premiocommit
Message:

Update to version 3.0.4 from GitHub

Location:
[folders](/browser/folders?rev=3130880)
Files:

36 added
8 edited
1 copied

* [tags/3.0.4](/browser/folders/tags/3.0.4?rev=3130880 "Show entry in browser")
  (copied)
  *(copied from [folders/trunk](/browser/folders/trunk?rev=3114209 "Show original file (revision 3130879)"))*
* [tags/3.0.4/folders.php](/browser/folders/tags/3.0.4/folders.php?rev=3130880 "Show entry in browser")
  (modified)
  ([4 diffs](#file1 "Show differences"))
* [tags/3.0.4/includes/folders.class.php](/browser/folders/tags/3.0.4/includes/folders.class.php?rev=3130880 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [tags/3.0.4/includes/media.replace.php](/browser/folders/tags/3.0.4/includes/media.replace.php?rev=3130880 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [tags/3.0.4/includes/svg.class.php](/browser/folders/tags/3.0.4/includes/svg.class.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries](/browser/folders/tags/3.0.4/libraries?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer](/browser/folders/tags/3.0.4/libraries/svg-sanitizer?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/ElementReference](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/ElementReference?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Resolver.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Resolver.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Subject.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Subject.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Usage.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/ElementReference/Usage.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/Exceptions](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/Exceptions?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/Exceptions/NestingException.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/Exceptions/NestingException.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/Helper.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/Helper.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/Sanitizer.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/Sanitizer.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data/AllowedAttributes.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data/AllowedAttributes.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data/AllowedTags.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data/AllowedTags.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data/AttributeInterface.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data/AttributeInterface.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data/TagInterface.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data/TagInterface.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/libraries/svg-sanitizer/src/data/XPath.php](/browser/folders/tags/3.0.4/libraries/svg-sanitizer/src/data/XPath.php?rev=3130880 "Show entry in browser")
  (added)
* [tags/3.0.4/readme.txt](/browser/folders/tags/3.0.4/readme.txt?rev=3130880 "Show entry in browser")
  (modified)
  ([2 diffs](#file22 "Show differences"))
* [trunk/folders.php](/browser/folders/trunk/folders.php?rev=3130880 "Show entry in browser")
  (modified)
  ([4 diffs](#file23 "Show differences"))
* [trunk/includes/folders.class.php](/browser/folders/trunk/includes/folders.class.php?rev=3130880 "Show entry in browser")
  (modified)
  ([1 diff](#file24 "Show differences"))
* [trunk/includes/media.replace.php](/browser/folders/trunk/includes/media.replace.php?rev=3130880 "Show entry in browser")
  (modified)
  ([1 diff](#file25 "Show differences"))
* [trunk/includes/svg.class.php](/browser/folders/trunk/includes/svg.class.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries](/browser/folders/trunk/libraries?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer](/browser/folders/trunk/libraries/svg-sanitizer?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src](/browser/folders/trunk/libraries/svg-sanitizer/src?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/ElementReference](/browser/folders/trunk/libraries/svg-sanitizer/src/ElementReference?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/ElementReference/Resolver.php](/browser/folders/trunk/libraries/svg-sanitizer/src/ElementReference/Resolver.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/ElementReference/Subject.php](/browser/folders/trunk/libraries/svg-sanitizer/src/ElementReference/Subject.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/ElementReference/Usage.php](/browser/folders/trunk/libraries/svg-sanitizer/src/ElementReference/Usage.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/Exceptions](/browser/folders/trunk/libraries/svg-sanitizer/src/Exceptions?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/Exceptions/NestingException.php](/browser/folders/trunk/libraries/svg-sanitizer/src/Exceptions/NestingException.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/Helper.php](/browser/folders/trunk/libraries/svg-sanitizer/src/Helper.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/Sanitizer.php](/browser/folders/trunk/libraries/svg-sanitizer/src/Sanitizer.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data](/browser/folders/trunk/libraries/svg-sanitizer/src/data?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data/AllowedAttributes.php](/browser/folders/trunk/libraries/svg-sanitizer/src/data/AllowedAttributes.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data/AllowedTags.php](/browser/folders/trunk/libraries/svg-sanitizer/src/data/AllowedTags.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data/AttributeInterface.php](/browser/folders/trunk/libraries/svg-sanitizer/src/data/AttributeInterface.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data/TagInterface.php](/browser/folders/trunk/libraries/svg-sanitizer/src/data/TagInterface.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/libraries/svg-sanitizer/src/data/XPath.php](/browser/folders/trunk/libraries/svg-sanitizer/src/data/XPath.php?rev=3130880 "Show entry in browser")
  (added)
* [trunk/readme.txt](/browser/folders/trunk/readme.txt?rev=3130880 "Show entry in browser")
  (modified)
  ([2 diffs](#file44 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [folders/tags/3.0.4/folders.php](/changeset/3130880/folders/tags/3.0.4/folders.php "Show the changeset 3130880 restricted to folders/tags/3.0.4/folders.php")

  | [r3082245](/browser/folders/trunk/folders.php?rev=3082245#L3 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/tags/3.0.4/folders.php?rev=3130880#L3 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* Plugin Name: Folders |
  | 4 | 4 | \* Description: Organize your Media library, Pages, and Posts into folders. You can easily drag and drop items into directories and change the folders tree view. |
  | 5 |  | \* Version: 3.0.~~3~~ |
  |  | 5 | \* Version: 3.0.4 |
  | 6 | 6 | \* Author: Premio |
  | 7 | 7 | \* Author URI: https://premio.io/downloads/folders/ |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L15) | […](/browser/folders/tags/3.0.4/folders.php?rev=3130880#L15) |  |
  | 15 | 15 | define('WCP\_FOLDERS\_PLUGIN\_FILE', \_\_FILE\_\_); |
  | 16 | 16 | } |
  |  | 17 | if(!defined("WCP\_FOLDERS\_PLUGIN\_PATH")) { |
  |  | 18 | define('WCP\_FOLDERS\_PLUGIN\_PATH', plugin\_dir\_path(\_\_FILE\_\_) ); |
  |  | 19 | } |
  | 17 | 20 | if(!defined("WCP\_FOLDERS\_PLUGIN\_BASE")) { |
  | 18 | 21 | define('WCP\_FOLDERS\_PLUGIN\_BASE', plugin\_basename(WCP\_FOLDERS\_PLUGIN\_FILE)); |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L25) | […](/browser/folders/tags/3.0.4/folders.php?rev=3130880#L28) |  |
  | 25 | 28 | } |
  | 26 | 29 | if(!defined("WCP\_FOLDER\_VERSION")) { |
  | 27 |  | define('WCP\_FOLDER\_VERSION', "3.0.~~3~~"); |
  |  | 30 | define('WCP\_FOLDER\_VERSION', "3.0.4"); |
  | 28 | 31 | } |
  | 29 | 32 |  |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L99) | […](/browser/folders/tags/3.0.4/folders.php?rev=3130880#L102) |  |
  | 99 | 102 | } |
  | 100 | 103 |  |
  | 101 |  |  |
  | 102 | 104 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/plugins.class.php"; |
  | 103 | 105 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/media.replace.php"; |
  | 104 | 106 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/folders.class.php"; |
  |  | 107 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/svg.class.php"; |
  | 105 | 108 | register\_activation\_hook( \_\_FILE\_\_, array( 'WCP\_Folders', 'activate' ) ); |
  | 106 | 109 | register\_deactivation\_hook( \_\_FILE\_\_, array( 'WCP\_Folders', 'deactivate' ) ); |
* ## [folders/tags/3.0.4/includes/folders.class.php](/changeset/3130880/folders/tags/3.0.4/includes/folders.class.php "Show the changeset 3130880 restricted to folders/tags/3.0.4/includes/folders.class.php")

  | [r3082245](/browser/folders/trunk/includes/folders.class.php?rev=3082245#L2187 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/tags/3.0.4/includes/folders.class.php?rev=3130880#L2187 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 2187 | 2187 | $css\_text = ""; |
  | 2188 | 2188 | $customize\_folders = get\_option('customize\_folders'); |
  |  | 2189 | $customize\_folders = is\_array($customize\_folders)?$customize\_folders:[]; |
  | 2189 | 2190 | if (!isset($customize\_folders['new\_folder\_color']) || empty($customize\_folders['new\_folder\_color'])) { |
  | 2190 | 2191 | $customize\_folders['new\_folder\_color'] = "#FA166B"; |
* ## [folders/tags/3.0.4/includes/media.replace.php](/changeset/3130880/folders/tags/3.0.4/includes/media.replace.php "Show the changeset 3130880 restricted to folders/tags/3.0.4/includes/media.replace.php")

  | [r3082245](/browser/folders/trunk/includes/media.replace.php?rev=3082245#L1221 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/tags/3.0.4/includes/media.replace.php?rev=3130880#L1221 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 1221 | 1221 | if(!in\_array($file['type'], ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml'])) { |
  | 1222 | 1222 | wp\_die(esc\_html\_\_("Sorry, this file type is not permitted for security reasons", "folders")); |
  |  | 1223 | } |
  |  | 1224 |  |
  |  | 1225 | if($file\_ext == "svg" || $file['type'] == 'image/svg+xml') { |
  |  | 1226 | $status = sanitizeSvgFileContent($file['tmp\_name']); |
  |  | 1227 | if(!$status) { |
  |  | 1228 | wp\_die(esc\_html\_\_("Sorry, this file type is not permitted for security reasons", "folders")); |
  |  | 1229 | } |
  | 1223 | 1230 | } |
  | 1224 | 1231 |  |
* ## [folders/tags/3.0.4/readme.txt](/changeset/3130880/folders/tags/3.0.4/readme.txt "Show the changeset 3130880 restricted to folders/tags/3.0.4/readme.txt")

  | [r3114209](/browser/folders/trunk/readme.txt?rev=3114209#L4 "Show revision 3114209 of this file in browser") | [r3130880](/browser/folders/tags/3.0.4/readme.txt?rev=3130880#L4 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 3.0.0 |
  | 5 | 5 | Tested up to: 6.6 |
  | 6 |  | Stable tag: 3.0.~~3~~ |
  |  | 6 | Stable tag: 3.0.4 |
  | 7 | 7 | Plugin URI: https://premio.io/downloads/folders/ |
  | 8 | 8 |  |
  | […](/browser/folders/trunk/readme.txt?rev=3114209#L224) | […](/browser/folders/tags/3.0.4/readme.txt?rev=3130880#L224) |  |
  | 224 | 224 | == Changelog == |
  | 225 | 225 |  |
  |  | 226 | = 3.0.4 = |
  |  | 227 | SVG validation bug fixed |
  |  | 228 |  |
  | 226 | 229 | = 3.0.3 = |
  | 227 | 230 | Brisk editor conflict fixed |
* ## [folders/trunk/folders.php](/changeset/3130880/folders/trunk/folders.php "Show the changeset 3130880 restricted to folders/trunk/folders.php")

  | [r3082245](/browser/folders/trunk/folders.php?rev=3082245#L3 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/trunk/folders.php?rev=3130880#L3 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* Plugin Name: Folders |
  | 4 | 4 | \* Description: Organize your Media library, Pages, and Posts into folders. You can easily drag and drop items into directories and change the folders tree view. |
  | 5 |  | \* Version: 3.0.~~3~~ |
  |  | 5 | \* Version: 3.0.4 |
  | 6 | 6 | \* Author: Premio |
  | 7 | 7 | \* Author URI: https://premio.io/downloads/folders/ |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L15) | […](/browser/folders/trunk/folders.php?rev=3130880#L15) |  |
  | 15 | 15 | define('WCP\_FOLDERS\_PLUGIN\_FILE', \_\_FILE\_\_); |
  | 16 | 16 | } |
  |  | 17 | if(!defined("WCP\_FOLDERS\_PLUGIN\_PATH")) { |
  |  | 18 | define('WCP\_FOLDERS\_PLUGIN\_PATH', plugin\_dir\_path(\_\_FILE\_\_) ); |
  |  | 19 | } |
  | 17 | 20 | if(!defined("WCP\_FOLDERS\_PLUGIN\_BASE")) { |
  | 18 | 21 | define('WCP\_FOLDERS\_PLUGIN\_BASE', plugin\_basename(WCP\_FOLDERS\_PLUGIN\_FILE)); |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L25) | […](/browser/folders/trunk/folders.php?rev=3130880#L28) |  |
  | 25 | 28 | } |
  | 26 | 29 | if(!defined("WCP\_FOLDER\_VERSION")) { |
  | 27 |  | define('WCP\_FOLDER\_VERSION', "3.0.~~3~~"); |
  |  | 30 | define('WCP\_FOLDER\_VERSION', "3.0.4"); |
  | 28 | 31 | } |
  | 29 | 32 |  |
  | […](/browser/folders/trunk/folders.php?rev=3082245#L99) | […](/browser/folders/trunk/folders.php?rev=3130880#L102) |  |
  | 99 | 102 | } |
  | 100 | 103 |  |
  | 101 |  |  |
  | 102 | 104 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/plugins.class.php"; |
  | 103 | 105 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/media.replace.php"; |
  | 104 | 106 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/folders.class.php"; |
  |  | 107 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "includes/svg.class.php"; |
  | 105 | 108 | register\_activation\_hook( \_\_FILE\_\_, array( 'WCP\_Folders', 'activate' ) ); |
  | 106 | 109 | register\_deactivation\_hook( \_\_FILE\_\_, array( 'WCP\_Folders', 'deactivate' ) ); |
* ## [folders/trunk/includes/folders.class.php](/changeset/3130880/folders/trunk/includes/folders.class.php "Show the changeset 3130880 restricted to folders/trunk/includes/folders.class.php")

  | [r3082245](/browser/folders/trunk/includes/folders.class.php?rev=3082245#L2187 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/trunk/includes/folders.class.php?rev=3130880#L2187 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 2187 | 2187 | $css\_text = ""; |
  | 2188 | 2188 | $customize\_folders = get\_option('customize\_folders'); |
  |  | 2189 | $customize\_folders = is\_array($customize\_folders)?$customize\_folders:[]; |
  | 2189 | 2190 | if (!isset($customize\_folders['new\_folder\_color']) || empty($customize\_folders['new\_folder\_color'])) { |
  | 2190 | 2191 | $customize\_folders['new\_folder\_color'] = "#FA166B"; |
* ## [folders/trunk/includes/media.replace.php](/changeset/3130880/folders/trunk/includes/media.replace.php "Show the changeset 3130880 restricted to folders/trunk/includes/media.replace.php")

  | [r3082245](/browser/folders/trunk/includes/media.replace.php?rev=3082245#L1221 "Show revision 3082245 of this file in browser") | [r3130880](/browser/folders/trunk/includes/media.replace.php?rev=3130880#L1221 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 1221 | 1221 | if(!in\_array($file['type'], ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml'])) { |
  | 1222 | 1222 | wp\_die(esc\_html\_\_("Sorry, this file type is not permitted for security reasons", "folders")); |
  |  | 1223 | } |
  |  | 1224 |  |
  |  | 1225 | if($file\_ext == "svg" || $file['type'] == 'image/svg+xml') { |
  |  | 1226 | $status = sanitizeSvgFileContent($file['tmp\_name']); |
  |  | 1227 | if(!$status) { |
  |  | 1228 | wp\_die(esc\_html\_\_("Sorry, this file type is not permitted for security reasons", "folders")); |
  |  | 1229 | } |
  | 1223 | 1230 | } |
  | 1224 | 1231 |  |
* ## [folders/trunk/readme.txt](/changeset/3130880/folders/trunk/readme.txt "Show the changeset 3130880 restricted to folders/trunk/readme.txt")

  | [r3114209](/browser/folders/trunk/readme.txt?rev=3114209#L4 "Show revision 3114209 of this file in browser") | [r3130880](/browser/folders/trunk/readme.txt?rev=3130880#L4 "Show revision 3130880 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 3.0.0 |
  | 5 | 5 | Tested up to: 6.6 |
  | 6 |  | Stable tag: 3.0.~~3~~ |
  |  | 6 | Stable tag: 3.0.4 |
  | 7 | 7 | Plugin URI: https://premio.io/downloads/folders/ |
  | 8 | 8 |  |
  | […](/browser/folders/trunk/readme.txt?rev=3114209#L224) | […](/browser/folders/trunk/readme.txt?rev=3130880#L224) |  |
  | 224 | 224 | == Changelog == |
  | 225 | 225 |  |
  |  | 226 | = 3.0.4 = |
  |  | 227 | SVG validation bug fixed |
  |  | 228 |  |
  | 226 | 229 | = 3.0.3 = |
  | 227 | 230 | Brisk editor conflict fixed |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3130880)
* [Zip Archive](?format=zip&new=3130880)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from wordpress.org_9f32aba1_20250111_043341.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

Folders – Unlimited Folders to Organize Media Library Folder, Pages, Posts, File Manager

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Ffolders&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Ffolders&locale=en_US)

Search plugins

![](https://ps.w.org/folders/assets/banner-772x250.png?rev=2893439)
![](https://ps.w.org/folders/assets/icon-256x256.gif?rev=2893439)
# Folders – Unlimited Folders to Organize Media Library Folder, Pages, Posts, File Manager

By [Premio](https://premio.io/downloads/folders/)

[Download](https://downloads.wordpress.org/plugin/folders.3.0.6.zip)
[Live Preview](https://wordpress.org/plugins/folders/?preview=1)

* [Details](https://wordpress.org/plugins/folders/#description)
* [Reviews](https://wordpress.org/plugins/folders/#reviews)
* [Installation](https://wordpress.org/plugins/folders/#installation)
* [Development](https://wordpress.org/plugins/folders/#developers)

[Support](https://wordpress.org/support/plugin/folders/)

## Description

[Support](https://premio.io/help/folders/?utm_source=wordpressorg "Support") | [Demo](https://demo.premio.io/folders/?utm_source=wordpressorg "Premio.io demo site") | [Recommended Plugins](https://premio.io/?utm_source=wordpressorg "WordPress plugins") | [**Upgrade to Pro ⭐**](https://premio.io/downloads/folders/?utm_source=wordpressorg "Folders Pro")

Create **Unlimited Folders** In The Free Version 🎉

Folders is a WordPress plugin that enables users to organize all of their Pages, Posts, and Media files in folders. Easily drag and drop items into directories and change the folders tree view (hierarchy). Check out [**Folders Pro Plans**](https://premio.io/downloads/folders "Folders pro plans").

#### 💪 How Folders Plugin Can Help You

Use Folders plugin to organize your WordPress content:

* Keep all of your media files organized in folders including photos, videos, music, main website pages, and blog posts. You can also organize media library files in multiple folders.
* Web developers: keep your clients’ website pages in proper order. Mark a folder with a star or give it a unique name for clients to understand what is important.
* Bloggers: manage your own content with ease with this file manager plugin. Organize photos and content by topics, categories, and/or dates.
* Quickly upload pages, media, and content to your WordPress and easily organize them into directories.
* Mark certain folders as important to quickly find the content you need for your WordPress projects.
* Media replace: replace media files with other files. Whenever you replace media, the change will reflect throughout your website on all your pages, posts, etc.

**Note:** adding a page/post/image into a folder will not change its URL. The folders plugin creates virtual folders, it doesn’t create actual folders in your server or WordPress installation.

#### ▶️ Live Demo

A live demo for the Folders plugin is available at [Premio’s demo site](https://folders-demo.premio.io/wp-admin/ "Premio.io demo site").

#### 🛠️ So How Does the Folders plugin Work?

Upload text, images, videos, and audio. Then organize everything you upload into neat folders. For instance, create a media folder, content folder, and image folder, then have them all organized by date. It has a drag and drop interface, making it user-friendly for everyone. It’s like having your own media library at your own disposal. Create this media library for yourself or others.

#### 🔥 FOLDERS PLUGIN FEATURES

* **Create unlimited folders**
* Drag and drop pages, posts, and media library
* Media replace – replace media files
* Folders icon colors – change the color of your folder icons. Change it for specific folders, or all folders
* Import folders from other plugins and export Folders structure – import folders from FileBird, Enhanced Media Library, Wicked Folders, Real Media Library, and WP Media Folder. You can also export Folders strucutre
* Keyboard shortcuts – do quick actions with your folders using keyboard shortcuts. For example, create new folders, rename folders, duplicate a folder, reorder folders, and much more
* Move media library files, pages & posts to folders without using our drag and drop feature. Whenever you select any element or select some elements in bulk, move it to a folder using our dropdown menu
* Undo action – undo your last action in Folders
* Select specific folders when you add media to your pages, posts or any other post type
* Drag and drop folders, change order, and hierarchy
* Search folder names
* Create more than one folder at once (separate your folders names with commas)
* Sort your folders – sort your folders based on the name of the folders
* Media Library folders upload progress bar – track the progress of your uploads to the media library
* Bulk select images and media files and drag them to any folder. Drag and drop media library files one-by-one
* Bulk select and delete folders. Select one folder or more and delete it in the click of a button
* While adding images or any kind of file from your media library to your pages and posts, use Folders to view all your media library files based on the folder the files are assigned to
* Rename folders
* Monitor all the unassigned media library files, posts, and page. Organize them easily to your folders
* Simultaneously assign and organize media, pages and posts while adding them to directories
* Place content in multiple folders at once
* Resize folders menu
* Compatible with RTL admin panel (such as Hebrew, Arabic & more)
* Add and remove folders menu from pages, posts, and media
* Minimize the folders area if you need extra space
* Folders plugin is compatible with WPML

#### 🚀 FOLDERS PLUGIN PRO FEATURES

* [**Upgrade to pro**](https://premio.io/downloads/folders?utm_source=wporg "Folders pro plans") to get unlimited sub-folders 🙂
* Create folders for each post type – use folders with other plugins that have custom post types (e.g. Elementor templates, WooCommerce products & more)
* Dynamic Folders – automatically filter posts, pages, custom posts, and media library files based on author, date, file size, file types, WooCommerce products & more
* Delete unused media library files – using the Folders plugin, search for unused media files that take up unnecessary space on your server, and clean them with just a few clicks. Unused media library will be sorted from the biggest files to the smallest media library files
* Organize your Plugins using Folders – create Folders for your plugins and organize them
* Set Email Notifications – stay informed with notifications whenever an action occurs on Folders — whether a new file is uploaded by a team member, a post is deleted, or any other change is made. Perfect for keeping track of updates.
* Folders’ icon colors
* Download any media library folder as a ZIP: download any media library folder as a zip file
* Sticky folders – pin your folders to the upper part of the folders navigation area. Use the sticky folders feature to make your most important folders accessible
* Star directories
* Upload folders from your PC – upload your computer folders, and all its structure (including subfolders) will be recreated on your WordPress website
* Folders user access management – advanced folders access management for your team with roles that restrict their access to view and edit your website’s folders
* Lock folders – locked folders stay pinned, and cannot be dragged or deleted (lock all folders/unlock all folders too)
* Auto rename file based on the title – replace the actual file name of media files with the title from the WordPress editor
* Advanced Media Replacements – replace media files when uploading and update all references in the database, change dates, organize by newer date & more wi
* Duplicate folders – duplicate an existing folder
* Sort your folders based on the creation date
* SVG support – with Folders Pro you can upload SVG files
* Upload directly to a media library folder – upload images or any other kind of files to a specific folder
* Select a default folder for your media library, posts, pages, and custom posts – select the folder that will load by default when you open your media library, pages, posts, and custom posts. E.g., show all the unassigned files whenever you open the media library
* Create media library folders directly when you upload new media files
* Sticky toolbar for the media library – navigate and organize your folders
* Metadata details on Media Library hover – show useful metadata including title, size, type, date, dimension & more on hover
* Customize the look and feel of your folders
* Replace media for all file types – Replace any kind of files while uploading including PDF/SVG/DOCS/XLSX/etc
* Compare the new media library file with the old file when you replace media – compare old media library files with the new one and compare size, dimension & more
* Folders user restriction – when enabled, users will only be able to access their folders and media. Only Admin users will be able to view all folders (can be enabled for the Dynamic Folders as well)
* Move files to the trash by default before deleting

#### 🤖 Dynamic Folders

With the Pro version, when you use the folders plugin on WordPress, our plugin intelligently recognizes the posts, pages, custom posts, and media library files and sorts them into dynamically created folders.

With dynamic folders, Sort out all your posts by date, authors, categories and more! Folders seamlessly integrates with the WordPress interface to intelligently create folders containing your content.

We also have a native integration with WooCommerce. Manage your dynamic folders automatically using Folders with WooCommerce.

This is a great way to manage all your stuff into different folders right after you start using folders.

#### 🔁 Replace media files

With the Folders plugin, replace media library files with other files. Save time whenever you need to replace a media file on all of your pages, posts, etc. When you replace a media file, the change will reflect on all of your pages, posts, and more.

With the replace media files feature, users can select the file they want to replace, choose whether to “just replace the file” or “replace the file and use the new file name and update all relevant links”, and select any desired date options. The changes are automatically applied to all instances of the file on the user’s website, so they don’t have to waste time manually replacing each instance of the file.

Media replace feature allows for quick and easy replace media files process, without manually replacing each instance of the file on their website. Plus, with the ability to choose date options, users can easily maintain the context and relevance of their media files.

Media replace feature video:

#### 📁 Bulk Organize The Media Library Files

The bulk organize media feature in Folders allows users to quickly and easily move multiple media files into folders at once. Using the intuitive drag-and-drop interface, users can select the files they want to move, drag them into the desired folder, and watch as the counter increases to indicate that the files have been successfully moved.

In addition to using drag-and-drop, users can also use the dropdown menu to move their files without using drag and drop. With the bulk organize media feature, users can take control of their WordPress media organization.

#### 💾 Download Media Library Folder

A feature you get with the Pro version with our easy-to-use interface, all the folders’ content be downloaded in a ZIP file. Download the entire media library folder.

#### 📤 Upload a folder structure locally from your computer

With the Pro version, upload a folder structure directly from your computer and replicate it as virtual folders in your media library. The upload folder button helps you upload the structure of the folder hierarchy directly, helping you save a lot of time as you can have a ready-made structure ready to use on folders without putting in a ton of effort and time into creating multiple folders and subfolders from scratch.

#### 🌟 Custom Posts Support

In the Pro version, if you use plugins that provide custom posts, organize the custom posts using folders. Simply enable the support for folders for your custom post, and you are all set to use folders with your custom post! For example: Use this feature for WooCommerce products, orders, coupons and more!

#### 👋 Import and export existing Folders

Import folders data from FileBird, Enhanced Media Library, Wicked Folders, Real Media Library, WP Media Folder, HappyFiles (Happy Files), and Mediamatic.

Have you been using FileBird, Enhanced Media Library, Wicked Folders, Real Media Library, or WP Media Folder, and are you considering switching to Folders. Import all existing folders created with any of these plug-ins so that you don’t have to sort all your files and folders all over again. Our intelligent folder detection capability can alert you when it detects any previous folder structure from any of these existing plugins. You can also export Folders.

#### 💻 Here Are Some Use Cases

Wondering how you can use these pages, posts, and media library folders plugin for your online business?

**Bloggers:** Easily upload content for blogs, including text, photos, videos, and audio files. Then manage everything you upload by placing them in clearly labeled media library folders.

**Web developers:** Design websites in an organized fashion by uploading graphics, animations, site elements, and content – all packaged neatly in directories.

**E-Commerce businesses:** Quickly upload new products and descriptions and then place them in folders organized by categories. For example, shoes, dresses, suits, and undergarments.

**Photographers:** You may take hundreds of photos per month and many media categories. Use folders to organize your photographs into media library folders by type, such as people, animals, nature, environment, real estate, weddings, and so on.

**Publishers:** You have a lot of content to manage, edit, and publish. Wouldn’t it be nice to have a way to organize it all? With Folders, organize every piece of content and media used in each piece into neat posts folders, pages folders, and media categories based on the media type, date, topic, and so on.

**Digital Agencies:** You’re creating all sorts of content for your clients daily – ads, blog posts, social media content, videos, media categories, and all kind of WordPress media library files. Organize it all by file type, topic, campaign, or other categories using the Folders plugin.

#### 🔒 GDPR AND PRIVACY

Folders plugin is GDPR compliant, all data is saved locally on your server.

Folders is compatible with Gutenberg, Elementor website builder, Divi, Visual Composer, WPbakery, Beaver Builder, and any WordPress theme.

Download this plugin today for free and get unlimited folders to organize your WP content. Then unlock unlimited folders with the Pro Plan for max organization!

#### 🤗 Testimonials

> “Wow, great tool to optimize WordPress productivity
>
> This is such a great tool and fixes something that WordPress lacks in its media library options. I’m going to start adding this to all client WordPress sites moving forward for ease of use and added organization. Thanks for your work!”
>
> **Justin Parsons, See Justin Code**
>
> Order your chaos!
>
> We have thousands of images in our library and tons of products in our online store. So I needed something to get some order in this chaos: enter Folders. The free version gives you a good start. It is immediately clear how you can get about organizing your stuff. I got the upgrade almost immediately, I liked it so much. You can organize your images, pages, products, and lots more. No more endless lists. Highly recommended.”
>
> **Jan-Wouter Stigter, Malta Furniture Ltd**

## Screenshots

* [![](https://ps.w.org/folders/assets/screenshot-1.gif?rev=2893439)](https://ps.w.org/folders/assets/screenshot-1.gif?rev=2893439)

  Check out the Folders plugin in action with the media library
* [![](https://ps.w.org/folders/assets/screenshot-2.gif?rev=2893439)](https://ps.w.org/folders/assets/screenshot-2.gif?rev=2893439)

  Organize posts, pages, and custom posts with ease
* [![](https://ps.w.org/folders/assets/screenshot-3.png?rev=2893439)](https://ps.w.org/folders/assets/screenshot-3.png?rev=2893439)

  Organize WordPress media library folders
* [![](https://ps.w.org/folders/assets/screenshot-4.png?rev=2893439)](https://ps.w.org/folders/assets/screenshot-4.png?rev=2893439)

  Organize WordPress pages folders
* [![](https://ps.w.org/folders/assets/screenshot-5.png?rev=2893439)](https://ps.w.org/folders/assets/screenshot-5.png?rev=2893439)

  Organize WordPress posts folders
* [![](https://ps.w.org/folders/assets/screenshot-6.png?rev=2893439)](https://ps.w.org/folders/assets/screenshot-6.png?rev=2893439)

  Advanced Folders settings like download folder as zip, duplicate folder, add a star, sticky folders, and more

## Installation

Step 1: Download, install and activate the Folders plugin

Step 2: In the “Folder Settings” menu, select if you want Folders to appear in your media library, pages, posts, or any custom post

Step 3: Create new folders and drag & drop elements into your new folders

## FAQ

### Is there a folder limit?

No. you can create as many folders as you wish!

### Is there a time limit for the free plan?

No. you can use the free plan as long as you want.

### Can I import folders form other plugins?

Yes you can! Currently, we support FileBird, Enhanced Media Library, Wicked Folders, Real Media Library, WP Media Folder, HappyFiles (Happy Files) and Mediamatic

### Does Folders change the URL of my images/posts/pages?

No. adding a page/post/image into a folder will not change its URL

### Can I replace media library files with Folders plugin?

Yes, you can! Whenever you change media library files, the change will reflect on all of your pages, posts, and more

### Do I need any coding skills to use Folders plugin?

No! just activate the plugin and you’re good to go.

### Can I use Folders plugin on more than 1 domain?

There 2 ways to do it:

1. You can install the free Folders plugin on any website you want

2. You can buy the Pro plan that includes licenses for 5 domains, or the Agency plan that includes licenses for 50 domains (bigger plans are also availabe).

Check out our [plans page](https://premio.io/downloads/folders/ "Folders plans page").

### How long is my paid Folders plugin license valid for?

Once you purchase any [paid plan](https://premio.io/downloads/folders/ "Folders plans page") of Folders, you can use it forever. Product updates and support are available for depending on if you purchased the plan for 1 year, 2 years or the lifetime updates and support plan.

### Will Folders stop working if I don’t renew my license?

Of course NOT! 🙂

Your Folders plugin and all your settings will continue to work as before; however, you will no longer receive plugin updates including feature additions, improvements, and support.

### How do I activate my pro plan?

Just follow our [pro installation guide](https://premio.io/wordpress-premio-pro-version-installation-guide/ "WordPress installation guide").

### Is there a live demo for Folders

A live demo for the Folders plugin is available at [Premio’s demo site](https://demo.premio.io/folders/?utm_source=wordpressorg "Premio.io demo site").

## Reviews

![](https://secure.gravatar.com/avatar/b2f9ab0786c48072054a1fbf5e697ab25297b4ce2db3084aa2a35ab429618bc9?s=60&d=retro&r=g)
### [Absolutely recommended.](https://wordpress.org/support/topic/absolutely-recommended-9/)

[more-than-webdesign.com](https://profiles.wordpress.org/morethanwebdesign/ "Posts by more-than-webdesign.com")
January 6, 2025

My favorite plugin to organize media and more into folders, also for several websites of my clients. While most important essential options are free (which ist great and different from several other plugins), PRO is still a good option to get all your assets organized even better.Support once needed the team was very friendly and fast and engaged and successfully in solving the issue (not caused by them). Lightweight and easy to handle. Also no problems at deactivation or migrations found.Absolutely recommended.

![](https://secure.gravatar.com/avatar/a9e5707f4a5e21f970dde15679be8aff421e7cda327964ced9b8ce915eb9ec3c?s=60&d=retro&r=g)
### [There’s no option available to set default sort](https://wordpress.org/support/topic/theres-no-option-available-to-set-default-sort/)

[a,stanley](https://profiles.wordpress.org/andrewstanley/ "Posts by a,stanley")
January 6, 2025
3 replies

If you plan on having A LOT OF FOLDERS to accommodate A LOT of photos and A LOT of variants for your products…. I would not recommend this plugin. The default sort is by “creation date.” AND YOU CANNOT set the default sort to anything else. I contacted support and they said there is no option to set the default sort to anything else in this time. They can write the code to sort lists… and they give you the option to set how those lists are sorted…. but they can’t give you a way to set the default sort?!?!? I’m EXTREMELY disappointed to find out a PAID PLUGIN can’t give you this very basic option. I can’t believe it.

![](https://secure.gravatar.com/avatar/e0c47d4997f06ebc3b8aa85b7848951ca22c9f9f504b95936c335cdc1e571869?s=60&d=retro&r=g)
### [Really useful app, and great support.](https://wordpress.org/support/topic/very-useful-piece-of-work/)

[mbrayne](https://profiles.wordpress.org/mbrayne/ "Posts by mbrayne")
January 3, 2025

I really like Folders, and have now been using it for many years. Excellent service support as well as an easy-to-use, friendly and good-looking interface. Bit shocked to start with by the default pink, but have come to quite like it, and am not shifting to a less in-your-face colour. Thanks to the team.

![](https://secure.gravatar.com/avatar/0847f54d184a8e898d269f0867e3d6944842f6c2772c7b0d17423bf6a5a7d0d9?s=60&d=retro&r=g)
### [Great plugin](https://wordpress.org/support/topic/great-plugin-39916/)

[gladsaxejazzklub](https://profiles.wordpress.org/gladsaxejazzklub/ "Posts by gladsaxejazzklub")
December 12, 2024

Fast and very easy to use. Helps very much organizing

![](https://secure.gravatar.com/avatar/60447b04d7ff0ff45bc99b2cde359ed55564784c8d0fcfa0f70602a0af1a90c5?s=60&d=retro&r=g)
### [a must have plugin](https://wordpress.org/support/topic/a-must-have-plugin-406/)

[ersi1024559](https://profiles.wordpress.org/ersi1024559/ "Posts by ersi1024559")
December 10, 2024

Very useful and easy to use plugin, thank you!

![](https://secure.gravatar.com/avatar/a02bb239b012b7de0eb99f2c820a6c4ebe627ccd7c0e2ba726735d3e9a4f5ebc?s=60&d=retro&r=g)
### [Happy with it !](https://wordpress.org/support/topic/happy-with-it-37/)

[mcdem](https://profiles.wordpress.org/mcdem/ "Posts by mcdem")
December 8, 2024

Works well.

[Read all 1,391 reviews](https://wordpress.org/support/plugin/folders/reviews/)
## Contributors & Developers

“Folders – Unlimited Folders to Organize Media Library Folder, Pages, Posts, File Manager” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/d4f5b36f5e5fd795e84906d19d682cbae0db8ee85e4822846f6ba17cd4f50bb9?s=32&d=mm&r=g) [Gal Dubinski](https://profiles.wordpress.org/galdub/)
* ![](https://secure.gravatar.com/avatar/367d406ab14724a27e588deab780e3bd10d845458dc6cd9a0239befef7e0baeb?s=32&d=mm&r=g) [Tomer Aharon](https://profiles.wordpress.org/tomeraharon/)
* ![](https://secure.gravatar.com/avatar/76f09e2f2979ca500343e5d0dcf6d625e35ea5856d4256868edbcdaa97171e46?s=32&d=mm&r=g) [Premio](https://profiles.wordpress.org/premio/)

“Folders – Unlimited Folders to Organize Media Library Folder, Pages, Posts, File Manager” has been translated into 8 locales. Thank you to [the translators](https://translate.wordpress.org/projects/wp-plugins/folders/contributors) for their contributions.

[Translate “Folders – Unlimited Folders to Organize Media Library Folder, Pages, Posts, File Manager” into your language.](https://translate.wordpress.org/projects/wp-plugins/folders)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/folders/), check out the [SVN repository](https://plugins.svn.wordpress.org/folders/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/folders/) by [RSS](https://plugins.trac.wordpress.org/log/folders/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

#### 3.0.6

Folders loading bug fixed

#### 3.0.5

Notifications – Stay informed with notifications whenever an action occurs on Folders — whether a new file is uploaded by a team member, a post is deleted, or any other change is made (Pro)

SVG file type support (Pro)

Export Folders structure

Dynamic folders based on file size

Option to change the file size limit (Pro feature)

Smush plugin bug fixed

Media library drag and drop to folders bug fixed

Divi bug fixed

#### 3.0.4

SVG validation bug fixed

#### 3.0.3

Brisk editor conflict fixed

Media Library categories bug fixed

#### 3.0.2

File upload bugs fixed (author and above roles access issues)

Duplicated trash warning messages and the layout looks cut off bug fixed

When uploading files to a selected folder while creating a new folder and uploading to this new folder at the same time, the files intended for the first folder are uploaded in the new folder bug fixed

Issue with the Replace Media feature when using Safe SVG fixed

Default media folder is not working when editing via Elementor bug fixed

Divi page builder bug fixed

Issue with WooCommerce quick edit functionality fixed

The order of the media is reversed when uploaded to folders bug fixed

Move to Folder dropdown option for Bulk actions – plugin section bug fixed

#### 3.0.1

WordPress 6.5 compatibility

#### 3.0

Folders icon colors – you can change the color of your folder icons. You can change it for specific folders, or all folders. You can use it to mark folders that require special attention, etc.

Improved folders drag and drop functionality

Added WordPress Multisite support

Added support for LMS “All courses categories” (Pro feature)

Fixed Polylang bug

Speed and infrastructure improvements were implemented

CatFolders import was added

File upload to folder bug fixed

#### 2.9.8

Thrive Themes bug fixed

#### 2.9.7

Changed shortcut for creating a new folder (Gutenberg conflict resolved)

#### 2.9.6

Folders default color set bug fixed

#### 2.9.5

Bug fixed

#### 2.9.4

Infrastructure improvements – Folders works faster now 🚀

Added Folders support for Plugins in the Pro version

WooCommerce product support for Dynamic Folders

Added support for LMS LearnPress plugin in the Pro version

Bugs fixed

#### 2.9.3

Security fix

#### 2.9.2

MailPoet bug fixed

#### 2.9.1

Media library files url bug fixed

Notification background bug fixed

#### 2.9

Folders user access management – advanced folders access management for your team with roles that restrict their access to view and edit your website’s folders (Pro feature)

New folders will be added to the top of the folders list

We’ve improved folders compatibility with the WPML plugin and MailPoet

Fixed a notice for PHP 8.0

BuddyBoss items count bug fixed

WebP Express bug fixed

Media replace works fine with SVG and WebP files now

#### 2.8.9

Flow changes

#### 2.8.8

Minor bug fixed

#### 2.8.7

WordPress 6.1 Folders compatibility adjustments

#### 2.8.6

* We’ve added a horizontal scroll to the folders view
* Importing folders works better and faster now, the same goes for uploading folders and media library scan for used files (Pro)
* Published/Drafts view works for specific folders too
* Fixed some bugs

#### 2.8.5

WPML Folders bug fixed

#### 2.8.4

Infrastructure improvements

#### 2.8.3

Texts changed

#### 2.8.2

Keyboard shortcuts bugs fixed.

#### 2.8.1

Bugs fixed

#### 2.8

We’ve keyboard shortcuts and added the option to clean unused media library files in the Pro version. We’ve also fixed some bugs 🙂

#### 2.7.5

Bugs fixed

#### 2.7.4

Divi bug fixed

#### 2.7.3

Performance improvements

#### 2.7.2

Replace media bugs fixed

#### 2.7.1

WordPress 5.8 compatibility

#### 2.7

UI & performance improvements. We’ve also fixed some bugs

#### 2.6.9

Undo your last action and fixed some bugs and plugin conflicts

#### 2.6.8

Unlimited folders are now available in the free version 🎉

We’ve also added an option to purge all plugin data on removal + fixed some bugs

#### 2.6.7

List view folders bulk actions bug fixed

#### 2.6.6

Bugs fixed

#### 2.6.5

Import folders from HappyFiles (Happy Files) and Mediamatic + fixed some bugs

#### 2.6.4

iPad bugs fixed

#### 2.6.3

Replace media feature, import option (FileBird, Enhanced Media Library, Wicked Folders, Real Media Library, and WP Media Folder), create multiple folders at once (comma separated), option to hide Folders settings from the main menu, bug fixed

#### 2.6.2

WordPress 5.6 compatibility + Visual composer overlapping bug fixed

#### 2.6.1

Various bugs fixed

#### 2.6

Gallery related bugs and items-counter issues were fixed

#### 2.5.9

We’ve significantly improved the drag and drop experience (and we’ve also fixed some bugs)

#### 2.5.8

Folders settings checkbox bug fix and some other minor bugs were fixed

#### 2.5.7

Quick edit and search folder fix

#### 2.5.6

CSS bug fixed

#### 2.5.5

Various bugs were fixed after our last major release

#### 2.5.4

Divi bug fixed

#### 2.5.3

New and better design! We’ve added a search field, the minimum size of the Folders area is much smaller now, we’ve added Folders to the add media view, added a duplicate option, and many other cool features and bug fixes.

#### 2.5.2

WP 5.5

#### 2.5.1

Sort your folders based on name and creation date. We’ve also added some usability improvements, fixed some WPML and Polylang issue, and fixed some bugs

#### 2.5

When you use a media library folder in pages and posts, your choice will be stored for next uses. We’ve also fixed some RTL UI issues. You can also remove the upper folders if you want. We’ve added an option to bulk move files in the media library in list mode (not using drag and drop).

#### 2.4.9

The Add new page of the media library is not connected to Folders

#### 2.4.8

Update issue fixed

#### 2.4.7

Pages folders and posts folders count fix

#### 2.4.6

Added support for non-public custom posts

#### 2.4.5

Width issue for posts, pages, and custom posts + onboarding for new users

#### 2.4.4

From now on when you clone/edit/publish pages, posts, and custom posts in a specific folder, you’ll stay in that folder

#### 2.4.3

Small bugs fixed including folder filtering bugs (trash, draft etc), WooCommerce products duplicate bug, quick edit in folders, Media Library Assistant compatibility, and more

#### 2.4.2

Added a progress bar when you upload files to the media library folders. You can now track how many files were uploaded in real-time. We’ve also fixed a default folders bug.

#### 2.4.1

PHP 7.3 fix

#### 2.4

Move elements (media library, posts, pages, custom posts) to folders by selecting the element and selecting the relevant folder from our dropdown. Also added some UI improvements 🙂

#### 2.3.9

Fixed long folders names bug

#### 2.3.8

Polylang media library fix

#### 2.3.7

Translation support change

#### 2.3.6

Added translation support

#### 2.3.5

Folder order when adding a media library file to posts/pages fix, and infrastructure improvements

#### 2.3.4

Thrive Themes Architect bug fixed

#### 2.3.3

You can bulk delete folders now. You can also create a new folder from the upload screen in the media library. We’ve also fixed some bugs like Polylang compatibility bug, folders order bug, default folder bug, and other minor bugs.

#### 2.3.2

You can customize the folders look and feel now: change colors, font, and size of folders. We’ve also added some features to improve the easy-of-use like Enter key to create a new folder and more.

#### 2.3.1

We’ve added an indication for succesful actions (like moving elements into a folder, changing folders names etc)

#### 2.3

Select a default folder for your media library, pages, posts, and custom posts. We’ve also added a knowledge base with all FAQs.

#### 2.2.9

Better media library to folders bulk drag and drop in list mode

#### 2.2.8

Folder organization dropdown bug

#### 2.2.7

Better folder drag and drop

#### 2.2.6

Bug fixes

#### 2.2.5

Folders is much faster and smoother now. We’ve also fixed a media library resolution bug for Mac+Safari

#### 2.2.4

Class variable folder fixes

#### 2.2.3

Javascript functionality conflict

#### 2.2.2

* Replaced sweetalert to avoid conflicts with other plugins

#### 2.2.1

* Folders settings type bug fixed

#### 2.2

* Fixed collapsed menu state bug

#### 2.1.9

* Screen resolution bug fixed

#### 2.1.8

* Upgrade fix

#### 2.1.7

* Better drag and drop, SportPress support

#### 2.1.6

* Now you can drag and drop single media library files without clicking on the “Organize” button. We’ve also fixed a WooCommerce products page bug, Safari issue and some other media library issues

#### 2.1.5

* You don’t need to hit the “Organize” button each time you drag media files now, once you click on it you get into “Organize mode” until you click on the “Cancel” button + when you upload new media files you can select the folder in advance + fixed the hidden div thanks @nubess

#### 2.1.4

* Move one media file/post/page/custom post to more than one folder + quick edit bug fix 🙂

#### 2.1.3

* You can now minimize the folders section if you need that extra space 🙂

#### 2.1.2

* Now you can see all the unassinged media folder files, pages, posts and custom posts

#### 2.1.1

* Some exciting updates including: select relevant folders when you add media, keep your media library toolbar sticky when you organize you media, we support custom posts now, security fixes, bug fixes and more!

#### 2.0.5

* Upgrade page change

#### 2.0.4

Fixed the collision with Enhanced Media Library plugin

#### 2.0.3

Fixed php warnings for php higher version than 5.4

#### 2.0.2

PHP 7.2 bug fix

#### 2.0.1

* Brand New UI, Drag and Drop option, organize within the pages, posts and media library

#### 1.3.7

* Fixed bugs

#### 1.3.6

* Fixed error notice on admin columns.

#### 1.3.5

* Added icon.
* Fixed minor bugs.
* Changed admin side content.

#### 1.3.4

* Fixed error notice on admin columns.
* Fixed item count.

#### 1.3.3

* Fixed error notice on columns.

#### 1.3.2

* Fixed issue with HTTPS not working with bulk editing media files.

#### 1.3.1

* Fixed issue with WordPress 4.4.

#### 1.3.0

* Added bulk media folder assignment. This should now work on WordPress installations that are within a sub-directory as well as those that are not.

#### 1.2.17

* Fixed undefined offset notices.

  (Thanks to Jon Chapman @ cedargroup.uk.com for bringing this to our attention)

#### 1.2.15

* Removed a var\_dump.

#### 1.2.14

* Fixed bug where folders filter was not working on pages.

#### 1.2.13

* Changed folder icon to better suit wordpress dashboard theme.

#### 1.2.12

* Fixed term count in media folders.

#### 1.2.11

* Added limited support for Bulk media editing. (Full support coming soon, some users may experience issues with the bulk editor for the time being).

#### 1.2.10

* Removed function init causing AJAX errors with wordpress. (To be fixed in a later version).

#### 1.2.9

* Reduced permissions to editor.

#### 1.2.7

* Fixed issue with post type names showing as underscores rather than spaces in folder names.

#### 1.2.6

* Fixed bug with filters breaking if no folders are setup.

#### 1.2.5

* Text based changes.

#### 1.2.4

* Fixed folders not displaying in columns for posts/custom post types.
* Fixed menus not displaying correctly for some users.

#### 1.2.3

* Minor changes to options page.

#### 1.2.2

* Added clean-up on un-install.

#### 1.2.1

* Fixed bug with Media folders not being editable.

#### 1.2.0

* Added support for media (attachments).

#### 1.1.0

* Added support for custom post types.

#### 1.0

* Folders Plugin Released.

## Meta

* Version **3.0.6**
* Last updated **2 days ago**
* Active installations **80,000+**
* WordPress version **3.0.0 or higher**
* Tested up to **6.7.1**
* Languages
  See all 9

  Close

  [English (US)](https://wordpress.org/plugins/folders/), [French (France)](https://fr.wordpress.org/plugins/folders/), [Japanese](https://ja.wordpress.org/plugins/folders/), [Polish](https://pl.wordpress.org/plugins/folders/), [Russian](https://ru.wordpress.org/plugins/folders/), [Spanish (Mexico)](https://es-mx.wordpress.org/plugins/folders/), [Spanish (Spain)](https://es.wordpress.org/plugins/folders/), [Spanish (Venezuela)](https://ve.wordpress.org/plugins/folders/), and [Swedish](https://sv.wordpress.org/plugins/folders/).

  [Translate into your language](https://translate.wordpress.org/projects/wp-plugins/folders)
* Tags [folder](https://wordpress.org/plugins/tags/folder/)[folders](https://wordpress.org/plugins/tags/folders/)[media library](https://wordpress.org/plugins/tags/media-library/)[replace media](https://wordpress.org/plugins/tags/replace-media/)
* [Advanced View](https://wordpress.org/plugins/folders/advanced/)

## Ratings

5 out of 5 stars.

* [1363 5-star reviews
  5 stars

  1363](https://wordpress.org/support/plugin/folders/reviews/?filter=5)
* [19 4-star reviews
  4 stars

  19](https://wordpress.org/support/plugin/folders/reviews/?filter=4)
* [3 3-star reviews
  3 stars

  3](https://wordpress.org/support/plugin/folders/reviews/?filter=3)
* [2 2-star reviews
  2 stars

  2](https://wordpress.org/support/plugin/folders/reviews/?filter=2)
* [4 1-star reviews
  1 star

  4](https://wordpress.org/support/plugin/folders/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/folders/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/folders/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/d4f5b36f5e5fd795e84906d19d682cbae0db8ee85e4822846f6ba17cd4f50bb9?s=32&d=mm&r=g) [Gal Dubinski](https://profiles.wordpress.org/galdub/)
* ![](https://secure.gravatar.com/avatar/367d406ab14724a27e588deab780e3bd10d845458dc6cd9a0239befef7e0baeb?s=32&d=mm&r=g) [Tomer Aharon](https://profiles.wordpress.org/tomeraharon/)
* ![](https://secure.gravatar.com/avatar/76f09e2f2979ca500343e5d0dcf6d625e35ea5856d4256868edbcdaa97171e46?s=32&d=mm&r=g) [Premio](https://profiles.wordpress.org/premio/)
## Support

Issues resolved in last two months:

3 out of 3

[View support forum](https://wordpress.org/support/plugin/folders/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_89310b91_20250111_043338.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Ffolders%2Ftags%2F3.0.3%2Fincludes%2Fmedia.replace.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/folders/tags/3.0.3/includes/media.replace.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/folders/tags/3.0.3/includes/media.replace.php)

---

# [source:](/browser?order=name "Go to repository root") [folders](/browser/folders?order=name "View folders")/[tags](/browser/folders/tags?order=name "View tags")/[3.0.3](/browser/folders/tags/3.0.3?order=name "View 3.0.3")/[includes](/browser/folders/tags/3.0.3/includes?order=name "View includes")/[media.replace.php](/browser/folders/tags/3.0.3/includes/media.replace.php?order=name "View media.replace.php")

View diff against:

View revision:

| [Last change](/changeset/3082245/folders/tags/3.0.3/includes/media.replace.php "View differences") on this file was [3082245](/changeset/3082245/ "View changeset 3082245"), checked in by premiocommit, [8 months ago](/timeline?from=2024-05-07T06%3A22%3A44Z&precision=second "See timeline at 05/07/2024 06:22:44 AM") |
| --- |
| Update to version 3.0.3 from GitHub |
| **File size:** 68.6 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Class Folders Replace Media |
| [4](#L4) | \* |
| [5](#L5) | \* @author  : Premio <contact@premio.io> |
| [6](#L6) | \* @license : GPL2 |
| [7](#L7) | \* \*/ |
| [8](#L8) |  |
| [9](#L9) | if (! defined('ABSPATH')) { |
| [10](#L10) | exit; |
| [11](#L11) | } |
| [12](#L12) |  |
| [13](#L13) | class folders\_replace\_media { |
| [14](#L14) |  |
| [15](#L15) | /\*\* |
| [16](#L16) | \* Button Color |
| [17](#L17) | \* |
| [18](#L18) | \* @var    string    $buttonColor    Replacement Button Color |
| [19](#L19) | \* @since  1.0.0 |
| [20](#L20) | \* @access public |
| [21](#L21) | \*/ |
| [22](#L22) | public $buttonColor; |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* Is Replacement functionality enabled or not |
| [26](#L26) | \* |
| [27](#L27) | \* @var    string    $isEnabled    Replacement Functionality Status |
| [28](#L28) | \* @since  1.0.0 |
| [29](#L29) | \* @access public |
| [30](#L30) | \*/ |
| [31](#L31) | public $isEnabled = false; |
| [32](#L32) |  |
| [33](#L33) | /\*\* |
| [34](#L34) | \* Folders Upgrade Link |
| [35](#L35) | \* |
| [36](#L36) | \* @var    string    $upgradeLink    Upgrade Link |
| [37](#L37) | \* @since  1.0.0 |
| [38](#L38) | \* @access public |
| [39](#L39) | \*/ |
| [40](#L40) | public $upgradeLink; |
| [41](#L41) |  |
| [42](#L42) | /\*\* |
| [43](#L43) | \* Mode for file Replacement |
| [44](#L44) | \* |
| [45](#L45) | \* @var    string    $mode    New File URL |
| [46](#L46) | \* @since  1.0.0 |
| [47](#L47) | \* @access public |
| [48](#L48) | \*/ |
| [49](#L49) | public $mode = "rename-file"; |
| [50](#L50) |  |
| [51](#L51) | /\*\* |
| [52](#L52) | \* file title for Replacement |
| [53](#L53) | \* |
| [54](#L54) | \* @var    string    $replace\_media\_title    New File Title |
| [55](#L55) | \* @since  1.0.0 |
| [56](#L56) | \* @access public |
| [57](#L57) | \*/ |
| [58](#L58) | public $replace\_media\_title = ""; |
| [59](#L59) |  |
| [60](#L60) | /\*\* |
| [61](#L61) | \* Attachment ID for Replacement file |
| [62](#L62) | \* |
| [63](#L63) | \* @var    string    $attachment\_id    Attachment ID |
| [64](#L64) | \* @since  1.0.0 |
| [65](#L65) | \* @access public |
| [66](#L66) | \*/ |
| [67](#L67) | public $attachment\_id; |
| [68](#L68) |  |
| [69](#L69) | /\*\* |
| [70](#L70) | \* Old File Path |
| [71](#L71) | \* |
| [72](#L72) | \* @var    array    $old\_file\_path    Old File Path |
| [73](#L73) | \* @since  1.0.0 |
| [74](#L74) | \* @access public |
| [75](#L75) | \*/ |
| [76](#L76) | public $old\_file\_path; |
| [77](#L77) |  |
| [78](#L78) | /\*\* |
| [79](#L79) | \* Old File URL |
| [80](#L80) | \* |
| [81](#L81) | \* @var    array    $old\_file\_url    Old File URL |
| [82](#L82) | \* @since  1.0.0 |
| [83](#L83) | \* @access public |
| [84](#L84) | \*/ |
| [85](#L85) | public $old\_file\_url; |
| [86](#L86) |  |
| [87](#L87) | /\*\* |
| [88](#L88) | \* New file path |
| [89](#L89) | \* |
| [90](#L90) | \* @var    array    $new\_file\_path    New file path |
| [91](#L91) | \* @since  1.0.0 |
| [92](#L92) | \* @access public |
| [93](#L93) | \*/ |
| [94](#L94) | public $new\_file\_path; |
| [95](#L95) |  |
| [96](#L96) | /\*\* |
| [97](#L97) | \* New file URL |
| [98](#L98) | \* |
| [99](#L99) | \* @var    array    $new\_file\_url    New file URL |
| [100](#L100) | \* @since  1.0.0 |
| [101](#L101) | \* @access public |
| [102](#L102) | \*/ |
| [103](#L103) | public $new\_file\_url; |
| [104](#L104) |  |
| [105](#L105) | /\*\* |
| [106](#L106) | \* Old Image Meta |
| [107](#L107) | \* |
| [108](#L108) | \* @var    array    $old\_image\_meta    Old Image Meta |
| [109](#L109) | \* @since  1.0.0 |
| [110](#L110) | \* @access public |
| [111](#L111) | \*/ |
| [112](#L112) | public $old\_image\_meta; |
| [113](#L113) |  |
| [114](#L114) | /\*\* |
| [115](#L115) | \* New Image Meta |
| [116](#L116) | \* |
| [117](#L117) | \* @var    array    $new\_image\_meta    New Image Meta |
| [118](#L118) | \* @since  1.0.0 |
| [119](#L119) | \* @access public |
| [120](#L120) | \*/ |
| [121](#L121) | public $new\_image\_meta; |
| [122](#L122) |  |
| [123](#L123) | /\*\* |
| [124](#L124) | \* Upload dir path |
| [125](#L125) | \* |
| [126](#L126) | \* @var    array    $upload\_dir    Upload dir path |
| [127](#L127) | \* @since  1.0.0 |
| [128](#L128) | \* @access public |
| [129](#L129) | \*/ |
| [130](#L130) | public $upload\_dir; |
| [131](#L131) |  |
| [132](#L132) | /\*\* |
| [133](#L133) | \* Old file image status |
| [134](#L134) | \* |
| [135](#L135) | \* @var    array    $is\_old\_image    Old file image status |
| [136](#L136) | \* @since  1.0.0 |
| [137](#L137) | \* @access public |
| [138](#L138) | \*/ |
| [139](#L139) | public $is\_old\_image = 0; |
| [140](#L140) |  |
| [141](#L141) | /\*\* |
| [142](#L142) | \* New file image status |
| [143](#L143) | \* |
| [144](#L144) | \* @var    array    $is\_new\_image    New file image status |
| [145](#L145) | \* @since  1.0.0 |
| [146](#L146) | \* @access public |
| [147](#L147) | \*/ |
| [148](#L148) | public $is\_new\_image = 0; |
| [149](#L149) |  |
| [150](#L150) |  |
| [151](#L151) | /\*\* |
| [152](#L152) | \* Define the core functionality of the replacement functionality. |
| [153](#L153) | \* |
| [154](#L154) | \* Set Button Color |
| [155](#L155) | \* Check for Functionality is enabled or not |
| [156](#L156) | \* Show Replacement form, Success message |
| [157](#L157) | \* |
| [158](#L158) | \* @since 1.0.0 |
| [159](#L159) | \*/ |
| [160](#L160) | function \_\_construct() { |
| [161](#L161) |  |
| [162](#L162) | add\_action("init", array($this,"init")); |
| [163](#L163) |  |
| [164](#L164) | $customize\_folders = get\_option('customize\_folders'); |
| [165](#L165) |  |
| [166](#L166) | $this->buttonColor = isset($customize\_folders['media\_replace\_button'])?$customize\_folders['media\_replace\_button']:"#FA166B"; |
| [167](#L167) |  |
| [168](#L168) | $this->isEnabled = isset($customize\_folders['folders\_enable\_replace\_media'])?$customize\_folders['folders\_enable\_replace\_media']:"yes"; |
| [169](#L169) |  |
| [170](#L170) | $this->replace\_media\_title = isset($customize\_folders['replace\_media\_title'])?$customize\_folders['replace\_media\_title']:"off"; |
| [171](#L171) |  |
| [172](#L172) | $this->isEnabled = ($this->isEnabled == "yes")?true:false; |
| [173](#L173) |  |
| [174](#L174) | if (isset($customize\_folders['show\_folder\_in\_settings']) && $customize\_folders['show\_folder\_in\_settings'] == "yes") { |
| [175](#L175) | $this->upgradeLink = admin\_url("options-general.php?page=wcp\_folders\_settings&setting\_page=upgrade-to-pro"); |
| [176](#L176) | } else { |
| [177](#L177) | $this->upgradeLink = admin\_url("admin.php?page=folders-upgrade-to-pro"); |
| [178](#L178) | } |
| [179](#L179) |  |
| [180](#L180) | if($this->isEnabled) { |
| [181](#L181) |  |
| [182](#L182) | add\_action('admin\_menu', array($this, 'admin\_menu')); |
| [183](#L183) |  |
| [184](#L184) | add\_filter('media\_row\_actions', array($this, 'add\_media\_action'), 10, 2); |
| [185](#L185) |  |
| [186](#L186) | add\_action('add\_meta\_boxes', function () { |
| [187](#L187) | add\_meta\_box('folders-replace-box', esc\_html\_\_('Replace Media', 'folders'), array($this, 'replace\_meta\_box'), 'attachment', 'side', 'low'); |
| [188](#L188) | }); |
| [189](#L189) | add\_filter('attachment\_fields\_to\_edit', array($this, 'attachment\_editor'), 10, 2); |
| [190](#L190) |  |
| [191](#L191) | add\_action('admin\_enqueue\_scripts', array($this, 'folders\_admin\_css\_and\_js')); |
| [192](#L192) |  |
| [193](#L193) | add\_action('admin\_init', array($this, 'handle\_folders\_file\_upload')); |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) | /\* to replace file name \*/ |
| [197](#L197) | add\_action('add\_meta\_boxes', function () { |
| [198](#L198) | add\_meta\_box('folders-replace-file-name', esc\_html\_\_('Change file name', 'folders'), array($this, 'change\_file\_name\_box'), 'attachment', 'side', 'core'); |
| [199](#L199) | }); |
| [200](#L200) |  |
| [201](#L201) | add\_action('edit\_attachment', array($this, 'change\_file\_name\_on\_update' )); |
| [202](#L202) |  |
| [203](#L203) | add\_filter('attachment\_fields\_to\_edit', array($this, 'attachment\_replace\_name\_with\_title'), 10, 2); |
| [204](#L204) |  |
| [205](#L205) | add\_action('admin\_head', array($this,  'premio\_replace\_file\_CSS')); |
| [206](#L206) |  |
| [207](#L207) | add\_action('wp\_enqueue\_media', array($this, 'replace\_media\_file\_script')); |
| [208](#L208) |  |
| [209](#L209) | add\_action('wp\_ajax\_premio\_folder\_replace\_name\_with\_title', array($this, 'replace\_name\_with\_title')); |
| [210](#L210) |  |
| [211](#L211) | add\_action('wp\_ajax\_premio\_folder\_update\_wp\_config', array($this, 'update\_wp\_config')); |
| [212](#L212) |  |
| [213](#L213) | add\_action('admin\_notices', array($this, 'admin\_premio\_notices')); |
| [214](#L214) |  |
| [215](#L215) | add\_filter('wp\_get\_attachment\_image\_src', array($this, 'update\_to\_new\_url'), 10, 4); |
| [216](#L216) |  |
| [217](#L217) | add\_filter('wp\_prepare\_attachment\_for\_js', array($this, 'prepare\_attachment\_for\_js'), 10, 3); |
| [218](#L218) |  |
| [219](#L219) | } |
| [220](#L220) |  |
| [221](#L221) | /\*\* |
| [222](#L222) | \* Add admin init |
| [223](#L223) | \* |
| [224](#L224) | \* @since  2.6.3 |
| [225](#L225) | \* @access public |
| [226](#L226) | \*/ |
| [227](#L227) | public function init() { |
| [228](#L228) | if(isset($\_GET['enable\_trash']) && !empty($\_GET['enable\_trash'])) { |
| [229](#L229) | $nonce = sanitize\_text\_field($\_GET['enable\_trash']); |
| [230](#L230) | if(wp\_verify\_nonce($nonce, "folders\_enable\_media\_trash")) { |
| [231](#L231) | $customize\_folders = get\_option('customize\_folders'); |
| [232](#L232) | $customize\_folders['enable\_media\_trash'] = "on"; |
| [233](#L233) | update\_option("customize\_folders", $customize\_folders); |
| [234](#L234) | wp\_redirect(admin\_url("upload.php?page=folders-media-cleaning")); |
| [235](#L235) | exit; |
| [236](#L236) | } |
| [237](#L237) | } |
| [238](#L238) | } |
| [239](#L239) |  |
| [240](#L240) | /\*\* |
| [241](#L241) | \* Update Cached file URL |
| [242](#L242) | \* |
| [243](#L243) | \* @since 2.8.4 |
| [244](#L244) | \* @access public |
| [245](#L245) | \* |
| [246](#L246) | \*/ |
| [247](#L247) | public function prepare\_attachment\_for\_js($response, $attachment, $meta) { |
| [248](#L248) | if ($response === false) { |
| [249](#L249) | return $response; |
| [250](#L250) | } |
| [251](#L251) |  |
| [252](#L252) | $refreshToken = get\_post\_meta($response['id'], "folders\_file\_replaced", true); |
| [253](#L253) | if($refreshToken !== false && !empty($refreshToken)) { |
| [254](#L254) | $response['url'] = add\_query\_arg('ver', $refreshToken, $response['url']); |
| [255](#L255) | if(isset($response['sizes']['medium']['url']) && !empty($response['sizes']['medium']['url'])) { |
| [256](#L256) | $response['sizes']['medium']['url'] = add\_query\_arg('ver', $refreshToken, $response['sizes']['medium']['url']); |
| [257](#L257) | } |
| [258](#L258) | } |
| [259](#L259) | return $response; |
| [260](#L260) | } |
| [261](#L261) |  |
| [262](#L262) | /\*\* |
| [263](#L263) | \* Update Cached file URL |
| [264](#L264) | \* |
| [265](#L265) | \* @since 2.8.4 |
| [266](#L266) | \* @access public |
| [267](#L267) | \* |
| [268](#L268) | \*/ |
| [269](#L269) | public function update\_to\_new\_url($image, $attachment\_id, $size, $icon) { |
| [270](#L270) | if ($image === false) |
| [271](#L271) | return $image; |
| [272](#L272) |  |
| [273](#L273) | $refreshToken = get\_post\_meta($attachment\_id, "folders\_file\_replaced", true); |
| [274](#L274) | if($refreshToken !== false && !empty($refreshToken)) { |
| [275](#L275) | $image[0] = add\_query\_arg('ver', $refreshToken, $image[0]); |
| [276](#L276) | } |
| [277](#L277) | return $image; |
| [278](#L278) | } |
| [279](#L279) |  |
| [280](#L280) | /\*\* |
| [281](#L281) | \* Show media details on hover |
| [282](#L282) | \* |
| [283](#L283) | \* @since 2.6.3 |
| [284](#L284) | \* @access public |
| [285](#L285) | \* |
| [286](#L286) | \*/ |
| [287](#L287) | public function admin\_premio\_notices() { |
| [288](#L288) | if(isset($\_REQUEST['premio\_message']) && $\_REQUEST['premio\_message'] == "success") { ?> |
| [289](#L289) | <div class="notice notice-success is-dismissible"> |
| [290](#L290) | <p><b><?php esc\_html\_e( 'File successfully replaced', 'folders' ); ?></b></p> |
| [291](#L291) | <p><?php esc\_html\_e( 'The file has been successfully replaced using the file replacement feature', 'folders' ); ?></p> |
| [292](#L292) | </div> |
| [293](#L293) |  |
| [294](#L294) | <style> |
| [295](#L295) | .folders-undo-notification { |
| [296](#L296) | position: fixed; |
| [297](#L297) | right: -500px; |
| [298](#L298) | bottom: 25px; |
| [299](#L299) | width: 280px; |
| [300](#L300) | background: #fff; |
| [301](#L301) | padding: 15px; |
| [302](#L302) | -webkit-box-shadow: 0 3px 6px -4px rgb(0 0 0 / 12%), 0 6px 16px 0 rgb(0 0 0 / 8%), 0 9px 28px 8px rgb(0 0 0 / 5%); |
| [303](#L303) | box-shadow: 0 3px 6px -4px rgb(0 0 0 / 12%), 0 6px 16px 0 rgb(0 0 0 / 8%), 0 9px 28px 8px rgb(0 0 0 / 5%); |
| [304](#L304) | transition: all .25s linear; |
| [305](#L305) | z-index: 250010; |
| [306](#L306) | } |
| [307](#L307) | .folders-undo-body { |
| [308](#L308) | position: relative; |
| [309](#L309) | font-size: 13px; |
| [310](#L310) | padding: 0 0 5px 0; |
| [311](#L311) | } |
| [312](#L312) | .close-undo-box { |
| [313](#L313) | position: absolute; |
| [314](#L314) | right: -10px; |
| [315](#L315) | top: 0; |
| [316](#L316) | width: 16px; |
| [317](#L317) | height: 16px; |
| [318](#L318) | transition: all .25s linear; |
| [319](#L319) | } |
| [320](#L320) | .close-undo-box span { |
| [321](#L321) | display: block; |
| [322](#L322) | position: relative; |
| [323](#L323) | width: 16px; |
| [324](#L324) | height: 16px; |
| [325](#L325) | transition: all .2s linear; |
| [326](#L326) | } |
| [327](#L327) | .close-undo-box span:after, .close-undo-box span:before { |
| [328](#L328) | content: ""; |
| [329](#L329) | position: absolute; |
| [330](#L330) | width: 12px; |
| [331](#L331) | height: 2px; |
| [332](#L332) | background-color: #333; |
| [333](#L333) | display: block; |
| [334](#L334) | border-radius: 2px; |
| [335](#L335) | transform: rotate(45deg); |
| [336](#L336) | top: 7px; |
| [337](#L337) | left: 2px; |
| [338](#L338) | } |
| [339](#L339) | .close-undo-box span:after { |
| [340](#L340) | transform: rotate(-45deg); |
| [341](#L341) | } |
| [342](#L342) | .folders-undo-header { |
| [343](#L343) | font-weight: 500; |
| [344](#L344) | font-size: 14px; |
| [345](#L345) | padding: 0 0 3px 0; |
| [346](#L346) | color: #014737; |
| [347](#L347) | } |
| [348](#L348) | .folders-undo-notification.success { |
| [349](#L349) | border-left: solid 3px #70C6A3; |
| [350](#L350) | } |
| [351](#L351) | html[dir="rtl"] .folders-undo-notification { |
| [352](#L352) | right: auto; |
| [353](#L353) | left: -500px |
| [354](#L354) | } |
| [355](#L355) | html[dir="rtl"] .folders-undo-notification.active { |
| [356](#L356) | left: 25px; |
| [357](#L357) | } |
| [358](#L358) | html[dir="rtl"] .folders-undo-notification.success { |
| [359](#L359) | border-left: none; |
| [360](#L360) | border-right: solid 3px #70C6A3; |
| [361](#L361) | } |
| [362](#L362) | html[dir="rtl"] .close-undo-box { |
| [363](#L363) | right: auto; |
| [364](#L364) | left: -10px; |
| [365](#L365) | } |
| [366](#L366) | </style> |
| [367](#L367) | <div class="folders-undo-notification success" id="media-success"> |
| [368](#L368) | <div class="folders-undo-body"> |
| [369](#L369) | <a href="javascript:;" class="close-undo-box"><span></span></a> |
| [370](#L370) | <div class="folders-undo-header"><?php esc\_html\_e( 'File successfully replaced', 'folders' ); ?></div> |
| [371](#L371) | <div class="folders-undo-body" style="padding:0"><?php esc\_html\_e( 'The file has been successfully replaced using the file replacement feature', 'folders' ); ?></div> |
| [372](#L372) | </div> |
| [373](#L373) | </div> |
| [374](#L374) | <script> |
| [375](#L375) | jQuery(document).ready(function(){ |
| [376](#L376) | jQuery("#media-success").addClass("active"); |
| [377](#L377) | setTimeout(function(){ |
| [378](#L378) | jQuery("#media-success").removeClass("active"); |
| [379](#L379) | }, 5000); |
| [380](#L380) |  |
| [381](#L381) | jQuery(document).on("click", ".close-undo-box", function(){ |
| [382](#L382) | jQuery("#media-success").removeClass("active"); |
| [383](#L383) | }); |
| [384](#L384) | }); |
| [385](#L385) | </script> |
| [386](#L386) | <?php } |
| [387](#L387) | } |
| [388](#L388) |  |
| [389](#L389) | /\*\* |
| [390](#L390) | \* Admin notice for to show WP\_TRASH functionality |
| [391](#L391) | \* |
| [392](#L392) | \* @since 2.6.3 |
| [393](#L393) | \* @access public |
| [394](#L394) | \* |
| [395](#L395) | \*/ |
| [396](#L396) | public function admin\_notices() { |
| [397](#L397) | $is\_defined = defined( 'MEDIA\_TRASH' ); |
| [398](#L398) | if ( !($is\_defined && MEDIA\_TRASH )) { |
| [399](#L399) | global $current\_screen; |
| [400](#L400) | if ((isset($current\_screen->base) && $current\_screen->base == "upload") || (isset($\_REQUEST['page']) && ($\_REQUEST['page'] == "wcp\_folders\_settings" || $\_REQUEST['page'] == "folders-media-cleaning"))) { ?> |
| [401](#L401) | <style> |
| [402](#L402) | .media-trash-notice{padding:0 !important;margin:15px 15px 0}.media-trash-notice-message{padding:15px 10px 0}.media-trash-notice a{text-decoration:none}.media-trash-notice-footer{text-align:right;padding:10px 15px;background:#f1f1f1;margin:15px 0 0 0}.spinner.trash-spinner{display:none}.spinner.trash-spinner.animate{display:inline-block;opacity:.7;visibility:visible;margin-right:0} |
| [403](#L403) | </style> |
| [404](#L404) | <div class="notice notice-info premio-notice media-trash-notice"> |
| [405](#L405) | <div class="media-trash-notice-message"> |
| [406](#L406) | To enable Trash functionality in Media, Add the following one line <code>define( 'MEDIA\_TRASH', true );</code> in <a href="https://wordpress.org/support/article/editing-wp-config-php/" rel="noopener noreferrer" target="\_blank">wp-config.php</a> file just before the line that says "That’s all, stop editing!" |
| [407](#L407) | </div> |
| [408](#L408) | <div class="media-trash-notice-footer"> |
| [409](#L409) | <a class="button button-primary" href="#">Automatically write this line<span class="spinner trash-spinner"></span></a> |
| [410](#L410) | </div> |
| [411](#L411) | </div> |
| [412](#L412) |  |
| [413](#L413) | <style> |
| [414](#L414) | .folder-popup-form{position:fixed;width:100%;height:100%;background:rgba(0,0,0,.5);top:0;left:0;z-index:10001;display:none}.popup-form-content{background:#fff;min-height:100px;width:400px;text-align:center;margin:0 auto;position:absolute;left:0;right:0;top:50%;transform:translate(0,-50%);-webkit-transform:translate(0,-50%);-moz-transform:translate(0,-50%);-o-transform:translate(0,-50%);-ms-transform:translate(0,-50%);padding:20px;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;color:#484848}.popup-form-data{position:relative}.close-popup-button{position:absolute;right:-10px;top:-10px;width:20px;height:20px}.close-popup-button a{display:block;position:relative;width:20px;height:20px;color:#333;padding:2px;box-sizing:border-box}.close-popup-button a span{display:block;position:relative;width:16px;height:16px;transition:all .2s linear}.close-popup-button a:hover span{transform:rotate(180deg)}.close-popup-button a span:after,.close-popup-button a span:before{content:"";position:absolute;width:12px;height:2px;background-color:#333;display:block;border-radius:2px;transform:rotate(45deg);top:7px;left:2px}.close-popup-button a span:after{transform:rotate(-45deg)}.add-update-folder-title{display:block;position:relative;max-width:100%;margin:0;padding:0 0 15px 0;color:#595959;text-align:center;text-transform:none;word-wrap:break-word;font-weight:700;font-size:22px;line-height:26px}.add-update-folder-title:after{content:"";position:absolute;top:100%;width:70px;height:2px;background:#3085d6;left:0;right:0;margin:0 auto}.folder-form-buttons{display:flex}.folder-form-buttons a:not(.inline-button),.folder-form-buttons button{display:inline-flex;padding:0;text-decoration:none;margin:10px 3px;border-radius:4px;border:solid 1px #1da1f4;line-height:34px;font-weight:700;font-size:14px;box-sizing:border-box;height:36px;cursor:pointer;flex:1;justify-content:center}.form-cancel-btn,a.form-cancel-btn:hover{background-color:#fff;color:#3085d6;outline:0}.form-submit-btn{background-color:#3085d6;color:#fff;outline:0}.form-submit-btn.disabled{color:#a7aaad!important;background:#f6f7f7!important;border-color:#dcdcde!important;box-shadow:none!important;text-shadow:none!important;cursor:default}.folder-note{padding:20px 0;line-height:20px}#folder-trash-message .popup-form-content{width:460px}.folder-note a{text-decoration:none;display:inline-block} |
| [415](#L415) | </style> |
| [416](#L416) | <?php if(isset($\_REQUEST['mode']) && $\_REQUEST['mode'] == "list" && isset($\_REQUEST['attachment-filter']) && $\_REQUEST['attachment-filter'] == "trash") { ?> |
| [417](#L417) |  |
| [418](#L418) | <div class="folder-popup-form" id="folder-trash-message" style="display: block;"> |
| [419](#L419) | <div class="popup-form-content"> |
| [420](#L420) | <div class="popup-form-data"> |
| [421](#L421) | <div class="close-popup-button"> |
| [422](#L422) | <a class="" href="javascript:;"><span></span></a> |
| [423](#L423) | </div> |
| [424](#L424) | <form action="" method="post" id="save-folder-form"> |
| [425](#L425) | <div class="add-update-folder-title">Rewrite wp-config.php to enable Trash</div> |
| [426](#L426) | <div class="folder-note"> |
| [427](#L427) | To enable Trash functionality in Media, Add the following one line <code>define( 'MEDIA\_TRASH', true );</code> in <a href="https://wordpress.org/support/article/editing-wp-config-php/" rel="noopener noreferrer" target="\_blank">wp-config.php</a> file just before the line that says "That’s all, stop editing!" |
| [428](#L428) | </div> |
| [429](#L429) | <div class="folder-form-buttons"> |
| [430](#L430) | <a href="javascript:;" class="form-cancel-btn">I'll do it manually</a> |
| [431](#L431) | <button type="submit" class="form-submit-btn write-in-config-file">Automatically write this line</button> |
| [432](#L432) | </div> |
| [433](#L433) | </form> |
| [434](#L434) | </div> |
| [435](#L435) | </div> |
| [436](#L436) | </div> |
| [437](#L437) | <div class="folder-popup-form" id="wp-config-update-notice" style="display: none;"> |
| [438](#L438) | <form action="" method="post" id="bulk-folder-form"> |
| [439](#L439) | <div class="popup-form-content"> |
| [440](#L440) | <div class="popup-form-data"> |
| [441](#L441) | <div class="close-popup-button"> |
| [442](#L442) | <a class="" href="javascript:;"><span></span></a> |
| [443](#L443) | </div> |
| [444](#L444) | <div class="add-update-folder-title"> |
| [445](#L445) | Something went wrong |
| [446](#L446) | </div> |
| [447](#L447) | <div class="folder-form-message" style="padding: 25px 10px;"> |
| [448](#L448) | We couldn’t write to the file automatically. Please add the line manually to your wp-config.php. You need to modify your wp-config.php file and just before the line that says "That’s all, stop editing!", add this line:<code>define( 'MEDIA\_TRASH', true );</code> |
| [449](#L449) | </div> |
| [450](#L450) | </div> |
| [451](#L451) | </div> |
| [452](#L452) | </form> |
| [453](#L453) | </div> |
| [454](#L454) | <?php } ?> |
| [455](#L455) |  |
| [456](#L456) | <script> |
| [457](#L457) | (function($) { |
| [458](#L458) | "use strict"; |
| [459](#L459) | $(document).ready(function(){ |
| [460](#L460) | $(document).on("click", ".media-trash-notice-footer a:not(.disabled), .write-in-config-file:not(.disabled)", function(e){ |
| [461](#L461) | $(this).addClass("disabled"); |
| [462](#L462) | $(".trash-spinner").addClass("animate"); |
| [463](#L463) | e.preventDefault(); |
| [464](#L464) | $.ajax({ |
| [465](#L465) | url: "<?php echo esc\_url(admin\_url("admin-ajax.php")) ?>", |
| [466](#L466) | data: { |
| [467](#L467) | action: "premio\_folder\_update\_wp\_config", |
| [468](#L468) | nonce: "<?php echo esc\_attr(wp\_create\_nonce("add\_media\_status\_in\_wp\_config")) ?>" |
| [469](#L469) | }, |
| [470](#L470) | type: 'post', |
| [471](#L471) | dataType: "json", |
| [472](#L472) | success: function(response) { |
| [473](#L473) | if(response.status == 1) { |
| [474](#L474) | setTimeout(function(){ |
| [475](#L475) | window.location.reload(); |
| [476](#L476) | }, 4000); |
| [477](#L477) | $("#folder-trash-message").remove(); |
| [478](#L478) | } else { |
| [479](#L479) | $(".trash-spinner").removeClass("animate"); |
| [480](#L480) | $(".media-trash-notice-footer a").removeClass("disabled"); |
| [481](#L481) | $("#wp-config-update-notice").show(); |
| [482](#L482) | $("#folder-trash-message").remove(); |
| [483](#L483) | } |
| [484](#L484) | } |
| [485](#L485) | }); |
| [486](#L486) | }); |
| [487](#L487) |  |
| [488](#L488) | $(document).on("click", "#folder-trash-message", function(){ |
| [489](#L489) | $("#folder-trash-message").hide(); |
| [490](#L490) | }); |
| [491](#L491) |  |
| [492](#L492) | $(document).on("click", "#folder-trash-message .popup-form-content", function(e){ |
| [493](#L493) | e.stopPropagation(); |
| [494](#L494) | }); |
| [495](#L495) |  |
| [496](#L496) | <?php if(isset($\_REQUEST['mode']) && $\_REQUEST['mode'] == "list" && isset($\_REQUEST['attachment-filter']) && $\_REQUEST['attachment-filter'] == "trash") { ?> |
| [497](#L497) | $(document).on("click", ".close-popup-button, .form-cancel-btn", function(e){ |
| [498](#L498) | e.preventDefault(); |
| [499](#L499) | $("#folder-trash-message").remove(); |
| [500](#L500) | $(".folder-popup-form").remove(); |
| [501](#L501) | }); |
| [502](#L502) | <?php } ?> |
| [503](#L503) | }); |
| [504](#L504) | })(jQuery); |
| [505](#L505) | </script> |
| [506](#L506) | <?php } |
| [507](#L507) | } |
| [508](#L508) |  |
| [509](#L509) | $isScanPage = (isset($\_REQUEST['page']) && $\_REQUEST['page'] == "folders-media-cleaning" && (isset($\_REQUEST['scan']) && $\_REQUEST['scan'] == 1))?true:false; |
| [510](#L510) | $isFilterPage = (isset($\_REQUEST['attachment-filter']) && $\_REQUEST['attachment-filter'] == "trash")?true:false; |
| [511](#L511) |  |
| [512](#L512) | if ($isScanPage || $isFilterPage) { ?> |
| [513](#L513) | <style> |
| [514](#L514) | .media-notice { |
| [515](#L515) | margin: 15px 15px 2px; |
| [516](#L516) | } |
| [517](#L517) | .media-folder-notice { |
| [518](#L518) | display: flex; |
| [519](#L519) | align-items: baseline; |
| [520](#L520) | } |
| [521](#L521) | .media-folder-notice-left { |
| [522](#L522) | flex: 0 0 35px; |
| [523](#L523) | color: #d63638; |
| [524](#L524) | } |
| [525](#L525) | .media-folder-notice-right { |
| [526](#L526) | flex: 1; |
| [527](#L527) | font-size: 14px; |
| [528](#L528) | } |
| [529](#L529) | .media-folder-notice-right p { |
| [530](#L530) | font-size: 14px; |
| [531](#L531) | } |
| [532](#L532) | .media-folder-notice span.dashicons.dashicons-info-outline { |
| [533](#L533) | padding: 4px; |
| [534](#L534) | background-color: #fff2f2; |
| [535](#L535) | border-radius: 50%; |
| [536](#L536) | } |
| [537](#L537) | .media-folder-notice b { |
| [538](#L538) | font-weight: 600; |
| [539](#L539) | } |
| [540](#L540) | </style> |
| [541](#L541) | <div class="notice notice-error media-notice"> |
| [542](#L542) | <div class="media-folder-notice"> |
| [543](#L543) | <div class="media-folder-notice-left"> |
| [544](#L544) | <span class="dashicons dashicons-info-outline"></span> |
| [545](#L545) | </div> |
| [546](#L546) | <div class="media-folder-notice-right"> |
| [547](#L547) | <p>Please <b>be very careful before deleting</b> any files. <b>Take back up</b>, and make sure you test the website <b>before permanently deleting</b>. Some actively used files can still show up as unused files when searching. You <b>are responsible</b> for any damage if you delete anything important. So, please be careful 🙏</p> |
| [548](#L548) | </div> |
| [549](#L549) | </div> |
| [550](#L550) | </div> |
| [551](#L551) | <?php } |
| [552](#L552) | } |
| [553](#L553) |  |
| [554](#L554) | /\*\* |
| [555](#L555) | \* Update config.php file to save WP\_TRASH functionality |
| [556](#L556) | \* |
| [557](#L557) | \* @since 2.6.3 |
| [558](#L558) | \* @access public |
| [559](#L559) | \* |
| [560](#L560) | \*/ |
| [561](#L561) | public function update\_wp\_config() { |
| [562](#L562) | $errorCounter = 0; |
| [563](#L563) | $response = []; |
| [564](#L564) | $response['status'] = 0; |
| [565](#L565) | $response['message'] = ""; |
| [566](#L566) | $response['valid'] = 0; |
| [567](#L567) | $postData = filter\_input\_array(INPUT\_POST); |
| [568](#L568) | if (!isset($postData['nonce']) || trim($postData['nonce']) == "") { |
| [569](#L569) | $errorCounter++; |
| [570](#L570) | $response['message'] = "Invalid request"; |
| [571](#L571) | } else { |
| [572](#L572) | $nonce = sanitize\_title($postData['nonce']); |
| [573](#L573) | if(!wp\_verify\_nonce($nonce, 'add\_media\_status\_in\_wp\_config')) { |
| [574](#L574) | $errorCounter++; |
| [575](#L575) | $response['message'] = "Invalid request"; |
| [576](#L576) | } |
| [577](#L577) | } |
| [578](#L578) | if($errorCounter == 0) { |
| [579](#L579) | $response['status'] = 1; |
| [580](#L580) |  |
| [581](#L581) | $is\_defined = defined( 'MEDIA\_TRASH' ); |
| [582](#L582) | if ( $is\_defined && MEDIA\_TRASH ) { |
| [583](#L583) | echo wp\_json\_encode($response); |
| [584](#L584) | die; |
| [585](#L585) | } |
| [586](#L586) |  |
| [587](#L587) | try { |
| [588](#L588) | $conf = ABSPATH . 'wp-config.php'; |
| [589](#L589) | $stream = fopen( $conf, 'r+' ); |
| [590](#L590) | if ( $stream === false )  { |
| [591](#L591) | $response['status'] = -1; |
| [592](#L592) | echo wp\_json\_encode($response); die; |
| [593](#L593) | } |
| [594](#L594) |  |
| [595](#L595) | try { |
| [596](#L596) | if ( !flock( $stream, LOCK\_EX ) ) { |
| [597](#L597) | $response['status'] = -1; |
| [598](#L598) | echo wp\_json\_encode($response); die; |
| [599](#L599) | } |
| [600](#L600) | $stat = fstat( $stream ); |
| [601](#L601) |  |
| [602](#L602) | /\* Find out the ideal position to write on \*/ |
| [603](#L603) | $found = false; |
| [604](#L604) | $patterns = array ( |
| [605](#L605) | array ( |
| [606](#L606) | 'regex' => '^\/\\*\s\*' . preg\_quote( "That's all, stop editing!" ) . '.\*?\s\*\\*\/', |
| [607](#L607) | 'where' => 'above' |
| [608](#L608) | ) |
| [609](#L609) | ); |
| [610](#L610) | $current = 0; |
| [611](#L611) | while ( !feof( $stream ) ) { |
| [612](#L612) | $line = fgets( $stream ); // Read line by line |
| [613](#L613) | if ( $line === false ) break; // No more lines |
| [614](#L614) | $prev = $current; // Previous position |
| [615](#L615) | $current = ftell( $stream ); // Current position |
| [616](#L616) | foreach ( $patterns as $item ) { |
| [617](#L617) | if ( !preg\_match( '/'.$item['regex'].'/', trim( $line ) ) ) { |
| [618](#L618) | continue; |
| [619](#L619) | } |
| [620](#L620) | $found = true; |
| [621](#L621) | if ( $item['where'] == 'above' ) { |
| [622](#L622) | fseek( $stream, $prev ); |
| [623](#L623) | $current = $prev; |
| [624](#L624) | } |
| [625](#L625) | break 2; |
| [626](#L626) | } |
| [627](#L627) | } |
| [628](#L628) |  |
| [629](#L629) | /\* Check if the position is found \*/ |
| [630](#L630) | if ( !$found ) { |
| [631](#L631) | $response['status'] = -1; |
| [632](#L632) | echo wp\_json\_encode($response); die; |
| [633](#L633) | } |
| [634](#L634) |  |
| [635](#L635) | /\* Write the constant definition line \*/ |
| [636](#L636) | $new = "define( 'MEDIA\_TRASH', true );" . PHP\_EOL; |
| [637](#L637) | $rest = fread( $stream, $stat['size'] - $current ); |
| [638](#L638) | fseek( $stream, $current ); |
| [639](#L639) | $written = fwrite( $stream, $new . $rest ); |
| [640](#L640) |  |
| [641](#L641) | /\* All done \*/ |
| [642](#L642) | if ( $written === false ) { |
| [643](#L643) | $response['status'] = -1; |
| [644](#L644) | echo wp\_json\_encode($response); die; |
| [645](#L645) | } |
| [646](#L646) | fclose( $stream ); |
| [647](#L647) | } |
| [648](#L648) | catch ( Exception $e ) { |
| [649](#L649) | fclose( $stream ); |
| [650](#L650) |  |
| [651](#L651) | $response['status'] = -1; |
| [652](#L652) | echo wp\_json\_encode($response); die; |
| [653](#L653) | } |
| [654](#L654) | } |
| [655](#L655) | catch ( Exception $e ) { |
| [656](#L656) | $response['status'] = -1; |
| [657](#L657) | echo wp\_json\_encode($response); die; |
| [658](#L658) | } |
| [659](#L659) |  |
| [660](#L660) | echo wp\_json\_encode($response); die; |
| [661](#L661) | } |
| [662](#L662) | echo wp\_json\_encode($response); die; |
| [663](#L663) | } |
| [664](#L664) |  |
| [665](#L665) | /\*\* |
| [666](#L666) | \* Replace file name with title |
| [667](#L667) | \* |
| [668](#L668) | \* @since 2.6.3 |
| [669](#L669) | \* @access public |
| [670](#L670) | \* |
| [671](#L671) | \*/ |
| [672](#L672) | public function replace\_name\_with\_title() { |
| [673](#L673) | $errorCounter = 0; |
| [674](#L674) | $response = []; |
| [675](#L675) | $response['status'] = 0; |
| [676](#L676) | $response['message'] = ""; |
| [677](#L677) | $response['valid'] = 0; |
| [678](#L678) | $postData = filter\_input\_array(INPUT\_POST); |
| [679](#L679) | if (!isset($postData['post\_id']) || trim($postData['post\_id']) == "") { |
| [680](#L680) | $errorCounter++; |
| [681](#L681) | $response['message'] = "Invalid request"; |
| [682](#L682) | } else if (!isset($postData['nonce']) || trim($postData['nonce']) == "") { |
| [683](#L683) | $errorCounter++; |
| [684](#L684) | $response['message'] = "Invalid request"; |
| [685](#L685) | } else if (!isset($postData['post\_title']) || trim($postData['post\_title']) == "") { |
| [686](#L686) | $errorCounter++; |
| [687](#L687) | $response['message'] = "Invalid request"; |
| [688](#L688) | } else { |
| [689](#L689) | $nonce = sanitize\_title($postData['nonce']); |
| [690](#L690) | if(!wp\_verify\_nonce($nonce, 'change\_attachment\_title\_'.$postData['post\_id'])) { |
| [691](#L691) | $errorCounter++; |
| [692](#L692) | $response['message'] = "Invalid request"; |
| [693](#L693) | } |
| [694](#L694) | } |
| [695](#L695) | if($errorCounter == 0) { |
| [696](#L696) | $response['status'] = 1; |
| [697](#L697) |  |
| [698](#L698) | $post\_id = $postData['post\_id']; |
| [699](#L699) |  |
| [700](#L700) | $post = get\_post($post\_id); |
| [701](#L701) |  |
| [702](#L702) | $post\_slug = sanitize\_file\_name(sanitize\_text\_field($\_POST['post\_title'])); |
| [703](#L703) |  |
| [704](#L704) | $attachment\_url = $post->guid; |
| [705](#L705) | $url = wp\_get\_attachment\_url($post\_id); |
| [706](#L706) | if(!empty($url)) { |
| [707](#L707) | $attachment\_url = $url; |
| [708](#L708) | } |
| [709](#L709) | $file\_parts = pathinfo($attachment\_url); |
| [710](#L710) |  |
| [711](#L711) | $db\_file\_name = $file\_parts['basename']; |
| [712](#L712) | $db\_file\_array = explode(".", $db\_file\_name); |
| [713](#L713) | $db\_file\_name\_ext = array\_pop($db\_file\_array); |
| [714](#L714) | $db\_file\_name = trim($db\_file\_name, $db\_file\_name\_ext); |
| [715](#L715) | $db\_file\_name = trim($db\_file\_name, "."); |
| [716](#L716) |  |
| [717](#L717) | if(strtolower($db\_file\_name) == strtolower($post\_slug)) { |
| [718](#L718) | $response['valid'] = 0; |
| [719](#L719) | $response['message'] = esc\_html\_\_("The title is same as the current filename", "folders"); |
| [720](#L720) | } else { |
| [721](#L721) | $response['valid'] = 1; |
| [722](#L722) | $response['message'] = esc\_html\_\_("File name has been updated", "folders"); |
| [723](#L723) | $this->change\_file\_name\_with\_title($post\_id); |
| [724](#L724) | } |
| [725](#L725) | } |
| [726](#L726) | echo wp\_json\_encode($response); |
| [727](#L727) | exit; |
| [728](#L728) | } |
| [729](#L729) |  |
| [730](#L730) | /\*\* |
| [731](#L731) | \* Add Js and CSS files for replace file name with title |
| [732](#L732) | \* |
| [733](#L733) | \* @since 2.6.3 |
| [734](#L734) | \* @access public |
| [735](#L735) | \* |
| [736](#L736) | \*/ |
| [737](#L737) | public function replace\_media\_file\_script() { |
| [738](#L738) | wp\_enqueue\_script('folders-media-replace-js', WCP\_FOLDER\_URL . 'assets/js/replace-file-name.js', array('jquery'), WCP\_FOLDER\_VERSION, true); |
| [739](#L739) | wp\_localize\_script('folders-media-replace-js', 'replace\_media\_options', array( |
| [740](#L740) | 'ajax\_url' => admin\_url("admin-ajax.php"), |
| [741](#L741) | )); |
| [742](#L742) | } |
| [743](#L743) |  |
| [744](#L744) | public function premio\_replace\_file\_CSS() { |
| [745](#L745) | echo '<style> |
| [746](#L746) | .compat-field-replace\_file\_name th.label {display: none;} |
| [747](#L747) | .compat-field-replace\_file\_name td.field {width: 100%; border-top: solid 1px #c0c0c0; padding:10px 0 0 0;margin: 0;float: none;} |
| [748](#L748) | .compat-field-replace\_file\_name td.field label {width: 100%; display: block;padding:0 0 10px 0;} |
| [749](#L749) | .compat-field-replace\_file\_name td.field label input[type="checkbox"] {margin: 0 4px 0 2px;} |
| [750](#L750) | .compat-field-replace\_file\_name td.field button.update-name-with-title {display: none;} |
| [751](#L751) | .compat-field-replace\_file\_name td.field button.update-name-with-title.show {display: inline-block;} |
| [752](#L752) |  |
| [753](#L753) | .compat-field-folders th.label {width: 100%; text-align: left; padding: 0 0 10px 0; margin: 0; border-top: solid 1px #c0c0c0;float: none;} |
| [754](#L754) | .compat-field-folders th.label .alignleft {float: none; text-align: left; font-weight: bold;} |
| [755](#L755) | .compat-field-folders th.label br {display: none;} |
| [756](#L756) | .compat-field-folders td.field {width: 100%; padding: 0; margin: 0;float: none;} |
| [757](#L757) | .folders-undo-notification{position:fixed;right:-500px;bottom:25px;width:280px;background:#fff;padding:15px;-webkit-box-shadow:0 3px 6px -4px rgb(0 0 0 / 12%),0 6px 16px 0 rgb(0 0 0 / 8%),0 9px 28px 8px rgb(0 0 0 / 5%);box-shadow:0 3px 6px -4px rgb(0 0 0 / 12%),0 6px 16px 0 rgb(0 0 0 / 8%),0 9px 28px 8px rgb(0 0 0 / 5%);transition:all .25s linear;z-index:250010}.folders-undo-notification.active{right:25px}.folders-undo-header{font-weight:500;font-size:14px;padding:0 0 3px 0}.folders-undo-body{font-size:13px;padding:0 0 5px 0}.folders-undo-footer{text-align:right;padding:5px 0 0 0}.folders-undo-footer .undo-button{background:#1da1f4;border:none;color:#fff;padding:3px 10px;font-size:12px;border-radius:2px;cursor:pointer}.folders-undo-body{position:relative}.close-undo-box{position:absolute;right:-10px;top:0;width:16px;height:16px;transition:all .25s linear}.close-undo-box:hover{transform:rotate(180deg)}.close-undo-box span{display:block;position:relative;width:16px;height:16px;transition:all .2s linear}.close-undo-box span:after,.close-undo-box span:before{content:"";position:absolute;width:12px;height:2px;background-color:#333;display:block;border-radius:2px;transform:rotate(45deg);top:7px;left:2px}.close-undo-box span:after{transform:rotate(-45deg)} |
| [758](#L758) | .folders-undo-notification.no .folders-undo-header { color: #dd0000; } |
| [759](#L759) | .folders-undo-notification.yes .folders-undo-header { color: #014737; } |
| [760](#L760) | .update-name-with-title .spinner {display: none; visibility: visible; margin-right: 0;} |
| [761](#L761) | .update-name-with-title.in-progress .spinner {display: inline-block;} |
| [762](#L762) | </style>'; |
| [763](#L763) | } |
| [764](#L764) |  |
| [765](#L765) | public function change\_file\_name\_with\_title($post\_id = 0) { |
| [766](#L766) | if(empty($post\_id)) { |
| [767](#L767) | return; |
| [768](#L768) | } |
| [769](#L769) | $post = get\_post($post\_id); |
| [770](#L770) | if(empty($post)) { |
| [771](#L771) | return; |
| [772](#L772) | } |
| [773](#L773) | if($post->post\_type != "attachment") { |
| [774](#L774) | return; |
| [775](#L775) | } |
| [776](#L776) | $this->attachment\_id = $post->ID; |
| [777](#L777) |  |
| [778](#L778) | $attachment\_id = $post->ID; |
| [779](#L779) | $attachment = get\_post($attachment\_id); |
| [780](#L780) | $attachment\_meta = wp\_get\_attachment\_metadata($attachment\_id); |
| [781](#L781) | $this->old\_image\_meta = $attachment\_meta; |
| [782](#L782) | $get\_attached\_file = get\_attached\_file($attachment\_id); |
| [783](#L783) | $file\_name = basename($get\_attached\_file); |
| [784](#L784) |  |
| [785](#L785) | $file\_ext = explode(".", $file\_name); |
| [786](#L786) | $file\_ext = array\_pop($file\_ext); |
| [787](#L787) | $post\_slug = sanitize\_file\_name(sanitize\_text\_field($\_POST['post\_title'])); |
| [788](#L788) | $new\_file\_name = $post\_slug.".".$file\_ext; |
| [789](#L789) |  |
| [790](#L790) | $wp\_upload\_path = wp\_get\_upload\_dir(); |
| [791](#L791) |  |
| [792](#L792) | $base\_path = $wp\_upload\_path['basedir'].DIRECTORY\_SEPARATOR; |
| [793](#L793) | $baseurl = $wp\_upload\_path['baseurl']."/"; |
| [794](#L794) |  |
| [795](#L795) | $post\_upload = ""; |
| [796](#L796) |  |
| [797](#L797) | $wp\_attached\_file = get\_post\_meta($attachment\_id, "\_wp\_attached\_file", true); |
| [798](#L798) | if($wp\_attached\_file !== false) { |
| [799](#L799) | $old\_file\_name = explode("/", $wp\_attached\_file); |
| [800](#L800) | array\_pop($old\_file\_name); |
| [801](#L801) |  |
| [802](#L802) | if(count($old\_file\_name) > 0) { |
| [803](#L803) | $base\_path .= implode(DIRECTORY\_SEPARATOR, $old\_file\_name); |
| [804](#L804) | $baseurl .= implode("/", $old\_file\_name); |
| [805](#L805) |  |
| [806](#L806) | $post\_upload = implode("/", $old\_file\_name); |
| [807](#L807) | } |
| [808](#L808) | } |
| [809](#L809) |  |
| [810](#L810) | $upload\_dir = []; |
| [811](#L811) | $upload\_dir['path'] = $base\_path; |
| [812](#L812) | $upload\_dir['old\_path'] = $base\_path; |
| [813](#L813) | $upload\_dir['url'] = $baseurl; |
| [814](#L814) | $upload\_dir['old\_url'] = $baseurl; |
| [815](#L815) |  |
| [816](#L816) | $this->upload\_dir = $upload\_dir; |
| [817](#L817) |  |
| [818](#L818) | $attachment\_url = $attachment->guid; |
| [819](#L819) | $url = wp\_get\_attachment\_url($attachment\_id); |
| [820](#L820) | if(!empty($url)) { |
| [821](#L821) | $attachment\_url = $url; |
| [822](#L822) | } |
| [823](#L823) | $file\_parts = pathinfo($attachment\_url); |
| [824](#L824) | $this->old\_file\_path = $base\_path . DIRECTORY\_SEPARATOR . $file\_parts['basename']; |
| [825](#L825) | if(isset($attachment\_meta['file']) && !empty($attachment\_meta['file'])) { |
| [826](#L826) | $this->old\_file\_url = $wp\_upload\_path['baseurl'] . "/" . $attachment\_meta['file']; |
| [827](#L827) | } else { |
| [828](#L828) | $this->old\_file\_url = wp\_get\_attachment\_url($post\_id); |
| [829](#L829) | } |
| [830](#L830) |  |
| [831](#L831) | if($new\_file\_name != $file\_name) { |
| [832](#L832) | global $wpdb; |
| [833](#L833) |  |
| [834](#L834) | $new\_file\_name = $this->checkForFileName($new\_file\_name, $upload\_dir['path'].DIRECTORY\_SEPARATOR); |
| [835](#L835) |  |
| [836](#L836) | $this->new\_file\_path = $upload\_dir['path'].DIRECTORY\_SEPARATOR.$new\_file\_name; |
| [837](#L837) | $this->new\_file\_url = $upload\_dir['url']."/".$new\_file\_name; |
| [838](#L838) | if(file\_exists($this->old\_file\_path)) { |
| [839](#L839) | rename($this->old\_file\_path, $this->new\_file\_path); |
| [840](#L840) |  |
| [841](#L841) | update\_attached\_file($post->ID, $this->new\_file\_path); |
| [842](#L842) |  |
| [843](#L843) | $update\_array = []; |
| [844](#L844) | $update\_array['ID'] = $post->ID; |
| [845](#L845) | $update\_array['post\_title'] = sanitize\_text\_field($\_REQUEST['post\_title']); |
| [846](#L846) | $update\_array['post\_name'] = sanitize\_title($post\_slug); |
| [847](#L847) | $update\_array['guid'] = $this->new\_file\_path; //wp\_get\_attachment\_url($this->post\_id); |
| [848](#L848) | $update\_array['post\_mime\_type'] = $post->post\_mime\_type; |
| [849](#L849) | $post\_id = wp\_update\_post($update\_array, true); |
| [850](#L850) |  |
| [851](#L851) | // update post doesn't update GUID on updates. |
| [852](#L852) | $this->removeThumbImages(); |
| [853](#L853) |  |
| [854](#L854) | $metadata = wp\_generate\_attachment\_metadata($post->ID, $this->new\_file\_path); |
| [855](#L855) | wp\_update\_attachment\_metadata($post->ID, $metadata); |
| [856](#L856) |  |
| [857](#L857) | $this->new\_image\_meta = wp\_get\_attachment\_metadata($attachment\_id); |
| [858](#L858) |  |
| [859](#L859) | update\_post\_meta( $attachment\_id, '\_wp\_attached\_file', trim(trim($post\_upload, "/")."/".$new\_file\_name , "/")); |
| [860](#L860) |  |
| [861](#L861) | $this->searchAndReplace(); |
| [862](#L862) |  |
| [863](#L863) | delete\_post\_meta($attachment\_id, "folders\_file\_replaced"); |
| [864](#L864) | add\_post\_meta( $attachment\_id, "folders\_file\_replaced", time(), true); |
| [865](#L865) | } |
| [866](#L866) | } |
| [867](#L867) | } |
| [868](#L868) |  |
| [869](#L869) | /\*\* |
| [870](#L870) | \* Replace file name with title |
| [871](#L871) | \* |
| [872](#L872) | \* @since 2.6.3 |
| [873](#L873) | \* @access public |
| [874](#L874) | \* |
| [875](#L875) | \*/ |
| [876](#L876) | public function change\_file\_name\_on\_update($post\_id = 0) { |
| [877](#L877) | global $post; |
| [878](#L878) | if(!isset($\_REQUEST['premio\_change\_nonce']) || !isset($\_REQUEST['premio\_change\_file\_name'])) { |
| [879](#L879) | return; |
| [880](#L880) | } |
| [881](#L881) | if(!wp\_verify\_nonce($\_REQUEST['premio\_change\_nonce'], 'premio\_change\_file\_name\_'.$post->ID)) { |
| [882](#L882) | return; |
| [883](#L883) | } |
| [884](#L884) | if ( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) { |
| [885](#L885) | return; |
| [886](#L886) | } |
| [887](#L887) | $premio\_change\_file\_name = sanitize\_text\_field($\_REQUEST['premio\_change\_file\_name']); |
| [888](#L888) |  |
| [889](#L889) | if($premio\_change\_file\_name == "yes") { |
| [890](#L890) | if($post->post\_type == "attachment") { |
| [891](#L891) |  |
| [892](#L892) | unset($\_REQUEST['premio\_change\_nonce']); |
| [893](#L893) | unset($\_REQUEST['premio\_change\_file\_name']); |
| [894](#L894) |  |
| [895](#L895) | $this->change\_file\_name\_with\_title($post->ID); |
| [896](#L896) | } |
| [897](#L897) | } |
| [898](#L898) | } |
| [899](#L899) |  |
| [900](#L900) | /\*\* |
| [901](#L901) | \* Add Js and CSS files for replace file screen |
| [902](#L902) | \* |
| [903](#L903) | \* @since 2.6.3 |
| [904](#L904) | \* @access public |
| [905](#L905) | \* |
| [906](#L906) | \*/ |
| [907](#L907) | public function folders\_admin\_css\_and\_js($page) { |
| [908](#L908) | if($page == "media\_page\_folders-replace-media" || $page == "admin\_page\_folders-replace-media") { |
| [909](#L909) | wp\_enqueue\_style('folders-replace-media', plugin\_dir\_url(dirname(\_\_FILE\_\_)) . 'assets/css/replace-media.css', [], WCP\_FOLDER\_VERSION); |
| [910](#L910) |  |
| [911](#L911) | wp\_enqueue\_script('folders-simpledropit', plugin\_dir\_url(dirname(\_\_FILE\_\_)) . 'assets/js/simpledropit.min.js', [], WCP\_FOLDER\_VERSION, true); |
| [912](#L912) | wp\_enqueue\_script('folders-replace-media', plugin\_dir\_url(dirname(\_\_FILE\_\_)) . 'assets/js/replace-media.js', [], WCP\_FOLDER\_VERSION, true); |
| [913](#L913) | $maxUploadSize = ini\_get("upload\_max\_filesize"); |
| [914](#L914) | $maxUploadSize = str\_replace(["K", "M", "G", "T", "P"],[" KB", " MB", " GB", " TB", " PB"], $maxUploadSize); |
| [915](#L915) | $maxSize = sprintf(esc\_html\_\_("Maximum file size %1\$s", "folders"), $maxUploadSize); |
| [916](#L916) | wp\_localize\_script('folders-simpledropit','replace\_settings', [ |
| [917](#L917) | 'max\_size' => $maxSize, |
| [918](#L918) | 'file\_name' => esc\_html\_\_("File name", 'folders'), |
| [919](#L919) | 'file\_size' => esc\_html\_\_("Size", 'folders'), |
| [920](#L920) | 'file\_type' => esc\_html\_\_("Type", 'folders'), |
| [921](#L921) | 'dimension' => esc\_html\_\_("Dimension", 'folders'), |
| [922](#L922) | 'drag\_file' => esc\_html\_\_("Drag and drop files here", 'folders') |
| [923](#L923) | ]); |
| [924](#L924) | //            wp\_enqueue\_script('jquery-ui-datepicker'); |
| [925](#L925) | } |
| [926](#L926) | } |
| [927](#L927) |  |
| [928](#L928) | /\*\* |
| [929](#L929) | \* Add file replace menu in admin |
| [930](#L930) | \* |
| [931](#L931) | \* @since 2.6.3 |
| [932](#L932) | \* @access public |
| [933](#L933) | \* @return $string |
| [934](#L934) | \* |
| [935](#L935) | \*/ |
| [936](#L936) | public function admin\_menu() { |
| [937](#L937) | add\_submenu\_page("", |
| [938](#L938) | esc\_html\_\_("Replace media", "folders"), |
| [939](#L939) | esc\_html\_\_("Replace media", "folders"), |
| [940](#L940) | 'upload\_files', |
| [941](#L941) | 'folders-replace-media', |
| [942](#L942) | array($this, 'folders\_replace\_media') |
| [943](#L943) | ); |
| [944](#L944) | } |
| [945](#L945) |  |
| [946](#L946) | /\*\* |
| [947](#L947) | \* Add file replacement screen |
| [948](#L948) | \* |
| [949](#L949) | \* @since 2.6.3 |
| [950](#L950) | \* @access public |
| [951](#L951) | \* @return $string |
| [952](#L952) | \* |
| [953](#L953) | \*/ |
| [954](#L954) | public function folders\_replace\_media() { |
| [955](#L955) | global $plugin\_page; |
| [956](#L956) | $action = isset($\_GET['action']) ? sanitize\_text\_field($\_GET['action']) : ''; |
| [957](#L957) | $attachment\_id = isset($\_GET['attachment\_id']) ? sanitize\_text\_field($\_GET['attachment\_id']) : ''; |
| [958](#L958) | $nonce = isset($\_GET['nonce']) ? sanitize\_text\_field($\_GET['nonce']) : ''; |
| [959](#L959) | if (!wp\_verify\_nonce($nonce, "folders-replace-media-".$attachment\_id)) { |
| [960](#L960) | echo 'Invalid Nonce'; |
| [961](#L961) | exit; |
| [962](#L962) | } |
| [963](#L963) | $attachment = get\_post($attachment\_id); |
| [964](#L964) | if(empty($attachment) || !isset($attachment->guid)) { |
| [965](#L965) | echo 'Invalid URL'; |
| [966](#L966) | exit; |
| [967](#L967) | } |
| [968](#L968) | $guid = $attachment->guid; |
| [969](#L969) | $guid = explode(".", $guid); |
| [970](#L970) | if($guid == $attachment->guid) { |
| [971](#L971) | echo 'Invalid URL'; |
| [972](#L972) | exit; |
| [973](#L973) | } |
| [974](#L974) | $form\_action = $this->getMediaReplaceURL($attachment\_id); |
| [975](#L975) | include\_once dirname(dirname(\_\_FILE\_\_)) . WCP\_DS . "/templates" . WCP\_DS . "admin" . WCP\_DS . "media-replace.php"; |
| [976](#L976) | } |
| [977](#L977) |  |
| [978](#L978) | /\*\* |
| [979](#L979) | \* Add action for file replacement |
| [980](#L980) | \* |
| [981](#L981) | \* @since 2.6.3 |
| [982](#L982) | \* @access public |
| [983](#L983) | \* @return $actions |
| [984](#L984) | \* |
| [985](#L985) | \*/ |
| [986](#L986) | public function add\_media\_action($actions, $post) { |
| [987](#L987) | if (!$this->isEnabled) { |
| [988](#L988) | return array\_merge($actions); |
| [989](#L989) | } |
| [990](#L990) |  |
| [991](#L991) | if(current\_user\_can("upload\_files")) { |
| [992](#L992) | if (wp\_attachment\_is('image', $post->ID)) { |
| [993](#L993) | $link = $this->getMediaReplaceURL($post->ID); |
| [994](#L994) | $newaction['replace\_media'] = '<a style="color: ' . esc\_attr($this->buttonColor) . '" href="' . esc\_url($link) . '" rel="permalink">' . esc\_html\_\_("Replace media", "folders") . '</a>'; |
| [995](#L995) | return array\_merge($actions, $newaction); |
| [996](#L996) | } else { |
| [997](#L997) |  |
| [998](#L998) | $newaction['replace\_media'] = '<a style="color: ' . esc\_attr($this->buttonColor) . '" target="\_blank" href="' . esc\_url($this->upgradeLink) . '" rel="permalink">' . esc\_html\_\_("Replace Media 🔑", "folders") . '</a>'; |
| [999](#L999) | return array\_merge($actions, $newaction); |
| [1000](#L1000) | } |
| [1001](#L1001) | } |
| [1002](#L1002) |  |
| [1003](#L1003) | return $actions; |
| [1004](#L1004) | } |
| [1005](#L1005) |  |
| [1006](#L1006) | /\*\* |
| [1007](#L1007) | \* Get URL for file Replacement |
| [1008](#L1008) | \* |
| [1009](#L1009) | \* @since 2.6.3 |
| [1010](#L1010) | \* @access public |
| [1011](#L1011) | \* @return $url |
| [1012](#L1012) | \* |
| [1013](#L1013) | \*/ |
| [1014](#L1014) | public function getMediaReplaceURL($attach\_id) { |
| [1015](#L1015) | $url = admin\_url( "upload.php"); |
| [1016](#L1016) | $url = add\_query\_arg(array( |
| [1017](#L1017) | 'page' => 'folders-replace-media', |
| [1018](#L1018) | 'action' => 'folders\_replace\_media', |
| [1019](#L1019) | 'attachment\_id' => $attach\_id, |
| [1020](#L1020) | 'nonce' => wp\_create\_nonce("folders-replace-media-".$attach\_id) |
| [1021](#L1021) | ), $url); |
| [1022](#L1022) |  |
| [1023](#L1023) | return $url; |
| [1024](#L1024) | } |
| [1025](#L1025) |  |
| [1026](#L1026) | /\*\* |
| [1027](#L1027) | \* Update Metabox to Replace file name with title |
| [1028](#L1028) | \* |
| [1029](#L1029) | \* @since 2.6.3 |
| [1030](#L1030) | \* @access public |
| [1031](#L1031) | \* @return $size |
| [1032](#L1032) | \* |
| [1033](#L1033) | \*/ |
| [1034](#L1034) | public function replace\_meta\_box($post) { |
| [1035](#L1035) | if(current\_user\_can("upload\_files")) { |
| [1036](#L1036) | if (wp\_attachment\_is('image', $post->ID)) { |
| [1037](#L1037) | $link = $this->getMediaReplaceURL($post->ID); ?> |
| [1038](#L1038) | <p><a style='background: <?php echo esc\_attr($this->buttonColor) ?>; border-color: <?php echo esc\_attr($this->buttonColor) ?>; color:#ffffff' href='<?php echo esc\_url($link) ?>' class='button-secondary'><?php esc\_html\_e("Upload a new file", "folders") ?></a></p><p><?php esc\_html\_e("Click on the button to replace the file with another file", "folders") ?></p> |
| [1039](#L1039) | <?php } else { ?> |
| [1040](#L1040) | <p><a style='color: <?php echo esc\_attr($this->buttonColor) ?>; font-weight: 500' target='\_blank' href='<?php echo esc\_url($this->upgradeLink) ?>' ><?php esc\_html\_e("Upgrade to Pro", "folders") ?></a><?php esc\_html\_e("to replace any kind of files while uploading including pdf/svg/docx/etc & more.", "folders") ?></p> |
| [1041](#L1041) | <?php } |
| [1042](#L1042) | } |
| [1043](#L1043) | } |
| [1044](#L1044) |  |
| [1045](#L1045) | /\*\* |
| [1046](#L1046) | \* Add Metabox to replace file name with title |
| [1047](#L1047) | \* |
| [1048](#L1048) | \* @since 2.6.3 |
| [1049](#L1049) | \* @access public |
| [1050](#L1050) | \* |
| [1051](#L1051) | \*/ |
| [1052](#L1052) | public function change\_file\_name\_box($post) { |
| [1053](#L1053) | if(current\_user\_can("upload\_files")) { ?> |
| [1054](#L1054) | <p class="upgrade-bottom"> |
| [1055](#L1055) | <label for="change\_file\_name"><input disabled type="checkbox" id="change\_file\_name" name="premio\_change\_file\_name" value="yes"> <?php esc\_html\_e("Change file name according to title", "folders") ?></label> |
| [1056](#L1056) | </p> |
| [1057](#L1057) | <div class="upgrade-box"> |
| [1058](#L1058) | <a href="<?php echo esc\_url($this->upgradeLink) ?>" target="\_blank"><?php esc\_html\_e("Upgrade to Pro", "folders"); ?></a> |
| [1059](#L1059) | </div> |
| [1060](#L1060) | <?php |
| [1061](#L1061) | } |
| [1062](#L1062) | } |
| [1063](#L1063) |  |
| [1064](#L1064) | /\*\* |
| [1065](#L1065) | \* Add metabox in media edit page |
| [1066](#L1066) | \* |
| [1067](#L1067) | \* @since 2.6.3 |
| [1068](#L1068) | \* @access public |
| [1069](#L1069) | \* @return $size |
| [1070](#L1070) | \* |
| [1071](#L1071) | \*/ |
| [1072](#L1072) | public function attachment\_editor($form\_fields, $post) |
| [1073](#L1073) | { |
| [1074](#L1074) | $screen = null; |
| [1075](#L1075) | if (function\_exists('get\_current\_screen')) |
| [1076](#L1076) | { |
| [1077](#L1077) | $screen = get\_current\_screen(); |
| [1078](#L1078) |  |
| [1079](#L1079) | if(! is\_null($screen) && $screen->id == 'attachment') // hide on edit attachment screen. |
| [1080](#L1080) | return $form\_fields; |
| [1081](#L1081) | } |
| [1082](#L1082) |  |
| [1083](#L1083) | if(current\_user\_can("upload\_files")) { |
| [1084](#L1084) | if (wp\_attachment\_is('image', $post->ID)) { |
| [1085](#L1085) | $link = $this->getMediaReplaceURL($post->ID); |
| [1086](#L1086) | $form\_fields["folders"] = [ |
| [1087](#L1087) | "label" => esc\_html\_\_("Replace media", "folders"), |
| [1088](#L1088) | "input" => "html", |
| [1089](#L1089) | "html" => "<a style='background: " . esc\_attr($this->buttonColor) . "; border-color: " . esc\_attr($this->buttonColor) . "; color:#ffffff' href='" . esc\_url($link) . "' class='button-secondary'>" . esc\_html\_\_("Upload a new file", "folders") . "</a>", |
| [1090](#L1090) | "helps" => esc\_html\_\_("Click on the button to replace the file with another file", "folders"), |
| [1091](#L1091) | ]; |
| [1092](#L1092) | } else { |
| [1093](#L1093) | $form\_fields["folders"] = [ |
| [1094](#L1094) | "label" => esc\_html\_\_("Replace media", "folders"), |
| [1095](#L1095) | "input" => "html", |
| [1096](#L1096) | "html" => "<div style='border: solid 1px #c0c0c0; padding: 10px; border-radius: 2px; background: #ececec;'><a style='color: " . esc\_attr($this->buttonColor) . "; font-weight: 500' target='\_blank' href='" . esc\_url($this->upgradeLink) . "' >" . esc\_html\_\_("Upgrade to Pro", "folders") . "</a> " . esc\_html\_\_("to replace media files other than images", "folders") . "</div>", |
| [1097](#L1097) | "helps" => esc\_html\_\_("Click on the button to replace the file with another file", "folders"), |
| [1098](#L1098) | ]; |
| [1099](#L1099) | } |
| [1100](#L1100) | } |
| [1101](#L1101) |  |
| [1102](#L1102) | return $form\_fields; |
| [1103](#L1103) | } |
| [1104](#L1104) |  |
| [1105](#L1105) | /\*\* |
| [1106](#L1106) | \* Replace filenanme with title |
| [1107](#L1107) | \* |
| [1108](#L1108) | \* @since 2.6.3 |
| [1109](#L1109) | \* @access public |
| [1110](#L1110) | \* @return $size |
| [1111](#L1111) | \* |
| [1112](#L1112) | \*/ |
| [1113](#L1113) | public function attachment\_replace\_name\_with\_title($form\_fields, $post) |
| [1114](#L1114) | { |
| [1115](#L1115) | $screen = null; |
| [1116](#L1116) | if (function\_exists('get\_current\_screen')) |
| [1117](#L1117) | { |
| [1118](#L1118) | $screen = get\_current\_screen(); |
| [1119](#L1119) |  |
| [1120](#L1120) | if(! is\_null($screen) && $screen->id == 'attachment') // hide on edit attachment screen. |
| [1121](#L1121) | return $form\_fields; |
| [1122](#L1122) | } |
| [1123](#L1123) |  |
| [1124](#L1124) | if(current\_user\_can("upload\_files")) { |
| [1125](#L1125) | $form\_fields["replace\_file\_name"] = array( |
| [1126](#L1126) | "label" => esc\_html\_\_("Replace media", "folders"), |
| [1127](#L1127) | "input" => "html", |
| [1128](#L1128) | "html" => "<label for='attachment\_title\_" . esc\_attr($post->ID) . "' data-post='" . esc\_attr($post->ID) . "' data-nonce='" . wp\_create\_nonce('change\_attachment\_title\_' . $post->ID) . "'><input id='attachment\_title\_" . esc\_attr($post->ID) . "' type='checkbox' class='folder-replace-checkbox' value='" . esc\_attr($post->ID) . "'>" . esc\_html\_\_("Update file name with title") . "</label><a href='" . $this->upgradeLink . "' target='\_blank' style='background: " . esc\_attr($this->buttonColor) . "; border-color: " . esc\_attr($this->buttonColor) . "; color:#ffffff' type='button' class='button update-name-with-title' >" . esc\_html\_\_("Upgrade to Pro", "folders") . "</a>", |
| [1129](#L1129) | "helps" => "" |
| [1130](#L1130) | ); |
| [1131](#L1131) | } |
| [1132](#L1132) |  |
| [1133](#L1133) | return $form\_fields; |
| [1134](#L1134) | } |
| [1135](#L1135) |  |
| [1136](#L1136) | /\*\* |
| [1137](#L1137) | \* Get file size |
| [1138](#L1138) | \* |
| [1139](#L1139) | \* @since 2.6.3 |
| [1140](#L1140) | \* @access public |
| [1141](#L1141) | \* @return $size |
| [1142](#L1142) | \* |
| [1143](#L1143) | \*/ |
| [1144](#L1144) | public function getFileSize($attachment\_id) { |
| [1145](#L1145) | $size = filesize( get\_attached\_file( $attachment\_id )); |
| [1146](#L1146) | if($size > 1000000) { |
| [1147](#L1147) | $size = ($size/1000000); |
| [1148](#L1148) | return number\_format((float)$size, 2, ".", ",")." MB"; |
| [1149](#L1149) | } else if($size > 1000) { |
| [1150](#L1150) | $size = ($size/1000); |
| [1151](#L1151) | return number\_format((float)$size, 2, ".", ",")." KB"; |
| [1152](#L1152) | } |
| [1153](#L1153) | return $size." B"; |
| [1154](#L1154) | } |
| [1155](#L1155) |  |
| [1156](#L1156) | /\*\* |
| [1157](#L1157) | \* Check for valid date |
| [1158](#L1158) | \* |
| [1159](#L1159) | \* @since 2.6.3 |
| [1160](#L1160) | \* @access public |
| [1161](#L1161) | \* |
| [1162](#L1162) | \*/ |
| [1163](#L1163) |  |
| [1164](#L1164) | function validate\_date($date, $format = 'Y-m-d') { |
| [1165](#L1165) | $d = DateTime::createFromFormat($format, $date); |
| [1166](#L1166) | // The Y ( 4 digits year ) returns TRUE for any integer with any number of digits so changing the comparison from == to === fixes the issue. |
| [1167](#L1167) | return $d && $d->format($format) === $date; |
| [1168](#L1168) | } |
| [1169](#L1169) |  |
| [1170](#L1170) | /\*\* |
| [1171](#L1171) | \* Upload file and Replace it |
| [1172](#L1172) | \* |
| [1173](#L1173) | \* @since 2.6.3 |
| [1174](#L1174) | \* @access public |
| [1175](#L1175) | \* |
| [1176](#L1176) | \*/ |
| [1177](#L1177) | public function handle\_folders\_file\_upload() { |
| [1178](#L1178) | global $wpdb; |
| [1179](#L1179) | if(isset($\_FILES['new\_media\_file'])) { |
| [1180](#L1180) | if($\_FILES['new\_media\_file']['error'] == 0) { |
| [1181](#L1181) | $attachment\_id = isset($\_GET['attachment\_id']) ? sanitize\_text\_field($\_GET['attachment\_id']) : ''; |
| [1182](#L1182) | $nonce = isset($\_GET['nonce']) ? sanitize\_text\_field($\_GET['nonce']) : ''; |
| [1183](#L1183) | if (!wp\_verify\_nonce($nonce, "folders-replace-media-" . $attachment\_id)) { |
| [1184](#L1184) | return; |
| [1185](#L1185) | } |
| [1186](#L1186) | $attachment = get\_post($attachment\_id); |
| [1187](#L1187) | if (empty($attachment) || !isset($attachment->guid)) { |
| [1188](#L1188) | return; |
| [1189](#L1189) | } |
| [1190](#L1190) | $attachment\_url = $attachment->guid; |
| [1191](#L1191) | $url = wp\_get\_attachment\_url($attachment\_id); |
| [1192](#L1192) | if(!empty($url)) { |
| [1193](#L1193) | $attachment\_url = $url; |
| [1194](#L1194) | } |
| [1195](#L1195) | $guid = explode(".", $attachment\_url); |
| [1196](#L1196) | $guid = array\_pop($guid); |
| [1197](#L1197) | if ($guid == $attachment->guid) { |
| [1198](#L1198) | return; |
| [1199](#L1199) | } |
| [1200](#L1200) |  |
| [1201](#L1201) | $replacement\_option = "replace\_only\_file"; |
| [1202](#L1202) |  |
| [1203](#L1203) | $this->attachment\_id = $attachment\_id; |
| [1204](#L1204) |  |
| [1205](#L1205) | $file = $\_FILES['new\_media\_file']; |
| [1206](#L1206) | $file\_name = $file['name']; |
| [1207](#L1207) | $file\_ext = explode(".", $file\_name); |
| [1208](#L1208) | $file\_ext = array\_pop($file\_ext); |
| [1209](#L1209) | $ext = strtolower($file\_ext); |
| [1210](#L1210) |  |
| [1211](#L1211) | $wpmime = get\_allowed\_mime\_types(); |
| [1212](#L1212) |  |
| [1213](#L1213) | if(!isset($wpmime[$ext]) && !in\_array($file['type'], $wpmime)) { |
| [1214](#L1214) | wp\_die(esc\_html\_\_("Sorry, this file type is not permitted for security reasons", "folders")); |
| [1215](#L1215) | } |
| [1216](#L1216) |  |
| [1217](#L1217) | if(!in\_array($ext, ['jpg', 'png', 'jpeg', 'gif', 'svg'])) { |
| [1218](#L1218) | wp\_die(esc\_html\_\_("Sorry, this file type is not permitted for security reasons", "folders")); |
| [1219](#L1219) | } |
| [1220](#L1220) |  |
| [1221](#L1221) | if(!in\_array($file['type'], ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml'])) { |
| [1222](#L1222) | wp\_die(esc\_html\_\_("Sorry, this file type is not permitted for security reasons", "folders")); |
| [1223](#L1223) | } |
| [1224](#L1224) |  |
| [1225](#L1225) | if (wp\_attachment\_is('image', $attachment\_id)) { |
| [1226](#L1226) | $this->is\_old\_image = 1; |
| [1227](#L1227) | } |
| [1228](#L1228) |  |
| [1229](#L1229) | $this->old\_file\_url = $attachment\_url; |
| [1230](#L1230) | $this->old\_image\_meta = wp\_get\_attachment\_metadata($attachment\_id); |
| [1231](#L1231) |  |
| [1232](#L1232) | $new\_file = $file['tmp\_name']; |
| [1233](#L1233) |  |
| [1234](#L1234) | $file\_parts = pathinfo($attachment\_url); |
| [1235](#L1235) |  |
| [1236](#L1236) | $db\_file\_name = $file\_parts['basename']; |
| [1237](#L1237) | $db\_file\_array = explode(".", $db\_file\_name); |
| [1238](#L1238) | array\_pop($db\_file\_array); |
| [1239](#L1239) | $db\_file\_name = implode(".", $db\_file\_array)."."; |
| [1240](#L1240) | $db\_file\_name .= $file\_ext; |
| [1241](#L1241) |  |
| [1242](#L1242) | $wp\_upload\_path = wp\_get\_upload\_dir(); |
| [1243](#L1243) |  |
| [1244](#L1244) | $base\_path = $old\_path = $wp\_upload\_path['basedir'].DIRECTORY\_SEPARATOR; |
| [1245](#L1245) | $baseurl = $old\_url = $wp\_upload\_path['baseurl']."/"; |
| [1246](#L1246) |  |
| [1247](#L1247) | $post\_upload = ""; |
| [1248](#L1248) |  |
| [1249](#L1249) | $wp\_attached\_file = get\_post\_meta($attachment\_id, "\_wp\_attached\_file", true); |
| [1250](#L1250) | if($wp\_attached\_file !== false) { |
| [1251](#L1251) | $old\_file\_name = explode("/", $wp\_attached\_file); |
| [1252](#L1252) | array\_pop($old\_file\_name); |
| [1253](#L1253) |  |
| [1254](#L1254) | if(count($old\_file\_name) > 0) { |
| [1255](#L1255) | $old\_path .= implode(DIRECTORY\_SEPARATOR, $old\_file\_name); |
| [1256](#L1256) | $old\_url .= implode("/", $old\_file\_name); |
| [1257](#L1257) | } |
| [1258](#L1258) |  |
| [1259](#L1259) | if(count($old\_file\_name) > 0) { |
| [1260](#L1260) | $baseurl .= implode(DIRECTORY\_SEPARATOR, $old\_file\_name); |
| [1261](#L1261) | $base\_path .= implode("/", $old\_file\_name); |
| [1262](#L1262) | $post\_upload = implode("/", $old\_file\_name); |
| [1263](#L1263) | } |
| [1264](#L1264) | } |
| [1265](#L1265) |  |
| [1266](#L1266) | $upload\_dir = []; |
| [1267](#L1267) | $upload\_dir['path'] = $base\_path; |
| [1268](#L1268) | $upload\_dir['old\_path'] = $old\_path; |
| [1269](#L1269) | $upload\_dir['url'] = $baseurl; |
| [1270](#L1270) | $upload\_dir['old\_url'] = $old\_url; |
| [1271](#L1271) |  |
| [1272](#L1272) | $this->upload\_dir = $upload\_dir; |
| [1273](#L1273) |  |
| [1274](#L1274) | $this->old\_file\_path = $old\_path . "/" . $file\_parts['basename']; |
| [1275](#L1275) |  |
| [1276](#L1276) | if (!is\_dir($base\_path)) { |
| [1277](#L1277) | mkdir($base\_path, 755, true); |
| [1278](#L1278) | } |
| [1279](#L1279) |  |
| [1280](#L1280) | if (is\_dir($base\_path)) { |
| [1281](#L1281) |  |
| [1282](#L1282) | $file\_array = explode(".", $file['name']); |
| [1283](#L1283) | $file\_ext = array\_pop($file\_array); |
| [1284](#L1284) | $new\_file\_name = sanitize\_title(implode(".", $file\_array)).".".$file\_ext; |
| [1285](#L1285) |  |
| [1286](#L1286) | if($replacement\_option == "replace\_only\_file") { |
| [1287](#L1287) | $new\_file\_name = $db\_file\_name; |
| [1288](#L1288) | } |
| [1289](#L1289) |  |
| [1290](#L1290) | if(strtolower($new\_file\_name) != strtolower($file\_parts['basename'])) { |
| [1291](#L1291) | $new\_file\_name = $this->checkForFileName($new\_file\_name, $base\_path . DIRECTORY\_SEPARATOR); |
| [1292](#L1292) | } |
| [1293](#L1293) |  |
| [1294](#L1294) | $this->new\_file\_path = $base\_path . DIRECTORY\_SEPARATOR . $new\_file\_name; |
| [1295](#L1295) |  |
| [1296](#L1296) | $status = move\_uploaded\_file($new\_file, $this->new\_file\_path); |
| [1297](#L1297) |  |
| [1298](#L1298) | $this->new\_file\_url = trim($baseurl, "/")."/".$new\_file\_name; |
| [1299](#L1299) |  |
| [1300](#L1300) | if ($status) { |
| [1301](#L1301) | $old\_file\_path = str\_replace(array("/",DIRECTORY\_SEPARATOR), array("", ""), $this->old\_file\_path); |
| [1302](#L1302) | $new\_file\_path = str\_replace(array("/",DIRECTORY\_SEPARATOR), array("", ""), $this->new\_file\_path); |
| [1303](#L1303) | if($old\_file\_path != $new\_file\_path) { |
| [1304](#L1304) | if(file\_exists($this->old\_file\_path)) { |
| [1305](#L1305) | @wp\_delete\_file($this->old\_file\_path); |
| [1306](#L1306) | } |
| [1307](#L1307) | } |
| [1308](#L1308) |  |
| [1309](#L1309) | update\_attached\_file($attachment->ID, $this->new\_file\_url); |
| [1310](#L1310) |  |
| [1311](#L1311) | $update\_array = []; |
| [1312](#L1312) | $update\_array['ID'] = $attachment->ID; |
| [1313](#L1313) | $update\_array['guid'] = $this->new\_file\_url; //wp\_get\_attachment\_url($this->post\_id); |
| [1314](#L1314) | $update\_array['post\_mime\_type'] = $file['type']; |
| [1315](#L1315) |  |
| [1316](#L1316) | $current\_date = date("Y-m-d H:i:s"); |
| [1317](#L1317) | $current\_date\_gmt = date\_i18n("Y-m-d H:i:s", strtotime($current\_date)); |
| [1318](#L1318) |  |
| [1319](#L1319) | $update\_array['post\_modified'] = $current\_date; |
| [1320](#L1320) | $update\_array['post\_modified\_gmt'] = $current\_date\_gmt; |
| [1321](#L1321) | $post\_id = wp\_update\_post($update\_array, true); |
| [1322](#L1322) |  |
| [1323](#L1323) | update\_post\_meta( $attachment\_id, '\_wp\_attached\_file', trim(trim($post\_upload, "/")."/".$new\_file\_name , "/")); |
| [1324](#L1324) |  |
| [1325](#L1325) | // update post doesn't update GUID on updates. |
| [1326](#L1326) | $wpdb->update($wpdb->posts, array('guid' => $this->new\_file\_url), array('ID' => $attachment->ID)); |
| [1327](#L1327) |  |
| [1328](#L1328) | $this->removeThumbImages(); |
| [1329](#L1329) |  |
| [1330](#L1330) | $metadata = wp\_generate\_attachment\_metadata($attachment->ID, $this->new\_file\_path); |
| [1331](#L1331) | wp\_update\_attachment\_metadata($attachment->ID, $metadata); |
| [1332](#L1332) |  |
| [1333](#L1333) | $this->new\_image\_meta = wp\_get\_attachment\_metadata($attachment\_id); |
| [1334](#L1334) |  |
| [1335](#L1335) | //                        update\_post\_meta( $attachment\_id, '\_wp\_attached\_file', trim(trim($post\_upload, "/")."/".$new\_file\_name ), "/"); |
| [1336](#L1336) |  |
| [1337](#L1337) | $this->searchAndReplace(); |
| [1338](#L1338) |  |
| [1339](#L1339) | delete\_post\_meta($attachment\_id, "folders\_file\_replaced"); |
| [1340](#L1340) | add\_post\_meta( $attachment\_id, "folders\_file\_replaced", time(), true); |
| [1341](#L1341) |  |
| [1342](#L1342) | wp\_redirect(admin\_url("post.php?post=" . $attachment\_id . "&action=edit&premio\_message=success&image\_update=1")); |
| [1343](#L1343) | exit; |
| [1344](#L1344) | } else { |
| [1345](#L1345) | wp\_die("Error during uploading file"); |
| [1346](#L1346) | } |
| [1347](#L1347) |  |
| [1348](#L1348) | } else { |
| [1349](#L1349) | wp\_die("Permission issue, Unable to create directory"); |
| [1350](#L1350) | } |
| [1351](#L1351) | } |
| [1352](#L1352) | } |
| [1353](#L1353) | } |
| [1354](#L1354) |  |
| [1355](#L1355) | /\*\* |
| [1356](#L1356) | \* Check for filename |
| [1357](#L1357) | \* |
| [1358](#L1358) | \* @since 2.6.3 |
| [1359](#L1359) | \* @access public |
| [1360](#L1360) | \* |
| [1361](#L1361) | \*/ |
| [1362](#L1362) | public function checkForFileName($fileName, $filePath, $postFix = 0) { |
| [1363](#L1363) | $new\_file\_name = $fileName; |
| [1364](#L1364) | if(!empty($postFix)) { |
| [1365](#L1365) | $file\_array = explode(".", $fileName); |
| [1366](#L1366) | $file\_ext = array\_pop($file\_array); |
| [1367](#L1367) | $new\_file\_name = implode(".", $file\_array)."-".$postFix.".".$file\_ext; |
| [1368](#L1368) | } |
| [1369](#L1369) | if(!file\_exists($filePath.$new\_file\_name)) { |
| [1370](#L1370) | return $new\_file\_name; |
| [1371](#L1371) | } |
| [1372](#L1372) | return $this->checkForFileName($fileName, $filePath, ($postFix+1)); |
| [1373](#L1373) | } |
| [1374](#L1374) |  |
| [1375](#L1375) | public $replace\_items = []; |
| [1376](#L1376) |  |
| [1377](#L1377) | /\*\* |
| [1378](#L1378) | \* Check and Remove Thumb image in wp-content |
| [1379](#L1379) | \* |
| [1380](#L1380) | \* @since 2.6.3 |
| [1381](#L1381) | \* @access public |
| [1382](#L1382) | \* |
| [1383](#L1383) | \*/ |
| [1384](#L1384) | public function removeThumbImages() { |
| [1385](#L1385) | if(!empty($this->old\_image\_meta) && isset($this->old\_image\_meta['sizes']) && !empty($this->upload\_dir) && isset($this->upload\_dir['path'])) { |
| [1386](#L1386) | $path = $this->upload\_dir['old\_path'].DIRECTORY\_SEPARATOR; |
| [1387](#L1387) | foreach ($this->old\_image\_meta['sizes'] as $image) { |
| [1388](#L1388) | if(file\_exists($path.$image['file']) && (!isset($image['mime-type']) || $image['mime-type'] != 'image/svg+xml')) { |
| [1389](#L1389) | @wp\_delete\_file($path . $image['file']); |
| [1390](#L1390) | } |
| [1391](#L1391) | } |
| [1392](#L1392) | } |
| [1393](#L1393) | } |
| [1394](#L1394) |  |
| [1395](#L1395) | /\*\* |
| [1396](#L1396) | \* Search and Replace files in Database |
| [1397](#L1397) | \* |
| [1398](#L1398) | \* @since 2.6.3 |
| [1399](#L1399) | \* @access public |
| [1400](#L1400) | \* @return $string |
| [1401](#L1401) | \* |
| [1402](#L1402) | \*/ |
| [1403](#L1403) | public function searchAndReplace() { |
| [1404](#L1404) | if (wp\_attachment\_is('image', $this->attachment\_id)) { |
| [1405](#L1405) | $this->is\_new\_image = 1; |
| [1406](#L1406) | } |
| [1407](#L1407) | if($this->old\_file\_url != $this->new\_file\_url) { |
| [1408](#L1408) | $replace = array( |
| [1409](#L1409) | 'search' => $this->old\_file\_url, |
| [1410](#L1410) | 'replace' => $this->new\_file\_url, |
| [1411](#L1411) | ); |
| [1412](#L1412) | $this->replace\_items[] = $replace; |
| [1413](#L1413) | } |
| [1414](#L1414) |  |
| [1415](#L1415) | $base\_url = $this->upload\_dir['url']; |
| [1416](#L1416) | $base\_url = trim($base\_url, "/")."/"; |
| [1417](#L1417) | $new\_url = $this->new\_file\_url; |
| [1418](#L1418) |  |
| [1419](#L1419) | if(isset($this->old\_image\_meta['sizes']) && !empty($this->old\_image\_meta['sizes'])) { |
| [1420](#L1420) | if(!isset($this->new\_image\_meta['sizes']) || empty($this->new\_image\_meta['sizes'])) { |
| [1421](#L1421) | foreach ($this->old\_image\_meta['sizes'] as $key=>$image) { |
| [1422](#L1422) | $replace = array( |
| [1423](#L1423) | 'search' => $base\_url.$image['file'], |
| [1424](#L1424) | 'replace' => $new\_url, |
| [1425](#L1425) | ); |
| [1426](#L1426) | $this->replace\_items[] = $replace; |
| [1427](#L1427) | } |
| [1428](#L1428) | } else if(isset($this->new\_image\_meta['sizes']) && !empty($this->new\_image\_meta['sizes'])) { |
| [1429](#L1429) | $new\_size = $this->new\_image\_meta['sizes']; |
| [1430](#L1430) | foreach ($this->old\_image\_meta['sizes'] as $key=>$image) { |
| [1431](#L1431) | $new\_replace\_url = $new\_url; |
| [1432](#L1432) | if(isset($new\_size[$key])) { |
| [1433](#L1433) | $new\_replace\_url = $base\_url.$new\_size[$key]['file']; |
| [1434](#L1434) | } |
| [1435](#L1435) | $replace = array( |
| [1436](#L1436) | 'search' => $base\_url.$image['file'], |
| [1437](#L1437) | 'replace' => $new\_replace\_url, |
| [1438](#L1438) | ); |
| [1439](#L1439) | $this->replace\_items[] = $replace; |
| [1440](#L1440) | } |
| [1441](#L1441) | } |
| [1442](#L1442) | } |
| [1443](#L1443) |  |
| [1444](#L1444) | if(!empty($this->replace\_items)) { |
| [1445](#L1445) | $replace\_items = []; |
| [1446](#L1446) | foreach($this->replace\_items as $args) { |
| [1447](#L1447) | if($args['search'] != $args['replace']) { |
| [1448](#L1448) | $replace\_items[] = $args; |
| [1449](#L1449) | } |
| [1450](#L1450) | } |
| [1451](#L1451) | $this->replace\_items = $replace\_items; |
| [1452](#L1452) | $this->replaceURL(); |
| [1453](#L1453) | } |
| [1454](#L1454) | } |
| [1455](#L1455) |  |
| [1456](#L1456) | /\*\* |
| [1457](#L1457) | \* Replace URL in Database tables |
| [1458](#L1458) | \* |
| [1459](#L1459) | \* @since 2.6.3 |
| [1460](#L1460) | \* @access public |
| [1461](#L1461) | \* @return $string |
| [1462](#L1462) | \* |
| [1463](#L1463) | \*/ |
| [1464](#L1464) | function replaceURL() { |
| [1465](#L1465) | /\* check in post content \*/ |
| [1466](#L1466) | $this->checkInPostContent(); |
| [1467](#L1467) |  |
| [1468](#L1468) | /\* check in options \*/ |
| [1469](#L1469) | $this->checkInOptions(); |
| [1470](#L1470) |  |
| [1471](#L1471) | /\* check in meta \*/ |
| [1472](#L1472) | $this->checkInMetaData(); |
| [1473](#L1473) |  |
| [1474](#L1474) | if(function\_exists('folders\_pro\_clear\_all\_caches')) { |
| [1475](#L1475) | folders\_pro\_clear\_all\_caches(); |
| [1476](#L1476) | } |
| [1477](#L1477) | } |
| [1478](#L1478) |  |
| [1479](#L1479) | /\*\* |
| [1480](#L1480) | \* Checking image URLs in Post Content |
| [1481](#L1481) | \* |
| [1482](#L1482) | \* @since 2.6.3 |
| [1483](#L1483) | \* @access public |
| [1484](#L1484) | \* @return $string |
| [1485](#L1485) | \* |
| [1486](#L1486) | \*/ |
| [1487](#L1487) | function checkInPostContent() { |
| [1488](#L1488) | global $wpdb; |
| [1489](#L1489) | $post\_table = $wpdb->prefix."posts"; |
| [1490](#L1490) | if(!empty($this->replace\_items)) { |
| [1491](#L1491) | $query = "SELECT ID, post\_content FROM {$post\_table} WHERE post\_content LIKE %s"; |
| [1492](#L1492) | $update\_query = "UPDATE {$post\_table} SET post\_content = %s WHERE ID = %d"; |
| [1493](#L1493) | foreach ($this->replace\_items as $args) { |
| [1494](#L1494) | if($args['search'] != $args['replace']) { |
| [1495](#L1495) | $sql\_query = $wpdb->prepare($query, "%".$args['search']."%"); |
| [1496](#L1496) | $results = $wpdb->get\_results($sql\_query, ARRAY\_A ); |
| [1497](#L1497) | if(!empty($results)) { |
| [1498](#L1498) | foreach ($results AS $row) { |
| [1499](#L1499) | $content = $this->findAndReplaceContent($row['post\_content'], $args['search'], $args['replace']); |
| [1500](#L1500) | $update\_post\_query = $wpdb->prepare($update\_query, $content, $row['ID']); |
| [1501](#L1501) | $result = $wpdb->query($update\_post\_query); |
| [1502](#L1502) | } |
| [1503](#L1503) | } |
| [1504](#L1504) | } |
| [1505](#L1505) | } |
| [1506](#L1506) | } |
| [1507](#L1507) | } |
| [1508](#L1508) |  |
| [1509](#L1509) | /\*\* |
| [1510](#L1510) | \* Checking image URLs in MetaData |
| [1511](#L1511) | \* |
| [1512](#L1512) | \* @since 2.6.3 |
| [1513](#L1513) | \* @access public |
| [1514](#L1514) | \* @return $string |
| [1515](#L1515) | \* |
| [1516](#L1516) | \*/ |
| [1517](#L1517) | function checkInOptions() { |
| [1518](#L1518) | global $wpdb; |
| [1519](#L1519) | $post\_table = $wpdb->prefix."options"; |
| [1520](#L1520) | if(!empty($this->replace\_items)) { |
| [1521](#L1521) | $query = "SELECT option\_id, option\_value FROM {$post\_table} WHERE option\_value LIKE %s"; |
| [1522](#L1522) | $update\_query = "UPDATE {$post\_table} SET option\_value = %s WHERE option\_id = %d"; |
| [1523](#L1523) | foreach ($this->replace\_items as $args) { |
| [1524](#L1524) | if($args['search'] != $args['replace']) { |
| [1525](#L1525) | $sql\_query = $wpdb->prepare($query, "%".$args['search']."%"); |
| [1526](#L1526) | $results = $wpdb->get\_results($sql\_query, ARRAY\_A ); |
| [1527](#L1527) | if(!empty($results)) { |
| [1528](#L1528) | foreach ($results AS $row) { |
| [1529](#L1529) | $content = $this->findAndReplaceContent($row['option\_value'], $args['search'], $args['replace']); |
| [1530](#L1530) | $update\_post\_query = $wpdb->prepare($update\_query, $content, $row['option\_id']); |
| [1531](#L1531) | $result = $wpdb->query($update\_post\_query); |
| [1532](#L1532) | } |
| [1533](#L1533) | } |
| [1534](#L1534) | } |
| [1535](#L1535) | } |
| [1536](#L1536) | } |
| [1537](#L1537) | } |
| [1538](#L1538) |  |
| [1539](#L1539) | /\*\* |
| [1540](#L1540) | \* Checking image URLs in MetaData |
| [1541](#L1541) | \* |
| [1542](#L1542) | \* @since 2.6.3 |
| [1543](#L1543) | \* @access public |
| [1544](#L1544) | \* @return $string |
| [1545](#L1545) | \* |
| [1546](#L1546) | \*/ |
| [1547](#L1547) | function checkInMetaData() { |
| [1548](#L1548) | $tables = array( |
| [1549](#L1549) | array( |
| [1550](#L1550) | 'table\_name' => 'usermeta', |
| [1551](#L1551) | 'primary\_key' => 'umeta\_id', |
| [1552](#L1552) | 'search\_key' => 'meta\_value' |
| [1553](#L1553) | ), |
| [1554](#L1554) | array( |
| [1555](#L1555) | 'table\_name' => 'termmeta', |
| [1556](#L1556) | 'primary\_key' => 'meta\_id', |
| [1557](#L1557) | 'search\_key' => 'meta\_value' |
| [1558](#L1558) | ), |
| [1559](#L1559) | array( |
| [1560](#L1560) | 'table\_name' => 'postmeta', |
| [1561](#L1561) | 'primary\_key' => 'meta\_id', |
| [1562](#L1562) | 'search\_key' => 'meta\_value' |
| [1563](#L1563) | ), |
| [1564](#L1564) | array( |
| [1565](#L1565) | 'table\_name' => 'commentmeta', |
| [1566](#L1566) | 'primary\_key' => 'meta\_id', |
| [1567](#L1567) | 'search\_key' => 'meta\_value' |
| [1568](#L1568) | ) |
| [1569](#L1569) | ); |
| [1570](#L1570) | global $wpdb; |
| [1571](#L1571) | foreach ($tables as $table) { |
| [1572](#L1572) | $post\_table = $wpdb->prefix . $table['table\_name']; |
| [1573](#L1573) | if (!empty($this->replace\_items)) { |
| [1574](#L1574) | $query = "SELECT {$table['primary\_key']}, {$table['search\_key']} FROM {$post\_table} WHERE {$table['search\_key']} LIKE %s"; |
| [1575](#L1575) | $update\_query = "UPDATE {$post\_table} SET {$table['search\_key']} = %s WHERE {$table['primary\_key']} = %d"; |
| [1576](#L1576) | foreach ($this->replace\_items as $args) { |
| [1577](#L1577) | if ($args['search'] != $args['replace']) { |
| [1578](#L1578) | $sql\_query = $wpdb->prepare($query, "%" . $args['search'] . "%"); |
| [1579](#L1579) | $results = $wpdb->get\_results($sql\_query, ARRAY\_A); |
| [1580](#L1580) | if (!empty($results)) { |
| [1581](#L1581) | foreach ($results as $row) { |
| [1582](#L1582) | $content = $this->findAndReplaceContent($row[$table['search\_key']], $args['search'], $args['replace']); |
| [1583](#L1583) | $update\_post\_query = $wpdb->prepare($update\_query, $content, $row[$table['primary\_key']]); |
| [1584](#L1584) | $result = $wpdb->query($update\_post\_query); |
| [1585](#L1585) | } |
| [1586](#L1586) | } |
| [1587](#L1587) | } |
| [1588](#L1588) | } |
| [1589](#L1589) | } |
| [1590](#L1590) | } |
| [1591](#L1591) | } |
| [1592](#L1592) |  |
| [1593](#L1593) | /\*\* |
| [1594](#L1594) | \* Checking for Array Key |
| [1595](#L1595) | \* |
| [1596](#L1596) | \* @since 2.6.3 |
| [1597](#L1597) | \* @access public |
| [1598](#L1598) | \* @return $json |
| [1599](#L1599) | \* Forked from Enable Media Replace |
| [1600](#L1600) | \* |
| [1601](#L1601) | \*/ |
| [1602](#L1602) | function findAndReplaceContent($content, $search, $replace, $depth = false) { |
| [1603](#L1603) | $content = maybe\_unserialize($content); |
| [1604](#L1604) |  |
| [1605](#L1605) | // Checking for JSON Data |
| [1606](#L1606) | $isJson = $this->isJSON($content); |
| [1607](#L1607) | if ($isJson) { |
| [1608](#L1608) | $content = json\_decode($content); |
| [1609](#L1609) | } |
| [1610](#L1610) |  |
| [1611](#L1611) | // Replace content if content is String |
| [1612](#L1612) | if (is\_string($content)) { |
| [1613](#L1613) | $content = str\_replace($search, $replace, $content); |
| [1614](#L1614) | } |
| [1615](#L1615) | else if(is\_wp\_error($content)) {   // Return if error in data |
| [1616](#L1616) |  |
| [1617](#L1617) | } |
| [1618](#L1618) | else if(is\_array($content)) {   // Replace content if content is Array |
| [1619](#L1619) | foreach($content as $index => $value) { |
| [1620](#L1620) | $content[$index] = $this->findAndReplaceContent($value, $search, $replace, true); |
| [1621](#L1621) | if (is\_string($index))  { |
| [1622](#L1622) | $index\_replaced = $this->findAndReplaceContent($index, $search, $replace, true); |
| [1623](#L1623) | if ($index\_replaced !== $index) |
| [1624](#L1624) | $content = $this->changeArrayKey($content, array($index => $index\_replaced)); |
| [1625](#L1625) | } |
| [1626](#L1626) | } |
| [1627](#L1627) | } |
| [1628](#L1628) | else if(is\_object($content)) {   // Replace content if content is Object |
| [1629](#L1629) | foreach($content as $key => $value) { |
| [1630](#L1630) | $content->{$key} = $this->findAndReplaceContent($value, $search, $replace, true); |
| [1631](#L1631) | } |
| [1632](#L1632) | } |
| [1633](#L1633) |  |
| [1634](#L1634) | if ($isJson && $depth === false) { |
| [1635](#L1635) | $content = wp\_json\_encode($content, JSON\_UNESCAPED\_SLASHES); |
| [1636](#L1636) | } |
| [1637](#L1637) | else if($depth === false && (is\_array($content) || is\_object($content))) { |
| [1638](#L1638) | $content = maybe\_serialize($content); |
| [1639](#L1639) | } |
| [1640](#L1640) |  |
| [1641](#L1641) | return $content; |
| [1642](#L1642) | } |
| [1643](#L1643) |  |
| [1644](#L1644) | /\*\* |
| [1645](#L1645) | \* Checking for Array Key |
| [1646](#L1646) | \* |
| [1647](#L1647) | \* @since 2.6.3 |
| [1648](#L1648) | \* @access public |
| [1649](#L1649) | \* @return $json |
| [1650](#L1650) | \* |
| [1651](#L1651) | \*/ |
| [1652](#L1652) | function changeArrayKey($array, $set) { |
| [1653](#L1653) | if (is\_array($array) && is\_array($set)) { |
| [1654](#L1654) | $newArray = []; |
| [1655](#L1655) | foreach ($array as $k => $v) { |
| [1656](#L1656) | $key = array\_key\_exists( $k, $set) ? $set[$k] : $k; |
| [1657](#L1657) | $newArray[$key] = is\_array($v) ? $this->changeArrayKey($v, $set) : $v; |
| [1658](#L1658) | } |
| [1659](#L1659) | return $newArray; |
| [1660](#L1660) | } |
| [1661](#L1661) | return $array; |
| [1662](#L1662) | } |
| [1663](#L1663) |  |
| [1664](#L1664) | /\*\* |
| [1665](#L1665) | \* Check if it is JSON or not |
| [1666](#L1666) | \* |
| [1667](#L1667) | \* @since 2.6.3 |
| [1668](#L1668) | \* @access public |
| [1669](#L1669) | \* Forked from Enable Media Replace |
| [1670](#L1670) | \* @return $json |
| [1671](#L1671) | \* |
| [1672](#L1672) | \*/ |
| [1673](#L1673) | function isJSON($content) |
| [1674](#L1674) | { |
| [1675](#L1675) | if (is\_array($content) || is\_object($content)) |
| [1676](#L1676) | return false; |
| [1677](#L1677) |  |
| [1678](#L1678) | $json = json\_decode($content); |
| [1679](#L1679) | return $json && $json != $content; |
| [1680](#L1680) | } |
| [1681](#L1681) | } |
| [1682](#L1682) | $folders\_replace\_media = new folders\_replace\_media(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/folders/tags/3.0.3/includes/media.replace.php?format=txt)
* [Original Format](/export/3220525/folders/tags/3.0.3/includes/media.replace.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


