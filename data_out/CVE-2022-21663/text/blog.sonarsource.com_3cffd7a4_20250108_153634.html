NEW![Sonar has entered a definitive agreement to acquire Tidelift! Read the press release.](/company/press-releases/sonar-to-acquire-tidelift/) [![](data:image/svg+xml;charset=utf-8...)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)](/ "Home")

* Solutions

  Use Cases

  [AI-assisted & quality-assured codeEnsure code generated by AI assistants is of the highest quality](/solutions/ai/)[DevOps transformationHarness the full potential of DevOps by reducing roll backs and improving quality of releases](/solutions/devops-transformation/)[Code coverageEnsure code quality and security by facilitating faster debugging through clear visibility of coverage gaps.](/solutions/code-coverage/) [Reduce & manage technical debtMaximize innovation by proactively managing technical debt](/solutions/reduce-technical-debt/)[Secure by designIntegrate code security in compliance with NIST Secure Software Development Framework](/solutions/secure-by-design-code/)[All Use CasesRead more about Sonar Use cases with blog articles, technical articles and developer guides](/solutions/use-cases/)

  Clean Code

  [What is clean codeA detailed definition of Clean Code](/solutions/clean-code/)[Power of clean codeBusiness success built on Clean Code](/solutions/power-of-clean-code/)[Security starts with Clean CodeStatic Application Security Testing with Sonar](/solutions/security/)[Clean as You CodeOur unique approach to Clean Code](/solutions/our-unique-approach/)

  Something For Everyone

  [For DevelopersFind and fix issues as you code](/solutions/for-developers/)[For DevOpsBuild your apps on Clean Code foundations](/solutions/infrastructure-as-code/)[For EnterpriseClean Code delivery from development to production](/solutions/for-enterprise/)[For the Public SectorClean Code for the public sector](/solutions/public-sector/)
* Products

  Industry Leading Products

  [![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/aa3b1f02-f1b0-448f-a3f2-a1bd32923a08/SQ_Logo_Cloud_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarCloudCloud-based static analysis tool for your CI/CD workflows](/products/sonarcloud/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/bdac1871-464e-4051-88db-7df20c3bfffa/SQ_Logo_Server_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarQubeSelf-managed static analysis tool for continuous codebase inspection](/products/sonarqube/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/49f23af2-a29b-4d0f-95d7-ffd361f375e1/SQ_Logo_IDE_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarLintFree IDE extension that provides on-the-fly analysis and coding guidance](/products/sonarlint/)

  Languages and Frameworks

  [Java](/knowledge/languages/java/)[JavaScript](/knowledge/languages/js/)[TypeScript](/knowledge/languages/ts/)[Python](/knowledge/languages/python/)[C#](/knowledge/languages/csharp/)[C++](/knowledge/languages/cpp/)[C](/knowledge/languages/c/)[PHP](/knowledge/languages/php/)[Kotlin](/knowledge/languages/kotlin/)[See All](/lp/knowledge/languages/)
* Resources

  Learn About Clean Code

  [BlogStay connected with our latest development news and articles](/blog/)[Events hubLet's meet up online or in person - browse our conferences and webinars, or watch previous talks](/resources/events/)[Customer StoriesCheck out Sonar implementation success stories](/resources/customer-stories/)[White PapersFind in-depth articles on clean code](/resources/white-papers/)[LearnDeveloper learning hub - covering essential topics](/learn/)[Solution BriefsOur library of solution briefs](/resources/solution-briefs/)

  Go In Depth

  [SonarQube Server DocumentationFind more information on the technical details of SonarQube Server](https://docs.sonarsource.com/sonarqube/latest/)[SonarQube Cloud DocumentationFind more information on the technical details of SonarQube Cloud](https://docs.sonarsource.com/sonarcloud/)[SonarQube for IDE DocumentationFind more information on the technical details of SonarQube IDE](https://docs.sonarsource.com/sonarlint/)[Explore SonarpediaExplore our publicly available multi-language rules database](https://rules.sonarsource.com/)[LanguagesSee our multi-language coverage](/knowledge/languages/)
* Company

  Deliver Better Software

  [About UsSonar’s industry leading solution enables developers to write clean code and remediate existing code organically](/company/about/)[CareersJoin our growing team](/company/careers/)[Commitment to open sourceOur commitment to transparency, security, and continuous improvement](/solutions/commitment-to-open-source/)[CommunityGet latest updates, suggest features, and share your knowledge](https://community.sonarsource.com/)[PartnersSonar partners with the best resellers to bring Clean Code closer to you](/company/partners/)[Contact usHave questions? Get in touch](/company/contact/)

  Media

  [NewsroomNews announcements, media coverage, and more](/company/newsroom/)[CoverageFind articles about Sonar in the news](/company/coverage/)[Press ReleasesThe latest Sonar updates](/company/press-releases/)[CustomersAn overview of customers using Sonar by industry](/company/customers/)[Press KitExecutive headshots, quick stats, customer logos, and more](/company/press-kit/)
[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)
Search modal toggle button[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)Mobile menu toggle button

Blog post

# PHP Object Injection

![](data:image/svg+xml;charset=utf-8...)![Simon Scannell photo]()![Simon Scannell photo](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/39a5ba27-50e6-46a9-915d-4c21a2205308/05747622-11af-457d-a883-8ad3b3fb7aaf_simon.jpg?w=1080&h=1080&auto=format&fit=crop)

Simon Scannell

Vulnerability Researcher

October 9, 2018

Date

* [Security](/blog/tag/security/)
![](data:image/svg+xml;charset=utf-8...)![A very common and critical vulnerability in PHP applications is PHP Object Injection. This blog post explains how they work and how they can lead to a full site takeover by remote attackers.](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/c5cdcf61-b15e-4489-b704-6c39f58cb0f5/cover-fd7ed5ab-d270-45e6-8e9d-8ae50c9d7b59_drupal-pop-chain.png?w=715&h=426&auto=format&fit=crop)![A very common and critical vulnerability in PHP applications is PHP Object Injection. This blog post explains how they work and how they can lead to a full site takeover by remote attackers.](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/c5cdcf61-b15e-4489-b704-6c39f58cb0f5/cover-fd7ed5ab-d270-45e6-8e9d-8ae50c9d7b59_drupal-pop-chain.png?w=715&h=426&auto=format&fit=crop)

A very common and critical vulnerability in PHP applications is PHP Object Injection. This blog post explains how they work and how they can lead to a full site takeover by remote attackers.

## PHP Serialization Recap

PHP provides a mechanism for storing and loading data with PHP types across multiple HTTP requests. This mechanism boils down to two functions: serialize() and unserialize(). This may sound complicated but let’s look at the following easy example:

**A PHP object is** ***serialized***

```
<?php
$object = new stdClass();
$object->data = "Some data!";
$cached = serialize($object);

The above example creates a new object and the
```

The above example creates a new object and then produces the following *serialized* string representation of this object:

**The resulting** ***serialized*** **string:**

```
O:8:"stdClass":1:{s:4:"data";s:10:"Some data!";}
```

The syntax of the serialized string is relatively easy to understand: The `O` stands for the type of the serialized string. In this case the `O` maps to a PHP `object`. The `8` separated by the colons represents the length of the name of the class the object is an instance of. In this case, the serialized object is an instance of the PHP built in `stdClass`.

The following `1` represents the number of properties the serialized object contains which are stored within curly brackets. Each property is stored as a serialized string representing the property name, a semicolon and a serialized string representing the value.

While the property name is always a serialized PHP `string`, the value can be of any type: `arrays`, `integers`, `strings`, `objects` and `NULL` are the most common ones. In this example, there is only one property. It has the name `data` and has the value `Some data!`, which is a PHP `string` (s) of length 10.

## PHP Deserialization

The reason I touched on PHP serialization syntax is to make it easier to understand what happens when you call `unserialize()` on a serialized string.

**The** ***serialized*** **string is** ***unserialized*** **again:**

```
<?php
$object = unserialize('O:8:"stdClass":1:{s:4:"data";s:10:"Some data!";}');
echo $object->data;
```

PHP will parse the serialized string with the logic depicted above and create an instance of an `stdClass` with the properties given in the serialized string.

The reason developers do this is to easily and effectively store PHP data across requests, e.g. in caches or databases. A user session might be implemented as an instance of a class `UserSession`. This session object can easily be stored as a serialized string in the`$_SESSION` superglobal of PHP and be unserialized when needed.

## Dangers of Unserialize

Although this feature is very effective and easy to use, it does introduce potential security issues, to be exact when user input is passed to unserialize(). This can in fact lead to Remote Code Execution. For one, the PHP interpreter had many [low-level security issues](https://blog.ripstech.com/2017/security-flaws-in-the-php-core/ "low-level security issues") in this built-in function that could be exploited. But also, depending on the code base of the affected application, there are other ways for attackers. Let’s have a look at the following PHP code:

```
<?php
class LoggingClass {
    function __construct($filename, $content) {
        // add .log to the filename so we are really creating a log file!!
        $this->filename = $filename . ".log";
        $this->content = $content;
    }

    // This method is executed for each object at the end of the PHP execution
    function __destruct() {
        // flush the logs
        file_put_contents($this->filename, $this->content);
    }
}

$data = unserialize($_GET['data']);
```

Here, user input is directly passed to `unserialize()`. The next section will detail how this can be exploited.

### Magic Methods and Object Injections

The `LoggingClass` declared in the example above takes two parameters in the constructor: A filename to write to and the file contents. The magic method `__destruct()` then actually flushes the log and writes it to the filename passed to the constructor. Note that the `__destruct()` method is called **automatically** for each PHP object of the `LoggingClass` at the end of the PHP code execution.

Even if an attacker would be able to control the arguments passed to the constructor, he probably would not be able to exploit the vulnerability for the simple reason that a `.log` is appended to the filename. If this would not happen, the attacker could simply set the filename to `shell.php` and set the content to some arbitrary PHP code.

However, if an attacker supplied the following serialized string to the call to `unserialize()`, he could still exploit the vulnerability with the following serialized payload:

```
O:12:"LoggingClass":2:{s:8:"filename";s:9:"shell.php";s:7:"content";s:20:"<?php evilCode(); ?>";}
```

Here, the filename property is set to `shell.php`. The constructor of the class is *not* called during deserialization, the object was already instantiated and is available in serialized form. However, the destructor is going to be called at the end of execution and it’s using the object’s properties. Namely, the destructor will call `file_put_contents()` on the filename and content property that can be edited by the attacker by modifying the serialized string. This allows an attacker to inject an object into memory with the `filename` property set to `shell.php` which will then create a PHP backdoor on the server.

There are also further ways for exploitation. For example, the altered properties could be used to call another method of an object. An attacker could then control the class of that method call and defer the control flow. Such payloads are called *property oriented programming* and we documented examples for [Drupal](https://blog.ripstech.com/2019/complex-drupal-pop-chain/ "Drupal") and [ExpressionEngine](https://blog.ripstech.com/2016/expressionengine-code-reuse-attack/ "ExpressionEngine").

### Object Injections in Real World

Although passing user input to unserialize() is highly discouraged, such attacks still happen all the time. To name a few examples, we detected the following critical PHP Object Injections:

* [Pydio unauthenticated Remote Code Execution](https://blog.sonarsource.com/php-object-injection/ "Pydio unauthenticated Remote Code Execution")
* [WooCommerce Privilege Escalation](https://blog.sonarsource.com/php-object-injection/ "WooCommerce Privilege Escalation")
* [PrestaShop Remote Code Execution](https://blog.sonarsource.com/php-object-injection/ "PrestaShop Remote Code Execution")

### Related Posts

* [Pydio 8.2.1 Unauthenticated Remote Code Execution](https://blog.sonarsource.com/php-object-injection/ "Pydio 8.2.1 Unauthenticated Remote Code Execution")
* [Shopware 5.3.3: PHP Object Instantiation to Blind XXE](https://blog.sonarsource.com/php-object-injection/ "Shopware 5.3.3: PHP Object Instantiation to Blind XXE")
* [A Salesmans Code Execution: PrestaShop 1.7.2.4](https://blog.sonarsource.com/php-object-injection/ "A Salesmans Code Execution: PrestaShop 1.7.2.4")
* [CTF Writeup: Complex Drupal POP Chain](https://blog.sonarsource.com/php-object-injection/ "CTF Writeup: Complex Drupal POP Chain")
* [Breaking Into Your Company's Internal Network - SuiteCRM 7.11.4](https://blog.sonarsource.com/php-object-injection/ "Breaking Into Your Company's Internal Network - SuiteCRM 7.11.4")
* [phpBB 3.2.3: Phar Deserialization to RCE](https://blog.sonarsource.com/php-object-injection/ "phpBB 3.2.3: Phar Deserialization to RCE")
* [What is Phar Deserialization](https://blog.sonarsource.com/php-object-injection/ "What is Phar Deserialization")
* [How security flaws in PHP's core can affect your application](https://blog.sonarsource.com/php-object-injection/ "How security flaws in PHP's core can affect your application")
* [Why mail() is dangerous in PHP](https://blog.sonarsource.com/php-object-injection/ "Why mail() is dangerous in PHP")
#### SHARE

[twitter](https://twitter.com/share?text=undefined)[facebook](https://www.facebook.com/sharer/sharer.php?u=undefined)[linkedin](https://www.linkedin.com/sharing/share-offsite/?url=undefined)mail[Go to SonarSource homepage![](data:image/svg+xml;charset=utf-8...)![sonar logo ]()![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=160&h=40&auto=format&fit=crop)](/)

* **Sonar Solutions**
  + [SAST](/solutions/security/)
  + [What is clean code](/solutions/clean-code/)
  + [Power of clean code](/solutions/power-of-clean-code/)
  + [Clean as you code](/solutions/our-unique-approach/)
  + [AI-assisted & quality-assured code](/solutions/ai/)
  + [DevOps transformation](/solutions/devops-transformation/)
  + [Outsourcing software development](/solutions/reduce-outsourcing-software-development-risk/)
  + [Reduce & manage technical debt](/solutions/reduce-technical-debt/)
  + [Secure by design](/solutions/secure-by-design-code/)
  + [Code coverage](/solutions/code-coverage/)
  + [Code review](/solutions/code-review/)
  + [For developers](/solutions/for-developers/)
  + [For enterprise](/solutions/for-enterprise/)
  + [Infrastructure as code](/solutions/infrastructure-as-code/)
  + [Public sector](/solutions/public-sector/)
* **Products**
  + [SonarQube for IDE](/products/sonarlint/)
  + [SonarQube Server](/products/sonarqube/)
  + [SonarQube Cloud](/products/sonarcloud/)**Pricing**
  + [Start for free](/open-source-editions/)
  + [Explore pricing](/plans-and-pricing/)
* **Company**
  + [About](/company/about/)
  + [Careers](/company/careers/)
  + [Commitment to open source](/solutions/commitment-to-open-source/)
  + [Customers](/company/customers/)
  + [Partners](/company/partners/)
  + [Contact us](/company/contact/)
  + [Accessibility](/accessibility/)
  + [NEW! Brand identity](/brand-identity/)**Media**
  + [Coverage](/company/coverage/)
  + [Press releases](/company/press-releases/)
* **Resources**
  + [Events hub](/resources/events/)
  + [Customer stories](/resources/customer-stories/)
  + [White papers](/resources/white-papers/)
  + [Learn](/learn/guide/)
  + [Community](https://community.sonarsource.com/)
  + [Support](/support/)
* **Knowledge**
  + [Explore Sonarpedia](https://rules.sonarsource.com/)
  + [Blog](/blog/)
  + [Languages](/knowledge/languages/)
  + [SonarQube Server Documentation](https://docs.sonarsource.com/sonarqube/latest/)
  + [SonarQube Cloud Documentation](https://docs.sonarsource.com/sonarcloud/)
  + [SonarQube for IDE Documentation](https://docs.sonarsource.com/sonarlint/)

* [Legal documentation](/legal/)
* [Trust center](/trust-center/)

* [Follow SonarSource on Twitter](https://twitter.com/sonarsource)
* [Follow SonarSource on Linkedin](https://www.linkedin.com/company/sonarsource/)

© 2008-2025 SonarSource SA. All rights reserved. SONAR, SONARSOURCE, SONARQUBE, and CLEAN AS YOU CODE are trademarks of SonarSource SA.

