=== Content from discuss.hashicorp.com_442e35fb_20250111_123840.html ===


[HashiCorp Discuss](/)

# [HCSEC-2023-28 - Vault’s Transit Secrets Engine Allowed Nonce Specified without Convergent Encryption](/t/hcsec-2023-28-vault-s-transit-secrets-engine-allowed-nonce-specified-without-convergent-encryption/58249)

[Security](/c/security/52)

[security-vault](https://discuss.hashicorp.com/tag/security-vault)

[jfinnigan](https://discuss.hashicorp.com/u/jfinnigan)

September 14, 2023, 10:49pm

1

**Bulletin ID:** HCSEC-2023-28

**Affected Products / Versions:** Vault and Vault Enterprise since 1.6.0; fixed in 1.14.3, 1.13.7, and 1.12.11.

**Publication Date:** September 14, 2023

**Summary**

The Vault and Vault Enterprise (“Vault”) transit secrets engine allowed authorized users to specify arbitrary nonces, even with convergent encryption disabled. The `encrypt` endpoint, in combination with an offline attack, could be used to decrypt arbitrary ciphertext and potentially derive the authentication subkey when using the transit secrets engine without convergent encryption. This vulnerability, CVE-2023-4680, is fixed in Vault 1.14.3, 1.13.7, and 1.12.11.

**Background**

Vault’s [transit secrets engine](https://developer.hashicorp.com/vault/docs/secrets/transit) provides the ability to perform encryption and decryption operations of user-specified data using a key managed by Vault.

[Convergent encryption](https://developer.hashicorp.com/vault/docs/secrets/transit#convergent-encryption) is a feature in the transit secrets engine that returns deterministic ciphertext provided identical plaintexts and contexts.

As documented, version 1 of convergent encryption required the client to provide their own nonce and this feature was preserved for backwards compatibility. Version 3 of convergent encryption derives nonces from plaintext and is resistant to nonce reuse. Non-convergent symmetric encryption modes of transit encryption use AES-GCM or ChaCha20-Poly1305.

The transit secrets engine provides encryption capability via its [encrypt](https://developer.hashicorp.com/vault/api-docs/secret/transit#encrypt-data) endpoint.

**Details**

An external party reported that Vault did not restrict the use of user-provided nonces when performing encryption operations on the transit secrets engine when convergent encryption is not enabled.

An authenticated Vault user authorized by Vault policies to encrypt transit data may be able to decrypt arbitrary ciphertext by performing encryption operations using known plaintexts and nonces.

Furthermore, for non-convergent modes using AES-GCM, an authenticated Vault user authorized by Vault policies to encrypt data may be able to derive the authentication subkey used to authenticate the ciphertext due to flaws in AES GCM.

**Remediation**

Customers should evaluate the risk associated with this issue and consider upgrading to Vault 1.14.3, 1.13.7, 1.12.11, or newer. Please refer to [Upgrading Vault](https://learn.hashicorp.com/tutorials/vault/sop-upgrade?in=vault/standard-procedures) for general guidance and version-specific upgrade notes.

Information about transit key rotation can be found in the [transit secrets engine documentation](https://developer.hashicorp.com/vault/docs/secrets/transit#usage).

**Acknowledgement**

This issue was identified by Rob Zimmerman and Sze Chuen Tan of Cloudflare who reported it to HashiCorp.

*We deeply appreciate any effort to coordinate disclosure of security vulnerabilities. For information about security at HashiCorp and the reporting of security vulnerabilities, please see <https://hashicorp.com/security>.*

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [[Vault]Convergent Encryption in Vault](https://discuss.hashicorp.com/t/vault-convergent-encryption-in-vault/26550)  [Vault](/c/vault/30) | 4 | 960 | July 12, 2021 |
| [HCSEC-2021-33 - Vault’s KV Secrets Engine With Integrated Storage Exposed to Authenticated Denial of Service](https://discuss.hashicorp.com/t/hcsec-2021-33-vault-s-kv-secrets-engine-with-integrated-storage-exposed-to-authenticated-denial-of-service/33157)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 7061 | December 14, 2021 |
| [Vault PKI vs Transit Secret Engine](https://discuss.hashicorp.com/t/vault-pki-vs-transit-secret-engine/38264)  [Vault](/c/vault/30) | 1 | 459 | April 12, 2022 |
| [Is advanced nonce generation and key rotation required when using transit's datakey?](https://discuss.hashicorp.com/t/is-advanced-nonce-generation-and-key-rotation-required-when-using-transits-datakey/16186)  [Vault](/c/vault/30) | 0 | 398 | October 18, 2020 |
| [How to extract key and nonce from the exported encrypted key which is of type aes256-gcm96](https://discuss.hashicorp.com/t/how-to-extract-key-and-nonce-from-the-exported-encrypted-key-which-is-of-type-aes256-gcm96/70306)  [HCP Vault Secrets](/c/hcp/hcp-vault-secrets/63) | 1 | 15 | October 2, 2024 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](/tos)
* [Privacy Policy](https://meta.discourse.org/privacy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled


